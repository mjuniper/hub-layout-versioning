"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[26974],{32836:function(e,t,i){i.d(t,{b:function(){return n}});var n=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];i.forEach((function(t){if("function"!==typeof e[t])throw new Error("Cannot bind context. ".concat(t," must be a function"));e[t]=e[t].bind(e)}))}},26974:function(e,t,i){i.r(t),i.d(t,{hub_field_input_gallery_picker:function(){return f}});var n=i(93433),r=i(4942),l=i(74165),a=i(15861),c=i(15671),s=i(43144),o=i(72585),u=i(32836),h=i(12868),d=i(6200),y=i(18436);i(84371),i(66287),i(91466),i(90251),i(80046),i(77843),i(49799),i(77699),i(69207),i(34601),i(21923),i(42016),i(34802),i(36106),i(21010),i(94062),i(9882),i(41817),i(88968),i(59002),i(47493),i(9618),i(25831),i(84354),i(79399);function v(e,t){return{targetEntity:t,filters:[{operation:"OR",predicates:[{id:e[t]}]}]}}var f=function(){function e(t){(0,c.Z)(this,e),(0,o.r)(this,t),this.arcgisConfigurationEditorFieldInputChange=(0,o.c)(this,"arcgisConfigurationEditorFieldInputChange",7),(0,u.b)(this,"handleGalleryPickerSelectionUpdate","handleOpenGalleryPicker","handleGallerySelectionRemove")}return(0,s.Z)(e,[{key:"handleGalleryPickerClose",value:function(){this.isOpen=!1}},{key:"fetchEntities",value:function(){var e=(0,a.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.convertEntityIdsToGallerySelection(),e.t0=this.context,!e.t0){e.next=6;break}return e.next=5,this.fetchGallerySelectionEntities(t);case 5:e.t0=e.sent;case 6:this.selectedEntities=e.t0;case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillLoad",value:function(){var e=(0,a.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchEntities();case 2:return e.next=4,h.i.loadIntlForComponent(this.element);case 4:this.intl=e.sent;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"targetEntity",get:function(){var e,t;return(null===(t=null===(e=this.params.uiSchema)||void 0===e?void 0:e.options)||void 0===t?void 0:t.targetEntity)||"item"}},{key:"limit",get:function(){var e,t;return null===(t=null===(e=this.params.uiSchema)||void 0===e?void 0:e.options)||void 0===t?void 0:t.limit}},{key:"convertEntityIdsToGallerySelection",value:function(){return(0,r.Z)({},this.targetEntity,this.params.value)}},{key:"convertGallerySelectionToEntityIds",value:function(e){return e[this.targetEntity]}},{key:"handleGalleryPickerSelectionUpdate",value:function(){var e=(0,a.Z)((0,l.Z)().mark((function e(t){var i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchGallerySelectionEntities(t.detail);case 2:this.selectedEntities=e.sent,i=this.convertGallerySelectionToEntityIds(t.detail),this.arcgisConfigurationEditorFieldInputChange.emit(i),this.isOpen=!1;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchGallerySelectionEntities",value:function(){var e=(0,a.Z)((0,l.Z)().mark((function e(t){var i,n,r,a,c,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v(t,this.targetEntity),r={requestOptions:null===(i=this.context)||void 0===i?void 0:i.hubRequestOptions},a=[],e.prev=3,e.next=6,(0,d.h)(n,r);case 6:c=e.sent,a=c.results,s=t[this.targetEntity],a=a.slice().sort((function(e,t){return(s.includes(e.id)?s.indexOf(e.id):1/0)-(s.includes(t.id)?s.indexOf(t.id):1/0)})),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),console.error("Unable to fetch selected entities:",e.t0);case 15:return e.prev=15,this.gallerySelection=t,e.finish(15);case 18:return e.abrupt("return",a);case 19:case"end":return e.stop()}}),e,this,[[3,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"handleOpenGalleryPicker",value:function(){this.isOpen=!0}},{key:"handleGallerySelectionRemove",value:function(e){var t=e.target,i=Number(t.getAttribute("data-index")),r=this.selectedEntities[i].id;this.selectedEntities=[].concat((0,n.Z)(this.selectedEntities.slice(0,i)),(0,n.Z)(this.selectedEntities.slice(i+1))),this.isOpen=!1,this.removeEntityFromGallerySelection(r);var l=this.convertGallerySelectionToEntityIds(this.gallerySelection);this.arcgisConfigurationEditorFieldInputChange.emit(l)}},{key:"removeEntityFromGallerySelection",value:function(e){this.gallerySelection[this.targetEntity]=this.gallerySelection[this.targetEntity].filter((function(t){return t!==e}))}},{key:"handleSelectEntitiesOrderChange",value:function(e){var t=this;this.gallerySelection[this.targetEntity]=e.detail,this.selectedEntities=this.gallerySelection[this.targetEntity].reduce((function(e,i){return t.selectedEntities.forEach((function(t){t.id===i&&e.push(t)})),e}),[]);var i=this.convertGallerySelectionToEntityIds(this.gallerySelection);this.arcgisConfigurationEditorFieldInputChange.emit(i)}},{key:"renderSelectedEntities",value:function(e){var t=this;return(0,o.h)("calcite-value-list",{class:"gallery-picker__selected-entities","drag-enabled":!0},e.map((function(e,i){return t.renderEntity(e,i)})))}},{key:"getTypeIcon",value:function(e){return e?(0,y.b)(e):"file"}},{key:"renderEntity",value:function(e,t){var i=e.updatedDate,n=e.owner,r=e.id,l=e.name,a=e.type;return(0,o.h)("calcite-value-list-item",{"data-index":t,description:"".concat(n," | ").concat(this.intl.t("updated")," ").concat(i.toLocaleDateString()),key:r,label:l,nonInteractive:!0,value:r},(0,o.h)("calcite-icon",{icon:this.getTypeIcon(a),scale:"l",slot:"actions-start"}),(0,o.h)("calcite-action",{"data-index":t,icon:"trash",onClick:this.handleGallerySelectionRemove,slot:"actions-end",text:""}))}},{key:"renderGalleryPickerButton",value:function(){return(0,o.h)(o.F,null,(0,o.h)("calcite-button",{appearance:"outline",class:"gallery-picker__select",color:"blue",onClick:this.handleOpenGalleryPicker,round:!0},this.intl.t("selectContent")))}},{key:"renderGalleryPicker",value:function(){var e,t,i,n,r,l;return(0,o.h)("arcgis-hub-gallery-picker",{catalogs:null===(t=null===(e=this.params.uiSchema)||void 0===e?void 0:e.options)||void 0===t?void 0:t.catalogs,context:this.context,facets:null===(n=null===(i=this.params.uiSchema)||void 0===i?void 0:i.options)||void 0===n?void 0:n.facets,gallerySelection:this.gallerySelection,limit:this.limit,modalTitle:this.intl.t("selectContent"),open:this.isOpen,showSelection:null===(l=null===(r=this.params.uiSchema)||void 0===r?void 0:r.options)||void 0===l?void 0:l.showSelection})}},{key:"render",value:function(){var e;return(0,o.h)(o.H,null,!!(null===(e=this.selectedEntities)||void 0===e?void 0:e.length)&&this.renderSelectedEntities(this.selectedEntities),this.renderGalleryPickerButton(),this.isOpen&&this.renderGalleryPicker())}},{key:"element",get:function(){return(0,o.g)(this)}}],[{key:"assetsDirs",get:function(){return["locales"]}},{key:"watchers",get:function(){return{context:["fetchEntities"]}}}]),e}();f.style=".gallery-picker__selected-entities{margin-bottom:1.5rem}calcite-value-list-item calcite-icon:first-child{margin-top:10px;margin-left:0.75rem}calcite-value-list-item{--calcite-font-size--2:var(--calcite-font-size--1)}"}}]);
//# sourceMappingURL=26974.c8a44f24.chunk.js.map