"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[69027],{69027:function(t,e,r){r.d(e,{A:function(){return U}});var i=r(29439),n=r(74165),s=r(15861),a=r(15671),o=r(43144),l=r(13115),u=r(19420),c=r(39318),h=r(53031),p=r(12969),f=r(47268);function g(t){var e;return t.match(/(qaext|\.mapsqa)\.arcgis.com/)?e="https://hubqa.arcgis.com":t.match(/(devext|\.mapsdevext)\.arcgis.com/)?e="https://hubdev.arcgis.com":t.match(/(www|\.maps)\.arcgis.com/)&&(e="https://hub.arcgis.com"),e}var _="/api/v3/domains",v="/api/v3/datasets",y="/api/discussions/v1",m=function(){function t(e){(0,a.Z)(this,t),this._portalUrl="https://www.arcgis.com",this.id=e.id,this._portalUrl=e.portalUrl,this._hubUrl=e.hubUrl,this._systemStatus=e.systemStatus,e.authentication&&(this._authentication=e.authentication),e.portalSelf&&(this._portalSelf=e.portalSelf),e.currentUser&&(this._currentUser=e.currentUser),e.properties&&(this._properties=e.properties)}return(0,o.Z)(t,[{key:"session",get:function(){return this._authentication}},{key:"isAuthenticated",get:function(){return!!this._authentication}},{key:"isAlphaOrg",get:function(){var t,e,r=!1,i=(null===(t=this._properties)||void 0===t?void 0:t.alphaOrgs)||[],n=null===(e=this._portalSelf)||void 0===e?void 0:e.id;return i.length&&n&&(r=i.includes(n)),r}},{key:"userRequestOptions",get:function(){if(this.isAuthenticated)return{authentication:this._authentication,portal:this.sharingApiUrl}}},{key:"requestOptions",get:function(){var t={portal:this.sharingApiUrl};return this.isAuthenticated&&(t={authentication:this._authentication,portal:this.sharingApiUrl}),t}},{key:"hubRequestOptions",get:function(){return{authentication:this.session,isPortal:this.isPortal,portalSelf:this.portal,hubApiUrl:this.hubUrl,portal:this.sharingApiUrl}}},{key:"portalUrl",get:function(){return this.isAuthenticated?this.isPortal||!this._portalSelf.urlKey?"https://".concat(this._portalSelf.portalHostname):"https://".concat(this._portalSelf.urlKey,".").concat(this._portalSelf.customBaseUrl):this._portalUrl}},{key:"hubLicense",get:function(){return this.isPortal?"enterprise-sites":this.hubEnabled?"hub-premium":"hub-basic"}},{key:"systemStatus",get:function(){return this._systemStatus}},{key:"sharingApiUrl",get:function(){return"".concat(this.portalUrl,"/sharing/rest")}},{key:"hubUrl",get:function(){return this._hubUrl}},{key:"isPortal",get:function(){return this._portalSelf?this._portalSelf.isPortal:-1===this._portalUrl.indexOf("arcgis.com")}},{key:"discussionsServiceUrl",get:function(){if(this._hubUrl)return"".concat(this._hubUrl).concat(y)}},{key:"hubSearchServiceUrl",get:function(){if(this._hubUrl)return"".concat(this._hubUrl).concat(v)}},{key:"domainServiceUrl",get:function(){if(this._hubUrl)return"".concat(this._hubUrl).concat(_)}},{key:"eventsConfig",get:function(){if(this._portalSelf)return(0,l.g)(this._portalSelf,"portalProperties.hub.settings.events")}},{key:"hubEnabled",get:function(){return(0,u.g)(this._portalSelf,"portalProperties.hub.enabled",!1)}},{key:"communityOrgId",get:function(){if(this._portalSelf)return(0,l.g)(this._portalSelf,"portalProperties.hub.settings.communityOrg.orgId")}},{key:"communityOrgHostname",get:function(){if(this._portalSelf)return(0,l.g)(this._portalSelf,"portalProperties.hub.settings.communityOrg.portalHostname")}},{key:"communityOrgUrl",get:function(){if(this.communityOrgHostname)return"https://".concat(this.communityOrgHostname)}},{key:"helperServices",get:function(){if(this._portalSelf)return this._portalSelf.helperServices}},{key:"currentUser",get:function(){return this._currentUser}},{key:"portal",get:function(){return this._portalSelf}},{key:"properties",get:function(){return this._properties}}]),t}(),U=function(){function t(e){(0,a.Z)(this,t),this._portalUrl="https://www.arcgis.com",this._logLevel=h.L.error,this.id=(new Date).getTime(),e.logLevel&&(this._logLevel=e.logLevel),h.a.setLogLevel(this._logLevel),h.a.debug("ArcGISContextManager:ctor: Creating ".concat(this.id)),e.properties&&(this._properties=e.properties),e.authentication?(this._authentication=e.authentication,this._portalUrl=this._authentication.portal.replace("/sharing/rest",""),this._hubUrl=g(this._portalUrl)):e.portalUrl?(this._portalUrl=e.portalUrl,this._hubUrl=g(this._portalUrl)):this._hubUrl=g(this._portalUrl),e.portal&&(this._portalSelf=(0,p.c)(e.portal)),e.currentUser&&(this._currentUser=(0,p.c)(e.currentUser)),e.systemStatus&&(this._systemStatus=e.systemStatus)}return(0,o.Z)(t,[{key:"setAuthentication",value:function(){var t=(0,s.Z)((0,n.Z)().mark((function t(e){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._authentication=e,this._portalUrl=e.portal.replace("/sharing/rest",""),t.next=4,this.initialize();case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"setProperties",value:function(t){this._properties=t,this._context=new m(this.contextOpts)}},{key:"clearAuthentication",value:function(){this._context.isPortal||(this._portalUrl=(0,c.g)(this._portalUrl)),this._authentication=null,this._portalSelf=null,this._currentUser=null,this._context=new m(this.contextOpts)}},{key:"context",get:function(){return this._context}},{key:"initialize",value:function(){var t=(0,s.Z)((0,n.Z)().mark((function t(){var e,r,s,a,o,l,u;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._authentication||this._portalSelf&&this._currentUser){t.next=22;break}return h.a.debug("ArcGISContextManager-".concat(this.id,": Initializing")),e=this._authentication.username,r=[(0,f.g)({authentication:this._authentication}),(0,c.a)({username:e,authentication:this._authentication})],t.prev=4,t.next=7,Promise.all(r);case 7:s=t.sent,a=(0,i.Z)(s,2),o=a[0],l=a[1],this._portalSelf=o,this._currentUser=l,h.a.debug("ArcGISContextManager-".concat(this.id,": received portalSelf and currentUser")),t.next=22;break;case 16:throw t.prev=16,t.t0=t.catch(4),u='ArcGISContextManager could not fetch portal & user for "'.concat(this._authentication.username,'" using ').concat(this._authentication.portal,"."),h.a.error(u),console.error(u),t.t0;case 22:if(this._systemStatus){t.next=26;break}return t.next=25,d(this._portalUrl);case 25:this._systemStatus=t.sent;case 26:h.a.debug("ArcGISContextManager-".concat(this.id,": updating context")),this._context=new m(this.contextOpts);case 28:case"end":return t.stop()}}),t,this,[[4,16]])})));return function(){return t.apply(this,arguments)}}()},{key:"contextOpts",get:function(){var t={id:this.id,portalUrl:this._portalUrl,hubUrl:this._hubUrl,properties:this._properties,systemStatus:this._systemStatus};return this._authentication&&(t.authentication=this._authentication),this._portalSelf&&(t.portalSelf=this._portalSelf),this._currentUser&&(t.currentUser=this._currentUser),t}}],[{key:"create",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(){var r,i,s=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>0&&void 0!==s[0]?s[0]:{},i=new t(r),e.next=4,i.initialize();case 4:return e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),t}();function d(t){var e=S;return-1===t.indexOf("arcgis.com")&&(e=b),Promise.resolve(e)}var b={discussions:"not-available",events:"not-available",initiatives:"not-available",items:"online",metrics:"not-available",notifications:"not-available",pages:"online",projects:"not-available",search:"online",sites:"online"},S={discussions:"online",events:"online",initiatives:"online",items:"online",metrics:"online",notifications:"online",pages:"online",projects:"online",search:"online",sites:"online"}},53031:function(t,e,r){r.d(e,{L:function(){return i},a:function(){return a}});var i,n=r(15671),s=r(43144);!function(t){t[t.all=0]="all",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.off=5]="off"}(i||(i={}));var a=function(){function t(){(0,n.Z)(this,t)}return(0,s.Z)(t,null,[{key:"setLogLevel",value:function(t){this.logLevel=t}},{key:"log",value:function(t){if(this.isLevelPermitted(i.debug)){for(var e,r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];(e=console).log.apply(e,[t].concat(n))}}},{key:"debug",value:function(t){if(this.isLevelPermitted(i.debug)){for(var e,r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];(e=console).debug.apply(e,[t].concat(n))}}},{key:"info",value:function(t){if(this.isLevelPermitted(i.info)){for(var e,r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];(e=console).info.apply(e,[t].concat(n))}}},{key:"warn",value:function(t){if(this.isLevelPermitted(i.warn)){for(var e,r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];(e=console).warn.apply(e,[t].concat(n))}}},{key:"error",value:function(t){if(this.isLevelPermitted(i.error)){for(var e,r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];(e=console).error.apply(e,[t].concat(n))}}},{key:"isLevelPermitted",value:function(t){return this.logLevel<=t}}]),t}();a.logLevel=i.off}}]);
//# sourceMappingURL=69027.99802b05.chunk.js.map