"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[81],{151:function(e,t,n){function i(){return new Float32Array(4)}function a(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function r(e,t,n,i){var a=new Float32Array(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=i,a}function o(){return i()}function s(){return r(1,1,1,1)}function l(){return r(1,0,0,0)}function u(){return r(0,1,0,0)}function c(){return r(0,0,1,0)}function p(){return r(0,0,0,1)}n.d(t,{c:function(){return a},f:function(){return r}});var h=o(),d=s(),v=l(),f=u(),g=c(),_=p();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_W:_,UNIT_X:v,UNIT_Y:f,UNIT_Z:g,ZEROS:h,clone:a,create:i,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:r,ones:s,unitW:p,unitX:l,unitY:u,unitZ:c,zeros:o},Symbol.toStringTag,{value:"Module"}))},14921:function(e,t,n){n.d(t,{Ed:function(){return f},UI:function(){return g},mt:function(){return S},q6:function(){return M},vr:function(){return x},w6:function(){return C}});var i=n(74165),a=n(15671),r=n(43144),o=n(60136),s=n(92572),l=n(15861),u=n(27366),c=n(85015),p=n(92026),h=n(66978),d=n(49861),v=(n(25243),n(63780),n(69912));function f(e,t,n){return(0,h.as)(e.map((function(e,i){return t.apply(n,[e,i])})))}function g(e,t,n){return _.apply(this,arguments)}function _(){return(_=(0,l.Z)((0,i.Z)().mark((function e(t,n,a){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,h.as)(t.map((function(e,t){return n.apply(a,[e,t])})));case 2:return e.abrupt("return",e.sent.map((function(e){return e.value})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return{ok:!0,value:e}}function m(e){return{ok:!1,error:e}}function M(e){return b.apply(this,arguments)}function b(){return(b=(0,l.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,p.Wi)(t)){e.next=2;break}return e.abrupt("return",{ok:!1,error:new Error("no promise provided")});case 2:return e.prev=2,e.t0=y,e.next=6,t;case 6:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 10:return e.prev=10,e.t2=e.catch(2),e.abrupt("return",m(e.t2));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function S(e){return w.apply(this,arguments)}function w(){return(w=(0,l.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=y,e.next=4,t;case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 8:return e.prev=8,e.t2=e.catch(0),e.abrupt("return",((0,h.r9)(e.t2),m(e.t2)));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function C(e){if(!0===e.ok)return e.value;throw e.error}function x(e,t){return new E(e,t)}var E=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,i){var r;(0,a.Z)(this,n),(r=t.call(this,{}))._result=null,r._abortHandle=null,r.abort=function(){r._abortController=(0,p.IM)(r._abortController)},r.remove=r.abort,r._abortController=new AbortController;var o=r._abortController.signal;return r.promise=e(o),r.promise.then((function(e){r._result=y(e),r._cleanup()}),(function(e){r._result=m(e),r._cleanup()})),r._abortHandle=(0,h.fu)(i,r.abort),r}return(0,r.Z)(n,[{key:"value",get:function(){return e=this._result,(0,p.pC)(e)&&!0===e.ok?e.value:null;var e}},{key:"error",get:function(){return e=this._result,(0,p.pC)(e)&&!1===e.ok?e.error:null;var e}},{key:"finished",get:function(){return(0,p.pC)(this._result)}},{key:"normalizeCtorArgs",value:function(){return{}}},{key:"destroy",value:function(){this.abort()}},{key:"_cleanup",value:function(){this._abortHandle=(0,p.hw)(this._abortHandle),this._abortController=null}}]),n}(c.Z);(0,u._)([(0,d.Cb)()],E.prototype,"value",null),(0,u._)([(0,d.Cb)()],E.prototype,"error",null),(0,u._)([(0,d.Cb)()],E.prototype,"finished",null),(0,u._)([(0,d.Cb)()],E.prototype,"promise",void 0),(0,u._)([(0,d.Cb)()],E.prototype,"_result",void 0),E=(0,u._)([(0,v.j)("esri.core.asyncUtils.ReactiveTask")],E)},86950:function(e,t,n){function i(e){return"h"in e&&"s"in e&&"v"in e}function a(e){return"l"in e&&"a"in e&&"b"in e}function r(e){return"l"in e&&"c"in e&&"h"in e}function o(e){return"x"in e&&"y"in e&&"z"in e}n.d(t,{Y3:function(){return M},_Y:function(){return m},_j:function(){return S},sJ:function(){return b},xr:function(){return y}});var s=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],l=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function u(e,t){var n,i,a=[];if(e[0].length!==t.length)throw new Error("dimensions do not match");var r=e.length,o=e[0].length,s=0;for(n=0;n<r;n++){for(s=0,i=0;i<o;i++)s+=e[n][i]*t[i];a.push(s)}return a}function c(e){var t=[e.r/255,e.g/255,e.b/255].map((function(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)})),n=u(s,t);return{x:100*n[0],y:100*n[1],z:100*n[2]}}function p(e){var t=u(l,[e.x/100,e.y/100,e.z/100]).map((function(e){var t=e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function h(e){var t=[e.x/95.047,e.y/100,e.z/108.883].map((function(e){return e>Math.pow(6/29,3)?Math.pow(e,1/3):1/3*Math.pow(29/6,2)*e+4/29}));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function d(e){var t=e.l,n=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((function(e){return e>6/29?Math.pow(e,3):3*Math.pow(6/29,2)*(e-4/29)}));return{x:95.047*n[0],y:100*n[1],z:108.883*n[2]}}function v(e){return h(c(e))}function f(e){return p(d(e))}function g(e){return function(e){var t=e.l,n=e.a,i=e.b,a=Math.sqrt(n*n+i*i),r=Math.atan2(i,n);return{l:t,c:a,h:r=r>0?r:r+2*Math.PI}}(h(c(e)))}function _(e){return p(d(function(e){var t=e.l,n=e.c,i=e.h;return{l:t,a:n*Math.cos(i),b:n*Math.sin(i)}}(e)))}function y(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:r(e)?_(e):a(e)?f(e):o(e)?p(e):i(e)?function(e){var t,n=(e.h+360)%360/60,i=e.s/100,a=e.v/100*255,r=a*i,o=r*(1-Math.abs(n%2-1));switch(Math.floor(n)){case 0:t={r:r,g:o,b:0};break;case 1:t={r:o,g:r,b:0};break;case 2:t={r:0,g:r,b:o};break;case 3:t={r:0,g:o,b:r};break;case 4:t={r:o,g:0,b:r};break;case 5:case 6:t={r:r,g:0,b:o};break;default:t={r:0,g:0,b:0}}return t.r=Math.round(t.r+a-r),t.g=Math.round(t.g+a-r),t.b=Math.round(t.b+a-r),t}(e):e}function m(e){return i(e)?e:function(e){var t=e.r,n=e.g,i=e.b,a=Math.max(t,n,i),r=a-Math.min(t,n,i),o=a,s=0===r?0:a===t?(n-i)/r%6:a===n?(i-t)/r+2:(t-n)/r+4,l=0===r?0:r/o;return s<0&&(s+=6),{h:s*=60,s:l*=100,v:o*=100/255}}(y(e))}function M(e){return a(e)?e:v(y(e))}function b(e){return r(e)?e:g(y(e))}function S(e,t){var n=v(e);return n.l*=1-t,f(n)}},80292:function(e,t,n){function i(e){return e&&"getAtOrigin"in e&&"originOf"in e}n.d(t,{l:function(){return i}})},45238:function(e,t,n){n.d(t,{EU:function(){return h},Ue:function(){return s},WH:function(){return d},ZZ:function(){return p},qC:function(){return c},uT:function(){return l},zk:function(){return u}});var i=n(16889),a=n(48976),r=n(98131),o=n(11186);function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return[e[0],e[1],e[2],e[3]]}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s();return(0,o.c)(n,e),n[3]=t,n}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s();return(0,o.f)(n,e,t),(0,o.n)(n,n),n[3]=-(0,o.v)(e,t),n}function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s();return(0,a.s)(g,e,d(e)),(0,a.s)(_,t,d(t)),(0,a.m)(g,_,g),v(n,(0,i.BV)((0,a.g)(n,g)))}function p(e){return e}function h(e){return e[3]}function d(e){return(0,i.Vl)(e[3])}function v(e,t){return e[3]=t,e}var f=[0,0,1,0],g=(0,r.a)(),_=(0,r.a)();s()},85305:function(e,t,n){n.d(t,{BR:function(){return b},E2:function(){return Z},Is:function(){return C},Kf:function(){return M},NE:function(){return E},P0:function(){return m},Tz:function(){return A},Ue:function(){return h},ej:function(){return S},id:function(){return w},pb:function(){return y},pt:function(){return g},qf:function(){return d},rF:function(){return x},yS:function(){return O}});var i=n(14226),a=n(11186),r=n(71353),o=n(83448),s=n(78952),l=n(29691),u=n(14320),c=n(82218),p=n(23470);function h(e){var t=e.value,n=e.operations;return{operations:n,value:n.create(t)}}function d(e,t,n){return e.operations.setExtent(e.value,t,n.value),n}function v(e){return{operations:e,value:e.create()}}function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v(e);return n.operations=e,e.copy(t,n.value),n}function g(e){return f(p.s,(0,p.f)(0,0,0,(0,o.Iu)(e).radius))}var _=Math.pow(2,50);function y(){return f(c.b,(0,c.f)([0,0,0],[_,0,0],[0,_,0]))}function m(e,t,n){return e.operations.axisAt(e.value,t,u.R.Z,n)}function M(e,t,n,i){return e.operations.axisAt(e.value,t,n,i)}function b(e,t,n){return e.operations.intersectRay(e.value,t,n)}function S(e,t,n){return e.operations.intersectRayClosestSilhouette(e.value,t,n)}function w(e,t){return e.operations.altitudeAt(e.value,t)}function C(e,t,n,i){return e.operations.setAltitudeAt(e.value,t,n,i)}function x(e,t,n,r){return t!==r&&(0,i.c)(r,t),(0,a.s)(k,r[12],r[13],r[14]),C(e,k,n,k),r[12]=k[0],r[13]=k[1],r[14]=k[2],r}function E(e,t,n){return e.operations.elevate(e.value,t,n.value)}var k=(0,r.c)();function O(e,t,n,i,r){return r[0]=(0,a.e)(e,t),r[1]=(0,a.e)(e,n),r[2]=(0,a.e)(e,i),r}function A(e,t,n,i,r){(0,a.c)(n,e),(0,a.c)(T,t),(0,a.n)(T,T),(0,a.f)(i,T,n),(0,a.f)(r,i,n)}function Z(e,t){return e?(0,l.rS)(t):t.isGeographic?s.Z.PlateCarree:t}var T=(0,r.c)()},33906:function(e,t,n){n.d(t,{G:function(){return o},e:function(){return s}});var i=n(92026),a=n(79803),r=n(77648);function o(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=(0,a.fM)(e,t);return(0,i.Wi)(s)?null:(s.hasZ&&!o||!(0,i.pC)(n)||(s.z=(0,i.Pt)((0,r.KO)(n,s),0)),s)}function s(e,t,n){n.warnOnce("Failed to project analysis geometry (id: '".concat(e.id,"'), projection from spatial reference (wkid: '").concat(t.wkid,"') to view spatial reference is not supported. Projection may be possible after calling projection.load()."))}},56136:function(e,t,n){n.r(t),n.d(t,{DrawGraphicTool3D:function(){return Se},ExtentTransformTool:function(){return Qn},GraphicMoveTool:function(){return Xt},GraphicReshapeTool:function(){return gn},GraphicTransformTool:function(){return Wn}});var i=n(1413),a=n(15671),r=n(43144),o=n(60136),s=n(92572),l=n(27366),u=n(42537),c=n(92026),p=n(94172),h=n(49861),d=(n(25243),n(63780)),v=n(69912),f=n(11186),g=n(71353),_=n(74509),y=n(64575),m=n(17842),M=(n(32718),n(10064),n(93169)),b=n(93433),S=n(74165),w=n(15861),C=n(85015),x=n(14921),E=n(66978),k=n(58935),O=n(88396),A=n(6394),Z=n(69662),T=n(41201),R=n(74177),G=n(36444),D=n(59418),P={default:15,far:25},I=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).context=null,i.stagedVertex=null,i.visible=!0,i.edgeDistance="default",i._messagesUnits=null,i._labelInfos=[],i._nextLabelIndex=0,i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this,t=(0,x.vr)(function(){var t=(0,w.Z)((0,S.Z)().mark((function t(n){var i;return(0,S.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,T.ME)("esri/core/t9n/Units");case 2:i=t.sent,(0,E.k_)(n),e._messagesUnits=i;case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),n=function(){return(0,c.yw)(e.context,(function(e){return e.editGeometryOperations}))};this.addHandles([(0,p.YP)((function(){return[(0,c.pC)(e.context)&&e.getCameraOrExtent(e.context),e.visible,e._edgeDistancePixels,e.stagedVertex,e._messagesUnits]}),(function(){return e._update()}))].concat((0,b.Z)(["vertex-add","vertex-update","vertex-remove"].map((function(t){return(0,p.on)(n,t,(function(){return e._update()}))}))),[(0,u.kB)((function(){return t.abort()}))]))}},{key:"destroy",value:function(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}},{key:"updating",get:function(){return(0,c.Wi)(this._messagesUnits)}},{key:"test",get:function(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map((function(e){return e.label.text}))}}},{key:"_edgeDistancePixels",get:function(){return P[this.edgeDistance]}},{key:"_update",value:function(){var e=this;this._nextLabelIndex=0;var t=this.context;if((0,c.Wi)(t))this._destroyUnusedLabels();else{var n=t.editGeometryOperations.data,i=n.components,a=n.geometry,r=n.coordinateHelper;if(a){for(var o=i.length,s=function(n){var s=[];if(i[n].iterateVertices((function(e){s.push(r.toXYZ(e.pos))})),0===n&&(0,c.pC)(e.stagedVertex)&&s.push(r.toXYZ(e.stagedVertex)),s.length<2)return"continue";var l=s[0],u=s[s.length-1];"polygon"===a.type&&s.length>2&&!(0,f.F)(l,u)&&s.push(l);var p=1===o&&!(0,Z.bu)(s,!1,!1),h=z,d=W;e.toScreenPointArray(t,l,h);for(var v=1;v<s.length;++v){var g,_=s[v-1],y=s[v];e.toScreenPointArray(t,y,d),e._addLabel(t,_,h,y,d,p),h=(g=[d,h])[0],d=g[1]}},l=0;l<o;++l)s(l);this._destroyUnusedLabels()}else this._destroyUnusedLabels()}}},{key:"_addLabel",value:function(e,t,n,i,a,r){var o=this._getOrCreateLabel(e).label;if(!this.visible||(0,O.k)(n,a)<3025)o.visible=!1;else{var s=(0,c.pC)(e.graphicState)?e.graphicState.isDraped?"on-the-ground":"absolute-height":(0,_.VW)(e.editGeometryOperations.data.geometry,e.elevationInfo),l=e.editGeometryOperations.data.spatialReference,u=(0,D.MU)(t,i,l,s),p=this._messagesUnits,h=(0,R.R)(e.view);o.text=(0,c.pC)(p)&&(0,c.pC)(u)?(0,k.N9)(p,u,h):"",o.visible=!0;var d=a[0]-n[0],v=a[1]-n[1];r?(0,O.s)(L,-v,d):(0,O.s)(L,v,-d),(0,O.f)(L,L),(0,O.b)(L,L,this._edgeDistancePixels),(0,O.l)(V,n,a,.5),(0,O.j)(V,V,L),o.position=[V[0],V[1]],Math.abs(L[0])>Math.abs(L[1])?o.anchor=L[0]>0?"left":"right":o.anchor=-L[1]<0?"top":"bottom"}}},{key:"_getOrCreateLabel",value:function(e){var t;if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];var n=new G.Z({fontSize:10,anchor:"center"});null===(t=e.view.overlay)||void 0===t||t.items.add(n);var i={label:n};return this._labelInfos.push(i),this._nextLabelIndex=this._labelInfos.length,i}},{key:"_destroyUnusedLabels",value:function(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}},{key:"_destroyLabel",value:function(e){var t=e.label;(0,c.yw)(this.context,(function(e){var n;return null===(n=e.view.overlay)||void 0===n?void 0:n.items.remove(t)})),t.destroy()}}]),n}(C.Z);(0,l._)([(0,h.Cb)()],I.prototype,"context",void 0),(0,l._)([(0,h.Cb)()],I.prototype,"stagedVertex",void 0),(0,l._)([(0,h.Cb)()],I.prototype,"visible",void 0),(0,l._)([(0,h.Cb)()],I.prototype,"edgeDistance",void 0),(0,l._)([(0,h.Cb)()],I.prototype,"updating",null),(0,l._)([(0,h.Cb)()],I.prototype,"_messagesUnits",void 0),(0,l._)([(0,h.Cb)()],I.prototype,"_edgeDistancePixels",null),I=(0,l._)([(0,v.j)("esri.views.interactive")],I);var L=(0,A.a)(),V=(0,A.a)(),z=(0,m.s1)(),W=(0,m.s1)(),X=n(11208),Y=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"getCameraOrExtent",value:function(e){return e.view.state.camera}},{key:"toScreenPointArray",value:function(e,t){var n=e.view,i=e.elevationInfo,a=e.editGeometryOperations,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,m.s1)(),o=a.data.coordinateHelper.spatialReference;return(0,X.RS)(t,o,i,n,H),n.state.camera.projectToScreen(H,r),r}}]),n}(I);Y=(0,l._)([(0,v.j)("esri.views.3d.interactive.SegmentLabels3D")],Y);var H=(0,g.c)(),N=n(79311),U=n(99047),F=n(97411),j=n(37762),B=n(11752),Q=n(61120),J=n(91505),q=n(90045),$=n(151),K=n(79803),ee=n(41414),te=n(65618),ne=n(62921),ie=n(62389),ae=n(78935),re=n(79685),oe=n(78081),se=n(88699),le=n(56529),ue=n(39077),ce=n(4760),pe=n(58901),he=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i,r;return(0,a.Z)(this,n),(r=t.call(this,e))._attachmentOrigin=(0,te.Tx)(0,0,0,null),r._attachmentOriginDirty=!0,r.events=new J.Z,r._geometry=null,r._width=1,r._color=(0,$.f)(1,0,1,1),r._innerWidth=0,r._innerColor=(0,$.f)(1,1,1,1),r._stipplePattern=null,r._stippleOffColor=null,r._falloff=0,r._elevationInfo=null,r._laserlineStyle=null,r._laserlineEnabled=!1,r._renderOccluded=le.yD.OccludeAndTransparentStencil,r._attachmentOrigin.spatialReference=e.view.spatialReference,r._laserline=new ie.W({view:e.view}),r.applyProps(e),r.attached=null===(i=e.attached)||void 0===i||i,r}return(0,r.Z)(n,[{key:"destroy",value:function(){this._laserline.destroy(),(0,B.Z)((0,Q.Z)(n.prototype),"destroy",this).call(this)}},{key:"createObject3DResourceFactory",value:function(e){var t=this;return{view:e,createResources:function(e){return t._createObject3DResources(e)},destroyResources:function(e){return t._destroyExternalResources(e)},recreateGeometry:function(e,n){e.geometries.length=0,t._recreateGeometry(n,e.material,e.geometries)}}}},{key:"createDrapedResourceFactory",value:function(e){var t=this;return{view:e,createResources:function(){return t._createDrapedResources()},destroyResources:function(e){return t._destroyExternalResources(e)},recreateGeometry:function(e){e.geometries=t._createRenderGeometriesDraped(e.material),t._attachmentOriginChanged()}}}},{key:"_laserlineAttached",get:function(){return this.attached&&this.visible&&(0,c.pC)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}},{key:"onAttachedChange",value:function(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,q.g)(e,this._color)||((0,q.c)(this._color,e),this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){(0,q.g)(e,this._innerColor)||((0,q.c)(this._innerColor,e),this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=(0,c.pC)(e)!==(0,c.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){e&&this._stippleOffColor&&(0,q.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,$.c)(e):null,this._updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.recreateGeometry()}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,(0,c.pC)(e)&&(this._laserline.style=e)}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"attachmentOrigin",get:function(){var e;if(!this._attachmentOriginDirty)return this._attachmentOrigin;var t=null===(e=(0,c.WG)(this.object3dResources.resources))||void 0===e?void 0:e.geometries;if(!t||0===t.length)return null;(0,f.s)(fe,0,0,0);var n,i=0,a=(0,j.Z)(t);try{for(a.s();!(n=a.n()).done;){n.value.computeAttachmentOrigin(ve)&&((0,f.a)(fe,fe,ve),i++)}}catch(r){a.e(r)}finally{a.f()}return 0===i?null:((0,f.g)(fe,fe,1/i),this.view.renderCoordsHelper.fromRenderCoords(fe,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}},{key:"_updateMaterial",value:function(){(0,c.pC)(this.object3dResources.resources)&&this.object3dResources.resources.material.setParameters(this._materialParameters),(0,c.pC)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this._materialParameters)}},{key:"_isClosed",get:function(){return(0,c.pC)(this.geometry)&&"polygon"===this.geometry.type}},{key:"_materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded}}},{key:"_normalizedRenderOccluded",get:function(){return this.isDraped&&this._renderOccluded===le.yD.OccludeAndTransparentStencil?le.yD.OccludeAndTransparent:this._renderOccluded}},{key:"_recreateGeometry",value:function(e,t,n){this._createRenderGeometries(t,n);var i,a=(0,j.Z)(n);try{for(a.s();!(i=a.n()).done;){var r=i.value;e.addGeometry(r)}}catch(o){a.e(o)}finally{a.f()}this._attachmentOriginChanged()}},{key:"_attachmentOriginChanged",value:function(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}},{key:"_destroyExternalResources",value:function(e){e.geometries=[],e.material.dispose()}},{key:"_createObject3DResources",value:function(e){var t=new pe.U(this._materialParameters),n=new Array;return this._recreateGeometry(e,t,n),{material:t,geometries:n,forEach:function(e){e(t),n.forEach(e)}}}},{key:"_createDrapedResources",value:function(){var e=new pe.U(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}},{key:"_createRenderGeometriesDraped",value:function(e){var t=this.geometry;if((0,c.Wi)(t)||(0,c.Wi)(this.view.basemapTerrain.spatialReference))return[];var n,i=(0,oe.r)(t,this.view.basemapTerrain.spatialReference),a=[],r=(0,j.Z)(i.lines);try{for(r.s();!(n=r.n()).done;){var o=n.value.position,s={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:o},removeDuplicateStartEnd:this._isClosed},l=new ue.z((0,re.Y)(e,s)),u=(0,ee.cS)(de);(0,ee.G1)(u,o),(0,q.s)(l.boundingSphere,.5*(u[0]+u[3]),.5*(u[1]+u[4]),0,.5*Math.sqrt((u[3]-u[0])*(u[3]-u[0])+(u[4]-u[1])*(u[4]-u[1]))),a.push(l)}}catch(p){r.e(p)}finally{r.f()}return a}},{key:"calculateMapBounds",value:function(e){if((0,c.Wi)(this.object3dResources.resources))return!1;var t,n=this.view.renderCoordsHelper,i=(0,j.Z)(this.object3dResources.resources.geometries);try{for(i.s();!(t=i.n()).done;){var a=t.value.vertexAttributes.get(ce.T.POSITION),r=(0,se.bg)(a.data.length);(0,K.CM)(a.data,n.spatialReference,0,r,this.view.spatialReference,0,a.data.length/3),(0,ee.G1)(e,r)}}catch(o){i.e(o)}finally{i.f()}return!0}},{key:"_createRenderGeometries",value:function(e,t){var n,i=this.geometry;if(!(0,c.Wi)(i)){var a,r=(0,oe.V)(i,this.view.elevationProvider,this.view.renderCoordsHelper,ae.o.fromElevationInfo(null!==(n=this.elevationInfo)&&void 0!==n?n:new y.Z({mode:(0,_.VW)(i,null)}))),o=new Array,s=(0,j.Z)(r.lines);try{for(s.s();!(a=s.n()).done;){var l=a.value,u=l.position,p={mapPositions:l.mapPositions,attributeData:{position:u},removeDuplicateStartEnd:this._isClosed};t.push((0,re.Y)(e,p)),o.push(u)}}catch(h){s.e(h)}finally{s.f()}this._laserline.pathVerticalPlane=o}}}]),n}(ne.i),de=(0,ee.Ue)(),ve=(0,g.c)(),fe=(0,g.c)(),ge=n(27676),_e=n(69691),ye=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).tracking=!1,i.displaying=!1,i.isDraped=!1,i}return(0,r.Z)(n)}(J.Z.EventedAccessor);(0,l._)([(0,h.Cb)({constructOnly:!0})],ye.prototype,"graphic",void 0),(0,l._)([(0,h.Cb)()],ye.prototype,"tracking",void 0),(0,l._)([(0,h.Cb)()],ye.prototype,"displaying",void 0),(0,l._)([(0,h.Cb)()],ye.prototype,"isDraped",void 0),ye=(0,l._)([(0,v.j)("esri.views.3d.layers.graphics.GraphicState")],ye);var me=n(73982),Me=n(42046),be=n(46640),Se=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e))._activeVertexVisualElement=null,i._createGraphicState=null,i._outlineVisualElement=null,i._verticesVisualElement=null,i._verticalLineVisualElement=null,i.geometryType=null,i.type="draw-3d",i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this.elevationInfo,t=e.mode,n=e.offset;this.internalGraphicsLayer.elevationInfo=new y.Z({mode:t,offset:n})}},{key:"normalizeCtorArgs",value:function(e){if(!e.elevationInfo){var t,n=null===(t=e.hasZ)||void 0===t||t;return(0,i.Z)((0,i.Z)({},e),{},{elevationInfo:(0,_.mF)(n)})}return e}},{key:"initializeGraphic",value:function(e){var t=this,n=this._createGraphicState=new ye({graphic:e});return(0,u.AL)([this.view.maskOccludee(e),this.view.trackGraphicState(n),(0,p.YP)((function(){return{element:t._outlineVisualElement,isDraped:n.isDraped}}),(function(e){var t=e.element,n=e.isDraped;(0,c.yw)(t,(function(e){return e.isDraped=n}))}),p.nn)])}},{key:"makeDrawOperation",value:function(){var e=this.geometryType,t="circle"!==e&&"rectangle"!==e;return new Me.w({view:this.view,manipulators:this.manipulators,geometryType:(0,me.I)(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new be.iW(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new be.aL(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new N._,segmentLabels:t?new Y:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:(0,c.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,_.Zz)(this.hasZ,this.elevationInfo)})}},{key:"onActiveVertexChanged",value:function(e){var t=this,n=this.view;return(0,c.pC)(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],this._updateVerticalLineVisualElement(e),null):(this._activeVertexVisualElement=new ge.j({view:n,spatialReference:n.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:U.Xd.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=U.Xd.colorToVec4(U.Xd.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,this._verticalLineVisualElement=new F.V({view:n,extensionType:U.Xd.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:le.yD.OccludeAndTransparent}),U.Xd.visualElements.zVerticalLine.apply(this._verticalLineVisualElement),(0,u.kB)((function(){t._activeVertexVisualElement=(0,c.SC)(t._activeVertexVisualElement),t._verticalLineVisualElement=(0,c.SC)(t._verticalLineVisualElement)})))}},{key:"_updateVerticalLineVisualElement",value:function(e){var t=this._verticalLineVisualElement;if(!(0,c.Wi)(t)){var n=this.view,i=n.renderCoordsHelper,a=n.elevationProvider;(0,f.s)(Ee,e[0],e[1],e[2]),xe.setFromElevationInfo(this.elevationInfo),Ee[2]=(0,_e.w7)(Ee,a,xe,i),i.toRenderCoords(Ee,this.view.spatialReference,Ee)?(t.setStartEndFromWorldDownAtLocation(Ee),t.attached=!0):t.attached=!1}}},{key:"onOutlineChanged",value:function(e){var t=this;if((0,c.pC)(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;var n=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new he({view:this.view,geometry:e,elevationInfo:n,isDraped:(0,c.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,_.Zz)(this.hasZ,n),attached:!1}),U.Xd.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),U.Xd.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,(0,u.kB)((function(){t._outlineVisualElement=(0,c.SC)(t._outlineVisualElement)}))}},{key:"onRegularVerticesChanged",value:function(e){var t=this;return(0,c.pC)(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new ge.j({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:U.Xd.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,(0,u.kB)((function(){t._verticesVisualElement=(0,c.SC)(t._verticesVisualElement)})))}}]),n}(me.T);(0,l._)([(0,h.Cb)({constructOnly:!0})],Se.prototype,"elevationInfo",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],Se.prototype,"geometryType",void 0),(0,l._)([(0,h.Cb)()],Se.prototype,"type",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],Se.prototype,"view",void 0),Se=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Se);var we,Ce,xe=new ae.o,Ee=(0,g.c)(),ke=n(80987),Oe=n(41691),Ae=n(47898),Ze=n(83639),Te=n(77498),Re=n(81655),Ge=n(16889),De=n(35284);!function(e){e[e.NONE=0]="NONE",e[e.ANY=1]="ANY",e[e.Z=2]="Z",e[e.XY=4]="XY"}(we||(we={})),function(e){e[e.TRANSLATE_Z=0]="TRANSLATE_Z",e[e.TRANSLATE_XY=1]="TRANSLATE_XY",e[e.SCALE=2]="SCALE",e[e.ROTATE=3]="ROTATE",e[e.SCALE_ROTATE=4]="SCALE_ROTATE"}(Ce||(Ce={}));var Pe=function(){function e(){(0,a.Z)(this,e),this.grabbingState=we.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}return(0,r.Z)(e,[{key:"update",value:function(e){var t=this;this.grabbingState=we.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((function(e,n){if(n===Ce.TRANSLATE_Z&&(t.zManipulator=e),e instanceof De.Z&&(e.selected&&(0===t.numSelected&&(t.firstSelected=e),t.numSelected++),(0,c.Wi)(t.firstGrabbedXY)&&e.grabbing&&n===Ce.TRANSLATE_XY&&(t.firstGrabbedXY=e)),e.grabbing)switch(t.grabbingState|=we.ANY,n){case Ce.TRANSLATE_Z:t.grabbingState|=we.Z;break;case Ce.TRANSLATE_XY:t.grabbingState|=we.XY}}))}}]),e}();function Ie(e){var t=e.view,n=e.graphic,i=new ye({graphic:n}),a=function(e,t){var n=e.view,i=e.graphic,a=new he({view:n,geometry:ze(i)?i.geometry:null,elevationInfo:(0,_.RL)(i),attached:!1});U.Xd.visualElements.lineGraphics.shadowStyle.apply(a);var r=function(){a.attached=t.displaying};U.Xd.visualElements.lineGraphics.outline.apply(a);var o=[(0,p.YP)((function(){return t.displaying}),r),(0,p.YP)((function(){return t.isDraped}),(function(e){a.isDraped=e})),t.on("changed",(function(){return a.geometry=ze(i)?i.geometry:null})),(0,u.ed)(a)];return r(),{visualElement:a,remove:function(){return(0,u.AL)(o).remove()}}}(e,i),r=[a,Le(e,a.visualElement,i),t.maskOccludee(n),t.trackGraphicState(i)];return{visualElement:a.visualElement,remove:function(){return(0,u.AL)(r).remove()}}}function Le(e,t,n){var i=e.graphic,a=e.view,r=[],o=(0,_.RL)(i),s="on-the-ground"===o.mode||!o.offset&&"absolute-height"!==o.mode,l=new Pe,h=new F.V({view:a,extensionType:U.Xd.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:le.yD.OccludeAndTransparent});U.Xd.visualElements.pointGraphics.shadowStyle.apply(h);var d=(0,Ge.Vl)(U.Xd.visualElements.heightPlaneAngleCutoff),v=new ie.W({view:a,attached:!1,angleCutoff:d});U.Xd.visualElements.heightPlane.apply(v);var f=1,g=1,y=function(){if(l.update(e),!n.displaying||s&&(n.isDraped||!ze(i)||!i.geometry.hasZ))return t.laserlineEnabled=!1,h.attached=!1,void(v.attached=!1);t.laserlineEnabled=!0;var a=l.grabbingState&we.XY?U.Xd.visualElements.laserlineAlphaMultiplier:1;a!==f&&(f=a,U.Xd.visualElements.lineGraphics.shadowStyle.apply(t,a),U.Xd.visualElements.pointGraphics.shadowStyle.apply(h,a));var r=l.grabbingState&we.Z?U.Xd.visualElements.laserlineAlphaMultiplier:1;r!==g&&(g=r,U.Xd.visualElements.heightPlane.apply(v,r)),function(e,t){var n=1===t.numSelected?t.firstSelected:t.numSelected>1&&(0,c.pC)(t.firstGrabbedXY)?t.firstGrabbedXY:null;(0,c.pC)(n)?(e.setStartEndFromWorldDownAtLocation(n.renderLocation),e.attached=!0):e.attached=!1}(h,l),Ve(e,t,v,l)};U.Xd.visualElements.zVerticalLine.apply(h),r.push(n.on("changed",y),(0,p.YP)((function(){return n.displaying}),y),t.events.on("attachment-origin-changed",y),(0,u.ed)(h),(0,u.ed)(v));var m=[],M=function(){(0,u.AL)(m).remove(),m.length=0,e.forEachManipulator((function(e){return m.push(e.events.on("grab-changed",y))})),e.forEachManipulator((function(e){return m.push(e.events.on("select-changed",y))})),y()};return M(),r.push(e.onManipulatorsChanged(M),(0,u.iU)((function(){return(0,u.AL)(m)}))),(0,u.AL)(r)}function Ve(e,t,n,i){if(i.numSelected>0){(0,f.s)(We,0,0,0);var a=0;e.forEachManipulator((function(e,t){t===Ce.TRANSLATE_XY&&e.selected&&e instanceof De.Z&&((0,f.a)(We,We,e.renderLocation),a++)})),a>0?(n.heightManifoldTarget=(0,f.g)(We,We,1/a),n.attached=!0):n.attached=!1}else{var r=t.attachmentOrigin;(0,c.pC)(r)&&e.view.renderCoordsHelper.toRenderCoords(r,We)?(n.heightManifoldTarget=We,n.attached=!0):n.attached=!1}}function ze(e){return(0,c.pC)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}var We=(0,g.c)(),Xe=n(65156),Ye=n(66730);function He(e){var t=e.view,n=e.graphic,i=new ye({graphic:n}),a=[],r=function(e,t,n){var i=e.view,a=e.graphic,r=new Ye.L({view:i,geometry:Ne(a),elevationInfo:(0,_.RL)(a),attached:!1});return function(e,t,n,i){var a=function(){return t.attached=n.displaying};(function(e,t,n,i){var a=e.view,r=e.graphic,o=null,s=function(e){(0,c.pC)(o)&&(o.remove(),o=null),n.isDraped&&(0,c.pC)(e)&&(o=function(e,t,n){var i=e.elevationProvider.spatialReference;(0,K.KC)(t,Ue,i);var a=Ue[0],r=Ue[1];return e.elevationProvider.on("elevation-change",(function(e){(0,Xe.jE)(e.extent,a,r)&&n()}))}(a,e,(function(){t.geometry=e})))},l=function(){var e=Ne(r);s(e),t.geometry=e};i.push(n.on("changed",l),(0,u.iU)((function(){return o}))),l()})(e,t,n,i),U.Xd.visualElements.pointGraphics.outline.apply(t),i.push((0,p.YP)((function(){return n.displaying}),a,p.nn))}(e,r,t,n),n.push((0,u.ed)(r)),r}(e,i,a);return function(e,t,n,i){var a=e.view,r=e.graphic,o=new F.V({view:a,extensionType:U.Xd.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:le.yD.OccludeAndTransparent});U.Xd.visualElements.zVerticalLine.apply(o);var s=new ie.W({view:a,intersectsLineInfinite:!0,attached:!1});U.Xd.visualElements.pointGraphics.shadowStyle.apply(s);var l=(0,Ge.Vl)(U.Xd.visualElements.heightPlaneAngleCutoff),h=new ie.W({view:a,attached:!1,angleCutoff:l});U.Xd.visualElements.heightPlane.apply(h);var d=(0,_.RL)(e.graphic),v=ae.o.fromElevationInfo(d),g="on-the-ground"===d.mode||!d.offset&&"absolute-height"!==d.mode,y=new Pe,m=1,M=1,b=function(){y.update(e);var n=Ne(r),l=g&&(t.isDraped||(0,c.Wi)(n)||!n.hasZ),u=!0;if(!l&&(0,c.pC)(n)){var p=(0,_e.w7)(n,a.elevationProvider,v,a.renderCoordsHelper);(0,f.s)(Ue,n.x,n.y,p),(0,K.SH)(Ue,n.spatialReference,Ue,a.renderCoordsHelper.spatialReference),o.setStartEndFromWorldDownAtLocation(Ue),s.intersectsWorldUpAtLocation=Ue}else u=!1;var d=y.grabbingState&we.Z?U.Xd.visualElements.laserlineAlphaMultiplier:1;d!==m&&(m=d,U.Xd.visualElements.heightPlane.apply(h,d));var _=(0,ee.cS)(Fe);!l&&t.displaying&&i.calculateMapBounds(_)&&(0,K.SH)((0,ee.KE)(_,Ue),a.spatialReference,Ue,a.renderCoordsHelper.spatialReference)?(h.heightManifoldTarget=Ue,h.attached=!0):h.attached=!1;var b=y.grabbingState&we.XY?U.Xd.visualElements.laserlineAlphaMultiplier:1;b!==M&&(M=b,U.Xd.visualElements.pointGraphics.shadowStyle.apply(s,b));var S=u&&t.displaying&&!l;s.attached=S,o.attached=S};n.push((0,p.YP)((function(){return[t.displaying,t.isDraped]}),b),t.on("changed",b)),e.forEachManipulator((function(e){n.push(e.events.on("grab-changed",b))})),n.push((0,u.ed)(s)),n.push((0,u.ed)(o)),n.push((0,u.ed)(h)),b()}(e,i,a,r),a.push(t.trackGraphicState(i)),{visualElement:r,remove:function(){(0,u.AL)(a).remove()}}}function Ne(e){var t=e.geometry;return(0,c.Wi)(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}var Ue=(0,g.c)(),Fe=(0,ee.Ue)();function je(e){switch((0,c.Wg)(e.graphic.geometry).type){case"point":case"mesh":return He(e);case"polygon":case"polyline":return Ie(e);default:return null}}var Be=[1,.5,0],Qe=70,Je=Math.ceil(Qe/3*2),qe=160,$e=5*Math.PI/12,Ke=1*Math.PI/3,et=n(100),tt=function(){function e(){(0,a.Z)(this,e),this._available=!0}return(0,r.Z)(e,[{key:"location",set:function(e){this._forEachManipulator3D((function(t){return t.location=e}))}},{key:"elevationAlignedLocation",set:function(e){this._forEachManipulator3D((function(t){return t.elevationAlignedLocation=e}))}},{key:"elevationInfo",set:function(e){this._forEachManipulator3D((function(t){return t.elevationInfo=e}))}},{key:"renderLocation",get:function(){var e;return this._forEachManipulator3D((function(t){e||(e=t.renderLocation)})),e}},{key:"available",get:function(){return this._available},set:function(e){this._available=e,this._forEachManipulator3D((function(t){return t.available=e}))}},{key:"hovering",get:function(){return this.someManipulator((function(e){return e.hovering}))}},{key:"grabbing",get:function(){return this.someManipulator((function(e){return e.grabbing}))}},{key:"dragging",get:function(){return this.someManipulator((function(e){return e.dragging}))}},{key:"hasManipulator",value:function(e){return this.someManipulator((function(t){return t===e}))}},{key:"someManipulator",value:function(e){var t=!1;return this.forEachManipulator((function(n){!t&&e(n)&&(t=!0)})),t}},{key:"_forEachManipulator3D",value:function(e){this.forEachManipulator((function(t,n){t instanceof De.Z&&e(t,n)}))}}]),e}(),nt=n(51995),it=n(14226),at=n(81949),rt=n(51378),ot=n(40508),st=n(51328),lt=n(74229);function ut(e,t,n,i){var a=e.graphic,r=function(e,n){return t({action:e,graphic:a,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY})};return n((function(e,t,n){return t.next((function(e){return"start"===e.action&&r("start",e),e})).next((0,lt.a9)(a,i)).next((function(e){switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&r("update",e);break;case"end":r("end",e)}return e})),{steps:t,cancel:n=n.next((0,lt.bD)(a)).next((function(e){return r("end",{screenDeltaX:0,screenDeltaY:0}),e}))}}))}function ct(e){if((0,c.Wi)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;var t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;var n=t[0],i=t[1];return Math.atan2(i[1]-n[1],i[0]-n[0])}function pt(e){if((0,c.Wi)(e)||(0,c.Wi)(e.axis))return 1;var t=e.mapStart,n=e.mapEnd,i=e.axis,a=[n.x-t.x,n.y-t.y];return a[0]*i[0]+a[1]*i[1]>0?1:-1}var ht,dt=n(68401),vt=n(70619),ft=n(66832),gt=n(99034),_t=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this))._handles=new et.Z,i._arrowManipulatorInfos=new Array,i._opaqueMaterial=i._createMaterial(),i._transparentMaterial=i._createMaterial(.5),i._angle=0,i._scale=1,i._radius=Qe,i._updateAfterDrag=!1,i.events=new J.Z,i._tool=e.tool,i._view=e.view,null!=e.radius&&(i._radius=e.radius),i._createManipulators(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return(0,r.Z)(n,[{key:"orthogonalAvailable",set:function(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}},{key:"destroy",value:function(){var e=this;this._handles=(0,c.SC)(this._handles),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}},{key:"forEachManipulator",value:function(e){var t,n=(0,j.Z)(this._arrowManipulatorInfos);try{for(n.s();!(t=n.n()).done;){e(t.value.manipulator,Ce.TRANSLATE_XY)}}catch(i){n.e(i)}finally{n.f()}}},{key:"createGraphicDragPipeline",value:function(e,t,n){var i=this,a=t.graphic,r=(0,_.RL)(a),o=(0,c.Wg)(a.geometry).spatialReference;return ut(t,n,(function(t){return i.createDragPipeline((function(n,i,a,r,o){var s;return i=(s=e(n,i,a,r,o)).steps,a=s.cancel,t(n,i,a)}),r,o,a)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t,n,a){var r=this;return(0,u.AL)(this._arrowManipulatorInfos.map((function(o,s){var l=o.manipulator;return(0,lt.Xd)(l,(function(o,l,u,c,p){var h=l.next((function(e){return(0,i.Z)((0,i.Z)({},e),{},{manipulatorType:Ce.TRANSLATE_XY})})).next((0,lt.kY)(r._view,o.elevationAlignedLocation)).next((0,st.G)(r._view,o.elevationAlignedLocation,t,n,a)).next((0,lt.M2)(o.location,r.angle+(s+1)*Math.PI*.5)).next((0,lt.zh)());e(o,h,u,c,p)}))})))}},{key:"angle",get:function(){return this._angle},set:function(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"radius",get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}},{key:"_updateManipulators",value:function(){for(var e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}},{key:"_updateArrowManipulator",value:function(e,t){var n=e.manipulator,i=e.transform,a=this._radius/Qe,r=54*a,o=r*Math.sqrt(3)/2,s=(0,vt.DA)(this._opaqueMaterial,o,r/2,r/2,.02);(0,vt.mx)(s,(0,it.f)(rt.MP.get(),(0,f.s)(rt.WM.get(),0,-o/3,0))),n.renderObjects=[new ot.r(s,gt.Q9.Focused),new ot.r(s.instantiate({material:this._transparentMaterial}),gt.Q9.Unfocused)],n.radius=o/3*2*1.2;var l=(0,it.b)(rt.MP.get(),t*Math.PI/2),u=(0,it.f)(rt.MP.get(),(0,f.s)(rt.WM.get(),0,100*a,0));(0,it.m)(i,l,u)}},{key:"_createManipulators",value:function(){for(var e=0;e<4;e++){var t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}},{key:"_updateManipulatorTransform",value:function(){var e=this.angle,t=(0,it.d)(rt.MP.get(),e,(0,g.f)(0,0,1));if(!(0,c.Wi)(t)){var n,i=(0,it.E)(rt.MP.get(),(0,f.s)(rt.WM.get(),this.displayScale,this.displayScale,this.displayScale)),a=(0,it.m)(rt.MP.get(),i,t),r=(0,j.Z)(this._arrowManipulatorInfos);try{for(r.s();!(n=r.n()).done;){var o=n.value,s=(0,it.m)(rt.MP.get(),a,o.transform);o.manipulator.modelTransform=s}}catch(l){r.e(l)}finally{r.f()}}}},{key:"_createArrowManipulator",value:function(e){var t=this,n=new De.Z({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,g.f)(0,0,1)}}),i={manipulator:n,transform:(0,at.c)()};return this._updateArrowManipulator(i,e),this._handles.add(n.events.on("drag",(function(e){t._updateAfterDrag&&"end"===e.action&&!t.dragging&&(t._updateManipulatorTransform(),t._updateAfterDrag=!1)}))),i}},{key:"_createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=nt.Z.toUnitRGBA(U.O9.main);return t[3]*=e,new ft.E({color:t,transparent:1!==e,cullFace:dt.Vr.Back,renderOccluded:le.yD.Transparent})}},{key:"test",get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map((function(e){return e.manipulator}))}}}]),n}(tt),yt=function(){function e(){(0,a.Z)(this,e),this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}return(0,r.Z)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&(0,c.pC)(this._lastDragEvent)&&(0,c.pC)(this._next)){var t=this._lastDragEvent.mapEnd,n=this._snap(this._lastDragEvent.screenEnd);if((0,c.pC)(n)){var i={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===e?n:t,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(i)}}this._enabled=e}},{key:"_snap",value:function(e){var t=(0,c.pC)(this._view)?this._view.toMap(e,{exclude:[]}):null;return(0,c.pC)(t)&&(0,c.pC)(this._view)&&(t.z=(0,_.Ou)(t,this._view,this._elevationInfo)),t}},{key:"createDragEventPipelineStep",value:function(e,t){var n=this;this._view=e,this._elevationInfo=t,this._lastDragEvent=null;var a=new lt.hM;return this._next=a,[function(e){if(n._lastDragEvent="end"!==e.action?(0,i.Z)({},e):null,n._enabled){var t=n._snap(e.screenEnd);return(0,c.pC)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}},a]}}]),e}(),mt=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this))._snapToScene=new yt,i._discMaterial=i._createMaterial(),i._discMaterialTransparent=i._createMaterial(.5),i._scale=1,i._radius=Qe,i._view=e.view,i._tool=e.tool,null!=e.snapToScene&&(i.snapToScene=e.snapToScene),null!=e.radius&&(i._radius=e.radius),i._createManipulator(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return(0,r.Z)(n,[{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,Ce.TRANSLATE_XY)}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"snapToScene",get:function(){return this._snapToScene.enabled},set:function(e){this._snapToScene.enabled=e}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}},{key:"createGraphicDragPipeline",value:function(e,t,n){var i=this,a=t.graphic,r=(0,_.RL)(a),o=(0,c.Wg)(a.geometry).spatialReference;return ut(t,n,(function(t){return i.createDragPipeline((function(n,i,a,r,o){var s;return i=(s=e(n,i,a,r,o)).steps,a=s.cancel,t(n,i,a)}),r,o,a)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t,n,a){var r=this,o=this._view;return(0,lt.Xd)(this._manipulator,(function(s,l,u,c,p){var h,d=(h=l.next((0,lt.kY)(o,s.elevationAlignedLocation)).next((0,st.G)(o,s.elevationAlignedLocation,t,n,a))).next.apply(h,(0,b.Z)(r._snapToScene.createDragEventPipelineStep(o,t))).next((function(e){return(0,i.Z)((0,i.Z)({},e),{},{manipulatorType:Ce.TRANSLATE_XY})})).next((0,lt.zh)());e(s,d,u,c,p)}))}},{key:"_updateManipulatorTransform",value:function(){var e=(0,it.E)(rt.MP.get(),(0,f.s)(rt.WM.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}},{key:"_createManipulator",value:function(){var e=this._view;this._manipulator=new De.Z({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,g.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}},{key:"_updateManipulator",value:function(){var e=(0,vt.nb)(this._discMaterial,.02,1,128,(0,g.f)(0,0,1),(0,g.f)(0,0,0));e.transformation=(0,it.E)((0,at.c)(),(0,g.f)(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new ot.r(e,gt.Q9.Focused),new ot.r(e.instantiate({material:this._discMaterialTransparent}),gt.Q9.Unfocused)],this._manipulator.radius=this._radius/Qe*80}},{key:"_createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=nt.Z.toUnitRGBA(U.O9.main);return t[3]*=e,new ft.E({color:t,transparent:1!==e,cullFace:dt.Vr.Back,renderOccluded:le.yD.Transparent})}},{key:"test",get:function(){return{discManipulator:this._manipulator}}}]),n}(tt),Mt=n(86950),bt=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this))._radius=Qe,i.events=new J.Z,i._tool=e.tool,i._view=e.view,null!=e.radius&&(i._radius=e.radius),i._createManipulator(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return(0,r.Z)(n,[{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()}))}},{key:"forEachManipulator",value:function(e){e(this._manipulator,Ce.TRANSLATE_Z)}},{key:"createGraphicDragPipeline",value:function(e,t,n){var i=this,a=(0,c.Wg)(t.graphic.geometry).spatialReference;return ut(t,n,(function(t){return i.createDragPipeline((function(n,i,a,r,o){var s;return i=(s=e(n,i,a,r,o)).steps,a=s.cancel,t(n,i,a)}),a)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t){var n=this._view;return(0,lt.Xd)(this._manipulator,(function(a,r,o,s,l){var u=r.next((function(e){return(0,i.Z)((0,i.Z)({},e),{},{manipulatorType:Ce.TRANSLATE_Z})})).next((0,st.Sp)(n,a.renderLocation,t)).next((0,lt.zh)());e(a,u,o,s,l)}))}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}},{key:"_updateManipulator",value:function(){var e=this._radius/Qe,t=U.Xd.zManipulator.height*e,n=U.Xd.zManipulator.coneHeight*e,i=U.Xd.zManipulator.coneWidth*e,a=U.Xd.zManipulator.width*e,r=[(0,g.f)(0,0,0),(0,g.f)(0,0,t)],o=[(0,g.f)(0,0,0),(0,g.f)(0,0,t+n)],s=function(e){var n=(0,at.c)();if((0,it.w)(n,n,[0,0,t]),(0,it.r)(n,n,Math.PI/2),e){var a=1+2*e/i;(0,it.k)(n,n,[a,a,a])}return n}(0),l=function(e,t){var n=(0,Mt._j)(U.Xd.zManipulator.color,t);return[n.r/255,n.g/255,n.b/255,U.Xd.zManipulator.color.a*e]},u=(0,Ze.EA)(l(1,.25),le.yD.Occlude),c=(0,Ze.EA)(l(1,0),le.yD.Occlude),p=(0,Ze.EA)(l(.7,0),U.Xd.zManipulator.renderOccluded),h=(0,Ze.EA)(l(.85,0),U.Xd.zManipulator.renderOccluded),d=(0,vt.PD)(u,r,a/2,16,!1),v=(0,vt.QL)(u,n,i/2,16,!1);v.transformation=s,this._manipulator.renderObjects=[new ot.r(v,gt.Q9.Unfocused),new ot.r(d,gt.Q9.Unfocused),new ot.r(v.instantiate({material:c}),gt.Q9.Focused),new ot.r(d.instantiate({material:c}),gt.Q9.Focused),new ot.r(v.instantiate({material:p}),gt.Q9.Unfocused),new ot.r(d.instantiate({material:p}),gt.Q9.Unfocused),new ot.r(v.instantiate({material:h}),gt.Q9.Focused),new ot.r(d.instantiate({material:h}),gt.Q9.Focused)],this._manipulator.radius=a/2+2,this._manipulator.collisionType={type:"line",paths:[o]}}},{key:"_createManipulator",value:function(){var e=this,t=new De.Z({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=function(t){var n=e._view.state.camera,i=St;e._view.renderCoordsHelper.toRenderCoords(e._manipulator.elevationAlignedLocation,i);var a=(0,f.j)(n.eye,i),r=n.computeRenderPixelSizeAtDist(a),o=(0,f.b)(wt,i,n.eye);(0,f.n)(o,o);var s=Ct;e._view.renderCoordsHelper.worldUpAtPosition(St,s);var l=Math.abs((0,f.e)(o,s)),u=(0,f.f)(wt,o,s),c=(0,f.f)(wt,u,s),p=(0,Ge.uZ)(l,.01,1),h=1-Math.sqrt(1-p*p)/p/n.fullWidth,d=e._radius/Qe,v=U.Xd.zManipulator.width*d;(0,f.g)(c,(0,f.n)(c,c),(1/h-1)*a+r*v),t[12]-=wt[0],t[13]-=wt[1],t[14]-=wt[2]},this._manipulator=t,this._updateManipulator()}},{key:"test",get:function(){return{manipulator:this._manipulator}}}]),n}(tt),St=(0,g.c)(),wt=(0,g.c)(),Ct=(0,g.c)(),xt=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;(0,a.Z)(this,n),(i=t.call(this))._handles=new et.Z,i._interactive=!0;var r=e.tool,o=e.view,s=e.snapToScene,l=e.radius;return i._view=o,i.xyManipulation=new mt({tool:r,view:o,snapToScene:s,radius:l}),i.xyAxisManipulation=new _t({tool:r,view:o,radius:l}),i.zManipulation=new bt({tool:r,view:o,radius:l}),i.xyManipulation.available=e.xyAvailable,i.xyAxisManipulation.available=e.xyAxisAvailable,i.zManipulation.available=e.zAvailable,i._autoHideXYAxis(),i.forEachManipulator((function(e){return i._handles.add(e.events.on("grab-changed",(function(){return i._updateManipulatorInteractivity()})))})),i}return(0,r.Z)(n,[{key:"destroy",value:function(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}},{key:"createGraphicDragPipeline",value:function(e,t,n){return(0,u.AL)([this.xyManipulation.createGraphicDragPipeline((function(t,n,i,a,r){return e(ht.XY,t,n,i,a,r)}),t,n),this.xyAxisManipulation.createGraphicDragPipeline((function(t,n,i,a,r){return e(ht.XY_AXIS,t,n,i,a,r)}),t,n),this.zManipulation.createGraphicDragPipeline((function(t,n,i,a,r){return e(ht.Z,t,n,i,a,r)}),t,n)])}},{key:"createDragPipeline",value:function(e,t,n,i){return(0,u.AL)([this.xyManipulation.createDragPipeline((function(t,n,i,a,r){return e(ht.XY,t,n,i,a,r)}),t,n,i),this.xyAxisManipulation.createDragPipeline((function(t,n,i,a,r){return e(ht.XY_AXIS,t,n,i,a,r)}),t,n,i),this.zManipulation.createDragPipeline((function(t,n,i,a,r){return e(ht.Z,t,n,i,a,r)}),n)])}},{key:"snapToScene",set:function(e){this.xyManipulation.snapToScene=e}},{key:"angle",set:function(e){this.xyAxisManipulation.angle=e}},{key:"interactive",set:function(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}},{key:"radius",set:function(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}},{key:"displayScale",set:function(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}},{key:"forEachManipulator",value:function(e){this.xyManipulation.forEachManipulator((function(t){return e(t,Ce.TRANSLATE_XY)})),this.xyAxisManipulation.forEachManipulator((function(t){return e(t,Ce.TRANSLATE_XY)})),this.zManipulation.forEachManipulator((function(t){return e(t,Ce.TRANSLATE_Z)}))}},{key:"_xyAxisVisible",get:function(){var e=this.xyManipulation.someManipulator((function(e){return e.focused}))||this.xyAxisManipulation.someManipulator((function(e){return e.focused}));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}},{key:"_autoHideXYAxis",value:function(){var e=this,t=this.xyAxisManipulation,n=this.xyManipulation;if(!(0,M.Z)("esri-mobile")){var i=[];n.forEachManipulator((function(e){return i.push(e)})),t.forEachManipulator((function(e){return i.push(e)}));for(var a=function(){var n=[];e._xyAxisVisible||t.forEachManipulator((function(e){return n.push(e.disableDisplay())})),e._handles.remove(Et),e._handles.add(n,Et)},r=0,o=i;r<o.length;r++){var s=o[r];this._handles.add(s.events.on("focus-changed",a))}this._view.inputManager&&this._handles.add((0,p.gx)((function(){var t;return null===(t=e._view.inputManager)||void 0===t?void 0:t.latestPointerType}),a)),a()}}},{key:"_updateManipulatorInteractivity",value:function(){var e=this,t=this.grabbing;this.forEachManipulator((function(n){n.interactive=!t&&e._interactive||n.grabbing}))}}],[{key:"radiusForSymbol",value:function(e){var t=(0,c.pC)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((function(e){return"icon"===e.type}))?Je:Qe}}]),n}(tt),Et="disable-xy-axis-display";!function(e){e[e.XY=0]="XY",e[e.XY_AXIS=1]="XY_AXIS",e[e.Z=2]="Z"}(ht||(ht={}));var kt=n(2346),Ot=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this))._view=e.view,i._tool=e.tool,i._graphicState=e.graphicState,i._createManipulator(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return(0,r.Z)(n,[{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,Ce.TRANSLATE_XY)}},{key:"createGraphicDragPipeline",value:function(e){var t=this;return ut(this._graphicState,e,(function(e){return t.createDragPipeline(e)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e){var t=this._view,n=this._graphicState.graphic,i=(0,c.pC)(n.geometry)?n.geometry.spatialReference:null;return(0,lt.Xd)(this._manipulator,(function(a,r,o,s,l){var u=r.next((0,st._y)(l,t,n,i)).next((0,lt.AN)()).next((0,lt.zh)());e(a,u,o,s,l)}))}},{key:"_createManipulator",value:function(){var e=this._view,t=this._graphicState.graphic;this._manipulator=new kt.L({graphic:t,view:e,selectable:!0,cursor:"move"})}}]),n}(tt),At=n(57889),Zt=n(29919),Tt=n(87268),Rt=n(77560),Gt=n(34019),Dt=n(80151),Pt=n(12494),It=n(40524),Lt=n(4914),Vt=(0,r.Z)((function e(t){(0,a.Z)(this,e),this.allGraphics=t,this.type="graphic-move-start"})),zt=(0,r.Z)((function e(t,n,i){(0,a.Z)(this,e),this.dx=t,this.dy=n,this.allGraphics=i,this.type="graphic-move"})),Wt=(0,r.Z)((function e(t){(0,a.Z)(this,e),this.allGraphics=t,this.type="graphic-move-stop"})),Xt=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).graphics=new ke.Z,i.enableZ=!0,i.tooltipOptions=new Rt.Z,i.type="move-3d",i._tooltip=null,i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.graphics,n=this.view;this.addHandles([t.on("change",(function(){return e._refreshManipulators()})),(0,p.YP)((function(){return e.tooltipOptions.enabled}),(function(t){e._tooltip=t?new Pt.u({view:n}):(0,c.SC)(e._tooltip)}),p.tX)]),this._refreshManipulators(),this.finishToolCreation()}},{key:"destroy",value:function(){this._tooltip=(0,c.SC)(this._tooltip),this._moveManipulation=(0,c.SC)(this._moveManipulation),this.graphics.removeAll(),this._set("view",null)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"reset",value:function(){}},{key:"_refreshManipulators",value:function(){var e,t=this;this.handles.removeAll(),null!==(e=this._moveManipulation)&&void 0!==e&&e.destroy(),this.manipulators.removeAll();var n=this.graphics.toArray().filter((function(e){return(0,At.P)(e)===Te.e.SUPPORTED})).map((function(e){return new Yt(e)}));n.length&&(this._createManipulators(n),this._createVisualElements(n),this.handles.add(n.map((function(e){return t.view.trackGraphicState(e.state)}))),this._updateMoveManipulation(n))}},{key:"_createManipulators",value:function(e){var t,n=this,a=(0,j.Z)(e);try{var r=function(){var a=t.value,r=a.state;a.manipulationXY=new Ot({tool:n,view:n.view,graphicState:r}),a.manipulationXY.forEachManipulator((function(e){return n.handles.add([e.events.on("immediate-click",(function(e){n.emit("immediate-click",(0,i.Z)((0,i.Z)({},e),{},{graphic:r.graphic})),e.stopPropagation()})),e.events.on("grab-changed",(function(e){var t=e.action,i=n.tooltipOptions,a=n._tooltip;(0,c.Wi)(a)||("start"===t?a.info=new It.$E({tooltipOptions:i}):a.clear())}))])})),n.handles.add(a.manipulationXY.createDragPipeline((function(t,i,a,r){return n._buildDragEventPipeline(e,ht.XY,t,i,a,r)})))};for(a.s();!(t=a.n()).done;)r()}catch(o){a.e(o)}finally{a.f()}this._createMoveManipulation(e)}},{key:"_createMoveManipulation",value:function(e){var t=this,n=new xt({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?xt.radiusForSymbol(e[0].graphic.symbol):Qe});this._moveManipulation=n,n.elevationInfo={mode:"absolute-height",offset:0},n.forEachManipulator((function(e){t.handles.add(e.events.on("immediate-click",(function(a){n.zManipulation.hasManipulator(e)||1!==t.graphics.length||t.emit("immediate-click",(0,i.Z)((0,i.Z)({},a),{},{graphic:t.graphics.getItemAt(0)})),a.stopPropagation()})))}));var a=function(n){return function(i){t.handles.add(i.events.on("focus-changed",(function(i){var a=i.action,r=t._tooltip;(0,c.Wi)(r)||("focus"===a?t._updateMoveTooltip(e,n):r.clear())})))}};this._moveManipulation.xyManipulation.forEachManipulator(a(ht.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(a(ht.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(a(ht.Z));var r,o=function(){return t._updateMoveManipulation(e)},s=(0,j.Z)(e);try{var l=function(){var e=r.value;t.handles.add([e.state.on("changed",o),(0,p.YP)((function(){return e.state.displaying}),o)])};for(s.s();!(r=s.n()).done;)l()}catch(h){s.e(h)}finally{s.f()}var u=e[e.length-1];this.handles.add(u.state.on("changed",(function(){return t._updateMoveManipulationAngle(u)}))),this.handles.add(n.createDragPipeline((function(n,i,a,r,o){return t._buildDragEventPipeline(e,n,i,a,r,o)}),(0,_.RL)(u.graphic),(0,c.Wg)(u.graphic.geometry).spatialReference,u.graphic)),this._updateMoveManipulationAngle(u)}},{key:"_createVisualElements",value:function(e){var t,n=this,i=(0,j.Z)(e);try{var a=function(){var i=t.value,a=i.graphic,r=je({view:n.view,graphic:a,forEachManipulator:function(e){var t;null!==(t=i.manipulationXY)&&void 0!==t&&t.forEachManipulator(e),n._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:function(){return(0,u.kB)()}});(0,c.Wi)(r)||(i.geometryRepresentation=r.visualElement,i.geometryRepresentation instanceof he&&n.handles.add([i.geometryRepresentation.events.on("attachment-origin-changed",(function(){i.state.isDraped||n._updateMoveManipulation(e)})),(0,p.YP)((function(){return i.state.isDraped}),(function(){return n._updateMoveManipulation(e)}))]),n.handles.add(r))};for(i.s();!(t=i.n()).done;)a()}catch(r){i.e(r)}finally{i.f()}}},{key:"_updateMoveManipulationAngle",value:function(e){this._moveManipulation.angle=ct(e.graphic.geometry)}},{key:"_updateMoveManipulation",value:function(e){var t,n,i=(0,te.Tx)(0,0,0,this.view.spatialReference),a=0,r=!1,o=this._moveManipulation,s=(0,j.Z)(e);try{for(s.s();!(n=s.n()).done;){var l=n.value;if(l.state.displaying){var u=l.state.graphic;this.enableZ&&(0,Re.c)(u)&&(r=!0);var p=l.geometryRepresentation instanceof he&&!l.state.isDraped?l.geometryRepresentation.attachmentOrigin:(0,Ze.du)(this.view,u);if((0,c.pC)(p)){var h,d=p.x,v=p.y,f=p.z;i.x+=d,i.y+=v,f&&(null!==(h=i.z)&&void 0!==h||(i.z=0),i.z+=f),a++}}}}catch(g){s.e(g)}finally{s.f()}a>0?(i.x/=a,i.y/=a,null!==(t=i.z)&&void 0!==t||(i.z=0),i.z/=a,o.location=i,o.xyManipulation.available=!0,o.xyAxisManipulation.available=!0,o.zManipulation.available=r):o.available=!1}},{key:"_buildDragEventPipeline",value:function(e,t,n,i,a,r){var o=this,s=[],l=[],u=null,c=null,p=function(){var e,t=(0,j.Z)(s);try{for(t.s();!(e=t.n()).done;){e.value.dragging=!1}}catch(n){t.e(n)}finally{t.f()}s.length=0,l.length=0,u=null,c=null,o._moveManipulation.interactive=!0};if(1===e.length&&t===ht.XY){var h=e[0].graphic,d=this._buildSnappingPipelineSteps(h,(0,_.RL)(h),i,a,r);i=d.steps,a=d.cancel}return a=a.next((function(e){var t;return null===(t=c)||void 0===t?void 0:t(e)})).next((function(){return o.emit("graphic-move-stop",new Wt(l)),o.destroyed||p(),null})),{steps:i=i.next((function(t){if("start"===t.action){s.length=0,l.length=0;var i,a=(0,j.Z)(e);try{for(a.s();!(i=a.n()).done;){var r,p,h=i.value;h.dragging||(null===(r=h.manipulationXY)||void 0===r||!r.hasManipulator(n))&&(null===(p=h.manipulationXY)||void 0===p?void 0:p.grabbing)||(s.push(h),l.push(h.graphic),h.dragging=!0)}}catch(d){a.e(d)}finally{a.f()}if(0!==l.length&&(o._moveManipulation.interactive=!1,u=(0,lt.oq)(l,o.view.state.viewingMode),c=(0,lt.QY)(l),o.emit("graphic-move-start",new Vt(l)),o.destroyed))return null}return 0!==l.length?t:null})).next((function(e){var t;return null===(t=u)||void 0===t?void 0:t(e)})).next((function(n){return o._updateMoveTooltip(e,t,n),n})).next((function(e){switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){var t=o.view.toScreen(e.mapStart),n=o.view.toScreen(e.mapEnd),i=n.x-t.x,a=n.y-t.y;if(o.emit("graphic-move",new zt(i,a,l)),o.destroyed)return null}break;case"end":if(o.emit("graphic-move-stop",new Wt(l)),o.destroyed)return null;p()}return null})),cancel:a}}},{key:"_updateMoveTooltip",value:function(e,t,n){var i=this.tooltipOptions,a=this._tooltip;if(!(0,c.Wi)(a)){a.clear();var r=0===e.length?"absolute-height":e[0].state.isDraped?"on-the-ground":"absolute-height";switch(t){case ht.XY:a.info=new It.$E({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,n,(function(e,t){return(0,D.GQ)(e,t,r)}));break;case ht.XY_AXIS:a.info=new It.in({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,n,(function(e,t){var i=(0,D.GQ)(e,t,r);return(0,Ae.bA)(i,pt(n))}));break;case ht.Z:a.info=new It.QW({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,n,Lt._e)}}}},{key:"_updateMoveTooltipDistance",value:function(e,t,n){if((0,c.pC)(t)&&"end"!==t.action){var i=n(t.mapStart,t.mapEnd);e.distance=(0,c.pC)(i)?i:Ae.yP}}},{key:"_buildSnappingPipelineSteps",value:function(e,t,n,a,r){var o,s=this,l=e.geometry;if((0,c.Wi)(l)||"point"!==l.type&&"mesh"!==l.type)return{steps:n,cancel:a};var u=("point"===l.type?l:l.anchor).clone(),p=new Gt.N({elevationInfo:t,pointer:r,editGeometryOperations:Tt.c.fromGeometry(u,this.view.state.viewingMode),visualizer:new N._,excludeFeature:e}),h=this.snappingManager,d=(0,Dt.W)({snappingContext:p,snappingManager:h,updatingHandles:this.updatingHandles}),v=d.snappingStep,f=d.cancelSnapping;return a=a.next(f),{steps:n=(o=n.next((function(t){return u.z=(0,_.vQ)(s.view,u,(0,_.RL)(e),{mode:"absolute-height",offset:0}),(0,i.Z)((0,i.Z)({},t),{},{snapOrigin:p.coordinateHelper.pointToVector(u)})}))).next.apply(o,(0,b.Z)(v)),cancel:a}}},{key:"test",get:function(){return{tooltip:this._tooltip}}}]),n}((0,Oe.p)(J.Z.EventedMixin(Zt.m)));(0,l._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],Xt.prototype,"view",void 0),(0,l._)([(0,h.Cb)()],Xt.prototype,"graphics",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],Xt.prototype,"enableZ",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,type:Rt.Z})],Xt.prototype,"tooltipOptions",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],Xt.prototype,"snappingManager",void 0),(0,l._)([(0,h.Cb)()],Xt.prototype,"type",void 0),(0,l._)([(0,h.Cb)()],Xt.prototype,"updating",null),Xt=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Xt);var Yt=function(){function e(t){(0,a.Z)(this,e),this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new ye({graphic:t})}return(0,r.Z)(e,[{key:"graphic",get:function(){return this.state.graphic}}]),e}(),Ht=n(46684),Nt=(n(59486),n(68860)),Ut=n(29909),Ft=n(55652),jt=n(74579),Bt=n(3711);function Qt(e,t,n){var i="on-the-ground"===n.mode?Bt.v.XY:Bt.v.XYZ;return new Bt.A(e,i,t,0)}function Jt(e,t,n){var i=(0,g.c)();if(!e.renderCoordsHelper.toRenderCoords(t,i))return null;var a=qt(e,t,(0,Ft.mJ)(n.plane)),r=qt(e,t,n.edgeDirection);if((0,c.Wi)(a)||(0,c.Wi)(r))return null;var o=(0,f.f)((0,g.c)(),a,r);return(0,Ft.Yq)(i,o,(0,Ft.Ue)())}function qt(e,t,n){var i=(0,te.Tx)(t.x+n[0],t.y+n[1],t.z+n[2],t.spatialReference),a=(0,g.c)(),r=(0,g.c)();return e.renderCoordsHelper.toRenderCoords(t,a)&&e.renderCoordsHelper.toRenderCoords(i,r)?(0,f.r)(r,a,r):null}var $t=n(63920),Kt=n(153),en=n(4943),tn=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="reshape-edge-offset",i.distance=Ae.yP,i.area=null,i.totalLength=null,i}return(0,r.Z)(n)}(en.h);(0,l._)([(0,h.Cb)()],tn.prototype,"type",void 0),(0,l._)([(0,h.Cb)()],tn.prototype,"distance",void 0),(0,l._)([(0,h.Cb)()],tn.prototype,"area",void 0),(0,l._)([(0,h.Cb)()],tn.prototype,"totalLength",void 0),tn=(0,l._)([(0,v.j)("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],tn);var nn=n(21971),an=n(13615),rn=n(78952),on=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e))._vertexManipulatorMaterial=(0,Ze.EA)(U.Xd.colorToVec4(U.Xd.reshapeManipulators.vertex.color),U.Xd.reshapeManipulators.vertex.renderOccluded),i._vertexManipulatorOutlineMaterial=(0,Ze.qJ)(U.Xd.colorToVec4(U.Xd.reshapeManipulators.vertex.outlineColor),U.Xd.reshapeManipulators.vertex.renderOccluded),i._vertexManipulatorHoverOutlineMaterial=(0,Ze.qJ)(U.Xd.colorToVec4(U.Xd.reshapeManipulators.vertex.hoverOutlineColor),U.Xd.reshapeManipulators.vertex.renderOccluded),i._edgeManipulatorMaterial=(0,Ze.EA)(U.Xd.colorToVec4(U.Xd.reshapeManipulators.edge.color),U.Xd.reshapeManipulators.edge.renderOccluded),i._edgeManipulatorOutlineMaterial=(0,Ze.qJ)(U.Xd.colorToVec4(U.Xd.reshapeManipulators.edge.outlineColor),U.Xd.reshapeManipulators.edge.renderOccluded),i._edgeOffsetManipulatorMaterial=(0,Ze.EA)(U.Xd.colorToVec4(U.Xd.reshapeManipulators.edgeOffset.color),U.Xd.reshapeManipulators.edgeOffset.renderOccluded,!1),i._edgeOffsetManipulatorHoverMaterial=(0,Ze.EA)(U.Xd.colorToVec4(U.Xd.reshapeManipulators.edgeOffset.hoverColor),U.Xd.reshapeManipulators.edgeOffset.renderOccluded,!1),i._selectedManipulatorMaterial=(0,Ze.EA)(U.Xd.colorToVec4(U.Xd.reshapeManipulators.selected.color),U.Xd.reshapeManipulators.selected.renderOccluded),i._selectedManipulatorOutlineMaterial=(0,Ze.qJ)(U.Xd.colorToVec4(U.Xd.reshapeManipulators.selected.outlineColor),U.Xd.reshapeManipulators.selected.renderOccluded),i._selectedManipulatorHoverOutlineMaterial=(0,Ze.qJ)(U.Xd.colorToVec4(U.Xd.reshapeManipulators.selected.hoverOutlineColor),U.Xd.reshapeManipulators.selected.renderOccluded),i._selectedIndex=0,i._manipulatorHandles=new et.Z,i._manipulatorInfos=[],i._numGrabbing=0,i._numDragging=0,i._reshapeEventState=un.NONE,i._recreatingManipulators=!1,i.outputGeometry=null,i._vertexLaserLineVisualElement=null,i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.graphic,n=this.view,i=this._graphicState=new ye({graphic:t});this._tooltip=new Pt.u({view:n}),this.addHandles([(0,p.YP)((function(){return i.displaying}),(function(t){var n,i=(0,j.Z)(e._manipulatorInfos);try{for(i.s();!(n=i.n()).done;){n.value.manipulator.available=t}}catch(a){i.e(a)}finally{i.f()}})),(0,p.YP)((function(){return{labels:e._segmentLabels,enabled:e._labelOptions.enabled,edgeOffsetEnabled:e.enableEdgeOffset}}),(function(e){var t=e.labels,n=e.enabled,i=e.edgeOffsetEnabled;(0,c.pC)(t)&&(t.visible=n,t.edgeDistance=i?"far":"default")}),p.nn),(0,p.gx)((function(){return!e._tooltipOptions.enabled}),(function(){return e._tooltip.clear()}),p.nn),this.view.trackGraphicState(i)])}},{key:"destroy",value:function(){this._segmentLabels=(0,c.SC)(this._segmentLabels),this._tooltip=(0,c.SC)(this._tooltip),this._removeManipulators()}},{key:"inputGeometry",get:function(){return(0,c.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null},set:function(e){this._recreateEditGeometryAndManipulators(e)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"manipulators",get:function(){return this.tool.manipulators}},{key:"view",get:function(){return this.tool.view}},{key:"graphic",get:function(){return this.tool.graphic}},{key:"enableZShape",get:function(){return this.tool.enableZShape}},{key:"enableZVertex",get:function(){return this.tool.enableZVertex}},{key:"enableMoveGraphic",get:function(){return this.tool.enableMoveGraphic}},{key:"enableMidpoints",get:function(){return this.tool.enableMidpoints}},{key:"enableEdgeOffset",get:function(){return this.tool.enableEdgeOffset}},{key:"_labelOptions",get:function(){return this.tool.labelOptions}},{key:"_tooltipOptions",get:function(){return this.tool.tooltipOptions}},{key:"removeSelectedVertices",value:function(){var e=this._manipulatorInfos.filter((function(e){return e.manipulator.selected&&"vertex"===e.type}));this._removeVertices(e)}},{key:"onManipulatorSelectionChanged",value:function(){this.emit("manipulators-changed")}},{key:"_removeManipulators",value:function(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,c.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,c.SC)(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}},{key:"_createManipulators",value:function(e){if(!(0,c.Wi)(this._editGeometryOperations)){var t,n=(0,_.RL)(this.graphic),i=(0,j.Z)(this._editGeometryOperations.data.components);try{for(i.s();!(t=i.n()).done;){var a,r=t.value,o=null===e||void 0===e?void 0:e.byComponentIndex.get(r.index),s=(0,j.Z)(r.vertices);try{for(s.s();!(a=s.n()).done;){var l=a.value,u=null===o||void 0===o?void 0:o.has(l.index);this._createVertexOrEdgeManipulator(l,n,u)}}catch(v){s.e(v)}finally{s.f()}var p,h=(0,j.Z)(r.edges);try{for(h.s();!(p=h.n()).done;){var d=p.value;this._createVertexOrEdgeManipulator(d,n)}}catch(v){h.e(v)}finally{h.f()}}}catch(v){i.e(v)}finally{i.f()}this._createGraphicMoveManipulation(),this._createMoveManipulation(n),this._createVisualElements()}}},{key:"canRedo",get:function(){return(0,c.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}},{key:"canUndo",get:function(){return(0,c.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}},{key:"redo",value:function(){if((0,c.Wi)(this._editGeometryOperations))return null;var e=this._editGeometryOperations.redo();return(0,c.pC)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}},{key:"undo",value:function(){if((0,c.Wi)(this._editGeometryOperations))return null;this.emit("undo");var e=this._editGeometryOperations.undo();return(0,c.pC)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}},{key:"_recreateManipulators",value:function(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._createManipulators(),this._recreatingManipulators=!1)}},{key:"_recreateEditGeometryAndManipulators",value:function(e){var t={byComponentIndex:new Map};if((0,c.pC)(e)&&(0,c.pC)(this.inputGeometry)&&(0,Z.Pt)(e,this.inputGeometry)){var n,i=(0,j.Z)(this._manipulatorInfos);try{for(i.s();!(n=i.n()).done;){var a=n.value;if("vertex"===a.type&&a.manipulator.selected){var r=a.handle,o=r.index,s=r.component.index,l=t.byComponentIndex,u=l.get(s)||new Set;u.add(o),l.set(s,u)}}}catch(p){i.e(p)}finally{i.f()}}this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._editGeometryOperations=(0,c.SC)(this._editGeometryOperations),this._segmentLabels=(0,c.SC)(this._segmentLabels),(0,c.Wi)(e)||(this._editGeometryOperations=Tt.c.fromGeometry(e,this.view.state.viewingMode),this._createManipulators(t),this._segmentLabels=new Y({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:(0,_.RL)(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled})),this._recreatingManipulators=!1}},{key:"_perGraphicManipulatorDragAction",value:function(e,t){if("end"===t.action)return t;var n,i=0,a=[],r=this._manipulatorInfos.some((function(e){return"vertex"===e.type&&e.manipulator.selected})),o=e===cn.SELECTED_OR_ALL&&r,s=(0,j.Z)(this._manipulatorInfos);try{for(s.s();!(n=s.n()).done;){var l=n.value;"vertex"===l.type&&(l.manipulator.grabbing||o&&!l.manipulator.selected||a.push(l),i++)}}catch(u){s.e(u)}finally{s.f()}if(0===a.length)return t;if(this._moveVertices(a,t),a.length===i){if(this._updateEventState(un.MOVING),this.destroyed)return t;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(un.RESHAPING),this.destroyed)return t;this.emit("reshape",{type:"reshape",mover:this.graphic})}return t}},{key:"_isMultiVertexSelection",value:function(){return this._manipulatorInfos.reduce((function(e,t){return"vertex"===t.type&&t.manipulator.selected?e+1:e}),0)>1}},{key:"_perVertexManipulatorDragAction",value:function(e){if(this._updateEventState(un.RESHAPING),!this.destroyed){var t=e.mapDeltaX,n=e.mapDeltaY,i=e.mapDeltaZ;if(t||n||i){var a,r=[],o=(0,j.Z)(this._manipulatorInfos);try{for(o.s();!(a=o.n()).done;){var s=a.value;"vertex"===s.type&&(s.manipulator.selected&&!s.manipulator.grabbing||s===e.info)&&r.push(s)}}catch(l){o.e(l)}finally{o.f()}this._moveVertices(r,e,Kt.O.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}}}},{key:"_updateEventState",value:function(e){if(e===this._reshapeEventState)return!1;switch(e){case un.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case un.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case un.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case un.MOVING:switch(this._reshapeEventState){case un.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case un.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case un.RESHAPING:switch(this._reshapeEventState){case un.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case un.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;var t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}},{key:"_createGraphicMoveManipulation",value:function(){var e=this,t=this.tool,n=this.view,a=this._graphicState;if(this._graphicMoveManipulation=new Ot({tool:t,view:n,graphicState:a}),this.enableMoveGraphic){var r=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((function(t,n,i){n.next((function(t){return e._trackNumDragging(t)})).next((function(t){return"start"===t.action&&(r=(0,c.Wg)(e._editGeometryOperations).createUndoGroup()),t})).next((function(t){return e._perGraphicManipulatorDragAction(cn.ALL,t)})).next((function(t){return e._updateTranslateGraphicTooltip(ht.XY,t),t})).next((function(t){"end"===t.action&&(e._tooltip.clear(),r=(0,c.hw)(r))})),i.next((function(){return e._onDragCancel(!0,(function(){return r=(0,c.hw)(r)}))}))}))),this._graphicMoveManipulation.forEachManipulator((function(t){return e._manipulatorHandles.add(e._watchAndUpdateGrabState(t,!1))}))}else this._graphicMoveManipulation.forEachManipulator((function(e){e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((function(t){return e._manipulatorHandles.add(t.events.on("immediate-click",(function(t){e._manipulatorInfos.some((function(e){return e.manipulator.selected}))?e._clearSelection():e.emit("immediate-click",(0,i.Z)((0,i.Z)({},t),{},{graphic:e.graphic})),t.stopPropagation()})))}))}},{key:"_createMoveManipulation",value:function(e){var t=this,n=this.graphic,a=this.handles,r=this.tool,o=this.view,s=this._graphicState;this._moveManipulation=new xt({tool:r,view:o,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&(0,Re.c)(n),snapToScene:!1,radius:xt.radiusForSymbol(n.symbol)}),this._moveManipulation.forEachManipulator((function(e){return a.add([e.events.on("immediate-click",(function(a){t._moveManipulation.zManipulation.hasManipulator(e)||t._manipulatorInfos.some((function(e){return e.manipulator.selected}))||t.emit("immediate-click",(0,i.Z)((0,i.Z)({},a),{},{graphic:n})),a.stopPropagation()})),t._watchAndUpdateGrabState(e,!1)])}));var l=function(e){return function(n){a.add(n.events.on("focus-changed",(function(n){"focus"===n.action&&t._tooltipOptions.enabled?t._updateTranslateTooltip(e):t._tooltip.clear()})))}};this._moveManipulation.xyManipulation.forEachManipulator(l(ht.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(l(ht.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(l(ht.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var u=(0,c.Wg)(n.geometry).spatialReference;a.add([this._moveManipulation.createDragPipeline((function(a,o,s,l,u){var p,h=(0,Dt.W)({predicate:function(e){return!!e.info},snappingManager:r.snappingManager,snappingContext:new Gt.N({editGeometryOperations:(0,c.Wg)(t._editGeometryOperations),elevationInfo:e,pointer:u,excludeFeature:n,visualizer:new N._}),updatingHandles:t.updatingHandles,useZ:!1}),d=h.snappingStep,v=h.cancelSnapping;return l=l.next((function(e){return t._onDragCancel(),e})).next(v),{steps:s=(p=s.next((function(e){return t._trackNumDragging(e)})).next((function(e){var n=t._manipulatorInfos.filter((function(e){return"vertex"===e.type&&e.manipulator.selected}));return e.manipulatorType===Ce.TRANSLATE_XY&&1===n.length?(0,i.Z)((0,i.Z)({},e),{},{info:n[0],snapOrigin:n[0].handle.pos}):e})).next((0,lt.BS)(t.view,e,n))).next.apply(p,(0,b.Z)(d)).next((0,lt.AN)()).next((function(e){return t._perGraphicManipulatorDragAction(cn.SELECTED_OR_ALL,e)})).next((function(e){return t._updateTranslateTooltip(a,e),e})),cancel:l}}),e,u,n),(0,p.YP)((function(){return s.displaying}),(function(){return t._updateMoveManipulationPosition()}),p.nn),s.on("changed",(function(){t._recreatingManipulators||t._updateMoveManipulationPosition()})),(0,p.YP)((function(){return s.isDraped}),(function(e){t._updateMoveManipulationPosition();var n="align-move-manipulation";e?a.add(t.view.elevationProvider.on("elevation-change",(function(){return t._updateMoveManipulationPosition()})),n):a.remove(n)}),p.nn)])}},{key:"_createVisualElements",value:function(){var e=this,t=this.graphic,n=je({view:this.view,graphic:t,forEachManipulator:function(t){if(!e.destroyed&&!e._recreatingManipulators){e._graphicMoveManipulation.forEachManipulator(t),e._moveManipulation.forEachManipulator(t);var n,i=(0,j.Z)(e._manipulatorInfos);try{for(i.s();!(n=i.n()).done;){t(n.value.manipulator,Ce.TRANSLATE_XY)}}catch(a){i.e(a)}finally{i.f()}}},onManipulatorsChanged:function(t){return e.on("manipulators-changed",t)}});(0,c.pC)(n)&&(this._outlineVisualElement=n.visualElement instanceof he?n.visualElement:null),(0,c.pC)(this._outlineVisualElement)&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",(function(){e._graphicState.isDraped||e._updateMoveManipulationPosition()}))),this._manipulatorHandles.add(n)}},{key:"_createEdgeOffsetManipulator",value:function(e){var t,n,a=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_.RL)(this.graphic),o=U.Xd.reshapeManipulators.edgeOffset,s=o.size/2,l=s+o.collisionPadding,p=s/l,h=p*Math.sqrt(3)/2;(0,c.Wi)(this._edgeOffsetManipulatorGeometryInside)&&(this._edgeOffsetManipulatorGeometryInside=(0,vt.DA)(this._edgeOffsetManipulatorMaterial,h,p/2,p/2,o.height,o.offset)),(0,c.Wi)(this._edgeOffsetManipulatorGeometryOutside)&&(this._edgeOffsetManipulatorGeometryOutside=(0,vt.DA)(this._edgeOffsetManipulatorMaterial,-h,p/2,p/2,o.height,-o.offset));var d=[new ot.r(this._edgeOffsetManipulatorGeometryInside.instantiate(),gt.Q9.Unfocused),new ot.r(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),gt.Q9.Focused),new ot.r(this._edgeOffsetManipulatorGeometryOutside.instantiate(),gt.Q9.Unfocused),new ot.r(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),gt.Q9.Focused)],v=new De.Z({view:this.view,renderObjects:d,elevationInfo:"on-the-ground"!==r.mode||(0,jt.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:r,worldOriented:!1,focusMultiplier:1,radius:l,available:!(!this.graphic.visible||null===(t=this.graphic.layer)||void 0===t||!t.visible),collisionType:{type:"disc",direction:(0,g.f)(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),f=new De.Z({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||null===(n=this.graphic.layer)||void 0===n||!n.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),y={manipulator:v,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:f,elevationInfo:r,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(y,o.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(y);for(var m=[],M=0,b=[y.handle.leftVertex,y.handle.rightVertex];M<b.length;M++){var S=b[M],w=this._getManipulatorInfoFromHandle(S);(0,c.pC)(w)&&m.push(w.manipulator.events.on("location-update",(function(){return a._updateEdgeOffsetManipulator(y)})))}y.locationUpdateHandle=(0,u.AL)(m),this._manipulatorHandles.add(y.locationUpdateHandle,v),this._manipulatorHandles.add([this._watchAndUpdateGrabState(v,!0),this._watchAndUpdateGrabState(f,!0)],v),this._manipulatorHandles.add((0,lt.Xd)(v,this._createEdgeOffsetPipeline(y,r)),v),this._manipulatorHandles.add((0,lt.Xd)(f,(function(e,t,n,i){if("touch"===i)a._createEdgeOffsetPipeline(y,r)(e,t,n);else if(a.enableMoveGraphic){var o=a.graphic,s=(0,c.pC)(o.geometry)?o.geometry.spatialReference:null;t.next((function(e){return a._trackNumDragging(e)})).next((0,lt.kY)(a.view,e.elevationAlignedLocation)).next((0,st.G)(a.view,e.elevationAlignedLocation,r,s,o)).next((0,lt.zh)()).next((0,lt.AN)()).next((function(e){return a._perGraphicManipulatorDragAction(cn.ALL,e)})).next((function(e){return a._updateTranslateGraphicTooltip(ht.XY,e),e})).next((function(e){"end"===e.action&&a._tooltip.clear()})),n.next((function(){return a._onDragCancel(!e.metadata.deleting)}))}})),v);var C=function(e){a._manipulatorInfos.some((function(e){return e.manipulator.selected}))?a._clearSelection():a.emit("immediate-click",(0,i.Z)((0,i.Z)({},e),{},{graphic:a.graphic})),e.stopPropagation()};return this._manipulatorHandles.add([v.events.on("immediate-click",C),f.events.on("immediate-click",C),v.events.on("focus-changed",(function(e){var t=e.action,n=a._tooltipOptions;if("focus"===t&&n.enabled){var i=a._tooltip.info=new tn({tooltipOptions:n});a._updateTooltipAreaOrTotalLength(i)}else a._tooltip.clear()}))],v),this._manipulatorInfos.push(y),this.manipulators.add(v),this.manipulators.add(f),this.emit("manipulators-changed"),y}},{key:"_autoHideEdgeOffsetManipulator",value:function(e,t){var n=this,i=e.manipulator,a=e.edgeManipulator,r=function(){e.visibilityHandle=(0,c.hw)(e.visibilityHandle);var r=n._getManipulatorInfoFromHandle(e.handle.leftVertex),o=n._getManipulatorInfoFromHandle(e.handle.rightVertex),s=(0,c.pC)(r)&&(0,c.pC)(o)&&function(e,t,n){var i=n.projectToRenderScreen(e,(0,m.J$)()),a=n.projectToRenderScreen(t,(0,m.J$)());return(0,c.pC)(i)&&(0,c.pC)(a)?(0,f.p)((0,f.b)(i,i,a)):0}(r.manipulator.renderLocation,o.manipulator.renderLocation,n.view.state.camera)<t;(!i.focused&&!a.focused||s)&&(i.grabbable=!s,a.grabbable=!s,e.visibilityHandle=(0,u.AL)([i.disableDisplay(),{remove:function(){i.grabbable=!0,a.grabbable=n.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",r),a.events.on("focus-changed",r),{remove:function(){(0,c.hw)(e.visibilityHandle),a.metadata.deleting=!0,n.manipulators.remove(a)}}],i),r()}},{key:"_updateEdgeOffsetManipulator",value:function(e){this._updateManipulatorPosition(e);var t=(0,c.Wg)(this._editGeometryOperations).data.coordinateHelper,n=Jt(this.view,e.manipulator.elevationAlignedLocation,Qt(t,e.handle,(0,c.Wg)(e.manipulator.elevationInfo))),i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(!(0,c.Wi)(i)&&!(0,c.Wi)(a)){var r=i.manipulator.renderLocation,o=a.manipulator.renderLocation,s=(0,c.pC)(n)?function(e,t,n){var i=(0,Ft.mJ)(e),a=(0,f.r)((0,g.c)(),t,n),r=(0,f.f)((0,g.c)(),a,i),o=(0,f.f)((0,g.c)(),a,r);return(0,at.f)(a[0],a[1],a[2],0,r[0],r[1],r[2],0,o[0],o[1],o[2],0,0,0,0,1)}(n,r,o):at.I;e.manipulator.modelTransform=s,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=s;var l=(0,f.l)((0,f.b)(dn,r,o))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}}},{key:"_createEdgeOffsetPipeline",value:function(e,t){var n=this;return function(i,a,r){n._clearSelection();var o=n._initializeEdgeOffset(e,t),s=o.step,l=o.cleanup;a.next((function(e){return n._trackNumDragging(e)})).next((0,lt.kY)(n.view,i.elevationAlignedLocation)).next(s).next((0,st.bB)(n.view)).next((0,st.zP)(n.view,(0,c.Wg)(n._editGeometryOperations).data.spatialReference)).next((0,lt.AN)()).next(n._applyComputeEdgeOffsetDistanceStep()).next(n._applyEdgeOffsetStep(e)).next(n._showEdgeOffsetTooltip()).next((function(e){"end"===e.action&&l()})),r.next((function(){i.metadata.deleting||(l(),n._onDragCancel())}))}}},{key:"_initializeEdgeOffset",value:function(e,t){var n=this,a=(0,c.Wg)(this._editGeometryOperations),r=Qt(a.data.coordinateHelper,e.handle,t),o=a.createUndoGroup(),s=Jt(this.view,e.manipulator.elevationAlignedLocation,r);if(r.requiresSplitEdgeLeft){var l=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge);(0,c.pC)(l)&&this._splitEdgeManipulator(l,1)}if(r.requiresSplitEdgeRight){var h=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge);(0,c.pC)(h)&&this._splitEdgeManipulator(h,0)}var d,v=function(){return new Ut.Z({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:a.data.spatialReference})},f=new he({view:this.view,isDraped:this._graphicState.isDraped,geometry:v(),elevationInfo:e.elevationInfo,width:U.Xd.visualElements.lineGraphics.outline.width,color:U.Xd.colorToVec4(U.O9.main),attached:!0}),g=function(){n._cleanEdgeOffsetCollapsedEdges(e),d=(0,c.hw)(d)},_=this.on("undo",g);return d=(0,u.AL)([(0,u.ed)(f),(0,p.YP)((function(){return n._graphicState.isDraped}),(function(e){return f.isDraped=e})),this._graphicState.on("changed",(function(){return f.geometry=v()})),o,_]),{step:function(e){return(0,c.Wi)(r)||(0,c.Wi)(s)?(g(),null):(0,i.Z)((0,i.Z)({},e),{},{operation:r,plane:s})},cleanup:g}}},{key:"_applyEdgeOffsetStep",value:function(e){var t=this;return function(n){if(t.destroyed||(0,c.Wi)(n.operation))return n;t._updateEventState(un.RESHAPING);var i=n.mapDeltaX,a=n.mapDeltaY,r=n.mapDeltaZ;return(i||a||r)&&(t._offsetEdge(e,n),t.emit("reshape",{type:"reshape",mover:t.graphic})),n}}},{key:"_applyComputeEdgeOffsetDistanceStep",value:function(){return function(e){var t=e.operation,n=e.mapEnd;return(0,c.Wi)(t)||(0,c.Wi)(n)?e:("start"===e.action&&t.selectArrowFromStartPoint(n),(0,i.Z)((0,i.Z)({},e),{},{signedDistance:t.signedDistanceToPoint(n)}))}}},{key:"_showEdgeOffsetTooltip",value:function(){var e=this;return function(t){var n=t.mapEnd,i=t.signedDistance,a=t.operation,r=e._tooltip,o=e._tooltipOptions;if(!o.enabled||(0,c.Wi)(i))return r.clear(),t;var s=r.info;((0,c.Wi)(s)||"reshape-edge-offset"!==s.type)&&(s=r.info=new tn({tooltipOptions:o}));var l=(0,c.Wg)(e._editGeometryOperations).data.coordinateHelper;return s.distance="end"===t.action?Ae.yP:function(e,t,n,i,a){if(e){var r=a.toXYZ(a.pointToVector(n)),o=(0,Ft.nF)(i,r,rt.WM.get()),s=(0,an.FB)(o,r,a.spatialReference);if((0,c.pC)(s))return(0,Ae.yG)(s.value*Math.sign(t),s.unit)}return(0,Ae.yG)(t*(0,Nt.c9)(n.spatialReference),"meters")}(e._graphicState.isDraped,i*a.selectedArrow,n,a.plane,l),e._updateTooltipAreaOrTotalLength(s),t}}},{key:"_cleanEdgeOffsetCollapsedEdges",value:function(e){var t,n,i=null===(t=e.handle.leftVertex.leftEdge)||void 0===t?void 0:t.leftVertex,a=e.handle.leftVertex,r=null===(n=e.handle.rightVertex.rightEdge)||void 0===n?void 0:n.rightVertex,o=e.handle.rightVertex,s=(0,c.Wg)(this._editGeometryOperations).data.coordinateHelper,l=[];if(i&&s.distance(i.pos,a.pos)<vn){var u=this._getManipulatorInfoFromHandle(a);(0,c.pC)(u)&&l.push(u)}if(s.distance(a.pos,o.pos)<vn||r&&s.distance(r.pos,o.pos)<vn){var p=this._getManipulatorInfoFromHandle(o);(0,c.pC)(p)&&l.push(p)}l.length&&this._removeVertices(l)}},{key:"_computeVertexManipulatorSizeAndOutline",value:function(e){var t=e.size/2,n=t+e.collisionPadding;return{size:t/n,outlineSize:(t+e.outlineSize)/n}}},{key:"_createVertexOrEdgeManipulator",value:function(e){var t,n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_.RL)(this.graphic),r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,a);if(!this.enableMidpoints)return null}if((0,c.Wi)(this._vertexManipulatorGeometry)||(0,c.Wi)(this._vertexManipulatorOutlineGeometry)){var o=this._computeVertexManipulatorSizeAndOutline(U.Xd.reshapeManipulators.vertex),s=o.size,l=o.outlineSize;this._vertexManipulatorGeometry=(0,vt.PI)(this._vertexManipulatorMaterial,s,16,16),this._vertexManipulatorOutlineGeometry=(0,vt.PI)(this._vertexManipulatorOutlineMaterial,l,16,16)}if((0,c.Wi)(this._edgeManipulatorGeometry)||(0,c.Wi)(this._edgeManipulatorOutlineGeometry)){var p=this._computeVertexManipulatorSizeAndOutline(U.Xd.reshapeManipulators.edge),h=p.size,d=p.outlineSize;this._edgeManipulatorGeometry=(0,vt.PI)(this._edgeManipulatorMaterial,h,16,16),this._edgeManipulatorOutlineGeometry=(0,vt.PI)(this._edgeManipulatorOutlineMaterial,d,16,16)}var v=(0,c.pC)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[new ot.r(this._vertexManipulatorGeometry.instantiate(),ln.Vertex|gt.Q9.Unselected),new ot.r(this._vertexManipulatorOutlineGeometry.instantiate(),ln.Vertex|gt.Q9.Unfocused|gt.Q9.Unselected),new ot.r(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),ln.Vertex|gt.Q9.Focused|gt.Q9.Unselected),new ot.r(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),gt.Q9.Selected),new ot.r(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),gt.Q9.Selected|gt.Q9.Unfocused),new ot.r(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),gt.Q9.Selected|gt.Q9.Focused)];this.enableMidpoints&&v.push(new ot.r(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),ln.Edge|gt.Q9.Focused|gt.Q9.Unselected),new ot.r(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),ln.Edge|gt.Q9.Focused|gt.Q9.Unselected),new ot.r(this._edgeManipulatorGeometry.instantiate(),ln.Edge|gt.Q9.Unfocused|gt.Q9.Unselected),new ot.r(this._edgeManipulatorOutlineGeometry.instantiate(),ln.Edge|gt.Q9.Unfocused|gt.Q9.Unselected));var f=new De.Z({view:this.view,renderObjects:v,elevationInfo:a,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||null===(t=this.graphic.layer)||void 0===t||!t.visible),metadata:{deleting:!1}});f.selected=r,this._setTypeSpecificManipulatorSettings(f,e,a);var g="edge"===e.type?{manipulator:f,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:f,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(g),this.manipulators.add(f),this._updateManipulatorPosition(g),"edge"===g.type){for(var y=[],m=0,M=[g.handle.leftVertex,g.handle.rightVertex];m<M.length;m++){var S=M[m],w=this._getManipulatorInfoFromHandle(S);(0,c.pC)(w)&&y.push(w.manipulator.events.on("location-update",(function(){return n._updateManipulatorPosition(g)})))}g.locationUpdateHandle=(0,u.AL)(y),this._manipulatorHandles.add(g.locationUpdateHandle,f)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(f,!0),f);var C=(0,lt.Xd)(f,(function(e,t,r,o){var s,l=null,u=(0,Dt.W)({predicate:function(){return!n._isMultiVertexSelection()},snappingManager:n.tool.snappingManager,snappingContext:new Gt.N({editGeometryOperations:(0,c.Wg)(n._editGeometryOperations),elevationInfo:a,pointer:o,excludeFeature:n.graphic,visualizer:new N._}),updatingHandles:n.updatingHandles,useZ:!1}),p=u.snappingStep,h=u.cancelSnapping;r=r.next((function(t){return n._onDragCancel(!e.metadata.deleting,(function(){return l=(0,c.hw)(l)})),t})).next(h),(s=t.next((function(e){return n._trackNumDragging(e)})).next((function(e){if("start"===e.action&&(l=(0,c.Wg)(n._editGeometryOperations).createUndoGroup()),"edge"===g.type){var t=n._splitEdgeManipulator(g);return(0,i.Z)((0,i.Z)({},e),{},{info:t,snapOrigin:t.handle.pos})}return(0,i.Z)((0,i.Z)({},e),{},{info:g,snapOrigin:g.handle.pos})})).next((0,lt.kY)(n.view,e.elevationAlignedLocation)).next((0,st.VG)(n.view,n.graphic,e.elevationAlignedLocation,e.location.spatialReference,n.graphic)).next((0,lt.BS)(n.view,a,n.graphic))).next.apply(s,(0,b.Z)(p)).next((0,lt.AN)()).next((function(t){n._perVertexManipulatorDragAction(t),"end"===t.action&&(l=(0,c.hw)(l)),n._updateTranslateVertexTooltip(e,ht.XY,t)}))}));return this._manipulatorHandles.add([C,f.events.on("immediate-click",(function(e){return n._manipulatorClickCallback(e,g)})),f.events.on("select-changed",(function(){g.selectedIndex=++n._selectedIndex,n._updateMoveManipulationPosition()})),f.events.on("focus-changed",(function(e){"focus"===e.action&&"edge"!==g.type?n._updateTranslateVertexTooltip(f,ht.XY):n._tooltip.clear()}))],f),this.emit("manipulators-changed"),g}},{key:"_trackNumDragging",value:function(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}},{key:"_onDragCancel",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(this._numDragging--,e&&(this.undo(),this.outputGeometry=(0,c.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null),(0,c.pC)(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case un.NONE:break;case un.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case un.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}t&&t(),this.destroyed||this._updateEventState(un.NONE)}},{key:"_setTypeSpecificManipulatorSettings",value:function(e,t,n){switch(t.type){case"vertex":e.state=ln.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=U.Xd.reshapeManipulators.vertex.size/2+U.Xd.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=n,e.interactive=(0,c.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=ln.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=U.Xd.reshapeManipulators.edge.size/2+U.Xd.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==n.mode||(0,jt.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:n}}},{key:"_watchAndUpdateGrabState",value:function(e,t){var n=this;return e.events.on("grab-changed",(function(i){return n._onGrabStateChanged(e,t,i.action,i.pointerType)}))}},{key:"_onGrabStateChanged",value:function(e,t,n){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";if(!this._recreatingManipulators){if("start"===n)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(un.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==a||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((function(e){e.manipulator.interactive=e.manipulator.grabbing||!i._numGrabbing&&(0,c.pC)(i.graphic.geometry)&&"point"!==i.graphic.geometry.type,"edgeManipulator"in e&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!i._numGrabbing)})),this._graphicMoveManipulation.forEachManipulator((function(e){e.interactive=e.grabbing||!i._numGrabbing})))}}},{key:"_clearSelection",value:function(){var e,t=(0,j.Z)(this._manipulatorInfos);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.manipulator.grabbing||(n.manipulator.selected=!1)}}catch(i){t.e(i)}finally{t.f()}}},{key:"_updateSelection",value:function(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}},{key:"_removeManipulator",value:function(e){(0,c.Wi)(e)||(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),(0,d.e$)(this._manipulatorInfos,e),this.emit("manipulators-changed"))}},{key:"_getManipulatorInfoFromHandle",value:function(e){if(e){var t,n=(0,j.Z)(this._manipulatorInfos);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(e===i.handle)return i}}catch(a){n.e(a)}finally{n.f()}}return null}},{key:"_updateManipulatorPosition",value:function(e){if(!(0,c.Wi)(e)){var t=(0,c.Wg)(this._editGeometryOperations);if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,hn),e.manipulator.grabbing&&(0,c.pC)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){var n=this._getManipulatorInfoFromHandle(e.handle.leftVertex),i=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if((0,c.Wi)(n)||(0,c.Wi)(i))return;var a=n.manipulator,r=i.manipulator;if((0,c.pC)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){var o=a.location,s=r.location,l=o.x+.5*(s.x-o.x),u=o.y+.5*(s.y-o.y),p=o.hasZ&&s.hasZ?0:void 0;e.manipulator.location=(0,te.Tx)(l,u,p,t.data.spatialReference)}else(0,f.h)(dn,a.renderLocation,r.renderLocation,.5),e.manipulator.renderLocation=dn}}}},{key:"_splitEdgeManipulator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=(0,c.Wg)(this._editGeometryOperations),i=(0,c.Wg)(n.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle=(0,c.hw)(e.locationUpdateHandle);var a,r=(0,_.RL)(this.graphic);this.enableEdgeOffset?(this._removeManipulator(e),a=this._createVertexOrEdgeManipulator(i)):((a=e).handle=i,a.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,r)),i.leftEdge&&this._createVertexOrEdgeManipulator(i.leftEdge),i.rightEdge&&this._createVertexOrEdgeManipulator(i.rightEdge),this.outputGeometry=n.data.geometry,this._updateManipulatorPosition(a),this.enableEdgeOffset||this._updateTranslateVertexTooltip(a.manipulator,ht.XY),this._updateSelection(e.manipulator);var o=this._updateEventState(un.RESHAPING),s=n.data.coordinateHelper.vectorToArray(a.handle.pos),l=n.data.components.indexOf(i.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:s,componentIndex:l,vertexIndex:(0,c.Wg)(i.index)}],added:s}),o&&this._updateEventState(un.NONE),a}},{key:"_updateMoveManipulationPosition",value:function(){var e,t=(0,f.s)(dn,0,0,0),n=0,i=!1,a=null,r=null,o=(0,j.Z)(this._manipulatorInfos);try{for(o.s();!(e=o.n()).done;){var s=e.value;"vertex"===s.type&&(s.manipulator.selected?(n++,(0,f.a)(t,t,s.manipulator.renderLocation),(0,c.Wi)(a)||s.selectedIndex>a.selectedIndex?(r=a,a=s):((0,c.Wi)(r)||s.selectedIndex>r.selectedIndex)&&(r=s)):i=!0)}}catch(g){o.e(g)}finally{o.f()}if(0===n){var l=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=l,this._moveManipulation.xyAxisManipulation.available=l,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=l,this._moveManipulation.zManipulation.available=l&&this.enableZShape&&(0,Re.c)(this.graphic),this._moveManipulation.angle=ct((0,c.Wg)(this.graphic.geometry)),this._moveManipulation.radius=xt.radiusForSymbol(this.graphic.symbol)}else{var u=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=u,this._moveManipulation.xyAxisManipulation.available=u,this._moveManipulation.zManipulation.available=u&&this.enableZVertex&&(0,Re.c)(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=u&&1!==n;var p=0;if((0,c.pC)(a)){var h=a.handle.pos,d=(0,c.pC)(r)?r.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,v=(0,c.Wi)(r)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;d&&v?this._moveManipulation.xyAxisManipulation.available=!1:d?p=sn(d,h):v&&(p=sn(h,v))}this._moveManipulation.angle=p,this._moveManipulation.radius=Je}0!==n&&i?((0,f.g)(t,t,1/n),hn.spatialReference=(0,c.Wg)(this._editGeometryOperations).data.spatialReference,hn.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(t,hn),this._moveManipulation.elevationAlignedLocation=hn):(0,c.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,c.pC)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:(0,Ze.u2)(this.view,this._moveManipulation,this.graphic)}},{key:"_removeVertices",value:function(e){var t,n=new Array,i=(0,c.Wg)(this._editGeometryOperations),a=(0,j.Z)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;if("vertex"===r.type&&i.canRemoveVertex()){var o;n.push(r.handle),this._removeManipulator(r),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.rightEdge));var s=i.removeVertices([r.handle]),l=(0,c.Wg)(null===(o=s.removedVertices)||void 0===o?void 0:o[0].createdEdge);l&&this._createVertexOrEdgeManipulator(l)}}}catch(h){a.e(h)}finally{a.f()}if(n.length>0){var u=n.map((function(e){var t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:(0,c.Wg)(e.index)}}));this.outputGeometry=i.data.geometry;var p=this._updateEventState(un.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:u.map((function(e){return e.coordinates})),vertices:u}),this.destroyed)return;if(p&&(this._updateEventState(un.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}},{key:"_moveVertices",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start"===t.action?Kt.O.NEW_STEP:Kt.O.ACCUMULATE_STEPS,i=(0,c.Wg)(this._editGeometryOperations);i.moveVertices(e.map((function(e){return e.handle})),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,n),this.outputGeometry=i.data.geometry;var a,r=(0,j.Z)(e);try{for(r.s();!(a=r.n()).done;){var o=a.value;this._updateManipulatorPosition(o)}}catch(s){r.e(s)}finally{r.f()}}},{key:"_offsetEdge",value:function(e,t){if(!(0,c.Wi)(t.operation)&&!(0,c.Wi)(t.signedDistance)){var n=(0,c.Wg)(this._editGeometryOperations),i=t.operation.clone();i.distance=t.signedDistance,n.updateVertices([e.handle.leftVertex,e.handle.rightVertex],i),this.outputGeometry=n.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}}},{key:"_manipulatorClickCallback",value:function(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,e.button===$t.t.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===$t.t.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}},{key:"_updateTranslateTooltip",value:function(e,t){var n=this._manipulatorInfos.filter((function(e){return"vertex"===e.type&&e.manipulator.selected}));1===n.length?this._updateTranslateVertexTooltip(n[0].manipulator,e,t):this._updateTranslateGraphicTooltip(e,t)}},{key:"_updateTranslateGraphicTooltip",value:function(e,t){var n=this._tooltipOptions;if(n.enabled){var i=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case ht.XY:this._tooltip.info=new It.$E({tooltipOptions:n}),this._updateTranslateTooltipDistance(this._tooltip.info,t,(function(e,t){return(0,D.GQ)(e,t,i)}));break;case ht.XY_AXIS:this._tooltip.info=new It.in({tooltipOptions:n}),this._updateTranslateTooltipDistance(this._tooltip.info,t,(function(e,n){var a=(0,D.GQ)(e,n,i);return(0,Ae.bA)(a,pt(t))}));break;case ht.Z:this._tooltip.info=new It.QW({tooltipOptions:n}),this._updateTranslateTooltipDistance(this._tooltip.info,t,Lt._e)}}}},{key:"_updateTranslateVertexTooltip",value:function(e,t,n){var a=this._tooltipOptions;if(a.enabled){var r,o=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case ht.XY:r=new It.nk({tooltipOptions:a}),this._updateTranslateTooltipDistance(r,n,(function(e,t){return(0,D.GQ)(e,t,o)})),this._updateTooltipAreaOrTotalLength(r);break;case ht.XY_AXIS:r=new It.c1({tooltipOptions:a}),this._updateTranslateTooltipDistance(r,n,(function(e,t){var i=(0,D.GQ)(e,t,o);return(0,Ae.bA)(i,pt(n))})),this._updateTooltipAreaOrTotalLength(r);break;case ht.Z:r=new It.j({tooltipOptions:a}),this._updateTranslateTooltipDistance(r,n,Lt._e)}var s=(0,Lt.g1)(e.elevationAlignedLocation);(0,c.pC)(s)&&(r.elevation=(0,i.Z)({mode:"absolute-height"},s)),this._tooltip.info=r}}},{key:"_updateTranslateTooltipDistance",value:function(e,t,n){if((0,c.pC)(t)&&"end"!==t.action){var i=n(t.mapStart,t.mapEnd);e.distance=(0,c.pC)(i)?i:Ae.yP}}},{key:"_updateTooltipAreaOrTotalLength",value:function(e){var t=this.graphic.geometry;if(!(0,c.Wi)(t)){var n=this._graphicState.isDraped?"on-the-ground":"absolute-height";e.area="polygon"===t.type?(0,nn.k)(t,n):null,e.totalLength="polyline"===t.type?(0,D.Ul)(t,n):null}}},{key:"test",get:function(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}}]),n}(J.Z.EventedMixin(Oe.r));function sn(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}(0,l._)([(0,h.Cb)()],on.prototype,"_editGeometryOperations",void 0),(0,l._)([(0,h.Cb)()],on.prototype,"_segmentLabels",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],on.prototype,"tool",void 0),(0,l._)([(0,h.Cb)()],on.prototype,"_tooltip",void 0),(0,l._)([(0,h.Cb)()],on.prototype,"inputGeometry",null),(0,l._)([(0,h.Cb)()],on.prototype,"outputGeometry",void 0),(0,l._)([(0,h.Cb)({readOnly:!0})],on.prototype,"updating",null),(0,l._)([(0,h.Cb)()],on.prototype,"manipulators",null),(0,l._)([(0,h.Cb)()],on.prototype,"view",null),(0,l._)([(0,h.Cb)()],on.prototype,"graphic",null),(0,l._)([(0,h.Cb)()],on.prototype,"enableZShape",null),(0,l._)([(0,h.Cb)()],on.prototype,"enableZVertex",null),(0,l._)([(0,h.Cb)()],on.prototype,"enableMoveGraphic",null),(0,l._)([(0,h.Cb)()],on.prototype,"enableMidpoints",null),(0,l._)([(0,h.Cb)()],on.prototype,"enableEdgeOffset",null),(0,l._)([(0,h.Cb)()],on.prototype,"_labelOptions",null),(0,l._)([(0,h.Cb)()],on.prototype,"_tooltipOptions",null),on=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],on);var ln,un,cn,pn,hn=(0,te.Tx)(0,0,void 0,rn.Z.WGS84),dn=(0,g.c)(),vn=1e-6;(pn=ln||(ln={})).Vertex=gt.jg.Custom1,pn.Edge=gt.jg.Custom2,function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(un||(un={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(cn||(cn={}));var fn=n(52349),gn=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e))._handles=new et.Z,i._internalGeometryUpdate=!1,i.enableZShape=!0,i.enableZVertex=!0,i.enableMoveGraphic=!0,i.enableMidpoints=!0,i.enableEdgeOffset=!1,i.type="reshape-3d",i.labelOptions=new fn.Z,i.tooltipOptions=new Rt.Z,i.snappingManager=null,i.automaticManipulatorSelection=!1,i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this,t=this._reshapeOperation=new on({tool:this});this.addHandles([t.on("reshape",(function(t){"reshape"===t.type&&e._onReshapeGeometryChanged(),e.emit("reshape",t)})),t.on("move",(function(t){"move"===t.type&&e._onReshapeGeometryChanged(),e.emit("move",t)})),t.on("vertex-add",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-add",t)})),t.on("vertex-remove",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-remove",t)})),t.on("immediate-click",(function(t){return e.emit("immediate-click",t)})),this.view.on("pointer-down",["Shift"],(function(e){return e.stopPropagation()})),(0,p.YP)((function(){return e.graphic}),(function(){return e._updateGraphic()}),p.tX)]),this.finishToolCreation()}},{key:"destroy",value:function(){this._handles=(0,c.SC)(this._handles),this._reshapeOperation=(0,c.SC)(this._reshapeOperation)}},{key:"updating",get:function(){var e,t;return null!==(e=null===(t=this._reshapeOperation)||void 0===t?void 0:t.updating)&&void 0!==e&&e}},{key:"_updateGeometry",value:function(){var e=(0,Ht.b)(this.graphic);this._reshapeOperation.inputGeometry=(0,c.pC)(e)?e.clone():null}},{key:"_updateGraphic",value:function(){var e=this;if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),(0,Ht.P)(this.graphic)===Te.e.SUPPORTED){var t=(0,p.YP)((function(){var t;return null===(t=e.graphic)||void 0===t?void 0:t.geometry}),(function(){!1===e._internalGeometryUpdate&&e._updateGeometry()}),p.Z_);this._handles.add(t,"onGraphicGeometryChange")}}},{key:"onManipulatorSelectionChanged",value:function(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}},{key:"_updateGeometryInternally",value:function(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}},{key:"_onReshapeGeometryChanged",value:function(){var e=this._reshapeOperation.outputGeometry;!(0,c.Wi)(this.graphic)&&e&&this._updateGeometryInternally(e.clone())}},{key:"canUndo",get:function(){var e;return null!==(e=this._reshapeOperation.canUndo)&&void 0!==e&&e}},{key:"undo",value:function(){(0,c.pC)(this.snappingManager)&&this.snappingManager.doneSnapping();var e=this._reshapeOperation.undo(),t=this._reshapeOperation.outputGeometry;e&&t&&this._updateGeometryInternally(t.clone())}},{key:"canRedo",get:function(){var e;return null!==(e=this._reshapeOperation.canRedo)&&void 0!==e&&e}},{key:"redo",value:function(){(0,c.pC)(this.snappingManager)&&this.snappingManager.doneSnapping();var e=this._reshapeOperation.redo(),t=this._reshapeOperation.outputGeometry;e&&t&&this._updateGeometryInternally(t.clone())}},{key:"onInputEvent",value:function(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}},{key:"reset",value:function(){}},{key:"test",get:function(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}}]),n}(J.Z.EventedMixin(Zt.m));(0,l._)([(0,h.Cb)()],gn.prototype,"_reshapeOperation",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],gn.prototype,"view",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],gn.prototype,"graphic",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],gn.prototype,"enableZShape",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],gn.prototype,"enableZVertex",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],gn.prototype,"enableMoveGraphic",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],gn.prototype,"enableMidpoints",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],gn.prototype,"enableEdgeOffset",void 0),(0,l._)([(0,h.Cb)()],gn.prototype,"type",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,type:fn.Z})],gn.prototype,"labelOptions",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,type:Rt.Z})],gn.prototype,"tooltipOptions",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],gn.prototype,"snappingManager",void 0),(0,l._)([(0,h.Cb)()],gn.prototype,"updating",null),(0,l._)([(0,h.Cb)()],gn.prototype,"automaticManipulatorSelection",void 0),gn=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],gn);var _n=n(585),yn=n(50951),mn=n(17768),Mn=n(99346),bn=n(67077),Sn=n(40885),wn=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="transform-rotate",i.rotationType="geographic",i}return(0,r.Z)(n)}(en.h);(0,l._)([(0,h.Cb)()],wn.prototype,"type",void 0),(0,l._)([(0,h.Cb)()],wn.prototype,"rotation",void 0),(0,l._)([(0,h.Cb)()],wn.prototype,"rotationPrecision",void 0),(0,l._)([(0,h.Cb)()],wn.prototype,"orientation",void 0),(0,l._)([(0,h.Cb)()],wn.prototype,"orientationPrecision",void 0),(0,l._)([(0,h.Cb)()],wn.prototype,"rotationType",void 0),wn=(0,l._)([(0,v.j)("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],wn);var Cn=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="transform-scale",i.sizeUnit=null,i.sizePrecision=null,i}return(0,r.Z)(n)}(en.h);(0,l._)([(0,h.Cb)()],Cn.prototype,"type",void 0),(0,l._)([(0,h.Cb)()],Cn.prototype,"scale",void 0),(0,l._)([(0,h.Cb)()],Cn.prototype,"size",void 0),(0,l._)([(0,h.Cb)()],Cn.prototype,"sizeUnit",void 0),(0,l._)([(0,h.Cb)()],Cn.prototype,"sizePrecision",void 0),Cn=(0,l._)([(0,v.j)("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],Cn);var xn,En,kn=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="transform-absolute",i.orientationEnabled=!0,i.orientationPrecision=null,i.rotationType="geographic",i.sizeUnit=null,i.sizeEnabled=!0,i.sizePrecision=null,i}return(0,r.Z)(n)}(en.h);(0,l._)([(0,h.Cb)()],kn.prototype,"type",void 0),(0,l._)([(0,h.Cb)()],kn.prototype,"orientation",void 0),(0,l._)([(0,h.Cb)()],kn.prototype,"orientationEnabled",void 0),(0,l._)([(0,h.Cb)()],kn.prototype,"orientationPrecision",void 0),(0,l._)([(0,h.Cb)()],kn.prototype,"rotationType",void 0),(0,l._)([(0,h.Cb)()],kn.prototype,"size",void 0),(0,l._)([(0,h.Cb)()],kn.prototype,"sizeUnit",void 0),(0,l._)([(0,h.Cb)()],kn.prototype,"sizeEnabled",void 0),(0,l._)([(0,h.Cb)()],kn.prototype,"sizePrecision",void 0),kn=(0,l._)([(0,v.j)("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],kn),function(e){e.ScaleIn=gt.jg.Custom2,e.ScaleOut=gt.jg.Custom3,e.RotateLeft=gt.jg.Custom4,e.RotateRight=gt.jg.Custom5,e.Unlocked=gt.jg.Custom7,e.DelayedFocused=gt.jg.Custom8,e.TouchInput=gt.jg.Custom12}(xn||(xn={}));var On=function(){function e(t){var n=this,i=t.adapter,r=t.tooltipOptions,o=t.mode,s=t.tool;(0,a.Z)(this,e),this._mode=null,this._handles=new et.Z,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this.events=new J.Z,this.getFocused=function(){return n._ringManipulator.focused},this.getScale=function(){return(0,c.pC)(n._scaleRotateDragData)&&"scale"===n._scaleRotateDragData.mode?n._adapter.scale:1},this.tool=s,this._mode=o,this._adapter=i,this._tooltipOptions=r,this._tooltip=new Pt.u({view:s.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add((0,p.gx)((function(){return!n._tooltipOptions.enabled}),(function(){return n._tooltip.clear()}),p.nn))}return(0,r.Z)(e,[{key:"angle",get:function(){return this._adapter.angle}},{key:"scale",get:function(){return this._adapter.scale}},{key:"location",set:function(e){this._ringManipulator.location=e}},{key:"elevationAlignedLocation",set:function(e){this._ringManipulator.elevationAlignedLocation=e}},{key:"grabbing",get:function(){return this._ringManipulator.grabbing}},{key:"interactive",set:function(e){this._ringManipulator.interactive=e}},{key:"destroy",value:function(){(0,c.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=(0,c.SC)(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=(0,c.SC)(this._tooltip)}},{key:"startAnimation",value:function(e){var t=this;this.cancelActiveAnimation(),e.start();var n=(0,Mn.A)({update:function(n){var i=n.deltaTime;e.update(i)&&t.cancelActiveAnimation()}});this._activeAnimation=(0,i.Z)((0,i.Z)({},e),{},{frameTask:n})}},{key:"cancelActiveAnimation",value:function(){(0,c.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=(0,c.SC)(this._activeAnimation))}},{key:"forEachManipulator",value:function(e){e(this._ringManipulator,Ce.SCALE_ROTATE)}},{key:"_createManipulator",value:function(){var e=this,t=this._createRingManipulator();this._ringManipulator=t,this.tool.manipulators.add(t);var n=this.tool.graphicState.graphic,i=(0,lt.Xd)(t,(function(t,i,a){e._scaleRotateDragData=null;var r=e._adapter.startInteraction(),o={mode:"none",origin:(0,g.a)(t.renderLocation),initialAngle:e._adapter.angle,angle:0,angleDir:0,scaleDir:0};e._scaleRotateDragData=o,e._updateDragState();var s=rt.WM.get();e.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,s),i.next((0,st._N)(e.tool.view,(0,Ft.Yq)(t.renderLocation,s,(0,Ft.Ue)()))).next((function(t){var i=(0,Ft.mJ)(t.plane),a=(0,Ze.Gd)(t.renderStart,t.renderEnd,o.origin,i),s=mn.Q4.shortestSignedDiff(o.angle,a);o.angleDir=(0,Ge.uZ)(o.angleDir+s,-.3,.3),o.angle=a;var l=function(e,t){var n=(0,f.b)(rt.WM.get(),t.renderStart,e.origin),i=(0,f.b)(rt.WM.get(),t.renderEnd,e.origin),a=(0,f.l)(n),r=(0,f.l)(i);return 0===a?0:r/a}(o,t),u=l-e._adapter.scale;if(o.scaleDir=(0,Ge.uZ)(o.scaleDir+u,-.2,.2),e._onScaleChanged(),"none"===o.mode){var p=e._mode||function(e,t,n,i){var a=e.renderStart,r=e.renderEnd,o=An(a,i,rt.WM.get()),s=An(r,i,rt.WM.get());if((0,f.d)(o,s)<100)return null;var l=(0,f.b)(rt.WM.get(),a,n),u=(0,f.f)(rt.WM.get(),l,(0,Ft.mJ)(t)),c=a,p=(0,f.a)(rt.WM.get(),c,u),h=An(n,i,rt.WM.get()),d=o,v=An(p,i,rt.WM.get()),g=(0,f.b)(rt.WM.get(),v,d),_=(0,f.b)(rt.WM.get(),o,h),y=(0,Sn.re)(d,g),m=(0,Sn.re)(h,_);return(0,Sn.Jk)(y,s)<(0,Sn.Jk)(m,s)?"rotate":"scale"}(t,t.plane,o.origin,e.tool.view.state.camera);if((0,c.pC)(p)){switch(p){case"rotate":e.tool.emit("graphic-rotate-start",{graphic:n,angle:0}),e.tool.emit("record-undo",{record:e._adapter.createUndoRecord()});break;case"scale":e.tool.emit("graphic-scale-start",{graphic:n,xScale:1,yScale:1}),e.tool.emit("record-undo",{record:e._adapter.createUndoRecord()})}o.mode=p}}switch(o.mode){case"rotate":r.state.angle=o.initialAngle+a;break;case"scale":r.state.scale=l,e._onScaleChanged()}switch(e._updateDragState(),e._updateManipulatorTransform(),t.action){case"start":case"update":switch(o.mode){case"rotate":e.tool.emit("graphic-rotate",{graphic:n,angle:(0,Ge.BV)(o.angle)});break;case"scale":e.tool.emit("graphic-scale",{graphic:n,xScale:l,yScale:l})}break;case"end":switch(o.mode){case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:n,angle:(0,Ge.BV)(o.angle)});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:n,xScale:l,yScale:l})}}return"end"===t.action&&(e.startAnimation(Zn(e,(function(){return e._onScaleChanged()}))),e._scaleRotateDragData=null,e._updateDragState(),r.done()),t})).next(e._updateTooltipPipelineStep(o)),a.next((function(){if(r.cancel(),(0,c.pC)(e._scaleRotateDragData)){switch(e._scaleRotateDragData.mode){case"none":break;case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:n,angle:0});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:n,xScale:1,yScale:1})}e.startAnimation(Zn(e,(function(){return e._onScaleChanged()}))),e._scaleRotateDragData=null,e._updateDragState()}e._updateFocusTooltip()}))}));this._handles.add([i,t.events.on("focus-changed",(function(t){"focus"===t.action?e.startAnimation(function(e,t,n){var i=0,a=null,r=function(){return!1};return{start:function(){a=e.getFocused,e.getFocused=r,i=0,t()},update:function(e){var t;return i+=e,null===(t=a)||void 0===t||!t()||i>=n.delayMs?En.STOP:En.CONTINUE},destroy:function(){a&&(e.getFocused=a),t()}}}(e,(function(){return e._updateDelayedFocusedState()}),{delayMs:e._ringIndicatorDelayMs})):e._updateDelayedFocusedState()})),t.events.on("immediate-click",(function(e){e.stopPropagation()})),(0,p.YP)((function(){var t;return null===(t=e.tool.graphicState)||void 0===t?void 0:t.displaying}),(function(t){return e._ringManipulator.available=t}),p.nn)])}},{key:"_updateTooltipPipelineStep",value:function(e){var t=this;return function(n){var i=t._tooltipOptions;if(!i.enabled)return n;if("end"===n.action)return t._updateFocusTooltip(),n;var a=t._tooltip,r=t._tooltipOptions.visualVariables,o=(0,c.pC)(r)?r.size:null,s=(0,c.pC)(r)?r.rotation:null;switch(e.mode){case"scale":a.info=new Cn({tooltipOptions:i,scale:{value:t._adapter.scale},size:(0,Ae.yG)((0,c.Pt)(t._adapter.size,-1),"meters"),sizeUnit:(0,c.pC)(o)?o.unit:null,sizePrecision:(0,c.pC)(o)?Tn(o.valueType):null});break;case"rotate":var l=(0,c.pC)(s)?Tn(s.valueType):null,u=(0,c.pC)(s)?s.rotationType:"geographic";a.info=new wn({tooltipOptions:i,rotation:(0,Ae.GJ)((0,c.Pt)(-t._adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:l,orientation:(0,Ae.GJ)(-t._adapter.angle,"radians","geographic"),orientationPrecision:l,rotationType:u})}return n}}},{key:"_updateFocusTooltip",value:function(){if(this._tooltipOptions.enabled)if(this.getFocused()){var e=this._tooltipOptions.visualVariables,t=(0,c.pC)(e)?e.rotation:null,n=(0,c.pC)(e)?e.size:null;this._tooltip.info=new kn({tooltipOptions:this._tooltipOptions,orientation:(0,Ae.GJ)(-this._adapter.angle,"radians","geographic"),orientationEnabled:null==this._mode||"rotate"===this._mode,orientationPrecision:(0,c.pC)(t)?Tn(t.valueType):null,rotationType:(0,c.pC)(t)?t.rotationType:"geographic",size:(0,Ae.yG)((0,c.Pt)(this._adapter.size,-1),"meters"),sizeUnit:(0,c.pC)(n)?n.unit:null,sizeEnabled:null==this._mode||"scale"===this._mode,sizePrecision:(0,c.pC)(n)?Tn(n.valueType):null})}else this._tooltip.clear()}},{key:"_onScaleChanged",value:function(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}},{key:"_updateDelayedFocusedState",value:function(){this._ringManipulator.updateStateEnabled(xn.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}},{key:"_updateDragState",value:function(){if(this._ringManipulator.updateStateEnabled(xn.Unlocked,!((0,c.pC)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),(0,c.pC)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(xn.ScaleIn|xn.ScaleOut,!1),this._ringManipulator.updateStateEnabled(xn.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(xn.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(xn.RotateLeft|xn.RotateRight,!1),this._ringManipulator.updateStateEnabled(xn.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(xn.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(xn.ScaleIn|xn.ScaleOut|xn.RotateLeft|xn.RotateRight,!1)}},{key:"_updateManipulatorTransform",value:function(){var e=(0,it.d)(rt.MP.get(),this._adapter.angle,(0,g.f)(0,0,1));if(!(0,c.Wi)(e)){var t=this.getScale(),n=(0,it.E)(rt.MP.get(),(0,f.s)(rt.WM.get(),t,t,t));this._ringManipulator.modelTransform=(0,it.m)(rt.MP.get(),n,e)}}},{key:"_createRingManipulator",value:function(){for(var e=function(e,t,n){for(var i=[],a=Math.ceil(128*(t-e)/(2*Math.PI)),r=0;r<a+1;r++){var o=e+r*(t-e)/a;i.push((0,g.f)(n*Math.cos(o),n*Math.sin(o),0))}return i},t=function(t){return e(0,2*Math.PI,t)},n=function(e){return[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]]},i=this._createMaterial(1),a=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i;return(0,vt.x2)(a,n(t),e,[],[],!1)},r=t(qe),o=a(r,24),s={left:new Array,right:new Array},l=[],u=0;u<2;u++){var c=u*Math.PI-Math.PI/4,p=Math.PI/2-$e,h=c+p,d=c+Math.PI/2-p,v=e(h,d,190),f=a(v,9);l.push(v),l.push(e(h,d,201)),s.left.push(f),s.right.push(f.instantiate());for(var y=0;y<2;y++){var m=0===y,M=(0,at.c)();if(m){(0,it.k)(M,M,[1,-1,1]),(0,it.e)(M,M,-h,[0,0,1]);var S=Math.round(.2*(v.length-1));M[12]=v[S][0],M[13]=v[S][1],M[14]=v[S][2]}else{(0,it.e)(M,M,d,[0,0,1]);var w=Math.round(.8*(v.length-1));M[12]=v[w][0],M[13]=v[w][1],M[14]=v[w][2]}var C=(0,vt.DA)(i,60,0,23,.5);(0,vt.mx)(C,M),(m?s.left:s.right).push(C)}}for(var x=[],E=0;E<2;E++){var k=E*Math.PI-Math.PI/4,O=Math.PI/2-Ke,A=k+O,Z=k+Math.PI/2-O,T=e(A,Z,213);x.push(a(T,9))}var R=this._createMaterial(.66),G=this._createMaterial(.5),D=this._createMaterial(.33),P=t(190),I=t(213),L=a(P,9,R),V=a(I,9,D),z=t(130),W=t(107),X=a(z,9,R),Y=a(W,9,D),H=[new ot.r(o,xn.DelayedFocused),new ot.r(o.instantiate({material:G}),gt.Q9.None)];this._mode&&"scale"!==this._mode||(H=H.concat([].concat((0,b.Z)(x.map((function(e){return new ot.r(e,xn.DelayedFocused|xn.Unlocked)}))),[new ot.r(L,xn.DelayedFocused|xn.ScaleIn),new ot.r(V,xn.DelayedFocused|xn.ScaleIn),new ot.r(X,xn.DelayedFocused|xn.ScaleOut),new ot.r(Y,xn.DelayedFocused|xn.ScaleOut)]))),this._mode&&"rotate"!==this._mode||(H=H.concat([].concat((0,b.Z)(s.right.map((function(e){return new ot.r(e.instantiate(),xn.DelayedFocused|xn.Unlocked)}))),(0,b.Z)(s.left.map((function(e){return new ot.r(e,xn.DelayedFocused|xn.RotateLeft)}))),(0,b.Z)(s.right.map((function(e){return new ot.r(e,xn.DelayedFocused|xn.RotateRight)}))))));var N=[r].concat(l);return new De.Z({view:this.tool.view,renderObjects:H,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,_.RL)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:N,direction:(0,g.f)(0,0,1)}})}},{key:"_createMaterial",value:function(e){var t=(0,bn.b)([].concat((0,b.Z)(Be),[e]));return new ft.E({color:t,transparent:1!==e,cullFace:dt.Vr.Back,renderOccluded:le.yD.Transparent})}},{key:"test",get:function(){var e=this;return{ringManipulator:this._ringManipulator,setRingIndicatorDelayMs:function(t){return e._ringIndicatorDelayMs=t},tooltip:this._tooltip}}}]),e}();function An(e,t,n){return t.projectToScreen(e,Rn),(0,f.s)(n,Rn[0],Rn[1],0)}function Zn(e,t){var n=null,i=1,a=function(){return i};return{start:function(){i=e.getScale(),n=e.getScale,e.getScale=a,t()},update:function(e){return i+=((i+1)/2-i)*Math.min(3*e,1),t(),Math.abs(i-1)<.01?En.STOP:En.CONTINUE},destroy:function(){n&&(e.getScale=n),t()}}}function Tn(e){switch(e){case"integer":case"long":return 0;default:return null}}!function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(En||(En={}));var Rn=(0,m.s1)(),Gn=n(45238);function Dn(e){return(0,c.pC)(e.geometry)&&"mesh"===e.geometry.type?function(e){return(0,c.pC)(e.transform)?function(e,t){var n=t.clone(),i=null;return{undo:function(t){i=(0,c.pC)(e.transform)?e.transform.clone():null,e.transform=n,t.notifyGeometryChanged()},redo:function(t){n=(0,c.pC)(e.transform)?e.transform.clone():null,e.transform=i,t.notifyGeometryChanged()}}}(e,e.transform):function(e){var t,n=e.vertexAttributes.clonePositional();return{undo:function(i){t=e.vertexAttributes.clonePositional(),e.vertexAttributes=n,i.notifyGeometryChanged()},redo:function(i){n=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,i.notifyGeometryChanged()}}}(e)}(e.geometry):function(e){var t=e.geometry,n=c.YP;return{undo:function(e){n=e.geometry,e.geometry=t},redo:function(e){t=e.geometry,e.geometry=n}}}(e)}var Pn=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e))._interactionState=null,i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles([(0,p.gx)((function(){return(0,c.pC)(e._interactionState)&&e._interactionState.angle!==e._interactionState.previousAngle?{interactionState:e._interactionState,angle:e._interactionState.state.angle}:null}),(function(t){var n=t.interactionState;e._updateMeshRotation(n)}),p.Z_),(0,p.gx)((function(){return(0,c.pC)(e._interactionState)&&e._interactionState.scale!==e._interactionState.previousScale?{interactionState:e._interactionState,scale:e._interactionState.state.scale}:null}),(function(t){var n=t.interactionState;e._updateMeshSize(n)}),p.Z_)])}},{key:"angle",get:function(){var e=this.geometry.transform;if((0,c.Wi)(e))return 0;var t=(0,Gn.ZZ)(e.rotation)[2];return Math.abs(t)>.999999?(0,Ge.Vl)((0,Gn.EU)(e.rotation))*Math.sign(t):0}},{key:"scale",get:function(){return(0,c.pC)(this._interactionState)?this._interactionState.scale:1}},{key:"startInteraction",value:function(){var e=this,t=new In({angle:this.angle});this._interactionState=t;var n=function(){e._interactionState=null};return{state:t,done:n,cancel:function(){t.cancel(),n()}}}},{key:"createUndoRecord",value:function(){return Dn(this.graphic)}},{key:"_updateMeshRotation",value:function(e){var t=this.geometry.anchor,n=this.viewingMode===yn.JY.Global,i=e.angle,a=e.previousAngle;this.geometry.rotate(0,0,(0,Ge.BV)(i-a),{origin:t,geographic:n}),e.previousAngle=i,(0,c.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}},{key:"_updateMeshSize",value:function(e){var t=this.geometry.anchor,n=this.viewingMode===yn.JY.Global,i=e.scale,a=e.previousScale;this.geometry.scale(i/a,{origin:t,geographic:n}),e.previousScale=i,(0,c.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}}]),n}(Oe.r);(0,l._)([(0,h.Cb)({constructOnly:!0})],Pn.prototype,"graphic",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],Pn.prototype,"geometry",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],Pn.prototype,"viewingMode",void 0),(0,l._)([(0,h.Cb)()],Pn.prototype,"angle",null),(0,l._)([(0,h.Cb)()],Pn.prototype,"scale",null),(0,l._)([(0,h.Cb)()],Pn.prototype,"_interactionState",void 0),Pn=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Pn);var In=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).angle=0,i.initialAngle=0,i.previousAngle=0,i.previousScale=1,i.scale=1,i.initialAngle=e.angle,i.previousAngle=e.angle,i}return(0,r.Z)(n,[{key:"state",get:function(){return{angle:this.angle,scale:this.scale}}},{key:"cancel",value:function(){this.angle=this.initialAngle,this.scale=1}}]),n}(C.Z);(0,l._)([(0,h.Cb)()],In.prototype,"angle",void 0),(0,l._)([(0,h.Cb)()],In.prototype,"initialAngle",void 0),(0,l._)([(0,h.Cb)()],In.prototype,"previousAngle",void 0),(0,l._)([(0,h.Cb)()],In.prototype,"previousScale",void 0),(0,l._)([(0,h.Cb)()],In.prototype,"scale",void 0),(0,l._)([(0,h.Cb)()],In.prototype,"state",null),In=(0,l._)([(0,v.j)("InteractionState")],In);var Ln=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).sizeAxis=null,i._interactionState=null,i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles((0,p.gx)((function(){return(0,c.pC)(e._interactionState)?e._interactionState.state:null}),(function(t){e._updateSymbol(t)}),p.Z_))}},{key:"angle",get:function(){var e;return(0,c.pC)(this._interactionState)?this._interactionState.angle:(0,c.pC)(this._orientationReferenceSymbolLayer)?function(e){return-(0,Ge.Vl)(e)}(null!==(e=this._orientationReferenceSymbolLayer.heading)&&void 0!==e?e:0):0}},{key:"scale",get:function(){return(0,c.pC)(this._interactionState)?this._interactionState.scale:1}},{key:"relativeAngle",get:function(){return this.angle-this.initialAngle}},{key:"initialAngle",get:function(){return(0,c.pC)(this._interactionState)?this._interactionState.initialAngle:0}},{key:"size",get:function(){var e=this._sizeReferenceSymbolLayer;if((0,c.Wi)(e))return null;var t=this.findLayerView(),n=this._graphicSymbol;if((0,c.Wi)(t)||(0,c.Wi)(n)||"point-3d"!==n.type)return null;var i=t.getSymbolLayerSize(n,e);if("size"in i&&(0,c.pC)(i.size))return i.size;var a=this.sizeAxis;return"width"in i&&(0,c.pC)(i.width)&&((0,c.Wi)(a)||"width"===a||"all"===a||"width-and-depth"===a)?i.width:"depth"in i&&(0,c.pC)(e.depth)&&((0,c.Wi)(a)||"depth"===a||"all"===a||"width-and-depth"===a)?i.depth:"height"in i&&(0,c.pC)(e.height)&&((0,c.Wi)(a)||"height"===a||"all"===a)?i.height:null}},{key:"_sizeReferenceSymbolLayer",get:function(){var e=this._graphicSymbol;return(0,c.Wi)(e)||0===e.symbolLayers.length?null:e.symbolLayers.find((function(e){return"object"===e.type}))}},{key:"_orientationReferenceSymbolLayer",get:function(){var e=this._graphicSymbol;return(0,c.Wi)(e)||0===e.symbolLayers.length?null:e.symbolLayers.find((function(e){return"object"===e.type&&(0,c.pC)(e.heading)}))}},{key:"_graphicSymbol",get:function(){return(0,c.pC)(this.graphic)&&(0,c.pC)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null},set:function(e){this.graphic.symbol=e}},{key:"startInteraction",value:function(){var e=this,t=this._graphicSymbol,n=this.findLayerView();if((0,c.pC)(this._interactionState)||(0,c.Wi)(t)||(0,c.Wi)(n))return Vn;var i=t.symbolLayers.map((function(e){return"object"===e.type?n.getSymbolLayerSize(t,e):null})).toArray(),a=t.clone(),r=this.angle,o=new zn({originalSymbol:a,angle:r,initialSizes:i});this._interactionState=o;var s=function(){e._interactionState=null};return{state:o,done:s,cancel:function(){e._graphicSymbol=a,s()}}}},{key:"createUndoRecord",value:function(){var e=this.graphic.symbol,t=null;return{undo:function(n){t=n.symbol,n.symbol=e},redo:function(n){e=n.symbol,n.symbol=t}}}},{key:"_updateSymbol",value:function(e){var t=this,n=e.scale,i=e.angle,a=e.originalSymbol,r=e.initialSizes,o=this._graphicSymbol;if(!(0,c.Wi)(o)&&"point-3d"===o.type){var s=o.clone(),l=-(0,Ge.BV)(i-this.initialAngle),u=!1;this._forEachObjectSymbolLayerPair(a,s,(function(e,i,a){var o=(0,c.Pt)(e.heading,0)+l;i.heading!==o&&(i.heading=o,u=!0);var s=r[a];if((0,c.pC)(s)&&"width"in s){s.width=t.sizeFilter(s.width),s.height=t.sizeFilter(s.height),s.depth=t.sizeFilter(s.depth);var p=s.width*n;i.width!==p&&(i.width=p,u=!0);var h=s.depth*n;i.depth!==h&&(i.depth=h,u=!0);var d=s.height*n;i.height!==d&&(i.height=d,u=!0)}})),u&&(this._graphicSymbol=s)}}},{key:"_forEachObjectSymbolLayerPair",value:function(e,t,n){e.symbolLayers.forEach((function(e,i){var a=t.symbolLayers.getItemAt(i);"object"===e.type&&"object"===a.type&&n(e,a,i)}))}}]),n}(Oe.r);(0,l._)([(0,h.Cb)()],Ln.prototype,"angle",null),(0,l._)([(0,h.Cb)()],Ln.prototype,"scale",null),(0,l._)([(0,h.Cb)()],Ln.prototype,"relativeAngle",null),(0,l._)([(0,h.Cb)()],Ln.prototype,"initialAngle",null),(0,l._)([(0,h.Cb)()],Ln.prototype,"size",null),(0,l._)([(0,h.Cb)()],Ln.prototype,"sizeAxis",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],Ln.prototype,"graphic",void 0),(0,l._)([(0,h.Cb)()],Ln.prototype,"_interactionState",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],Ln.prototype,"findLayerView",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],Ln.prototype,"sizeFilter",void 0),(0,l._)([(0,h.Cb)()],Ln.prototype,"_sizeReferenceSymbolLayer",null),(0,l._)([(0,h.Cb)()],Ln.prototype,"_orientationReferenceSymbolLayer",null),(0,l._)([(0,h.Cb)()],Ln.prototype,"_graphicSymbol",null),Ln=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],Ln);var Vn={state:{angle:0,scale:0},done:function(){},cancel:function(){}},zn=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).angle=0,i.initialAngle=0,i.scale=1,i.initialAngle=e.angle,i}return(0,r.Z)(n,[{key:"state",get:function(){return{originalSymbol:this.originalSymbol,angle:this.angle,initialAngle:this.initialAngle,scale:this.scale,initialSizes:this.initialSizes}}}]),n}(C.Z);(0,l._)([(0,h.Cb)()],zn.prototype,"originalSymbol",void 0),(0,l._)([(0,h.Cb)()],zn.prototype,"angle",void 0),(0,l._)([(0,h.Cb)()],zn.prototype,"initialAngle",void 0),(0,l._)([(0,h.Cb)()],zn.prototype,"initialSizes",void 0),(0,l._)([(0,h.Cb)()],zn.prototype,"scale",void 0),(0,l._)([(0,h.Cb)()],zn.prototype,"state",null),zn=(0,l._)([(0,v.j)("InteractionState")],zn);var Wn=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).enableZ=!0,i.enableRotation=!0,i.enableScaling=!0,i.tooltipOptions=new Rt.Z,i.type="transform-3d",i._scaleRotate=null,i._tooltip=null,i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.graphic,n=this.view;this.graphicState=new ye({graphic:t}),this.addHandles((0,p.YP)((function(){return e.tooltipOptions.enabled}),(function(t){e._tooltip=t?new Pt.u({view:n}):(0,c.SC)(e._tooltip)}),p.tX)),this._moveManipulation=new xt({tool:this,view:n,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&(0,Re.c)(t),radius:xt.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((function(n){return e.handles.add(n.events.on("immediate-click",(function(n){e.emit("immediate-click",(0,i.Z)((0,i.Z)({},n),{},{graphic:t})),n.stopPropagation()})))}));var a=function(t){return function(n){e.handles.add(n.events.on("focus-changed",(function(n){var i=n.action,a=e._tooltip;(0,c.Wi)(a)||("focus"===i?e._updateMoveTooltip(t):a.clear())})))}};this._moveManipulation.xyManipulation.forEachManipulator(a(ht.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(a(ht.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(a(ht.Z));var r=(0,_.RL)(t);this._moveManipulation.elevationInfo=r;var o=t.geometry;if(this._moveManipulation.createGraphicDragPipeline((function(i,a,s,l,u){if((0,c.pC)(o)&&i===ht.XY){var p,h=(0,Dt.W)({snappingContext:new Gt.N({elevationInfo:r,pointer:u,editGeometryOperations:Tt.c.fromGeometry(new _n.Z({spatialReference:o.spatialReference}),n.state.viewingMode),visualizer:new N._,excludeFeature:t}),snappingManager:e.snappingManager,updatingHandles:e.updatingHandles,useZ:!1}),d=h.snappingStep,v=h.cancelSnapping;l=l.next(v),s=(p=s.next((0,lt.Mz)(e.view,r))).next.apply(p,(0,b.Z)(d))}return{steps:s=s.next((function(t){return e._updateMoveTooltip(i,t),t})),cancel:l}}),this.graphicState,(function(t){var n=t.action,i={graphic:t.graphic,dxScreen:t.dxScreen,dyScreen:t.dyScreen};switch(n){case"start":e.emit("graphic-translate-start",i),e.emit("record-undo",{record:e._createGeometryUndoRecord()});break;case"update":e.emit("graphic-translate",i);break;case"end":e.emit("graphic-translate-stop",i)}})),this._moveManipulation.angle=(0,c.pC)(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add((0,p.YP)((function(){return e._scaleRotateAdapter.angle}),(function(){return e._updateMoveAngle()}))),this.enableScaling||this.enableRotation){var s=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new On({tool:this,mode:s,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",(function(){return e._onScaleChanged()})))}this.handles.add([je({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e._forEachManipulator(t)},onManipulatorsChanged:function(){return(0,u.kB)()}}),this.graphicState.on("changed",(function(){return e._onGeometryChanged()})),this._hideManipulatorsForGraphicState(),(0,p.YP)((function(){return n.scale}),(function(){return e._updateMoveAngle()}))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((function(t){t instanceof De.Z&&e.handles.add(t.events.on("grab-changed",(function(){return e._updateManipulatorsInteractive()})))})),this.finishToolCreation()}},{key:"destroy",value:function(){this._tooltip=(0,c.SC)(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=(0,c.SC)(this._scaleRotate),this._scaleRotateAdapter=(0,c.SC)(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}},{key:"_updateManipulatorsInteractive",value:function(){(0,c.Wi)(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}},{key:"_createScaleRotateAdapter",value:function(){var e=this;return(0,c.pC)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new Pn({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new Ln({graphic:this.graphic,sizeFilter:function(t){return e._enforceNonZeroSize(t)},findLayerView:function(){return e.view.allLayerViews.find((function(t){return t.layer===e.graphic.layer}))},sizeAxis:(0,c.pC)(this.tooltipOptions.visualVariables)&&(0,c.pC)(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}},{key:"_forEachManipulator",value:function(e){this._moveManipulation.forEachManipulator(e),(0,c.pC)(this._scaleRotate)&&this._scaleRotate.forEachManipulator(e)}},{key:"_hideManipulatorsForGraphicState",value:function(){var e=this;return(0,p.YP)((function(){return e.graphicState.displaying}),(function(t){e._forEachManipulator((function(e){return e.available=t})),e._moveManipulation.zManipulation.available=t&&e.enableZ&&(0,Re.c)(e.graphic)}))}},{key:"_createGeometryUndoRecord",value:function(){return Dn(this.graphic)}},{key:"snapToScene",set:function(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"location",set:function(e){this._moveManipulation.location=e,(0,c.pC)(this._scaleRotate)&&(this._scaleRotate.location=e)}},{key:"elevationAlignedLocation",set:function(e){this._moveManipulation.elevationAlignedLocation=e,(0,c.pC)(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=e)}},{key:"reset",value:function(){}},{key:"onHide",value:function(){(0,c.pC)(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}},{key:"_onScaleChanged",value:function(){if(!(0,c.Wi)(this._scaleRotate)){var e=this._scaleRotate.getScale();this._moveManipulation.displayScale=e}}},{key:"_updateMoveAngle",value:function(){this.view.state.viewingMode===yn.JY.Local||this.view.scale<1e6?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}},{key:"_onGeometryChanged",value:function(){(0,Ze.u2)(this.view,this,this.graphic)}},{key:"_enforceNonZeroSize",value:function(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}},{key:"_updateMoveTooltip",value:function(e,t){var n=this.tooltipOptions,i=this._tooltip;if(!(0,c.Wi)(i)){i.clear();var a=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case ht.XY:i.info=new It.$E({tooltipOptions:n}),this._updateMoveTooltipDistance(i.info,t,(function(e,t){return(0,D.GQ)(e,t,a)}));break;case ht.XY_AXIS:i.info=new It.in({tooltipOptions:n}),this._updateMoveTooltipDistance(i.info,t,(function(e,n){var i=(0,D.GQ)(e,n,a);return(0,Ae.bA)(i,pt(t))}));break;case ht.Z:i.info=new It.QW({tooltipOptions:n}),this._updateMoveTooltipDistance(i.info,t,Lt._e)}}}},{key:"_updateMoveTooltipDistance",value:function(e,t,n){if((0,c.pC)(t)&&"end"!==t.action){var i=n(t.mapStart,t.mapEnd);e.distance=(0,c.pC)(i)?i:Ae.yP}}},{key:"test",get:function(){var e=this;return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:(0,c.pC)(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,setRingIndicatorDelayMs:function(t){return(0,c.pC)(e._scaleRotate)?e._scaleRotate.test.setRingIndicatorDelayMs(t):null},scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}}]),n}((0,Oe.p)(J.Z.EventedMixin(Zt.m)));(0,l._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],Wn.prototype,"view",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],Wn.prototype,"graphic",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],Wn.prototype,"enableZ",void 0),(0,l._)([(0,h.Cb)()],Wn.prototype,"enableRotation",void 0),(0,l._)([(0,h.Cb)()],Wn.prototype,"enableScaling",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,type:Rt.Z})],Wn.prototype,"tooltipOptions",void 0),(0,l._)([(0,h.Cb)()],Wn.prototype,"graphicState",void 0),(0,l._)([(0,h.Cb)({value:!1})],Wn.prototype,"snapToScene",null),(0,l._)([(0,h.Cb)({constructOnly:!0})],Wn.prototype,"snappingManager",void 0),(0,l._)([(0,h.Cb)({readOnly:!0})],Wn.prototype,"type",void 0),(0,l._)([(0,h.Cb)({readOnly:!0})],Wn.prototype,"updating",null),Wn=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Wn);var Xn=n(82218),Yn=n(38978),Hn=n(96664),Nn=function(){function e(){(0,a.Z)(this,e),this._lastDragEvent=null,this._next=null,this._enabled=!1}return(0,r.Z)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&(0,c.pC)(this._lastDragEvent)&&(0,c.pC)(this._next)){var t=(0,i.Z)((0,i.Z)({},this._lastDragEvent),{},{action:"update"});e&&this._adjustScaleFactors(t),this._next.execute(t)}this._enabled=e}},{key:"createDragEventPipelineStep",value:function(){var e=this;this._lastDragEvent=null;var t=new lt.hM;return this._next=t,[function(t){return e._lastDragEvent="end"!==t.action?(0,i.Z)({},t):null,e._enabled&&e._adjustScaleFactors(t),t},t]}},{key:"_adjustScaleFactors",value:function(e){var t=(0,Yn.J0)(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}},{key:"test",get:function(){var e=this;return{_adjustScaleFactors:function(t){return e._adjustScaleFactors(t)}}}}]),e}(),Un=n(81703),Fn=n(34778),jn=n(92583),Bn=n(7068),Qn=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).enableZ=!0,i.enableRotation=!0,i.enableScaling=!0,i.tooltipOptions=new Rt.Z,i._preserveAspectRatio=new Nn,i.grabbing=!1,i.inputState=null,i.type="transform-3d",i._handles=new et.Z,i._attachmentOrigin=null,i._outlineVisualElement=null,i._mapBounds=(0,Xn.a)(),i._mapBoundsStart=(0,Xn.a)(),i._zmax=0,i._sizeStart=null,i._displayBounds=(0,Xn.a)(),i._displayBoundsStart=(0,Xn.a)(),i._displayBoundsMarginStart=0,i._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],i._moveXYTooltipInfo=null,i._moveZTooltipInfo=null,i._rotateTooltipInfo=null,i._scaleTooltipInfo=null,i._startAngle=0,i._endAngle=0,i._startScale=(0,A.a)(),i._endScale=(0,A.a)(),i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.view,n=this.graphic,a=this.manipulators,r=this._handles,o=this._graphicState=new ye({graphic:n}),s=n.geometry;this._editGeometryOperations=Tt.c.fromGeometry(s,t.state.viewingMode),this._graphicMoveManipulation=new Ot({tool:this,view:t,graphicState:o}),this._moveZManipulator=(0,Yn.Pt)(t,Yn.lX.CENTER_ON_CALLOUT),this._moveZManipulator.state|=Yn.Df,r.add([this._createMoveXYGraphicDragPipeline(),(0,p.YP)((function(){return e.enableZ}),(function(){return e._updateManipulatorAvailability(e._moveZManipulator,Ce.TRANSLATE_Z)})),this._createMoveZDragPipeline()]),a.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map((function(n){var i=(0,Yn.vw)(t,n);return r.add([(0,p.YP)((function(){return e.enableScaling}),(function(){return e._updateManipulatorAvailability(i,Ce.SCALE)})),i.events.on("grab-changed",(function(t){return e._onResizeGrab(t)})),e._createResizeDragPipeline(i,n)]),i})),a.addMany(this._resizeManipulators),this._rotateManipulatorTexture=(0,Hn.O)(t.toolViewManager.textures),this._rotateManipulator=(0,Ze.Ju)(t,{texture:this._rotateManipulatorTexture.texture}),r.add([(0,p.YP)((function(){return e.enableRotation}),(function(){return e._updateManipulatorAvailability(e._rotateManipulator,Ce.ROTATE)})),this._rotateManipulator.events.on("grab-changed",(function(t){e._onRotateGrab(t)})),this._createRotateDragPipeline(this._rotateManipulator)]),a.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();var l=je({view:t,graphic:n,forEachManipulator:function(t){return e._forEachManipulator(t)},onManipulatorsChanged:function(){return(0,u.kB)()}});(0,c.pC)(l)&&(this._outlineVisualElement=l.visualElement instanceof he?l.visualElement:null),(0,c.pC)(this._outlineVisualElement)&&r.add(this._outlineVisualElement.events.on("attachment-origin-changed",(function(){return e._updateDisplayBounds()}))),r.add(l),r.add([o.on("changed",(function(){return e._onGeometryChanged()})),(0,p.YP)((function(){return o.displaying}),(function(){return e._updateAllManipulatorAvailability()})),(0,p.YP)((function(){return o.isDraped}),(function(){return e._graphicDrapedChanged()}),p.nn),t.trackGraphicState(o)]);var h=t.pointsOfInterest;r.add((0,p.YP)((function(){return null===h||void 0===h?void 0:h.centerOnSurfaceFrequent.location}),(function(){return e._updateDisplayBounds()})));this._forEachManipulator((function(t){r.add(t.events.on("grab-changed",(function(){e.grabbing=t.grabbing,e._updateAllManipulatorAvailability()})))}));this._forEachManipulator((function(t,a){r.add(t.events.on("immediate-click",(function(t){a===Ce.TRANSLATE_XY&&e.emit("immediate-click",(0,i.Z)((0,i.Z)({},t),{},{graphic:n})),t.stopPropagation()})))})),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}},{key:"destroy",value:function(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}},{key:"_initializeTooltip",value:function(){var e=this,t=this._handles,n=this.view,i=this._tooltip=new Pt.u({view:n}),a=function(){i.info=e._getUpdatedTooltipInfo()};t.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",(function(){e._moveXYTooltipInfo=null,e._moveZTooltipInfo=null,e._tooltip.clear()})),this.on("graphic-rotate-start",(function(t){e._startAngle=t.angle,a()})),this.on("graphic-rotate",(function(t){e._endAngle=t.angle,a()})),this.on("graphic-rotate-stop",(function(){e._startAngle=0,e._endAngle=0,a()})),this.on("graphic-scale-start",(function(t){(0,O.s)(e._startScale,t.xScale,t.yScale),(0,O.s)(e._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale",(function(t){(0,O.s)(e._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale-stop",(function(){(0,O.s)(e._startScale,0,0),(0,O.s)(e._endScale,0,0),a()}))]),this._forEachManipulator((function(n){t.add([n.events.on("focus-changed",a),n.events.on("grab-changed",a),n.events.on("drag",(function(t){"cancel"===t.action?e._tooltip.clear():a()}))])}))}},{key:"_getUpdatedTooltipInfo",value:function(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some((function(e){return e.focused}))?this._computeScaleTooltipInfo():null:null}},{key:"_computeMoveXYTooltipInfo",value:function(){var e=this;return this._moveXYTooltipInfo=(0,c.Pt)(this._moveXYTooltipInfo,(function(){return new It.$E({tooltipOptions:e.tooltipOptions})}))}},{key:"_computeMoveZTooltipInfo",value:function(){var e=this,t=this._moveZTooltipInfo=(0,c.Pt)(this._moveZTooltipInfo,(function(){return new It.QW({tooltipOptions:e.tooltipOptions})})),n=this._moveUnit;if(this._moveZManipulator.dragging){var i=this._mapBoundsStart.origin,a=this._mapBounds.origin,r=(0,Lt.Cr)(i,a,this.view.spatialReference);if((0,c.Wi)(r))return null;t.distance=r}else t.distance=(0,Ae.yG)(0,n);return t}},{key:"_computeRotateTooltipInfo",value:function(){var e=this,t=this._rotateTooltipInfo=(0,c.Pt)(this._rotateTooltipInfo,(function(){return new Bn.c({tooltipOptions:e.tooltipOptions})}));return t.angle=this._startAngle-this._endAngle,t}},{key:"_computeScaleTooltipInfo",value:function(){var e=this,t=this.graphic.geometry;if((0,c.Wi)(t))return null;var n=this._scaleTooltipInfo=(0,c.Pt)(this._scaleTooltipInfo,(function(){return new Bn.p({tooltipOptions:e.tooltipOptions})})),i=(0,jn.NI)(this._mapBounds,this._zmax,t.spatialReference,this._graphicState.isDraped);return(0,c.Wi)(i)?null:(n.xSize=i[0],n.ySize=i[1],(0,c.pC)(this._sizeStart)&&this._resizeManipulators.some((function(e){return e.dragging}))?(n.xScale=i[0].value/this._sizeStart[0].value,n.yScale=i[1].value/this._sizeStart[1].value):(n.xScale=1,n.yScale=1),n)}},{key:"_graphicDrapedChanged",value:function(){var e=this;this._handles.remove(Jn),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",(function(t){(0,c.pC)(e._attachmentOrigin)&&(0,Xe.jE)(t.extent,e._attachmentOrigin.x,e._attachmentOrigin.y)&&e._updateDisplayBounds()})),Jn)}},{key:"_updateAllManipulatorAvailability",value:function(){var e=this;this._forEachManipulator((function(t,n){return e._updateManipulatorAvailability(t,n)}))}},{key:"_updateManipulatorAvailability",value:function(e,t){var n=this.grabbing&&!e.grabbing;if(e.interactive=!n,e instanceof De.Z){var i=this._graphicState.displaying,a=this.enableZ&&(0,Re.c)(this.graphic);switch(t){case Ce.ROTATE:e.available=i&&this.enableRotation;break;case Ce.SCALE:e.available=i&&(this.enableScaling||this.enableRotation||a),e.interactive=!n&&this.enableScaling,e.state=this.enableScaling?Yn.Sc:Yn.vc;break;case Ce.TRANSLATE_Z:e.available=i&&a;break;default:e.available=i}}}},{key:"_forEachManipulator",value:function(e){this._graphicMoveManipulation.forEachManipulator(e),this._resizeManipulators.forEach((function(t){return e(t,Ce.SCALE)})),e(this._rotateManipulator,Ce.ROTATE),e(this._moveZManipulator,Ce.TRANSLATE_Z)}},{key:"preserveAspectRatio",get:function(){return this._preserveAspectRatio.enabled},set:function(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}},{key:"_moveUnit",get:function(){return(0,c.Pt)((0,Nt.j5)(this.view.spatialReference),"meters")}},{key:"reset",value:function(){}},{key:"_onGeometryChanged",value:function(){this._updateDisplayBounds()}},{key:"_calculateMapBounds",value:function(){var e=this.graphic.geometry,t=this._editGeometryOperations.data,n=t.components[0].edges[0],i=(0,O.a)(rt.qW.get(),n.leftVertex.pos,n.rightVertex.pos);(0,O.f)(i,i);var a=(0,c.Pt)((0,Ze.du)(this.view,this.graphic),(function(){var t;return null===(t=e.extent)||void 0===t?void 0:t.center})),r=a?$n*this.view.pixelSizeAt(a):0,o=this.view.spatialReference,s=e.spatialReference;o.equals(s)||(r*=(0,Nt.c9)(o)/(0,Nt.c9)(s)),(0,jn.lv)(i,t,r,this._mapBounds),this._updateZMax()}},{key:"_updateZMax",value:function(){var e=this._editGeometryOperations.data;if(e.geometry.hasZ){var t,n=e.coordinateHelper,i=Number.NEGATIVE_INFINITY,a=(0,j.Z)(e.components);try{for(a.s();!(t=a.n()).done;){var r,o=t.value,s=(0,j.Z)(o.vertices);try{for(s.s();!(r=s.n()).done;){var l,u=r.value,c=null!==(l=n.getZ(u.pos))&&void 0!==l?l:0;i=Math.max(c,i)}}catch(p){s.e(p)}finally{s.f()}}}catch(p){a.e(p)}finally{a.f()}this._zmax=i}else this._zmax=0}},{key:"_updateDisplayBounds",value:function(){var e=this.graphic.geometry;if(!(0,c.Wi)(e)){var t=e.extent;if(t){var n=(0,c.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,c.pC)(this._outlineVisualElement.attachmentOrigin)?this._outlineVisualElement.attachmentOrigin:(0,Ze.du)(this.view,this.graphic);this._attachmentOrigin=(0,c.Pt)(n,t.center);var i=(0,c.pC)(n)?n.z:(0,_e.w7)(this._mapBounds.origin,this.view.elevationProvider,ae.o.fromElevationInfo((0,_.RL)(this.graphic)),this.view.renderCoordsHelper),a=(0,Xn.c)(this._mapBounds);a.origin[2]=null!==i&&void 0!==i?i:0,(0,jn.ny)(a,this.view.renderCoordsHelper,e.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators()}}}},{key:"_displayBoundsMargin",get:function(){var e,t=this.view.pointsOfInterest,n=t?t.centerOnSurfaceFrequent.location:null===(e=this._editGeometryOperations.data.geometry.extent)||void 0===e?void 0:e.center;return n?qn*this.view.pixelSizeAt(n):0}},{key:"_createMoveXYGraphicDragPipeline",value:function(){var e=this;return this._graphicMoveManipulation.createDragPipeline((function(t,n,i){return e._applyGraphicMoveSteps(n,i,ht.XY)}))}},{key:"_createMoveZDragPipeline",value:function(){var e=this,t=this.view,n=this._editGeometryOperations.data.spatialReference;return(0,lt.Xd)(this._moveZManipulator,(function(i,a,r){var o=(0,g.a)(i.renderLocation),s=a.next((0,st.Sp)(t,o,n)).next((0,lt.zh)());e._applyGraphicMoveSteps(s,r,ht.Z)}))}},{key:"_applyGraphicMoveSteps",value:function(e,t,n){var i=this,a=e.next((function(e){return"start"===e.action&&(i.inputState={type:"move"},i._updateOperationStartProperties(),i.emit("graphic-translate-start",{graphic:i.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e})).next((0,lt.AN)()).next(this._moveDragUpdateGeometry()).next((function(e){var t,n,a={graphic:i.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||(null!==(t=e.mapEnd.z)&&void 0!==t?t:0)-(null!==(n=e.mapStart.z)&&void 0!==n?n:0))&&i.emit("graphic-translate",a);break;case"end":i.inputState=null,i.emit("graphic-translate-stop",a)}return e})).next((function(e){return i._updateMoveTooltip(e,n)}));return t.next((function(){(0,c.pC)(i.inputState)&&i.emit("graphic-translate-stop",{graphic:i.graphic,dxScreen:0,dyScreen:0}),i._cancel()})),a}},{key:"_updateOperationStartProperties",value:function(){(0,Xn.c)(this._displayBounds,this._displayBoundsStart),(0,Xn.c)(this._mapBounds,this._mapBoundsStart),(0,c.Wi)(this.graphic.geometry)?this._sizeStart=null:this._sizeStart=(0,jn.NI)(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped)}},{key:"_moveDragUpdateGeometry",value:function(){var e=this;return function(t){if((0,c.Wi)(e.inputState)||"move"!==e.inputState.type)return t;var n,i=[],a=(0,j.Z)(e._editGeometryOperations.data.components);try{for(a.s();!(n=a.n()).done;){var r=n.value;i.push.apply(i,(0,b.Z)(r.vertices))}}catch(l){a.e(l)}finally{a.f()}var o="start"===t.action?Kt.O.NEW_STEP:Kt.O.ACCUMULATE_STEPS,s=e._editGeometryOperations.moveVertices(i,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,o);return(0,jn.nn)(s,e._mapBounds),e.graphic.geometry=e._editGeometryOperations.data.geometry,t}}},{key:"_updateMoveTooltip",value:function(e,t){if(t===ht.XY||t===ht.XY_AXIS){var n=(0,D.GQ)(e.mapStart,e.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");(0,c.pC)(n)&&(0,c.pC)(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=n)}return e}},{key:"_onResizeGrab",value:function(e){var t=e.action,n=e.screenPoint;if("start"===t&&n){var i=this._calculatePickRay(n);(0,Ft.BR)(this._displayBounds.plane,i,rt.WM.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"})}}},{key:"_createResizeDragPipeline",value:function(e,t){var n=this;return(0,lt.Xd)(e,(function(e,a,r){var o;(0,c.Wi)(n.inputState)||((o=a.next((function(e){return"start"===e.action&&n.emit("graphic-scale-start",{graphic:n.graphic,xScale:1,yScale:1}),e})).next((0,st._N)(n.view,n._displayBoundsStart.plane)).next((function(e){return(0,i.Z)((0,i.Z)({},e),{},{handle:t})})).next(n._resizeDragRenderPlaneToFactors())).next.apply(o,(0,b.Z)(n._preserveAspectRatio.createDragEventPipelineStep())).next(n._resizeDragUpdateGeometry()).next((function(e){var t={graphic:n.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":n.emit("graphic-scale",t);break;case"end":n.inputState=null,n.emit("graphic-scale-stop",t)}return e})),r.next((function(){(0,c.pC)(n.inputState)&&n.emit("graphic-scale-stop",{graphic:n.graphic,xScale:1,yScale:1}),n._cancel()})))}))}},{key:"_resizeDragRenderPlaneToFactors",value:function(){var e=this;return function(t){var n=e._displayBoundsStart,a=t.handle.direction,r=e._displayBoundsMargin,o=e._displayBoundsMarginStart,s=(0,f.c)(rt.WM.get(),n.origin);(0,f.z)(s,s,n.basis1,-a[0]),(0,f.z)(s,s,n.basis2,-a[1]);var l=(0,f.b)(rt.WM.get(),t.renderEnd,s),u=(0,f.b)(rt.WM.get(),t.renderStart,s),c=(0,Yn.J0)(t.handle),p=(0,Yn.Lw)(n),h=(0,Yn.Lw)(e._displayBounds)/p,d=function(e,t){if(0===e)return 1;var n=(0,f.l)(t),i=.5*e*(0,f.e)(t,l)/n,a=i<0?-1:1;c&&(i+=(n-.5*e*(0,f.e)(t,u)/n)*a*h);var s=n<1.5*o?1:Kn;return n=Math.max(n-o,Kn),a>0&&(i-=r),a*Math.max(a*(i/n),s)};return(0,i.Z)((0,i.Z)({},t),{},{factor1:d(a[0],n.basis1),factor2:d(a[1],n.basis2)})}}},{key:"_resizeDragUpdateGeometry",value:function(){var e=this;return function(t){var n=(0,f.c)((0,g.c)(),e._mapBoundsStart.origin);(0,f.z)(n,n,e._mapBoundsStart.basis1,-t.handle.direction[0]),(0,f.z)(n,n,e._mapBoundsStart.basis2,-t.handle.direction[1]);var i=(0,O.s)((0,A.a)(),e._mapBoundsStart.basis1[0],e._mapBoundsStart.basis1[1]);(0,O.f)(i,i);var a,r=[],o=(0,j.Z)(e._editGeometryOperations.data.components);try{for(o.s();!(a=o.n()).done;){var s=a.value;r.push.apply(r,(0,b.Z)(s.vertices))}}catch(c){o.e(c)}finally{o.f()}var l="start"===t.action?Kt.O.NEW_STEP:Kt.O.ACCUMULATE_STEPS,u=e._editGeometryOperations.scaleVertices(r,n,i,t.factor1,t.factor2,l,Fn.w.REPLACE);return(0,Xn.c)(e._mapBoundsStart,e._mapBounds),(0,jn.nn)(u,e._mapBounds),e.graphic.geometry=e._editGeometryOperations.data.geometry,t}}},{key:"_onRotateGrab",value:function(e){var t=e.action,n=e.screenPoint;if("start"===t&&n){var i=(0,Yn.Rd)(this._displayBounds,this.view.renderCoordsHelper,Yn.aZ.HEADING,(0,Ft.Ue)()),a=this._calculatePickRay(n);(0,Ft.BR)(i,a,rt.WM.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:i})}}},{key:"_createRotateDragPipeline",value:function(e){var t=this;return(0,lt.Xd)(e,(function(e,n,i){var a=t.inputState;(0,c.Wi)(a)||(n.next((function(e){return"start"===e.action&&t.emit("graphic-rotate-start",{graphic:t.graphic,angle:0}),e})).next((0,st._N)(t.view,a.rotatePlane)).next(t._rotateDragRenderPlaneToRotate(a)).next(t._rotateDragUpdateGeometry()).next((function(e){var n={graphic:t.graphic,angle:(0,Ge.BV)(e.rotateAngle)};switch(e.action){case"start":case"update":t.emit("graphic-rotate",n);break;case"end":t.inputState=null,t.emit("graphic-rotate-stop",n)}return e})),i.next((function(){(0,c.pC)(t.inputState)&&t.emit("graphic-rotate-stop",{graphic:t.graphic,angle:0}),t._cancel()})))}))}},{key:"_rotateDragRenderPlaneToRotate",value:function(e){var t=this;return function(n){var a=(0,Ft.mJ)(e.rotatePlane),r=(0,Ze.Gd)(n.renderStart,n.renderEnd,t._displayBounds.origin,a);return(0,i.Z)((0,i.Z)({},n),{},{rotateAxis:a,rotateAngle:r})}}},{key:"_rotateDragUpdateGeometry",value:function(){var e=this;return function(t){var n,i=(0,f.c)((0,g.c)(),e._mapBoundsStart.origin),a=[],r=(0,j.Z)(e._editGeometryOperations.data.components);try{for(r.s();!(n=r.n()).done;){var o=n.value;a.push.apply(a,(0,b.Z)(o.vertices))}}catch(u){r.e(u)}finally{r.f()}var s="start"===t.action?Kt.O.NEW_STEP:Kt.O.ACCUMULATE_STEPS,l=e._editGeometryOperations.rotateVertices(a,i,t.rotateAngle,s,Fn.w.REPLACE);return(0,Xn.c)(e._mapBoundsStart,e._mapBounds),(0,jn.nn)(l,e._mapBounds),e.graphic.geometry=e._editGeometryOperations.data.geometry,t}}},{key:"_calculatePickRay",value:function(e){var t=(0,Sn.Ue)(),n=(0,m.md)(e);return(0,Un.u4)(this.view.state.camera,n,t),(0,f.n)(t.direction,t.direction),t}},{key:"_updateManipulators",value:function(){var e=this;if(this.visible){var t=(0,Yn.zY)(this._displayBounds,rt.MP.get());(0,Yn.A5)(this._rotateManipulator,t,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,t),this._resizeManipulators.forEach((function(n,i){(0,Yn.EC)(n,e._resizeHandles[i],t,e._displayBounds)}))}}},{key:"_updateZMoveHandle",value:function(e,t){var n=this._displayBounds,i={basis:n.basis1,direction:-1,position:(0,f.b)(rt.WM.get(),n.origin,n.basis1),edge:2},a=rt.MP.get();(0,it.o)(a,t,i.edge*Math.PI/2),a[12]=0,a[13]=0,a[14]=0,e.modelTransform=a,e.renderLocation=i.position}},{key:"_cancel",value:function(){var e=this._editGeometryOperations.lastOperation;(0,c.Wi)(e)||(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,jn.mO)(e,this._mapBounds),this._updateDisplayBounds(),this.inputState=null)}},{key:"canUndo",get:function(){return this._editGeometryOperations.canUndo}},{key:"undo",value:function(){if((0,c.pC)(this.inputState))this.view.activeTool=null;else if(this.canUndo){var e=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,jn.mO)((0,c.Wg)(e),this._mapBounds),this._updateDisplayBounds()}}},{key:"canRedo",get:function(){return this._editGeometryOperations.canRedo}},{key:"redo",value:function(){if(this.canRedo){var e=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,jn.nn)((0,c.Wg)(e),this._mapBounds),this._updateDisplayBounds()}}},{key:"test",get:function(){return{resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}}]),n}(J.Z.EventedMixin(Zt.m));(0,l._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],Qn.prototype,"view",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],Qn.prototype,"graphic",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],Qn.prototype,"enableZ",void 0),(0,l._)([(0,h.Cb)()],Qn.prototype,"enableRotation",void 0),(0,l._)([(0,h.Cb)()],Qn.prototype,"enableScaling",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0,type:Rt.Z})],Qn.prototype,"tooltipOptions",void 0),(0,l._)([(0,h.Cb)()],Qn.prototype,"preserveAspectRatio",null),(0,l._)([(0,h.Cb)()],Qn.prototype,"grabbing",void 0),(0,l._)([(0,h.Cb)()],Qn.prototype,"inputState",void 0),(0,l._)([(0,h.Cb)({readOnly:!0})],Qn.prototype,"type",void 0),(0,l._)([(0,h.Cb)()],Qn.prototype,"_moveUnit",null),Qn=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Qn);var Jn="draped-elevation-changes",qn=10,$n=80,Kn=1e-6},81655:function(e,t,n){n.d(t,{c:function(){return r},t:function(){return o}});var i=n(92026),a=n(74509);function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,a.RL)(e);return"on-the-ground"!==t.mode&&!((0,i.Wi)(e.geometry)||!e.geometry.hasZ)}function o(e,t){var n=null,a=e.events.on("grab-changed",(function(a){(0,i.pC)(n)&&(n.remove(),n=null),"start"===a.action?(n=e.disableDisplay(),t&&t(a)):t&&t(a)}));return{remove:function(){(0,i.pC)(n)&&n.remove(),a.remove()}}}},33837:function(e,t,n){n.d(t,{r:function(){return y}});var i=n(37762),a=n(15671),r=n(43144),o=n(60136),s=n(92572),l=n(92026),u=n(14226),c=n(81949),p=n(11186),h=n(71353),d=n(67077),v=n(52168),f=n(79685),g=n(56529),_=n(58901),y=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,i){var r;return(0,a.Z)(this,n),(r=t.call(this,e))._hasExternalMaterial=!1,r._hasExternalMaterial=(0,l.pC)(i),r._material=(0,l.pC)(i)?i:new _.U({width:1,color:(0,d.f)(1,0,1,1),stippleOffColor:null,stipplePattern:null,stipplePreferContinuous:!0,isClosed:!1,falloff:0,innerColor:null,innerWidth:1,hasPolygonOffset:!1,renderOccluded:g.yD.OccludeAndTransparent,writeDepth:!0}),r.applyProps(e),r}return(0,r.Z)(n,[{key:"setGeometryFromRenderSpacePoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.geometry=[[[e[0]-t,e[1]+0,e[2]+0],[e[0]+t,e[1]+0,e[2]+0]],[[e[0]-0,e[1]-t,e[2]+0],[e[0]+0,e[1]+t,e[2]+0]],[[e[0]-0,e[1]+0,e[2]-t],[e[0]+0,e[1]+0,e[2]+t]]]}},{key:"setGeometryFromExtent",value:function(e){var t=this.view.spatialReference,n=(0,h.c)(),i=(0,h.c)(),a=100,r=[];(0,p.s)(n,e[0],e[1],a),this.view.renderCoordsHelper.toRenderCoords(n,t,i),r.push([i[0],i[1],i[2]]),(0,p.s)(n,e[2],e[1],a),this.view.renderCoordsHelper.toRenderCoords(n,t,i),r.push([i[0],i[1],i[2]]),(0,p.s)(n,e[2],e[3],a),this.view.renderCoordsHelper.toRenderCoords(n,t,i),r.push([i[0],i[1],i[2]]),(0,p.s)(n,e[0],e[3],a),this.view.renderCoordsHelper.toRenderCoords(n,t,i),r.push([i[0],i[1],i[2]]),(0,p.s)(n,e[0],e[1],a),this.view.renderCoordsHelper.toRenderCoords(n,t,i),r.push([i[0],i[1],i[2]]),(0,p.s)(n,e[0],e[1],a),this.view.renderCoordsHelper.toRenderCoords(n,t,i),r.push([i[0],i[1],i[2]]),this.geometry=[r]}},{key:"setGeometryFromFrustum",value:function(e){var t=[];e.lines.forEach((function(e){t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}},{key:"setGeometryFromBoundedPlane",value:function(e){var t=[],n=e.origin,i=e.basis1,a=e.basis2,r=.5,o=(0,h.c)(),s=(0,h.c)(),l=(0,h.c)(),u=(0,h.c)();o[0]=n[0]-i[0]*r-a[0]*r,o[1]=n[1]-i[1]*r-a[1]*r,o[2]=n[2]-i[2]*r-a[2]*r,s[0]=n[0]-i[0]*r+a[0]*r,s[1]=n[1]-i[1]*r+a[1]*r,s[2]=n[2]-i[2]*r+a[2]*r,l[0]=n[0]+i[0]*r+a[0]*r,l[1]=n[1]+i[1]*r+a[1]*r,l[2]=n[2]+i[2]*r+a[2]*r,u[0]=n[0]+i[0]*r-a[0]*r,u[1]=n[1]+i[1]*r-a[1]*r,u[2]=n[2]+i[2]*r-a[2]*r,t.push([o[0],o[1],o[2]]),t.push([s[0],s[1],s[2]]),t.push([l[0],l[1],l[2]]),t.push([u[0],u[1],u[2]]),t.push([o[0],o[1],o[2]]),this.geometry=[t]}},{key:"setGeometryFromSegment",value:function(e){var t=e.endRenderSpace;this.transform=(0,u.f)(m,t);var n=e.createRenderGeometry(t,this.view.renderCoordsHelper).points;this.geometry=[n]}},{key:"setGeometryFromSegments",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.Z;this.transform=(0,u.f)(m,n),this.geometry=e.map((function(e){return e.createRenderGeometry(n,t.view.renderCoordsHelper).points}))}},{key:"getTransformedGeometry",value:function(){var e=this;return(0,l.Wi)(this._geometry)?null:this._geometry.map((function(t){return t.map((function(t){return(0,p.m)((0,h.c)(),t,e.transform)}))}))}},{key:"renderOccluded",get:function(){return this._material.parameters.renderOccluded},set:function(e){this._material.setParameters({renderOccluded:e})}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.recreateGeometry()}},{key:"width",get:function(){return this._material.parameters.width},set:function(e){this._material.setParameters({width:e})}},{key:"color",get:function(){return this._material.parameters.color},set:function(e){this._material.setParameters({color:(0,d.d)(e)})}},{key:"innerWidth",get:function(){return this._material.parameters.innerWidth},set:function(e){this._material.setParameters({innerWidth:e})}},{key:"innerColor",get:function(){return this._material.parameters.innerColor},set:function(e){this._material.setParameters({innerColor:(0,l.pC)(e)?(0,d.d)(e):null})}},{key:"stipplePattern",get:function(){return this._material.parameters.stipplePattern},set:function(e){(0,l.pC)(this._material)&&this._material.setParameters({stipplePattern:e})}},{key:"stippleOffColor",get:function(){return this._material.parameters.stippleOffColor},set:function(e){this._material.setParameters({stippleOffColor:(0,l.pC)(e)?(0,d.d)(e):null})}},{key:"stipplePreferContinuous",get:function(){return this._material.parameters.stipplePreferContinuous},set:function(e){this._material.setParameters({stipplePreferContinuous:e})}},{key:"writeDepthEnabled",get:function(){return this._material.parameters.writeDepth},set:function(e){this._material.setParameters({writeDepth:e})}},{key:"falloff",get:function(){return this._material.parameters.falloff},set:function(e){this._material.setParameters({falloff:e})}},{key:"polygonOffset",get:function(){return this._material.parameters.hasPolygonOffset},set:function(e){this._material.setParameters({hasPolygonOffset:e})}},{key:"createExternalResources",value:function(){}},{key:"destroyExternalResources",value:function(){}},{key:"createGeometries",value:function(e){var t,n=(0,i.Z)((0,f.c)(this.geometry));try{for(n.s();!(t=n.n()).done;){var a=t.value,r=(0,f.Y)((0,l.Wg)(this._material),a);e.addGeometry(r)}}catch(o){n.e(o)}finally{n.f()}}},{key:"forEachExternalMaterial",value:function(e){this._hasExternalMaterial||e((0,l.Wg)(this._material))}}]),n}(v._),m=(0,c.c)()},52168:function(e,t,n){n.d(t,{_:function(){return v}});var i=n(15671),a=n(43144),r=n(60136),o=n(92572),s=n(92026),l=n(14226),u=n(81949),c=n(86244),p=n(66327),h=n(78485),d=n(97882),v=function(e){(0,r.Z)(n,e);var t=(0,o.Z)(n);function n(e){var a;return(0,i.Z)(this,n),(a=t.call(this,e.view))._resources=null,a._transform=(0,u.c)(),a}return(0,a.Z)(n,[{key:"object",get:function(){return(0,s.pC)(this._resources)?this._resources.object:null}},{key:"transform",get:function(){return this._transform},set:function(e){(0,l.c)(this._transform,e),(0,s.pC)(this._resources)&&(this._resources.object.transformation=this._transform)}},{key:"recreate",value:function(){this.attached&&this.createResources()}},{key:"recreateGeometry",value:function(){if(!(0,s.Wi)(this._resources)){var e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,t.addMany(e.geometries)}}},{key:"createResources",value:function(){this.destroyResources();var e=this.view._stage;if(e){var t=new d.F({pickable:!1,updatePolicy:h.j.SYNC});e.add(t);var n=new p.T({castShadow:!1});n.transformation=this._transform,this.createExternalResources(),this.createGeometries(n),e.addMany(n.geometries),this.forEachExternalMaterial((function(t){return e.add(t)})),e.add(n),t.add(n),n.visible=this.visible,this._resources={layer:t,object:n}}}},{key:"destroyResources",value:function(){var e=this.view._stage;!(0,s.Wi)(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial((function(t){e.remove(t),t.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}},{key:"updateVisibility",value:function(e){(0,s.Wi)(this._resources)||(this._resources.object.visible=e)}}]),n}(c.l)},86244:function(e,t,n){n.d(t,{l:function(){return o}});var i=n(15671),a=n(43144),r=n(94172),o=function(){function e(t){var n=this;(0,i.Z)(this,e),this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=t,this._handle=(0,r.YP)((function(){return n.view.ready}),(function(e){n._resourcesCreated&&(e?n._createResources():n._destroyResources())}))}return(0,a.Z)(e,[{key:"applyProps",value:function(e){var t=!1;for(var n in e)n in this?"attached"===n?t=e[n]:this[n]=e[n]:console.error("Cannot set unknown property",n);this.attached=t}},{key:"destroy",value:function(){this.attached=!1,this._handle.remove()}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}},{key:"onAttachedChange",value:function(e){}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}},{key:"_createResources",value:function(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}},{key:"_destroyResources",value:function(){this.destroyResources(),this._resourcesCreated=!1}}]),e}()},17539:function(e,t,n){n.d(t,{Z:function(){return b}});var i=n(15671),a=n(43144),r=n(16889),o=n(92026),s=n(68860),l=n(14226),u=n(11186),c=n(18722);function p(e){return t=e,(0,c.xZ)(t)&&t.length>=3||function(e){return((0,c.fS)(e)||Array.isArray(e))&&e.length>=3}(e);var t}var h=n(79803),d=n(14320),v=n(85305),f=n(55652),g=n(40927),_=n(51378),y=n(81020),m=n(50951),M=n(92028),b=function(){function e(t,n,a,r){(0,i.Z)(this,e),this.viewingMode=t,this.spatialReference=n,this.unitInMeters=a,this._coordinateSystem=r,this._tmpCoordinateSystem=(0,v.Ue)(r)}return(0,a.Z)(e,[{key:"extent",set:function(e){e&&(0,v.qf)(this._coordinateSystem,e,this._coordinateSystem)}},{key:"getAltitude",value:function(e){return(0,v.id)(this._coordinateSystem,e)}},{key:"setAltitude",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;return(0,v.Is)(this._coordinateSystem,n,t,e)}},{key:"setAltitudeOfTransformation",value:function(e,t){(0,v.rF)(this._coordinateSystem,t,e,t)}},{key:"worldUpAtPosition",value:function(e,t){return(0,v.P0)(this._coordinateSystem,e,t)}},{key:"worldBasisAtPosition",value:function(e,t,n){return(0,v.Kf)(this._coordinateSystem,e,t,n)}},{key:"basisMatrixAtPosition",value:function(e,t){var n=this.worldBasisAtPosition(e,d.R.X,_.WM.get()),i=this.worldBasisAtPosition(e,d.R.Y,_.WM.get()),a=this.worldBasisAtPosition(e,d.R.Z,_.WM.get());return(0,l.s)(t,n[0],n[1],n[2],0,i[0],i[1],i[2],0,a[0],a[1],a[2],0,0,0,0,1),t}},{key:"headingAtPosition",value:function(e,t){var n=this.worldUpAtPosition(e,_.WM.get()),i=this.worldBasisAtPosition(e,d.R.Y,_.WM.get()),a=(0,g.cp)(t,i,n);return(0,r.BV)(a)}},{key:"intersectManifoldClosestSilhouette",value:function(e,t,n){return(0,v.NE)(this._coordinateSystem,t,this._tmpCoordinateSystem),(0,v.ej)(this._tmpCoordinateSystem,e,n),n}},{key:"intersectManifold",value:function(e,t,n){(0,v.NE)(this._coordinateSystem,t,this._tmpCoordinateSystem);var i=_.WM.get();return(0,v.BR)(this._tmpCoordinateSystem,e,i)?(0,u.c)(n,i):null}},{key:"intersectInfiniteManifold",value:function(e,t,n){if(this.viewingMode===m.JY.Global)return this.intersectManifold(e,t,n);(0,v.NE)(this._coordinateSystem,t,this._tmpCoordinateSystem);var i=this._tmpCoordinateSystem.value,a=_.WM.get();return(0,f.BR)(i.plane,e,a)?(0,u.c)(n,a):null}},{key:"toRenderCoords",value:function(e,t,n){return(0,y.f)(e)?(0,h.KC)(e,t,this.spatialReference):(0,h.SH)(e,t,n,this.spatialReference)}},{key:"fromRenderCoords",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,y.f)(t)?((0,o.pC)(n)&&(t.spatialReference=n),(0,h.MT)(e,this.spatialReference,t)):p(t)?(0,h.SH)(e,this.spatialReference,t,n)?t:null:(0,h.fA)(e,this.spatialReference,t)}}],[{key:"create",value:function(t,n){switch(t){case m.JY.Local:return new e(m.JY.Local,n,(0,s.c9)(n),(0,v.pb)());case m.JY.Global:return new e(m.JY.Global,n,1,(0,v.pt)(n))}}},{key:"renderUnitScaleFactor",value:function(e,t){return S(e)/S(t)}}]),e}();function S(e){if((0,M.D)(e,m.JY.Global))return 1;var t=(0,v.E2)(!1,e);return(0,s.c9)(t)}},81703:function(e,t,n){n.d(t,{Bh:function(){return u},eW:function(){return p},iE:function(){return c},u4:function(){return l}});var i=n(92026),a=n(17842),r=n(88396),o=n(11186),s=n(51378);function l(e,t,n){return u(e,e.screenToRender(t,(0,a.Wv)(s.WM.get())),n)}function u(e,t,n){var l=(0,a.Wv)((0,r.c)(s.WM.get(),t));if(l[2]=0,!e.unprojectFromRenderScreen(l,n.origin))return null;var u=(0,a.Wv)((0,r.c)(s.WM.get(),t));u[2]=1;var c=e.unprojectFromRenderScreen(u,s.WM.get());return(0,i.Wi)(c)?null:((0,o.b)(n.direction,c,n.origin),n)}function c(e,t,n){return p(e,e.screenToRender(t,(0,a.Wv)(s.WM.get())),n)}function p(e,t,n){(0,o.c)(n.origin,e.eye);var a=(0,o.s)(s.WM.get(),t[0],t[1],1),r=e.unprojectFromRenderScreen(a,s.WM.get());return(0,i.Wi)(r)?null:((0,o.b)(n.direction,r,n.origin),n)}},63920:function(e,t,n){var i;n.d(t,{t:function(){return i}}),function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(i||(i={}))},7068:function(e,t,n){n.d(t,{c:function(){return h},p:function(){return d}});var i=n(43144),a=n(15671),r=n(60136),o=n(92572),s=n(27366),l=n(47898),u=n(49861),c=n(69912),p=n(4943),h=function(e){(0,r.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="extent-rotate",i.angle=0,i}return(0,i.Z)(n)}(p.h);(0,s._)([(0,u.Cb)()],h.prototype,"type",void 0),(0,s._)([(0,u.Cb)()],h.prototype,"angle",void 0),h=(0,s._)([(0,c.j)("esri.views.interactive.tooltip.ExtentRotateTooltipInfo")],h);var d=function(e){(0,r.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="extent-scale",i.xScale=0,i.yScale=0,i.xSize=l.yP,i.ySize=l.yP,i}return(0,i.Z)(n)}(p.h);(0,s._)([(0,u.Cb)()],d.prototype,"type",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"xScale",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"yScale",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"xSize",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"ySize",void 0),d=(0,s._)([(0,c.j)("esri.views.interactive.tooltip.ExtentScaleTooltipInfo")],d)},40524:function(e,t,n){n.d(t,{$E:function(){return h},QW:function(){return d},c1:function(){return _},in:function(){return v},j:function(){return g},nk:function(){return f}});var i=n(43144),a=n(15671),r=n(60136),o=n(92572),s=n(27366),l=n(47898),u=n(49861),c=n(69912),p=n(4943),h=function(e){(0,r.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="translate-graphic",i.distance=l.yP,i}return(0,i.Z)(n)}(p.h);(0,s._)([(0,u.Cb)()],h.prototype,"type",void 0),(0,s._)([(0,u.Cb)()],h.prototype,"distance",void 0),h=(0,s._)([(0,c.j)("esri.views.interactive.tooltip.TranslateGraphicTooltipInfo")],h);var d=function(e){(0,r.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="translate-graphic-z",i.distance=l.yP,i}return(0,i.Z)(n)}(p.h);(0,s._)([(0,u.Cb)()],d.prototype,"type",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"distance",void 0),d=(0,s._)([(0,c.j)("esri.views.interactive.tooltip.TranslateGraphicZTooltipInfo")],d);var v=function(e){(0,r.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="translate-graphic-xy",i.distance=l.yP,i}return(0,i.Z)(n)}(p.h);(0,s._)([(0,u.Cb)()],v.prototype,"type",void 0),(0,s._)([(0,u.Cb)()],v.prototype,"distance",void 0),v=(0,s._)([(0,c.j)("esri.views.interactive.tooltip.TranslateGraphicXYTooltipInfo")],v);var f=function(e){(0,r.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="translate-vertex",i.distance=l.yP,i.elevation=null,i.area=null,i.totalLength=null,i}return(0,i.Z)(n)}(p.h);(0,s._)([(0,u.Cb)()],f.prototype,"type",void 0),(0,s._)([(0,u.Cb)()],f.prototype,"distance",void 0),(0,s._)([(0,u.Cb)()],f.prototype,"elevation",void 0),(0,s._)([(0,u.Cb)()],f.prototype,"area",void 0),(0,s._)([(0,u.Cb)()],f.prototype,"totalLength",void 0),f=(0,s._)([(0,c.j)("esri.views.interactive.tooltip.TranslateVertexTooltipInfo")],f);var g=function(e){(0,r.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="translate-vertex-z",i.distance=l.yP,i.elevation=null,i}return(0,i.Z)(n)}(p.h);(0,s._)([(0,u.Cb)()],g.prototype,"type",void 0),(0,s._)([(0,u.Cb)()],g.prototype,"distance",void 0),(0,s._)([(0,u.Cb)()],g.prototype,"elevation",void 0),g=(0,s._)([(0,c.j)("esri.views.interactive.tooltip.TranslateVertexZTooltipInfo")],g);var _=function(e){(0,r.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="translate-vertex-xy",i.distance=l.yP,i.elevation=null,i.area=null,i.totalLength=null,i}return(0,i.Z)(n)}(p.h);(0,s._)([(0,u.Cb)()],_.prototype,"type",void 0),(0,s._)([(0,u.Cb)()],_.prototype,"distance",void 0),(0,s._)([(0,u.Cb)()],_.prototype,"elevation",void 0),(0,s._)([(0,u.Cb)()],_.prototype,"area",void 0),(0,s._)([(0,u.Cb)()],_.prototype,"totalLength",void 0),_=(0,s._)([(0,c.j)("esri.views.interactive.tooltip.TranslateVertexXYTooltipInfo")],_)},92028:function(e,t,n){n.d(t,{D:function(){return r}});var i=n(72619),a=n(50951);function r(e,t){return null!=e&&(null==t||(t===a.JY.Local?!e.isGeographic||e.isWGS84||e.wkid===i.W.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===i.W.CGCS2000||e.wkid===i.W.GCSMARS2000||e.wkid===i.W.GCSMARS2000_SPHERE||e.wkid===i.W.GCSMOON2000))}}}]);
//# sourceMappingURL=81.c22e5546.chunk.js.map