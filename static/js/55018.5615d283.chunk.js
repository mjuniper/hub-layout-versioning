"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[55018],{62044:function(e,t,n){n.d(t,{Z:function(){return g}});var r,i=n(15671),a=n(43144),l=n(60136),s=n(92572),o=n(27366),u=n(46784),c=n(92026),d=n(86710),f=n(49861),y=(n(25243),n(63780),n(38511)),h=n(69912),p=n(31201),v=r=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).end=null,r.start=null,r}return(0,a.Z)(n,[{key:"readEnd",value:function(e,t){return null!=t.end?new Date(t.end):null}},{key:"writeEnd",value:function(e,t){t.end=e?e.getTime():null}},{key:"isAllTime",get:function(){return this.equals(r.allTime)}},{key:"isEmpty",get:function(){return this.equals(r.empty)}},{key:"readStart",value:function(e,t){return null!=t.start?new Date(t.start):null}},{key:"writeStart",value:function(e,t){t.start=e?e.getTime():null}},{key:"clone",value:function(){return new r({end:this.end,start:this.start})}},{key:"equals",value:function(e){if(!e)return!1;var t=(0,c.pC)(this.start)?this.start.getTime():this.start,n=(0,c.pC)(this.end)?this.end.getTime():this.end,r=(0,c.pC)(e.start)?e.start.getTime():e.start,i=(0,c.pC)(e.end)?e.end.getTime():e.end;return t===r&&n===i}},{key:"expandTo",value:function(e){if(this.isEmpty||this.isAllTime)return this.clone();var t=(0,c.yw)(this.start,(function(t){return(0,d.JE)(t,e)})),n=(0,c.yw)(this.end,(function(t){var n=(0,d.JE)(t,e);return t.getTime()===n.getTime()?n:(0,d.Nm)(n,1,e)}));return new r({start:t,end:n})}},{key:"intersection",value:function(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return r.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();var t,n,i=(0,c.R2)(this.start,-1/0,(function(e){return e.getTime()})),a=(0,c.R2)(this.end,1/0,(function(e){return e.getTime()})),l=(0,c.R2)(e.start,-1/0,(function(e){return e.getTime()})),s=(0,c.R2)(e.end,1/0,(function(e){return e.getTime()}));if(l>=i&&l<=a?t=l:i>=l&&i<=s&&(t=i),a>=l&&a<=s?n=a:s>=i&&s<=a&&(n=s),null!=t&&null!=n&&!isNaN(t)&&!isNaN(n)){var o=new r;return o.start=t===-1/0?null:new Date(t),o.end=n===1/0?null:new Date(n),o}return r.empty}},{key:"offset",value:function(e,t){if(this.isEmpty||this.isAllTime)return this.clone();var n=new r,i=this.start,a=this.end;return(0,c.pC)(i)&&(n.start=(0,d.Nm)(i,e,t)),(0,c.pC)(a)&&(n.end=(0,d.Nm)(a,e,t)),n}},{key:"union",value:function(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return m.clone();var t=(0,c.pC)(this.start)&&(0,c.pC)(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,n=(0,c.pC)(this.end)&&(0,c.pC)(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new r({start:t,end:n})}}],[{key:"allTime",get:function(){return m}},{key:"empty",get:function(){return b}}]),n}(u.wq);(0,o._)([(0,f.Cb)({type:Date,json:{write:{allowNull:!0}}})],v.prototype,"end",void 0),(0,o._)([(0,y.r)("end")],v.prototype,"readEnd",null),(0,o._)([(0,p.c)("end")],v.prototype,"writeEnd",null),(0,o._)([(0,f.Cb)({readOnly:!0,json:{read:!1}})],v.prototype,"isAllTime",null),(0,o._)([(0,f.Cb)({readOnly:!0,json:{read:!1}})],v.prototype,"isEmpty",null),(0,o._)([(0,f.Cb)({type:Date,json:{write:{allowNull:!0}}})],v.prototype,"start",void 0),(0,o._)([(0,y.r)("start")],v.prototype,"readStart",null),(0,o._)([(0,p.c)("start")],v.prototype,"writeStart",null);var m=new(v=r=(0,o._)([(0,h.j)("esri.TimeExtent")],v)),b=new v({start:void 0,end:void 0}),g=v},41691:function(e,t,n){n.d(t,{p:function(){return y},r:function(){return h}});var r=n(15671),i=n(43144),a=n(60136),l=n(92572),s=n(27366),o=n(31319),u=n(100),c=n(49861),d=n(69912),f=n(61826),y=function(e){var t=function(e){(0,a.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"destroy",value:function(){var e,t;this.destroyed||(null!==(e=this._get("handles"))&&void 0!==e&&e.destroy(),null===(t=this._get("updatingHandles"))||void 0===t||t.destroy())}},{key:"handles",get:function(){return this._get("handles")||new u.Z}},{key:"updatingHandles",get:function(){return this._get("updatingHandles")||new f.t}}]),n}(e);return(0,s._)([(0,c.Cb)({readOnly:!0})],t.prototype,"handles",null),(0,s._)([(0,c.Cb)({readOnly:!0})],t.prototype,"updatingHandles",null),t=(0,s._)([(0,d.j)("esri.core.HandleOwner")],t),t},h=function(e){(0,a.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n)}(y(o.Z));h=(0,s._)([(0,d.j)("esri.core.HandleOwner")],h)},14921:function(e,t,n){n.d(t,{Ed:function(){return p},UI:function(){return v},mt:function(){return L},q6:function(){return _},vr:function(){return x},w6:function(){return C}});var r=n(74165),i=n(15671),a=n(43144),l=n(60136),s=n(92572),o=n(15861),u=n(27366),c=n(31319),d=n(92026),f=n(66978),y=n(49861),h=(n(25243),n(63780),n(69912));function p(e,t,n){return(0,f.as)(e.map((function(e,r){return t.apply(n,[e,r])})))}function v(e,t,n){return m.apply(this,arguments)}function m(){return(m=(0,o.Z)((0,r.Z)().mark((function e(t,n,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.as)(t.map((function(e,t){return n.apply(i,[e,t])})));case 2:return e.abrupt("return",e.sent.map((function(e){return e.value})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return{ok:!0,value:e}}function g(e){return{ok:!1,error:e}}function _(e){return w.apply(this,arguments)}function w(){return(w=(0,o.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,d.Wi)(t)){e.next=2;break}return e.abrupt("return",{ok:!1,error:new Error("no promise provided")});case 2:return e.prev=2,e.t0=b,e.next=6,t;case 6:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 10:return e.prev=10,e.t2=e.catch(2),e.abrupt("return",g(e.t2));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function L(e){return k.apply(this,arguments)}function k(){return(k=(0,o.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=b,e.next=4,t;case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 8:return e.prev=8,e.t2=e.catch(0),e.abrupt("return",((0,f.r9)(e.t2),g(e.t2)));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function C(e){if(!0===e.ok)return e.value;throw e.error}function x(e,t){return new S(e,t)}var S=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){var a;(0,i.Z)(this,n),(a=t.call(this,{}))._result=null,a._abortHandle=null,a.abort=function(){a._abortController=(0,d.IM)(a._abortController)},a.remove=a.abort,a._abortController=new AbortController;var l=a._abortController.signal;return a.promise=e(l),a.promise.then((function(e){a._result=b(e),a._cleanup()}),(function(e){a._result=g(e),a._cleanup()})),a._abortHandle=(0,f.fu)(r,a.abort),a}return(0,a.Z)(n,[{key:"value",get:function(){return function(e){return(0,d.pC)(e)&&!0===e.ok?e.value:null}(this._result)}},{key:"error",get:function(){return function(e){return(0,d.pC)(e)&&!1===e.ok?e.error:null}(this._result)}},{key:"finished",get:function(){return(0,d.pC)(this._result)}},{key:"normalizeCtorArgs",value:function(){return{}}},{key:"destroy",value:function(){this.abort()}},{key:"_cleanup",value:function(){this._abortHandle=(0,d.hw)(this._abortHandle),this._abortController=null}}]),n}(c.Z);(0,u._)([(0,y.Cb)()],S.prototype,"value",null),(0,u._)([(0,y.Cb)()],S.prototype,"error",null),(0,u._)([(0,y.Cb)()],S.prototype,"finished",null),(0,u._)([(0,y.Cb)()],S.prototype,"promise",void 0),(0,u._)([(0,y.Cb)()],S.prototype,"_result",void 0),S=(0,u._)([(0,h.j)("esri.core.asyncUtils.ReactiveTask")],S)},41644:function(e,t,n){n.d(t,{Bg:function(){return r},sM:function(){return i}});n(93169);function r(e){}function i(e){return function(){return e}}},76672:function(e,t,n){n.d(t,{E:function(){return l},_:function(){return o}});var r=n(74165),i=n(15861),a=n(92026);function l(e,t){return s.apply(this,arguments)}function s(){return s=(0,i.Z)((0,r.Z)().mark((function e(t,i){var a,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(99779),n.e(48562),n.e(22564)]).then(n.bind(n,48562));case 2:return a=e.sent,l=a.WhereClause,e.abrupt("return",l.create(t,i));case 5:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}function o(e,t){return(0,a.pC)(e)?(0,a.pC)(t)?"(".concat(e,") AND (").concat(t,")"):e:t}},61826:function(e,t,n){n.d(t,{t:function(){return p}});var r=n(15671),i=n(43144),a=n(60136),l=n(92572),s=n(27366),o=n(31319),u=n(100),c=n(92026),d=n(94172),f=n(99346),y=n(49861),h=n(69912),p=function(e){(0,a.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).updating=!1,e._handleId=0,e._handles=new u.Z,e._scheduleHandleId=0,e._pendingPromises=new Set,e}return(0,i.Z)(n,[{key:"destroy",value:function(){this.removeAll(),this._handles.destroy()}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,n,d.YP)}},{key:"addWhen",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,n,d.gx)}},{key:"addOnCollectionChange",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.initial,a=void 0!==i&&i,l=r.final,s=void 0!==l&&l,o=++this._handleId;return this._handles.add([(0,d.on)(e,"after-changes",this._createSyncUpdatingCallback(),d.Z_),(0,d.on)(e,"change",t,{onListenerAdd:a?function(e){return t({added:e.toArray(),removed:[]})}:void 0,onListenerRemove:s?function(e){return t({added:[],removed:e.toArray()})}:void 0})],o),{remove:function(){return n._handles.remove(o)}}}},{key:"addPromise",value:function(e){var t=this;if((0,c.Wi)(e))return e;var n=++this._handleId;this._handles.add({remove:function(){t._pendingPromises.delete(e)&&(0!==t._pendingPromises.size||t._handles.has(v)||t._set("updating",!1))}},n),this._pendingPromises.add(e),this._set("updating",!0);var r=function(){return t._handles.remove(n)};return e.then(r,r),e}},{key:"removeAll",value:function(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}},{key:"_installWatch",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,a=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,a);var l=i(e,t,r);return this._handles.add(l,a),{remove:function(){return n._handles.remove(a)}}}},{key:"_installSyncUpdatingWatch",value:function(e,t){var n=this._createSyncUpdatingCallback(),r=(0,d.YP)(e,n,{sync:!0,equals:function(){return!1}});return this._handles.add(r,t),r}},{key:"_createSyncUpdatingCallback",value:function(){var e=this;return function(){e._handles.remove(v),++e._scheduleHandleId;var t=e._scheduleHandleId;e._get("updating")||e._set("updating",!0),e._handles.add((0,f.Os)((function(){t===e._scheduleHandleId&&(e._set("updating",e._pendingPromises.size>0),e._handles.remove(v))})),v)}}}]),n}(o.Z);(0,s._)([(0,y.Cb)({readOnly:!0})],p.prototype,"updating",void 0),p=(0,s._)([(0,h.j)("esri.core.support.WatchUpdatingTracking")],p);var v=-42},86710:function(e,t,n){n.d(t,{JE:function(){return l},Nm:function(){return a},rJ:function(){return s}});n(93169);var r={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},i={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function a(e,t,n){var r=new Date(e.getTime());if(t&&n){var a=i[n],l=a.getter,s=a.setter,o=a.multiplier;if("months"===n){var u=function(e,t){var n=new Date(e,t+1,1);return n.setDate(0),n.getDate()}(r.getFullYear(),r.getMonth()+t);r.getDate()>u&&r.setDate(u)}r[s](r[l]()+t*o)}return r}function l(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function s(e,t,n){return 0===e?0:e*r[t]/r[n]}},8537:function(e,t,n){n.d(t,{YP:function(){return a}});var r=n(44927),i=(n(98928),n(84652),n(32718));n(66978);(0,r.K)(i.Z.getLogger("esri.core.watchUtils"),"esri/core/watchUtils",{see:"https://arcg.is/1LTnuf",replacement:"esri/core/reactiveUtils",warnOnce:!0,version:"4.24"});function a(e,t,n,r){return e.watch(t,n,r)}},59166:function(e,t,n){n(76969),n(6291),n(8704),n(36257);var r=n(41201),i=n(74165),a=n(15671),l=n(43144),s=n(15861),o=n(76200),u=n(10064),c=n(92026);function d(){return d=(0,s.Z)((0,i.Z)().mark((function e(t,n,a,l){var s,o,c,d,y,h,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.exec(a)){e.next=3;break}throw new u.Z("esri-intl:invalid-bundle",'Bundle id "'.concat(a,'" is not compatible with the pattern "').concat(n,'"'));case 3:return o=s[1]?"".concat(s[1],"/"):"",c=s[2],d=(0,r.Su)(l),y="".concat(o).concat(c,".json"),h=d?"".concat(o).concat(c,"_").concat(d,".json"):y,e.prev=4,e.next=7,f(t(h));case 7:case 17:p=e.sent,e.next=23;break;case 10:if(e.prev=10,e.t0=e.catch(4),h!==y){e.next=14;break}throw new u.Z("intl:unknown-bundle",'Bundle "'.concat(a,'" cannot be loaded'),{error:e.t0});case 14:return e.prev=14,e.next=17,f(t(y));case 20:throw e.prev=20,e.t1=e.catch(14),new u.Z("intl:unknown-bundle",'Bundle "'.concat(a,'" cannot be loaded'),{error:e.t1});case 23:return e.abrupt("return",p);case 24:case"end":return e.stop()}}),e,null,[[4,10],[14,20]])}))),d.apply(this,arguments)}function f(e){return y.apply(this,arguments)}function y(){return(y=(0,s.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,c.pC)(p.fetchBundleAsset)){e.next=2;break}return e.abrupt("return",p.fetchBundleAsset(t));case 2:return e.next=4,(0,o.default)(t,{responseType:"text"});case 4:return n=e.sent,e.abrupt("return",JSON.parse(n.data));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=function(){function e(t){var n,r=t.base,i=void 0===r?"":r,l=t.pattern,s=t.location,o=void 0===s?new URL(window.location.href):s;(0,a.Z)(this,e),n="string"==typeof o?function(e){return new URL(e,new URL(o,window.location.href)).href}:o instanceof URL?function(e){return new URL(e,o).href}:o,this.pattern="string"==typeof l?new RegExp("^".concat(l)):l,this.getAssetUrl=n,i=i?i.endsWith("/")?i:i+"/":"",this.matcher=new RegExp("^".concat(i,"(?:(.*)/)?(.*)$"))}return(0,l.Z)(e,[{key:"fetchMessageBundle",value:function(e,t){return function(e,t,n,r){return d.apply(this,arguments)}(this.getAssetUrl,this.matcher,e,t)}}]),e}();var p={},v=n(65905);(0,r.tz)(function(e){return new h(e)}({pattern:"esri/",location:v.V}))},41201:function(e,t,n){n.d(t,{ME:function(){return g},Su:function(){return w},tz:function(){return b}});var r=n(74165),i=n(15671),a=n(43144),l=n(29439),s=n(15861),o=n(37762),u=n(10064),c=n(66978),d=n(36257),f=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,y={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function h(e){var t;return null!==(t=y[e])&&void 0!==t&&t}var p=[],v=new Map;function m(e){var t,n=(0,o.Z)(v.keys());try{for(n.s();!(t=n.n()).done;){var r=t.value;C(e.pattern,r)&&v.delete(r)}}catch(i){n.e(i)}finally{n.f()}}function b(e){return p.includes(e)||(m(e),p.unshift(e)),{remove:function(){var t=p.indexOf(e);t>-1&&(p.splice(t,1),m(e))}}}function g(e){return _.apply(this,arguments)}function _(){return(_=(0,s.Z)((0,r.Z)().mark((function e(t){var n,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(0,d.Kd)(),v.has(t)||v.set(t,L(t,n)),i=v.get(t),e.t0=i,!e.t0){e.next=7;break}return e.next=7,x.add(i);case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){if(!f.test(e))return null;var t=f.exec(e);if(null===t)return null;var n=(0,l.Z)(t,3),r=n[1],i=n[2],a=r+(i?"-"+i.toUpperCase():"");return h(a)?a:h(r)?r:null}function L(e,t){return k.apply(this,arguments)}function k(){return(k=(0,s.Z)((0,r.Z)().mark((function e(t,n){var i,a,l,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],a=(0,o.Z)(p),e.prev=2,a.s();case 4:if((l=a.n()).done){e.next=18;break}if(!C((s=l.value).pattern,t)){e.next=16;break}return e.prev=7,e.next=10,s.fetchMessageBundle(t,n);case 10:return e.abrupt("return",e.sent);case 13:e.prev=13,e.t0=e.catch(7),i.push(e.t0);case 16:e.next=4;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(2),a.e(e.t1);case 23:return e.prev=23,a.f(),e.finish(23);case 26:if(!i.length){e.next=28;break}throw new u.Z("intl:message-bundle-error",'Errors occurred while loading "'.concat(t,'"'),{errors:i});case 28:throw new u.Z("intl:no-message-bundle-loader",'No loader found for message bundle "'.concat(t,'"'));case 29:case"end":return e.stop()}}),e,null,[[2,20,23,26],[7,13]])})))).apply(this,arguments)}function C(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}(0,d.Ze)((function(){v.clear()}));var x=new(function(){function e(){(0,i.Z)(this,e),this._numLoading=0,this._dfd=null}return(0,a.Z)(e,[{key:"waitForAll",value:function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this._dfd,!e.t0){e.next=4;break}return e.next=4,this._dfd.promise;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"add",value:function(e){var t=this;return this._increase(),e.then((function(){return t._decrease()}),(function(){return t._decrease()})),this.waitForAll()}},{key:"_increase",value:function(){this._numLoading++,this._dfd||(this._dfd=(0,c.dD)())}},{key:"_decrease",value:function(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}}]),e}())},8704:function(e,t,n){n.d(t,{n:function(){return u}});var r=n(32718),i=n(18202),a=n(643),l=n(76969),s=n(6291),o=r.Z.getLogger("esri.intl.substitute");function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.format,i=void 0===r?{}:r;return(0,a.gx)(e,(function(e){return c(e,t,i)}))}function c(e,t,n){var r,a,l,s=e.indexOf(":");if(-1===s?a=e.trim():(a=e.slice(0,s).trim(),l=e.slice(s+1).trim()),!a)return"";var o=(0,i.hS)(a,t);if(null==o)return"";var u=null!==(r=l?null===n||void 0===n?void 0:n[l]:null)&&void 0!==r?r:null===n||void 0===n?void 0:n[a];return u?d(o,u):l?f(o,l):y(o)}function d(e,t){switch(t.type){case"date":return(0,l.p6)(e,t.intlOptions);case"number":return(0,s.uf)(e,t.intlOptions);default:return o.warn("missing format descriptor for key {key}"),y(e)}}function f(e,t){switch(t.toLowerCase()){case"dateformat":return(0,l.p6)(e);case"numberformat":return(0,s.uf)(e);default:return o.warn("inline format is unsupported since 4.12: ".concat(t)),/^(dateformat|datestring)/i.test(t)?(0,l.p6)(e):/^numberformat/i.test(t)?(0,s.uf)(e):y(e)}}function y(e){switch(typeof e){case"string":return e;case"number":return(0,s.uf)(e);case"boolean":return""+e;default:return e instanceof Date?(0,l.p6)(e):""}}},41978:function(e,t,n){n.d(t,{AM:function(){return b}});var r=n(93433),i=n(15671),a=n(43144),l=n(60136),s=n(92572),o=n(27366),u=n(31319),c=n(93169),d=n(84652),f=n(32718),y=n(49861),h=(n(25243),n(69912)),p=n(85411),v=n(32551),m=-1,b=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._from=null,r._to=null,r._final=null,r._current=[],r._time=0,r.duration=(0,c.Z)("mapview-transitions-duration"),r.effects=[],r}return(0,a.Z)(n,[{key:"effect",set:function(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(g(e))}catch(t){this._transitionTo([]),f.Z.getLogger(this.declaredClass).warn("Invalid Effect",{effect:e,error:t})}}}},{key:"hasEffects",get:function(){return this.transitioning||!!this.effects.length}},{key:"scale",set:function(e){this._updateForScale(e)}},{key:"transitioning",get:function(){return null!==this._to}},{key:"canTransitionTo",value:function(e){try{return this.scale>0&&_(this._current,g(e),this.scale)}catch(t){return!1}}},{key:"transitionStep",value:function(e,t){this._applyTimeTransition(e),this._updateForScale(t)}},{key:"endTransitions",value:function(){this._applyTimeTransition(this.duration)}},{key:"_transitionTo",value:function(e){this.scale>0&&_(this._current,e,this.scale)?(this._final=e,this._to=(0,d.d9)(e),function(e,t,n){for(var i,a,l=e.length>t.length?e:t,s=e.length>t.length?t:e,o=s[s.length-1],u=null!==(i=null===o||void 0===o?void 0:o.scale)&&void 0!==i?i:n,c=null!==(a=null===o||void 0===o?void 0:o.effects)&&void 0!==a?a:[],d=s.length;d<l.length;d++)s.push({scale:u,effects:(0,r.Z)(c)});for(var f=0;f<l.length;f++)s[f].scale=s[f].scale===m?n:s[f].scale,l[f].scale=l[f].scale===m?n:l[f].scale,(0,v.uF)(s[f].effects,l[f].effects)}(this._current,this._to,this.scale),this._from=(0,d.d9)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?(0,d.d9)(this._current[0].effects):[])}},{key:"_applyTimeTransition",value:function(e){if(this._to&&this._from&&this._current&&this._final){this._time+=e;for(var t=Math.min(1,this._time/this.duration),n=0;n<this._current.length;n++){var r=this._current[n],i=this._from[n],a=this._to[n];r.scale=w(i.scale,a.scale,t);for(var l=0;l<r.effects.length;l++){var s=r.effects[l],o=i.effects[l],u=a.effects[l];s.interpolate(o,u,t)}}1===t&&(this._current=this._final,this._set("effects",this._current[0]?(0,d.d9)(this._current[0].effects):[]),this._from=this._to=this._final=null)}}},{key:"_updateForScale",value:function(e){if(this._set("scale",e),0!==this._current.length){var t,n,r=this._current,i=this._current.length-1,a=1;if(1===r.length||e>=r[0].scale)n=t=r[0].effects;else if(e<=r[i].scale)n=t=r[i].effects;else for(var l=0;l<i;l++){var s=r[l],o=r[l+1];if(s.scale>=e&&o.scale<=e){a=(e-s.scale)/(o.scale-s.scale),t=s.effects,n=o.effects;break}}for(var u=0;u<this.effects.length;u++)this.effects[u].interpolate(t[u],n[u],a)}}}]),n}(u.Z);function g(e){var t=(0,p.Q)(e)||[];return function(e){var t=e[0];return!!t&&"type"in t}(t)?[{scale:m,effects:t}]:t}function _(e,t,n){var r,i,a,l;return null===(r=e[0])||void 0===r||!r.effects||null===(i=t[0])||void 0===i||!i.effects||!(((null===(a=e[0])||void 0===a?void 0:a.scale)===m||(null===(l=t[0])||void 0===l?void 0:l.scale)===m)&&(e.length>1||t.length>1)&&n<=0)&&(0,v.AS)(e[0].effects,t[0].effects)}function w(e,t,n){return e+(t-e)*n}(0,o._)([(0,y.Cb)()],b.prototype,"_to",void 0),(0,o._)([(0,y.Cb)()],b.prototype,"duration",void 0),(0,o._)([(0,y.Cb)({value:""})],b.prototype,"effect",null),(0,o._)([(0,y.Cb)({readOnly:!0})],b.prototype,"effects",void 0),(0,o._)([(0,y.Cb)({readOnly:!0})],b.prototype,"hasEffects",null),(0,o._)([(0,y.Cb)({value:0})],b.prototype,"scale",null),(0,o._)([(0,y.Cb)({readOnly:!0})],b.prototype,"transitioning",null),b=(0,o._)([(0,h.j)("esri.layers.effects.EffectView")],b)},44041:function(e,t,n){n.d(t,{R:function(){return g}});var r=n(1413),i=n(15671),a=n(43144),l=n(60136),s=n(92572),o=n(27366),u=n(31319),c=n(41691),d=n(92026),f=n(76672),y=n(49861),h=(n(25243),n(63780),n(69912)),p=n(61289),v=n(87072),m=n(58132),b={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"},g=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).floors=null,r.scale=0,r}return(0,a.Z)(n,[{key:"destroy",value:function(){this.layer=null}},{key:"dynamicLayers",get:function(){var e=this;if(!this.hasDynamicLayers)return null;var t=this.visibleSublayers.map((function(t){var n=(0,v.f)(e.floors,t);return t.toExportImageJSON(n)}));return t.length?JSON.stringify(t):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&(0,m.FN)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}},{key:"layer",set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("sublayer-update",(function(e){return t.notifyChange(b[e.propertyName])}))],"layer"))}},{key:"layers",get:function(){var e=this.visibleSublayers;return e?e.length?"show:"+e.map((function(e){return e.id})).join(","):"show:-1":null}},{key:"layerDefs",get:function(){var e,t=this,n=!(null===(e=this.floors)||void 0===e||!e.length),r=this.visibleSublayers.filter((function(e){return null!=e.definitionExpression||n&&null!=e.floorInfo}));return r.length?JSON.stringify(r.reduce((function(e,n){var r=(0,v.f)(t.floors,n),i=(0,f._)(r,n.definitionExpression);return(0,d.pC)(i)&&(e[n.id]=i),e}),{})):null}},{key:"version",get:function(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");var e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){var e=this,t=[];if(!this.layer)return t;var n=this.layer.sublayers;n&&n.forEach((function n(r){var i=e.scale,a=0===i,l=0===r.minScale||i<=r.minScale,s=0===r.maxScale||i>=r.maxScale;r.visible&&(a||l&&s)&&(r.sublayers?r.sublayers.forEach(n):t.unshift(r))}));var r=this._get("visibleSublayers");return!r||r.length!==t.length||r.some((function(e,n){return t[n]!==e}))?t:r}},{key:"toJSON",value:function(){var e=this.layer,t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=(0,r.Z)((0,r.Z)({},t),{},{layers:this.layers,layerDefs:this.layerDefs}),t}}]),n}((0,c.p)(u.Z));(0,o._)([(0,y.Cb)({readOnly:!0})],g.prototype,"dynamicLayers",null),(0,o._)([(0,y.Cb)()],g.prototype,"floors",void 0),(0,o._)([(0,y.Cb)({readOnly:!0})],g.prototype,"hasDynamicLayers",null),(0,o._)([(0,y.Cb)()],g.prototype,"layer",null),(0,o._)([(0,y.Cb)({readOnly:!0})],g.prototype,"layers",null),(0,o._)([(0,y.Cb)({readOnly:!0})],g.prototype,"layerDefs",null),(0,o._)([(0,y.Cb)({type:Number})],g.prototype,"scale",void 0),(0,o._)([(0,y.Cb)(p.qG)],g.prototype,"timeExtent",void 0),(0,o._)([(0,y.Cb)({readOnly:!0})],g.prototype,"version",null),(0,o._)([(0,y.Cb)({readOnly:!0})],g.prototype,"visibleSublayers",null),g=(0,o._)([(0,h.j)("esri.layers.mixins.ExportImageParameters")],g)},87072:function(e,t,n){function r(e){var t,n=e.layer;return"floorInfo"in n&&null!==(t=n.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?a(e.view.floors,n.floorInfo.floorField):null}function i(e,t){var n;return"floorInfo"in t&&null!==(n=t.floorInfo)&&void 0!==n&&n.floorField?a(e,t.floorInfo.floorField):null}function a(e,t){if(null===e||void 0===e||!e.length)return null;var n=e.filter((function(e){return""!==e})).map((function(e){return"'".concat(e,"'")}));return n.push("''"),"".concat(t," IN (").concat(n.join(","),") OR ").concat(t," IS NULL")}n.d(t,{c:function(){return r},f:function(){return i}})},92089:function(e,t,n){n.d(t,{A:function(){return a},r:function(){return i}});var r={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function i(e){var t;return null!==(t=r[e])&&void 0!==t?t:[-34028234663852886e22,34028234663852886e22]}function a(e,t,n){var r,a;if(!(e.depthCount&&e.depthCount>1)){for(var l=e.pixels,s=e.statistics,o=e.pixelType,u=l[0].length,c=null!==(r=e.bandMasks)&&void 0!==r?r:[],d=null!==(a=e.mask)&&void 0!==a?a:new Uint8Array(u).fill(255),f="f32"===o||"f64"===o,y=i(o),h=!1,p=0;p<l.length;p++){var v,m,b="number"==typeof t?t:t[p];if(null!=b){var g=null!==(v=null===s||void 0===s?void 0:s[p].minValue)&&void 0!==v?v:y[0],_=null!==(m=null===s||void 0===s?void 0:s[p].maxValue)&&void 0!==m?m:y[1];if(!(g>b+Number.EPSILON||_<b-Number.EPSILON)){var w=c[p]||new Uint8Array(u).fill(255),L=l[p],k=null===n||void 0===n?void 0:n.customFloatTolerance;if(f&&0!==k){var C=k;C||(C=Math.abs(b)>=9999999e31?2e-7*Math.abs(b):"f32"===o?Math.pow(2,-23):Number.EPSILON);for(var x=0;x<L.length;x++)w[x]&&Math.abs(L[x]-b)<C&&(L[x]=0,w[x]=0,d[x]=0,h=!0)}else for(var S=0;S<L.length;S++)w[S]&&L[S]===b&&(L[S]=0,w[S]=0,d[S]=0,h=!0);c[p]=w}}}h&&(e.bandMasks=c,e.mask=d),h&&"updateStatistics"in e&&e.updateStatistics()}}},58132:function(e,t,n){n.d(t,{FN:function(){return s},QV:function(){return l},ac:function(){return u}});var r=n(37762),i=n(92026),a=n(25265);function l(e,t,n){return t.flatten((function(e){return e.sublayers})).length!==e.length||(!!e.some((function(e){return e.originIdOf("minScale")>n||e.originIdOf("maxScale")>n||e.originIdOf("renderer")>n||e.originIdOf("labelingInfo")>n||e.originIdOf("opacity")>n||e.originIdOf("labelsVisible")>n||e.originIdOf("source")>n}))||!o(e,t))}function s(e,t,n){return!!e.some((function(e){var t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&((0,i.Wi)(t.gdbVersion)||t.gdbVersion===n))||e.originIdOf("renderer")>a.s3.SERVICE||e.originIdOf("labelingInfo")>a.s3.SERVICE||e.originIdOf("opacity")>a.s3.SERVICE||e.originIdOf("labelsVisible")>a.s3.SERVICE}))||!o(e,t)}function o(e,t){if(!e||!e.length||(0,i.Wi)(t))return!0;var n=t.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).map((function(e){return e.id})).toArray();if(e.length>n.length)return!1;var a,l=0,s=n.length,o=(0,r.Z)(e);try{for(o.s();!(a=o.n()).done;){for(var u=a.value.id;l<s&&n[l]!==u;)l++;if(l>=s)return!1}}catch(c){o.e(c)}finally{o.f()}return!0}function u(e){return!!e&&e.some((function(e){return null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale}))}},61029:function(e,t,n){n.d(t,{e:function(){return s},s:function(){return o}});var r=n(1413),i=(n(93169),n(10064)),a=n(92026),l=n(23707);function s(e){return(0,a.Wi)(e)||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function o(e,t){if((0,a.Wi)(e))return null;if(!s(e))return new i.Z("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '".concat(e.type||e.declaredClass,"'"),{renderer:e});switch(e.type){case"simple":return function(e){return u(e,(0,l.q)(e.symbol).error)}(e);case"unique-value":return function(e,t){var n,i=(0,r.Z)((0,r.Z)({},l.K),t),s=null===(n=e.uniqueValueInfos)||void 0===n?void 0:n.map((function(e){return(0,l.q)(e.symbol,i).error})).filter(a.pC),o=(0,l.q)(e.defaultSymbol,i);return o.error&&null!==s&&void 0!==s&&s.unshift(o.error),u(e,s)}(e,t);case"class-breaks":return function(e){var t=e.classBreakInfos.map((function(e){return(0,l.q)(e.symbol).error})).filter(a.pC),n=(0,l.q)(e.defaultSymbol);return n.error&&t.unshift(n.error),u(e,t)}(e);case"dictionary":case"heatmap":return null}return null}function u(e,t){if(!t)return null;var n;if((n=Array.isArray(t)?t:[t]).length>0){var r=n.map((function(e){return e.details.symbol.type||e.details.symbol.declaredClass})).filter((function(e){return!!e}));r.sort();var a=[];return r.forEach((function(e,t){0!==t&&e===r[t-1]||a.push(e)})),new i.Z("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols (".concat(a.join(", "),") which are not supported in 3D"),{renderer:e,symbolErrors:n})}return null}},79563:function(e,t,n){n.d(t,{Ne:function(){return m},Od:function(){return h},Sp:function(){return v},_M:function(){return y},mx:function(){return p}});var r=n(65905),i=n(51995),a=n(76200),l=n(59026),s=n(17842),o=n(49729),u="picture-fill",c="simple-fill",d="simple-marker",f=new l.Z(1e3);function y(e){var t=e.style,n=null;if(e)switch(e.type){case d:"cross"!==t&&"x"!==t&&(n=e.color);break;case c:"solid"===t?n=e.color:"none"!==t&&(n={type:"pattern",x:0,y:0,src:(0,r.V)("esri/symbols/patterns/".concat(t,".png")),width:5,height:5});break;case u:n={type:"pattern",src:e.url,width:(0,s.F2)(e.width)*e.xscale,height:(0,s.F2)(e.height)*e.yscale,x:(0,s.F2)(e.xoffset),y:(0,s.F2)(e.yoffset)};break;case"text":n=e.color;break;case"cim":n=(0,o.iW)(e)}return n}function h(e,t){var n=e+"-"+t;return void 0!==f.get(n)?Promise.resolve(f.get(n)):(0,a.default)(e,{responseType:"image"}).then((function(e){var r=e.data,i=r.naturalWidth,a=r.naturalHeight,l=document.createElement("canvas");l.width=i,l.height=a;var s=l.getContext("2d");s.fillStyle=t,s.fillRect(0,0,i,a),s.globalCompositeOperation="destination-in",s.drawImage(r,0,0);var o=l.toDataURL();return f.put(n,o),o}))}function p(e){if(!e)return null;var t=null;switch(e.type){case c:case u:case d:t=p(e.outline);break;case"simple-line":var n=(0,s.F2)(e.width);null!=e.style&&"none"!==e.style&&0!==n&&(t={color:e.color,style:v(e.style),width:n,cap:e.cap,join:"miter"===e.join?(0,s.F2)(e.miterLimit):e.join});break;default:t=null}return t}var v=function(){var e={};return function(t){if(e[t])return e[t];var n=t.replace(/-/g,"");return e[t]=n,n}}(),m=new i.Z([128,128,128])},74579:function(e,t,n){n.d(t,{BR:function(){return P},Q8:function(){return U},QL:function(){return B},Y6:function(){return v},YW:function(){return m},_h:function(){return g},e3:function(){return M},nf:function(){return b},tb:function(){return w},wJ:function(){return O}});var r=n(74165),i=n(37762),a=n(15861),l=n(51995),s=n(51508),o=n(14921),u=(n(93169),n(92026)),c=n(17842),d=n(71353),f=n(60676),y=n(79563),h=n(32537),p=new l.Z("white");function v(e){var t;if(!e)return 0;if((0,s.dU)(e)){var n=function(e){var t=e.symbolLayers&&e.symbolLayers.length;if(t){var n=e.symbolLayers.getItemAt(t-1);return"outline"in n?(0,u.U2)(n,"outline","size"):void 0}}(e);return(0,u.pC)(n)?n:0}return(0,c.Wz)(null===(t=(0,y.mx)(e))||void 0===t?void 0:t.width)}function m(e){if((0,u.Wi)(e)||!("symbolLayers"in e)||(0,u.Wi)(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((function(e){return"object"===e.type}));case"line-3d":return e.symbolLayers.some((function(e){return"path"===e.type}));case"polygon-3d":return e.symbolLayers.some((function(e){return"object"===e.type||"extrude"===e.type}));default:return!1}}function b(e){return(0,u.s3)(e.resource).href}function g(e,t){if(!e)return null;var n=null;return(0,s.dU)(e)?n=function(e){var t=e.symbolLayers;if(!t)return null;var n=null;return t.forEach((function(e){var t;"object"===e.type&&null!=(null===(t=e.resource)||void 0===t?void 0:t.href)||(n="water"===e.type?(0,u.Wg)(e.color):(0,u.pC)(e.material)?(0,u.Wg)(e.material.color):null)})),n?new l.Z(n):null}(e):(0,s.cT)(e)&&(n=e.color?new l.Z(e.color):null),n?_(n,t):null}function _(e,t){if(null==t||null==e)return e;var n=e.toRgba();return n[3]=n[3]*t,new l.Z(n)}function w(e,t,n){e&&(t||null!=n)&&(t&&(t=new l.Z(t)),(0,s.dU)(e)?function(e,t,n){var r=e.symbolLayers;if(r){var i=function(e){var r,i,a=(0,u.pC)(e)?e:null;return _(t=null!==(r=null!==(i=t)&&void 0!==i?i:a)&&void 0!==r?r:null!=n?p:null,n)};r.forEach((function(e){var r;if("object"!==e.type||null==(null===(r=e.resource)||void 0===r?void 0:r.href)||t)if("water"===e.type)e.color=i(e.color);else{var a=(0,u.pC)(e.material)?e.material.color:null,l=i(a);(0,u.Wi)(e.material)?e.material=new h.b({color:l}):e.material.color=l,null!=n&&"outline"in e&&(0,u.pC)(e.outline)&&(0,u.pC)(e.outline.color)&&(e.outline.color=_(e.outline.color,n))}}))}}(e,t,n):(0,s.cT)(e)&&function(e,t,n){var r;(t=null!==(r=t)&&void 0!==r?r:e.color)&&(e.color=_(t,n)),null!=n&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=_(e.outline.color,n))}(e,t,n))}function L(e,t){return k.apply(this,arguments)}function k(){return k=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.symbolLayers,e.t0=i,!e.t0){e.next=5;break}return e.next=5,(0,o.Ed)(i,function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",C(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function C(e,t){return x.apply(this,arguments)}function x(){return(x=(0,a.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="extrude"===e.t0?3:"icon"===e.t0||"line"===e.t0||"text"===e.t0?5:"path"===e.t0?7:"object"===e.t0?9:11;break;case 3:return Z(t,n),e.abrupt("break",11);case 5:return S(t,n),e.abrupt("break",11);case 7:return V(t,n),e.abrupt("break",11);case 9:return e.next=11,E(t,n);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){var n=I(t);(0,u.pC)(n)&&(e.size=n)}function I(e){var t,n=(0,i.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("number"==typeof r)return r}}catch(a){n.e(a)}finally{n.f()}return null}function Z(e,t){e.size="number"==typeof t[2]?t[2]:0}function E(e,t){return R.apply(this,arguments)}function R(){return(R=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i,a,l,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(t);case 2:i=e.sent,a=i.resourceSize,l=i.symbolSize,s=F(n,a,l),t.width=A(n[0],l[0],a[0],s),t.depth=A(n[1],l[1],a[1],s),t.height=A(n[2],l[2],a[2],s);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t){var n=F(t,d.O,[e.width,void 0,e.height]);e.width=A(t[0],e.width,1,n),e.height=A(t[2],e.height,1,n)}function F(e,t,n){for(var r=0;r<3;r++){var i=e[r];switch(i){case"symbol-value":var a=n[r];return null!=a?a/t[r]:1;case"proportional":break;default:if(i&&t[r])return i/t[r]}}return 1}function z(e){return T.apply(this,arguments)}function T(){return(T=(0,a.Z)((0,r.Z)().mark((function e(t){var i,a,l,s,o,u,c,d,f,y;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(23657).then(n.bind(n,23657));case 2:return i=e.sent,e.next=5,i.computeObjectLayerResourceSize(t,10);case 5:a=e.sent,l=t.width,s=t.height,o=t.depth,u=[l,o,s],c=1,d=0;case 12:if(!(d<3)){e.next=20;break}if(null==(f=u[d])){e.next=17;break}return c=f/a[d],e.abrupt("break",20);case 17:d++,e.next=12;break;case 20:for(y=0;y<3;y++)null==u[y]&&(u[y]=a[y]*c);return e.abrupt("return",{resourceSize:a,symbolSize:u});case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t,n,r){switch(e){case"proportional":return n*r;case"symbol-value":return null!=t?t:n;default:return e}}function D(e,t){var n=I(t);if(!(0,u.Wi)(n))switch(e.type){case"simple-marker":e.size=n;break;case"picture-marker":var r=e.width/e.height;r>1?(e.width=n,e.height=n*r):(e.width=n*r,e.height=n);break;case"simple-line":e.width=n;break;case"text":e.font.size=n}}function M(e,t){return N.apply(this,arguments)}function N(){return(N=(0,a.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!n){e.next=2;break}return e.abrupt("return",(0,s.dU)(t)?L(t,n):void((0,s.cT)(t)&&D(t,n)));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t,n){if(e&&null!=t)if((0,s.dU)(e)){var r=e.symbolLayers;r&&r.forEach((function(e){if(e&&"object"===e.type)switch(n){case"tilt":e.tilt=t;break;case"roll":e.roll=t;break;default:e.heading=t}}))}else(0,s.cT)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle=t))}function O(e){if(!e)return null;var t=e.effects.filter((function(e){return"bloom"!==e.type})).map((function(e){return e.toJSON()}));return(0,f.rM)(t)}function B(e){return(0,u.pC)(e)&&"polygon-3d"===e.type&&e.symbolLayers.some((function(e){return"extrude"===e.type}))}function U(e,t){return W.apply(this,arguments)}function W(){return(W=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fetchSymbol(n);case 2:return i=e.sent,e.abrupt("return",i||t.fetchCIMSymbol(n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},28073:function(e,t,n){n.d(t,{Z:function(){return _n}});var r=n(1413),i=n(15671),a=n(43144),l=n(60136),s=n(92572),o=n(27366),u=n(100),c=n(92026),d=n(94172),f=n(49861),y=n(89125),h=(n(63780),n(69912)),p=n(37056),v=(n(59166),n(31319)),m=n(80987),b=(n(25243),n(37762)),g=n(74165),_=n(93433),w=n(15861),L=n(51995),k=n(19545),C=n(76200),x=n(51508),S=n(43404),I=n(32718),Z=n(66978),E=n(17842),R=n(35995),V=n(25265),F=n(41978),z=n(60676),T=n(44041),A=n(80031),D=n(92089),M=n(9014),N=n(61029),P=n(12726),O=n(49729),B=n(37817),U=n(69157),W=n(86828),Y=n(74579),j=n(245);function H(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;var n=e.visualVariables.find((function(e){return"size"===e.type})),r=function(e,t){var n=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return null!==t&&void 0!==t&&t.levels?t.levels[n]:null}(t,n);return r?new j.Z({field:n.field,minSize:r[2].size,minDataValue:r[2].value,maxSize:r[3].size,maxDataValue:r[3].value}):null}var q=n(226),J=n(40778),G=n(44085),Q=n(29439),$=n(4075),X=n(75434),K=n(37680),ee=n(37384),te=n(16072),ne=n(16851),re=[255,255,255],ie=[200,200,200],ae=[128,128,128];function le(e,t){var n=e.length-1;return e.map((function(e,r){return(0,X.MN)(e,r,n,t)}))}function se(e,t,n,r,i,a,l){return oe.apply(this,arguments)}function oe(){return oe=(0,w.Z)((0,g.Z)().mark((function e(t,n,r,i,a,l,s){var o,u,c,d,f,y,h,p,v,m,b,_,L,k,C,x,S,I,Z,E;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=n.legendOptions,d=c&&c.customValues,e.t0=s,e.t0){e.next=7;break}return e.next=6,de(t,r);case 6:e.t0=e.sent;case 7:if(f=e.t0,y=!!f,h=!!d,p=null!=n.minSize&&null!=n.maxSize,v=n.stops&&n.stops.length>1,m=!!n.target,y&&(h||p||v&&!m)){e.next=15;break}return e.abrupt("return");case 15:if(b=(0,Y.YW)(f),_=null,L=null,k=null,!b||v){e.next=21;break}e.t1=(0,$.NM)([n.minDataValue,n.maxDataValue]),e.next=27;break;case 21:if(e.t2=d,e.t2){e.next=26;break}return e.next=25,ve(n,f,i,a);case 25:e.t2=e.sent;case 26:e.t1=e.t2;case 27:if(L=e.t1,C=null===t||void 0===t?void 0:t.authoringInfo,x="univariate-color-size"===(null===C||void 0===C?void 0:C.type),S=x&&"above-and-below"===(null===C||void 0===C?void 0:C.univariateTheme),!L&&v&&(L=n.stops.map((function(e){return e.value})),_=n.stops.some((function(e){return!!e.label})),"flow"===t.type&&(L=(0,$.NM)(L)),_&&(k=n.stops.map((function(e){return e.label})))),b&&(null===(o=L)||void 0===o?void 0:o.length)>2&&!S&&(L=[L[0],L[L.length-1]]),L){e.next=31;break}return e.abrupt("return",null);case 31:return x&&5!==(null===(u=L)||void 0===u?void 0:u.length)&&(L=be({minSize:L[0],maxSize:L[L.length-1]})),I=b?ue(t,L):null,Z=(0,Y.Y6)(f),E=_?null:le(L,l),e.next=35,Promise.all(L.map(function(){var e=(0,w.Z)((0,g.Z)().mark((function e(r,l){var s;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!b){e.next=4;break}e.t0=I[l],e.next=7;break;case 4:return e.next=6,Le(n,f,r,i,a);case 6:e.t0=e.sent;case 7:return s=e.t0,e.abrupt("return",{value:r,symbol:Ce(S&&"class-breaks"===t.type?ce(t,l):f,s),label:_?k[l]:E[l],size:s,outlineSize:Z});case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 35:return e.abrupt("return",e.sent.reverse());case 36:case"end":return e.stop()}}),e)}))),oe.apply(this,arguments)}function ue(e,t){var n=null===e||void 0===e?void 0:e.authoringInfo,r="univariate-color-size"===(null===n||void 0===n?void 0:n.type),i=[12,30];if(r){var a=t[0],l=t[t.length-1];i=t.map((function(e){return 12+(e-a)/(l-a)*18}))}return r&&"below"===(null===n||void 0===n?void 0:n.univariateTheme)&&i.reverse(),i}function ce(e,t){var n=e.classBreakInfos,r=n.length,i=r<2||!(t>=2)?n[0].symbol.clone():n[r-1].symbol.clone();return e.visualVariables.some((function(e){return"color"===e.type}))&&(i.type.includes("3d")?he(i):pe(i)),i}function de(e,t){return fe.apply(this,arguments)}function fe(){return fe=(0,w.Z)((0,g.Z)().mark((function e(t,n){var r,i,a,l,s;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("flow"!==t.type){e.next=2;break}return e.abrupt("return",(0,X.y$)(t,n));case 2:if("pie-chart"!==t.type){e.next=4;break}return e.abrupt("return",new te.Z({color:null,outline:null!==(r=t.outline)&&void 0!==r&&r.width?t.outline:new ne.Z}));case 4:return i=null,a=null,"simple"===t.type?i=t.symbol:"class-breaks"===t.type?(l=t.classBreakInfos,i=l&&l[0]&&l[0].symbol,a=l.length>1):"unique-value"===t.type&&(s=t.uniqueValueInfos,i=s&&s[0]&&s[0].symbol,a=s.length>1),e.abrupt("return",!i||ye(i)?null:(i=i.clone(),(n||a)&&(i.type.includes("3d")?he(i):pe(i)),i));case 7:case"end":return e.stop()}}),e)}))),fe.apply(this,arguments)}function ye(e){return!!e&&((0,x.dU)(e)?!!e.symbolLayers&&e.symbolLayers.some((function(e){return e&&"fill"===e.type})):e.type.includes("fill"))}function he(e){"line-3d"===e.type?e.symbolLayers.forEach((function(e){e.material={color:ae}})):e.symbolLayers.forEach((function(e){"icon"!==e.type||e.resource&&e.resource.href?e.material={color:ie}:(e.material={color:re},e.outline={color:ae,size:1.5})}))}function pe(e){var t=(0,ee.$o)();if("cim"===e.type)(0,O.ZB)(e,new L.Z(ie));else if(e.type.includes("line"))e.color=ae;else if(e.color=t?ae:re,"simple-marker"===e.type)if(e.outline){var n,r;"#ffffff"===(null===(n=e.outline)||void 0===n||null===(r=n.color)||void 0===r?void 0:r.toHex())&&(e.outline.color=ae)}else e.outline={color:ae,width:1.5}}function ve(e,t,n,r){return me.apply(this,arguments)}function me(){return me=(0,w.Z)((0,g.Z)().mark((function e(t,r,i,a){var l,s,o,u,c;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(n.bind(n,56011));case 2:if(l=e.sent.getSizeRangeAtScale(t,i,a),s=l&&be(l),l||s){e.next=6;break}return e.abrupt("return");case 6:o=s.map((function(e){return ge(e,t,l)})),o=(0,$.NM)(o),u=1;case 9:if(!(u<o.length-1)){e.next=17;break}return e.next=12,_e(t,r,o[u],o[u-1],i,a);case 12:(c=e.sent)&&(o[u]=c[0],s[u]=c[1]);case 14:u++,e.next=9;break;case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}}),e)}))),me.apply(this,arguments)}function be(e){for(var t=e.minSize,n=(e.maxSize-t)/4,r=[],i=0;i<5;i++)r.push(t+n*i);return r}function ge(e,t,n){var r=n.minSize,i=n.maxSize,a=t.minDataValue,l=t.maxDataValue;return e<=r?a:e>=i?l:(e-r)/(i-r)*(l-a)+a}function _e(e,t,n,r,i,a){return we.apply(this,arguments)}function we(){return we=(0,w.Z)((0,g.Z)().mark((function e(t,n,r,i,a,l){var s,o,u,c,d,f,y,h,p,v,m,b,_,w,L,k,C,x,S,I,Z,E,R;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le(t,n,r,a,l);case 2:return s=e.sent,e.next=5,Le(t,n,i,a,l);case 5:o=e.sent,u=(0,$.D2)(r),c=u.fractional,d=20,f=u.integer,y=null,h=null,r>0&&r<1&&(y=Math.pow(10,c),f=(0,$.D2)(r*=y).integer),p=f-1;case 12:if(!(p>=0)){e.next=38;break}return v=Math.pow(10,p),m=Math.floor(r/v)*v,b=Math.ceil(r/v)*v,null!=y&&(m/=y,b/=y),_=(m+b)/2,w=(0,$.NM)([m,_,b],{indexes:[1]}),L=(0,Q.Z)(w,2),_=L[1],e.next=22,Le(t,n,m,a,l);case 22:return k=e.sent,e.next=25,Le(t,n,b,a,l);case 25:return C=e.sent,e.next=28,Le(t,n,_,a,l);case 28:if(x=e.sent,S=(0,$.f1)(s,k,o,null),I=(0,$.f1)(s,C,o,null),Z=(0,$.f1)(s,x,o,null),E=S.previous<=d,R=I.previous<=d,E&&R&&(S.previous<=I.previous?(E=!0,R=!1):(R=!0,E=!1)),E?h=[m,k]:R?h=[b,C]:Z.previous<=d&&(h=[_,x]),!h){e.next=35;break}return e.abrupt("break",38);case 35:p--,e.next=12;break;case 38:return e.abrupt("return",h);case 39:case"end":return e.stop()}}),e)}))),we.apply(this,arguments)}function Le(e,t,n,r,i){return ke.apply(this,arguments)}function ke(){return ke=(0,w.Z)((0,g.Z)().mark((function e(t,r,i,a,l){var s,o;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(n.bind(n,56011));case 2:return s=e.sent,o=s.getSize,e.abrupt("return",o(t,i,{scale:a,view:l,shape:"simple-marker"===r.type?r.style:null}));case 5:case"end":return e.stop()}}),e)}))),ke.apply(this,arguments)}function Ce(e,t){var n=e.clone();if((0,x.dU)(n))(0,Y.YW)(n)||n.symbolLayers.forEach((function(e){"fill"!==e.type&&(e.size=t)}));else if(function(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}(n))n.size=t;else if(function(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(n)){var r=n.width,i=n.height;n.height=t,n.width=t*(r/i)}else!function(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(n)?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(n)&&n.font&&(n.font.size=t):n.width=t;return n}n(76969);var xe=n(6291);n(99388);function Se(e){var t=Math.floor(Math.log10(Math.abs(e)))+1,n=t<4||t>6?4:t,r=Math.abs(e)>=1e6?"compact":"standard";return(0,xe.uf)(e,{notation:r,minimumSignificantDigits:2,maximumSignificantDigits:n})}var Ie=n(61459),Ze=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Ee=new S.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Re=new te.Z({size:6,outline:{color:[128,128,128,.5],width:.5}}),Ve=new Ie.Z({style:"solid"});function Fe(e){return"flow"===e.type}function ze(e){return"vector-field"===e.type}function Te(e){return"raster-colormap"===e.type}function Ae(e){return"raster-stretch"===e.type}function De(e){return"raster-shaded-relief"===e.type}function Me(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function Ne(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function Pe(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function Oe(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function Be(e){return Ue(e)||We(e)||Ye(e)||function(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}function Ue(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function We(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function Ye(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function je(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function He(e){return"esri.renderers.PieChartRenderer"===e.declaredClass}function qe(e,t){return Me(e)||Ne(e)||Pe(e)||Oe(e)||je(e)||He(e)?"2d"===t.type||(0,N.e)(e):Ae(e)||Te(e)||De(e)||Ue(e)||We(e)||Ye(e)||ze(e)||Fe(e)}function Je(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}function Ge(e){return"esri.layers.SubtypeGroupLayer"===e.declaredClass}function Qe(e){return"esri.layers.VoxelLayer"===e.declaredClass}function $e(e){return"esri.layers.WMSLayer"===e.declaredClass}function Xe(e){return"esri.layers.WMTSLayer"===e.declaredClass}function Ke(e){return"esri.layers.MapImageLayer"===e.declaredClass}function et(e){return"esri.layers.TileLayer"===e.declaredClass}function tt(e){return"esri.layers.FeatureLayer"===e.declaredClass}function nt(e){return"esri.layers.ImageryLayer"===e.declaredClass}function rt(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}function it(e){return"esri.layers.WCSLayer"===e.declaredClass}function at(e){return"stretch-ramp"===e.type}function lt(e){var t;return"univariate-color-size"===(null===(t="authoringInfo"in e&&(null===e||void 0===e?void 0:e.authoringInfo))||void 0===t?void 0:t.type)}function st(e){var t="authoringInfo"in e&&(null===e||void 0===e?void 0:e.authoringInfo);return"univariate-color-size"===(null===t||void 0===t?void 0:t.type)&&"above-and-below"===(null===t||void 0===t?void 0:t.univariateTheme)}var ot=new te.Z({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}}),ut={},ct=function(e){(0,l.Z)(o,e);var t=(0,s.Z)(o);function o(e){var n;return(0,i.Z)(this,o),(n=t.call(this,e))._handles=new u.Z,n._hasColorRamp=!1,n._hasOpacityRamp=!1,n._hasSizeRamp=!1,n._webStyleSymbolCache=new Map,n._dotDensityUrlCache=new Map,n._scaleDrivenSizeVariable=null,n._hasClusterSizeVariable=!1,n.children=new m.Z,n.layerView=null,n.layer=null,n.legendElements=[],n.parent=null,n.hideLayersNotInCurrentView=!1,n.keepCacheOnDestroy=!1,n.respectLayerVisibility=!0,n.sublayerIds=[],n.title=null,n.view=null,n}return(0,a.Z)(o,[{key:"initialize",value:function(){var e=this,t=function(){return e.notifyChange("ready")};this._handles.add([(0,d.on)((function(){return e.children}),"change",(function(n){var r=n.added,i=n.removed,a=e._handles;r.forEach((function(e){var n="activeLayerInfo-ready-watcher-".concat(e.layer.uid);a.add((0,d.YP)((function(){return e.ready}),t,d.nn),n)})),i.forEach((function(e){return a.remove(e.layer.uid)})),t()}))]),this.keepCacheOnDestroy||(ut={})}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(ut=null)}},{key:"effectList",get:function(){var e=this.layer,t=null;return"effect"in e&&e.effect&&((t=new F.AM).effect=e.effect,t.endTransitions(),t.scale=this.scale),t}},{key:"opacity",get:function(){var e,t=this.layer.opacity,n=null===(e=this.parent)||void 0===e?void 0:e.opacity,r=this.layer.parent,i=r&&"uid"in r?this._getParentLayerOpacity(r):null;return null!=n?n*t:null!=i?i*t:t}},{key:"ready",get:function(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}},{key:"scale",get:function(){return this.view&&this.view.scale}},{key:"isScaleDriven",get:function(){var e=this.layer;if(null===e)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if("cluster"===e.featureReduction.type)return!0;if("binning"===e.featureReduction.type&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}},{key:"version",get:function(){return this._get("version")+1}},{key:"buildLegendElementsForFeatureCollections",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t){var n,r,i=this;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=5;break}return e.next=4,this._isLayerInCurrentView();case 4:e.t0=e.sent;case 5:if(e.t0){e.next=7;break}return e.abrupt("return",(this.legendElements=[],void this.notifyChange("ready")));case 7:return n=Array.from(t,(function(e){if(tt(e))return i._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){var t=e.layerDefinition,n=t&&t.drawingInfo,r=n&&(0,M.i)(n.renderer),a=Ee.read(t.geometryType);return r?i._getRendererLegendElements(r,{title:e.name,geometryType:a}):(I.Z.getLogger(i.declaredClass).warn("drawingInfo not available!"),null)}return null})),e.prev=8,r=[],e.next=12,(0,Z.as)(n).then((function(e){e.forEach((function(e){var t=e.value;return t&&r.push.apply(r,(0,_.Z)(t))}))}));case 12:this.legendElements=r,this.notifyChange("ready"),e.next=19;break;case 16:e.prev=16,e.t1=e.catch(8),I.Z.getLogger(this.declaredClass).warn("error while building legend for layer!",e.t1);case 19:case"end":return e.stop()}}),e,this,[[8,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForRenderer",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t){return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=6;break}return e.next=5,this._isLayerInCurrentView();case 5:e.t0=e.sent;case 6:if(!e.t0){e.next=13;break}return e.next=10,this._getRendererLegendElements(t);case 10:e.t1=e.sent,e.next=14;break;case 13:e.t1=[];case 14:this.legendElements=e.t1,this.notifyChange("ready"),e.next=21;break;case 18:e.prev=18,e.t2=e.catch(0),I.Z.getLogger(this.declaredClass).warn("error while building legend for layer!",e.t2);case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForFeatureReduction",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t){return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=6;break}return e.next=5,this._isLayerInCurrentView();case 5:e.t0=e.sent;case 6:if(!e.t0){e.next=13;break}return e.next=10,this._getLegendElementsForFeatureReduction(t);case 10:e.t1=e.sent,e.next=14;break;case 13:e.t1=[];case 14:this.legendElements=e.t1,this.notifyChange("ready"),e.next=21;break;case 18:e.prev=18,e.t2=e.catch(0),I.Z.getLogger(this.declaredClass).warn("error while building legend for layer!",e.t2);case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForTools",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(){var t,n,r,i,a=this;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Qe(t=this.layer)){e.next=5;break}this._constructLegendElementsForVoxellayer(),e.next=29;break;case 5:if(!Xe(t)){e.next=9;break}this._constructLegendElementsForWMTSlayer(),e.next=29;break;case 9:if(!$e(t)){e.next=14;break}return e.next=12,this._constructLegendElementsForWMSSublayers();case 12:case 17:case 22:e.next=29;break;case 14:if(!Je(t)){e.next=19;break}return e.next=17,this._constructLegendElementsForBuildingSceneLayer();case 19:if(!(Ke(t)||et(t)||Ge(t))){e.next=24;break}return e.next=22,this._constructLegendElementsForSublayers();case 24:return this._handles.remove("imageryLayers-watcher"),n="default",nt(t)&&(n=((null===t||void 0===t||null===(r=t.renderingRule)||void 0===r?void 0:r.functionName)||"default")+"_"+(null!==(i=t.bandIds)&&void 0!==i&&i.length?t.bandIds.join(""):"###")),e.next=29,this._getLegendLayers("".concat(t.uid,"-").concat(n)).then(function(){var e=(0,w.Z)((0,g.Z)().mark((function e(n){var r;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.legendElements=[],a.notifyChange("ready"),r=n.map(function(){var e=(0,w.Z)((0,g.Z)().mark((function e(n){var r,i;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(nt(t)||rt(t))&&(r=(0,d.YP)((function(){return["renderingRule"in t&&t.renderingRule,t.bandIds]}),(function(){return(0,Z.Ds)((0,w.Z)((0,g.Z)().mark((function e(){return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ut.default=null,!t.renderer){e.next=6;break}return e.next=4,a.buildLegendElementsForRenderer(t.renderer);case 4:e.next=8;break;case 6:return e.next=8,a.buildLegendElementsForTools();case 8:case"end":return e.stop()}}),e)}))))()})),a._handles.add(r,"imageryLayers-watcher")),(i=a._generateSymbolTableElementForLegendLayer(n))&&i.infos.length&&(nt(t)&&(i.title=t.title),a.legendElements.push(i)),a.notifyChange("ready");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,(0,Z.as)(r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){I.Z.getLogger(a.declaredClass).warn("Request to server for legend has failed!",e)}));case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_isLayerInCurrentView",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(){var t,n,r,i;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer,n=this.layerView,(r=n&&"createQuery"in n&&"queryFeatureCount"in n)||n&&"createQuery"in t&&"queryFeatureCount"in t){e.next=3;break}return e.abrupt("return",!0);case 3:return e.next=5,(0,d.N1)((function(){return!n.updating}));case 5:if((i=r?"createQuery"in n&&n.createQuery():"createQuery"in t&&t.createQuery()).geometry=this.view.extent,!r){e.next=16;break}if(e.t1="queryFeatureCount"in n,!e.t1){e.next=13;break}return e.next=12,n.queryFeatureCount(i);case 12:e.t1=e.sent;case 13:e.t0=e.t1,e.next=22;break;case 16:if(e.t2="queryFeatureCount"in t,!e.t2){e.next=21;break}return e.next=20,t.queryFeatureCount(i);case 20:e.t2=e.sent;case 21:e.t0=e.t2;case 22:return e.t3=e.t0,e.abrupt("return",0!==e.t3);case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getParentLayerOpacity",value:function(e){var t=1,n=e.parent;return n&&"uid"in n&&(t=this._getParentLayerOpacity(n)),e.opacity*t}},{key:"_isGroupActive",value:function(){var e=this.children;return!!e.length&&e.some((function(e){return e.ready}))}},{key:"_isRendererScaleDriven",value:function(e){var t=this;if("dot-density"===e.type)return!0;var n="valueExpression"in e&&e.valueExpression;if(Ze.test(n))return!0;var r="visualVariables"in e&&e.visualVariables;return!!r&&r.some((function(e){return t._isScaleDrivenSizeVariable(e)}))}},{key:"_isScaleDrivenSizeVariable",value:function(e){if(e&&"size"!==e.type)return!1;var t=e,n=t.minSize,r=t.maxSize;return"object"==typeof n&&n?this._isScaleDrivenSizeVariable(n):"object"==typeof r&&r?this._isScaleDrivenSizeVariable(r):!!t.expression||Ze.test(t.valueExpression)}},{key:"_isLayerScaleDriven",value:function(e){var t=this;if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((function(e){return t._isLayerScaleDriven(e)}));var n=e.parent;if(!1===e.loaded&&n&&Ke(n)&&"source"in e&&e.source&&"map-layer"===e.source.type){var r,i=(0,b.Z)(n.sourceJSON.layers);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.id===e.source.mapLayerId&&(a.minScale>0||a.maxScale>0))return!0}}catch(l){i.e(l)}finally{i.f()}}return!1}},{key:"_constructLegendElementsForVoxellayer",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(){var t,n,r,i,a,l,s,o,u,f,y,h,p,v=this;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("voxel-style-watcher"),this._handles.remove("voxel-current-variable"),n=this.layer,this._handles.add((0,d.YP)((function(){return n.currentVariableId}),(function(){return v._constructLegendElementsForVoxellayer()})),"voxel-current-variable"),this._handles.add((0,d.YP)((function(){return n.getVariableStyles()}),(function(){return v._constructLegendElementsForVoxellayer()})),"voxel-style-watcher"),r=(0,c.Wg)(n.getVariableStyle(null)),i=[],r&&(null!==(t=r.uniqueValues)&&void 0!==t&&t.length?(a=[],r.uniqueValues.forEach((function(e){e.enabled&&a.push({label:e.label||"".concat(e.value),value:e.value,symbol:new Ie.Z({color:e.color,outline:null})})})),a.length&&i.push({type:"symbol-table",title:r.label,infos:a})):r.transferFunction&&(l=r.transferFunction,s=l.colorStops,o=l.stretchRange,u=s.toArray().reverse(),f=o.map((function(e,t){return"".concat(0===t?X.zZ:X.Eh," ").concat(Se(e))})).reverse(),y=u.map((function(e){return{color:e.color,value:null,label:null}})),y[0].label=f[0],y[y.length-1].label=f[1],i.push({type:"color-ramp",title:r.label,infos:y,preview:(0,W.jT)(u.map((function(e){return e.color})))}))),h=n.opacity,p=i.reduce((function(e,t){return e.concat(v._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)})).map((function(e){return v._getSymbolPreview(e,h)})),e.next=8,(0,Z.as)(p);case 8:this.legendElements=i,this.notifyChange("ready");case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_constructLegendElementsForWMTSlayer",value:function(){var e=this;this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");var t=this.layer.activeLayer;if(this._handles.add((0,d.YP)((function(){var t=e.layer;return t&&"activeLayer"in t&&t.activeLayer}),(function(){return e._constructLegendElementsForWMTSlayer()})),"wmts-activeLayer-watcher"),t.styleId&&t.styles){var n=null;t.styles.some((function(e){return t.styleId===e.id&&(n=e.legendUrl,!0)})),n&&(this.legendElements=[{type:"symbol-table",title:t.title,infos:[{src:n,opacity:this.opacity}]}])}this.notifyChange("ready")}},{key:"_constructLegendElementsForWMSSublayers",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(){var t,n,i=this;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("wms-sublayers-watcher"),t=this.layer,n=null,(t.customParameters||t.customLayerParameters)&&(n=(0,r.Z)((0,r.Z)({},t.customParameters),t.customLayerParameters)),this._handles.add((0,d.YP)((function(){var e=i.layer;return e&&"sublayers"in e&&e.sublayers}),(function(){return i._constructLegendElementsForWMSSublayers()})),"wms-sublayers-watcher"),e.next=7,this._generateLegendElementsForWMSSublayers(t.sublayers,n);case 7:this.legendElements=e.sent,this.notifyChange("ready");case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForWMSSublayers",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t,n){var r,i,a,l,s,o=this;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],this._handles.add(t.on("change",(function(){return o._constructLegendElementsForWMSSublayers()})),"wms-sublayers-watcher"),i=t.toArray(),a=(0,b.Z)(i),e.prev=4,s=(0,g.Z)().mark((function e(){var t,i,a;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.value,i=(0,d.YP)((function(){return[t.title,t.visible,t.legendEnabled]}),(function(){return o._constructLegendElementsForWMSSublayers()})),o._handles.add(i,"wms-sublayers-watcher"),!(!o.respectLayerVisibility||t.visible&&t.legendEnabled)){e.next=7;break}return e.next=5,o._generateSymbolTableElementForWMSSublayer(t,n);case 5:(a=e.sent)&&a.infos.length&&r.unshift(a);case 7:case"end":return e.stop()}}),e)})),a.s();case 7:if((l=a.n()).done){e.next=11;break}return e.delegateYield(s(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),a.e(e.t1);case 16:return e.prev=16,a.f(),e.finish(16);case 19:return e.abrupt("return",r);case 20:case"end":return e.stop()}}),e,this,[[4,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForWMSSublayer",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t,n){var r;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.legendUrl||!t.sublayers){e.next=5;break}return e.next=3,this._generateLegendElementsForWMSSublayers(t.sublayers,n);case 3:return r=e.sent.filter((function(e){return e})),e.abrupt("return",{type:"symbol-table",title:t.title,infos:r});case 5:return e.abrupt("return",this._generateSymbolTableElementForLegendUrl(t,n));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForLegendUrl",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t,n){var r,i,a,l,s;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.legendUrl){e.next=3;break}return e.abrupt("return");case 3:return a={type:"symbol-table",title:t.title||t.name||t.id&&t.id+"",infos:[]},n&&(i=(0,R.fl)(i,n)),l=null,s=null===(r=t.layer)||void 0===r?void 0:r.opacity,e.prev=7,e.next=10,(0,C.default)(i,{responseType:"image"});case 10:(l=e.sent.data)&&(l.style.opacity=s),e.next=16;break;case 14:e.prev=14,e.t0=e.catch(7);case 16:return e.abrupt("return",(a.infos.push({src:i,preview:l,opacity:s}),a));case 17:case"end":return e.stop()}}),e,null,[[7,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getLegendLayers",value:function(e,t){var n=ut&&ut[e];return n?Promise.resolve(n):this._legendRequest(t).then((function(t){var n=t.layers;return ut[e]=n,n}))}},{key:"_legendRequest",value:function(e){var t=this.layer,n={f:"json",dynamicLayers:e};if(nt(t)){var i=t.exportImageServiceParameters.renderingRule;if(i&&(n.renderingRule=JSON.stringify(i.rasterFunctionDefinition||i.toJSON())),t.bandIds&&(n.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){var a=t.raster,l=t.viewId,s=t.customParameters;n=(0,r.Z)((0,r.Z)({raster:a,viewId:l},n),s)}}var o=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){var u=o.indexOf("?");u>-1?o=o.substring(0,u)+"/legend"+o.substring(u):o+="/legend"}else{var c=o.toLowerCase().indexOf("/rest/"),d=o.substring(0,c)+o.substring(c+5,o.length);o="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(d)+"&returnbytes=true"}return(0,C.default)(o,{query:n}).then((function(e){return e.data}))}},{key:"_constructLegendElementsForBuildingSceneLayer",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(){var t,n=this;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("sublayers-watcher"),t=this.layer,this._handles.add((0,d.YP)((function(){return t.sublayers}),(function(){return n._constructLegendElementsForBuildingSceneLayer()})),"sublayers-watcher"),e.prev=3,e.next=6,this._generateLegendElementsForBuildingSublayers(t.sublayers,this.opacity);case 6:this.legendElements=e.sent,this.notifyChange("ready"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),I.Z.getLogger(this.declaredClass).warn("Request to server for legend has failed!",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForBuildingSublayers",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t,n){var r,i,a,l,s,o=this;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],this._handles.add(t.on("change",(function(){return o._constructLegendElementsForBuildingSceneLayer()})),"sublayers-watcher"),i=t.toArray(),a=(0,b.Z)(i),e.prev=4,s=(0,g.Z)().mark((function e(){var t,i,a,s,u,c,f;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.value,i=(0,d.YP)((function(){return["renderer"in t&&t.renderer,t.opacity,t.title,t.visible]}),(function(){return o._constructLegendElementsForBuildingSceneLayer()})),o._handles.add(i,"sublayers-watcher"),o.respectLayerVisibility&&!t.visible){e.next=21;break}if(a=t&&null!=t.opacity?t.opacity:null,s=null!=a?a*n:n,"building-group"!==t.type){e.next=12;break}return c={type:"symbol-table",title:t.title,infos:[]},e.next=8,o._generateLegendElementsForBuildingSublayers(t.sublayers,s);case 8:f=e.sent,(u=c.infos).push.apply(u,(0,_.Z)(f)),r=[c].concat((0,_.Z)(r)),e.next=21;break;case 12:if(!t.renderer){e.next=21;break}return e.t0=[],e.t1=_.Z,e.next=17,o._getRendererLegendElements(t.renderer,{title:t.title,opacity:s,sublayer:t});case 17:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=(0,_.Z)(r),r=e.t0.concat.call(e.t0,e.t3,e.t4);case 21:case"end":return e.stop()}}),e)})),a.s();case 7:if((l=a.n()).done){e.next=11;break}return e.delegateYield(s(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),a.e(e.t1);case 16:return e.prev=16,a.f(),e.finish(16);case 19:return e.abrupt("return",r.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)})));case 20:case"end":return e.stop()}}),e,this,[[4,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_constructLegendElementsForSublayers",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(){var t,n=this;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("sublayers-watcher"),t=this.layer,this._handles.add((0,d.YP)((function(){return t.sublayers}),(function(){return n._constructLegendElementsForSublayers})),"sublayers-watcher"),e.prev=3,e.next=6,this._generateLegendElementsForSublayers(t.sublayers,this.opacity);case 6:this.legendElements=e.sent,this.notifyChange("ready"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),I.Z.getLogger(this.declaredClass).warn("Request to server for legend has failed!",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForSublayers",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t,n,r){var i,a,l,s,o,u,c=this;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.layer,a=[],this._handles.add(t.on("change",(function(){return c._constructLegendElementsForSublayers()})),"sublayers-watcher"),l=t.toArray(),!r&&this.sublayerIds&&this.sublayerIds.length&&(l=this.sublayerIds.map((function(e){return i.findSublayerById(e)})).filter(Boolean)),s=(0,b.Z)(l),e.prev=6,u=(0,g.Z)().mark((function e(){var t,l,s,u,f,y;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.value,l=(0,d.YP)((function(){return[t.renderer,t.opacity,t.title,t.visible,t.legendEnabled]}),(function(){return c._constructLegendElementsForSublayers()})),c._handles.add(l,"sublayers-watcher"),c.respectLayerVisibility&&!(t.visible&&t.legendEnabled&&c._isSublayerInScale(t))){e.next=21;break}if(s=t&&null!=t.opacity?t.opacity:null,u=null!=s?s*n:n,f=!!Ge(i)||t.originIdOf("renderer")>V.s3.SERVICE,!t.renderer||t.sublayers||!f){e.next=17;break}return e.next=7,t.load();case 7:return e.t0=[],e.t1=_.Z,e.next=11,c._getRendererLegendElements(t.renderer,{title:t.title,opacity:u,sublayer:t});case 11:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=(0,_.Z)(a),a=e.t0.concat.call(e.t0,e.t3,e.t4),e.next=21;break;case 17:return e.next=19,c._generateSymbolTableElementForSublayer(t,u,r);case 19:(y=e.sent)&&a.unshift(y);case 21:case"end":return e.stop()}}),e)})),s.s();case 9:if((o=s.n()).done){e.next=13;break}return e.delegateYield(u(),"t0",11);case 11:e.next=9;break;case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(6),s.e(e.t1);case 18:return e.prev=18,s.f(),e.finish(18);case 21:return e.abrupt("return",a.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)})));case 22:case"end":return e.stop()}}),e,this,[[6,15,18,21]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForSublayer",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t,n,r){var i,a,l,s,o,u,c;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=9;break}return r=new Map,i=this.layer,a=t.source,l=null,(a&&("map-layer"!==a.type||a.mapLayerId!==t.id||a.gdbVersion&&a.gdbVersion!==("gdbVersion"in i&&i.gdbVersion))||t.originIdOf("renderer")>V.s3.SERVICE||t.originIdOf("labelingInfo")>V.s3.SERVICE||t.originIdOf("labelsVisible")>V.s3.SERVICE)&&(s=new T.R({layer:this.layer}),l=s.hasDynamicLayers?s.dynamicLayers:null,s.destroy()),o=l||"".concat(i.uid,"-default"),e.next=8,this._getLegendLayers(o,l);case 8:e.sent.forEach((function(e){return r.set(e.layerId,e)}));case 9:if(!(!(u=r.get(t.id))||null!==u&&void 0!==u&&u.subLayerIds&&u.defaultVisibility)||!t.sublayers){e.next=15;break}return e.next=13,this._generateLegendElementsForSublayers(t.sublayers,n,r);case 13:return c=e.sent,e.abrupt("return",{type:"symbol-table",title:t.title,infos:c});case 15:return e.abrupt("return",this._generateSymbolTableElementForLegendLayer(u,t,n));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForLegendLayer",value:function(e,t,n){var r,i=this;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;var a=null===t||void 0===t?void 0:t.renderer,l=(null===t||void 0===t?void 0:t.title)||e.layerName;if(a&&(!t||(null===t||void 0===t?void 0:t.originIdOf("renderer"))>V.s3.SERVICE)){var s=(null===t||void 0===t?void 0:t.title)||this._getRendererTitle(a,t);s&&(l&&"string"!=typeof s&&"title"in s&&(s.title=l),l=s)}var o={type:"symbol-table",title:l,legendType:e.legendType?e.legendType:null,infos:[]},u=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return(null===(r=e.legendGroups)||void 0===r?void 0:r.length)>0?e.legendGroups.forEach((function(t){var r,a={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:i._generateSymbolTableElementInfosForLegendLayer(u.filter((function(e){return e.groupId===t.id})),e.layerId,n)};(null===(r=a.infos)||void 0===r?void 0:r.length)>0&&o.infos.push(a)})):o.infos=this._generateSymbolTableElementInfosForLegendLayer(u,e.layerId,n),o.infos.length>0?o:null}},{key:"_generateSymbolTableElementInfosForLegendLayer",value:function(e,t,n){var r=this;return e.map((function(e){var i=e.url;if(e.imageData&&e.imageData.length>0)i="data:image/png;base64,".concat(e.imageData);else{if(0===i.indexOf("http"))return null;i=(0,k.Dp)("".concat(r.layer.url,"/").concat(t,"/images/").concat(i))}return{label:e.label,src:i,opacity:null!==n&&void 0!==n?n:r.opacity,width:e.width,height:e.height}})).filter((function(e){return!!e}))}},{key:"_isSublayerInScale",value:function(e){var t=e.minScale||0,n=e.maxScale||0;return!(t>0&&t<this.scale||n>this.scale)}},{key:"_isLegendLayerInScale",value:function(e,t){var n=t||this.layer,r=null,i=null,a=!0;return!n.minScale&&0!==n.minScale||!n.maxScale&&0!==n.maxScale?(0===e.minScale&&n.tileInfo&&(r=n.tileInfo.lods[0].scale),0===e.maxScale&&n.tileInfo&&(i=n.tileInfo.lods[n.tileInfo.lods.length-1].scale)):(r=Math.min(n.minScale,e.minScale)||n.minScale||e.minScale,i=Math.max(n.maxScale,e.maxScale)),(r>0&&r<this.scale||i>this.scale)&&(a=!1),a}},{key:"_sanitizeLegendForSublayer",value:function(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;var n=t.renderer,r=e.some((function(e){return e.values})),i=null,a=null;return r&&e.some((function(e,t){return e.values||(i=t,(a=e).label||(a.label="others")),null!=a})),n?"unique-value"===n.type?a&&(e.splice(i,1),e.push(a)):"class-breaks"===n.type&&(a&&e.splice(i,1),e.reverse(),a&&e.push(a)):a&&(e.splice(i,1),e.push(a)),e}},{key:"_getRendererLegendElements",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t){var n,r,i=arguments;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},qe(t,this.view)){e.next=3;break}return e.abrupt("return",(I.Z.getLogger(this.declaredClass).warn("Renderer of type '".concat(t.type,"' not supported!")),[]));case 3:if(!Be(t)){e.next=5;break}return e.abrupt("return",this._constructPointCloudRendererLegendElements(t,n));case 5:if(!je(t)){e.next=7;break}return e.abrupt("return",this._constructDotDensityRendererLegendElements(t));case 7:return e.next=9,this._loadRenderer(t);case 9:return r=e.sent,e.abrupt("return",He(r)?this._constructPieChartRendererLegendElements(r):this._constructRendererLegendElements(r,n));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getLegendElementsForFeatureReduction",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t){var n;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.abrupt("return",("binning"===t.type?n=t.renderer:"cluster"===t.type&&(n=this._getClusterRenderer(t)),n?this._getRendererLegendElements(n):[]));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getPointCloudRendererTitle",value:function(e){return e.legendOptions&&e.legendOptions.title||e.field}},{key:"_constructPointCloudRendererLegendElements",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.title,i=[],a=null,l=null;if(Ue(e))a={type:"symbol-table",title:r||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((function(e){a.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:t._getAppliedCloneSymbol(Re,e.color)})}));else if(We(e)){var s=e.stops,o=null;if(s.length&&(1===s.length&&(o=s[0].color),!o)){var u=s[0].value,c=s[s.length-1].value;null!=u&&null!=c&&(o=(0,q.QQ)(u+(c-u)/2,s))}a={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(Re,o||Re.color)}]};var d=(0,q.NA)(e.stops);l={type:"color-ramp",title:r||this._getPointCloudRendererTitle(e),infos:d,preview:(0,W.jT)(d.map((function(e){return e.color})))}}else Ye(e)&&(a={type:"symbol-table",title:r||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((function(e){a.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:t._getAppliedCloneSymbol(Re,e.color)})})));a&&a.infos.length&&i.push(a),l&&l.infos.length&&i.push(l);var f=i.reduce((function(e,t){return e.concat(t.infos)}),[]).filter((function(e){return!!e.symbol})).map((function(n){return t._getSymbolPreview(n,t.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})}));return(0,Z.as)(f).then((function(){return i}))}},{key:"_getElementInfoForDotDensity",value:function(e,t){var n,r=e.backgroundColor,i=e.outline,a=e.dotSize,l=null===(n=this.effectList)||void 0===n?void 0:n.effects.map((function(e){return e.toJSON()})),s=(0,z.rM)(l),o=a+"-"+t+"-"+r+"-"+(i&&JSON.stringify(i.toJSON()))+"-"+s,u=this._dotDensityUrlCache,c=u.has(o)?u.get(o):(0,W.k)(e,t);u.set(o,c);var d={shape:{type:"image",x:0,y:0,width:c.width,height:c.height,src:c.src},fill:null,stroke:null,offset:[0,0]},f=(0,U.wh)([[d]],[c.width,c.height],{effectView:this.effectList});return{opacity:1,src:c.src,preview:f,width:c.width,height:c.height}}},{key:"_constructDotDensityRendererLegendElements",value:function(e){var t=this,n=e.calculateDotValue(this.view.scale),r=e.legendOptions&&e.legendOptions.unit,i={type:"symbol-table",title:{value:n&&Math.round(n),unit:r||""},infos:[]};return e.attributes.forEach((function(n){var r=t._getElementInfoForDotDensity(e,n.color);r.label=n.label||n.valueExpressionTitle||n.field,i.infos.push(r)})),Promise.resolve([i])}},{key:"_constructPieChartRendererLegendElements",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t){var n,r,i,a,l,s,o,u,c,d,f,y,h,p,v,m=this;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.layer.opacity,l=[],s=null,o=t.outline,t.attributes.forEach((function(e){var t=new te.Z({color:e.color,outline:o}),n=e.label||e.valueExpressionTitle||e.field;l.push({label:n,symbol:t})})),u=l.length?[].concat(l):[],null!==(n=t.othersCategory)&&void 0!==n&&n.color&&0!==(null===(r=t.othersCategory)||void 0===r?void 0:r.threshold)&&(c=new te.Z({color:t.othersCategory.color,outline:o}),s=t.othersCategory.label||"Other",l.push({label:s,symbol:c})),null!==(i=t.defaultColor)&&void 0!==i&&i.a&&(d=new te.Z({color:t.defaultColor,outline:o}),l.push({label:t.defaultLabel,symbol:d})),e.next=9,this._getVisualVariableLegendElements(t,this.layer);case 9:if(e.t0=e.sent,e.t0){e.next=12;break}e.t0=[];case 12:return f=e.t0,l.length&&(f.unshift({type:"symbol-table",title:null,infos:l}),h=u.filter((function(e){return e.label!==s})).map((function(e){return e.symbol.color})).filter(Boolean),p=(0,W.LC)(h,{holePercentage:t.holePercentage,backgroundColor:null===(y=t.backgroundFillSymbol)||void 0===y?void 0:y.color,effectList:this.effectList,outline:o}),f.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(t,this.layer),infos:l,preview:p})),v=f.reduce((function(e,t){return e.concat(m._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)&&!(null!==e&&void 0!==e&&e.preview)})).map((function(e){return m._getSymbolPreview(e,a,{effectList:m.effectList})})),e.next=17,(0,Z.as)(v);case 17:return e.abrupt("return",f);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_constructRendererLegendElements",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t){var n,r,i,a,l,s,o,u,d,f,y,h,p,v,m,w,L,k,C,x,S,I,E,R,V,F,z,T,A,M,N,P,O,B,U,Y,j,H,q,Q,$,K,ee,te,ne,re,ie,ae,le,se,oe,ue,ce,de,fe,ye,he,pe,ve,me,be,ge,_e,we,Le=this,ke=arguments;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ke.length>1&&void 0!==ke[1]?ke[1]:{},r=n.title,i=n.sublayer,a=i||this.layer,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null,e.next=5,this._getVisualVariableLegendElements(t,a);case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0=[];case 8:if(l=e.t0,s={type:"symbol-table",title:r||this._getRendererTitle(t,a),infos:[]},o=null,u=!1,d=new Set,!Fe(t)||this._hasSizeRamp){e.next=19;break}return e.next=15,(0,X.y$)(t);case 15:f=e.sent,s.infos.push({label:null,symbol:f}),e.next=84;break;case 19:if(!lt(t)){e.next=25;break}y=r,h=st(t)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",p=l.findIndex((function(e){return"color-ramp"===e.type})),v=-1!==p?l.splice(p,1)[0]:null,m=l.findIndex((function(e){return"size-ramp"===e.type})),w=-1!==m?l.splice(m,1)[0]:null,L=[],v&&(y=v.title,L.push(v)),w&&(y=w.title,L.push(w)),L.length>0&&l.push({type:h,title:y,infos:L}),e.next=84;break;case 25:if(!Oe(t)){e.next=30;break}k=(0,J.h)(t),l.push({type:"heatmap-ramp",title:r||this._getRendererTitle(t,a),infos:k,preview:(0,W.jT)(k.map((function(e){return e.color})),{effectList:this.effectList})}),e.next=84;break;case 30:if(!Pe(t)){e.next=36;break}if((C=t&&t.authoringInfo)&&"relationship"===C.type){if(x=C.focus,S=C.numClasses,I=C.field1,E=C.field2,S&&I&&E){for(R=[I,E],V=(0,G.N_)(x)||0,F=0,z=R;F<z.length;F++)T=z[F],A=T.field,M=T.normalizationField,N=T.label,P=N||{field:this._getFieldAlias(A,a),normField:M&&this._getFieldAlias(M,a)},(O=ot.clone()).angle=V,s.infos.push({label:P,symbol:O}),d.add(O),V+=90;B=(0,G.mg)({focus:x,numClasses:S,infos:t.uniqueValueInfos}),l.unshift(B)}}else nt(this.layer)||rt(this.layer)?t.uniqueValueInfos.forEach((function(e){e.symbol&&s.infos.push({label:e.label||e.value,value:e.value,symbol:e.symbol})})):(Y=(U=t).field,j=U.field2,H=U.field3,q=U.fieldDelimiter,Q=U.valueExpression,$=U.defaultSymbol,K=!(!Y&&!Q||!j&&!H),ee=[],t.uniqueValueGroups.forEach((function(e){var t={type:"symbol-table",title:e.heading,infos:[]};e.classes.forEach((function(e){var n=e.symbol,r=e.values;if(n){var i,l=[],s=[],o=(0,b.Z)(r);try{for(o.s();!(i=o.n()).done;){var u=i.value,c=u.value,d=u.value2,f=u.value3,y=[],h=[];(Y||Q)&&(y.push(c),h.push(Le._getDomainName(Y,c,a))),j&&(y.push(d),h.push(Le._getDomainName(j,d,a))),H&&(y.push(f),h.push(Le._getDomainName(H,f,a))),l.push(K?y.join(q||""):y[0]),s.push(h.join(" - "))}}catch(g){o.e(g)}finally{o.f()}var p=l.join(", "),v=e.label;if(!v){var m=s.filter(Boolean);v=m.length?m.join(", "):p}t.infos.push({label:v,value:p,symbol:n})}})),t.infos.length&&ee.push(t)})),ee.length&&(re=ee[0],1===ee.length&&"title"in re&&!re.title?(te=s.infos).push.apply(te,(0,_.Z)(re.infos)):($&&(ee.push({type:"symbol-table",infos:[{label:t.defaultLabel||"others",symbol:$}]}),u=!0),(ne=s.infos).push.apply(ne,ee)),r||t.legendOptions&&t.legendOptions.title||t.valueExpressionTitle||(s.title=null)));t.defaultSymbol&&!u&&(s.infos.push({label:t.defaultLabel||"others",symbol:t.defaultSymbol}),u=!0),e.next=84;break;case 36:if(!Ne(t)){e.next=41;break}(!(o=this._isUnclassedRenderer(t))||!this._hasSizeRamp)&&(t.classBreakInfos.forEach((function(e){e.symbol&&s.infos.unshift({label:e.label||(o?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})})),o&&(s.title=null),this._updateInfosforClassedSizeRenderer(t,s.infos)),t.defaultSymbol&&!o&&(s.infos.push({label:t.defaultLabel||"others",symbol:t.defaultSymbol}),u=!0),e.next=84;break;case 41:if(!Ae(t)){e.next=65;break}if(!rt(this.layer)&&!it(this.layer)){e.next=47;break}at(ie=this._constructTileImageryStretchRendererElements(t))?l.push(ie):s.infos=ie,e.next=63;break;case 47:if(ae=this.layer,t.statistics&&t.statistics.length&&(le=null!=t.statistics[0].min?t.statistics[0].min:t.statistics[0][0],se=null!=t.statistics[0].max?t.statistics[0].max:t.statistics[0][1]),oe=[],e.t1=c.Wg,!ae.renderingRule){e.next=57;break}return e.next=54,ae.generateRasterInfo(ae.renderingRule);case 54:e.t2=e.sent,e.next=58;break;case 57:e.t2=ae.serviceRasterInfo;case 58:e.t3=e.t2,ue=(0,e.t1)(e.t3),ce=ue.keyProperties.BandProperties,de=(0,D.r)(ue.pixelType),1===ue.bandCount?(ye=(null===(fe=ae.bandIds)||void 0===fe?void 0:fe[0])||0,le=null!=le?le:ue.statistics?ue.statistics[ye].min:de[0],se=null!=se?se:ue.statistics?ue.statistics[ye].max:de[1],le||se?l.push(this._getStretchLegendElements(t,{min:le,max:se})):this._getServerSideLegend()):ae.bandIds&&1===ae.bandIds.length?(le=null!=le?le:ue.statistics?ue.statistics[ae.bandIds[0]].min:de[0],se=null!=se?se:ue.statistics?ue.statistics[ae.bandIds[0]].max:de[1],le||se?l.push(this._getStretchLegendElements(t,{min:le,max:se})):this._getServerSideLegend()):ue.bandCount>=3?ce&&ce.length>=ue.bandCount?ae.bandIds&&3===ae.bandIds.length?(oe=ae.bandIds.map((function(e){return ce[e].BandName})),s.infos=this._createSymbolTableElementMultiBand(oe)):"lerc"===ae.format?(oe=[0,1,2].map((function(e){return ce[e].BandName})),s.infos=this._createSymbolTableElementMultiBand(oe)):this._getServerSideLegend():"lerc"===ae.format?(oe=["band1","band2","band3"],s.infos=this._createSymbolTableElementMultiBand(oe)):this._getServerSideLegend():this._getServerSideLegend();case 63:e.next=84;break;case 65:if(!Te(t)){e.next=69;break}t.colormapInfos.forEach((function(e){s.infos.push({label:e.label,value:e.value,symbol:Le._getAppliedCloneSymbol(Ve,e.color)})})),e.next=84;break;case 69:if(!Me(t)){e.next=83;break}he=t.symbol,e.t4=n.geometryType,e.next="point"===e.t4?74:"polyline"===e.t4?76:"polygon"===e.t4?78:79;break;case 74:return he="pointSymbol"in a&&a.pointSymbol,e.abrupt("break",79);case 76:return he="lineSymbol"in a&&a.lineSymbol,e.abrupt("break",79);case 78:he="polygonSymbol"in a&&a.polygonSymbol;case 79:pe=this._hasClusterSizeVariable&&this._getClusterSymbol()||!this._hasSizeRamp,t.symbol&&pe&&s.infos.push({label:t.label,symbol:he}),e.next=84;break;case 83:ze(t)?(t.outputUnit&&(this.title="("+t.toJSON().outputUnit+")"),s.title=t.attributeField,null!==(ve=t.getClassBreakInfos())&&void 0!==ve&&ve.length?ve.forEach((function(e){s.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):s.infos.push({label:t.attributeField,symbol:t.getDefaultSymbol()})):De(t)&&l.push(this._getStretchLegendElements(t,{min:0,max:255}));case 84:return!(me=t.defaultSymbol)||u||Me(t)||o&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||l.push({type:"symbol-table",infos:[{label:t.defaultLabel||"others",symbol:me}]}),s.infos.length&&l.unshift(s),be=null==n.opacity?this.opacity:n.opacity,ge=this._isTallSymbol("visualVariables"in t&&t.visualVariables),_e=nt(this.layer)||rt(this.layer),we=l.reduce((function(e,t){return e.concat(Le._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)})).map((function(e){return Le._getSymbolPreview(e,be,{isDefault:e.symbol===me,applyScaleDrivenSize:!d.has(e.symbol),symbolConfig:{isTall:ge,isSquareFill:_e},effectList:d.has(e.symbol)?null:Le.effectList})})),t=null,e.next=90,(0,Z.as)(we);case 90:return e.abrupt("return",l);case 91:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getServerSideLegend",value:function(){var e=this;setTimeout((function(){return e.buildLegendElementsForTools()}),0)}},{key:"_getAllInfos",value:function(e){var t=this,n=null===e||void 0===e?void 0:e.infos;return n?n.reduce((function(e,n){return e.concat(t._getAllInfos(n))}),[]):[e]}},{key:"_constructTileImageryStretchRendererElements",value:function(e){var t,n,r,i,a,l=this.layer,s=l.raster.rasterInfo,o=s.bandCount||e.statistics.length,u=s.keyProperties&&s.keyProperties.BandProperties,c=null!==e&&void 0!==e&&null!==(t=e.statistics)&&void 0!==t&&t.length?e.statistics:null===s||void 0===s?void 0:s.statistics;if(c)r=void 0!==c[0].min?c[0].min:c[0][0],i=c[0].max||c[0][1];else{var d=(0,D.r)(s.pixelType);r=d[0],i=d[1]}if(l.hasStandardTime()&&(r=l.getStandardTimeValue(r),i=l.getStandardTimeValue(i)),1===s.bandCount||1===(null===(n=l.bandIds)||void 0===n?void 0:n.length))return this._getStretchLegendElements(e,{min:r,max:i});function f(e){var t,n=(null!==l&&void 0!==l&&null!==(t=l.bandIds)&&void 0!==t&&t.length?l.bandIds:Array.from(Array(Math.min(s.bandCount,3)).keys())).map((function(t){return e&&e[t]&&e[t].BandName||"band"+(t+1)}));return n.length<3?n.push(n[1]):n.length>3&&n.splice(3),n}return a=u&&u.length>=o?f(u):f(),this._createSymbolTableElementMultiBand(a)}},{key:"_getStretchLegendElements",value:function(e,t){var n=e.colorRamp,r=(0,q.fD)(n,t);return{type:"stretch-ramp",title:"",infos:r,preview:(0,W.jT)(r.map((function(e){return e.color})))}}},{key:"_getClusterSymbol",value:function(){var e,t=this.layer,n="featureReduction"in t&&t.featureReduction,r=n&&"symbol"in n&&n.renderer;return r&&!0!==(null===r||void 0===r||null===(e=r.authoringInfo)||void 0===e?void 0:e.isAutoGenerated)?null:n&&"symbol"in n&&n.symbol}},{key:"_getSizeLegendElement",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t,n,r,i){return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this._hasClusterSizeVariable?this._getClusterTitle(n):t,e.t1=se,e.t2=r,e.t3=n,e.next=6,(0,X.jb)(r);case 6:return e.t4=e.sent,e.t5=this.scale,e.t6=this.view.type,e.t7=i,e.t8=this._hasClusterSizeVariable?this._getClusterSymbol():null,e.next=13,(0,e.t1)(e.t2,e.t3,e.t4,e.t5,e.t6,e.t7,e.t8);case 13:return e.t9=e.sent,e.abrupt("return",{type:"size-ramp",title:e.t0,infos:e.t9});case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_createSymbolTableElementMultiBand",value:function(e){var t=this,n=[],r=["red","green","blue"];return e.forEach((function(e,i){var a;n.push({label:{colorName:r[i],bandName:e},src:X.uY[i],opacity:null!==(a=t.opacity)&&void 0!==a?a:1})})),n}},{key:"_updateInfosforClassedSizeRenderer",value:function(e,t){var n=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,r=e.classBreakInfos.some((function(e){return(0,Y.YW)(e.symbol)}));if(n&&r){var i=e.classBreakInfos.length,a=18/(i>1?i-1:i);t.forEach((function(e,t){e.size=30-a*t}))}}},{key:"_isTallSymbol",value:function(e){var t=!1,n=!1;if(e)for(var r=0;r<e.length&&(!t||!n);r++){var i=e[r];"size"===i.type&&("height"===i.axis&&(t=!0),"width-and-depth"===i.axis&&(n=!0))}return t&&n}},{key:"_getSymbolPreview",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t,r,i){var a,l,s;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!==i&&void 0!==i&&i.isDefault||null!=t.size||!this._hasSizeRamp?t.size:(0,E.Wz)(B.b_.size),!this._scaleDrivenSizeVariable||null===i||void 0===i||!i.applyScaleDrivenSize){e.next=7;break}return e.next=4,Promise.resolve().then(n.bind(n,56011));case 4:l=e.sent,s=l.getSize,a=s(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===t.symbol.type?t.symbol.style:null});case 7:return e.abrupt("return",(0,W.l3)(t.symbol,{size:a,opacity:r,scale:!1,symbolConfig:null===i||void 0===i?void 0:i.symbolConfig,effectView:null===i||void 0===i?void 0:i.effectList}).then((function(e){return t.preview=e,t})).catch((function(){return t.preview=null,t})));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_getClusterRenderer",value:function(e){var t;this._hasClusterSizeVariable=!1;var n="renderer"in this.layer&&this.layer.renderer,r=(null===(t=e.renderer)||void 0===t?void 0:t.clone())||(null===n||void 0===n?void 0:n.clone()),i=(0,c.Wg)(H(this.layerView._effectiveRenderer,this.view));if(i&&"visualVariables"in r){var a,l=null===(a=r.visualVariables)||void 0===a?void 0:a.some((function(e){return"size"===e.type&&"outline"!==e.target&&!Ze.test(e.valueExpression)}));if(!l){if("clusterMinSize"in e&&"clusterMaxSize"in e){var s=e.clusterMinSize,o=e.clusterMaxSize;i.legendOptions=new P.Z({showLegend:s!==o})}var u=r.visualVariables||[];r.visualVariables=u.concat([i]),this._hasClusterSizeVariable=!0}}return r}},{key:"_loadRenderer",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t){var n,r,i,a,l=this;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],r=t.clone(),e.next=4,(0,X.jb)(r);case 4:return i=e.sent,(Ne(r)||Pe(r))&&(a=(r.classBreakInfos||r.uniqueValueInfos).map((function(e){return l._fetchSymbol(e.symbol,i).then((function(t){e.symbol=t})).catch((function(){e.symbol=null}))})),Array.prototype.push.apply(n,a)),e.abrupt("return",(n.push(this._fetchSymbol(r.symbol||r.defaultSymbol,r.defaultSymbol?null:i).then((function(e){l._applySymbolToRenderer(r,e,Me(r))})).catch((function(){l._applySymbolToRenderer(r,null,Me(r))}))),(0,Z.as)(n).then((function(){return r}))));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_applySymbolToRenderer",value:function(e,t,n){n?e.symbol=t:e.defaultSymbol=t}},{key:"_fetchSymbol",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t,n){var r,i;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error;case 2:if("web-style"!==t.type){e.next=14;break}return r=this._webStyleSymbolCache,e.prev=4,e.next=7,"2d"===this.view.type?t.fetchCIMSymbol({cache:r}):t.fetchSymbol({cache:r});case 7:return i=e.sent,e.abrupt("return",this._getAppliedCloneSymbol(i,n));case 11:throw e.prev=11,e.t0=e.catch(4),I.Z.getLogger(this.declaredClass).warn("Fetching web-style failed!"),new Error;case 14:return e.abrupt("return",this._getAppliedCloneSymbol(t,n));case 15:case"end":return e.stop()}}),e,this,[[4,11]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getAppliedCloneSymbol",value:function(e,t){if(!e||!t)return e;var n=e.clone(),r=t&&t.toRgba();return n.type.includes("3d")?this._applyColorTo3dSymbol(n,r):"cim"===n.type?(0,O.ZB)(n,t):n.color&&(n.color=new L.Z(r||n.color)),n}},{key:"_applyColorTo3dSymbol",value:function(e,t){t&&e.symbolLayers.forEach((function(e){e&&(e.material||(e.material={}),e.material.color=new L.Z(t))}))}},{key:"_getVisualVariableLegendElements",value:function(){var e=(0,w.Z)((0,g.Z)().mark((function e(t,n){var r,i,a,l,s,o,u,d,f,y,h,p,v,m=this;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("visualVariables"in t&&t.visualVariables&&"vector-field"!==t.type){e.next=2;break}return e.abrupt("return",null);case 2:r=t.visualVariables,i=[],a=[],l=[],s=(0,b.Z)(r);try{for(s.s();!(o=s.n()).done;)"color"===(u=o.value).type?i.push(u):"size"===u.type?a.push(u):"opacity"===u.type&&l.push(u)}catch(_){s.e(_)}finally{s.f()}return d=[].concat(i,a,l),0===i.length&&Ne(t)&&t.classBreakInfos&&1===t.classBreakInfos.length&&(h=t.classBreakInfos[0],f=h&&h.symbol),0===i.length&&Me(t)&&(f=t.symbol),f&&(f.type.includes("3d")?"water"===(p=f.symbolLayers.getItemAt(0)).type?(0,c.pC)(p.color)&&(y=p.color):(0,c.pC)(p.material)&&(0,c.pC)(p.material.color)&&(y=p.material.color):f.url||(y=f.color)),v=this.effectList,e.next=11,Promise.all(d.map(function(){var e=(0,w.Z)((0,g.Z)().mark((function e(r){var i,a,l,s,o,u;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.legendOptions&&!1===r.legendOptions.showLegend){e.next=28;break}if(i=Fe(t)?r.field:m._getRampTitle(r,n),a=null,l="getField"in n&&n.getField&&n.getField(r.field),s=l&&(0,A.y2)(l),"color"!==r.type){e.next=11;break}return e.next=7,(0,q.pO)(r,null,s);case 7:o=e.sent,a={type:"color-ramp",title:i,infos:o,preview:(0,W.jT)(o.map((function(e){return e.color})),{effectList:v})},m._hasColorRamp||(m._hasColorRamp=!(null==a.infos||!a.infos.length)),e.next=27;break;case 11:if("size"!==r.type||"outline"===r.target){e.next=22;break}if(!Ze.test(r.valueExpression)){e.next=16;break}m._hasClusterSizeVariable||(m._scaleDrivenSizeVariable=r),e.next=20;break;case 16:return e.next=18,m._getSizeLegendElement(i,r,t,s);case 18:a=e.sent,m._hasSizeRamp||(m._hasSizeRamp=!(null==a.infos||!a.infos.length));case 20:e.next=27;break;case 22:if("opacity"!==r.type){e.next=27;break}return e.next=25,(0,q.pO)(r,y,s);case 25:u=e.sent,a={type:"opacity-ramp",title:i,infos:u,preview:(0,W.jT)(u.map((function(e){return e.color})),{effectList:v})},m._hasOpacityRamp||(m._hasOpacityRamp=!(null==a.infos||!a.infos.length));case 27:return e.abrupt("return",a&&a.infos?a:null);case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return e.abrupt("return",e.sent.filter((function(e){return!!e})));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getDomainName",value:function(e,t,n){if(e&&"function"!=typeof e){var r="getField"in n&&n.getField&&n.getField(e),i=r&&"getFieldDomain"in n&&n.getFieldDomain?n.getFieldDomain(r.name):null;return i&&"coded-value"===i.type?i.getName(t):null}return null}},{key:"_getClusterTitle",value:function(e){var t=this.layer,n=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){var r=t.featureReduction,i="popupTemplate"in r&&r.popupTemplate,a=i&&i.fieldInfos;if(a){var l,s=(0,b.Z)(a);try{for(s.s();!(l=s.n()).done;){var o=l.value;if(o.fieldName===n)return"cluster_count"===n?o.label||{showCount:!0}:o.label}}catch(u){s.e(u)}finally{s.f()}}}return{showCount:!0}}},{key:"_getRampTitle",value:function(e,t){var n=e.field,r=e.normalizationField,i=!1,a=!1,l=!1,s=null;n="function"==typeof n?null:n,r="function"==typeof r?null:r;var o=e.legendOptions&&e.legendOptions.title;if(null!=o)s=o;else if(e.valueExpressionTitle)s=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables)for(var u=t.renderer.authoringInfo.visualVariables,c=0;c<u.length;c++){var d=u[c];if("color"===d.type){if("ratio"===d.style){i=!0;break}if("percent"===d.style){a=!0;break}if("percent-of-total"===d.style){l=!0;break}}}s={field:n&&this._getFieldAlias(n,t),normField:r&&this._getFieldAlias(r,t),ratio:i,ratioPercent:a,ratioPercentTotal:l}}return s}},{key:"_getRendererTitle",value:function(e,t){var n=e;if(n.legendOptions&&n.legendOptions.title)return n.legendOptions.title;if(n.valueExpressionTitle)return n.valueExpressionTitle;var r=n.field,i=null,a=null;if(Ne(n)&&(i=n.normalizationField,a="percent-of-total"===n.normalizationType),r="function"==typeof r?null:r,i="function"==typeof i?null:i,Pe(n)){var l=n.field2,s=n.field3,o=n.fieldDelimiter,u=r&&this._getFieldAlias(r,t);return l&&(u="<".concat(u,">").concat(o,"<").concat(this._getFieldAlias(l,t),">"),s&&(u="".concat(u).concat(o,"<").concat(this._getFieldAlias(s,t),">"))),u}var c=null;return(r||i)&&(c={field:r&&this._getFieldAlias(r,t),normField:i&&this._getFieldAlias(i,t),normByPct:a}),c}},{key:"_getFieldAlias",value:function(e,t){var n,r,i,a="popupTemplate"in t&&t.popupTemplate,l=a&&a.fieldInfos,s=null;l&&l.some((function(t){return e===t.fieldName&&(s=t,!0)}));var o=null;"getField"in t&&t.getField?o=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(o=t.fieldsIndex.get(e));var u=null,c="featureReduction"in t&&t.featureReduction;c&&(!s&&"popupTemplate"in c&&c.popupTemplate&&c.popupTemplate.fieldInfos&&c.popupTemplate.fieldInfos.some((function(t){var n;return(null===e||void 0===e?void 0:e.toLowerCase())===(null===(n=t.fieldName)||void 0===n?void 0:n.toLowerCase())&&(s=t,!0)})),"fields"in c&&c.fields&&(u=c.fields.find((function(t){var n;return(null===(n=t.name)||void 0===n?void 0:n.toLowerCase())===(null===e||void 0===e?void 0:e.toLowerCase())}))));var d=s||o||u,f=null;return d&&(f=(null===(n=s)||void 0===n?void 0:n.label)||(null===(r=o)||void 0===r?void 0:r.alias)||(null===(i=u)||void 0===i?void 0:i.alias)||"name"in d&&d.name||"fieldName"in d&&d.fieldName),f}},{key:"_isUnclassedRenderer",value:function(e){var t=e.visualVariables,n=!1;return Ne(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(n=e.field?t.some((function(t){return!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField)})):!!t.length),n}}]),o}(v.Z);(0,o._)([(0,f.Cb)()],ct.prototype,"children",void 0),(0,o._)([(0,f.Cb)({readOnly:!0})],ct.prototype,"effectList",null),(0,o._)([(0,f.Cb)()],ct.prototype,"layerView",void 0),(0,o._)([(0,f.Cb)()],ct.prototype,"layer",void 0),(0,o._)([(0,f.Cb)()],ct.prototype,"legendElements",void 0),(0,o._)([(0,f.Cb)({readOnly:!0})],ct.prototype,"opacity",null),(0,o._)([(0,f.Cb)()],ct.prototype,"parent",void 0),(0,o._)([(0,f.Cb)({readOnly:!0,dependsOn:[]})],ct.prototype,"ready",null),(0,o._)([(0,f.Cb)()],ct.prototype,"hideLayersNotInCurrentView",void 0),(0,o._)([(0,f.Cb)()],ct.prototype,"keepCacheOnDestroy",void 0),(0,o._)([(0,f.Cb)()],ct.prototype,"respectLayerVisibility",void 0),(0,o._)([(0,f.Cb)({readOnly:!0})],ct.prototype,"scale",null),(0,o._)([(0,f.Cb)()],ct.prototype,"sublayerIds",void 0),(0,o._)([(0,f.Cb)({readOnly:!0})],ct.prototype,"isScaleDriven",null),(0,o._)([(0,f.Cb)()],ct.prototype,"title",void 0),(0,o._)([(0,f.Cb)({readOnly:!0,dependsOn:["ready"],value:0})],ct.prototype,"version",null),(0,o._)([(0,f.Cb)()],ct.prototype,"view",void 0);var dt=ct=(0,o._)([(0,h.j)("esri.widgets.Legend.support.ActiveLayerInfo")],ct),ft=n(36257),yt="state",ht="view",pt="all-layer-views",vt="legend-properties",mt=m.Z.ofType(dt),bt=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.SubtypeGroupLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer","esri.layers.LinkChartLayer","esri.layers.knowledgeGraph.KnowledgeGraphSubLayer"],gt="view.basemapView.baseLayerViews",_t="view.groundView.layerViews",wt="view.basemapView.referenceLayerViews",Lt=[gt,_t,"view.layerViews",wt],kt=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._handles=new u.Z,r._layerViewByLayerId={},r._layerInfosByLayerViewId={},r._activeLayerInfosByLayerViewId={},r._activeLayerInfosWithNoParent=new m.Z,r.activeLayerInfos=new mt,r.basemapLegendVisible=!1,r.groundLegendVisible=!1,r.hideLayersNotInCurrentView=!1,r.keepCacheOnDestroy=!1,r.respectLayerVisibility=!0,r.layerInfos=[],r.view=null,r}return(0,a.Z)(n,[{key:"initialize",value:function(){var e=this;this._handles.add((0,d.YP)((function(){return e.view}),(function(){return e._viewHandles()}),d.nn),ht),this._handles.add((0,ft.qe)((function(){return e._refresh()})))}},{key:"destroy",value:function(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"_viewHandles",value:function(){var e=this;this._handles.remove(yt),this.view&&this._handles.add((0,d.YP)((function(){return e.state}),(function(){return e._stateHandles()}),d.nn),yt)}},{key:"_stateHandles",value:function(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}},{key:"_resetAll",value:function(){this._handles.remove([pt,vt]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}},{key:"_destroyViewActiveLayerInfos",value:function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}},{key:"_destroyViewActiveLayerInfo",value:function(e){this._handles.remove(e);var t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}},{key:"_watchPropertiesAndAllLayerViews",value:function(){var e=this,t=this.view.allLayerViews;t.length&&this._refresh(),this._handles.add(t.on("change",(function(t){return e._allLayerViewsChangeHandle(t)})),pt),this._handles.add((0,d.YP)((function(){return[e.layerInfos,e.basemapLegendVisible,e.groundLegendVisible]}),(function(){return e._propertiesChangeHandle()})),vt)}},{key:"_allLayerViewsChangeHandle",value:function(e){var t=this;e.removed.forEach((function(e){return t._destroyViewActiveLayerInfo(e.uid)})),this._refresh()}},{key:"_propertiesChangeHandle",value:function(){this._destroyViewActiveLayerInfos(),this._refresh()}},{key:"_refresh",value:function(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}},{key:"_sortActiveLayerInfos",value:function(e){var t=this;if(!(e.length<2)){var n=[];e.forEach((function(r){if(!r.parent){var i=r.layer.parent,a=i&&"uid"in i&&t._layerViewByLayerId[i.uid],l=a&&t._activeLayerInfosByLayerViewId[a.uid];l&&e.includes(l)&&(n.push(r),r.parent=l,l.children.add(r),t._sortActiveLayerInfos(l.children))}})),e.removeMany(n);var r={};this.view.allLayerViews.forEach((function(e,t){return r[e.layer.uid]=t})),e.sort((function(e,t){var n=r[e.layer.uid]||0;return(r[t.layer.uid]||0)-n}))}}},{key:"_generateLayerViews",value:function(){var e=[];return Lt.filter(this._filterLayerViews,this).map(this.get,this).filter((function(e){return null!=e})).forEach(this._collectLayerViews("layerViews",e)),e}},{key:"_filterLayerViews",value:function(e){var t=!this.basemapLegendVisible&&(e===gt||e===wt),n=!this.groundLegendVisible&&e===_t;return!t&&!n}},{key:"_collectLayerViews",value:function(e,t){return function n(r){return r&&r.forEach((function(r){t.push(r),n(r[e])})),t}}},{key:"_filterLayerViewsByLayerInfos",value:function(e){var t=this,n=this.layerInfos;return!n||!n.length||n.some((function(n){return t._hasLayerInfo(n,e)}))}},{key:"_hasLayerInfo",value:function(e,t){var n=this._isLayerUIDMatching(e.layer,t.layer.uid);return n&&(this._layerInfosByLayerViewId[t.uid]=e),n}},{key:"_isLayerUIDMatching",value:function(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}},{key:"_hasLayerUID",value:function(e,t){var n=this;return e&&e.some((function(e){return n._isLayerUIDMatching(e,t)}))}},{key:"_isLayerViewSupported",value:function(e){return!!bt.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}},{key:"_generateActiveLayerInfo",value:function(e){var t=this;this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add((0,d.YP)((function(){var t;return[e.legendEnabled,null===(t=e.layer)||void 0===t?void 0:t.legendEnabled]}),(function(){return t._layerActiveHandle(e)})),e.uid))}},{key:"_layerActiveHandle",value:function(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}},{key:"_isLayerActive",value:function(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}},{key:"_buildActiveLayerInfo",value:function(e){var t,n=this,r=e.layer,i=e.uid,a=this._layerInfosByLayerViewId[i],l=this._activeLayerInfosByLayerViewId[i];if(!l){var s=a&&void 0!==a.title&&a.layer.uid===r.uid;l=new dt({layer:r,layerView:e,title:s?a.title:r.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:a&&a.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=l}var o=r.parent&&"uid"in r.parent&&this._layerViewByLayerId[null===(t=r.parent)||void 0===t?void 0:t.uid];if(l.parent=this._activeLayerInfosByLayerViewId[null===o||void 0===o?void 0:o.uid],!this._handles.has(i)){var u=[(0,d.YP)((function(){return r.title}),(function(e){return n._titleHandle(e,l)})),(0,d.YP)((function(){return[r.opacity,"renderer"in r&&r.renderer,"pointSymbol"in r&&r.pointSymbol,"lineSymbol"in r&&r.lineSymbol,"polygonSymbol"in r&&r.polygonSymbol]}),(function(){return n._constructLegendElements(l)})),(0,d.gx)((function(){var e;return!0===(null===(e=n.view)||void 0===e?void 0:e.stationary)}),(function(){return n._scaleHandle(l)}),d.nn),(0,d.YP)((function(){return e._effectiveRenderer}),(function(){return n._constructLegendElements(l)})),(0,d.YP)((function(){return"effect"in r&&r.effect}),(function(){return n._constructLegendElements(l)}))];if(this.respectLayerVisibility){var c=(0,d.YP)((function(){return e.legendEnabled}),(function(e){return n._legendEnabledHandle(e,l)})),f=(0,d.YP)((function(){return r.legendEnabled}),(function(e){return n._legendEnabledHandle(e,l)}));u.push(c,f)}this._handles.add(u,i)}l.isScaleDriven||this._constructLegendElements(l),this._addActiveLayerInfo(l)}},{key:"_titleHandle",value:function(e,t){t.title=e,this._constructLegendElements(t)}},{key:"_legendEnabledHandle",value:function(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}},{key:"_scaleHandle",value:function(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}},{key:"_addActiveLayerInfo",value:function(e){var t=this,n=e.layerView,r=e.layer;if(this._isLayerActive(n)&&!this.activeLayerInfos.includes(e)){var i=e.parent;if(i)i.children.includes(e)||i.children.push(e),this._sortActiveLayerInfos(i.children);else{var a,l=null===(a=this.layerInfos)||void 0===a?void 0:a.some((function(e){return e.layer.uid===r.uid}));r.parent&&"uid"in r.parent&&!l?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){var s=[];this._activeLayerInfosWithNoParent.forEach((function(e){var n=e.layer.parent,r=n&&"uid"in n&&t._layerViewByLayerId[null===n||void 0===n?void 0:n.uid],i=t._activeLayerInfosByLayerViewId[null===r||void 0===r?void 0:r.uid];i&&(s.push(e),e.parent=i)})),s.length&&(this._activeLayerInfosWithNoParent.removeMany(s),s.forEach((function(e){return t._addActiveLayerInfo(e)})))}}}},{key:"_removeActiveLayerInfo",value:function(e){var t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}},{key:"_constructLegendElements",value:function(e){var t=this,n=e.layer;"featureCollections"in n&&n.featureCollections?e.buildLegendElementsForFeatureCollections(n.featureCollections):"featureReduction"in n&&n.featureReduction&&"renderer"in n.featureReduction&&("binning"===n.featureReduction.type||"cluster"===n.featureReduction.type)?e.buildLegendElementsForFeatureReduction(n.featureReduction):"renderer"in n&&n.renderer&&!("sublayers"in n)?e.buildLegendElementsForRenderer(n.renderer):"url"in n&&n.url?e.buildLegendElementsForTools():e.children.forEach((function(e){return t._constructLegendElements(e)}))}}]),n}(v.Z);(0,o._)([(0,f.Cb)({type:mt})],kt.prototype,"activeLayerInfos",void 0),(0,o._)([(0,f.Cb)()],kt.prototype,"basemapLegendVisible",void 0),(0,o._)([(0,f.Cb)()],kt.prototype,"groundLegendVisible",void 0),(0,o._)([(0,f.Cb)()],kt.prototype,"hideLayersNotInCurrentView",void 0),(0,o._)([(0,f.Cb)()],kt.prototype,"keepCacheOnDestroy",void 0),(0,o._)([(0,f.Cb)()],kt.prototype,"respectLayerVisibility",void 0),(0,o._)([(0,f.Cb)()],kt.prototype,"layerInfos",void 0),(0,o._)([(0,f.Cb)({readOnly:!0})],kt.prototype,"state",null),(0,o._)([(0,f.Cb)()],kt.prototype,"view",void 0);var Ct=kt=(0,o._)([(0,h.j)("esri.widgets.Legend.LegendViewModel")],kt),xt=n(4942),St=n(99653),It="esri-legend--card",Zt="esri-legend",Et={activated:"".concat(It,"__carousel-indicator--activated"),base:It,stacked:"".concat(Zt,"--stacked"),carouselTitle:"".concat(It,"__carousel-title"),indicator:"".concat(It,"__carousel-indicator"),intervalSeparator:"".concat(It,"__interval-separator"),imageryLayerStretchedImage:"".concat(It,"__imagery-layer-image--stretched"),imageLabel:"".concat(It,"__image-label"),layerCaption:"".concat(It,"__layer-caption"),labelElement:"".concat(It,"__label-element"),layerRow:"".concat(It,"__layer-row"),labelCell:"".concat(It,"__label-cell"),message:"".concat(It,"__message"),rampLabel:"".concat(It,"__ramp-label"),section:"".concat(It,"__section"),relationshipSection:"".concat(It,"__relationship-section"),serviceCaptionText:"".concat(It,"__service-caption-text"),serviceContent:"".concat(It,"__service-content"),service:"".concat(It,"__service"),groupLayer:"".concat(It,"__group-layer"),groupLayerChild:"".concat(It,"__group-layer-child"),symbol:"".concat(It,"__symbol"),sizeRampRow:"".concat(It,"__size-ramp-row"),symbolRow:"".concat(It,"__symbol-row"),symbolCell:"".concat(It,"__symbol-cell"),indicatorContainer:"".concat(It,"__carousel-indicator-container"),intervalSeparatorsContainer:"".concat(It,"__interval-separators-container"),relationshipLabelContainer:"".concat(It,"__relationship-label-container"),labelContainer:"".concat(It,"__label-container"),serviceCaptionContainer:"".concat(It,"__service-caption-container"),symbolContainer:"".concat(It,"__symbol-container"),sizeRampContainer:"".concat(It,"__size-ramp-container"),sizeRampPreview:"".concat(It,"__size-ramp-preview"),pieChartRampPreview:"".concat(It,"__pie-chart-ramp-preview"),rampContainer:"".concat(Zt,"__ramps"),sizeRampHorizontal:"".concat(Zt,"__size-ramp--horizontal"),rampLabelsContainer:"".concat(Zt,"__ramp-labels"),layerInfo:"".concat(Zt,"__layer-cell ").concat(Zt,"__layer-cell--info"),univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card",hidden:"esri-hidden"},Rt=n(63528),Vt=(n(42877),n(88367)),Ft=n(67005),zt=(0,Vt.E)(),Tt=20,At=10,Dt=20,Mt="esri-univariate-above-and-below-ramp__symbol",Nt="esri-legend__color-ramp";function Pt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertical",t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?(0,Ft.u)("svg",{height:"4",width:"10"},(0,Ft.u)("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):(0,Ft.u)("svg",{height:"10",width:"10"},(0,Ft.u)("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function Ot(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",n=document.createElement("div");return n.style.height="".concat(Tt,"px"),n.className=Mt,null!=e&&(n.style.opacity=e.toString()),zt.append(n,Pt.bind(null,t)),n}function Bt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",r=arguments.length>3?arguments[3]:void 0;e.infos.forEach((function(e,i){if(r&&2===i)e.preview=Ot(t,n);else{var a=(0,E.F2)(e.size)+("horizontal"===n?Dt:At),l="div"===e.preview.tagName.toLowerCase(),s=l?e.preview:document.createElement("div");s.className=Mt,"horizontal"===n?s.style.width="".concat(a,"px"):s.style.height="".concat(a,"px"),l||s.appendChild(e.preview),e.preview=s}}))}function Ut(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"classic",n=e.infos;return"classic"===t?((0,E.F2)(n[0].size)+At)/2:((0,E.F2)(n[0].size)-(0,E.F2)(n[n.length-1].size))/2}function Wt(e,t){if(!e)return null;var n=e.infos.map((function(e){return e.color})),r=(0,W.jT)("full"===t.type?n:"above"===t.type?n.slice(0,3):n.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList});return r.className=Nt,null!=t.opacity&&(r.style.opacity=t.opacity.toString()),r}function Yt(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",i=0,a=e.infos,l=Math.floor(a.length/2),s="full"===t||"above"===t?0:l,o="full"===t||"below"===t?a.length-1:l,u=s;u<=o;u++)i+=n&&u===l?"horizontal"===r?10:Tt:(0,E.F2)(a[u].size)+("horizontal"===r?Dt:At);return Math.round(i)}function jt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",i=Yt(e,t,n,r),a=e.infos,l=Math.floor(a.length/2),s="full"===t||"above"===t?0:l,o="full"===t||"below"===t?a.length-1:l,u="full"===t?a[s].size+a[o].size:"above"===t?a[s].size:a[o].size,c=n?"vertical"===r?Tt:10:0,d="vertical"===r?At*("full"===t?2:1):Dt*("full"===t?2:1);return Math.round(i-((0,E.F2)(u)/2+c/2+d/2))}function Ht(e,t){var n,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",l=e.infos,s=l.find((function(e){return"size-ramp"===e.type})),o=l.find((function(e){return"color-ramp"===e.type}));return s&&((s=(0,r.Z)({},s)).infos=(0,_.Z)(s.infos),Bt(s,t,a,!0)),o&&((o=(0,r.Z)({},o)).infos=(0,_.Z)(o.infos)),"horizontal"===a&&(null!==(n=s)&&void 0!==n&&n.infos.reverse(),null!==(i=o)&&void 0!==i&&i.infos.reverse()),{sizeRampElement:s,colorRampElement:o}}function qt(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",a=e.infos,l=a.find((function(e){return"size-ramp"===e.type})),s=a.find((function(e){return"color-ramp"===e.type}));return l&&((l=(0,r.Z)({},l)).infos=(0,_.Z)(l.infos),Bt(l,null,i,!1)),s&&((s=(0,r.Z)({},s)).infos=(0,_.Z)(s.infos)),"horizontal"===i&&(null!==(t=l)&&void 0!==t&&t.infos.reverse(),null!==(n=s)&&void 0!==n&&n.infos.reverse()),{sizeRampElement:l,colorRampElement:s}}var Jt=n(8704);function Gt(e){e.appendChild(this)}function Qt(e,t,n){if(t){if("string"==typeof t||"number"==typeof t)return t;if("value"in t||"unit"in t)return(0,Jt.n)(e.dotValue,t);if("colorName"in t&&"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;var r=null;return function(e,t){return t}(0,n)?r=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:$t(t,n)&&(r=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),r?(0,Jt.n)("showField"===r?"{field}":e[r],{field:t.field,normField:t.normField}):null}}function $t(e,t){return!t}function Xt(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}var Kt,en=n(96919),tn=n(78088),nn=n(80532);!function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side"}(Kt||(Kt={}));var rn=window.devicePixelRatio;var an=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this,e,r))._handles=new u.Z,a._hasIndicators=!1,a._selectedSectionName=null,a._sectionNames=[],a._sectionMap=new Map,a.activeLayerInfos=null,a.headingLevel=3,a.layout=Kt.Stack,a.messages=null,a.messagesCommon=null,a.type="card",a.view=null,a}return(0,a.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles((0,d.YP)((function(){return e.activeLayerInfos}),(function(t){e._handles.removeAll(),e._watchForSectionChanges(t)})))}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null}},{key:"render",value:function(){var e=this;this._hasIndicators=this.layout===Kt.Auto&&this.view.container.clientWidth<=768||this.layout===Kt.Stack;var t=this.activeLayerInfos,n=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;var r=this._sectionNames.length,i=this._sectionNames.map((function(t,n){var i=(0,Jt.n)(e.messagesCommon.pagination.pageText,{index:n+1,total:r});return(0,Ft.u)("div",{key:t,role:"tab",id:t,"aria-label":i,"aria-controls":"".concat(t,"-panel"),"aria-selected":(e._selectedSectionName===t).toString(),tabIndex:e._selectedSectionName===t?0:-1,title:i,onclick:e._selectSection,onkeydown:e._focusSection,bind:e,class:e.classes(Et.indicator,(0,xt.Z)({},Et.activated,e._selectedSectionName===t)),"data-section-name":t})})),a=this._hasIndicators&&r>1?(0,Ft.u)("div",{class:Et.indicatorContainer,key:"carousel-navigation",role:"tablist"},i):null,l=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):n&&n.length?n:null,s=(0,xt.Z)({},Et.stacked,this._hasIndicators);return(0,Ft.u)("div",{class:this.classes(Et.base,s)},l||(0,Ft.u)("div",{class:Et.message},this.messages.noLegend),a)}},{key:"_selectSection",value:function(e){var t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}},{key:"_focusSection",value:function(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}},{key:"_switchSectionOnArrowPress",value:function(e){var t=e.key,n="ArrowLeft"===t?-1:1,r=e.target.getAttribute("data-section-name"),i=this._sectionNames.indexOf(r),a=this._sectionNames,l=null;-1!==i&&(a[i+n]?l=document.getElementById(a[i+n]):"ArrowLeft"===t?l=document.getElementById(a[a.length-1]):"ArrowRight"===t&&(l=document.getElementById(a[0])),l&&l.focus())}},{key:"_watchForSectionChanges",value:function(e){var t=this;if(this._generateSectionNames(),e){e.forEach((function(e){var n="activeLayerInfo-".concat(e.layer.uid,"-version-change");t._handles.remove(n),t._watchForSectionChanges(e.children),t._handles.add((0,d.YP)((function(){return e.version}),(function(){return t._generateSectionNames()})),n)}));var n="activeLayerInfos-collection-change";this._handles.remove(n),this._handles.add(e.on("change",(function(){return t._watchForSectionChanges(e)})),n)}}},{key:"_generateSectionNames",value:function(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}},{key:"_getSectionName",value:function(e,t,n){return"".concat(this.id).concat(e.uid,"-type-").concat(t.type,"-").concat(n)}},{key:"_generateSectionNamesForActiveLayerInfo",value:function(e){var t=this;e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((function(n,r){t._sectionNames.push(t._getSectionName(e.layer,n,r))}))}},{key:"_renderLegendForLayer",value:function(e){var t=this;if(!e.ready)return null;if(e.children.length){var n=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return(0,Ft.u)("div",{key:e.layer.uid,class:this.classes(Et.service,Et.groupLayer)},(0,Ft.u)("div",{class:Et.serviceCaptionContainer},e.title),n)}var r=e.legendElements;if(r&&!r.length)return null;var i=r.some((function(e){return"relationship-ramp"===e.type})),a=r.map((function(n,r){return t._renderLegendForElement(n,e,r,i)})).filter((function(e){return!!e}));if(!a.length)return null;var l=(0,xt.Z)({},Et.groupLayerChild,!!e.parent);return(0,Ft.u)("div",{key:e.layer.uid,class:this.classes(Et.service,l)},(0,Ft.u)("div",{class:Et.serviceCaptionContainer},(0,Ft.u)("div",{class:Et.serviceCaptionText},e.title)),(0,Ft.u)("div",{class:Et.serviceContent},a))}},{key:"_renderLegendForElement",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l="color-ramp"===e.type,s="opacity-ramp"===e.type,o="size-ramp"===e.type,u=t.layer,c=null;if("string"==typeof e.title)c=e.title;else if(e.title){var d=e.title,f=Qt(this.messages,d,l||s);c=d.title?"".concat(d.title," (").concat(f,")"):f}var y=this._getSectionName(u,e,n),h=this._hasIndicators&&!a?(0,Ft.u)("div",null,(0,Ft.u)(en.X6,{level:this.headingLevel,class:Et.carouselTitle},t.title),(0,Ft.u)(en.X6,{level:(0,en.MJ)(this.headingLevel),class:Et.layerCaption},c)):c?(0,Ft.u)(en.X6,{level:this.headingLevel,class:Et.layerCaption},c):null,p=t.effectList,v=null;if("symbol-table"===e.type){var m=e.infos.map((function(n,i){return r._renderLegendForElementInfo(n,t,e.legendType,i)})).filter((function(e){return!!e}));if(m.length){var b,g=m[0].properties.classes&&m[0].properties.classes[Et.symbolRow],_=(b={},(0,xt.Z)(b,Et.labelContainer,!g&&!i),(0,xt.Z)(b,Et.relationshipLabelContainer,i),b);v=(0,Ft.u)("div",{class:this.classes(_)},m)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?v=this._renderLegendForRamp(e,u.opacity,p):o?v=this._renderSizeRamp(e,u.opacity):"pie-chart-ramp"===e.type?v=this._renderPieChartRamp(e):"relationship-ramp"===e.type?v=(0,Rt.g)(e,this.id,u.opacity,p):"univariate-above-and-below-ramp"===e.type?v=this._renderUnivariateAboveAndBelowRamp(e,u.opacity,p):"univariate-color-size-ramp"===e.type&&(v=this._renderUnivariateColorSizeRamp(e,u.opacity,p));if(!v)return null;var w=(0,Ft.u)("div",{key:y,class:Et.section,id:"".concat(y,"-panel"),role:"tabpanel","aria-labelledby":y,tabIndex:0},[h,v]);return a||this._sectionMap.set(y,w),w}},{key:"_renderPieChartRamp",value:function(e){return(0,Ft.u)("div",{class:Et.pieChartRampPreview,bind:e.preview,afterCreate:Gt})}},{key:"_renderUnivariateAboveAndBelowRamp",value:function(e,t,n){var r=Ht(e,t,"horizontal"),i=r.sizeRampElement,a=r.colorRampElement;if(!i)return null;var l=Yt(i,"full",!0,"horizontal"),s=jt(i,"above",!0,"horizontal"),o=jt(i,"below",!0,"horizontal"),u=Wt(a,{width:s,height:12,rampAlignment:"horizontal",opacity:t,type:"above",effectList:n}),c=Wt(a,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"below",effectList:n}),d=Ut(i,"card"),f=i.infos.map((function(e){return e.label})),y=f.length-1,h=f.map((function(e,t){return 0===t||t===y?(0,Ft.u)("div",{key:t},e):null})),p={marginTop:"3px",display:"flex"};(0,K.dZ)(this.container)?p.marginRight="".concat(d,"px"):p.marginLeft="".concat(d,"px");var v={width:"".concat(l,"px"),display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,Ft.u)("div",{class:Et.layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,Ft.u)("div",{class:this.classes(Et.symbolContainer,Et.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},i.infos.map((function(e,t){return(0,Ft.u)("div",{key:t,class:Et.symbol,bind:e.preview,afterCreate:Gt})}))),u?(0,Ft.u)("div",{class:Et.univariateAboveAndBelowColorRamp,styles:p,key:"color-ramp-preview"},(0,Ft.u)("div",{bind:u,afterCreate:Gt}),(0,Ft.u)("div",{bind:c,afterCreate:Gt})):null,(0,Ft.u)("div",{class:Et.layerInfo},(0,Ft.u)("div",{class:Et.rampLabelsContainer,styles:v},h)))}},{key:"_renderUnivariateColorSizeRamp",value:function(e,t,n){var r=qt(e,"horizontal"),i=r.sizeRampElement,a=r.colorRampElement;if(!i)return null;var l=Yt(i,"full",!1,"horizontal"),s=Wt(a,{width:jt(i,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:n}),o=Ut(i,"card"),u=i.infos.length-1,c=i.infos.map((function(e,t){return 0===t||t===u?(0,Ft.u)("div",{key:t},e.label):null})),d={marginTop:"3px",display:"flex"};(0,K.dZ)(this.container)?d.marginRight="".concat(o,"px"):d.marginLeft="".concat(o,"px");var f={width:"".concat(l,"px"),display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,Ft.u)("div",{class:Et.layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,Ft.u)("div",{class:this.classes(Et.symbolContainer,Et.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},i.infos.map((function(e,t){return(0,Ft.u)("div",{key:t,class:Et.symbol,bind:e.preview,afterCreate:Gt})}))),(0,Ft.u)("div",{class:Et.univariateAboveAndBelowColorRamp,styles:d,key:"color-ramp-preview"},(0,Ft.u)("div",{bind:s,afterCreate:Gt})),(0,Ft.u)("div",{class:Et.layerInfo},(0,Ft.u)("div",{class:Et.rampLabelsContainer,styles:f},c)))}},{key:"_renderLegendForElementInfo",value:function(e,t,n,r){var i=t.layer;if(e.type)return this._renderLegendForElement(e,t,r,!1,!0);var a=Xt(i,n);if(e.preview){var l,s;if(!e.symbol||!e.symbol.type.includes("simple-fill")){if(!e.label)return(0,Ft.u)("div",{key:r,bind:e.preview,afterCreate:Gt});var o=(0,xt.Z)({},Et.symbolCell,this._hasIndicators);return(0,Ft.u)("div",{key:r,class:this.classes(Et.layerRow,(0,xt.Z)({},Et.symbolRow,this._hasIndicators))},(0,Ft.u)("div",{class:this.classes(o),bind:e.preview,afterCreate:Gt}),(0,Ft.u)("div",{class:this.classes(Et.imageLabel,(0,xt.Z)({},Et.labelCell,this._hasIndicators))},Qt(this.messages,e.label,!1)||""))}var u=255,c=255,d=255,f=0,y=255,h=255,p=255,v=0,m=e.symbol.color&&e.symbol.color.a,b=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;m&&(u=e.symbol.color.r,c=e.symbol.color.g,d=e.symbol.color.b,f=e.symbol.color.a*i.opacity),b&&(y=e.symbol.outline.color.r,h=e.symbol.outline.color.g,p=e.symbol.outline.color.b,v=e.symbol.outline.color.a*i.opacity);var g=null===(l=null===(s=e.symbol.color)||void 0===s?void 0:s.isBright)||void 0===l||l,_=g?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",w={background:m?"rgba(".concat(u,", ").concat(c,", ").concat(d,", ").concat(f,")"):"none",color:g?"black":"white",textShadow:"-1px -1px 0 ".concat(_,",\n                                              1px -1px 0 ").concat(_,",\n                                              -1px 1px 0 ").concat(_,",\n                                              1px 1px 0 ").concat(_),border:b?"1px solid rgba(".concat(y,", ").concat(h,", ").concat(p,", ").concat(v,")"):"none",filter:(0,Y.wJ)(t.effectList)};return(0,Ft.u)("div",{key:r,class:Et.layerRow},(0,Ft.u)("div",{class:Et.labelElement,styles:w}," ",e.label," "))}if(e.src){var L=this._renderImage(e,i,a);return(0,Ft.u)("div",{key:r,class:Et.layerRow},L,(0,Ft.u)("div",{class:Et.imageLabel},e.label||""))}}},{key:"_renderImage",value:function(e,t,n){var r,i=e.label,a=e.src,l=e.opacity,s=(r={},(0,xt.Z)(r,Et.imageryLayerStretchedImage,n),(0,xt.Z)(r,Et.symbol,!n),r),o={opacity:"".concat(null!=l?l:t.opacity)};return(0,Ft.u)("img",{alt:Qt(this.messages,i,!1),src:a,border:0,width:e.width,height:e.height,class:this.classes(s),styles:o})}},{key:"_renderSizeRampLines",value:function(e){var t=e.infos,n=t[0],r=t[t.length-1],i=n.symbol,a=this._hasIndicators,l=(0,E.F2)(n.size+n.outlineSize)*rn,s=(0,E.F2)(r.size+r.outlineSize)*rn,o=a?l:l+50*rn,u=a?l/2+50*rn:l,c=function(e){if(e){if(e.type.includes("3d")){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var n=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return"triangle"===n||"cone"===n||"tetrahedron"===n}return"triangle"===e.style}}(i),d=function(e){if(e){if(e.type.includes("3d")){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var n=e.symbolLayers.getItemAt(t-1),r=n.resource&&n.resource.primitive;return"circle"===r||"cross"===r||"kite"===r||"sphere"===r||"cube"===r||"diamond"===r}var i=e.style;return"circle"===i||"diamond"===i||"cross"===i}}(i),f=document.createElement("canvas");f.width=o,f.height=u,f.style.width=f.width/rn+"px",f.style.height=f.height/rn+"px";var y=f.getContext("2d");if(a){y.beginPath();var h=o/2-s/2,p=u;y.moveTo(0,0),y.lineTo(h,p);var v=o,m=o/2+s/2,b=u;y.moveTo(v,0),y.lineTo(m,b)}else{y.beginPath();var g=u/2-s/2,_=o;y.moveTo(0,g),y.lineTo(_,0);var w=u/2+s/2,L=o,k=u;y.moveTo(0,w),y.lineTo(L,k)}return y.strokeStyle="#ddd",y.stroke(),(0,Ft.u)("div",{bind:f,afterCreate:Gt,styles:a?{display:"flex",marginTop:"-".concat(c?0:d?l/2:0,"px"),marginBottom:"-".concat(c?s:d?s/2:0,"px")}:{display:"flex",marginRight:"-".concat(c?0:d?l/2:0,"px"),marginLeft:"-".concat(c?0:d?s/2:0,"px")}})}},{key:"_renderSizeRamp",value:function(e,t){var n=e.infos,r=n[0].label,i=n[n.length-1].label,a=n[0].preview,l=n[n.length-1].preview,s=this._hasIndicators,o={"flex-direction":s?"column":"row-reverse"};a&&((a=a.cloneNode(!0)).style.display="flex"),l&&((l=l.cloneNode(!0)).style.display="flex");var u={opacity:null!=t?"".concat(t):""};return(0,Ft.u)("div",{class:this.classes(Et.layerRow,(0,xt.Z)({},Et.sizeRampRow,s))},(0,Ft.u)("div",{class:Et.rampLabel},s?r:i),(0,Ft.u)("div",{class:Et.sizeRampContainer,styles:o},(0,Ft.u)("div",{bind:a,afterCreate:Gt,class:Et.sizeRampPreview,styles:u}),this._renderSizeRampLines(e),(0,Ft.u)("div",{bind:l,afterCreate:Gt,class:Et.sizeRampContainer,styles:u})),(0,Ft.u)("div",{class:Et.rampLabel},s?i:r))}},{key:"_renderLegendForRamp",value:function(e,t,n){var r=e.infos,i="heatmap-ramp"===e.type,a=r.length-1,l=25,s=a>2&&!i?25*a:100,o=s+20,u=10,c=r.slice(0).reverse();c.forEach((function(e,t){e.offset=i?e.ratio:t/a}));var d=c.length-1,f=c.length%2!=0&&c[c.length/2|0],y=f&&(0,Ft.u)("div",{class:Et.intervalSeparatorsContainer},(0,Ft.u)("div",{class:Et.intervalSeparator},"|"),(0,Ft.u)("div",{class:Et.rampLabel},f.label)),h=r[r.length-1].label,p=r[0].label,v=[[{shape:{type:"path",path:"M0 ".concat(l/2," L").concat(u," 0 L").concat(u," ").concat(l," Z")},fill:c[0].color,stroke:{width:0}},{shape:{type:"rect",x:u,y:0,width:s,height:l},fill:{type:"linear",x1:u,y1:0,x2:s+u,y2:0,colors:c},stroke:{width:0}},{shape:{type:"path",path:"M".concat(s+u," 0 L").concat(o," ").concat(l/2," L").concat(s+u," ").concat(l," Z")},fill:c[d].color,stroke:{width:0}}]],m=(0,St.KB)(v,o,l),b=this.messages,g={filter:(0,Y.wJ)(n),opacity:null==t?null:"".concat(t)};return(0,Ft.u)("div",{class:Et.layerRow,styles:{justifyContent:"center"}},(0,Ft.u)("div",{class:Et.rampLabel},i?b[h]:h),(0,Ft.u)("div",{class:Et.symbolContainer},(0,Ft.u)("div",{styles:g},m),y),(0,Ft.u)("div",{class:Et.rampLabel},i?b[p]:p))}}]),n}(p.Z);(0,o._)([(0,f.Cb)()],an.prototype,"activeLayerInfos",void 0),(0,o._)([(0,f.Cb)()],an.prototype,"headingLevel",void 0),(0,o._)([(0,f.Cb)()],an.prototype,"layout",void 0),(0,o._)([(0,f.Cb)(),(0,nn.H)("esri/widgets/Legend/t9n/Legend")],an.prototype,"messages",void 0),(0,o._)([(0,f.Cb)(),(0,nn.H)("esri/t9n/common")],an.prototype,"messagesCommon",void 0),(0,o._)([(0,f.Cb)({readOnly:!0})],an.prototype,"type",void 0),(0,o._)([(0,f.Cb)()],an.prototype,"view",void 0),(0,o._)([(0,tn.h)()],an.prototype,"_selectSection",null);var ln=an=(0,o._)([(0,h.j)("esri.widgets.Legend.styles.Card")],an),sn="esri-legend",on={service:"".concat(sn,"__service"),label:"".concat(sn,"__service-label"),layer:"".concat(sn,"__layer"),groupLayer:"".concat(sn,"__group-layer"),groupLayerChild:"".concat(sn,"__group-layer-child"),layerTable:"".concat(sn,"__layer-table"),layerTableSizeRamp:"".concat(sn,"__layer-table--size-ramp"),layerChildTable:"".concat(sn,"__layer-child-table"),layerCaption:"".concat(sn,"__layer-caption"),layerBody:"".concat(sn,"__layer-body"),layerRow:"".concat(sn,"__layer-row"),layerCell:"".concat(sn,"__layer-cell"),layerInfo:"".concat(sn,"__layer-cell ").concat(sn,"__layer-cell--info"),imageryLayerStretchedImage:"".concat(sn,"__imagery-layer-image--stretched"),imageryLayerCellStretched:"".concat(sn,"__imagery-layer-cell--stretched"),imageryLayerInfoStretched:"".concat(sn,"__imagery-layer-info--stretched"),symbolContainer:"".concat(sn,"__layer-cell esri-legend__layer-cell--symbols"),symbol:"".concat(sn,"__symbol"),rampContainer:"".concat(sn,"__ramps"),sizeRamp:"".concat(sn,"__size-ramp"),colorRamp:"".concat(sn,"__color-ramp"),opacityRamp:"".concat(sn,"__opacity-ramp"),borderlessRamp:"".concat(sn,"__borderless-ramp"),rampTick:"".concat(sn,"__ramp-tick"),rampFirstTick:"".concat(sn,"__ramp-tick-first"),rampLastTick:"".concat(sn,"__ramp-tick-last"),rampLabelsContainer:"".concat(sn,"__ramp-labels"),rampLabel:"".concat(sn,"__ramp-label"),univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"".concat(sn,"__message"),header:"esri-widget__heading",hidden:"esri-hidden"},un="".concat(sn,"__"),cn={display:"flex",alignItems:"flex-start"},dn={marginLeft:"3px"},fn={display:"table-cell",verticalAlign:"middle"},yn=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this,e,r)).activeLayerInfos=null,a.headingLevel=3,a.messages=null,a.type="classic",a}return(0,a.Z)(n,[{key:"render",value:function(){var e=this,t=this.activeLayerInfos,n=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));return(0,Ft.u)("div",null,n&&n.length?n:(0,Ft.u)("div",{class:on.message},this.messages.noLegend))}},{key:"_renderLegendForLayer",value:function(e){var t=this;if(!e.ready)return null;var n=!!e.children.length,r="".concat(un).concat(e.layer.uid,"-version-").concat(e.version),i=e.title?(0,en.X6)({level:this.headingLevel,class:this.classes(on.header,on.label)},e.title):null;if(n){var a=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return(0,Ft.u)("div",{key:r,class:this.classes(on.service,on.groupLayer)},i,a)}var l=e.legendElements;if(l&&!l.length)return null;var s=l.map((function(n){return t._renderLegendForElement(n,e.layer,e.effectList)})).filter((function(e){return!!e}));if(!s.length)return null;var o=(0,xt.Z)({},on.groupLayerChild,!!e.parent);return(0,Ft.u)("div",{key:r,class:this.classes(on.service,o),tabIndex:0},i,(0,Ft.u)("div",{class:on.layer},s))}},{key:"_renderLegendForElement",value:function(e,t,n,r){var i=this,a="color-ramp"===e.type,l="opacity-ramp"===e.type,s="size-ramp"===e.type,o=null;if("symbol-table"===e.type||s){var u=e.infos.map((function(r){return i._renderLegendForElementInfo(r,t,n,s,e.legendType)})).filter((function(e){return!!e}));u.length&&(o=(0,Ft.u)("div",{class:on.layerBody},u))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?o=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?o=(0,Rt.g)(e,this.id,t.opacity,n):"pie-chart-ramp"===e.type?o=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?o=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,n):"univariate-color-size-ramp"===e.type&&(o=this._renderUnivariateColorSizeRamp(e,t.opacity,n));if(!o)return null;var c=e.title,d=null;if("string"==typeof c)d=c;else if(c){var f=Qt(this.messages,c,a||l);d=$t(0,a||l)&&c.title?"".concat(c.title," (").concat(f,")"):f}var y=r?on.layerChildTable:on.layerTable,h=d?(0,Ft.u)("div",{class:on.layerCaption},d):null,p=(0,xt.Z)({},on.layerTableSizeRamp,s||!r);return(0,Ft.u)("div",{class:this.classes(y,p)},h,o)}},{key:"_renderPieChartRamp",value:function(e){return(0,Ft.u)("div",{bind:e.preview,afterCreate:Gt})}},{key:"_renderUnivariateAboveAndBelowRamp",value:function(e,t,n){var r=this,i=Ht(e,t),a=i.sizeRampElement,l=i.colorRampElement;if(!a)return null;var s=jt(a,"above",!0),o=jt(a,"below",!0),u=Wt(l,{width:12,height:s,rampAlignment:"vertical",opacity:t,type:"above",effectList:n}),c=Wt(l,{width:12,height:o,rampAlignment:"vertical",opacity:t,type:"below",effectList:n}),d=Ut(a),f=a.infos.map((function(e){return e.label})),y=f.map((function(e,t){var n=2===t;return 0===t?(0,Ft.u)("div",{key:t,class:e?u?on.univariateAboveAndBelowLabel:on.rampLabel:null},e):n?(0,Ft.u)("div",null):null})),h=f.length-1,p=Math.floor(f.length/2),v=f.map((function(e,t){return t===p||t===h?(0,Ft.u)("div",{key:t,class:e?u?on.univariateAboveAndBelowLabel:on.rampLabel:null},e):null})),m={display:"table-cell",verticalAlign:"middle"},b={marginTop:"".concat(d,"px")},g={height:"".concat(s,"px")},_={height:"".concat(o,"px")};return(0,Ft.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:cn},(0,Ft.u)("div",{class:on.layerBody},a.infos.map((function(e,t){return(0,Ft.u)("div",{class:r.classes(on.layerRow,on.sizeRamp)},(0,Ft.u)("div",{class:on.symbol,styles:m,bind:e.preview,afterCreate:Gt}),u||t%2!=0?null:(0,Ft.u)("div",{class:on.layerInfo},f[t]))}))),u?(0,Ft.u)("div",{styles:b,key:"color-ramp-preview"},(0,Ft.u)("div",{styles:dn},(0,Ft.u)("div",{styles:fn},(0,Ft.u)("div",{class:on.rampContainer,bind:u,afterCreate:Gt})),(0,Ft.u)("div",{styles:fn},(0,Ft.u)("div",{class:on.rampLabelsContainer,styles:g},y))),(0,Ft.u)("div",{styles:dn},(0,Ft.u)("div",{styles:fn},(0,Ft.u)("div",{class:on.rampContainer,bind:c,afterCreate:Gt})),(0,Ft.u)("div",{styles:fn},(0,Ft.u)("div",{class:on.rampLabelsContainer,styles:_},v)))):null)}},{key:"_renderUnivariateColorSizeRamp",value:function(e,t,n){var r=this,i=qt(e),a=i.sizeRampElement,l=i.colorRampElement;if(!a)return null;var s=Ut(a),o=jt(a,"full",!1),u=Wt(l,{width:12,height:o,rampAlignment:"vertical",opacity:t,type:"full",effectList:n}),c=a.infos.length-1,d=a.infos.map((function(e,t){return 0===t||t===c?(0,Ft.u)("div",{key:t,class:e.label?l?on.univariateAboveAndBelowLabel:on.rampLabel:null},e.label):null})),f={display:"table-cell",verticalAlign:"middle"},y={marginTop:"".concat(s,"px")},h={height:"".concat(o,"px")};return(0,Ft.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:cn},(0,Ft.u)("div",{class:on.layerBody},a.infos.map((function(e){return(0,Ft.u)("div",{class:r.classes(on.layerRow,on.sizeRamp)},(0,Ft.u)("div",{class:on.symbol,styles:f,bind:e.preview,afterCreate:Gt}))}))),(0,Ft.u)("div",{styles:y,key:"color-ramp-preview"},(0,Ft.u)("div",{styles:dn},(0,Ft.u)("div",{styles:fn},(0,Ft.u)("div",{class:on.rampContainer,bind:u,afterCreate:Gt})),(0,Ft.u)("div",{styles:fn},(0,Ft.u)("div",{class:on.rampLabelsContainer,styles:h},d)))))}},{key:"_renderLegendForRamp",value:function(e,t){var n=this,r=e.infos,i="opacity-ramp"===e.type,a="heatmap-ramp"===e.type,l="stretch-ramp"===e.type,s=e.preview,o=i?on.opacityRamp:"";s.className="".concat(on.colorRamp," ").concat(o),null!=t&&(s.style.opacity=t.toString());var u=r.map((function(e){return(0,Ft.u)("div",{class:e.label?on.rampLabel:null},a?n.messages[e.label]||e.label:l?n._getStretchStopLabel(e):e.label)})),c={width:"".concat(24,"px")},d={height:s.style.height};return(0,Ft.u)("div",{class:on.layerRow},(0,Ft.u)("div",{class:on.symbolContainer,styles:c},(0,Ft.u)("div",{class:on.rampContainer,bind:s,afterCreate:Gt})),(0,Ft.u)("div",{class:on.layerInfo},(0,Ft.u)("div",{class:on.rampLabelsContainer,styles:d},u)))}},{key:"_getStretchStopLabel",value:function(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:(0,xe.uf)(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}},{key:"_renderLegendForElementInfo",value:function(e,t,n,r,i){var a;if(e.type)return this._renderLegendForElement(e,t,n,!0);var l=null,s=Xt(t,i);if(e.preview?l=(0,Ft.u)("div",{class:on.symbol,bind:e.preview,afterCreate:Gt}):e.src&&(l=this._renderImage(e,t,s)),!l)return null;var o=(0,xt.Z)({},on.imageryLayerInfoStretched,s),u=(a={},(0,xt.Z)(a,on.imageryLayerInfoStretched,s),(0,xt.Z)(a,on.sizeRamp,!s&&r),a);return(0,Ft.u)("div",{class:on.layerRow},(0,Ft.u)("div",{class:this.classes(on.symbolContainer,u)},l),(0,Ft.u)("div",{class:this.classes(on.layerInfo,o)},Qt(this.messages,e.label,!1)||""))}},{key:"_renderImage",value:function(e,t,n){var r,i=e.label,a=e.src,l=e.opacity,s=(r={},(0,xt.Z)(r,on.imageryLayerStretchedImage,n),(0,xt.Z)(r,on.symbol,!n),r),o={opacity:"".concat(null!=l?l:t.opacity)};return(0,Ft.u)("img",{alt:Qt(this.messages,i,!1),src:a,border:0,width:e.width,height:e.height,class:this.classes(s),styles:o})}}]),n}(p.Z);(0,o._)([(0,f.Cb)()],yn.prototype,"activeLayerInfos",void 0),(0,o._)([(0,f.Cb)()],yn.prototype,"headingLevel",void 0),(0,o._)([(0,f.Cb)(),(0,nn.H)("esri/widgets/Legend/t9n/Legend")],yn.prototype,"messages",void 0),(0,o._)([(0,f.Cb)({readOnly:!0})],yn.prototype,"type",void 0);var hn=yn=(0,o._)([(0,h.j)("esri.widgets.Legend.styles.Classic")],yn),pn="esri-legend",vn="esri-widget",mn="esri-widget--panel",bn="esri-icon-layer-list",gn=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this,e,r))._handles=new u.Z,a.headingLevel=3,a.iconClass=bn,a.messages=null,a.style=new hn,a.viewModel=new Ct,a}return(0,a.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles([(0,d.on)((function(){return e.view}),"resize",(function(){return e.scheduleRender()})),(0,d.on)((function(){return e.activeLayerInfos}),"change",(function(){return e._refreshActiveLayerInfos(e.activeLayerInfos)})),(0,d.YP)((function(){return e.headingLevel}),(function(t){var n=e.style;n&&(n.headingLevel=t)})),(0,d.YP)((function(){return e.style}),(function(t,n){n&&t!==n&&n.destroy(),t&&(t.activeLayerInfos=e.activeLayerInfos,"card"===t.type&&(t.view=e.view),t.headingLevel=e.headingLevel)}),d.nn)])}},{key:"destroy",value:function(){this._handles=(0,c.SC)(this._handles)}},{key:"activeLayerInfos",get:function(){return this.viewModel.activeLayerInfos},set:function(e){this.viewModel.activeLayerInfos=e}},{key:"basemapLegendVisible",get:function(){return this.viewModel.basemapLegendVisible},set:function(e){this.viewModel.basemapLegendVisible=e}},{key:"groundLegendVisible",get:function(){return this.viewModel.groundLegendVisible},set:function(e){this.viewModel.groundLegendVisible=e}},{key:"hideLayersNotInCurrentView",get:function(){return this.viewModel.hideLayersNotInCurrentView},set:function(e){this.viewModel.hideLayersNotInCurrentView=e}},{key:"keepCacheOnDestroy",get:function(){return this.viewModel.keepCacheOnDestroy},set:function(e){this.viewModel.keepCacheOnDestroy=e}},{key:"respectLayerVisibility",get:function(){return this.viewModel.respectLayerVisibility},set:function(e){this.viewModel.respectLayerVisibility=e}},{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"layerInfos",get:function(){return this.viewModel.layerInfos},set:function(e){this.viewModel.layerInfos=e}},{key:"castStyle",value:function(e){if(e instanceof ln||e instanceof hn)return e;if("string"==typeof e)return"card"===e?new ln:new hn;if(e&&"string"==typeof e.type){var t=(0,r.Z)({},e);return delete t.type,new("card"===e.type?ln:hn)(t)}return new hn}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"render",value:function(){return(0,Ft.u)("div",{class:this.classes(pn,vn,this.style instanceof hn?mn:null)},this.style.render())}},{key:"_refreshActiveLayerInfos",value:function(e){var t=this;this._handles.removeAll(),e.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)})),this.scheduleRender()}},{key:"_renderOnActiveLayerInfoChange",value:function(e){var t=this,n=(0,d.YP)((function(){return e.version}),(function(){return t.scheduleRender()}));this._handles.add(n,"version_".concat(e.layer.uid));var r=(0,d.on)((function(){return e.children}),"change",(function(){return e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))}),d.nn);this._handles.add(r,"children_".concat(e.layer.uid)),e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))}}]),n}(p.Z);(0,o._)([(0,f.Cb)()],gn.prototype,"activeLayerInfos",null),(0,o._)([(0,f.Cb)()],gn.prototype,"basemapLegendVisible",null),(0,o._)([(0,f.Cb)()],gn.prototype,"groundLegendVisible",null),(0,o._)([(0,f.Cb)()],gn.prototype,"headingLevel",void 0),(0,o._)([(0,f.Cb)()],gn.prototype,"hideLayersNotInCurrentView",null),(0,o._)([(0,f.Cb)()],gn.prototype,"keepCacheOnDestroy",null),(0,o._)([(0,f.Cb)()],gn.prototype,"respectLayerVisibility",null),(0,o._)([(0,f.Cb)()],gn.prototype,"iconClass",void 0),(0,o._)([(0,f.Cb)()],gn.prototype,"label",null),(0,o._)([(0,f.Cb)()],gn.prototype,"layerInfos",null),(0,o._)([(0,f.Cb)(),(0,nn.H)("esri/widgets/Legend/t9n/Legend")],gn.prototype,"messages",void 0),(0,o._)([(0,f.Cb)()],gn.prototype,"style",void 0),(0,o._)([(0,y.p)("style")],gn.prototype,"castStyle",null),(0,o._)([(0,f.Cb)()],gn.prototype,"view",null),(0,o._)([(0,f.Cb)()],gn.prototype,"viewModel",void 0);var _n=gn=(0,o._)([(0,h.j)("esri.widgets.Legend")],gn)}}]);
//# sourceMappingURL=55018.5615d283.chunk.js.map