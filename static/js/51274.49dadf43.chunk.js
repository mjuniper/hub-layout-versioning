/*! For license information please see 51274.49dadf43.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[51274],{51274:function(t,r,e){e.d(r,{f:function(){return C}});var n=e(74165),a=e(15861),u=e(63145),s=e(94062),i=e(25434),c=e(73948),o=e(25831),p=e(18436),f=e(21010),l=e(46825),d=e(4066),v=e(69207),h=/\/(map|feature)server/i,b=function(t){var r=[].concat.apply([],t.filter(Array.isArray));return r.length?r:void 0},y=function(t){var r,e=["groupIds","metadata","ownerUser","org"];return function(t){var r=(0,p.n)(t),e=(0,f.g)(r);return(0,f.i)(["template","solution"],e)||(0,f.i)(["Web Map","Web Scene"],r)}(t)&&e.push("data"),r=t.url,h.test(r)?e.concat("server","layers"):e},g=function(t,r){var e=(0,i.c)(t);return e.params=Object.assign(Object.assign({},e.params),{"fields[datasets]":"slug,boundary,extent,recordCount,searchDescription,statistics"}),r&&(e.params["filter[slug]"]=r),e},m=function(t){var r=(0,c.p)(t.id),e=r.itemId,n=r.layerId,a=n&&parseInt(n,10),u=t.attributes;return{itemId:e,layerId:a,slug:u.slug,boundary:u.boundary,extent:u.extent,recordCount:u.recordCount,searchDescription:u.searchDescription,statistics:u.statistics}},x=function(){var t=(0,a.Z)((0,n.Z)().mark((function t(r,e){var a;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,o.h)("/datasets",g(e,r));case 2:return a=t.sent,t.abrupt("return",m(a.data[0]));case 4:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}(),O=function(){var t=(0,a.Z)((0,n.Z)().mark((function t(r,e){var a;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,o.h)("/datasets/".concat(r),g(e));case 3:return a=t.sent,t.abrupt("return",m(a.data));case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",{errors:(0,s.g)(t.t0)});case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(r,e){return t.apply(this,arguments)}}(),w=function(){var t=(0,a.Z)((0,n.Z)().mark((function t(r,e){var a,u,i,o,f,l,v;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=r.item,u=r.data,i=r.layers,!(o=i&&(0,p.g)(a,i,e&&e.layerId))||o.type){t.next=10;break}return f=(0,d.p)(a.url)+"/"+o.id,l=Object.assign({url:f},e),t.next=8,(0,c.g)(l);case 8:o=t.sent,i=i.map((function(t){return t.id===o.id?o:t}));case 10:if(!o||!(0,p.i)(o)||u){t.next=16;break}return t.next=13,(0,s.f)(a,["data"],e);case 13:t.t0=t.sent,t.next=17;break;case 16:t.t0=void 0;case 17:return v=t.t0,t.abrupt("return",Object.assign(Object.assign(Object.assign({},r),v),{errors:b([r.errors,null===v||void 0===v?void 0:v.errors]),layers:i}));case 19:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}(),Z=function(){var t=(0,a.Z)((0,n.Z)().mark((function t(r,e){var a,u,i;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,v.g)(r,e);case 2:return(a=t.sent).url=(0,p.a)(a,e)||a.url,u=(null===e||void 0===e?void 0:e.enrichments)||y(a),t.next=7,(0,s.f)(a,u,e);case 7:return i=t.sent,t.abrupt("return",w(Object.assign(Object.assign({},i),{item:a}),e));case 9:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}(),j=function(){var t=(0,a.Z)((0,n.Z)().mark((function t(r,e){var a,s,o,l,d,v,h,y;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=(0,c.p)(r),s=a.itemId,t.next=3,Z(s,e);case 3:if(o=t.sent,l=o.item,d=(0,u._)(o,["item"]),v=e&&e.layerId,!(0,f.c)(l,e)){t.next=13;break}return t.next=10,O(r,e);case 10:t.t0=t.sent,t.next=14;break;case 13:t.t0={};case 14:return h=t.t0,y=h.layerId,t.abrupt("return",(0,p.c)(l,Object.assign(Object.assign(Object.assign({requestOptions:e},d),h),{layerId:(0,i.i)(v)?y:v,errors:b([d.errors,h.errors])})));case 17:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}(),k=function(){var t=(0,a.Z)((0,n.Z)().mark((function t(r,e){var a,s,c,o,f,l,d;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x(r,e);case 2:return a=t.sent,s=a.itemId,c=a.layerId,t.next=7,Z(s,e);case 7:if(o=t.sent,f=o.item,l=(0,u._)(o,["item"]),d=e&&e.layerId,(0,i.i)(d)||d===c){t.next=19;break}return c=d,t.t0=Object,t.t1=Object.assign({},a),t.next=17,O("".concat(s,"_").concat(c),e);case 17:t.t2=t.sent,a=t.t0.assign.call(t.t0,t.t1,t.t2);case 19:return t.abrupt("return",(0,p.c)(f,Object.assign(Object.assign(Object.assign({requestOptions:e},l),a),{layerId:c,slug:r,errors:b([l.errors,a.errors])})));case 20:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}(),I=function(){var t=(0,a.Z)((0,n.Z)().mark((function t(r,e){var a,u,s,i;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.url,u=r.viewDefinition,s=null===u||void 0===u?void 0:u.definitionExpression,t.prev=2,t.next=5,(0,l.q)(Object.assign(Object.assign({},e),{url:a,where:s,returnCountOnly:!0}));case 5:return i=t.sent,t.abrupt("return",i.count);case 9:return t.prev=9,t.t0=t.catch(2),t.abrupt("return",1/0);case 12:case"end":return t.stop()}}),t,null,[[2,9]])})));return function(r,e){return t.apply(this,arguments)}}(),C=function(){var t=(0,a.Z)((0,n.Z)().mark((function t(r,e){var a,u,s;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(0,c.i)(r)){t.next=6;break}return t.next=3,k((0,c.a)(r,null===e||void 0===e?void 0:e.siteOrgKey),e);case 3:t.t0=t.sent,t.next=9;break;case 6:return t.next=8,j(r,e);case 8:t.t0=t.sent;case 9:if(a=t.t0,u=a.layer,s=a.type,!(!!u&&["Feature Layer","Table"].includes(s))||!(0,i.i)(a.recordCount)&&!a.viewDefinition){t.next=18;break}return t.next=15,I(a,e);case 15:t.t1=t.sent,t.next=19;break;case 18:t.t1=a.recordCount;case 19:return a.recordCount=t.t1,t.abrupt("return",a);case 21:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}()},46825:function(t,r,e){e.d(r,{g:function(){return i},q:function(){return c}});var n=e(22690),a=e(77843),u=e(30678),s=e(80046);function i(t){var r=(0,u.c)(t.url)+"/"+t.id,e=(0,n.a)({httpMethod:"GET"},t);return(0,a.r)(r,e).then((function(t){return e.rawResponse?t:t.feature}))}function c(t){var r=(0,s.a)(t,["where","objectIds","relationParam","time","distance","units","outFields","geometry","geometryType","spatialRel","returnGeometry","maxAllowableOffset","geometryPrecision","inSR","outSR","gdbVersion","returnDistinctValues","returnIdsOnly","returnCountOnly","returnExtentOnly","orderByFields","groupByFieldsForStatistics","outStatistics","returnZ","returnM","multipatchOption","resultOffset","resultRecordCount","quantizationParameters","returnCentroid","resultType","historicMoment","returnTrueCurves","sqlFormat","returnExceededLimitFeatures","f"],{httpMethod:"GET",params:(0,n.a)({where:"1=1",outFields:"*"},t.params)});return(0,a.r)((0,u.c)(t.url)+"/query",r)}},25831:function(t,r,e){e.d(r,{R:function(){return p},b:function(){return o},h:function(){return f}});var n=e(43144),a=e(15671),u=e(60136),s=e(92572),i=e(28664),c=e(45704);function o(t){var r=t.host,e=t.path,n=t.query,a=r.endsWith("/")?r:"".concat(r,"/"),u=new URL(e,a);return u.search=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Object.keys(t).filter((function(r){return void 0!==t[r]})).reduce((function(r,e){return r[e]=t[e],r}),{});return new URLSearchParams(r).toString()}(n),u.toString()}var p=function(t){(0,u.Z)(e,t);var r=(0,s.Z)(e);function e(t,n,u){var s;return(0,a.Z)(this,e),(s=r.call(this,t)).status=u,s.url=n,s}return(0,n.Z)(e)}((0,i.Z)(Error));function f(t,r){var e,n,a=Object.assign({httpMethod:"GET"},r),u=a.fetch||fetch,s=Object.assign({"Content-Type":"application/json"},a.headers);"GET"===a.httpMethod?e=a.params:n=JSON.stringify(a.params);var i=o({host:(0,c.g)(a),path:"/api/v3/".concat(t).replace(/\/\//g,"/"),query:e});return u(i,{method:a.httpMethod,headers:s,body:n}).then((function(t){if(t.ok)return t.json();throw new p(t.statusText,i,t.status)}))}},73948:function(t,r,e){e.d(r,{a:function(){return p},g:function(){return i},i:function(){return o},p:function(){return c}});var n=e(29439),a=e(77843),u=e(30678),s=e(85822);function i(t){return(0,a.r)((0,u.c)(t.url),t)}function c(t){var r=t?t.split("_"):[],e=(0,n.Z)(r,2);return{itemId:e[0],layerId:e[1]}}function o(t){var r=c(t).itemId;return!(!r||(0,s.i)(r))}function p(t,r){return/.+::.+/.test(t)?t:"".concat(r,"::").concat(t)}},63145:function(t,r,e){function n(t,r){var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&r.indexOf(n)<0&&(e[n]=t[n]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(t);a<n.length;a++)r.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(t,n[a])&&(e[n[a]]=t[n[a]])}return e}e.d(r,{_:function(){return n}})}}]);
//# sourceMappingURL=51274.49dadf43.chunk.js.map