"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[36271,67387],{44619:function(e,t,r){r.d(t,{L:function(){return I},b:function(){return E}});var i,n,a,o,s,l,u,c,h,d,p,f=r(30168),v=r(92026),y=r(88396),m=r(6394),g=r(67077),_=r(33280),b=r(28156),x=r(81879),S=r(43565),C=r(62993),P=r(82999),T=r(95276),O=r(58406),w=r(98634),A=r(64201),k=r(4760);function E(e){var t=new A.kG;t.include(b.H),t.include(x.R,e),t.include(_.f5,e),t.attributes.add(k.T.UV0,"vec2");var r=t.vertex,m=t.fragment;return r.uniforms.add([new T.N("viewport",(function(e,t){return t.camera.fullViewport})),new O.p("lineSize",(function(e,t){return Math.ceil(e.size)*t.camera.pixelRatio})),new P.A("pixelToNDC",(function(e,t){return(0,y.s)(L,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3])})),new O.p("borderSize",(function(e,t){return(0,v.pC)(e.borderColor)?t.camera.pixelRatio:0})),new P.A("screenOffset",(function(e,t){return(0,y.s)(L,e.screenOffset[0]*t.camera.pixelRatio,e.screenOffset[1]*t.camera.pixelRatio)}))]),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&(0,C.m8)(r),r.code.add((0,w.H)(i||(i=(0,f.Z)(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 endPoint = projectPositionHUD(projectAux);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n    ","\n\n    ","\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView = (view * vec4(position, 1.0)).xyz;\n      ","\n\n      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n      vec4 startPoint = proj * vec4(posView, 1.0);\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;\n      startPoint.xy += screenOffsetNorm * startPoint.w;\n      endPoint.xy += screenOffsetNorm * endPoint.w;\n      // Align start and end to pixel origin\n      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);\n    ","\n      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n    ","\n      float halfPixelSize = lineSizeScaled * 0.5;\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt = floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset = -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding = 1.0 + borderSizeScaled;\n      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection = (uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize = 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);\n\n      coverageSampling = vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes = vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position = projectedPosition;\n    }\n  "])),e.occlusionTestEnabled?(0,w.H)(n||(n=(0,f.Z)(["\n      if (!testVisibilityHUD(endPoint)) {\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }"]))):"",e.hasScreenSizePerspective?(0,w.H)(a||(a=(0,f.Z)(["\n      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n        "]))):(0,w.H)(o||(o=(0,f.Z)(["\n      vec2 screenOffsetScaled = screenOffset;\n        "]))),e.hasMultipassGeometry?"depth = posView.z;":"",e.depthHudEnabled?e.depthHudAlignStartEnabled?(0,w.H)(s||(s=(0,f.Z)(["endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);"]))):(0,w.H)(l||(l=(0,f.Z)(["startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);"]))):"",e.hasScreenSizePerspective?(0,w.H)(u||(u=(0,f.Z)(["\n      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n        "]))):(0,w.H)(c||(c=(0,f.Z)(["\n      float lineSizeScaled = lineSize;\n      float borderSizeScaled = borderSize;\n        "]))))),m.uniforms.add([new T.N("uColor",(function(e){return R(e.color)})),new T.N("borderColor",(function(e){return R(e.borderColor)}))]),e.hasMultipassGeometry&&(m.include(S.S,e),m.uniforms.add(new P.A("inverseViewport",(function(e,t){return t.inverseViewport})))),m.code.add((0,w.H)(h||(h=(0,f.Z)(["\n    void main() {\n      ","\n\n      // Mix between line and border coverage offsets depending on whether we need\n      // a border (based on the sidedness).\n      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n      // Mix between border and line color based on the line coverage (conceptually the line\n      // blends on top of the border background).\n      //\n      // Anti-alias by blending final result using the full (including optional border) coverage\n      // and the color alpha\n      float borderAlpha = uColor.a * borderColor.a * coverage.y;\n      float colorAlpha = uColor.a * coverage.x;\n\n      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);\n\n    ","\n  }\n  "])),e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":"",e.depthHudEnabled?(0,w.H)(d||(d=(0,f.Z)(["\n      if (finalAlpha < 0.01) {\n        discard;\n      }\n      "]))):(0,w.H)(p||(p=(0,f.Z)(["\n      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);\n      gl_FragColor = vec4(finalRgb, finalAlpha);\n      "]))))),t}function R(e){return(0,v.pC)(e)?e:g.Z}var L=(0,m.a)(),I=Object.freeze(Object.defineProperty({__proto__:null,build:E},Symbol.toStringTag,{value:"Module"}))},83609:function(e,t,r){r.d(t,{L:function(){return J},b:function(){return Y}});var i,n,a,o,s,l,u,c,h,d,p,f,v,y,m,g,_,b,x,S,C,P,T=r(30168),O=r(2522),w=r(22357),A=r(37081),k=r(33280),E=r(48353),R=r(16574),L=r(40526),I=r(15226),Z=r(26461),D=r(116),M=r(78980),z=r(41012),F=r(82999),U=r(95276),V=r(58406),N=r(98634),G=r(8654),B=r(64201),H=r(19253),W=r(25920),j=r(4760),q=r(33720);function Y(e){var t=new B.kG,r=e.hasMultipassTerrain&&(e.output===A.H.Color||e.output===A.H.Alpha),Y=e.space===q.I9.World;e.hasTip&&Y&&t.extensions.add("GL_OES_standard_derivatives"),t.include(E.U,e),t.include(L.Q,e),e.output===A.H.Depth&&t.include(R.F,e);var J=t.vertex,X=t.fragment;return X.include(M.n),(0,z.Sv)(J,e),t.attributes.add(j.T.POSITION,"vec3"),t.attributes.add(j.T.UV0,"vec2"),t.attributes.add(j.T.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),(0,w.Lm)(t),r&&t.varyings.add("depth","float"),e.hasTip&&t.varyings.add("vLineWidth","float"),J.uniforms.add([new F.A("nearFar",(function(e,t){return t.camera.nearFar})),new U.N("viewport",(function(e,t){return t.camera.fullViewport}))]),J.code.add((0,N.H)(i||(i=(0,T.Z)(["vec4 projectAndScale(vec4 pos) {\nvec4 posNdc = proj * pos;\nposNdc.xy *= viewport.zw / posNdc.w;\nreturn posNdc;\n}"])))),J.code.add((0,N.H)(n||(n=(0,T.Z)(["void clip(vec4 pos, inout vec4 prev) {\nfloat vnp = nearFar[0] * 0.99;\nif (prev.z > -nearFar[0]) {\nfloat interpolation = (-vnp - pos.z) / (prev.z - pos.z);\nprev = mix(pos, prev, interpolation);\n}\n}"])))),Y?(t.attributes.add(j.T.NORMAL,"vec3"),(0,z._8)(J),J.constants.add("tiltThreshold","float",.7),J.code.add((0,N.H)(a||(a=(0,T.Z)(["vec3 perpendicular(vec3 v) {\nvec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;\nvec3 n2 = cross(v, n);\nvec3 forward = vec3(0.0, 0.0, 1.0);\nfloat tiltDot = dot(forward, n);\nreturn abs(tiltDot) < tiltThreshold ? n : n2;\n}"]))))):J.code.add((0,N.H)(o||(o=(0,T.Z)(["vec2 perpendicular(vec2 v) {\nreturn vec2(v.y, -v.x);\n}"])))),J.code.add((0,N.H)(s||(s=(0,T.Z)(["\n      #define vecN ","\n\n      vecN normalizedSegment(vecN pos, vecN prev) {\n        vecN segment = pos - prev;\n        float segmentLen = length(segment);\n\n        // normalize or zero if too short\n        return (segmentLen > 0.001) ? segment / segmentLen : ",";\n      }\n\n      vecN displace(vecN pos, vecN prev, float displacementLen) {\n        vecN segment = normalizedSegment(pos, prev);\n\n        vecN displacementDirU = perpendicular(segment);\n        vecN displacementDirV = segment;\n\n        ","\n\n        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);\n      }\n    "])),Y?"vec3":"vec2",Y?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)",e.anchor===q.i5.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":"")),e.space===q.I9.Screen&&(J.uniforms.add(new G.g("inverseProjectionMatrix",(function(e,t){return t.camera.inverseProjectionMatrix}))),J.code.add((0,N.H)(l||(l=(0,T.Z)(["vec3 inverseProject(vec4 posScreen) {\nposScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;\nreturn (inverseProjectionMatrix * posScreen).xyz;\n}"])))),J.code.add((0,N.H)(u||(u=(0,T.Z)(["bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {\nfloat cos = dot(rayDir, planeNormal);\nfloat t = dot(planeOrigin, planeNormal) / cos;\nintersection = t * rayDir;\nreturn abs(cos) > 0.001 && t > 0.0;\n}"])))),J.uniforms.add(new V.p("perScreenPixelRatio",(function(e,t){return t.camera.perScreenPixelRatio}))),J.code.add((0,N.H)(c||(c=(0,T.Z)(["\n      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {\n        // Project displaced position back to camera space\n        vec3 displacedPos = inverseProject(displacedPosScreen);\n\n        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally\n        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).\n        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));\n        vec3 planeOrigin = posLeft;\n\n        ",";\n\n        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the\n        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.\n        float offset = lineWidth * perScreenPixelRatio;\n        planeOrigin *= (1.0 - offset);\n\n        // Intersect camera ray with the plane and make sure it is within clip space\n        vec3 rayDir = normalize(displacedPos);\n        vec3 intersection;\n        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {\n          return vec4(intersection.xyz, 1.0);\n        }\n\n        // Fallback: use depth of pos or prev, whichever is closer to the camera\n        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);\n        displacedPos *= minDepth / length(displacedPos);\n        return vec4(displacedPos.xyz, 1.0);\n      }\n  "])),e.hasCap?"\n                if(prev.z > posLeft.z) {\n                  vec2 diff = posLeft.xy - posRight.xy;\n                  planeOrigin.xy += perpendicular(diff) / 2.0;\n                }\n              ":""))),J.uniforms.add(new V.p("pixelRatio",(function(e,t){return t.camera.pixelRatio}))),(0,w.bA)(t),J.code.add((0,N.H)(h||(h=(0,T.Z)(["void main(void) {\nif (uv0.y == 0.0) {\ngl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n}\nelse {\nfloat lineWidth = getLineWidth();\nfloat screenMarkerSize = getScreenMarkerSize();\nvec4 pos  = view * vec4(position.xyz, 1.0);\nvec4 prev = view * vec4(auxpos1.xyz, 1.0);\nclip(pos, prev);"])))),Y?(e.hideOnShortSegments&&J.code.add((0,N.H)(d||(d=(0,T.Z)(["if (areWorldMarkersHidden(pos, prev)) {\ngl_Position = vec4(1e038, 1e038, 1e038, 1.0);\nreturn;\n}"])))),J.code.add((0,N.H)(p||(p=(0,T.Z)(["pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));\nvec4 displacedPosScreen = projectAndScale(pos);"]))))):(J.code.add((0,N.H)(f||(f=(0,T.Z)(["vec4 posScreen = projectAndScale(pos);\nvec4 prevScreen = projectAndScale(prev);\nvec4 displacedPosScreen = posScreen;\ndisplacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);"])))),e.space===q.I9.Screen&&J.code.add((0,N.H)(v||(v=(0,T.Z)(["vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));\nvec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));\nvec3 lineLeft = pos.xyz + (pos.xyz - lineRight);\npos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);\ndisplacedPosScreen = projectAndScale(pos);"]))))),J.code.add((0,N.H)(y||(y=(0,T.Z)(["\n        ","\n        linearDepth = calculateLinearDepth(nearFar,pos.z);\n\n        // Convert back into NDC\n        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;\n\n        // Convert texture coordinate into [0,1]\n        vUV = (uv0 + 1.0) / 2.0;\n\n        ","\n\n        ","\n\n        vSize = screenMarkerSize;\n        vColor = getColor();\n\n        // Use camera space for slicing\n        vpos = pos.xyz;\n\n        gl_Position = displacedPosScreen;\n      }\n    }\n  "])),r?"depth = pos.z;":"",Y?"":"vUV *= displacedPosScreen.w;",e.hasTip?"vLineWidth = lineWidth;":"")),r&&t.include(I.l,e),t.include(k.f5,e),X.uniforms.add([new U.N("intrinsicColor",(function(e){return e.color})),new H.A("tex",(function(e){return e.texture}))]),X.include(D.Y),t.constants.add("texelSize","float",1/O.vT),X.code.add((0,N.H)(m||(m=(0,T.Z)(["float markerAlpha(vec2 samplePos) {\nsamplePos += vec2(0.5, -0.5) * texelSize;\nfloat sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;\nfloat distance = sdf * vSize;\ndistance -= 0.5;\nreturn clamp(0.5 - distance, 0.0, 1.0);\n}"])))),e.hasTip&&(t.constants.add("relativeMarkerSize","float",O.Ch/O.vT),t.constants.add("relativeTipLineWidth","float",O.Hl),X.code.add((0,N.H)(g||(g=(0,T.Z)(["\n    float tipAlpha(vec2 samplePos) {\n      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker\n      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);\n      samplePos *= vSize;\n\n      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;\n      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);\n\n      ","\n\n      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);\n      return clamp(0.5 - distance, 0.0, 1.0);\n    }\n  "])),Y?"halfTipLineWidth *= fwidth(samplePos.y);":""))),t.constants.add("symbolAlphaCutoff","float",Z.b),X.code.add((0,N.H)(_||(_=(0,T.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n\n    vec4 finalColor = intrinsicColor * vColor;\n\n    ","\n\n    ","\n\n    ","\n\n    if (finalColor.a < symbolAlphaCutoff) {\n      discard;\n    }\n\n    ","\n    ","\n    ","\n    ","\n    ","\n  }\n  "])),r?"terrainDepthTest(gl_FragCoord, depth);":"",Y?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;",e.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);",e.output===A.H.ObjectAndLayerIdColor?(0,N.H)(b||(b=(0,T.Z)(["finalColor.a = 1.0;"]))):"",e.output===A.H.Alpha?(0,N.H)(x||(x=(0,T.Z)(["gl_FragColor = vec4(finalColor.a);"]))):"",e.output===A.H.Color?(0,N.H)(S||(S=(0,T.Z)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",e.output===A.H.Color&&e.transparencyPassType===W.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":"",e.output===A.H.Highlight?(0,N.H)(C||(C=(0,T.Z)(["gl_FragColor = vec4(1.0);"]))):"",e.output===A.H.Depth?(0,N.H)(P||(P=(0,T.Z)(["outputDepth(linearDepth);"]))):"")),t}var J=Object.freeze(Object.defineProperty({__proto__:null,build:Y},Symbol.toStringTag,{value:"Module"}))},21841:function(e,t,r){r.d(t,{P:function(){return D},b:function(){return Z}});var i,n,a,o,s,l,u,c,h,d=r(30168),p=r(22357),f=r(37081),v=r(33280),y=r(94951),m=r(75027),g=r(16574),_=r(137),b=r(30694),x=r(34975),S=r(92395),C=r(15226),P=r(96658),T=r(8555),O=r(58335),w=r(116),A=r(41012),k=r(49450),E=r(58406),R=r(98634),L=r(64201),I=r(25920);function Z(e){var t=new L.kG,r=t.vertex,Z=t.fragment;switch((0,A.Sv)(r,e),t.varyings.add("vpos","vec3"),t.include(m.W,e),e.output!==f.H.Color&&e.output!==f.H.Alpha||(t.include(y.w,e),t.include(O.XE,e),t.include(p.qj,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add((0,R.H)(i||(i=(0,d.Z)(["\n      void main() {\n        vpos = calculateVPos();\n        vnormal = normalize(localNormal());\n\n        ","\n        gl_Position = transformPosition(proj, view, vpos);\n\n        ","\n\n        vcolor = getColor();\n      }\n    "])),e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":"",e.output===f.H.Color?"forwardLinearDepth();":""))),t.include(C.l,e),e.output){case f.H.Alpha:t.include(v.f5,e),Z.uniforms.add(new E.p("opacity",(function(e){return e.opacity}))),Z.code.add((0,R.H)(n||(n=(0,d.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        float combinedOpacity = vcolor.a * opacity;\n        gl_FragColor = vec4(combinedOpacity);\n      }\n    "])),e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""));break;case f.H.Color:t.include(v.f5,e),t.include(x.XP,e),t.include(b.K,e),t.include(O.XE,e),t.include(P.k,e),(0,A.hY)(Z,e),(0,x.PN)(Z),(0,x.sC)(Z),Z.uniforms.add([r.uniforms.get("localOrigin"),new k.J("ambient",(function(e){return e.ambient})),new k.J("diffuse",(function(e){return e.diffuse})),new k.J("specular",(function(e){return e.specular})),new E.p("opacity",(function(e){return e.opacity}))]),Z.include(w.Y),(0,S.F1)(Z),Z.code.add((0,R.H)(a||(a=(0,d.Z)(["\n        void main() {\n          discardBySlice(vpos);\n          ","\n\n          shadingParams.viewDirection = normalize(vpos - cameraPosition);\n          shadingParams.normalView = vnormal;\n          vec3 normal = shadingNormal(shadingParams);\n          float ssao = evaluateAmbientOcclusionInverse();\n\n          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n          ","\n          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one\n          float combinedOpacity = vcolor.a * opacity;\n          albedo += 0.25 * specular; // don't completely ignore specular for now\n\n          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);\n          gl_FragColor = vec4(shadedColor, combinedOpacity);\n          gl_FragColor = highlightSlice(gl_FragColor, vpos);\n          ","\n        }\n      "])),e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.transparencyPassType===I.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""));break;case f.H.Depth:case f.H.Shadow:case f.H.ShadowHighlight:case f.H.ShadowExcludeHighlight:t.include(y.w,e),(0,p.Zu)(t),t.varyings.add("depth","float"),r.code.add((0,R.H)(o||(o=(0,d.Z)(["void main() {\nvpos = calculateVPos();\ngl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n}"])))),t.include(v.f5,e),t.include(g.F,e),Z.code.add((0,R.H)(s||(s=(0,d.Z)(["void main() {\ndiscardBySlice(vpos);\noutputDepth(depth);\n}"]))));break;case f.H.Normal:t.include(y.w,e),t.include(T.n,e),(0,A._8)(r),t.varyings.add("vnormal","vec3"),r.code.add((0,R.H)(l||(l=(0,d.Z)(["void main(void) {\nvpos = calculateVPos();\nvnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);\ngl_Position = transformPosition(proj, view, vpos);\n}"])))),t.include(v.f5,e),Z.code.add((0,R.H)(u||(u=(0,d.Z)(["void main() {\ndiscardBySlice(vpos);\nvec3 normal = normalize(vnormal);\nif (gl_FrontFacing == false) normal = -normal;\ngl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n}"]))));break;case f.H.Highlight:t.include(y.w,e),t.include(T.n,e),t.varyings.add("vnormal","vec3"),r.code.add((0,R.H)(c||(c=(0,d.Z)(["void main(void) {\nvpos = calculateVPos();\ngl_Position = transformPosition(proj, view, vpos);\n}"])))),t.include(v.f5,e),t.include(_.bA,e),Z.code.add((0,R.H)(h||(h=(0,d.Z)(["void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}"]))))}return t}var D=Object.freeze(Object.defineProperty({__proto__:null,build:Z},Symbol.toStringTag,{value:"Module"}))},59771:function(e,t,r){r.d(t,{P:function(){return j},b:function(){return W}});var i,n,a,o,s,l,u,c,h,d,p,f,v,y,m,g,_,b,x,S,C,P=r(30168),T=r(22357),O=r(37081),w=r(33280),A=r(94951),k=r(48655),E=r(16574),R=r(137),L=r(15226),I=r(26461),Z=r(116),D=r(41012),M=r(95276),z=r(58406),F=r(98634),U=r(64201),V=r(25920),N=r(4760),G=r(17729),B=.70710678118,H=B;function W(e){var t=new U.kG,r=e.hasMultipassTerrain&&(e.output===O.H.Color||e.output===O.H.Alpha);e.draped||t.extensions.add("GL_OES_standard_derivatives");var W=t.vertex,j=t.fragment;(0,D.Sv)(W,e),t.include(A.w,e),t.include(k.c,e),e.draped?W.uniforms.add(new z.p("worldToScreenRatio",(function(e,t){return 1/t.screenToPCSRatio}))):t.attributes.add(N.T.BOUNDINGRECT,"mat3"),t.attributes.add(N.T.POSITION,"vec3"),t.attributes.add(N.T.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),r&&t.varyings.add("depth","float");var q=e.style===G.b.ForwardDiagonal||e.style===G.b.BackwardDiagonal||e.style===G.b.DiagonalCross;q&&W.code.add((0,F.H)(i||(i=(0,P.Z)(["\n      const mat2 rotate45 = mat2(",", ",",\n                                 ",", ",");\n    "])),F.H.float(B),F.H.float(-H),F.H.float(H),F.H.float(B))),e.draped||((0,D.hY)(W,e),W.uniforms.add(new z.p("worldToScreenPerDistanceRatio",(function(e,t){return 1/t.camera.perScreenPixelRatio}))),W.code.add((0,F.H)(n||(n=(0,P.Z)(["vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {\nfloat projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);\nreturn center + halfVector * clamp(projectedLength, -1.0, 1.0);\n}"])))),W.code.add((0,F.H)(a||(a=(0,P.Z)(["vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {\nfloat d = dot(planeNormal, planePoint);\nfloat t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);\nreturn rayOrigin + t * rayDir;\n}"])))),W.code.add((0,F.H)(o||(o=(0,P.Z)(["\n      float boundingRectDistanceToCamera() {\n        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);\n        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);\n        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);\n        vec3 n = normalize(cross(halfU, halfV));\n\n        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);\n\n        float viewAngle = dot(viewDir, n);\n        float minViewAngle = ",";\n\n        if (abs(viewAngle) < minViewAngle) {\n          // view direction is (almost) parallel to plane -> clamp it to min angle\n          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;\n          viewDir = normalize(viewDir + normalComponent * n);\n        }\n\n        // intersect view direction with infinite plane that contains bounding rect\n        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);\n\n        // clip to bounds by projecting to u and v line segments individually\n        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);\n        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);\n\n        // use to calculate the closest point to camera on bounding rect\n        vec3 closestPoint = uProjected + vProjected - center;\n\n        return length(closestPoint - cameraPosition);\n      }\n    "])),F.H.float(.08715574274)))),W.code.add((0,F.H)(s||(s=(0,P.Z)(["\n    vec2 scaledUV() {\n      vec2 uv = uvMapSpace.xy ",";\n      vec2 uvCellOrigin = uvMapSpace.zw ",";\n\n      ","\n\n      // Logarithmically discretize ratio to avoid jittering\n      float step = 0.1;\n      float discreteWorldToScreenRatio = log(worldToScreenRatio);\n      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;\n      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);\n\n      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ",");\n      return uvOffset + (uv * discreteWorldToScreenRatio);\n    }\n  "])),q?" * rotate45":"",q?" * rotate45":"",e.draped?"":(0,F.H)(l||(l=(0,P.Z)(["\n            float distanceToCamera = boundingRectDistanceToCamera();\n            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;\n          "]))),F.H.float(e.patternSpacing)));var Y=e.output===O.H.Depth;return Y&&(t.include(E.F,e),(0,T.Zu)(t),(0,T.Lm)(t)),W.code.add((0,F.H)(u||(u=(0,P.Z)(["\n    void main(void) {\n      vuv = scaledUV();\n      vpos = position;\n      ","\n      forwardNormalizedVertexColor();\n      gl_Position = ","\n    }\n  "])),r?"depth = (view * vec4(vpos, 1.0)).z;":"",Y?(0,F.H)(c||(c=(0,P.Z)(["transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);"]))):(0,F.H)(h||(h=(0,P.Z)(["transformPosition(proj, view, vpos);"]))))),t.include(w.f5,e),j.include(Z.Y),e.draped&&j.uniforms.add(new z.p("texelSize",(function(e,t){return 1/t.camera.pixelRatio}))),e.output===O.H.Highlight&&t.include(R.bA,e),r&&t.include(L.l,e),e.output!==O.H.Highlight&&(j.code.add((0,F.H)(d||(d=(0,P.Z)(["\n      const float lineWidth = ",";\n      const float spacing = ",";\n      const float spacingINV = ",";\n\n      float coverage(float p, float txlSize) {\n        p = mod(p, spacing);\n\n        float halfTxlSize = txlSize / 2.0;\n\n        float start = p - halfTxlSize;\n        float end = p + halfTxlSize;\n\n        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;\n        coverage -= min(lineWidth, mod(start, spacing));\n        coverage -= max(lineWidth - mod(end, spacing), 0.0);\n\n        return coverage / txlSize;\n      }\n    "])),F.H.float(e.lineWidth),F.H.float(e.patternSpacing),F.H.float(1/e.patternSpacing))),e.draped||j.code.add((0,F.H)(p||(p=(0,P.Z)(["const int maxSamples = 5;\nfloat sample(float p) {\nvec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));\nfloat fwidth = dxdy.x + dxdy.y;\nivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));\nvec2 invSamples = 1.0 / vec2(samples);\nfloat accumulator = 0.0;\nfor (int j = 0; j < maxSamples; j++) {\nif(j >= samples.y) {\nbreak;\n}\nfor (int i = 0; i < maxSamples; i++) {\nif(i >= samples.x) {\nbreak;\n}\nvec2 step = vec2(i,j) * invSamples - 0.5;\naccumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);\n}\n}\naccumulator /= float(samples.x * samples.y);\nreturn accumulator;\n}"]))))),j.uniforms.add(new M.N("uColor",(function(e){return e.color}))),j.code.add((0,F.H)(f||(f=(0,P.Z)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      vec4 color = ","\n      color = highlightSlice(color, vpos);\n\n      ","\n\n      ","\n\n      if (color.a < ",") {\n        discard;\n      }\n\n      ","\n\n      ","\n      ","\n      ",";\n    }\n  "])),r?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasVertexColors?"vColor * uColor;":"uColor;",e.output!==O.H.Highlight?(0,F.H)(v||(v=(0,P.Z)(["color.a *= ",";"])),function(e){function t(t){return e.draped?(0,F.H)(x||(x=(0,P.Z)(["coverage(vuv.",", texelSize)"])),t):(0,F.H)(S||(S=(0,P.Z)(["sample(vuv.",")"])),t)}switch(e.style){case G.b.ForwardDiagonal:case G.b.Horizontal:return t("y");case G.b.BackwardDiagonal:case G.b.Vertical:return t("x");case G.b.DiagonalCross:case G.b.Cross:return(0,F.H)(C||(C=(0,P.Z)(["\n        1.0 - (1.0 - ",") * (1.0 - ",")\n      "])),t("x"),t("y"));default:return"0.0"}}(e)):"",e.output===O.H.ObjectAndLayerIdColor?(0,F.H)(y||(y=(0,P.Z)(["color.a = 1.0;"]))):"",F.H.float(I.b),e.output===O.H.Alpha?(0,F.H)(m||(m=(0,P.Z)(["gl_FragColor = vec4(color.a);"]))):"",e.output===O.H.Color?(0,F.H)(g||(g=(0,P.Z)(["gl_FragColor = color; ",""])),e.transparencyPassType===V.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"",e.output===O.H.Highlight?(0,F.H)(_||(_=(0,P.Z)(["outputHighlight();"]))):"",e.output===O.H.Depth?(0,F.H)(b||(b=(0,P.Z)(["outputDepth(linearDepth);"]))):"")),t}var j=Object.freeze(Object.defineProperty({__proto__:null,build:W},Symbol.toStringTag,{value:"Module"}))},51e3:function(e,t,r){r.d(t,{J:function(){return o},r:function(){return a}});var i=null,n=!0;function a(e,t,r){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(n)try{return new ImageData(e,t)}catch(s){n=!1}return l(e,t,r)}function o(e,t,r,i){if(!t||!r)throw new Error("Cannot construct image data without dimensions");if(n)try{return new ImageData(e,t,r)}catch(o){n=!1}var a=l(t,r,i);return a.data.set(e,0),a}function s(){return i||((i=document.createElement("canvas")).width=1,i.height=1),i}function l(e,t,r){return r||(r=s()),r.getContext("2d").createImageData(e,t)}},29691:function(e,t,r){r.d(t,{GG:function(){return o},rS:function(){return c},wY:function(){return u}});var i=r(83448),n=r(78952),a=r(92975),o=new n.Z(i.kU),s=new n.Z(i.JL),l=new n.Z(i.mM),u=new n.Z(i.pn);function c(e){return e&&((0,a.BZ)(e)||(0,a.fS)(e,s))?s:e&&((0,a.V2)(e)||(0,a.fS)(e,l))?l:o}},64995:function(e,t,r){r.d(t,{Z:function(){return S}});var i,n=r(15671),a=r(43144),o=r(60136),s=r(92572),l=r(27366),u=r(46784),c=r(84652),h=r(32718),d=r(49861),p=r(89125),f=r(69912),v=r(25243),y=r(10891),m=r(11587),g=r(27474),_="esri.geometry.support.MeshComponent",b=h.Z.getLogger(_),x=i=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).faces=null,i.material=null,i.shading="source",i.trustSourceNormals=!1,i}return(0,a.Z)(r,[{key:"castFaces",value:function(e){return(0,g.X)(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},b)}},{key:"castMaterial",value:function(e){return(0,v.TJ)(e&&"object"==typeof e&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?m.Z:y.Z,e)}},{key:"clone",value:function(){return new i({faces:(0,c.d9)(this.faces),shading:this.shading,material:(0,c.d9)(this.material),trustSourceNormals:this.trustSourceNormals})}},{key:"cloneWithDeduplication",value:function(e,t){var r={faces:(0,c.d9)(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new i(r)}}],[{key:"from",value:function(e){return(0,v.TJ)(i,e)}}]),r}(u.wq);(0,l._)([(0,d.Cb)({json:{write:!0}})],x.prototype,"faces",void 0),(0,l._)([(0,p.p)("faces")],x.prototype,"castFaces",null),(0,l._)([(0,d.Cb)({type:y.Z,json:{write:!0}})],x.prototype,"material",void 0),(0,l._)([(0,p.p)("material")],x.prototype,"castMaterial",null),(0,l._)([(0,d.Cb)({type:String,json:{write:!0}})],x.prototype,"shading",void 0),(0,l._)([(0,d.Cb)({type:Boolean})],x.prototype,"trustSourceNormals",void 0);var S=x=i=(0,l._)([(0,f.j)(_)],x)},10891:function(e,t,r){r.d(t,{Z:function(){return y}});var i,n=r(15671),a=r(43144),o=r(60136),s=r(92572),l=r(27366),u=r(51995),c=r(46784),h=r(92026),d=r(49861),p=(r(25243),r(63780),r(69912)),f=r(79694),v=i=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).color=null,i.colorTexture=null,i.normalTexture=null,i.alphaMode="auto",i.alphaCutoff=.5,i.doubleSided=!0,i}return(0,a.Z)(r,[{key:"clone",value:function(){return this.cloneWithDeduplication(null,new Map)}},{key:"cloneWithDeduplication",value:function(e,t){var r=(0,h.pC)(e)?e.get(this):null;if(r)return r;var n=new i(this.clonePropertiesWithDeduplication(t));return(0,h.pC)(e)&&e.set(this,n),n}},{key:"clonePropertiesWithDeduplication",value:function(e){return{color:(0,h.pC)(this.color)?this.color.clone():null,colorTexture:(0,h.pC)(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:(0,h.pC)(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(0,h.pC)(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:(0,h.pC)(this.normalTextureTransform)?this.normalTextureTransform:null}}}]),r}(c.wq);(0,l._)([(0,d.Cb)({type:u.Z,json:{write:!0}})],v.prototype,"color",void 0),(0,l._)([(0,d.Cb)({type:f.Z,json:{write:!0}})],v.prototype,"colorTexture",void 0),(0,l._)([(0,d.Cb)({type:f.Z,json:{write:!0}})],v.prototype,"normalTexture",void 0),(0,l._)([(0,d.Cb)({nonNullable:!0,json:{write:!0}})],v.prototype,"alphaMode",void 0),(0,l._)([(0,d.Cb)({nonNullable:!0,json:{write:!0}})],v.prototype,"alphaCutoff",void 0),(0,l._)([(0,d.Cb)({nonNullable:!0,json:{write:!0}})],v.prototype,"doubleSided",void 0),(0,l._)([(0,d.Cb)()],v.prototype,"colorTextureTransform",void 0),(0,l._)([(0,d.Cb)()],v.prototype,"normalTextureTransform",void 0);var y=v=i=(0,l._)([(0,p.j)("esri.geometry.support.MeshMaterial")],v)},11587:function(e,t,r){r.d(t,{Z:function(){return _}});var i,n=r(1413),a=r(15671),o=r(43144),s=r(11752),l=r(61120),u=r(60136),c=r(92572),h=r(27366),d=r(51995),p=r(92026),f=r(49861),v=(r(25243),r(63780),r(69912)),y=r(10891),m=r(79694),g=i=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(e){var i;return(0,a.Z)(this,r),(i=t.call(this,e)).emissiveColor=null,i.emissiveTexture=null,i.occlusionTexture=null,i.metallic=1,i.roughness=1,i.metallicRoughnessTexture=null,i}return(0,o.Z)(r,[{key:"clone",value:function(){return this.cloneWithDeduplication(null,new Map)}},{key:"cloneWithDeduplication",value:function(e,t){var r=(0,p.pC)(e)?e.get(this):null;if(r)return r;var n=new i(this.clonePropertiesWithDeduplication(t));return(0,p.pC)(e)&&e.set(this,n),n}},{key:"clonePropertiesWithDeduplication",value:function(e){return(0,n.Z)((0,n.Z)({},(0,s.Z)((0,l.Z)(r.prototype),"clonePropertiesWithDeduplication",this).call(this,e)),{},{emissiveColor:(0,p.pC)(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:(0,p.pC)(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:(0,p.pC)(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(0,p.pC)(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null,occlusionTextureTransform:(0,p.pC)(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:(0,p.pC)(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:(0,p.pC)(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null})}}]),r}(y.Z);(0,h._)([(0,f.Cb)({type:d.Z,json:{write:!0}})],g.prototype,"emissiveColor",void 0),(0,h._)([(0,f.Cb)({type:m.Z,json:{write:!0}})],g.prototype,"emissiveTexture",void 0),(0,h._)([(0,f.Cb)({type:m.Z,json:{write:!0}})],g.prototype,"occlusionTexture",void 0),(0,h._)([(0,f.Cb)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],g.prototype,"metallic",void 0),(0,h._)([(0,f.Cb)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],g.prototype,"roughness",void 0),(0,h._)([(0,f.Cb)({type:m.Z,json:{write:!0}})],g.prototype,"metallicRoughnessTexture",void 0),(0,h._)([(0,f.Cb)()],g.prototype,"occlusionTextureTransform",void 0),(0,h._)([(0,f.Cb)()],g.prototype,"emissiveTextureTransform",void 0),(0,h._)([(0,f.Cb)()],g.prototype,"metallicRoughnessTextureTransform",void 0);var _=g=i=(0,h._)([(0,v.j)("esri.geometry.support.MeshMaterialMetallicRoughness")],g)},79694:function(e,t,r){r.d(t,{Z:function(){return b}});var i,n=r(15671),a=r(43144),o=r(60136),s=r(92572),l=r(27366),u=(r(93169),r(51e3)),c=r(46784),h=r(49861),d=r(25243),p=(r(63780),r(38511)),f=r(69912),v=r(31201),y=r(53283),m=new WeakMap,g=0,_=i=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).wrap="repeat",i}return(0,a.Z)(r,[{key:"url",get:function(){return this._get("url")||null},set:function(e){this._set("url",e),e&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(e){this._set("data",e),e&&this._set("url",null)}},{key:"writeData",value:function(e,t,r,i){if(e instanceof HTMLImageElement){var n={type:"image-element",src:(0,y.t)(e.src,i),crossOrigin:e.crossOrigin};t[r]=n}else if(e instanceof HTMLCanvasElement){var a=e.getContext("2d").getImageData(0,0,e.width,e.height),o={type:"canvas-element",imageData:this._encodeImageData(a)};t[r]=o}else if(e instanceof HTMLVideoElement){var s={type:"video-element",src:(0,y.t)(e.src,i),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=s}else if(e instanceof ImageData){var l={type:"image-data",imageData:this._encodeImageData(e)};t[r]=l}}},{key:"readData",value:function(e){switch(e.type){case"image-element":var t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t;case"canvas-element":var r=this._decodeImageData(e.imageData),i=document.createElement("canvas");return i.width=r.width,i.height=r.height,i.getContext("2d").putImageData(r,0,0),i;case"image-data":return this._decodeImageData(e.imageData);case"video-element":var n=document.createElement("video");return n.src=e.src,n.crossOrigin=e.crossOrigin,n.autoplay=e.autoplay,n.loop=e.loop,n.muted=e.muted,n.preload=e.preload,n;default:return}}},{key:"transparent",get:function(){var e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){var r=t.substr(t.length-4,4).toLowerCase(),i=t.substr(0,15).toLocaleLowerCase();if(".png"===r||"data:image/png;"===i)return!0}return!1},set:function(e){this._overrideIfSome("transparent",e)}},{key:"contentHash",get:function(){var e=this,t="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?"".concat(this.wrap.horizontal,"/").concat(this.wrap.vertical):"",r=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"d:".concat(r,",t:").concat(e.transparent,",w:").concat(t)};return null!=this.url?r(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?r(this.data.src):(m.has(this.data)||m.set(this.data,++g),r(m.get(this.data))):r()}},{key:"clone",value:function(){var e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new i(e)}},{key:"cloneWithDeduplication",value:function(e){var t=e.get(this);if(t)return t;var r=this.clone();return e.set(this,r),r}},{key:"_cloneWrap",value:function(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}},{key:"_encodeImageData",value:function(e){for(var t="",r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}},{key:"_decodeImageData",value:function(e){for(var t=atob(e.data),r=new Uint8ClampedArray(t.length),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return(0,u.J)(r,e.width,e.height)}},{key:"_imageDataContainsTransparent",value:function(e){for(var t=3;t<e.data.length;t+=4)if(255!==e.data[t])return!0;return!1}}],[{key:"from",value:function(e){return"string"==typeof e?new i({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new i({data:e}):(0,d.TJ)(i,e)}}]),r}(c.wq);(0,l._)([(0,h.Cb)({type:String,json:{write:y.w}})],_.prototype,"url",null),(0,l._)([(0,h.Cb)({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),(0,h.Cb)()],_.prototype,"data",null),(0,l._)([(0,v.c)("data")],_.prototype,"writeData",null),(0,l._)([(0,p.r)("data")],_.prototype,"readData",null),(0,l._)([(0,h.Cb)({type:Boolean,json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],_.prototype,"transparent",null),(0,l._)([(0,h.Cb)({json:{write:!0}})],_.prototype,"wrap",void 0),(0,l._)([(0,h.Cb)({readOnly:!0})],_.prototype,"contentHash",null);var b=_=i=(0,l._)([(0,f.j)("esri.geometry.support.MeshTexture")],_)},27474:function(e,t,r){r.d(t,{Q:function(){return g},X:function(){return b}});var i,n=r(37762),a=r(15671),o=r(43144),s=r(60136),l=r(92572),u=r(27366),c=r(46784),h=r(84652),d=r(32718),p=r(49861),f=r(89125),v=r(69912),y="esri.geometry.support.MeshVertexAttributes",m=d.Z.getLogger(y),g=i=function(e){(0,s.Z)(r,e);var t=(0,l.Z)(r);function r(e){var i;return(0,a.Z)(this,r),(i=t.call(this,e)).color=null,i.position=new Float64Array(0),i.uv=null,i.normal=null,i.tangent=null,i}return(0,o.Z)(r,[{key:"castColor",value:function(e){return b(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},m)}},{key:"castPosition",value:function(e){return e&&e instanceof Float32Array&&m.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),b(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},m)}},{key:"castUv",value:function(e){return b(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},m)}},{key:"castNormal",value:function(e){return b(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},m)}},{key:"castTangent",value:function(e){return b(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},m)}},{key:"clone",value:function(){var e={position:(0,h.d9)(this.position),uv:(0,h.d9)(this.uv),normal:(0,h.d9)(this.normal),tangent:(0,h.d9)(this.tangent),color:(0,h.d9)(this.color)};return new i(e)}},{key:"clonePositional",value:function(){var e={position:(0,h.d9)(this.position),normal:(0,h.d9)(this.normal),tangent:(0,h.d9)(this.tangent),uv:this.uv,color:this.color};return new i(e)}}]),r}(c.wq);function _(e,t,r,i){var n=t.loggerTag,a=t.stride;return e.length%a!=0?(i.error(n,"Invalid array length, expected a multiple of ".concat(a)),new r([])):e}function b(e,t,r,i,a){if(!e)return e;if(e instanceof t)return _(e,i,t,a);var o,s=(0,n.Z)(r);try{for(s.s();!(o=s.n()).done;){if(e instanceof o.value)return _(new t(e),i,t,a)}}catch(u){s.e(u)}finally{s.f()}if(Array.isArray(e))return _(new t(e),i,t,a);var l=r.map((function(e){return"'".concat(e.name,"'")}));return a.error("Failed to set property, expected one of ".concat(l,", but got ").concat(e.constructor.name)),new t([])}function x(e,t,r){t[r]=function(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return t}(e)}(0,u._)([(0,p.Cb)({json:{write:x}})],g.prototype,"color",void 0),(0,u._)([(0,f.p)("color")],g.prototype,"castColor",null),(0,u._)([(0,p.Cb)({nonNullable:!0,json:{write:x}})],g.prototype,"position",void 0),(0,u._)([(0,f.p)("position")],g.prototype,"castPosition",null),(0,u._)([(0,p.Cb)({json:{write:x}})],g.prototype,"uv",void 0),(0,u._)([(0,f.p)("uv")],g.prototype,"castUv",null),(0,u._)([(0,p.Cb)({json:{write:x}})],g.prototype,"normal",void 0),(0,u._)([(0,f.p)("normal")],g.prototype,"castNormal",null),(0,u._)([(0,p.Cb)({json:{write:x}})],g.prototype,"tangent",void 0),(0,u._)([(0,f.p)("tangent")],g.prototype,"castTangent",null),g=i=(0,u._)([(0,v.j)(y)],g)},11700:function(e,t,r){r.d(t,{Iz:function(){return _},M2:function(){return w},To:function(){return S},VS:function(){return T},XO:function(){return x},Yk:function(){return b},w9:function(){return P},wi:function(){return O},zZ:function(){return C}});var i,n,a=r(32718),o=r(92026),s=r(22753),l=r(11873),u=r(81949),c=r(11186),h=r(71353),d=r(79803),p=r(29691),f=r(92975),v=r(81753),y=r(25158),m=r(32035),g=a.Z.getLogger("esri.geometry.support.meshUtils.normalProjection");function _(e,t,r,n,a){return k(n)?(A(i.TO_PCPF,y.ct.fromTypedArray(e),y.fP.fromTypedArray(t),y.fP.fromTypedArray(r),n,y.ct.fromTypedArray(a)),a):(g.error("Cannot convert spatial reference to PCPF"),a)}function b(e,t,r,n,a){return k(n)?(A(i.FROM_PCPF,y.ct.fromTypedArray(e),y.fP.fromTypedArray(t),y.fP.fromTypedArray(r),n,y.ct.fromTypedArray(a)),a):(g.error("Cannot convert to spatial reference from PCPF"),a)}function x(e,t,r){return(0,d.CM)(e,t,0,r,(0,p.rS)(t),0,e.length/3),r}function S(e,t,r){return(0,d.CM)(e,(0,p.rS)(r),0,t,r,0,e.length/3),t}function C(e,t,r){if((0,o.Wi)(e))return t;var i=y.fP.fromTypedArray(e),n=y.fP.fromTypedArray(t);return(0,m.t)(n,i,r),t}function P(e,t,r){if((0,o.Wi)(e))return t;(0,s.b)(Z,r);var i=y.ct.fromTypedArray(e),n=y.ct.fromTypedArray(t);return(0,m.a)(n,i,Z),(0,s.i)(Z)||(0,m.n)(n,n),t}function T(e,t,r){if((0,o.Wi)(e))return t;(0,s.b)(Z,r);var i=y.ct.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),n=y.ct.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if((0,m.a)(n,i,Z),(0,s.i)(Z)||(0,m.n)(n,n),e!==t)for(var a=3;a<e.length;a+=4)t[a]=e[a];return t}function O(e,t,r,n,a){if(!k(n))return g.error("Cannot convert spatial reference to PCPF"),a;A(i.TO_PCPF,y.ct.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),y.fP.fromTypedArray(t),y.fP.fromTypedArray(r),n,y.ct.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT));for(var o=3;o<e.length;o+=4)a[o]=e[o];return a}function w(e,t,r,n,a){if(!k(n))return g.error("Cannot convert to spatial reference from PCPF"),a;A(i.FROM_PCPF,y.ct.fromTypedArray(e,16),y.fP.fromTypedArray(t),y.fP.fromTypedArray(r),n,y.ct.fromTypedArray(a,16));for(var o=3;o<e.length;o+=4)a[o]=e[o];return a}function A(e,t,r,n,a,o){if(t){var l=r.count,u=(0,p.rS)(a);if(E(a))for(var h=0;h<l;h++)n.getVec(h,R),t.getVec(h,L),(0,d.Bm)(u,R,I,u),(0,s.f)(Z,I),e===i.FROM_PCPF&&(0,s.t)(Z,Z),(0,c.t)(L,L,Z),o.setVec(h,L);else for(var f=0;f<l;f++){n.getVec(f,R),t.getVec(f,L),(0,d.Bm)(u,R,I,u),(0,s.f)(Z,I);var y=(0,v.mZ)(r.get(f,1)),m=Math.cos(y);e===i.TO_PCPF&&(m=1/m),Z[0]*=m,Z[1]*=m,Z[2]*=m,Z[3]*=m,Z[4]*=m,Z[5]*=m,e===i.FROM_PCPF&&(0,s.t)(Z,Z),(0,c.t)(L,L,Z),(0,c.n)(L,L),o.setVec(f,L)}return o}}function k(e){return E(e)||function(e){return e.isWebMercator}(e)}function E(e){return e.isWGS84||(0,f.yW)(e)||(0,f.BZ)(e)||(0,f.V2)(e)}(n=i||(i={}))[n.TO_PCPF=0]="TO_PCPF",n[n.FROM_PCPF=1]="FROM_PCPF";var R=(0,h.c)(),L=(0,h.c)(),I=(0,u.c)(),Z=(0,l.c)()},67387:function(e,t,r){r.r(t),r.d(t,{getGeometryServiceURL:function(){return c},projectGeometry:function(){return d}});var i=r(74165),n=r(15861),a=r(42265),o=r(10064),s=r(70032),l=r(45362),u=r(81943);function c(){return h.apply(this,arguments)}function h(){return h=(0,n.Z)((0,i.Z)().mark((function e(){var t,r,n,l,u,c,h=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=h.length>0&&void 0!==h[0]?h[0]:null,l=h.length>1?h[1]:void 0,!a.Z.geometryServiceUrl){e.next=4;break}return e.abrupt("return",a.Z.geometryServiceUrl);case 4:if(n){e.next=6;break}throw new o.Z("internal:geometry-service-url-not-configured");case 6:return u="portal"in n?n.portal||s.Z.getDefault():n,e.next=9,u.load({signal:l});case 9:if(c=null===(t=u.helperServices)||void 0===t||null===(r=t.geometry)||void 0===r?void 0:r.url){e.next=12;break}throw new o.Z("internal:geometry-service-url-not-configured");case 12:return e.abrupt("return",c);case 13:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function d(e,t){return p.apply(this,arguments)}function p(){return p=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,h,d,p=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.length>2&&void 0!==p[2]?p[2]:null,a=p.length>3?p[3]:void 0,e.next=4,c(n,a);case 4:return s=e.sent,(h=new u.Z).geometries=[t],h.outSpatialReference=r,e.next=9,(0,l.i)(s,h,{signal:a});case 9:if(!(d=e.sent)||!Array.isArray(d)||1!==d.length){e.next=12;break}return e.abrupt("return",d[0]);case 12:throw new o.Z("internal:geometry-service-projection-failed");case 13:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}},34610:function(e,t,r){r.d(t,{Kb:function(){return c},o2:function(){return y},sV:function(){return v},xn:function(){return p}});var i=r(74165),n=r(15861),a=r(37762),o=r(51995),s=r(92026),l=r(56011);function u(e,t){if(!e||e.symbol)return null;var r=t&&t.renderer;return e&&(0,s.pC)(r)&&r.getObservationRenderer?r.getObservationRenderer(e):r}function c(e,t){var r,i=u(e,t),n=function(e,t){if((0,s.pC)(e.symbol))return e.symbol;var r=u(e,t);return(0,s.pC)(r)&&"dot-density"!==r.type?r.getSymbol(e,t):null}(e,t);if((0,s.Wi)(n))return null;var o={renderer:i,symbol:n};if((0,s.Wi)(i)||!("visualVariables"in i)||!i.visualVariables)return o;var c,h=null!==(r=(0,l.getVisualVariableValues)(i,e,t))&&void 0!==r?r:[],d=["proportional","proportional","proportional"],p=(0,a.Z)(h);try{for(p.s();!(c=p.n()).done;){var f=c.value,v=f.variable,y=f.value;switch(v.type){case"color":o.color=y.toRgba();break;case"size":if("outline"===v.target)o.outlineSize=y;else{var m=v.axis,g=v.useSymbolValue?"symbol-value":y;switch(m){case"width":d[0]=g;break;case"depth":d[1]=g;break;case"height":d[2]=g;break;case"width-and-depth":d[0]=d[1]=g;break;default:d[0]=d[1]=d[2]=g}}break;case"opacity":o.opacity=y;break;case"rotation":switch(v.axis){case"tilt":o.tilt=y;break;case"roll":o.roll=y;break;default:o.heading=y}}}}catch(_){p.e(_)}finally{p.f()}return"proportional"===d[0]&&"proportional"===d[1]&&"proportional"===d[2]||(o.size=d),o}function h(e,t){return d.apply(this,arguments)}function d(){return(d=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,s.pC)(t.symbol)){e.next=2;break}return e.abrupt("return",t.symbol);case 2:return n=u(t,r),e.abrupt("return",(0,s.pC)(n)?n.getSymbolAsync(t,r):null);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t){return f.apply(this,arguments)}function f(){return f=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n,s,c,d,p,f,v,y,m,g,_,b,x;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=u(t,r),e.next=3,h(t,r);case 3:if(c=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:if(d={renderer:s,symbol:c},s&&"visualVariables"in s&&s.visualVariables){e.next=9;break}return e.abrupt("return",d);case 9:p=null!==(n=(0,l.getVisualVariableValues)(s,t,r))&&void 0!==n?n:[],f=["proportional","proportional","proportional"],v=(0,a.Z)(p);try{for(v.s();!(y=v.n()).done;)m=y.value,g=m.variable,_=m.value,"color"===g.type?d.color=o.Z.toUnitRGBA(_):"size"===g.type?"outline"===g.target?d.outlineSize=_:(b=g.axis,x=g.useSymbolValue?"symbol-value":_,"width"===b?f[0]=x:"depth"===b?f[1]=x:"height"===b?f[2]=x:f[0]=f[1]="width-and-depth"===b?x:f[2]=x):"opacity"===g.type?d.opacity=_:"rotation"===g.type&&"tilt"===g.axis?d.tilt=_:"rotation"===g.type&&"roll"===g.axis?d.roll=_:"rotation"===g.type&&(d.heading=_)}catch(i){v.e(i)}finally{v.f()}return e.abrupt("return",((isFinite(f[0])||isFinite(f[1])||isFinite(f[2]))&&(d.size=f),d));case 13:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e[t];return"number"==typeof r&&isFinite(r)?r:null}function y(e){for(var t=0;t<3;t++){var r=e[t];if("number"==typeof r)return isFinite(r)?r:0}return 0}},45362:function(e,t,r){r.d(t,{i:function(){return p}});var i=r(74165),n=r(1413),a=r(15861),o=r(76200),s=r(25243),l=r(77981),u=r(23084),c=r(35594),h=r(81943),d=(0,s.se)(h.Z);function p(e,t,r){return f.apply(this,arguments)}function f(){return f=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var s,h,p,f,v;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d(r),s=(0,u.en)(t),h=(0,n.Z)((0,n.Z)({},s.query),{},{f:"json"},r.toJSON()),p=r.outSpatialReference,f=(0,l.Ji)(r.geometries[0]),v=(0,u.lA)(h,a),e.abrupt("return",(0,o.default)(s.path+"/project",v).then((function(e){var t=e.data.geometries;return(0,c.o)(t,f,p)})));case 3:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}},81943:function(e,t,r){r.d(t,{Z:function(){return p}});var i=r(15671),n=r(43144),a=r(60136),o=r(92572),s=r(27366),l=r(46784),u=r(49861),c=(r(25243),r(63780),r(69912)),h=r(77981),d=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).geometries=[],n.outSpatialReference=null,n.transformation=null,n.transformForward=null,n}return(0,n.Z)(r,[{key:"toJSON",value:function(){var e=this.geometries.map((function(e){return e.toJSON()})),t=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:(0,h.Ji)(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(r.transformForward=this.transformForward),r}}]),r}(l.wq);(0,s._)([(0,u.Cb)()],d.prototype,"geometries",void 0),(0,s._)([(0,u.Cb)({json:{read:{source:"outSR"}}})],d.prototype,"outSpatialReference",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"transformation",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"transformForward",void 0);var p=d=(0,s._)([(0,c.j)("esri.rest.support.ProjectParameters")],d)},91935:function(e,t,r){r.d(t,{Z:function(){return l}});var i=r(1413),n=r(10064),a=r(32718),o=r(92026),s=r(58971);function l(e,t,r,n,s){if((0,o.Wi)(e))return null;var l=e.referencesGeometry()&&s?c(t,n,s):t,u=e.repurposeFeature(l);try{return e.evaluate((0,i.Z)((0,i.Z)({},r),{},{$feature:u}))}catch(h){return a.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",h),null}}var u=new Map;function c(e,t,r){var o=r.transform,l=r.hasZ,c=r.hasM;u.has(t)||u.set(t,function(e){var t={};switch(e){case"esriGeometryPoint":return function(e,r,i,n){return(0,s.U1)(r,t,e,i,n)};case"esriGeometryPolygon":return function(e,r,i,n){return(0,s.Ie)(r,t,e,i,n)};case"esriGeometryPolyline":return function(e,r,i,n){return(0,s.G6)(r,t,e,i,n)};case"esriGeometryMultipoint":return function(e,r,i,n){return(0,s.J9)(r,t,e,i,n)};default:return a.Z.getLogger("esri.views.2d.support.arcadeOnDemand").error(new n.Z("mapview-arcade","Unable to handle geometryType: ".concat(e))),function(e){return e}}}(t));var h=u.get(t)(e.geometry,o,l,c);return(0,i.Z)((0,i.Z)({},e),{},{geometry:h})}},64488:function(e,t,r){r.d(t,{i:function(){return a}});var i=r(43144),n=r(15671),a=(0,i.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0,0],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0,0,1],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[0,0],c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"world",h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;(0,n.Z)(this,e),this.verticalOffset=t,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=a,this.translation=o,this.elevationOffset=s,this.centerOffset=l,this.screenOffset=u,this.centerOffsetUnits=c,this.displayWidth=h,this.displayHeight=d}))},52919:function(e,t,r){r.d(t,{Lz:function(){return b},RX:function(){return _},Wf:function(){return y},j3:function(){return m}});var i=r(37762),n=r(92026),a=r(14226),o=r(81949),s=r(11186),l=r(71353),u=r(79803),c=r(69691),h=r(96387),d=r(94463),p=r(77648),f=r(17579),v=r(4760);function y(e,t,r,n,a){var o,s=e.stageObject,l=s.geometries,u=0,c=(0,i.Z)(l);try{for(c.s();!(o=c.n()).done;){var h=o.value;if((0,f.T)(h)){var d=A(h,t,r,n,a),p=d.update;u+=d.averageGeometrySampledElevation,p&&s.geometryVertexAttrsUpdated(h)}}}catch(v){c.e(v)}finally{c.f()}return u/l.length}function m(e,t,r,i,n){var o,l=e.stageObject,c=t.centerPointInElevationSR,p=0;null!==(o=l.metadata)&&void 0!==o&&o.usesVerticalDistanceToGround?(i(c,w),(0,h.CV)(l,w.verticalDistanceToGround),p=w.sampledElevation):(i(c,w),"absolute-height"!==t.mode&&(p=w.sampledElevation));var f=(0,a.c)(g,l.transformation),v=(0,s.s)(O,f[12],f[13],f[14]);d.Z.TESTS_DISABLE_OPTIMIZATIONS?(S[0]=c.x,S[1]=c.y,S[2]=w.z,(0,u.Bm)(c.spatialReference,S,f,n.spatialReference)&&(l.transformation=f)):n.setAltitudeOfTransformation(w.z,f);var y=x/n.unitInMeters;return(Math.abs(f[12]-v[0])>=y||Math.abs(f[13]-v[1])>=y||Math.abs(f[14]-v[2])>=y)&&(l.transformation=f),p}var g=(0,o.c)();function _(e,t,r,i,a){var o=e.graphics3DSymbolLayer.lodRenderer;if((0,n.Wi)(o))return 0;var l=t.centerPointInElevationSR;i(l,w);var c="absolute-height"!==t.mode?w.sampledElevation:0,h=o.instanceData,p=e.instanceIndex,f=T;h.getGlobalTransform(p,f);var v=(0,s.s)(O,f[12],f[13],f[14]);d.Z.TESTS_DISABLE_OPTIMIZATIONS?(S[0]=l.x,S[1]=l.y,S[2]=w.z,(0,u.Bm)(l.spatialReference,S,f,a.spatialReference)&&h.setGlobalTransform(p,f)):a.setAltitudeOfTransformation(w.z,f);var y=x/a.unitInMeters;return(d.Z.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(f[12]-v[0])>=y||Math.abs(f[13]-v[1])>=y||Math.abs(f[14]-v[2])>=y)&&h.setGlobalTransform(p,f),c}function b(e,t,r,n,a){var o=e.stageObject,s=o.geometries;if(0===s.length)return 0;var l,u=0,c=null,h=0,d=!1,p=(0,i.Z)(s);try{for(p.s();!(l=p.n()).done;){var y=l.value;if((0,f.T)(y)){var m=y.vertexAttributes.get(v.T.POSITION);if(m!==c){var g=A(y,t,r,n,a),_=g.update;h=g.averageGeometrySampledElevation,c=m,d=_}d&&o.geometryVertexAttrsUpdated(y),u+=h}}}catch(b){p.e(b)}finally{p.f()}return u/s.length}var x=.01,S=(0,l.c)(),C=(0,l.c)(),P=(0,l.c)(),T=(0,o.c)(),O=(0,l.c)(),w=new c.Lm;function A(e,t,r,i,n){var a=!1,o=e.shaderTransformation,s=t.requiresSampledElevationInfo;C[0]=o[12],C[1]=o[13],C[2]=o[14],e.invalidateBoundingInfo();for(var l=e.getMutableAttribute(v.T.POSITION),c=l.data,h=l.size,f=c.length/h,y=new p.sb(e.mapPositions,r),m=0,g=0,_=0;_<f;_++){if(P[0]=c[m],P[1]=c[m+1],P[2]=c[m+2],i(y,w),s&&(g+=w.sampledElevation),d.Z.TESTS_DISABLE_OPTIMIZATIONS)c[m]=y.array[y.offset],c[m+1]=y.array[y.offset+1],c[m+2]=w.z,(0,u.CM)(c,r,m,c,n.spatialReference,m,1),c[m]-=C[0],c[m+1]-=C[1],c[m+2]-=C[2],a=!0;else{S[0]=c[m]+C[0],S[1]=c[m+1]+C[1],S[2]=c[m+2]+C[2],n.setAltitude(S,w.z),c[m]=S[0]-C[0],c[m+1]=S[1]-C[1],c[m+2]=S[2]-C[2];var b=x/n.unitInMeters;(Math.abs(P[0]-c[m])>=b||Math.abs(P[1]-c[m+1])>=b||Math.abs(P[2]-c[m+2])>=b)&&(a=!0)}m+=h,y.offset+=3}return{update:a,averageGeometrySampledElevation:g/=f}}},91293:function(e,t,r){r.d(t,{K:function(){return f},Y:function(){return p}});var i=r(1413),n=r(74165),a=r(15861),o=r(15671),s=r(43144),l=(r(59486),r(63780)),u=r(92026),c=r(66978),h=r(93463),d=r(77577),p=function(){function e(t,r){(0,o.Z)(this,e),this.spatialReference=t,this._view=r}return(0,s.Z)(e,[{key:"getElevation",value:function(e,t,r){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}},{key:"queryElevation",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r,i,a,o){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._view.elevationProvider.queryElevation(t,r,0,this.spatialReference,o,i,a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a){return e.apply(this,arguments)}}()}]),e}(),f=function(){function e(t,r,n,a){(0,o.Z)(this,e),this.spatialReference=r,this._getElevationQueryProvider=n,this._queries=new Array,this._queryOptions=(0,i.Z)((0,i.Z)({},a),{},{ignoreInvisibleLayers:!0}),this._frameTask=t.registerTask(h.T8.ELEVATION_QUERY,this)}return(0,s.Z)(e,[{key:"destroy",value:function(){this._frameTask.remove()}},{key:"queryElevation",value:function(e,t,r){var i=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new Promise((function(a,o){var s={x:e,y:t,minDemResolution:n,result:{resolve:a,reject:o},signal:r};i._queries.push(s),(0,c.fu)(r,(function(){(0,l.Od)(i._queries,s),o((0,c.zE)())}))}))}},{key:"running",get:function(){return this._queries.length>0}},{key:"runTask",value:function(e){var t=this._queries;this._queries=[];var r=this._getElevationQueryProvider();if(!r)return t.forEach((function(e){return e.result.reject()})),void e.madeProgress();var n=t.map((function(e){return[e.x,e.y]})),a=t.reduce((function(e,t){return Math.min(e,t.minDemResolution)}),1/0),o=new d.Z({points:n,spatialReference:this.spatialReference}),s=t.length>1&&t.some((function(e){return!!e.signal}))?new AbortController:null,l=(0,u.pC)(s)?s.signal:t[0].signal;if((0,u.pC)(s)){var h=0;t.forEach((function(e){return(0,c.fu)(e.signal,(function(){h++,e.result.reject((0,c.zE)()),h===t.length&&s.abort()}))}))}var p=(0,i.Z)((0,i.Z)({},this._queryOptions),{},{minDemResolution:a,signal:l});r.queryElevation(o,p).then((function(e){t.forEach((function(t,r){(0,u.pC)(t.signal)&&t.signal.aborted?t.result.reject((0,c.zE)()):t.result.resolve(e.geometry.points[r][2])}))})).catch((function(e){t.forEach((function(t){return t.result.reject(e)}))})),e.madeProgress()}},{key:"test",get:function(){var e=this;return{update:function(){return e._queries.length>0&&e.runTask(h.G5)}}}}]),e}()},67166:function(e,t,r){r.d(t,{S:function(){return s}});var i=r(32718),n=r(29481),a=r(95437),o=i.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function s(e,t){if(!(0,n.Pd)(e))return o.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '".concat(e.type,"' does not support callouts")),null;if(!e.callout)return null;var r=l[e.callout.type];return r?new r(e,t):(o.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type ".concat(e.callout.type)),null)}var l={line:a.YT}},91107:function(e,t,r){r.d(t,{Z:function(){return a}});var i=r(43144),n=r(15671),a=(0,i.Z)((function e(t,r,i){(0,n.Z)(this,e),this.graphic=t,this.renderingInfo=r,this.layer=i}))},95437:function(e,t,r){r.d(t,{YT:function(){return ne},_D:function(){return ce},Ly:function(){return ue}});var i=r(74165),n=r(15861),a=r(15671),o=r(43144),s=r(11752),l=r(61120),u=r(60136),c=r(92572),h=r(51995),d=r(92026),p=r(17842),f=r(6394),v=r(71353),y=r(67077),m=r(29481),g=r(52919),_=r(69691),b=r(78935),x=r(91107),S=r(58063),C=r(3173),P=r(73614),T=r(96387),O=r(36759),w=r(35218),A=r(91526),k=r(79100),E=r(40779),R=r(4760),L=r(15245),I=r(55158),Z=r(37081),D=r(81879),M=r(23620),z=r(56529),F=r(93822),U=r(33236),V=r(50951),N=r(82144),G=r(31132),B=r(7566),H=r(27627),W=r(44619),j=r(8548),q=r(36207),Y=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,o.Z)(r,[{key:"initializeConfiguration",value:function(e,t){t.spherical=e.viewingMode===V.JY.Global}},{key:"initializeProgram",value:function(e){return new H.$(e.rctx,r.shader.get().build(this.configuration),B.i)}},{key:"setPipelineState",value:function(e){var t=e?j.wb.ALWAYS:j.wb.LESS;return this.configuration.depthHudEnabled?(0,q.sm)({depthTest:{func:t},depthWrite:q.LZ}):(0,q.sm)({blending:(0,q.wK)(j.zi.ONE,j.zi.SRC_ALPHA,j.zi.ONE_MINUS_SRC_ALPHA,j.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:t},colorWrite:q.BK})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}]),r}(G.A);Y.shader=new N.J(W.L,(function(){return r.e(20658).then(r.bind(r,20658))}));var J=r(27366),X=r(33559),Q=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).screenCenterOffsetUnitsEnabled=D.d.World,e.spherical=!1,e.occlusionTestEnabled=!0,e.hasVerticalOffset=!1,e.hasScreenSizePerspective=!1,e.depthHudEnabled=!1,e.depthHudAlignStartEnabled=!1,e.hasSlicePlane=!1,e.hasMultipassGeometry=!1,e}return(0,o.Z)(r)}(r(8883).W);(0,J._)([(0,X.o)({count:D.d.COUNT})],Q.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,J._)([(0,X.o)()],Q.prototype,"spherical",void 0),(0,J._)([(0,X.o)()],Q.prototype,"occlusionTestEnabled",void 0),(0,J._)([(0,X.o)()],Q.prototype,"hasVerticalOffset",void 0),(0,J._)([(0,X.o)()],Q.prototype,"hasScreenSizePerspective",void 0),(0,J._)([(0,X.o)()],Q.prototype,"depthHudEnabled",void 0),(0,J._)([(0,X.o)()],Q.prototype,"depthHudAlignStartEnabled",void 0),(0,J._)([(0,X.o)()],Q.prototype,"hasSlicePlane",void 0),(0,J._)([(0,X.o)()],Q.prototype,"hasMultipassGeometry",void 0),(0,J._)([(0,X.o)({constValue:!0})],Q.prototype,"hasSliceInVertexProgram",void 0),(0,J._)([(0,X.o)({constValue:!1})],Q.prototype,"isDraped",void 0);var K=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(e){var i;return(0,a.Z)(this,r),(i=t.call(this,e,new ee))._configuration=new Q,i._uniqueMaterialIdentifier=r.uniqueMaterialIdentifier(i.parameters),i}return(0,o.Z)(r,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}},{key:"getPassParameters",value:function(){return this.parameters}},{key:"getConfiguration",value:function(e,t){var r=(null===t||void 0===t?void 0:t.slot)!==F.r.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=(0,d.pC)(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=(0,d.pC)(this.parameters.screenSizePerspective),this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?D.d.Screen:D.d.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=t.multipassGeometry.enabled,this._configuration}},{key:"intersect",value:function(){}},{key:"requiresSlot",value:function(e,t){if(t===Z.H.Color)switch(e){case F.r.LINE_CALLOUTS:case F.r.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}},{key:"createGLMaterial",value:function(e){return new $(e)}},{key:"createBufferWriter",value:function(){return new ie}},{key:"validateParameters",value:function(e){var t=r.uniqueMaterialIdentifier(e);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)}}],[{key:"uniqueMaterialIdentifier",value:function(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}}]),r}(z.F5),$=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,o.Z)(r,[{key:"beginSlot",value:function(e){return this.ensureTechnique(Y,e)}}]),r}(M.Z),ee=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).screenOffset=f.Z,e.color=[0,0,0,1],e.size=1,e.occlusionTest=!1,e.shaderPolygonOffset=1e-5,e.depthHUDAlignStart=!1,e.centerOffsetUnits="world",e.hasSlicePlane=!1,e}return(0,o.Z)(r)}(z.Mt),te=(0,I.U$)().vec3f(R.T.POSITION).vec3f(R.T.NORMAL).vec2f(R.T.UV0).vec4f(R.T.AUXPOS1),re=[(0,L.f)(0,0),(0,L.f)(1,0),(0,L.f)(0,1),(0,L.f)(1,0),(0,L.f)(1,1),(0,L.f)(0,1)],ie=function(){function e(){(0,a.Z)(this,e),this.vertexBufferLayout=te}return(0,o.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return 6*e.indices.get(R.T.POSITION).length}},{key:"write",value:function(e,t,r,i,n){(0,U.ho)(r.indices.get(R.T.POSITION),r.vertexAttributes.get(R.T.POSITION).data,e,i.position,n,6),(0,U.s5)(r.indices.get(R.T.NORMAL),r.vertexAttributes.get(R.T.NORMAL).data,t,i.normal,n,6),(0,U.SW)(r.indices.get(R.T.AUXPOS1),r.vertexAttributes.get(R.T.AUXPOS1).data,i.auxpos1,n,6);for(var a=0;a<re.length;++a)i.uv0.setVec(n+a,re[a])}}]),e}(),ne=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(e,i){var n;return(0,a.Z)(this,r),(n=t.call(this,e,null,i,le))._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},n.ensureDrapedStatus(!1),n}return(0,o.Z)(r,[{key:"doLoad",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._material=new K(this._materialParameters),this._context.stage.add(this._material);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,s.Z)((0,l.Z)(r.prototype),"destroy",this).call(this),this._context.stage.remove(this._material),this._material=null}},{key:"_perInstanceMaterialParameters",value:function(e){var t=this._materialParameters;return t.screenOffset=e.screenOffset||f.Z,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}},{key:"_materialParameters",get:function(){var e=new ee,t=this.symbol,r=t.callout;if(e.color=(0,d.pC)(r.color)?h.Z.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=(0,p.F2)(r.size||0),t.verticalOffset){var i=t.verticalOffset,n=i.screenLength,a=i.minWorldLength,o=i.maxWorldLength;e.verticalOffset={screenLength:(0,p.F2)(n),minWorldLength:a||0,maxWorldLength:(0,d.pC)(o)?o:1/0}}e.borderColor=(0,d.pC)(r.border)&&(0,d.pC)(r.border.color)?h.Z.toUnitRGBA(r.border.color):null;var s="object"===t.symbolLayers.getItemAt(0).type,l="label-3d"===t.type;return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=l,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}},{key:"_defaultElevationInfoNoZ",value:function(){return se}},{key:"createGraphics3DGraphic",value:function(e){var t=e.renderingInfo,r=e.graphic,i=this.setGraphicElevationContext(r,new b.o,t.elevationOffset||0),n=t.symbol,a="on-the-ground"===this._elevationContext.mode&&("cim"===n.type||!n.symbolLayers.some((function(e){return"object"===e.type||"text"===e.type})));if("label-3d"!==n.type&&a)return null;if("point-3d"===n.type&&n.symbolLayers.every((function(e){return"text"===e.type&&!(0,m.as)(e)})))return null;var o=(0,T.zE)(r.geometry);return(0,d.Wi)(o)?null:this._createAs3DShape(o,i,t,r.uid)}},{key:"layerOpacityChanged",value:function(){(0,d.pC)(this._material)&&this._material.setParameters(this._materialParameters)}},{key:"layerElevationInfoChanged",value:function(e,t,i){var n=this,a=this._elevationContext.mode,o=(0,_.GC)(r.elevationModeChangeTypes,i,a);return o!==_.lO.UPDATE||e.forEach((function(e){var r=t(e);(0,d.pC)(r)&&n.updateGraphicElevationContext(e.graphic,r)})),o}},{key:"slicePlaneEnabledChanged",value:function(){return(0,d.Wi)(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"skipHighSymbolLodsChanged",value:function(){return!0}},{key:"setGraphicElevationContext",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=(0,s.Z)((0,l.Z)(r.prototype),"setGraphicElevationContext",this).call(this,e,t);return n.addOffsetRenderUnits(i),n}},{key:"updateGraphicElevationContext",value:function(e,t){this.setGraphicElevationContext(e,t.elevationContext,(0,d.pC)(t.metadata)?t.metadata.elevationOffset:0),t.needsElevationUpdates=(0,_.Xf)(t.elevationContext.mode)}},{key:"computeComplexity",value:function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:w.WU.memory}}},{key:"_createVertexData",value:function(e){var t=e.translation,r=e.centerOffset,i=new A.a(t?[t[0],t[1],t[2]]:[0,0,0],3,!0),n=new A.a(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],4,!0);return[[R.T.POSITION,i],[R.T.NORMAL,new A.a([0,0,1],3,!0)],[R.T.AUXPOS1,n]]}},{key:"_getOrCreateMaterial",value:function(e){var t=this._perInstanceMaterialParameters(e),r=K.uniqueMaterialIdentifier(t);if((0,d.pC)(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if((0,d.pC)(e.materialCollection)){var i=e.materialCollection.get(r);return(0,d.Wi)(i)&&(i=new K(t),e.materialCollection.add(r,i)),{material:i,isUnique:!1}}return{material:new K(t),isUnique:!0}}},{key:"_createAs3DShape",value:function(e,t,r,i){var n=this._context.layer.uid,a=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:n}),o=this._getOrCreateMaterial(r),s=new E.Z(o.material,this._createVertexData(r),oe,null,k.U.Point,a),l=(0,O.ZC)(this._context,e,s,t,i);if((0,d.Wi)(l))return null;var u=new S.z(this,l.object,[s],o.isUnique?[o.material]:null,null,g.j3,t);return u.metadata=new C.n(r.elevationOffset),u.alignedSampledElevation=l.sampledElevation,u.needsElevationUpdates=(0,_.Xf)(t.mode),(0,O.dO)(u,e,this._context.elevationProvider),u}}]),r}(P.k);ne.elevationModeChangeTypes={definedChanged:_.lO.UPDATE,staysOnTheGround:_.lO.UPDATE,onTheGroundChanged:_.lO.RECREATE};var ae=[0],oe=[[R.T.POSITION,ae],[R.T.NORMAL,ae],[R.T.AUXPOS1,ae]],se={mode:"relative-to-ground",offset:0},le={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},ue=(0,o.Z)((function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,v.c)(),n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,y.c)(),o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,f.a)(),s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"world",l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,a.Z)(this,e),this.renderer=t,this.symbol=r,this.translation=i,this.centerOffset=n,this.screenOffset=o,this.centerOffsetUnits=s,this.elevationOffset=l,this.materialCollection=u})),ce=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,o.Z)(r)}(x.Z)},58063:function(e,t,r){r.d(t,{n:function(){return g},z:function(){return _}});var i=r(74165),n=r(15861),a=r(37762),o=r(43144),s=r(15671),l=r(92026),u=r(11186),c=r(71353),h=r(41414),d=r(23470),p=r(69691),f=r(8821),v=r(96387),y=r(68401),m=r(77958),g=(0,o.Z)((function e(t,r,i){(0,s.Z)(this,e),this.baseMaterial=t,this.edgeMaterials=r,this.properties=i})),_=function(){function e(t,r,i,n,a,o,l){var u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,s.Z)(this,e),this.graphics3DSymbolLayer=t,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=n,this._sharedResource=a,this.elevationAligner=o,this.elevationContext=l,this._edgeState=u,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}return(0,o.Z)(e,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},{key:"initialize",value:function(e,t){this._stageLayer=t,this._stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.add(this.stageObject)}},{key:"destroy",value:function(){var e=this._stage;this._stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries)),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);var t=this._stage.renderer.ensureEdgeView();t.hasObject(this.stageObject)&&t.removeObject(this.stageObject),this.stageObject.dispose(),(0,l.pC)(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}},{key:"layerOpacityChanged",value:function(e,t){if(!(0,l.Wi)(this._edgeState)){var r,i=b(this._edgeState.baseMaterial),n=!1,o=(0,a.Z)(this._edgeState.edgeMaterials);try{for(o.s();!(r=o.n()).done;){var s=r.value;s.objectTransparency!==i&&(s.objectTransparency=i,n=!0)}}catch(u){o.e(u)}finally{o.f()}n&&this._resetEdgeObject(t),this._stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}}},{key:"slicePlaneEnabledChanged",value:function(e,t){(0,l.Wi)(this._edgeState)||(this._stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!t),this._edgeState.properties.hasSlicePlane=e)}},{key:"setVisibility",value:function(e){if(null!=this._stage&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),(0,l.pC)(this._edgeState))){var t=this._stage.renderer.ensureEdgeView();t.hasObject(this.stageObject)?t.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(t,!1)}}},{key:"visible",get:function(){return this._visible}},{key:"alignWithElevation",value:function(e,t,r,i){var n=this;if(null!=this.elevationAligner){(0,l.pC)(r)&&(0,f.aO)(this.elevationContext.featureExpressionInfoContext,r);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,(0,l.Wg)(e.spatialReference),(function(r,i){return(0,p.qZ)(r,e,n.elevationContext,t,i)}),t),this._resetEdgeObject(i)}}},{key:"alignWithAbsoluteElevation",value:function(e,t,r){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,(function(t,r){r.sampledElevation=e,r.verticalDistanceToGround=0,r.z=e}),t),this._resetEdgeObject(r)}},{key:"getCenterObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,c.c)();return(0,u.c)(e,(0,d.g)(this.stageObject.boundingVolumeObjectSpace.bounds))}},{key:"getBoundingBoxObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.Ue)(),t=this.stageObject.boundingVolumeObjectSpace;return(0,h.op)(e,t.min),(0,h.Tn)(e,t.max),e}},{key:"computeAttachmentOrigin",value:function(e){if(this.useObjectOriginAsAttachmentOrigin){var t=this.stageObject.transformation;e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++}else{var r,i=(0,a.Z)(this.stageObject.geometries);try{for(i.s();!(r=i.n()).done;){r.value.computeAttachmentOrigin(C)&&((0,u.m)(C,C,this.stageObject.transformation),(0,u.a)(e.render.origin,e.render.origin,C),e.render.num++)}}catch(n){i.e(n)}finally{i.f()}}}},{key:"getProjectedBoundingBox",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r,n,a,o){var s,c,d,p,f,y,m,g,_,b,T;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.getBoundingBoxObjectSpace(o),c=P,d=(0,h.wp)(s)?1:c.length,p=0;p<d;p++)f=c[p],S[0]=s[f[0]],S[1]=s[f[1]],S[2]=s[f[2]],(0,u.m)(S,S,this.stageObject.transformation),x[3*p+0]=S[0],x[3*p+1]=S[1],x[3*p+2]=S[2];if(t(x,0,d)){e.next=4;break}return e.abrupt("return",null);case 4:for((0,h.cS)(s),y=null,this.calculateRelativeScreenBounds&&(y=this.calculateRelativeScreenBounds()),m=0;m<3*d;m+=3){for(g=0;g<3;g++)s[g]=Math.min(s[g],x[m+g]),s[g+3]=Math.max(s[g+3],x[m+g]);y&&n.push({location:x.slice(m,m+3),screenSpaceBoundingRect:y})}if(!r||!r.service||"absolute-height"===this.elevationContext.mode){e.next=28;break}if((0,h.be)(s,C),_="relative-to-scene"===this.elevationContext.mode?"scene":"ground",b=0,!r.useViewElevation){e.next=16;break}b=(0,l.Pt)(r.service.getElevation(C[0],C[1],_),0),e.next=27;break;case 16:return e.prev=16,T=(0,v.Si)(s,r.service.spatialReference,r),e.t0=l.Pt,e.next=21,r.service.queryElevation(C[0],C[1],a,T,_);case 21:e.t1=e.sent,b=(0,e.t0)(e.t1,0),e.next=27;break;case 25:e.prev=25,e.t2=e.catch(16);case 27:(0,h.cv)(s,0,0,-this.alignedSampledElevation+b);case 28:return e.abrupt("return",s);case 29:case"end":return e.stop()}}),e,this,[[16,25]])})));return function(t,r,i,n,a){return e.apply(this,arguments)}}()},{key:"addObjectState",value:function(e,t){e===y.V_.Highlight&&t.addObject(this.stageObject,this.stageObject.highlight()),e===y.V_.MaskOccludee&&t.addObject(this.stageObject,this.stageObject.maskOccludee())}},{key:"removeObjectState",value:function(e){e.removeObject(this.stageObject)}},{key:"_resetEdgeObject",value:function(e){if(!(0,l.Wi)(this._edgeState)){var t=this._stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(t,e):t.removeObject(this.stageObject)}}},{key:"_addOrUpdateEdgeObject",value:function(e,t){var r=this,i=this._edgeState;if(!(0,l.Wi)(i)){var n,o=b(i.baseMaterial),s=(0,a.Z)(i.edgeMaterials);try{for(s.s();!(n=s.n()).done;){n.value.objectTransparency=o}}catch(u){s.e(u)}finally{s.f()}e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!t).then((function(){var e;return null===(e=r._stageLayer)||void 0===e?void 0:e.sync()}))}}}]),e}();function b(e){return e.isVisible()?e.parameters.transparent?m.i.TRANSPARENT:m.i.OPAQUE:m.i.INVISIBLE}var x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S=(0,c.c)(),C=(0,c.c)(),P=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]]},3173:function(e,t,r){r.d(t,{n:function(){return o}});var i=r(43144),n=r(15671),a=r(92026),o=(0,i.Z)((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,n.Z)(this,e),this.labelText=r,this.elevationOffset=(0,a.Pt)(t,0)}))},53727:function(e,t,r){r.d(t,{hy:function(){return i},t6:function(){return a},tZ:function(){return n}});var i=3,n=3,a=10},89639:function(e,t,r){r.d(t,{Z:function(){return qo}});var i=r(37762),n=r(93433),a=r(74165),o=r(15861),s=r(15671),l=r(43144),u=r(11752),c=r(61120),h=r(60136),d=r(92572),p=r(14921),f=r(92026),v=r(66978),y=r(59896),m=r(13005),g=r(88396),_=r(6394),b=r(11186),x=r(71353),S=r(80885),C=r(79803),P=r(41414),T=r(65156),O=r(92975),w=r(65618),A=r(83406),k=r(70446),E=r(8821),R=new m.Z(Array,(function(e){return(0,P.t8)(e,P.xE)}),null,10,5),L=(0,T.Ue)(),I=function(){function e(t,r,n,a,o){(0,s.Z)(this,e),this.graphic=t,this.graphics3DSymbol=r,this.layers=n,this._labelLayers=new Array,this._auxiliaryLayers=new Array,this._visibilityFlags=function(e,t){for(var r=new Array(e),i=0;i<r.length;i++)r[i]=new Array(t);return r}(k.E._COUNT,k.P._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++r.referenced,this._featureExpressionFeature=o?(0,E.Tz)(o,t,a):null;var l,u=(0,i.Z)(n);try{for(u.s();!(l=u.n()).done;){var c=l.value;(0,f.pC)(c)&&(this.isElevationSource=this.isElevationSource||c.isElevationSource)}}catch(h){u.e(h)}finally{u.f()}}return(0,l.Z)(e,[{key:"labelLayers",get:function(){return this._labelLayers}},{key:"extent",get:function(){return this._extent}},{key:"initialize",value:function(e,t){var r=this;this._layer=t,this._stage=e,this._forEachSymbolLayerGraphic((function(i){i.initialize(e,t),i.setVisibility(r.isVisible())}))}},{key:"destroy",value:function(){this._forEachSymbolLayerGraphic((function(e){return e.destroy()})),this.layers=null,this._auxiliaryLayers=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}},{key:"destroyed",get:function(){return null==this.layers}},{key:"clearLabelGraphics",value:function(){this._forEachLabelGraphic((function(e){return e.destroy()})),this._labelLayers.length=0}},{key:"addLabelGraphic",value:function(e,t,r){this._labelLayers.push(e),e.initialize(t,r),e.setVisibility(this.isVisible(k.E.LABEL))}},{key:"addAuxiliaryGraphic",value:function(e){this._auxiliaryLayers.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))}},{key:"isDraped",get:function(){var e=!1;return this._forEachSymbolLayerGraphic((function(t){"draped"===t.type&&(e=!0)})),e}},{key:"isVisible",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.E.GRAPHIC,t=arguments.length>1?arguments[1]:void 0,r=0;r<=e;r++)for(var i=this._visibilityFlags[r],n=0;n<i.length;++n)if(!1===i[n]&&n!==t)return!1;return!0}},{key:"hasVisibilityFlag",value:function(e,t){return null!=this._visibilityFlags[t][e]}},{key:"setVisibilityFlag",value:function(e,t,r){var i=this.isVisible(r);this._visibilityFlags[r][e]=t;var n=this.isVisible(r);if(i===n)return!1;if(r===k.E.LABEL)this._forEachLabelGraphic((function(e){return e.setVisibility(n)}));else{this._forEachSymbolLayerGraphic((function(e){return e.setVisibility(n)}));var a=this.isVisible(k.E.LABEL);this._forEachLabelGraphic((function(e){return e.setVisibility(a)}))}return!0}},{key:"clearVisibilityFlag",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.E.GRAPHIC;return this.setVisibilityFlag(e,void 0,t)}},{key:"computeExtent",value:function(e){if(!this._extent){var t=this.graphic.geometry;if((0,f.Wi)(t))return!1;this._extent=(0,T.Ue)(),(0,w.TF)(t,this._extent);var r=t.spatialReference;if(!(0,O.fS)(r,e)&&!(0,C.dH)(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}},{key:"getAsOptimizedGeometry",value:function(e,t){return(0,f.pC)(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===t||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=t),this._optimizedGeometry.geometry}},{key:"_convertGraphicToOptimizedGeometry",value:function(e,t,r){var i=e.geometry;return"mesh"!==i.type&&"extent"!==i.type||(i=S.Z.fromExtent("mesh"===i.type?i.extent:i)),(0,A.GH)(i,t,r)}},{key:"usedMemory",get:function(){var e=this,t=(0,y.f2)(this.graphic.attributes);return this._forEachSymbolLayerGraphic((function(r){var i=r.graphics3DSymbolLayer.complexity;if(!(0,f.Wi)(i)){var n="draped"===r.type?i.memory.draped:i.memory;t+=n.bytesPerFeature,n.bytesPerCoordinate&&(t+=(0,w.R3)(e.graphic.geometry)*n.bytesPerCoordinate)}})),t}},{key:"computeAttachmentOrigin",value:function(){var e,t={render:{origin:(0,x.c)(),num:0},draped:{origin:(0,_.a)(),num:0}},r=(0,i.Z)(this.layers);try{for(r.s();!(e=r.n()).done;){var n=e.value;(0,f.Wi)(n)||n.computeAttachmentOrigin(t)}}catch(a){r.e(a)}finally{r.f()}return t.render.num>1&&(0,b.g)(t.render.origin,t.render.origin,1/t.render.num),t.draped.num>1&&(0,g.b)(t.draped.origin,t.draped.origin,1/t.draped.num),t}},{key:"getProjectedBoundingBox",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,i,n,s){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?(0,P.cS)(s.boundingBox):s.boundingBox=(0,P.cS)(),s.requiresDrapedElevation=!1,e.next=5,(0,p.Ed)(this.layers,function(){var e=(0,o.Z)((0,a.Z)().mark((function e(o){var l,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,f.Wi)(o)){e.next=2;break}return e.abrupt("return");case 2:return l="draped"===o.type?r:t,u=R.acquire(),e.next=6,o.getProjectedBoundingBox(l,i,s.screenSpaceObjects,n,u);case 6:c=e.sent,isFinite(c[2])&&isFinite(c[5])||(s.requiresDrapedElevation=!0),c&&(0,P.TC)(s.boundingBox,u),R.release(u);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:return e.abrupt("return",(0,P.sU)(s.boundingBox)||(0,T.sU)((0,P.y8)(s.boundingBox,L))?s:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a){return e.apply(this,arguments)}}()},{key:"needsElevationUpdates",value:function(){var e,t=(0,i.Z)(this.layers);try{for(t.s();!(e=t.n()).done;){var r=e.value;if((0,f.pC)(r)&&("object3d"===r.type||"lod-instance"===r.type)&&r.needsElevationUpdates)return!0}}catch(s){t.e(s)}finally{t.f()}var n,a=(0,i.Z)(this._labelLayers);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o&&o.needsElevationUpdates)return!0}}catch(s){a.e(s)}finally{a.f()}return!1}},{key:"alignWithElevation",value:function(e,t,r){var i=this;this._forEachRenderedGraphic((function(n){"object3d"!==n.type&&"lod-instance"!==n.type||n.alignWithElevation(e,t,i._featureExpressionFeature,r)}))}},{key:"alignWithAbsoluteElevation",value:function(e,t,r){this._forEachRenderedGraphic((function(i){"object3d"===i.type&&i.alignWithAbsoluteElevation(e,t,r)}))}},{key:"addObjectStateSet",value:function(e,t){this._forEachSymbolLayerGraphic((function(r){return r.addObjectState(e,t)}))}},{key:"removeObjectState",value:function(e){this._forEachSymbolLayerGraphic((function(t){return t.removeObjectState(e)}))}},{key:"_forEachGraphicList",value:function(e,t){e.forEach((function(e){return e&&t(e)}))}},{key:"_forEachSymbolLayerGraphic",value:function(e){this._forEachGraphicList(this.layers,e),this._forEachGraphicList(this._auxiliaryLayers,e)}},{key:"_forEachLabelGraphic",value:function(e){this._forEachGraphicList(this._labelLayers,e)}},{key:"_forEachRenderedGraphic",value:function(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}}]),e}();var Z=r(58063),D=r(32718),M=r(1413),z=r(93169),F=r(10064),U=r(84652),V=r(68860),N=r(79347),G=r(22753),B=r(11873),H=r(14226),W=r(81949),j=r(25158),q=r(32035),Y=r(34311),J=r(34610),X=r(50951),Q=r(69691),K=r(78935),$=r(73614),ee=r(96387),te=r(41325),re=(r(59486),r(91526)),ie=r(79100),ne=r(40779),ae=r(4760),oe=r(53866);function se(e){var t=[[ae.T.POSITION,e.indices]],r=[[ae.T.POSITION,new re.a(e.attributeData.position,3,!0)]];return(0,f.pC)(e.attributeData.color)&&(r.push([ae.T.COLOR,new re.a(e.attributeData.color,4,!0)]),t.push([ae.T.COLOR,new Array(e.indices.length).fill(0)])),(0,f.pC)(e.attributeData.uvMapSpace)&&(r.push([ae.T.UVMAPSPACE,new re.a(e.attributeData.uvMapSpace,4,!0)]),t.push([ae.T.UVMAPSPACE,e.indices])),(0,f.pC)(e.attributeData.boundingRect)&&(r.push([ae.T.BOUNDINGRECT,new re.a(e.attributeData.boundingRect,9,!0)]),t.push([ae.T.BOUNDINGRECT,e.indices])),new ne.Z(e.material,r,t,e.mapPositions,ie.U.Mesh,e.attributeData.objectAndLayerIdColor)}function le(e){var t=[[ae.T.POSITION,e.indices],[ae.T.UV0,e.indices]],r=[[ae.T.POSITION,new re.a(e.attributeData.position,3,!0)],[ae.T.UV0,new re.a(e.attributeData.uv0,2,!0)]];return new ne.Z(e.material,r,t,e.mapPositions)}function ue(e){switch(e.type){case"extent":if(e instanceof oe.Z)return S.Z.fromExtent(e);break;case"polygon":return e}return null}var ce=(0,l.Z)((function e(t,r,i){(0,s.Z)(this,e),this.renderData=t,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array})),he=r(97689),de=r(94463),pe=r(77648),fe=r(91320),ve=r(19384),ye=r(88699);function me(e,t,r,i){var n=(0,fe.Mk)(e.rings,!!e.hasZ,fe.ZI.CCW_IS_HOLE),a=(0,ye.bg)(n.position.length),o=(0,Q.rR)(n.position,e.spatialReference,0,a,0,n.position,0,n.position.length/3,t,r,i),s=null!=o;return new Te(n.position,a,be(n.polygons,n.position,a),_e(n.outlines,n.position,a),s,o)}function ge(e,t){for(var r=(0,fe.Mk)(e.rings,!1,fe.ZI.CCW_IS_HOLE),i=(0,C.CM)(r.position,e.spatialReference,0,r.position,t,0,r.position.length/3),n=2;n<r.position.length;n+=3)r.position[n]=ve.Rn;return{position:r.position,polygons:be(r.polygons,r.position),outlines:_e(r.outlines,r.position),projectionSuccess:i}}function _e(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e.filter((function(e){return e.count>1})).map((function(e){var i=e.index,n=e.count,a=3*i,o=3*n;return(0,f.pC)(r)?new Se(i,n,(0,ye.Rq)(t,a,o),(0,ye.Rq)(r,a,o)):new xe(i,n,(0,ye.Rq)(t,a,o))}))}function be(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=((0,f.pC)(n),new Array),o=(0,i.Z)(e);try{var s=function(){var e=r.value,i=e.index,o=e.count,s=e.holeIndices,l=e.pathLengths;if(o<=1)return"continue";var u=3*i,c=3*o,h=s.map((function(e){return e-i})),d=(0,f.pC)(n)?new Ce(i,o,(0,ye.Rq)(t,3*i,3*o),(0,ye.Rq)(n,u,c),h,l):new Pe(i,o,(0,ye.Rq)(t,3*i,3*o),h,l);a.push(d)};for(o.s();!(r=o.n()).done;)s()}catch(l){o.e(l)}finally{o.f()}return a}var xe=(0,l.Z)((function e(t,r,i){(0,s.Z)(this,e),this.index=t,this.count=r,this.position=i})),Se=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,i,n)).mapPositions=a,o}return(0,l.Z)(r)}(xe),Ce=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a,o,l){var u;return(0,s.Z)(this,r),(u=t.call(this,e,i,n,a)).holeIndices=o,u.pathLengths=l,u}return(0,l.Z)(r)}(Se),Pe=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a,o){var l;return(0,s.Z)(this,r),(l=t.call(this,e,i,n)).holeIndices=a,l.pathLengths=o,l}return(0,l.Z)(r)}(xe),Te=(0,l.Z)((function e(t,r,i,n,a,o){(0,s.Z)(this,e),this.position=t,this.mapPositions=r,this.polygons=i,this.outlines=n,this.projectionSuccess=a,this.sampledElevation=o})),Oe=r(68401),we=r(17579),Ae=r(66327),ke=r(86802),Ee=["polygon","extent"],Re=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,i,n,a)).ensureDrapedStatus(!1),o}return(0,l.Z)(r,[{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,i,n,o,s,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._drivenProperties.size){e.next=4;break}if(!(t=(0,ee.bh)(this._getSymbolSize()))){e.next=4;break}throw new F.Z("graphics3dextrudesymbollayer:invalid-size",t);case 4:r=(0,f.U2)(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(r),n=(0,x.d)(i),o=i[3],s=o<1||this.needsDrivenTransparentPass,l={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:n,ambient:n,opacity:o,transparent:s,cullFace:s?Oe.Vr.None:Oe.Vr.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0},this._material=new ke.Gp(l),this._bottomMaterial=new ke.Gp((0,M.Z)((0,M.Z)({},l),{},{cullFace:Oe.Vr.Back})),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,Ee,this.symbolLayer.type))return null;var r=this._getVertexOpacityAndColor(e.renderingInfo,255),i=this.setGraphicElevationContext(t,new K.o);return this._createAs3DShape(t,e.renderingInfo,r,i,t.uid)}},{key:"layerOpacityChanged",value:function(e,t){var r=this,i=(0,f.U2)(this.symbolLayer,"material","color"),n=this._getCombinedOpacity(i),a=n<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:n,transparent:a}),this._bottomMaterial.setParameters({opacity:n,transparent:a});var o=this._getLayerOpacity();e.forEach((function(e){var i=t(e);(0,f.pC)(i)&&i.layerOpacityChanged(o,r._context.isAsync)}))}},{key:"layerElevationInfoChanged",value:function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Q.B5)}},{key:"slicePlaneEnabledChanged",value:function(e,t){var r=this;return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach((function(e){var i=t(e);(0,f.pC)(i)&&i.slicePlaneEnabledChanged(r._context.slicePlaneEnabled,r._context.isAsync)})),!0}},{key:"physicalBasedRenderingChanged",value:function(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"skipHighSymbolLodsChanged",value:function(){return!0}},{key:"_getExtrusionSize",value:function(e){var t,r;return r=e.size&&this._drivenProperties.size?null!==(t=(0,J.sV)(e.size,2))&&void 0!==t?t:0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters}},{key:"applyRendererDiff",value:function(e,t){return this._drivenPropertiesChanged(t)?te.W.Recreate_Symbol:te.W.Recreate_Graphics}},{key:"queryForSnapping",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,i,n){var o,s,l,u,c,h,d,p,f,v,y;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/(0,V._R)(r),l=t.objectId,u=t.target,c=(0,U.d9)(u),e.t0=(c.z=(null!==(o=c.z)&&void 0!==o?o:0)+s,t.type),e.next="edge"===e.t0?4:"vertex"===e.t0?6:7;break;case 4:return p=t.start,f=t.end,v=(0,U.d9)(p),y=(0,U.d9)(f),e.abrupt("return",(v.z=(null!==(h=v.z)&&void 0!==h?h:0)+s,y.z=(null!==(d=y.z)&&void 0!==d?d:0)+s,[(0,Y.p)(l,c,1/0,v,y)]));case 6:return e.abrupt("return",[(0,Y.u)(l,c,1/0),(0,Y.p)(l,u,1/0,u,c)]);case 7:return e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n){return e.apply(this,arguments)}}()},{key:"_getSymbolSize",value:function(){var e;return null!==(e=this.symbolLayer.size)&&void 0!==e?e:1}},{key:"_createAs3DShape",value:function(e,t,r,i,n){var a=ue(e.geometry);if((0,f.Wi)(a))return null;if(0===a.rings.length||!a.rings.some((function(e){return e.length>0})))return this._logGeometryValidationWarnings(a.rings,"rings","ExtrudeSymbol3DLayer"),null;var o=me(a,this._context.elevationProvider,this._context.renderCoordsHelper,i);this._logGeometryCreationWarnings(o,a.rings,"rings","ExtrudeSymbol3DLayer");var s=(0,ee.zE)(a);if((0,f.Wi)(s))return null;var l=new Array,u=(0,P.Ue)(),c=(0,W.c)(),h=(0,x.c)(),d=this._context.renderCoordsHelper.viewingMode===X.JY.Global;d||this._context.renderCoordsHelper.worldUpAtPosition(null,h),(0,C.Bm)(a.spatialReference,[s.x,s.y,0],c,this._context.renderCoordsHelper.spatialReference);var p=(0,W.c)();(0,H.a)(p,c);var v=(0,B.c)();(0,G.b)(v,p);for(var y=o.polygons,m=o.mapPositions,g=o.position,_=g.length/3,b=new Float64Array(3*_*6),S=new Float64Array(3*_*6),T=new Float64Array(3*_*6),O=new Float64Array(1*_*6),w=0,A=0;A<y.length;++A){var k=y[A],E=k.count;if(!this._context.clippingExtent||((0,P.cS)(u),(0,P.G1)(u,k.mapPositions),(0,P.Zp)(u,this._context.clippingExtent))){var R=(0,N.e)(k.mapPositions,k.holeIndices,3);if(0!==R.length){var L=3*E*2+R.length,I=new Array(L),D=new Array(R.length),M=6*E,z=3*b.BYTES_PER_ELEMENT,F=new j.fP(b.buffer,w*z,z,(w+M)*z),U=3*S.BYTES_PER_ELEMENT,V=new j.fP(S.buffer,w*U,U,(w+M)*U),Y=new Float64Array(T.buffer,3*w*T.BYTES_PER_ELEMENT,3*M),J=new Float64Array(O.buffer,1*w*O.BYTES_PER_ELEMENT,1*M),K=this._getExtrusionSize(t);Ie(g,m,R,k,F.typedBuffer,Y,V.typedBuffer,J,I,D,K,h,d),(0,q.t)(F,F,p),(0,q.a)(V,V,v),w+=6*E;var $=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),te=new $e(F.typedBuffer,Y,V.typedBuffer,J);l.push(Le(this._material,I,I.length-D.length,te,r,$)),l.push(Le(this._bottomMaterial,D,0,te,r,$))}}}if(0===l.length)return null;var re=new Ae.T({geometries:l,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});re.transformation=c;var ie=(0,he.hM)(this.symbolLayer,{opacity:this._getLayerOpacity()}),ne=(0,f.pC)(ie)?{baseMaterial:this._material,edgeMaterials:[ie],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,ae=new Z.z(this,re,l,null,null,He,i,ne);return ae.alignedSampledElevation=o.sampledElevation,ae.needsElevationUpdates=(0,Q.B5)(i.mode),ae}}]),r}($.k);function Le(e,t,r,i,n,a){var o=new Array(t.length).fill(0),s=[[ae.T.POSITION,new re.a(i.positions,3,!0)],[ae.T.NORMAL,new re.a(i.normals,3,!0)],[ae.T.COLOR,new re.a(n,4,!0)],[ae.T.SIZE,new re.a(i.heights,1,!0)]],l=[[ae.T.POSITION,t],[ae.T.NORMAL,t],[ae.T.COLOR,o]];return new ne.Z(e,s,l,i.elevation,ie.U.Mesh,a,r)}function Ie(e,t,r,i,n,a,o,s,l,u,c,h,d){var p=r.length/3,f=0,v=2*i.count;!function(e,t,r,i,n,a,o,s,l,u,c,h,d,p,f,v,y){(0,b.c)(Ye,v);for(var m=f>0?1:-1,g=3*r,_=0,x=3*_,S=i,C=3*S,P=0;P<i;++P)y&&(Ye[0]=e[g+0],Ye[1]=e[g+1],Ye[2]=e[g+2],(0,b.n)(Ye,Ye)),s[x+0]=e[g+0],s[x+1]=e[g+1],s[x+2]=e[g+2],l[x+0]=t[g+0],l[x+1]=t[g+1],l[x+2]=t[g+2],u[x+0]=-m*Ye[0],u[x+1]=-m*Ye[1],u[x+2]=-m*Ye[2],c[_]=0,s[C+0]=e[g+0]+f*Ye[0],s[C+1]=e[g+1]+f*Ye[1],s[C+2]=e[g+2]+f*Ye[2],l[C+0]=t[g+0],l[C+1]=t[g+1],l[C+2]=t[g+2],u[C+0]=m*Ye[0],u[C+1]=m*Ye[1],u[C+2]=m*Ye[2],c[S]=f,x+=3,C+=3,g+=3,_+=1,S+=1;g=3*a,x=0,C=3*p;for(var T=f<0?Qe:Xe,O=f<0?Xe:Qe,w=0;w<o;++w)d[x+0]=n[g+T[0]],d[x+1]=n[g+T[1]],d[x+2]=n[g+T[2]],h[C+0]=n[g+O[0]]+i,h[C+1]=n[g+O[1]]+i,h[C+2]=n[g+O[2]]+i,x+=3,C+=3,g+=3}(e,t,i.index,i.count,r,0,p,n,a,o,s,l,u,v,c,h,d);var y=2*i.count;v=0,Me(n,a,s,o,f,i.pathLengths[0],i.count,y,l,v,c),y+=4*i.pathLengths[0],v+=2*i.pathLengths[0],f+=i.pathLengths[0];for(var m=1;m<i.pathLengths.length;++m)Me(n,a,s,o,f,i.pathLengths[m],i.count,y,l,v,c),y+=4*i.pathLengths[m],v+=2*i.pathLengths[m],f+=i.pathLengths[m]}function Ze(e,t,r,i,n,a,o){i[a]=i[o],o*=3,e[0+(a*=3)]=e[o+0],e[a+1]=e[o+1],e[a+2]=e[o+2],t[a+0]=t[o+0],t[a+1]=t[o+1],t[a+2]=t[o+2],r[a+0]=n[0],r[a+1]=n[1],r[a+2]=n[2]}var De=(0,x.c)();function Me(e,t,r,i,n,a,o,s,l,u,c){var h=n,d=n+1,p=n+o,f=n+o+1,v=s,y=s+1,m=s+2*a,g=s+2*a+1;c<0&&(h=n+o+1,f=n),u*=3;for(var _=0;_<a;++_)_===a-1&&(c>0?(d=n,f=n+o):(d=n,h=n+o)),Ge(e,h,d,p,De),Ze(e,t,i,r,De,v,h),Ze(e,t,i,r,De,y,d),Ze(e,t,i,r,De,m,p),Ze(e,t,i,r,De,g,f),l[u++]=v,l[u++]=m,l[u++]=g,l[u++]=v,l[u++]=g,l[u++]=y,h++,d++,p++,f++,v+=2,y+=2,m+=2,g+=2}var ze=(0,x.c)(),Fe=(0,x.c)(),Ue=(0,x.c)(),Ve=(0,x.c)(),Ne=(0,x.c)();function Ge(e,t,r,i,n){t*=3,r*=3,i*=3,(0,b.s)(ze,e[t++],e[t++],e[t++]),(0,b.s)(Fe,e[r++],e[r++],e[r++]),(0,b.s)(Ue,e[i++],e[i++],e[i++]),(0,b.b)(Ve,Fe,ze),(0,b.b)(Ne,Ue,ze),(0,b.f)(n,Ne,Ve),(0,b.n)(n,n)}var Be=(0,x.c)();function He(e,t,r,i,n){for(var a=e.stageObject,o=a.geometries,s=o.length,l="absolute-height"!==t.mode,u=0,c=a.transformation,h=(0,H.p)((0,W.c)(),c),d=0;d<s;d+=2){var p=o[d];if((0,we.T)(p)){for(var v=p.getMutableAttribute(ae.T.POSITION).data,y=p.vertexAttributes.get(ae.T.SIZE).data,m=new pe.sb(p.mapPositions),g=v.length/3,_=0,x=!1,S=0,C=0;C<g;C++){Be[0]=v[_],Be[1]=v[_+1],Be[2]=v[_+2],i(m,Je),l&&(S+=Je.sampledElevation),de.Z.TESTS_DISABLE_OPTIMIZATIONS?((0,b.s)(qe,m.array[m.offset+0],m.array[m.offset+1],Je.z+y[_/3]),(0,f.pC)(r)&&n.toRenderCoords(qe,r,qe),(0,b.m)(qe,qe,h)):((0,b.s)(qe,v[_+0],v[_+1],v[_+2]),(0,b.m)(qe,qe,c),n.setAltitude(qe,Je.z+y[_/3]),(0,b.m)(qe,qe,h)),v[_]=qe[0],v[_+1]=qe[1],v[_+2]=qe[2];var P=Ke/n.unitInMeters;(Math.abs(Be[0]-v[_])>=P||Math.abs(Be[1]-v[_+1])>=P||Math.abs(Be[2]-v[_+2])>=P)&&(x=!0),m.offset+=3,_+=3}x&&(p.invalidateBoundingInfo(),a.geometryVertexAttrsUpdated(o[d]),o[d+1].invalidateBoundingInfo(),a.geometryVertexAttrsUpdated(o[d+1])),u+=S/g}}return u/s}var We,je,qe=(0,x.c)(),Ye=(0,x.c)(),Je=new Q.Lm,Xe=[0,2,1],Qe=[0,1,2],Ke=.01,$e=(0,l.Z)((function e(t,r,i,n){(0,s.Z)(this,e),this.positions=t,this.elevation=r,this.normals=i,this.heights=n})),et=r(51995),tt=(r(51508),r(17842)),rt=r(35995),it=r(90045),nt=r(67077),at=r(819),ot=r(29122),st=r(74579),lt=r(91935),ut=r(61310),ct=r(52919),ht=r(78289),dt=function(){function e(t,r,i,n){(0,s.Z)(this,e),this.graphics3DSymbolLayer=t,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=n,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}return(0,l.Z)(e,[{key:"initialize",value:function(e){this.stage=e}},{key:"setVisibility",value:function(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,ht.T.ADD);if(e||this._addedToStage){var t,r=(0,i.Z)(this.renderGeometries);try{for(r.s();!(t=r.n()).done;){t.value.visible=this._visible}}catch(n){r.e(n)}finally{r.f()}this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ht.$.VISIBILITY)}}}},{key:"destroy",value:function(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,ht.T.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}},{key:"getCenterObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,x.c)();return(0,b.s)(e,0,0,0)}},{key:"getBoundingBoxObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,P.Ue)();return(0,P.cS)(e)}},{key:"addObjectState",value:function(e,t){var r=this;e===Oe.V_.Highlight&&(this.renderGeometries.forEach((function(e){var i=e.geometry.addHighlight();t.addRenderGeometry(e,i,r)})),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ht.$.HIGHLIGHT))}},{key:"removeObjectState",value:function(e){this.renderGeometries.forEach((function(t){e.removeRenderGeometry(t)}))}},{key:"removeRenderGeometryObjectState",value:function(e,t){e.geometry.removeHighlight(t),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ht.$.HIGHLIGHT)}},{key:"computeAttachmentOrigin",value:function(e){var t,r=(0,i.Z)(this.renderGeometries);try{for(r.s();!(t=r.n()).done;){t.value.geometry.computeAttachmentOrigin(vt)&&(e.draped.origin[0]+=vt[0],e.draped.origin[1]+=vt[1],e.draped.num++)}}catch(n){r.e(n)}finally{r.f()}}},{key:"getProjectedBoundingBox",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,i,n,o){var s,l,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for((0,P.cS)(o),s=0;s<this.renderGeometries.length;s++)l=this.renderGeometries[s],this._getRenderGeometryProjectedBoundingRect(l,t,pt,i),(0,P.VK)(o,pt);if(!r){e.next=14;break}return(0,P.be)(o,vt),c=(0,ee.Si)(o,r.service.spatialReference,r),e.prev=5,e.next=8,r.service.queryElevation(vt[0],vt[1],n,c,"ground");case 8:u=e.sent,e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:(0,f.pC)(u)&&(o[2]=Math.min(o[2],u),o[5]=Math.max(o[5],u));case 14:return e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(t,r,i,n,a){return e.apply(this,arguments)}}()},{key:"_getRenderGeometryProjectedBoundingRect",value:function(e,t,r,i){if(this.boundingBox)(0,P.t8)(ft,this.boundingBox);else{var n=e.boundingSphere,a=n[3];ft[0]=n[0]-a,ft[1]=n[1]-a,ft[2]=n[2]-a,ft[3]=n[0]+a,ft[4]=n[1]+a,ft[5]=n[2]+a}return t(ft,0,2),this.calculateRelativeScreenBounds&&i.push({location:(0,P.be)(ft),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),(0,P.y8)(ft,r)}}]),e}(),pt=(0,T.Ue)(),ft=(0,P.Ue)(),vt=(0,x.c)(),yt=r(31908),mt=r(36759),gt=r(16889),_t=r(49229);function bt(e){return null!=e}function xt(e){return"number"==typeof e}function St(e){return"string"==typeof e}function Ct(e,t){e&&e.push(t)}function Pt(e,t,r,i,n){var a=e.minSize,o=e.maxSize;if(e.expression)return Ct(n,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){var s=i.symbolSize[r];return t.minSize[r]=s,t.maxSize[r]=s,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=We.DefinedSize,!0}if(bt(e.field))return bt(e.stops)?2===e.stops.length&&xt(e.stops[0].size)&&xt(e.stops[1].size)?(Tt(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=We.DefinedSize,!0):(Ct(n,"Could not convert size info: stops only supported with 2 elements"),!1):xt(a)&&xt(o)&&bt(e.minDataValue)&&bt(e.maxDataValue)?(Tt(a,o,e.minDataValue,e.maxDataValue,t,r),t.type[r]=We.DefinedSize,!0):null!=_t.a[e.valueUnit]?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/_t.a[e.valueUnit],t.type[r]=We.DefinedSize,!0):"unknown"===e.valueUnit?(Ct(n,"Could not convert size info: proportional size not supported"),!1):(Ct(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!bt(e.field)){if(e.stops&&e.stops[0]&&xt(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=We.DefinedSize,!0;if(xt(a))return t.minSize[r]=a,t.maxSize[r]=a,t.offset[r]=a,t.factor[r]=0,t.type[r]=We.DefinedSize,!0}return Ct(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Tt(e,t,r,i,n,a){var o=Math.abs(i-r)>0?(t-e)/(i-r):0;n.minSize[a]=o>0?e:t,n.maxSize[a]=o>0?t:e,n.offset[a]=e-r*o,n.factor[a]=o}function Ot(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return Ct(i,"Could not convert size info: unsupported property"),null;if(!function(e){return null==e||St(e)}(e.field))return Ct(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return Ct(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[We.Undefined,We.Undefined,We.Undefined]};var n;switch(e.axis){case"width":return(n=Pt(e,t.size,0,r,i))?t:null;case"height":return(n=Pt(e,t.size,2,r,i))?t:null;case"depth":return(n=Pt(e,t.size,1,r,i))?t:null;case"width-and-depth":return(n=Pt(e,t.size,0,r,i))&&Pt(e,t.size,1,r,i),n?t:null;case null:case void 0:case"all":return(n=(n=(n=Pt(e,t.size,0,r,i))&&Pt(e,t.size,1,r,i))&&Pt(e,t.size,2,r,i))?t:null;default:return Ct(i,'Could not convert size info: unknown axis "'.concat(e.axis,'""')),null}}function wt(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function At(e,t,r){var i=2===r&&"arithmetic"===e.rotationType;t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}function kt(e,t,r){if(!e)return null;var i=!t.supportedTypes||!!t.supportedTypes.size,n=!t.supportedTypes||!!t.supportedTypes.color,a=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,s=e.reduce((function(e,s){if(!e)return e;if(s.valueExpression)return Ct(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(s.type){case"size":return i?Ot(s,e,t,r):e;case"color":return n?function(e,t,r){if(e.normalizationField)return Ct(r,"Could not convert color info: unsupported property"),null;if(St(e.field)){if(!e.stops)return Ct(r,"Could not convert color info: missing stops or colors"),null;if(e.stops.length>8)return Ct(r,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(var i=e.stops,n=0;n<8;++n){var a=i[Math.min(n,i.length-1)];t.color.values[n]=a.value,wt(t.color.colors,n,a.color)}}else{if(!(e.stops&&e.stops.length>=0))return Ct(r,"Could not convert color info: no field and no colors/stops"),null;var o=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(var s=0;s<8;s++)t.color.values[s]=1/0,wt(t.color.colors,s,o)}return t}(s,e,r):e;case"opacity":return o?function(e,t,r){if(e.normalizationField)return Ct(r,"Could not convert opacity info: unsupported property"),null;if(St(e.field)){if(!e.stops)return Ct(r,"Could not convert opacity info: missing stops or opacities"),null;if(e.stops.length>8)return Ct(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(var i=e.stops,n=0;n<8;++n){var a=i[Math.min(n,i.length-1)];t.opacity.values[n]=a.value,t.opacity.opacityValues[n]=a.opacity}}else{if(!(e.stops&&e.stops.length>=0))return Ct(r,"Could not convert opacity info: no field and no opacities/stops"),null;var o=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(var s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=o}return t}(s,e,r):null;case"rotation":return a?function(e,t,r){if(!St(e.field))return Ct(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return Ct(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return At(e,t.rotation,0),t;case"roll":return At(e,t.rotation,1),t;case null:case void 0:case"heading":return At(e,t.rotation,2),t;default:return Ct(r,'Could not convert rotation info: unknown axis "'.concat(e.axis,'""')),null}}(s,e,r):e;default:return null}}),{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&s)||s.size||s.color||s.opacity||s.rotation?s&&s.size&&!function(e,t,r){for(var i=0;i<3;++i){var n=t.unitInMeters;e.type[i]===We.DefinedSize&&(n*=t.modelSize[i],e.type[i]=We.DefinedScale),e.minSize[i]=e.minSize[i]/n,e.maxSize[i]=e.maxSize[i]/n,e.offset[i]=e.offset[i]/n,e.factor[i]=e.factor[i]/n}var a;if(e.type[0]!==We.Undefined)a=0;else if(e.type[1]!==We.Undefined)a=1;else{if(e.type[2]===We.Undefined)return Ct(r,"No size axis contains a valid size or scale"),!1;a=2}for(var o=0;o<3;++o)e.type[o]===We.Undefined&&(e.minSize[o]=e.minSize[a],e.maxSize[o]=e.maxSize[a],e.offset[o]=e.offset[a],e.factor[o]=e.factor[a],e.type[o]=e.type[a]);return!0}(s.size,t,r)?null:s:null}function Et(e){return e&&null!=e.size}function Rt(e,t){if(!e)return{enabled:!1};if(de.Z.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};var r=kt(e.visualVariables,t);return r?{enabled:!0,visualVariables:r,materialParameters:Zt(r,t),requiresShaderTransformation:Et(r)}:{enabled:!1}}function Lt(e,t,r){if(!t||!e.enabled)return!1;var i=e.visualVariables,n=kt(t.visualVariables,r);return!!n&&!!(It(i.size,n.size,"size")&&It(i.color,n.color,"color")&&It(i.rotation,n.rotation,"rotation")&&It(i.opacity,n.opacity,"opacity"))&&(e.visualVariables=n,e.materialParameters=Zt(n,r),e.requiresShaderTransformation=Et(n),!0)}function It(e,t,r){if(!!e!=!!t)return!1;if(e&&e.field!==t.field)return!1;if(e&&"rotation"===r)for(var i=e,n=t,a=0;a<3;a++)if(i.type[a]!==n.type[a]||i.offset[a]!==n.offset[a]||i.factor[a]!==n.factor[a])return!1;return!0}function Zt(e,t){var r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},i=Et(e);return e&&e.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=e.size.minSize,r.vvSizeMaxSize=e.size.maxSize,r.vvSizeOffset=e.size.offset,r.vvSizeFactor=e.size.factor):e&&i&&(r.vvSizeValue=t.transformation.scale),e&&i&&(r.vvSymbolAnchor=t.transformation.anchor,r.vvSymbolRotationMatrix=(0,B.c)(),(0,H.i)(Ut),function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,W.c)(),n=e||0,a=t||0,o=r||0;0!==n&&(0,H.o)(i,i,-n/180*Math.PI),0!==a&&(0,H.r)(i,i,a/180*Math.PI),0!==o&&(0,H.n)(i,i,o/180*Math.PI)}(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],Ut),(0,G.f)(r.vvSymbolRotationMatrix,Ut)),e&&e.color&&(r.vvColorEnabled=!0,r.vvColorValues=e.color.values,r.vvColorColors=e.color.colors),e&&e.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=e.opacity.values,r.vvOpacityOpacities=e.opacity.opacityValues),r}function Dt(e,t,r){if(!e.vvSizeEnabled)return r;(0,H.c)(zt,r);var i=e.vvSymbolRotationMatrix;(0,H.s)(Ut,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),(0,H.m)(zt,zt,Ut);for(var n=0;n<3;++n){var a=e.vvSizeOffset[n]+t[0]*e.vvSizeFactor[n];Ft[n]=(0,gt.uZ)(a,e.vvSizeMinSize[n],e.vvSizeMaxSize[n])}return(0,H.k)(zt,zt,Ft),(0,H.w)(zt,zt,e.vvSymbolAnchor),zt}function Mt(e,t,r){if(!t.vvSizeEnabled)return(0,b.s)(e,1,1,1);for(var i=0;i<3;++i){var n=t.vvSizeOffset[i]+r[0]*t.vvSizeFactor[i];e[i]=(0,gt.uZ)(n,t.vvSizeMinSize[i],t.vvSizeMaxSize[i])}return e}!function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"}(We||(We={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(je||(je={}));var zt=(0,W.c)(),Ft=(0,x.c)(),Ut=(0,W.c)(),Vt=r(67794),Nt=r(70619),Gt=r(39077),Bt=r(1487),Ht=r(21400),Wt=r(75021),jt=(0,W.c)(),qt=(0,x.f)(0,0,1),Yt=Vt.Ns,Jt=[Yt/2,Yt/2,1-Yt/2,1-Yt/2],Xt=[Vt.Ph*Yt,Vt.Ph*Yt],Qt=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e,r,i,a){var o;return(0,s.Z)(this,n),(o=t.call(this,e,r,i,a))._cimLayers=null,o._cimSymbolMaterials=new Map,o._cimSymbolTextures=new Map,o._cimMaterialParametersInfo=null,o._cimRequiredFields=null,o._cimScaleFactorOrFunction=null,o._size=null,o._symbolTextureRatio=1,o._outlineSize=0,o._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0},o}return(0,l.Z)(n,[{key:"getCachedSize",value:function(){return{size:this._getIconSize()}}},{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,i,n,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._validateOrThrow(),r=this._prepareMaterialParameters(),i=this._getPrimitive(),!(0,f.pC)(i)){e.next=6;break}this._prepareResourcesPrimitive(r,i),e.next=14;break;case 6:if(n=(0,st.nf)(this.symbolLayer),!(o=(0,rt.sJ)(n))||"application/json"!==o.mediaType){e.next=12;break}return e.next=10,this._prepareResourcesCIM(r,JSON.parse(o.data),t);case 10:e.next=14;break;case 12:return e.next=14,this._prepareResourcesHref(r,n,t);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_validateOrThrow",value:function(){if(!this._drivenProperties.size){var e=(0,ee.bh)(this._getIconSize());if(e)throw new F.Z("graphics3diconsymbollayer:invalid-size",e)}}},{key:"_getIconSize",value:function(){var e=this.symbolLayer,t=Math.round(null!=e.size?(0,tt.F2)(e.size):16);return this._drivenProperties.size?Math.max(t,64):t}},{key:"_generateTextureCIM",value:function(e){var t=this._getGraphicHash(e),r=""===t?null:this._cimSymbolTextures.get(t);if(!r){var i={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",i,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);var a={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:Oe.CE.PAD};r=new Bt.x(n.imageData,a),this._cimSymbolTextures.set(t,r),this._context.stage.add(r)}return r}},{key:"_computeSize",value:function(e,t){var r=e.width/e.height;return r>1?[t,Math.round(t/r)]:[Math.round(t*r),t]}},{key:"_prepareMaterialParameters",value:function(){var e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},t=this.symbol;if(function(e){return e&&"point-3d"===e.type&&e.hasVisibleVerticalOffset()}(t)){var r=t.verticalOffset,i=r.screenLength,n=r.minWorldLength,a=r.maxWorldLength;e.verticalOffset={screenLength:(0,tt.F2)(i),minWorldLength:n||0,maxWorldLength:(0,f.pC)(a)?a:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}},{key:"_prepareResourcesPrimitive",value:function(e,t){var r=this._getOutlineSize();if(Kt(t)&&0===r)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,(0,f.pC)(this._context.sharedResources.textures)){var i=this._context.sharedResources.textures.fromData("".concat(t,"-icon"),(function(){return(0,Vt.cU)(t)}));this._texture=i.texture,this._releaseTexture=i,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=Jt;var n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/Yt,this._createMaterialAndAddToStage(e,this._context.stage)}},{key:"_prepareResourcesHref",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,i){var n,o,s,l,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1,n=this._getIconSize(),o=n*this._context.graphicsCoreOwner.view.state.rasterPixelRatio,!(0,f.pC)(this._context.sharedResources.textures)){e.next=12;break}return e.next=5,(0,p.q6)(this._context.sharedResources.textures.fromUrl(r,o,{signal:i}));case 5:if(!1!==(s=e.sent).ok){e.next=9;break}throw(0,v.r9)(s.error),new F.Z("graphics3diconsymbollayer:request-failed","Failed to load (Request for icon resource failed: ".concat(r,")"));case 9:this._releaseTexture=s.value,l=s.value.texture,u=l.params,this._size=this._computeSize(u,n),t.textureId=l.id;case 12:this._createMaterialAndAddToStage(t,this._context.stage);case 13:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_prepareResourcesCIM",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,i,n){var o,s,l,u,c,h,d,p,f,y;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=new Wt.Z({data:i}),this._context.sharedResources.cimSymbolRasterizer){e.next=6;break}return e.next=4,Promise.all([r.e(9795),r.e(98991),r.e(64893),r.e(28920),r.e(69655)]).then(r.bind(r,94304));case 4:s=e.sent.CIMSymbolRasterizer,(0,v.k_)(n),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new s(this._context.renderCoordsHelper.spatialReference,!0));case 6:return l=this._context.layer.fields?this._context.layer.fields.map((function(e){return e.toJSON()})):null,e.next=9,this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(o,l,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:n});case 9:if(this._cimLayers=e.sent,!this._context.renderer||"dictionary"!==this._context.renderer.type||!this._context.renderer.scaleExpression){e.next=21;break}if(h=this._context.renderer,!isNaN(h.scaleExpression)){e.next=20;break}return d=h.scaleExpression,e.next=16,(0,at.Yi)(d,this._context.layer.spatialReference,l);case 16:p=e.sent,c=function(e,t,r){var i=(0,lt.Z)(p,e,{$view:r},"esriGeometryPoint",t);return null!==i?i:1},e.next=21;break;case 20:u=Number(h.scaleExpression);case 21:if(this._cimScaleFactorOrFunction=u||c||1,!this._context.renderer){e.next=28;break}return e.next=25,this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex);case 25:e.t0=e.sent,e.next=29;break;case 28:e.t0=[];case 29:f=e.t0,(0,v.k_)(n),y=this._context.layer.fieldsIndex,this._cimRequiredFields=f.map((function(e){return y.get(e).name})),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1;case 33:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_getPrimitive",value:function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||ot.S}},{key:"_getOutlineSize",value:function(){var e,t=this.symbolLayer;return(0,f.pC)(t.outline)&&null!=t.outline.size?Math.max((0,tt.F2)(t.outline.size),0):(e=Kt(this._getPrimitive())?1.5:0,Math.max(e,0))}},{key:"_getOutlineColor",value:function(){var e=this._getLayerOpacity(),t=this.symbolLayer,r=(0,f.U2)(t,"outline","color");if((0,f.pC)(r)){var i=et.Z.toUnitRGB(r),n=r.a*e;return[i[0],i[1],i[2],n]}return[0,0,0,0]}},{key:"_getFillColor",value:function(){if(Kt(this._getPrimitive()))return ut.r;var e=(0,f.Wi)(this._getPrimitive()),t=(0,f.U2)(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}},{key:"_getAnchorPos",value:function(e,t){return"relative"===e?(0,_.f)((t.x||0)+.5,.5-(t.y||0)):e in yt.yY?yt.yY[e]:yt.yY.center}},{key:"_createMaterialAndAddToStage",value:function(e,t){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=Rt(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){var r=(0,f.pC)(e.textureId)?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new Ht.A(e),this._cimSymbolMaterials.set((0,f.Pt)(e.textureId,0),r),t.add(r)),r}return this._material=new Ht.A(e),t.add(this._material),this._material}},{key:"_setDrapingDependentMaterialParameters",value:function(){var e=this;this.draped&&(this._forEachMaterial((function(t){t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:e.draped})})),this.layerOpacityChanged())}},{key:"destroy",value:function(){var e=this;(0,u.Z)((0,c.Z)(n.prototype),"destroy",this).call(this),this._forEachMaterial((function(t){return e._context.stage.remove(t)})),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach((function(t){return e._context.stage.remove(t)})),this._cimSymbolTextures.clear(),this._releaseTexture=(0,f.RY)(this._releaseTexture)}},{key:"_getScaleFactor",value:function(e,t){if(this._drivenProperties.size&&e.size){for(var r=0;r<3;r++){var i=e.size[r];i&&"symbol-value"!==i&&"proportional"!==i&&(e.size[r]=(0,tt.F2)(i))}if("symbol-value"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/t;if(isFinite(+e.size[2]))return+e.size[2]/t}return 1}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry))return null;var r,i=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;var n=this._generateTextureCIM(t),a=(0,M.Z)({textureId:n.id},this._cimMaterialParametersInfo);r=this._createMaterialAndAddToStage(a,this._context.stage),i=[n.params.width,n.params.height]}else i=this._size,r=(0,f.Wg)(this._material);var o=(0,mt.S_)(t.geometry);if((0,f.Wi)(o))return this.logger.warn("unsupported geometry type for icon symbol: ".concat(t.geometry.type)),null;var s=e.renderingInfo,l=this._getVertexOpacityAndColor(s),u=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){var c=i[0]>i[1]?i[0]:i[1];u=this._getScaleFactor(s,c)}u*=this._symbolTextureRatio;var h=(0,_.f)(i[0]*u,i[1]*u),d=this.setGraphicElevationContext(t,new K.o);return this.ensureDrapedStatus("on-the-ground"===d.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(t,o,r,l,h,e.layer.uid):this._createAs3DShape(t,o,r,l,h,d,t.uid)}},{key:"layerOpacityChanged",value:function(){var e=this._getFillColor(),t=this._getOutlineColor();this._forEachMaterial((function(r){r.setParameters({color:e}),r.setParameters({outlineColor:t})}))}},{key:"layerElevationInfoChanged",value:function(e,t,r){var i=this._elevationContext.mode,a=(0,Q.GC)(n.elevationModeChangeTypes,r,i);if(a!==Q.lO.UPDATE)return a;var o=(0,Q.Xf)(i)||"absolute-height"===i;return this.updateGraphics3DGraphicElevationInfo(e,t,(function(){return o}))}},{key:"slicePlaneEnabledChanged",value:function(){var e=this;return this.draped||this._forEachMaterial((function(t){t.setParameters({hasSlicePlane:e._context.slicePlaneEnabled})})),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"pixelRatioChanged",value:function(){return!!this._getPrimitive()}},{key:"skipHighSymbolLodsChanged",value:function(){return!0}},{key:"applyRendererDiff",value:function(e,t){for(var r in e.diff){if("visualVariables"!==r)return te.W.Recreate_Symbol;if(!Lt(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return te.W.Recreate_Symbol;(0,f.pC)(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return te.W.Fast_Update}},{key:"_defaultElevationInfoNoZ",value:function(){return $t}},{key:"_createAs3DShape",value:function(e,t,r,i,n,a,o){var s=this,l=this.getFastUpdateAttrValues(e),u=l?function(e){return Dt(s._fastUpdates.materialParameters,l,e)}:void 0,c=this._context.layer.uid,h=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:o,layerUid:c}),d=(0,Nt.dV)(r,qt,null,i,n,er,null,l,h),p=(0,mt.ZC)(this._context,t,d,a,o,u);if((0,f.Wi)(p))return null;var v=new Z.z(this,p.object,[d],null,null,ct.j3,a);return v.alignedSampledElevation=p.sampledElevation,v.needsElevationUpdates=(0,Q.Xf)(a.mode)||"absolute-height"===a.mode,v.getScreenSize=this._createScreenSizeGetter(n,u),v.calculateRelativeScreenBounds=function(e){return r.calculateRelativeScreenBounds(v.getScreenSize(),1,e)},(0,mt.dO)(v,t,this._context.elevationProvider),v}},{key:"_createAsOverlay",value:function(e,t,r,i,n,a){var o=this;r.renderPriority=this._renderPriority;var s=(0,nt.c)();(0,C.KC)(t,s,this._context.overlaySR),s[2]=ve.Rn;var l=this._context.clippingExtent;if((0,f.pC)(l)&&!(0,P.BD)(l,s))return null;var u=this.getFastUpdateAttrValues(e),c=u?function(e){return Dt(o._fastUpdates.materialParameters,u,e)}:void 0,h=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),d=(0,Nt.dV)(r,qt,s,i,n,null,null,u,h),p=new Gt.z(d,{layerUid:a,graphicUid:e.uid,shaderTransformer:c});s[3]=0,(0,it.c)(p.boundingSphere,s);var v=new dt(this,[p],null,this._context.drapeSourceRenderer);return v.getScreenSize=this._createScreenSizeGetter(n,c),v.calculateRelativeScreenBounds=function(e){return r.calculateRelativeScreenBounds(v.getScreenSize(),1,e)},v}},{key:"_createScreenSizeGetter",value:function(e,t){var r=this._outlineSize+2;if(this._fastUpdates.enabled){var i=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_.a)(),a=t(jt);return e[0]=a[0]*i+r,e[1]=a[5]*n+r,e}}var a=e[0]/this._symbolTextureRatio+r,o=e[1]/this._symbolTextureRatio+r;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_.a)();return e[0]=a,e[1]=o,e}}},{key:"_fastVisualVariableConvertOptions",value:function(){var e=this._size[0]>this._size[1]?this._size[0]:this._size[1],t=(0,x.f)(e,e,e),r=(0,tt.Wz)(1),i=e*r;return{modelSize:t,symbolSize:(0,x.f)(i,i,i),unitInMeters:r,transformation:{anchor:x.Z,scale:x.O,rotation:x.Z}}}},{key:"_getGraphicHash",value:function(e){var t,r="",n=(0,i.Z)(this._cimRequiredFields);try{for(n.s();!(t=n.n()).done;){var a=t.value;r+=a+e.attributes[a]}}catch(o){n.e(o)}finally{n.f()}return r}},{key:"_forEachMaterial",value:function(e){(0,f.pC)(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}},{key:"test",value:function(){return(0,M.Z)((0,M.Z)({},(0,u.Z)((0,c.Z)(n.prototype),"test",this).call(this)),{},{material:this._material})}}]),n}($.k);function Kt(e){return!(0,f.Wi)(e)&&("cross"===e||"x"===e)}Qt.PRIMITIVE_SIZE=Xt,Qt.elevationModeChangeTypes={definedChanged:Q.lO.UPDATE,staysOnTheGround:Q.lO.NONE,onTheGroundChanged:Q.lO.RECREATE};var $t={mode:"relative-to-ground",offset:0},er=(0,nt.f)(0,0,0,1),tr=r(737);function rr(e){switch(e){case"butt":return tr.R.BUTT;case"square":return tr.R.SQUARE;case"round":return tr.R.ROUND;default:return null}}function ir(e){return"diamond"===e?"kite":e}var nr,ar=r(79685),or=r(2522),sr=r(78081),lr=r(21317),ur=r(86700),cr=r(58901),hr=["polyline","polygon","extent"],dr=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a){return(0,s.Z)(this,r),t.call(this,e,i,n,a)}return(0,l.Z)(r,[{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=Rt(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},this._drivenProperties.size){e.next=3;break}if(!((null!=this.symbolLayer.size?this.symbolLayer.size:(0,tt.Wz)(1))<0)){e.next=3;break}throw new F.Z("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");case 3:this._markerTexture=(0,f.pC)(this.symbolLayer.marker)&&(0,f.pC)(this._context.sharedResources.textures)?(0,or.uM)(this._context.sharedResources.textures,ir(this.symbolLayer.marker.style)):null;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getMaterialParameters",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);var n={width:this._computeMaterialWidth(null===(t=this.symbolLayer)||void 0===t?void 0:t.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:rr(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:(0,ur.Dp)(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?(0,M.Z)((0,M.Z)({},n),this._fastUpdates.materialParameters):n}},{key:"_materialColor",get:function(){return(0,f.yw)(this.symbolLayer.material,(function(e){return e.color}))}},{key:"_markerColor",get:function(){return(0,f.yw)(this.symbolLayer.marker,(function(e){return e.color}))}},{key:"_lineMaterial",get:function(){return(0,f.Wi)(this._lineMaterialCached)&&(this._lineMaterialCached=new cr.U(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}},{key:"_ringMaterial",get:function(){return(0,f.Wi)(this._ringMaterialCached)&&(this._ringMaterialCached=new cr.U(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}},{key:"_wireframeLineMaterial",get:function(){return(0,f.Wi)(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new cr.U((0,M.Z)((0,M.Z)({},this._getMaterialParameters(!1)),{},{wireframe:!0})),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}},{key:"_wireframeRingMaterial",get:function(){return(0,f.Wi)(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new cr.U((0,M.Z)((0,M.Z)({},this._getMaterialParameters(!0)),{},{wireframe:!0})),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}},{key:"_markerMaterial",get:function(){return(0,f.Wi)(this._markerMaterialCached)&&(0,f.pC)(this.symbolLayer.marker)&&(0,f.pC)(this._markerTexture)&&(this._markerMaterialCached=new lr.X((0,M.Z)((0,M.Z)({},this._getMaterialParameters(!1,!0)),{},{placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id})),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}},{key:"destroy",value:function(){var e=this;(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._forEachMaterial((function(t){return e._context.stage.remove(t)})),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null,this._markerTexture=(0,f.RY)(this._markerTexture)}},{key:"_getDrivenSize",value:function(e){return this._drivenProperties.size&&e.size?(0,tt.F2)((0,J.o2)(e.size)):1}},{key:"_getSizeFeatureAttributeData",value:function(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?(0,$.d)(this._fastUpdates.visualVariables.size.field,e):null}},{key:"_getDrivenColor",value:function(e){var t=(0,nt.f)(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t}},{key:"_getColorFeatureAttributeData",value:function(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?(0,$.d)(this._fastUpdates.visualVariables.color.field,e):null}},{key:"_getOpacityFeatureAttributeData",value:function(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?(0,$.d)(this._fastUpdates.visualVariables.opacity.field,e):null}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,hr,this.symbolLayer.type))return null;var r=this.setGraphicElevationContext(t,new K.o);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,t.uid)}},{key:"applyRendererDiff",value:function(e,t){var r=this;for(var i in e.diff){if("visualVariables"!==i)return te.W.Recreate_Symbol;if(!Lt(this._fastUpdates,t,this._vvConvertOptions))return te.W.Recreate_Symbol;this._forEachMaterial((function(e){return e.setParameters(r._fastUpdates.materialParameters)}))}return te.W.Fast_Update}},{key:"prepareSymbolLayerPatch",value:function(e){var t,r,i=this;if("partial"===e.diff.type){var n=e.diff.diff,a={};"complete"===(null===(t=n.size)||void 0===t?void 0:t.type)&&(a.width=this._computeMaterialWidth(n.size.newValue),delete n.size),"complete"===(null===(r=n.cap)||void 0===r?void 0:r.type)&&(a.cap=rr((0,f.Pt)(n.cap.newValue,"butt")),delete n.cap);var o=this._prepareMarkerPatch(e,n);this._prepareMaterialPatch(e,n,o),e.symbolLayerStatePatches.push((function(){return i._forEachMaterial((function(e){return e.setParameters(a)}))}))}}},{key:"layerOpacityChanged",value:function(){var e=this;this._forEachMaterial((function(t,r){return e._updateMaterialLayerOpacity(t,r)}))}},{key:"_forEachMaterial",value:function(e){(0,f.pC)(this._lineMaterialCached)&&e(this._lineMaterialCached),(0,f.pC)(this._ringMaterialCached)&&e(this._ringMaterialCached),(0,f.pC)(this._wireframeLineMaterialCached)&&e(this._wireframeLineMaterialCached),(0,f.pC)(this._wireframeRingMaterialCached)&&e(this._wireframeRingMaterialCached),(0,f.pC)(this._markerMaterialCached)&&e(this._markerMaterialCached,!0)}},{key:"_updateMaterialLayerOpacity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.parameters.color,i=(0,f.U2)(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!t?0:this._getCombinedOpacity(i),a=(0,nt.f)(r[0],r[1],r[2],n);e.setParameters({color:a})}},{key:"layerElevationInfoChanged",value:function(e,t,i){var n=this._elevationContext.mode,a=(0,Q.GC)(r.elevationModeChangeTypes,i,n);if(a!==Q.lO.UPDATE)return a;var o=(0,Q.Xf)(n);return this.updateGraphics3DGraphicElevationInfo(e,t,(function(){return o}))}},{key:"slicePlaneEnabledChanged",value:function(){var e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial((function(t){return t.setParameters(e)})),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"skipHighSymbolLodsChanged",value:function(){return!0}},{key:"_getGeometryAsPolygonOrPolyline",value:function(e){switch(e.type){case"extent":if(e instanceof oe.Z)return S.Z.fromExtent(e);break;case"polygon":case"polyline":return e}return null}},{key:"_createAs3DShape",value:function(e,t,r){var i=e.graphic,n=this._getGeometryAsPolygonOrPolyline(i.geometry),a="polygon"===n.type?n.rings:n.paths,o=new Array,s=(0,P.Ue)(),l=(0,sr.V)(n,this._context.elevationProvider,this._context.renderCoordsHelper,t),u="polygon"===n.type?"rings":"paths";this._logGeometryCreationWarnings(l,a,u,"LineSymbol3DLayer");for(var c=0;c<l.lines.length;c++){var h=l.lines[c],d=h.position,p=h.mapPositions;if(!(0,f.pC)(this._context.clippingExtent)||((0,P.cS)(s),(0,P.G1)(s,p),(0,P.Zp)(s,this._context.clippingExtent))){var v=this._createGeometry("polygon"===n.type?this._ringMaterial:this._lineMaterial,e,d,p,n.type,nr.ELEVATED,r);o.push(v),de.Z.LINE_WIREFRAMES&&o.push(v.instantiate({material:"polygon"===n.type?this._wireframeRingMaterial:this._wireframeLineMaterial})),(0,f.pC)(this._markerMaterial)&&o.push(v.instantiate({material:this._markerMaterial}))}}if(0===o.length)return null;var y=new Ae.T({geometries:o,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),m=new Z.z(this,y,o,null,null,ct.Lz,t);return m.alignedSampledElevation=l.sampledElevation,m.needsElevationUpdates=(0,Q.Xf)(t.mode),m}},{key:"_createGeometry",value:function(e,t,r,i,n,a,o){var s="polygon"===n,l=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,u=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size,c=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:o,layerUid:this._context.layer.uid});return(0,ar.Y)(e,{overlayInfo:a===nr.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:s,mapPositions:i,attributeData:{position:r,size:u?null:this._getDrivenSize(t.renderingInfo),color:l?null:this._getDrivenColor(t.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(t.graphic),colorFeature:this._getColorFeatureAttributeData(t.graphic),opacityFeature:this._getOpacityFeatureAttributeData(t.graphic)}},c)}},{key:"_createAsOverlay",value:function(e,t){var r=this,n=e.graphic,a=this._getGeometryAsPolygonOrPolyline(n.geometry),o="polygon"===a.type?a.rings:a.paths,s="polygon"===a.type?this._ringMaterial:this._lineMaterial;s.renderPriority=this._renderPriority;var l=de.Z.LINE_WIREFRAMES?"polygon"===a.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,u=this._markerMaterial;(0,f.pC)(l)&&(l.renderPriority=this._renderPriority-.001),(0,f.pC)(u)&&(u.renderPriority=this._renderPriority-.002);var c=new Array,h=(0,P.Ue)(),d=(0,P.cS)(),p=(0,sr.r)(a,this._context.overlaySR),v="polygon"===a.type?"rings":"paths";this._logGeometryCreationWarnings(p,o,v,"LineSymbol3DLayer");var y,m=(0,i.Z)(p.lines);try{var g=function(){var i=y.value;if((0,P.cS)(h),(0,P.G1)(h,i.position),!(0,P.Zp)(h,r._context.clippingExtent))return"continue";(0,P.TC)(d,h);var o=function(o){var s=r._createGeometry(o,e,i.position,void 0,a.type,nr.DRAPED,n.uid),l=new Gt.z(s,{layerUid:t,graphicUid:n.uid});return c.push(l),l};if((0,f.pC)(u)){var p=o(u),v=(0,f.Wg)(r.symbolLayer.marker).placement;"begin"!==v&&"begin-end"!==v||(0,P.G1)(h,i.position,0,1),"end"!==v&&"begin-end"!==v||(0,P.G1)(h,i.position,i.position.length-3,1),r._updateBoundingSphere(p,h)}var m=o(s);if(r._updateBoundingSphere(m,h),de.Z.LINE_WIREFRAMES){var g=o(l);r._updateBoundingSphere(g,h)}};for(m.s();!(y=m.n()).done;)g()}catch(_){m.e(_)}finally{m.f()}return new dt(this,c,d,this._context.drapeSourceRenderer)}},{key:"_updateBoundingSphere",value:function(e,t){(0,it.s)(e.boundingSphere,.5*(t[0]+t[3]),.5*(t[1]+t[4]),0,.5*Math.sqrt((t[3]-t[0])*(t[3]-t[0])+(t[4]-t[1])*(t[4]-t[1])))}},{key:"_patternHidesLine",get:function(){var e=this.symbolLayer.pattern;return(0,f.pC)(e)&&"style"===e.type&&"none"===e.style}},{key:"_computeMaterialWidth",value:function(e){return e=(0,f.Pt)(e,(0,tt.Wz)(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?(0,tt.F2)(1):1:(0,tt.F2)(e)}},{key:"_prepareMaterialPatch",value:function(e,t,r){var i,n=t.material;if((0,f.Wi)(n))r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e);else if("collection"!==n.type){var a="complete"===n.type?(0,f.yw)(n.newValue,(function(e){return e.color})):"complete"===(null===(i=n.diff.color)||void 0===i?void 0:i.type)?n.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(a);r.useMaterialColor&&this._patchMaterialColor((0,nt.d)(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete t.material}}},{key:"_prepareMarkerPatch",value:function(e,t){var r=t.marker;if((0,f.Wi)(r)||"partial"!==r.type||(0,f.pC)(r.diff.style)||(0,f.pC)(r.diff.placement)||(0,f.pC)(r.diff.color)&&"complete"!==r.diff.color.type)return{changed:!1,useMaterialColor:(0,f.Wi)(this._markerColor)};var i=r.diff.color;if((0,f.Wi)(i))return delete t.marker,{changed:!1,useMaterialColor:(0,f.Wi)(this._markerColor)};var n=(0,f.Wg)(i.newValue);return(0,f.Wi)(n)?(delete t.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterialCached,e),delete t.marker,{changed:!0,useMaterialColor:!1})}},{key:"_patchMaterialColor",value:function(e,t,r){(0,f.Wi)(t)||r.symbolLayerStatePatches.push((function(){return t.setParameters({color:e})}))}}]),r}($.k);dr.elevationModeChangeTypes={definedChanged:Q.lO.RECREATE,staysOnTheGround:Q.lO.NONE,onTheGroundChanged:Q.lO.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(nr||(nr={}));var pr,fr=r(64995),vr=r(11587),yr=r(11700),mr=r(57661),gr=r(99760),_r=r(49420),br=r(73840),xr=r(72838),Sr=r(24231),Cr=r(8548),Pr=["mesh"],Tr=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,i,n,a))._materials=new Map,o._textures=new Map,o.ensureDrapedStatus(!1),o}return(0,l.Z)(r,[{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:de.Z.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Sr.Y({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Sr.Y({color:[0,1,1,1]}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._context.stage.removeMany(Array.from(this._materials.values(),(function(e){return e.material}))),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,Pr,"fill on mesh-3d"))return null;var r=this.setGraphicElevationContext(t,new K.o),i=e.renderingInfo;return this._createAs3DShape(t,i,r,t.uid)}},{key:"layerOpacityChanged",value:function(e,t){var r=this,i=this._getLayerOpacity();this._materials.forEach((function(e){e.material.setParameters({layerOpacity:i});var t=e.material.parameters;r._setMaterialTransparentParameter(t,e),e.material.setParameters({transparent:t.transparent})})),e.forEach((function(e){var n=t(e);(0,f.pC)(n)&&n.layerOpacityChanged(i,r._context.isAsync)}))}},{key:"layerElevationInfoChanged",value:function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Q.B5)}},{key:"slicePlaneEnabledChanged",value:function(e,t){var r=this;return this._materials.forEach((function(e){e.material.setParameters({hasSlicePlane:r._context.slicePlaneEnabled})})),e.forEach((function(e){var i=t(e);(0,f.pC)(i)&&i.slicePlaneEnabledChanged(r._context.slicePlaneEnabled,r._context.isAsync)})),!0}},{key:"physicalBasedRenderingChanged",value:function(){var e=this._usePBR();return this._materials.forEach((function(t){return t.material.setParameters({usePBR:e})})),!0}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"skipHighSymbolLodsChanged",value:function(){return!0}},{key:"_requiresSymbolVertexColors",value:function(){return this._drivenProperties.color||this._drivenProperties.opacity}},{key:"_colorOrTextureUid",value:function(e){return(0,f.Wi)(e)?"-":e instanceof et.Z?e.toHex():e.contentHash}},{key:"_materialPropertiesDefault",value:function(e,t){var r=this._requiresSymbolVertexColors(),i=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:i,hasVertexTangents:n,uid:"vc:".concat(i,",vt:").concat(n,",vct").concat(t,",svc:").concat(r)}}},{key:"_materialProperties",value:function(e,t,r){var i=this._materialPropertiesDefault(e,r);if(!t.material)return i;var n=t.material,a=n.color,o=n.colorTexture,s=n.normalTexture,l=n.doubleSided,u=n.alphaCutoff,c=n.alphaMode,h=this._colorOrTextureUid(a),d=this._colorOrTextureUid(o),p=this._colorOrTextureUid(s);if(i.color=a,i.colorTexture=o,i.normalTexture=s,i.uid="".concat(i.uid,",cmuid:").concat(h,",ctmuid:").concat(d,",ntmuid:").concat(p,",ds:").concat(l,",ac:").concat(u,",am:").concat(c),t.material instanceof vr.Z){var f=t.material,v=f.metallic,y=f.roughness,m=f.metallicRoughnessTexture,g=f.emissiveColor,_=f.emissiveTexture,b=f.occlusionTexture,x=this._colorOrTextureUid(m),S=this._colorOrTextureUid(g),C=this._colorOrTextureUid(_),P=this._colorOrTextureUid(b);i.metallic=v,i.roughness=y,i.metallicRoughnessTexture=m,i.emissiveColor=g,i.emissiveTexture=_,i.occlusionTexture=b,i.colorTextureTransform=t.material.colorTextureTransform,i.normalTextureTransform=t.material.normalTextureTransform,i.emissiveTextureTransform=t.material.emissiveTextureTransform,i.occlusionTextureTransform=t.material.occlusionTextureTransform,i.metallicRoughnessTextureTransform=t.material.metallicRoughnessTextureTransform,i.uid="".concat(i.uid,",mrm:").concat(v,",mrr:").concat(y,",mrt:").concat(x,",emuid:").concat(S,",etmuid:").concat(C,",otmuid:").concat(P)}return i}},{key:"_setInternalColorValueParameters",value:function(e,t){t.diffuse=et.Z.toUnitRGB(e),t.opacity=e.a}},{key:"_getLoadableTextureResource",value:function(e){return e.data?e.data:e.url}},{key:"_getInternalTextureId",value:function(e){var t=this._getInternalTexture(e,Oe.JJ.Opaque);return(0,f.pC)(t)?t.id:null}},{key:"_getInternalTexture",value:function(e,t){var r=this._getLoadableTextureResource(e);if(!r)return null;var i="".concat(e.contentHash,"/").concat(t),n=this._textures.get(i);return n||(n=new Bt.x((0,mr.$A)(r)?r.data:r,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!(0,mr.$A)(r)&&t!==Oe.JJ.Opaque,encoding:(0,mr.$A)(r)&&(0,f.pC)(r.encoding)?r.encoding:void 0}),this._textures.set(i,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}},{key:"_castTextureWrap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"repeat";if("string"==typeof e){var t=this._castTextureWrapIndividual(e);return{s:t,t:t}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}},{key:"_castTextureWrapIndividual",value:function(e){switch(e){case"clamp":return Cr.e8.CLAMP_TO_EDGE;case"mirror":return Cr.e8.MIRRORED_REPEAT;default:return Cr.e8.REPEAT}}},{key:"_setInternalMaterialParameters",value:function(e,t){if((0,f.pC)(e.color)&&this._setInternalColorValueParameters(e.color,t),(0,f.pC)(e.colorTexture)){var r=this._getInternalTexture(e.colorTexture,t.textureAlphaMode);(0,f.pC)(r)?(t.textureId=r.id,t.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):t.textureId=void 0}(0,f.pC)(e.normalTexture)&&(t.normalTextureId=this._getInternalTextureId(e.normalTexture)),(0,f.pC)(e.emissiveColor)&&(t.emissiveFactor=et.Z.toUnitRGB(e.emissiveColor)),(0,f.pC)(e.emissiveTexture)&&(t.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),(0,f.pC)(e.occlusionTexture)&&(t.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),(0,f.pC)(e.metallicRoughnessTexture)&&(t.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),t.colorTextureTransformMatrix=(0,gr.i)(e.colorTextureTransform),t.normalTextureTransformMatrix=(0,gr.i)(e.normalTextureTransform),t.occlusionTextureTransformMatrix=(0,gr.i)(e.occlusionTextureTransform),t.emissiveTextureTransformMatrix=(0,gr.i)(e.emissiveTextureTransform),t.metallicRoughnessTextureTransformMatrix=(0,gr.i)(e.metallicRoughnessTextureTransform)}},{key:"_setExternalMaterialParameters",value:function(e){var t=this._drivenProperties.color,r=(0,f.pC)(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(t)e.externalColor=nt.O;else{var i=(0,f.pC)(this.symbolLayer.material)?this.symbolLayer.material.color:null;(0,f.pC)(i)?e.externalColor=et.Z.toUnitRGBA(i):(r=null,e.externalColor=nt.O)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}},{key:"_hasTransparentVertexColors",value:function(e){var t=e.vertexAttributes.color;if((0,f.Wi)(t))return!1;for(var r=3;r<t.length;r+=4)if(255!==t[r])return!0;return!1}},{key:"_getOrCreateMaterial",value:function(e,t){var r,i,n,a=null===(r=t.material)||void 0===r?void 0:r.color,o=null===(i=t.material)||void 0===i?void 0:i.colorTexture,s=null===(n=t.material)||void 0===n?void 0:n.alphaMode,l="blend"===s,u=!("opaque"===s)&&(this._hasTransparentVertexColors(e)||(0,f.pC)(a)&&a.a<1||(0,f.pC)(o)&&o.transparent||l),c=this._materialProperties(e,t,u),h=this._materials.get(c.uid);if(h)return h.material;var d={material:null,isComponentTransparent:u,alphaMode:t.material?t.material.alphaMode:"opaque"},p=null==c.metallicRoughnessTexture&&null==c.metallic&&null==c.roughness,v={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:c.hasVertexColors,hasSymbolColors:c.hasSymbolVertexColors,hasVertexTangents:c.hasVertexTangents,ambient:x.Z,diffuse:x.O,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Oe.Vr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(v.mrrFactors=[null!=c.metallic?c.metallic:1,null!=c.roughness?c.roughness:1,.5]),t.material&&(v.doubleSided=t.material.doubleSided,v.cullFace=t.material.doubleSided?Oe.Vr.None:Oe.Vr.Back,v.textureAlphaCutoff=t.material.alphaCutoff),this._setExternalMaterialParameters(v),this._setMaterialTransparentParameter(v,d),this._setInternalMaterialParameters(c,v);var y=new ke.Gp(v);return d.material=y,this._materials.set(c.uid,d),this._context.stage.add(y),y}},{key:"_usePBR",value:function(){return this._context.physicalBasedRenderingEnabled}},{key:"_setMaterialTransparentParameter",value:function(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,"auto"===t.alphaMode?e.textureAlphaMode=e.transparent?Oe.JJ.MaskBlend:Oe.JJ.Opaque:e.textureAlphaMode="opaque"===t.alphaMode?Oe.JJ.Opaque:"mask"===t.alphaMode?Oe.JJ.Mask:Oe.JJ.Blend}},{key:"_addDebugNormals",value:function(e,t){for(var r=t.length,i=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*i,e.extent.height*i,e.extent.zmax-e.extent.zmin),a=[],o=[],s=[],l=[],u=0;u<r;u++)for(var c=t[u],h=c.vertexAttributes.get(ae.T.POSITION),d=c.vertexAttributes.get(ae.T.NORMAL),p=c.indices.get(ae.T.POSITION),f=c.indices.get(ae.T.NORMAL),v=h.data,y=d.data,m=0;m<p.length;m++){for(var g=3*p[m],_=3*f[m],x=0;x<3;x++)a.push(v[g+x]);for(var S=0;S<3;S++)a.push(v[g+S]+y[_+S]*n);if(o.push(o.length),o.push(o.length),m%3==0){this._calculateFaceNormal(v,p,m,Rr),this._getFaceVertices(v,p,m,Ar,kr,Er),(0,b.a)(Ar,Ar,kr),(0,b.a)(Ar,Ar,Er),(0,b.g)(Ar,Ar,1/3);for(var C=0;C<3;C++)s.push(Ar[C]);for(var P=0;P<3;P++)s.push(Ar[P]+Rr[P]*n);l.push(l.length),l.push(l.length)}}var T=t[0].transformation,O=new ne.Z(this._debugVertexNormalMaterial,[[ae.T.POSITION,new re.a(a,3,!0)]],[[ae.T.POSITION,o]],null,ie.U.Line);t.push(O),O.transformation=T;var w=new ne.Z(this._debugFaceNormalMaterial,[[ae.T.POSITION,new re.a(s,3,!0)]],[[ae.T.POSITION,l]],null,ie.U.Line);w.transformation=T,t.push(w)}},{key:"_createAs3DShape",value:function(e,t,r,i){var n=e.geometry;if("mesh"!==n.type)return null;var a=this._createGeometryInfo(n,t,i);if((0,f.Wi)(a))return null;var o=a.geometries,s=a.objectTransformation;de.Z.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,o);var l=new Ae.T({geometries:o,metadata:{layerUid:this._context.layer.uid,graphicUid:i}});l.transformation=s;var u=(0,he.hM)(this.symbolLayer,{opacity:this._getLayerOpacity()}),c=(0,f.pC)(u)?new Z.n(o[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,h=new Z.z(this,l,o,null,null,ct.j3,r,c);h.needsElevationUpdates=(0,Q.B5)(r.mode),h.useObjectOriginAsAttachmentOrigin=!0,r.centerPointInElevationSR=this._getCenterPointInElevationSR(l);var d=this._context,p=d.elevationProvider,v=d.renderCoordsHelper;return h.alignedSampledElevation=(0,ct.j3)(h,r,p.spatialReference,(function(e,t){return(0,Q.qZ)(e,p,r,v,t)}),v),h}},{key:"_getCenterPointInElevationSR",value:function(e){var t=(0,w.Tx)(0,0,0,(0,f.pC)(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);return(0,C.MT)([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,t),t}},{key:"_createComponentNormals",value:function(e,t,r,i){switch(r.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,t,r,i);case"flat":return this._createComponentNormalsFlat(e,i);case"smooth":return this._createComponentNormalsSmooth(e,i)}}},{key:"_createComponentNormalsSource",value:function(e,t,r,i){if((0,f.Wi)(t))return this._createComponentNormalsFlat(e,i);var n=!1;if(!r.trustSourceNormals)for(var a=0;a<i.length;a+=3){this._calculateFaceNormal(e,i,a,Rr);for(var o=0;o<3;o++){var s=3*i[a+o];Ar[0]=t[s+0],Ar[1]=t[s+1],Ar[2]=t[s+2],(0,b.e)(Rr,Ar)<0&&(t[s+0]=-t[s+0],t[s+1]=-t[s+1],t[s+2]=-t[s+2],n=!0)}}return new Or(t,i,n)}},{key:"_createComponentNormalsFlat",value:function(e,t){for(var r=(0,br.xx)(t.length),i=new Array(3*t.length),n=0;n<t.length;n+=3)for(var a=this._calculateFaceNormal(e,t,n,Rr),o=0;o<3;o++)r[n+o]=a[o],i[n+o]=n/3;return new Or(r,i,!1)}},{key:"_createComponentNormalsSmooth",value:function(e,t){for(var r={},i=0;i<t.length;i+=3)for(var n=this._calculateFaceNormal(e,t,i,Rr),a=0;a<3;a++){var o=t[i+a],s=r[o];s||(s={normal:(0,x.c)(),count:0},r[o]=s),(0,b.a)(s.normal,s.normal,n),s.count++}for(var l=(0,br.xx)(3*t.length),u=new Array(3*t.length),c=0;c<t.length;c++){var h=r[t[c]];1!==h.count&&((0,b.n)(h.normal,h.normal),h.count=1);for(var d=0;d<3;d++)l[3*c+d]=h.normal[d];u[c]=c}return new Or(l,u,!1)}},{key:"_getFaceVertices",value:function(e,t,r,i,n,a){var o=3*t[r+0],s=3*t[r+1],l=3*t[r+2];i[0]=e[o+0],i[1]=e[o+1],i[2]=e[o+2],n[0]=e[s+0],n[1]=e[s+1],n[2]=e[s+2],a[0]=e[l+0],a[1]=e[l+1],a[2]=e[l+2]}},{key:"_calculateFaceNormal",value:function(e,t,r,i){return this._getFaceVertices(e,t,r,Ar,kr,Er),(0,b.b)(kr,kr,Ar),(0,b.b)(Er,Er,Ar),(0,b.f)(Ar,kr,Er),(0,b.n)(i,Ar),i}},{key:"_getOrCreateComponents",value:function(e){return(0,f.Pt)(e.components,Dr)}},{key:"_createPositionBuffer",value:function(e,t){var r=e.vertexAttributes.position,i=t.reprojection===pr.ECEF?t.transformBeforeProject:null;if((0,f.pC)(i)&&(r=(0,yr.zZ)(r,new Float64Array(r.length),i)),t.reprojection===pr.NONE)return t.needsBufferCopy?new Float64Array(r):r;var n=(0,f.pC)(i)?r:new Float64Array(r.length);return(0,C.CM)(r,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,r.length/3),n}},{key:"_createNormalBuffer",value:function(e,t,r){var i=e.vertexAttributes.normal;if((0,f.Wi)(i))return null;var n=r.reprojection===pr.ECEF?r.transformBeforeProject:null;if((0,f.pC)(n)&&(i=(0,yr.w9)(i,new Float32Array(i.length),n)),"local"===this._context.graphicsCoreOwner.view.viewingMode||r.reprojection===pr.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===i?new Float32Array(i):i;var a=e.vertexAttributes.position,o=(0,f.pC)(n)?i:new Float32Array(i.length);return(0,yr.Iz)(i,a,t,e.spatialReference,o)}},{key:"_createTangentBuffer",value:function(e,t,r){var i=e.vertexAttributes.tangent;if((0,f.Wi)(i))return null;var n=r.reprojection===pr.ECEF?r.transformBeforeProject:null;if((0,f.pC)(n)&&(i=(0,yr.VS)(i,new Float32Array(i.length),n)),"local"===this._context.graphicsCoreOwner.view.viewingMode||r.reprojection===pr.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===i?new Float32Array(i):i;var a=e.vertexAttributes.position,o=(0,f.pC)(n)?i:new Float32Array(i.length);return(0,yr.wi)(i,a,t,e.spatialReference,o)}},{key:"_createColorBuffer",value:function(e){return e.vertexAttributes.color}},{key:"_createSymbolColorBuffer",value:function(e){if(this._requiresSymbolVertexColors()){var t=this._getVertexOpacityAndColor(e),r=(0,_r.F5)((0,f.U2)(this.symbolLayer,"material","colorMixMode")),i=new Uint8Array(4);return(0,_r.HB)(t,r,i),i}return null}},{key:"_createBuffers",value:function(e,t){var r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var i=e.vertexAttributes.normal,n=e.vertexAttributes.uv,a=e.vertexAttributes.tangent;if((0,f.pC)(i)&&i.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if((0,f.pC)(a)&&a.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if((0,f.pC)(n)&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;var o=this._computeReprojectionInfo(e),s=this._createPositionBuffer(e,o),l=this._createColorBuffer(e),u=this._createSymbolColorBuffer(t),c=this._createNormalBuffer(e,s,o),h=this._createTangentBuffer(e,s,o);return{positionBuffer:s,normalBuffer:c,tangentBuffer:h,uvBuffer:n,colorBuffer:l,symbolColorBuffer:u,objectTransformation:o.reprojection===pr.NONE&&(0,f.pC)(o.objectTransformation)?o.objectTransformation:this._transformOriginLocal(e,s,c,h),geometryTransformation:o.reprojection===pr.NONE&&(0,f.pC)(o.geometryTransformation)?o.geometryTransformation:(0,W.c)()}}},{key:"_computeReprojectionInfo",value:function(e){var t=(0,f.pC)(e.transform),r=t&&e.transform.geographic||this._context.renderCoordsHelper.viewingMode===X.JY.Local?pr.NONE:pr.ECEF;if(t){if(r===pr.NONE){var i=(0,W.c)();return(0,C.Bm)(e.spatialReference,e.transform.origin,i,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:i,geometryTransformation:(0,W.b)(e.transform.localMatrix),needsBufferCopy:!1}}var n=(0,H.f)((0,W.c)(),e.transform.origin);return(0,H.m)(n,n,e.transform.localMatrix),{reprojection:r,transformBeforeProject:n,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}},{key:"_transformOriginLocal",value:function(e,t,r,i){var n=this._context.renderCoordsHelper.spatialReference,a=e.anchor;wr[0]=a.x,wr[1]=a.y,wr[2]=a.z;var o=(0,W.c)();(0,C.Bm)(e.spatialReference,wr,o,n);var s=j.fP.fromTypedArray(t);if((0,H.a)(Lr,o),(0,q.t)(s,s,Lr),(0,f.pC)(r)||(0,f.pC)(i)){if((0,G.f)(Ir,o),(0,G.t)(Ir,Ir),(0,f.pC)(r)){var l=j.ct.fromTypedArray(r);(0,q.a)(l,l,Ir)}if((0,f.pC)(i)){var u=j.ct.fromTypedArray(i,4*i.BYTES_PER_ELEMENT);(0,q.a)(u,u,Ir)}}return o}},{key:"_validateFaces",value:function(e,t){var r=e.vertexAttributes.position.length/3,i=t.faces;if(i){for(var n=-1,a=0;a<i.length;a++){var o=i[a];o>n&&(n=o)}if(r<=n)return this.logger.warn("Vertex index ".concat(n," is out of bounds of the mesh position buffer")),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}},{key:"_getOrCreateFaces",value:function(e,t){return t.faces?t.faces:(0,xr.p)(e.vertexAttributes.position.length/3)}},{key:"_isOutsideClippingArea",value:function(e){if(!this._context.clippingExtent)return!1;var t=e.vertexAttributes&&e.vertexAttributes.position;if(!t)return!1;var r,i=this._context.elevationProvider.spatialReference,n=t.length/3;return(0,f.pC)(i)&&!e.spatialReference.equals(i)?(r=new Float64Array(t.length),(0,C.CM)(e.vertexAttributes.position,e.spatialReference,0,r,i,0,n)):r=t,(0,P.cS)(Zr),(0,P.G1)(Zr,r,0,n),!(0,P.Zp)(Zr,this._context.clippingExtent)}},{key:"_createGeometryInfo",value:function(e,t,r){if(!(0,C.Up)(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;var n=this._createBuffers(e,t);if((0,f.Wi)(n))return null;var a,o=n.positionBuffer,s=n.uvBuffer,l=n.colorBuffer,u=n.symbolColorBuffer,c=n.normalBuffer,h=n.tangentBuffer,d=n.objectTransformation,p=n.geometryTransformation,v=this._getOrCreateComponents(e),y=new Array,m=!1,g=(0,i.Z)(v);try{for(g.s();!(a=g.n()).done;){var _=a.value;if(!this._validateFaces(e,_))return null;var b=this._getOrCreateFaces(e,_);if(0!==b.length){var x=this._createComponentNormals(o,c,_,b);x.didFlipNormals&&(m=!0);var S=[[ae.T.POSITION,new re.a(o,3,!0)],[ae.T.NORMAL,new re.a(x.normals,3,!0)]],P=[[ae.T.POSITION,b],[ae.T.NORMAL,x.indices]];(0,f.pC)(l)&&(S.push([ae.T.COLOR,new re.a(l,4,!0)]),P.push([ae.T.COLOR,b])),(0,f.pC)(u)&&(S.push([ae.T.SYMBOLCOLOR,new re.a(u,4,!0)]),P.push([ae.T.SYMBOLCOLOR,new Array(b.length).fill(0)])),(0,f.pC)(s)&&(S.push([ae.T.UV0,new re.a(s,2,!0)]),P.push([ae.T.UV0,b])),(0,f.pC)(h)&&(S.push([ae.T.TANGENT,new re.a(h,4,!0)]),P.push([ae.T.TANGENT,b]));var T=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),O=this._getOrCreateMaterial(e,_),w=new ne.Z(O,S,P,null,ie.U.Mesh,T);w.transformation=p,y.push(w)}}}catch(A){g.e(A)}finally{g.f()}return m&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:d}}}]),r}($.k),Or=(0,l.Z)((function e(t,r,i){(0,s.Z)(this,e),this.normals=t,this.indices=r,this.didFlipNormals=i})),wr=(0,x.c)(),Ar=(0,x.c)(),kr=(0,x.c)(),Er=(0,x.c)(),Rr=(0,x.c)(),Lr=(0,W.c)(),Ir=(0,B.c)(),Zr=(0,P.Ue)(),Dr=[new fr.Z];!function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"}(pr||(pr={}));var Mr=r(29439),zr=r(73627),Fr=r(53720),Ur=r(47669),Vr=function(){function e(t,r,i,n){(0,s.Z)(this,e),this.graphics3DSymbolLayer=t,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=n,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}return(0,l.Z)(e,[{key:"initialize",value:function(){}},{key:"setVisibility",value:function(e){var t=this._lodRenderer.instanceData;e!==t.getVisible(this.instanceIndex)&&t.setVisible(this.instanceIndex,e)}},{key:"destroy",value:function(){null!=this.instanceIndex&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}},{key:"alignWithElevation",value:function(e,t,r){var i=this;if(this.elevationAligner){(0,E.aO)(this.elevationContext.featureExpressionInfoContext,r);var n=this.elevationAligner(this,this.elevationContext,e.spatialReference,(function(r,n){return(0,Q.qZ)(r,e,i.elevationContext,t,n)}),t);(0,f.pC)(n)&&(this.alignedSampledElevation=n)}}},{key:"getCenterObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,x.c)();return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Wr),(0,b.m)(e,this._lodRenderer.baseBoundingSphere.center,Wr)}},{key:"getBoundingBoxObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,P.Ue)();this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Wr);var t=this._lodRenderer.baseBoundingBox;(0,P.cS)(e);for(var r=0;r<8;++r)(0,b.s)(Gr,0==(1&r)?t[0]:t[3],0==(2&r)?t[1]:t[4],0==(4&r)?t[2]:t[5]),(0,b.m)(Gr,Gr,Wr),(0,P.pp)(e,Gr);return e}},{key:"computeAttachmentOrigin",value:function(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Wr),e.render.origin[0]+=Wr[12],e.render.origin[1]+=Wr[13],e.render.origin[2]+=Wr[14],e.render.num++}},{key:"getProjectedBoundingBox",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,i,n,o){var s,l,u,c,h,d,p,v,y,m;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.getBoundingBoxObjectSpace(o),l=Hr,u=(0,P.wp)(s)?1:l.length,this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Wr),c=0;c<u;c++)h=l[c],Gr[0]=s[h[0]],Gr[1]=s[h[1]],Gr[2]=s[h[2]],(0,b.m)(Gr,Gr,Wr),Nr[3*c+0]=Gr[0],Nr[3*c+1]=Gr[1],Nr[3*c+2]=Gr[2];if(t(Nr,0,u)){e.next=5;break}return e.abrupt("return",null);case 5:for((0,P.cS)(s),d=null,this.calculateRelativeScreenBounds&&(d=this.calculateRelativeScreenBounds()),p=0;p<3*u;p+=3){for(v=0;v<3;v++)s[v]=Math.min(s[v],Nr[p+v]),s[v+3]=Math.max(s[v+3],Nr[p+v]);d&&i.push({location:Nr.slice(p,p+3),screenSpaceBoundingRect:d})}if(!r||((0,P.be)(s,Br),"absolute-height"===this.elevationContext.mode)){e.next=20;break}return m=(0,ee.Si)(s,r.service.spatialReference,r),e.prev=11,e.next=14,r.service.queryElevation(Br[0],Br[1],n,m,"ground");case 14:y=e.sent,e.next=19;break;case 17:e.prev=17,e.t0=e.catch(11);case 19:(0,f.pC)(y)&&(0,P.cv)(s,0,0,-this.alignedSampledElevation+y);case 20:return e.abrupt("return",s);case 21:case"end":return e.stop()}}),e,this,[[11,17]])})));return function(t,r,i,n,a){return e.apply(this,arguments)}}()},{key:"addObjectState",value:function(e,t){var r=this;if(e===Oe.V_.Highlight){var i=new Ur.O(e);this._addHighlightId(i),t.addExternal((function(e){r._removeHighlightId(e)}),i)}}},{key:"removeObjectState",value:function(e){this._highlights.forEach((function(t){return e.remove(t)}))}},{key:"_addHighlightId",value:function(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}},{key:"_removeHighlightId",value:function(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}},{key:"_lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]),e}(),Nr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Gr=(0,x.c)(),Br=(0,x.c)(),Hr=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Wr=(0,W.c)(),jr=r(85042),qr=r(72635);function Yr(e){return{levels:e.map((function(e){return function(e){var t=new Array;return e.stageResources.geometries.forEach((function(r){var i=e.stageResources.textures;t.push(new qr.QD(r,i))})),{components:t,minScreenSpaceRadius:(0,f.Pt)(e.lodThreshold,0),pivotOffset:e.pivotOffset}}(e)}))}}var Jr,Xr=r(47858),Qr=r(22894),Kr=r(35218),$r=r(97326),ei=r(27366),ti=r(85015),ri=r(49861),ii=(r(25243),r(63780),r(69912)),ni=r(50256),ai=r(55158),oi=r(37081),si=r(86755),li=r(7566),ui=r(54463),ci=r(78329),hi=r(93822),di=r(97731),pi=r(91505),fi=r(80064);!function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"}(Jr||(Jr={}));var vi=(0,l.Z)((function e(t){(0,s.Z)(this,e),this.localTransform=t.getField(ae.T.LOCALTRANSFORM,j.O1),this.globalTransform=t.getField(ae.T.GLOBALTRANSFORM,j.O1),this.modelOrigin=t.getField(ae.T.MODELORIGIN,j.fP),this.model=t.getField(ae.T.MODEL,j.gK),this.modelNormal=t.getField(ae.T.MODELNORMAL,j.gK),this.modelScaleFactors=t.getField(ae.T.MODELSCALEFACTORS,j.Eu),this.boundingSphere=t.getField(ae.T.BOUNDINGSPHERE,j.Cd),this.color=t.getField(ae.T.COLOR,j.ek),this.featureAttribute=t.getField(ae.T.FEATUREATTRIBUTE,j.ek),this.state=t.getField(ae.T.STATE,j.D_),this.lodLevel=t.getField(ae.T.LODLEVEL,j.D_),this.objectAndLayerIdColor=t.getField(ae.T.OBJECTANDLAYERIDCOLOR,j.mc)})),yi=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i){var n;return(0,s.Z)(this,r),(n=t.call(this,e)).events=new pi.Z,n._capacity=0,n._size=0,n._next=0,n._buffer=null,n._view=null,n._layout=function(e){var t=(0,ai.U$)().mat4f64(ae.T.LOCALTRANSFORM).mat4f64(ae.T.GLOBALTRANSFORM).vec4f64(ae.T.BOUNDINGSPHERE).vec3f64(ae.T.MODELORIGIN).mat3f(ae.T.MODEL).mat3f(ae.T.MODELNORMAL).vec2f(ae.T.MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(ae.T.COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(ae.T.FEATUREATTRIBUTE)),t=t.u8(ae.T.STATE).u8(ae.T.LODLEVEL),e.includes(ae.T.OBJECTANDLAYERIDCOLOR)&&(t=t.vec4u8(ae.T.OBJECTANDLAYERIDCOLOR)),t.alignTo(8),t}(i),n}return(0,l.Z)(r,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}},{key:"addInstance",value:function(){this._size+1>this._capacity&&this._grow();var e=this._findSlot();return this._view.state.set(e,Jr.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}},{key:"removeInstance",value:function(e){var t=this._view.state;(0,di.hu)(e>=0&&e<this._capacity&&0!=(t.get(e)&Jr.ALLOCATED),"invalid instance handle"),this._getStateFlag(e,Jr.ACTIVE)?this._setStateFlags(e,Jr.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}},{key:"freeInstance",value:function(e){var t=this._view.state;(0,di.hu)(e>=0&&e<this._capacity&&0!=(t.get(e)&Jr.ALLOCATED),"invalid instance handle"),t.set(e,0),this._size--}},{key:"setLocalTransform",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)}},{key:"getLocalTransform",value:function(e,t){this._view.localTransform.getMat(e,t)}},{key:"setGlobalTransform",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)}},{key:"getGlobalTransform",value:function(e,t){this._view.globalTransform.getMat(e,t)}},{key:"updateModelTransform",value:function(e){var t=this._view,r=_i,i=bi;t.localTransform.getMat(e,xi),t.globalTransform.getMat(e,Si);var n=(0,H.m)(Si,Si,xi);(0,b.s)(r,n[12],n[13],n[14]),t.modelOrigin.setVec(e,r),(0,G.f)(i,n),t.model.setMat(e,i);var a=(0,fi.mw)(_i,n);a.sort(),t.modelScaleFactors.set(e,0,a[1]),t.modelScaleFactors.set(e,1,a[2]),(0,G.e)(i,i),(0,G.t)(i,i),t.modelNormal.setMat(e,i),this._setStateFlags(e,Jr.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}},{key:"getModelTransform",value:function(e,t){var r=this._view;r.model.getMat(e,bi),r.modelOrigin.getVec(e,_i),t[0]=bi[0],t[1]=bi[1],t[2]=bi[2],t[3]=0,t[4]=bi[3],t[5]=bi[4],t[6]=bi[5],t[7]=0,t[8]=bi[6],t[9]=bi[7],t[10]=bi[8],t[11]=0,t[12]=_i[0],t[13]=_i[1],t[14]=_i[2],t[15]=1}},{key:"applyShaderTransformation",value:function(e,t){(0,f.pC)(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,t)}},{key:"getCombinedModelTransform",value:function(e,t){return this.getModelTransform(e,t),(0,f.pC)(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,t),t}},{key:"getCombinedLocalTransform",value:function(e,t){return this._view.localTransform.getMat(e,t),(0,f.pC)(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,t),t}},{key:"getCombinedMaxScaleFactor",value:function(e){var t=this._view.modelScaleFactors.get(e,1);if((0,f.pC)(this.shaderTransformation)){var r=this.shaderTransformation.scaleFactor(_i,this,e);t*=Math.max(r[0],r[1],r[2])}return t}},{key:"getCombinedMedianScaleFactor",value:function(e){var t=this._view.modelScaleFactors.get(e,0);if((0,f.pC)(this.shaderTransformation)){var r=this.shaderTransformation.scaleFactor(_i,this,e);t*=function(e,t,r){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),r))}(r[0],r[1],r[2])}return t}},{key:"getModel",value:function(e,t){this._view.model.getMat(e,t)}},{key:"setFeatureAttribute",value:function(e,t){this._view.featureAttribute.setVec(e,t)}},{key:"getFeatureAttribute",value:function(e,t){this._view.featureAttribute.getVec(e,t)}},{key:"setColor",value:function(e,t){this._view.color.setVec(e,t)}},{key:"setObjectAndLayerIdColor",value:function(e,t){this._view.objectAndLayerIdColor.setVec(e,t)}},{key:"getColor",value:function(e,t){this._view.color.getVec(e,t)}},{key:"setVisible",value:function(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,Jr.VISIBLE,t),this.events.emit("instance-visibility-changed",{index:e}))}},{key:"getVisible",value:function(e){return this._getStateFlag(e,Jr.VISIBLE)}},{key:"setHighlight",value:function(e,t){t!==this.getHighlight(e)&&(this._setStateFlag(e,Jr.HIGHLIGHT,t),this.events.emit("instance-highlight-changed"))}},{key:"getHighlight",value:function(e){return this._getStateFlag(e,Jr.HIGHLIGHT)}},{key:"getState",value:function(e){return this._view.state.get(e)}},{key:"getLodLevel",value:function(e){return this._view.lodLevel.get(e)}},{key:"countFlags",value:function(e){for(var t=0,r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t}},{key:"_setStateFlags",value:function(e,t){var r=this._view.state;t=r.get(e)|t,r.set(e,t)}},{key:"_clearStateFlags",value:function(e,t){var r=this._view.state;t=r.get(e)&~t,r.set(e,t)}},{key:"_setStateFlag",value:function(e,t,r){r?this._setStateFlags(e,t):this._clearStateFlags(e,t)}},{key:"_getStateFlag",value:function(e,t){return!!(this._view.state.get(e)&t)}},{key:"_grow",value:function(){var e=Math.max(mi,Math.floor(this._capacity*gi)),t=this._layout.createBuffer(e);if(this._buffer){var r=new Uint8Array(this._buffer.buffer);new Uint8Array(t.buffer).set(r)}this._capacity=e,this._buffer=t,this._view=new vi(this._buffer)}},{key:"_findSlot",value:function(){for(var e=this._view.state,t=this._next;e.get(t)&Jr.ALLOCATED;)t=t+1===this._capacity?0:t+1;return this._next=t+1===this._capacity?0:t+1,t}}]),r}(ti.Z);(0,ei._)([(0,ri.Cb)({constructOnly:!0})],yi.prototype,"shaderTransformation",void 0),(0,ei._)([(0,ri.Cb)()],yi.prototype,"_size",void 0),(0,ei._)([(0,ri.Cb)({readOnly:!0})],yi.prototype,"size",null),yi=(0,ei._)([(0,ii.j)("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],yi);var mi=1024,gi=2,_i=(0,x.c)(),bi=(0,B.c)(),xi=(0,W.c)(),Si=(0,W.c)(),Ci=r(23470),Pi=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i){var n;return(0,s.Z)(this,r),n=t.call(this,(function(e){return(0,Ci.w)(n._instanceData.view.boundingSphere.getVec(e,n._tmpSphere))}),{maximumDepth:25}),n._tmpSphere=(0,Ci.c)(),n._tmpMat4=(0,W.c)(),n._instanceData=e,n._boundingSphere=i,n}return(0,l.Z)(r,[{key:"addInstance",value:function(e){var t=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);(0,b.m)(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*(0,fi.u1)(r),t.setVec(e,this._tmpSphere),this.add([e])}},{key:"removeInstance",value:function(e){this.remove([e])}}]),r}(ci.Z),Ti=function(){function e(t,r){(0,s.Z)(this,e),this._worldSpaceRadius=t,this._minScreenSpaceRadii=r}return(0,l.Z)(e,[{key:"selectLevel",value:function(e,t,r){for(var i=r.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*t/i,a=0,o=1;o<this._minScreenSpaceRadii.length;++o)n>=this._minScreenSpaceRadii[o]&&(a=o);return a}}]),e}(),Oi=r(94425),wi=r(88153),Ai=r(80658),ki=r(22255),Ei=r(44070),Ri=function(){function e(t,r){(0,s.Z)(this,e);var i=t.renderContext.rctx,n=r.geometry;this._materialRepository=t.materialRepository,n.material.setParameters({instancedDoublePrecision:!0});var a=n.material.createBufferWriter(),o=a.vertexBufferLayout,l=a.elementCount(n),u=a.allocate(l);a.write(null,null,n,u,0),this.geometry=n,this.material=n.material,this.glMaterials=new Oi.p(n.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Ei.f.createVertex(i,Cr.l1.STATIC_DRAW,u.buffer),this.vao=new Ai.U(i,li.i,{geometry:(0,ni.K)(o)},{geometry:this.vbo}),this.vertexCount=l}return(0,l.Z)(e,[{key:"destroy",value:function(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}},{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}},{key:"intersect",value:function(e,t,r,i,n,a,o,s){var l=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,i,(function(r,i,u,c,h){if(r>=0){if(null!=t&&!t(e.rayBegin,e.rayEnd,r))return;var d=new ki.x(a.layerUid,a.graphicUid(n),l,u,o,s);if((null==e.results.min.drapedLayerOrder||h>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||r<e.results.min.dist)&&e.results.min.set(ui.q7.LOD,d,r,i,e.transform.transform,h),e.options.store!==ui.eC.MIN&&(null==e.results.max.drapedLayerOrder||h>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||r>e.results.max.dist)&&e.results.max.set(ui.q7.LOD,d,r,i,e.transform.transform,h),e.options.store===ui.eC.ALL){var p=(0,wi.LP)(e.results.min.ray);p.set(ui.q7.LOD,d,r,i,e.transform.transform,h),e.results.all.push(p)}}}))}}]),e}(),Li=function(){function e(t,r){(0,s.Z)(this,e),this.minScreenSpaceRadius=t,this.components=r}return(0,l.Z)(e,[{key:"destroy",value:function(){this.components.forEach((function(e){return e.destroy()}))}},{key:"intersect",value:function(e,t,r,i,n,a,o){var s=this;this.components.forEach((function(l){return l.intersect(e,t,r,i,n,a,s.boundingSphere,o)}))}},{key:"boundingBox",get:function(){if((0,f.Wi)(this._boundingBox)){var e=(0,P.cS)();this.components.forEach((function(t){(0,f.pC)(t.boundingInfo)&&((0,P.pp)(e,t.boundingInfo.bbMin),(0,P.pp)(e,t.boundingInfo.bbMax))})),this._boundingBox=e}return this._boundingBox}},{key:"boundingSphere",get:function(){if((0,f.Wi)(this._boundingSphere)){var e=this.boundingBox,t=(0,x.c)();(0,P.be)(e,t),this._boundingSphere={center:t,radius:.5*(0,P.wz)(e)}}return this._boundingSphere}},{key:"triangleCount",get:function(){return this.components.reduce((function(e,t){return e+t.triangleCount}),0)}}],[{key:"create",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(r,n,o){var s,l,u,c,h;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.allSettled(n.components.map((function(e){return r.controller.schedule((function(){return new Ri(r,e)}),o)})));case 2:if(s=t.sent,l=s.map((function(e){return"fulfilled"===e.status?e.value:null})).filter(f.pC),!(0,v.Hc)(o)&&l.length===s.length){t.next=23;break}l.forEach((function(e){return e.destroy()})),(0,v.k_)(o),u=(0,i.Z)(s),t.prev=7,u.s();case 9:if((c=u.n()).done){t.next=15;break}if("rejected"!==(h=c.value).status){t.next=13;break}throw h.reason;case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),u.e(t.t0);case 20:return t.prev=20,u.f(),t.finish(20);case 23:return t.abrupt("return",new e(n.minScreenSpaceRadius,l));case 24:case"end":return t.stop()}}),t,null,[[7,17,20,23]])})));return function(e,r,i){return t.apply(this,arguments)}}()}]),e}(),Ii=function(){function e(t,r,i){(0,s.Z)(this,e),this._elementSize=r,this._buffer=Ei.f.createVertex(t,Cr.l1.STATIC_DRAW),this.resize(i)}return(0,l.Z)(e,[{key:"destroy",value:function(){this._buffer.dispose()}},{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",get:function(){return this._capacity}},{key:"array",get:function(){return this._array}},{key:"buffer",get:function(){return this._buffer}},{key:"memoryUsage",get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}},{key:"copyRange",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,i*this.elementSize).set(n)}},{key:"transferAll",value:function(){this._buffer.setData(this._array)}},{key:"transferRange",value:function(e,t){var r=e*this._elementSize,i=t*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,i)}},{key:"resize",value:function(e){var t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(t),this._capacity=e}}]),e}(),Zi=(0,l.Z)((function e(t){(0,s.Z)(this,e),this.modelOriginHi=t.getField(ae.T.MODELORIGINHI,j.ct),this.modelOriginLo=t.getField(ae.T.MODELORIGINLO,j.ct),this.model=t.getField(ae.T.MODEL,j.gK),this.modelNormal=t.getField(ae.T.MODELNORMAL,j.gK),this.color=t.getField(ae.T.INSTANCECOLOR,j.ek),this.featureAttribute=t.getField(ae.T.INSTANCEFEATUREATTRIBUTE,j.ek),this.objectAndLayerIdColor=t.getField(ae.T.OBJECTANDLAYERIDCOLOR_INSTANCED,j.mc)})),Di=function(){function e(t,r){(0,s.Z)(this,e),this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}return(0,l.Z)(e,[{key:"destroy",value:function(){this._buffer&&this._buffer.destroy()}},{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){var e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}},{key:"isEmpty",get:function(){return this._headIndex===this._tailIndex}},{key:"isFull",get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},{key:"memoryUsage",get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}},{key:"reset",value:function(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}},{key:"startUpdateCycle",value:function(){this._captureFirstIndex=!0}},{key:"beginUpdate",value:function(){(0,di.hu)(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}},{key:"endUpdate",value:function(){(0,di.hu)(this._updating,"not updating"),this.size<Fi*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}},{key:"allocateHead",value:function(){(0,di.hu)(this._updating,"not updating"),this.isFull&&this._grow();var e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),(0,di.hu)(this._headIndex!==this._tailIndex,"invalid pointers"),e}},{key:"freeTail",value:function(){(0,di.hu)(this._updating,"not updating"),(0,di.hu)(this.size>0,"invalid size");var e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}},{key:"_grow",value:function(){var e=Math.max(Mi,Math.floor(this._capacity*zi));this._resize(e)}},{key:"_shrink",value:function(){var e=Math.max(Mi,Math.floor(this._capacity*Ui));this._resize(e)}},{key:"_resize",value:function(e){if((0,di.hu)(this._updating,"not updating"),e!==this._capacity){var t=new Ii(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var r=this.size,i=this._compactInstances(t);(0,di.hu)(i===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=i,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new Zi(this._instanceBufferLayout.createView(this._buffer.array))}}},{key:"_compactInstances",value:function(e){var t=this._headIndex,r=this._tailIndex;return r<t?(this._buffer.copyRange(r,t,e),t-r):r>t?(this._buffer.copyRange(r,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-r),t+(this._capacity-r)):0}},{key:"_incrementHead",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._headIndex=(this._headIndex+e)%this._capacity}},{key:"_incrementTail",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._tailIndex=(this._tailIndex+e)%this._capacity}},{key:"_transferRange",value:function(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}}]),e}(),Mi=1024,zi=2,Fi=.3,Ui=.5,Vi=r(22909),Ni=r(32683),Gi=r(50531),Bi=r(93463),Hi=r(3384),Wi=function(e){var t=e.baseBoundingSphere.radius,r=e.levels.map((function(e){return e.minScreenSpaceRadius}));return new Ti(t,r)},ji=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i){var n;return(0,s.Z)(this,r),(n=t.call(this,e)).type=ui.q7.LOD,n.isGround=!1,n._levels=[],n._defaultRenderInstanceData=[],n._highlightRenderInstanceData=[],n._instanceIndex=0,n._cycleStartIndex=0,n._slicePlane=!1,n._camera=new si.V,n._updateCyclesWithStaticCamera=-1,n._needFullCycle=!1,n.slots=[hi.r.OPAQUE_MATERIAL,hi.r.TRANSPARENT_MATERIAL],n.canRender=!0,n._instanceData=new yi({shaderTransformation:e.shaderTransformation},e.optionalFields),n._frameTask=i.registerTask(Bi.T8.LOD_RENDERER,(0,$r.Z)(n)),n}return(0,l.Z)(r,[{key:"initialize",value:function(){var e=this;this._instanceBufferLayout=function(e){var t=(0,ai.U$)().vec3f(ae.T.MODELORIGINHI).vec3f(ae.T.MODELORIGINLO).mat3f(ae.T.MODEL).mat3f(ae.T.MODELNORMAL);return(0,f.pC)(e)&&e.includes("color")&&(t=t.vec4f(ae.T.INSTANCECOLOR)),(0,f.pC)(e)&&e.includes("featureAttribute")&&(t=t.vec4f(ae.T.INSTANCEFEATUREATTRIBUTE)),(0,f.pC)(e)&&e.includes("objectAndLayerIdColor")&&(t=t.vec4u8(ae.T.OBJECTANDLAYERIDCOLOR_INSTANCED)),t}(this.optionalFields),this._glInstanceBufferLayout=(0,ni.K)(this._instanceBufferLayout,1),this._instanceData.events.on("instances-changed",(function(){return e._requestUpdateCycle()})),this._instanceData.events.on("instance-transform-changed",(function(t){var r=t.index;e._requestUpdateCycle(),e.metadata.notifyGraphicGeometryChanged(r)})),this._instanceData.events.on("instance-visibility-changed",(function(t){var r=t.index;e._requestUpdateCycle(!0),e.metadata.notifyGraphicVisibilityChanged(r)})),this._instanceData.events.on("instance-highlight-changed",(function(){return e._requestUpdateCycle(!0)}))}},{key:"destroy",value:function(){this._frameTask.remove()}},{key:"_enableLevelSelection",get:function(){return this.symbol.levels.length>1}},{key:"levels",get:function(){return this._levels}},{key:"baseBoundingBox",get:function(){return this._levels[this._levels.length-1].boundingBox}},{key:"baseBoundingSphere",get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-1].components[0].material}},{key:"slicePlaneEnabled",get:function(){return this._slicePlane},set:function(e){this._slicePlane=e}},{key:"layerUid",get:function(){return this.metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},{key:"memoryUsage",get:function(){var e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach((function(t){var r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu})),this._highlightRenderInstanceData.forEach((function(t){var r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu})),e}},{key:"renderStats",get:function(){var e=this,t=this._instanceData.size,r=[];return this._levels.forEach((function(t,i){var n=e._defaultRenderInstanceData[i],a=e._highlightRenderInstanceData[i],o=n.size+a.size,s=t.triangleCount;r.push({renderedInstances:o,renderedTriangles:o*s,trianglesPerInstance:s})})),{totalInstances:t,renderedInstances:r.reduce((function(e,t){return e+t.renderedInstances}),0),renderedTriangles:r.reduce((function(e,t){return e+t.renderedTriangles}),0),levels:r}}},{key:"initializeRenderContext",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var n,o,s,l,u,c,h=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._context=t,n=t.renderContext.rctx,e.next=4,Promise.allSettled(this.symbol.levels.map((function(e){return h._defaultRenderInstanceData.push(new Di(n,h._instanceBufferLayout)),h._highlightRenderInstanceData.push(new Di(n,h._instanceBufferLayout)),Li.create(t,e,r)})));case 4:if(o=e.sent,s=o.map((function(e){return"fulfilled"===e.status?e.value:null})).filter(f.pC),!(0,v.Hc)(r)&&s.length===o.length){e.next=25;break}s.forEach((function(e){return e.destroy()})),(0,v.k_)(r),l=(0,i.Z)(o),e.prev=9,l.s();case 11:if((u=l.n()).done){e.next=17;break}if("rejected"!==(c=u.value).status){e.next=15;break}throw c.reason;case 15:e.next=11;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(9),l.e(e.t0);case 22:return e.prev=22,l.f(),e.finish(22);case 25:this._levels=s,this._levelSelector=Wi(this);case 26:case"end":return e.stop()}}),e,this,[[9,19,22,25]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"uninitializeRenderContext",value:function(){this._invalidateOctree(),this._levels.forEach((function(e){return e.destroy()})),this._defaultRenderInstanceData.forEach((function(e){return e.destroy()})),this._highlightRenderInstanceData.forEach((function(e){return e.destroy()}))}},{key:"needsTransparentPass",get:function(){return this._levels.some((function(e){return e.components.some((function(e){return e.material.requiresSlot(hi.r.TRANSPARENT_MATERIAL,oi.H.Color)}))}))}},{key:"needsHighlight",get:function(){return this._highlightRenderInstanceData.some((function(e){return e.size>0}))}},{key:"prepareRender",value:function(e){if(!de.Z.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var t=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),t||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(Bi.G5),this._needFullCycle=!1)}}},{key:"render",value:function(e){this.baseMaterial.isVisible()&&this.baseMaterial.isVisibleForOutput(e.output)&&(e.rctx.bindVAO(),e.output!==oi.H.Highlight&&e.output!==oi.H.ShadowHighlight&&this._renderComponents(e,this._defaultRenderInstanceData),e.output!==oi.H.ShadowExcludeHighlight&&this._renderComponents(e,this._highlightRenderInstanceData))}},{key:"intersect",value:function(e,t,r,i){var n=this;if(this.baseMaterial.isVisible()&&!(0,f.Wi)(this._octree)){var a=(0,x.c)();(0,b.b)(a,i,r);var o=function(a){n._instanceData.getCombinedModelTransform(a,Xi),e.transform.set(Xi),(0,b.m)(Qi,r,e.transform.inverse),(0,b.m)(Ki,i,e.transform.inverse);var o=n._instanceData.getState(a),s=n._instanceData.getLodLevel(a),l=n._levels.length;(0,di.hu)(0!=(o&Jr.ACTIVE),"invalid instance state"),(0,di.hu)(s>=0&&s<l,"invaid lod level"),n._levels[s].intersect(e,t,Qi,Ki,a,n.metadata,l)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,a,o)}}},{key:"queryDepthRange",value:function(e){return this._queryDepthRangeOctree(e)}},{key:"notifyShaderTransformationChanged",value:function(){this._invalidateOctree(),this._requestUpdateCycle()}},{key:"_octree",get:function(){if((0,f.Wi)(this._octreeCached)){var e,t=this._instanceData,r=null===(e=t.view)||void 0===e?void 0:e.state;if(!r)return null;this._octreeCached=new Pi(t,this.baseBoundingSphere);for(var i=0;i<t.capacity;++i)r.get(i)&Jr.ACTIVE&&this._octreeCached.addInstance(i)}return this._octreeCached}},{key:"_invalidateOctree",value:function(){this._octreeCached=(0,f.SC)(this._octreeCached)}},{key:"_queryDepthRangeOctree",value:function(e){if((0,f.Wi)(this._octree))return{near:1/0,far:-1/0};var t=e.viewForward,r=this._octree.findClosest(t,ci.Z.DepthOrder.FRONT_TO_BACK,e.frustum),i=this._octree.findClosest(t,ci.Z.DepthOrder.BACK_TO_FRONT,e.frustum);if(null==r||null==i)return{near:1/0,far:-1/0};var n=e.eye,a=this._instanceData.view;a.boundingSphere.getVec(r,Ji),(0,b.b)(Ji,Ji,n);var o=(0,b.e)(Ji,t)-Ji[3];a.boundingSphere.getVec(i,Ji),(0,b.b)(Ji,Ji,n);var s=(0,b.e)(Ji,t)+Ji[3];return{near:Math.max(e.near,o),far:Math.min(e.far,s)}}},{key:"_requestUpdateCycle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}},{key:"_startUpdateCycle",value:function(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach((function(e){return e.startUpdateCycle()})),this._highlightRenderInstanceData.forEach((function(e){return e.startUpdateCycle()}))}},{key:"running",get:function(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}},{key:"runTask",value:function(e){var t=this._enableLevelSelection,r=this._camera,i=this._levelSelector;this._defaultRenderInstanceData.forEach((function(e){return e.beginUpdate()})),this._highlightRenderInstanceData.forEach((function(e){return e.beginUpdate()}));for(var n=this._instanceData,a=n.view,o=n.size,s=n.capacity,l=this._instanceIndex,u=0;u<o&&!e.done;++u){l===this._cycleStartIndex&&this._startUpdateCycle();var c=a.state.get(l),h=0;if(c&Jr.ALLOCATED){var d=a.lodLevel.get(l);if(c&Jr.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[d].freeTail(),c&Jr.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[d].freeTail(),c&Jr.REMOVE)n.freeInstance(l);else if(c&Jr.VISIBLE){var p=0;t&&(a.modelOrigin.getVec(l,Yi),p=i.selectLevel(Yi,n.getCombinedMedianScaleFactor(l),r)),h=c&~(Jr.ACTIVE|Jr.TRANSFORM_CHANGED),p>=0&&(c&Jr.HIGHLIGHT?(qi(this._highlightRenderInstanceData[p],a,l),h|=Jr.HIGHLIGHT_ACTIVE):(qi(this._defaultRenderInstanceData[p],a,l),h|=Jr.DEFAULT_ACTIVE)),a.state.set(l,h),a.lodLevel.set(l,p)}else h=c&~(Jr.ACTIVE|Jr.TRANSFORM_CHANGED),a.state.set(l,h);if((0,f.pC)(this._octreeCached)){var v=!!(c&Jr.ACTIVE),y=!!(h&Jr.ACTIVE);!v&&y?this._octreeCached.addInstance(l):v&&!y?this._octreeCached.removeInstance(l):v&&y&&c&Jr.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(l),this._octreeCached.addInstance(l))}l=l+1===s?0:l+1,e.madeProgress()}else l=l+1===s?0:l+1,o++}this._instanceIndex=l,this._defaultRenderInstanceData.forEach((function(e){return e.endUpdate()})),this._highlightRenderInstanceData.forEach((function(e){return e.endUpdate()})),this._context.requestRender()}},{key:"_renderComponents",value:function(e,t){var r=this;this.levels.forEach((function(i,n){var a=i.components.map((function(i){return r._beginComponent(e,t[n],i)}));i.components.forEach((function(i,o){return r._renderComponent(e,a[o],t[n],i,n)}))}))}},{key:"_beginComponent",value:function(e,t,r){var i=e.bindParameters,n=e.rctx,a=e.output;if(0===t.size||!r.material.requiresSlot(i.slot,e.output))return null;var o=r.glMaterials.load(n,i.slot,a);return(0,f.pC)(o)?o.beginSlot(i):null}},{key:"_renderComponent",value:function(e,t,r,i,n){if(!(0,f.Wi)(t)){var a=e.bindParameters,o=e.rctx,s=o.bindTechnique(t,i.material.parameters,a);o.bindVAO(i.vao),t.ensureAttributeLocations(i.vao),s.bindDraw(en,a,i.material.parameters),de.Z.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===oi.H.Color&&(s.setUniform4fv("externalColor",$i[Math.min(n,$i.length-1)]),s.setUniform1i("colorMixMode",Vi.FZ.replace));var l=o.capabilities.instancing,u=r.capacity,c=r.headIndex,h=r.tailIndex,d=r.firstIndex,p=this._glInstanceBufferLayout,v=function(e,n){(0,Hi.XP)(o,li.i,r.buffer,p,e),l.drawArraysInstanced(t.primitiveType,0,i.vertexCount,n-e),(0,Hi.UF)(o,li.i,r.buffer,p)};i.material.parameters.transparent&&null!=d?c>h?((0,di.hu)(d>=h&&d<=c,"invalid firstIndex"),v(d,c),v(h,d)):c<h&&(d<=c?((0,di.hu)(d>=0&&d<=c,"invalid firstIndex"),v(d,c),v(h,u),v(0,d)):((0,di.hu)(d>=h&&d<=u,"invalid firstIndex"),v(d,u),v(0,c),v(h,d))):c>h?v(h,c):c<h&&(v(0,c),v(h,u)),o.bindVAO(null)}}}]),r}(ti.Z);function qi(e,t,r){var i=e.allocateHead();!function(e,t,r,i){(0,Ni.EE)(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,e.model,t),r.modelNormal.copyFrom(i,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(i,e.color,t),e.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,e.objectAndLayerIdColor,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,e.featureAttribute,t)}(t,r,e.view,i)}(0,ei._)([(0,ri.Cb)({constructOnly:!0})],ji.prototype,"symbol",void 0),(0,ei._)([(0,ri.Cb)({constructOnly:!0})],ji.prototype,"optionalFields",void 0),(0,ei._)([(0,ri.Cb)({constructOnly:!0})],ji.prototype,"metadata",void 0),(0,ei._)([(0,ri.Cb)({constructOnly:!0})],ji.prototype,"shaderTransformation",void 0),(0,ei._)([(0,ri.Cb)()],ji.prototype,"_instanceData",void 0),(0,ei._)([(0,ri.Cb)()],ji.prototype,"_cycleStartIndex",void 0),(0,ei._)([(0,ri.Cb)({readOnly:!0})],ji.prototype,"_enableLevelSelection",null),(0,ei._)([(0,ri.Cb)()],ji.prototype,"_updateCyclesWithStaticCamera",void 0),(0,ei._)([(0,ri.Cb)({readOnly:!0})],ji.prototype,"running",null),ji=(0,ei._)([(0,ii.j)("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],ji);var Yi=(0,x.c)(),Ji=(0,nt.c)(),Xi=(0,W.c)(),Qi=(0,x.c)(),Ki=(0,x.c)(),$i=[(0,nt.f)(1,0,1,1),(0,nt.f)(0,0,1,1),(0,nt.f)(0,1,0,1),(0,nt.f)(1,1,0,1),(0,nt.f)(1,0,0,1)],en=new Gi.Qm,tn=(0,l.Z)((function e(t,r,i,n,a,o,l,u,c,h,d,p){(0,s.Z)(this,e),this.lodResources=t,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=n,this.resourceSize=a,this.isEsriSymbolResource=o,this.isWosr=l,this.resourceBoundingBox=u,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=d,this.pivotOffset=p})),rn=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,i,n,a))._resources=null,o._optionalFields=new Array,o._instanceIndexToGraphicUid=new Map,o._hasLoadedPBRTextures=!1,o._disposeResourceHandles=new Array,o.ensureDrapedStatus(!1),o._hasLoadedPBRTextures=n.physicalBasedRenderingEnabled,o}return(0,l.Z)(r,[{key:"getCachedSize",value:function(){var e=(0,f.pC)(this._resources)?this._resources.symbolSize:[1,1,1],t=(0,Mr.Z)(e,3);return{width:t[0],depth:t[1],height:t[2]}}},{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._drivenProperties.size){e.next=3;break}if(!(0,ee.bh)(this.symbolLayer)){e.next=3;break}throw new Error;case 3:if(r=this.symbolLayer,!this._isPrimitive){e.next=11;break}return i=r.resource?r.resource.primitive:zr.S,e.next=8,this._createResourcesForPrimitive(i,t);case 8:this._resources=e.sent,e.next=14;break;case 11:return e.next=13,this._createResourcesForUrl(r.resource.href,t);case 13:this._resources=e.sent;case 14:this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity();case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extentPadding",get:function(){return(0,f.pC)(this._resources)?this._resources.extentPadding:0}},{key:"_isPrimitive",get:function(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}},{key:"lodRenderer",get:function(){return(0,f.pC)(this._resources)?this._resources.lodRenderer:null}},{key:"_setMaterialTransparencyParams",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,f.U2)(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(t),i=r<1||this.needsDrivenTransparentPass;return e.transparent=i,e.opacity=r,e.cullFace=i?Oe.Vr.None:Oe.Vr.Back,e}},{key:"_createResourcesForPrimitive",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var i,n,o,s,l,u,c,h,d,p,v,y,m,g,_,S,C,T,O,w,A;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,Qr.F)(t)){e.next=2;break}throw new Error("Unknown object symbol primitive: ".concat(t));case 2:if(i=this.symbolLayer,n=(0,P.Ue)((0,Fr.Uz)(t)),o=(0,x.d)((0,P.dp)(n)),s=(0,x.d)((0,Fr.$K)(o,i)),l=(0,b.l)(s),u=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:x.O,diffuse:x.O,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},d=!!h.usePBR,this._setMaterialTransparencyParams(h),"point-3d"===(p=this.symbol).type&&p.verticalOffset&&(v=p.verticalOffset,y=v.screenLength,m=v.minWorldLength,g=v.maxWorldLength,h.verticalOffset={screenLength:(0,tt.F2)(y),minWorldLength:m||0,maxWorldLength:(0,f.pC)(g)?g:1/0},h.castShadows=!1),this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color?h.externalColor=nt.O:(_=(0,f.pC)(i.material)?i.material.color:null,S=(0,f.pC)(_)?et.Z.toUnitRGBA(_):nt.O,h.externalColor=S),this._fastUpdates=Rt(this._context.renderer,this._fastVisualVariableConvertOptions(n,s,o,f.YP)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color")),(0,z.Z)("enable-feature:objectAndLayerId-rendering")&&(h.instanced.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor")),C=new ke.Gp(h),T=(0,Qr.t)(t,C)){e.next=11;break}throw new Error("Unknown object symbol primitive: ".concat(t));case 11:return O=(0,qr.aH)(T).map((function(e){return{opacity:1,transparent:e.parameters.transparent}})),e.next=14,this._createStageResources(T,d,r);case 14:return w=e.sent,e.next=17,this._createLodRenderer(T,r);case 17:return A=e.sent,e.abrupt("return",new tn(T,A,w,O,o,u,c,n,s,l,d,f.YP));case 19:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createResourcesForUrl",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var i,n,o,s,l,u,c,h,d,p,v,y,m,g,_,S,C,T,O,w,A,k,E,R,L,I,Z,D=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={materialParamsMixin:{instanced:i=["transformation"],hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache},this._fastUpdates=Rt(this._context.renderer,this._fastVisualVariableConvertOptions(f.YP,f.YP,f.YP,f.YP)),this._fastUpdates.enabled?(Object.assign(n.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(i.push("color"),this._optionalFields.push("color")),(0,z.Z)("enable-feature:objectAndLayerId-rendering")&&(i.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor")),"point-3d"===(o=this.symbol).type&&o.verticalOffset&&(s=o.verticalOffset,l=s.screenLength,u=s.minWorldLength,c=s.maxWorldLength,n.materialParamsMixin.verticalOffset={screenLength:(0,tt.F2)(l),minWorldLength:u||0,maxWorldLength:(0,f.pC)(c)?c:1/0},n.materialParamsMixin.castShadows=!1),n.signal=r,n.usePBR=this._context.physicalBasedRenderingEnabled,n.skipHighLods=this._context.skipHighSymbolLods,h=n.usePBR,e.next=8,(0,Xr.fetch)(t,n);case 8:return d=e.sent,p=d.isEsriSymbolResource,v=d.isWosr,(y=Yr(d.lods)).levels.sort((function(e,t){return e.minScreenSpaceRadius-t.minScreenSpaceRadius})),m=this._context,g=this.symbolLayer.material,_=this._getExternalColorParameters(g),S=(0,f.U2)(this.symbolLayer,"material","color"),C=this._getCombinedOpacity(S,{hasIntrinsicColor:!0}),T=this.needsDrivenTransparentPass,O=(0,qr.aH)(y),w=(0,qr.aH)(y).map((function(e){return{opacity:e.parameters.opacity||1,transparent:e.parameters.transparent}})),O.forEach((function(e){var t=e.parameters;e.setParameters(_);var r=t.opacity*C,i=r<1||T||t.transparent;e.setParameters({opacity:r,transparent:i}),m.screenSizePerspectiveEnabled&&e.setParameters({screenSizePerspective:m.sharedResources.screenSizePerspectiveSettings})})),A=d.referenceBoundingBox,k=(0,x.d)((0,P.dp)(A)),E=(0,x.d)(y.levels[0].pivotOffset),R=(0,x.d)((0,Fr.$K)(k,this.symbolLayer)),L=(0,b.l)(R),Lt(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(A,R,k,E))&&O.forEach((function(e){return e.setParameters(D._fastUpdates.materialParameters)})),e.next=19,this._createStageResources(y,h,r);case 19:return I=e.sent,e.next=22,this._createLodRenderer(y,r);case 22:return Z=e.sent,e.abrupt("return",new tn(y,Z,I,w,k,p,v,A,R,L,h,E));case 24:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_addDisposeResource",value:function(e){this._disposeResourceHandles.push(e)}},{key:"_createStageResources",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,i){var n,o,s,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._context.stage,o=(0,qr.aH)(t),r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),n.addMany(o),this._addDisposeResource((function(){return n.removeMany(o)})),s=(0,qr.VQ)(t),n.addMany(s),this._addDisposeResource((function(){return n.removeMany(s)})),e.next=7,n.load(s,i);case 7:return(0,v.k_)(i),l=(0,qr.ci)(t),e.abrupt("return",(n.addMany(l),this._addDisposeResource((function(){return n.removeMany(l)})),{materials:o,textures:s,geometries:l}));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_createLodRenderer",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var i,n,o,s,l=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this._context.stage,n={layerUid:this._context.layer.uid,graphicUid:function(e){return l._instanceIndexToGraphicUid.get(e)},notifyGraphicGeometryChanged:function(e){return l._context.notifyGraphicGeometryChanged(l._instanceIndexToGraphicUid.get(e))},notifyGraphicVisibilityChanged:function(e){return l._context.notifyGraphicVisibilityChanged(l._instanceIndexToGraphicUid.get(e))}},o=this._fastUpdates.enabled?{applyTransform:function(e,t,r){e.getFeatureAttribute(t,sn),(0,H.c)(r,Dt(l._fastUpdates.materialParameters,sn,r))},scaleFactor:function(e,t,r){return t.getFeatureAttribute(r,sn),Mt(e,l._fastUpdates.materialParameters,sn)}}:null,(s=new ji({symbol:t,optionalFields:this._optionalFields,metadata:n,shaderTransformation:o},this._context.scheduler)).slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource((function(){i.removeRenderPlugin(s),s.destroy()})),e.next=5,i.addRenderPlugin(s.slots,s,r);case 5:return e.abrupt("return",s);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getExternalColorParameters",value:function(e){var t={};return this._drivenProperties.color?t.externalColor=nt.O:(0,f.pC)(e)&&(0,f.pC)(e.color)?t.externalColor=et.Z.toUnitRGBA(e.color):(t.externalColor=nt.O,t.colorMixMode="ignore"),t}},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._cleanupResources()}},{key:"_cleanupResources",value:function(){this._disposeResourceHandles.forEach((function(e){return e()})),this._disposeResourceHandles.length=0,this._resources=null}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry))return null;var r=(0,mt.S_)(t.geometry);if((0,f.Wi)(r))return this.logger.warn("unsupported geometry type for icon symbol: ".concat(t.geometry.type)),null;var i=this.setGraphicElevationContext(t,new K.o),n=e.renderingInfo;return this._createAs3DShape(t,r,n,i,t.uid,e.layer.uid)}},{key:"notifyDestroyGraphicLayer",value:function(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}},{key:"graphicLayerToGraphicId",value:function(){return 0}},{key:"layerOpacityChanged",value:function(){if(!(0,f.Wi)(this._resources))for(var e=this._drivenProperties.opacity,t=!this._isPrimitive,r=this._resources.stageResources.materials,i=this._resources.originalMaterialParameters,n=0;n<r.length;n++){var a=r[n],o=(0,f.U2)(this.symbolLayer,"material","color"),s=i[n],l=this._getCombinedOpacity(o,{hasIntrinsicColor:t})*s.opacity,u=l<1||e||s.transparent;a.setParameters({opacity:l,transparent:u}),this._isPrimitive&&a.setParameters({cullFace:u?Oe.Vr.None:Oe.Vr.Back})}}},{key:"layerElevationInfoChanged",value:function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Q.B5)}},{key:"slicePlaneEnabledChanged",value:function(){if((0,f.Wi)(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;var e,t=(0,i.Z)(this._resources.stageResources.materials);try{for(t.s();!(e=t.n()).done;){e.value.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}}catch(r){t.e(r)}finally{t.f()}return!0}},{key:"physicalBasedRenderingChanged",value:function(){if((0,f.Wi)(this._resources))return!0;var e,t=this._resources,r=t.stageResources,n=t.isWosr,a=(0,i.Z)(r.materials);try{for(a.s();!(e=a.n()).done;){var o=e.value;this._isPrimitive?o.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):n||o.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1})}}catch(s){a.e(s)}finally{a.f()}return!1!==this._hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this._hasLoadedPBRTextures=!0,!1)}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"skipHighSymbolLodsChanged",value:function(){return!1}},{key:"applyRendererDiff",value:function(e,t){if((0,f.Wi)(this._resources))return te.W.Recreate_Symbol;var r=this._resources,n=r.stageResources.materials,a=r.lodRenderer,o=r.resourceBoundingBox,s=r.symbolSize,l=r.resourceSize,u=r.pivotOffset;for(var c in e.diff){if("visualVariables"!==c)return te.W.Recreate_Symbol;if(!Lt(this._fastUpdates,t,this._fastVisualVariableConvertOptions(o,s,l,u)))return te.W.Recreate_Symbol;var h,d=(0,i.Z)(n);try{for(d.s();!(h=d.n()).done;){h.value.setParameters(this._fastUpdates.materialParameters)}}catch(p){d.e(p)}finally{d.f()}a.notifyShaderTransformationChanged()}return te.W.Fast_Update}},{key:"computeComplexity",value:function(){if((0,f.Wi)(this._resources))return(0,u.Z)((0,c.Z)(r.prototype),"computeComplexity",this).call(this);var e=this._resources.lodResources,t=(0,qr.VV)(e.levels[0]).reduce((function(e,t){return e+t.indices.get(ae.T.POSITION).length}),0)/3,i=(0,qr.VQ)(e).reduce((function(e,t){return e+(t.params.encoding&&"image/ktx2"===t.params.encoding?t.estimatedTexMemRequired:t.estimatedTexMemRequired/4)}),0)+(0,qr.ci)(e).reduce((function(e,t){return e+function(e){return Array.from(e.vertexAttributes.values()).reduce((function(e,t){var r,i;return e+(null!==(r=null===(i=t.data.buffer)||void 0===i?void 0:i.byteLength)&&void 0!==r?r:0)}),0)+Array.from(e.indices.values()).reduce((function(e,t){return e+(Array.isArray(t)?12*t.length:t.buffer.byteLength)}),0)}(t)}),0);return{primitivesPerFeature:t,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:(0,M.Z)((0,M.Z)({},(0,Kr.BN)(this.symbol,this.symbolLayer)),{},{resourceBytes:i})}}},{key:"_hasLodRenderer",value:function(){return(0,f.pC)(this._resources)}},{key:"_createAs3DShape",value:function(e,t,r,i,n,a){if(!this._hasLodRenderer()||(0,f.Wi)(this._resources))return null;var o=this.getFastUpdateAttrValues(e),s=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?(0,ee.Uu)(r.color,r.opacity):null,l=this._context.clippingExtent;if((0,C.KC)(t,nn,this._context.elevationProvider.spatialReference),(0,f.pC)(l)&&!(0,P.BD)(l,nn))return null;var u=this._requiresTerrainElevation(i),c=this._computeGlobalTransform(t,i,on,ln),h=this._computeLocalTransform(this._resources,this.symbolLayer,r,an),d=this._resources.lodRenderer.instanceData,p=d.addInstance();this._instanceIndexToGraphicUid.set(p,n),d.setLocalTransform(p,h,!1),d.setGlobalTransform(p,c),o&&d.setFeatureAttribute(p,o),s&&d.setColor(p,s),(0,f.pC)(this._context.stage.renderView.objectAndLayerIdRenderHelper)&&d.setObjectAndLayerIdColor(p,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:a}));var v=new Vr(this,p,ct.RX,i);return u&&(v.alignedSampledElevation=ln.sampledElevation),v.needsElevationUpdates=(0,Q.B5)(i.mode),(0,mt.dO)(v,t,this._context.elevationProvider),v}},{key:"_computeGlobalTransform",value:function(e,t,r,i){return(0,Q.qZ)(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,i),nn[0]=e.x,nn[1]=e.y,nn[2]=i.z,(0,C.Bm)(e.spatialReference,nn,r,this._context.renderCoordsHelper.spatialReference),r}},{key:"_computeLocalTransform",value:function(e,t,r,i){return(0,H.i)(i),this._applyObjectRotation(r,!1,i),this._applyObjectRotation(t,!0,i),this._applyObjectScale(e,r,i),this._applyAnchor(e,t,i),i}},{key:"_applyObjectScale",value:function(e,t,r){if(!this._fastUpdates.enabled||!this._fastUpdates.requiresShaderTransformation){var i=this._drivenProperties.size&&t.size?t.size:e.symbolSize,n=(0,ee.bD)(i,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===n[0]&&1===n[1]&&1===n[2]||(0,H.k)(r,r,n)}}},{key:"prepareSymbolLayerPatch",value:function(e){if("partial"===e.diff.type){var t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}}},{key:"updateGeometry",value:function(e,t){if((0,f.Wi)(this._resources))return!0;var r=t&&(0,mt.S_)(t);if((0,f.Wi)(r))return!1;var i=this.getGeometryElevationMode(t);return e.elevationContext.mode===i&&(this._computeGlobalTransform(r,e.elevationContext,on,ln),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=ln.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,on,!0),(0,mt.dO)(e,r,this._context.elevationProvider),!0)}},{key:"_preparePatchTransform",value:function(e,t){var r=this;if((t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition)&&!(0,f.Wi)(this._resources)){var i=function(e,t,r){return(0,f.Pt)(null!=e&&"complete"===e.type?e.newValue:t,r)},n=i(t.heading,this.symbolLayer.heading,0),a=i(t.tilt,this.symbolLayer.tilt,0),o=i(t.roll,this.symbolLayer.roll,0),s=i(t.width,this.symbolLayer.width,void 0),l=i(t.height,this.symbolLayer.height,void 0),u=i(t.depth,this.symbolLayer.depth,void 0),c=i(t.anchor,this.symbolLayer.anchor,void 0),h=i(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;var d={heading:n,tilt:a,roll:o,anchor:c,anchorPosition:h},p=this._resources;this.loadStatus===jr.P.LOADED&&e.symbolLayerStatePatches.push((function(){p.symbolSize=(0,x.d)((0,Fr.$K)(p.resourceSize,{width:s,height:l,depth:u,isPrimitive:r.symbolLayer.isPrimitive}))})),e.graphics3DGraphicPatches.push((function(e,t){var i=r._computeLocalTransform(p,d,t,an),n=e.instanceIndex;p.lodRenderer.instanceData.setLocalTransform(n,i,!0)}))}}},{key:"_preparePatchColor",value:function(e,t){var r=this;if(t.material&&"partial"===t.material.type){var n=t.material.diff;if(n.color&&"complete"===n.color.type&&null!=n.color.newValue&&null!=n.color.oldValue){var a=n.color.newValue,o=(0,f.pC)(a)?et.Z.toUnitRGBA(a):nt.O;delete n.color;var s=this._resources;(0,f.Wi)(s)||e.graphics3DGraphicPatches.push((function(e){var t;r._hasPerInstanceColor()?(s.lodRenderer.instanceData.setColor(e.instanceIndex,o),t=r._setMaterialTransparencyParams({},a)):t=r._setMaterialTransparencyParams({externalColor:o},a);var n,l=(0,i.Z)(s.stageResources.materials);try{for(l.s();!(n=l.n()).done;){n.value.setParameters(t)}}catch(u){l.e(u)}finally{l.f()}}))}}}},{key:"_requiresTerrainElevation",value:function(e){return"absolute-height"!==e.mode}},{key:"_applyObjectRotation",value:function(e,t,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&t))return(0,ee._Z)(e.heading,e.tilt,e.roll,r)}},{key:"_computeAnchor",value:function(e,t,r){var i=(0,x.c)();switch(r.anchor){case"center":(0,b.c)(i,(0,P.be)(e)),(0,b.o)(i,i);break;case"top":var n=(0,P.be)(e);(0,b.s)(i,-n[0],-n[1],-e[5]);break;case"bottom":var a=(0,P.be)(e);(0,b.s)(i,-a[0],-a[1],-e[2]);break;case"relative":var o=(0,P.be)(e),s=(0,P.dp)(e),l=r.anchorPosition,u=l?(0,x.f)(l.x,l.y,l.z):x.Z;(0,b.B)(i,s,u),(0,b.a)(i,i,o),(0,b.o)(i,i);break;default:(0,f.pC)(t)?(0,b.o)(i,t):(0,b.c)(i,x.Z)}return i}},{key:"_applyAnchor",value:function(e,t,r){if(!this._fastUpdates.enabled||!this._fastUpdates.requiresShaderTransformation){var i=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,t);i&&(0,H.w)(r,r,i)}}},{key:"_hasPerInstanceColor",value:function(){return this._drivenProperties.color||this._drivenProperties.opacity}},{key:"_fastVisualVariableConvertOptions",value:function(e,t,r,i){var n=(0,f.pC)(e)?(0,x.d)((0,P.dp)(e)):x.O,a=(0,f.pC)(e)?this._computeAnchor(e,i,this.symbolLayer):x.Z,o=this._context.renderCoordsHelper.unitInMeters,s=(0,ee.bD)((0,f.pC)(t)?t:void 0,t,r,o),l=(0,x.f)(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:(0,f.pC)(t)?t:x.O,unitInMeters:o,transformation:{anchor:a,scale:s,rotation:l}}}}]),r}($.k),nn=(0,x.c)(),an=(0,W.c)(),on=(0,W.c)(),sn=(0,nt.c)(),ln=new Q.Lm,un=r(26277);function cn(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function hn(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],l=r[1],u=r[2],c=r[3];return e[0]=i*s+a*l,e[1]=n*s+o*l,e[2]=i*u+a*c,e[3]=n*u+o*c,e}function dn(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}var pn,fn=hn,vn=dn,yn=(Object.freeze(Object.defineProperty({__proto__:null,LDU:function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},adjoint:function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},equals:function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],o=t[0],s=t[1],l=t[2],u=t[3],c=(0,un.g)();return Math.abs(r-o)<=c*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=c*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-l)<=c*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-u)<=c*Math.max(1,Math.abs(a),Math.abs(u))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},fromRotation:function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},invert:function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*a-n*i;return o?(o=1/o,e[0]=a*o,e[1]=-i*o,e[2]=-n*o,e[3]=r*o,e):null},mul:fn,multiply:hn,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},rotate:function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+a*s,e[1]=n*l+o*s,e[2]=i*-s+a*l,e[3]=n*-s+o*l,e},scale:function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],l=r[1];return e[0]=i*s,e[1]=n*s,e[2]=a*l,e[3]=o*l,e},set:cn,str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},sub:vn,subtract:dn,transpose:function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}},Symbol.toStringTag,{value:"Module"})),r(53727)),mn=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a,o,l,u,c){var h;return(0,s.Z)(this,r),(h=t.call(this,e,i,n,null,ie.U.Mesh,c)).path=a,h.geometrySR=o,h.upVectorAlignment=l,h.stencilWidth=u,h}return(0,l.Z)(r)}(ne.Z);function gn(e){return"upVectorAlignment"in e}function _n(){return[1,0,0,1]}!function(e){e[e.World=0]="World",e[e.Path=1]="Path"}(pn||(pn={}));Object.freeze(Object.defineProperty({__proto__:null,clone:function(e){return[e[0],e[1],e[2],e[3]]},create:_n,createView:function(e,t){return new Float64Array(e,t,4)},fromValues:function(e,t,r,i){return[e,t,r,i]}},Symbol.toStringTag,{value:"Module"}));var bn=r(55652),xn=r(40885);function Sn(){return{up:(0,x.c)(),right:(0,x.c)()}}function Cn(e,t,r){(0,b.m)(e.up,t.up,r),(0,b.m)(e.right,t.right,r)}function Pn(e,t,r){(0,g.s)(e,(0,b.e)(r,t.right),(0,b.e)(r,t.up))}var Tn=function(){function e(){(0,s.Z)(this,e),this.pos=(0,x.c)(),this.posES=(0,x.c)(),this.vLeft=(0,x.c)(),this.vRight=(0,x.c)(),this.vMinSiblingLength=0,this.frame=Sn(),this.rotationFrameUp=(0,x.c)(),this.rotationRight=(0,_.a)(),this.rotationAngle=0,this.miterStretch=[1,0,0,1],this.maxStretchDistance=0}return(0,l.Z)(e,[{key:"setFrameFromUpVector",value:function(e){(0,b.c)(this.frame.up,e),(0,b.a)(Wn,this.vLeft,this.vRight),(0,b.n)(Wn,Wn),(0,b.g)(Hn,this.frame.up,(0,b.e)(Wn,this.frame.up)),(0,b.b)(Yn,Wn,Hn),(0,b.n)(Yn,Yn),(0,b.f)(this.frame.right,Yn,this.frame.up)}}]),e}(),On=function(){function e(){(0,s.Z)(this,e),this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[]}return(0,l.Z)(e,[{key:"addVertex",value:function(e,t){return this.vertices.push((0,_.d)(e)),this.vertexNormals.push((0,_.d)(t)),this.vertices.length-1}},{key:"addPole",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.poles.push({position:(0,_.d)(e),normal:t?(0,_.d)(t):null}),this.poles.length-1}},{key:"addSegment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),t&&(this.poleIndices.push(t.v0),this.poleIndices.push(t.v1))}},{key:"numSegments",get:function(){return this.vertexIndices.length/2}},{key:"translate",value:function(e,t){var r,n=(0,i.Z)(this.vertices);try{for(n.s();!(r=n.n()).done;){var a=r.value;a[0]+=e,a[1]+=t}}catch(u){n.e(u)}finally{n.f()}var o,s=(0,i.Z)(this.poles);try{for(s.s();!(o=s.n()).done;){var l=o.value;l.position[0]+=e,l.position[1]+=t}}catch(u){s.e(u)}finally{s.f()}}}]),e}();function wn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=.5,r=new On,i={v0:0,v1:0};r.addPole((0,_.f)(0,0));for(var n=0;n<e;++n){var a=2*n*Math.PI/e,o=Math.cos(a),s=Math.sin(a),l=(0,_.f)(o*t,s*t),u=(0,_.f)(o,s);r.addVertex(l,u)}for(var c=0;c<e-1;++c){var h={v0:c,v1:c+1};r.addSegment(h,i)}var d={v0:e-1,v1:0};return r.addSegment(d,i),r}function An(){var e=new On,t=(0,_.f)(-.5,-.5),r=(0,_.f)(.5,-.5),i=(0,_.f)(.5,.5),n=(0,_.f)(-.5,.5),a=(0,_.f)(0,-1),o=(0,_.f)(1,0),s=(0,_.f)(0,1),l=(0,_.f)(-1,0);return e.addPole((0,_.f)(0,.5),s),e.addPole((0,_.f)(0,.5)),e.addPole((0,_.f)(0,-.5)),e.addPole((0,_.f)(0,-.5),a),e.addVertex(t,a),e.addVertex(r,a),e.addSegment({v0:0,v1:1},{v0:3,v1:3}),e.addVertex(r,o),e.addVertex(i,o),e.addSegment({v0:2,v1:3},{v0:2,v1:1}),e.addVertex(i,s),e.addVertex(n,s),e.addSegment({v0:4,v1:5},{v0:0,v1:0}),e.addVertex(n,l),e.addVertex(t,l),e.addSegment({v0:6,v1:7},{v0:1,v1:2}),e}var kn=function(){function e(t){(0,s.Z)(this,e),this.vertices=t,this.offset=(0,x.c)(),this.xform=(0,W.c)();var r=Math.floor((t.length-1)/2);(0,b.c)(this.offset,this.vertices[r].pos);var n,a=(0,i.Z)(this.vertices);try{for(a.s();!(n=a.n()).done;){var o=n.value;(0,b.b)(o.pos,o.pos,this.offset)}}catch(l){a.e(l)}finally{a.f()}(0,H.w)(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}return(0,l.Z)(e,[{key:"updatePathVertexInformation",value:function(){var e=this.vertices.length,t=this.vertices[0];t.index=0,t.vLeft=(0,x.c)(),(0,b.b)(t.vRight,this.vertices[1].pos,t.pos);var r=(0,b.l)(t.vRight);t.vMinSiblingLength=r,(0,b.n)(t.vRight,t.vRight);for(var i=t,n=1;n<e;++n){var a=this.vertices[n];if(a.index=n,a.vLeft=i.vRight,n<e-1){(0,b.b)(a.vRight,this.vertices[n+1].pos,a.pos);var o=(0,b.l)(a.vRight);a.vMinSiblingLength=Math.min(r,o),r=o,(0,b.n)(a.vRight,a.vRight)}else(0,b.c)(a.vRight,a.vLeft),a.vMinSiblingLength=r;i=a}}}]),e}();var En=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,[{key:"numProfilesPerJoin",value:function(){return 1}},{key:"extrude",value:function(e,t,r){for(var i=0;i<t.vertices.length;++i)r(e.index,e.frame,t.vertices[i],t.vertexNormals[i],!1)}}]),e}(),Rn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.8*Math.PI,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;(0,s.Z)(this,e),this.cutoffAngle=t,this.numBendSubdivisions=r}return(0,l.Z)(e,[{key:"numProfilesPerJoin",value:function(){return this.numBendSubdivisions+1}},{key:"extrude",value:function(e,t,r){var i=Jn;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(var n=0;n<this.numBendSubdivisions+1;++n){(0,H.d)(Xn,.5*-e.rotationAngle+n*e.rotationAngle/this.numBendSubdivisions,e.rotationFrameUp),Cn(i,e.frame,Xn);for(var a=0;a<t.vertices.length;++a)(0,g.h)(t.vertices[a],e.rotationRight)*e.rotationAngle>=0?r(e.index,i,t.vertices[a],t.vertexNormals[a],!1):((0,g.q)(Nn,t.vertices[a],e.miterStretch),r(e.index,e.frame,Nn,t.vertexNormals[a],!0))}else for(var o=0;o<this.numBendSubdivisions+1;++o)for(var s=0;s<t.vertices.length;++s){var l=(0,g.h)(t.vertices[s],e.rotationRight)*e.rotationAngle>=0;(0,g.q)(Nn,t.vertices[s],e.miterStretch),r(e.index,e.frame,Nn,t.vertexNormals[s],!l)}}}]),e}(),Ln=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,[{key:"rebuildConnectingProfileGeometry",value:function(e,t,r){for(var i=0;i<t.vertices.length;++i)r(e.index,e.frame,t.vertices[i],t.vertexNormals[i],0,0)}}]),e}(),In=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.call(this)}return(0,l.Z)(r,[{key:"getNumVertices",value:function(){return 0}},{key:"getNumIndices",value:function(){return 0}},{key:"rebuildCapGeometry",value:function(){}},{key:"buildTopology",value:function(){}}]),r}(Ln),Zn=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,s.Z)(this,r),(i=t.call(this)).profile=e,i.profilePlaneOffset=n,i.flip=a,i}return(0,l.Z)(r,[{key:"getNumVertices",value:function(){return this.profile.vertices.length}},{key:"getNumIndices",value:function(){return 3*this.profile.numSegments}},{key:"rebuildConnectingProfileGeometry",value:function(e,t,r){for(var i=0;i<t.vertices.length;++i)r(e.index,e.frame,t.vertices[i],t.vertexNormals[i],this.profilePlaneOffset,0)}},{key:"rebuildCapGeometry",value:function(e,t){var r=Gn;(0,g.s)(r,0,0);for(var i=this.flip?1:-1,n=0;n<this.profile.vertices.length;++n)t(e.index,e.frame,this.profile.vertices[n],r,this.profilePlaneOffset,i)}},{key:"buildTopology",value:function(e,t){for(var r=this.vertexBufferStart+this.profile.vertexIndices[0],i=1;i<this.profile.numSegments;++i){var n=this.profile.vertexIndices[2*i+0],a=this.profile.vertexIndices[2*i+1],o=this.vertexBufferStart+n,s=this.vertexBufferStart+a;this.flip?t(s,o,r):t(r,o,s)}}}]),r}(Ln),Dn=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var i;return(0,s.Z)(this,r),(i=t.call(this)).flip=!1,i.sign=0,i.breakNormals=!1,i.numSegments=3,i.profile=e.profile,i.flip=e.flip,i.sign=i.flip?1:-1,i.breakNormals=e.breakNormals,i.numSegments=e.subdivisions,i}return(0,l.Z)(r,[{key:"getNumVertices",value:function(){var e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+=this.profile.poles.length}},{key:"getNumIndices",value:function(){var e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(var t=0;t<this.profile.numSegments;++t){var r=this.profile.vertexIndices[2*t+0],i=this.profile.vertexIndices[2*t+1];this.profile.poleIndices[r]===this.profile.poleIndices[i]?e+=1:e+=2}return 3*e}},{key:"rebuildCapGeometry",value:function(e,t){var r=e.frame,i=.5*this.sign,n=Nn,a=Gn;(0,g.s)(a,0,0);for(var o=0;o<this.profile.poles.length;++o){var s=this.profile.poles[o];s.normal?t(e.index,r,s.position,s.normal,i,0):t(e.index,r,s.position,a,i,this.sign)}if(this.breakNormals)for(var l=0;l<this.profile.vertices.length;++l)t(e.index,r,this.profile.vertices[l],this.profile.vertexNormals[l],0,0);for(var u=0;u<this.numSegments-1;++u)for(var c=(1-(u+1)/this.numSegments)*Math.PI*.5,h=Math.sin(c),d=Math.cos(c),p=0;p<this.profile.vertices.length;++p){var f=this.profile.poles[this.profile.poleIndices[p]];(0,g.a)(n,this.profile.vertices[p],f.position),(0,g.b)(n,n,h),f.normal?((0,g.j)(n,n,f.position),t(e.index,r,n,f.normal,i*d,0)):((0,g.f)(a,n),(0,g.b)(a,a,h),(0,g.j)(n,n,f.position),t(e.index,r,n,a,i*d,this.sign*d))}}},{key:"buildTopology",value:function(e,t){for(var r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length,n=0;n<this.profile.numSegments;++n){for(var a=this.profile.vertexIndices[2*n+0],o=this.profile.vertexIndices[2*n+1],s=this.vertexBufferStart+this.profile.poleIndices[a],l=this.vertexBufferStart+this.profile.poleIndices[o],u=r+a,c=r+o,h=0;h<this.numSegments-1;++h){var d=i+h*this.profile.vertices.length+a,p=i+h*this.profile.vertices.length+o;this.flip?(t(d,c,u),t(c,d,p)):(t(u,c,d),t(p,d,c)),u=d,c=p}this.flip?(t(s,c,u),s!==l&&t(s,l,c)):(t(u,c,s),s!==l&&t(c,l,s))}}}]),r}(Ln),Mn=function(){function e(t,r,i,n,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};(0,s.Z)(this,e),this.options=o,this._extrusionVertexCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.profile=r,this.path=t,this.extruder=i,this.startCap=n,this.endCap=a;var l=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*l+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;var u=this.startCap.getNumVertices();this.numVerticesTotal+=u,this.numNormalsTotal+=u,this.endCap.vertexBufferStart=this.numVerticesTotal;var c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=(0,br.xx)(1*this.numVerticesTotal),this.profileRightAxisData=(0,br.xx)(4*this.numVerticesTotal),this.profileUpAxisData=(0,br.xx)(4*this.numVerticesTotal),this.profileVertexAndNormalData=(0,br.xx)(4*this.numVerticesTotal),this.originData=(0,br.xx)(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}return(0,l.Z)(e,[{key:"emitVertex",value:function(e,t,r,i,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=i[1],this.pathVertexData[this._extrusionVertexCount]=e,n){var a=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[0]*a.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[1]*a.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}},{key:"emitCapVertex",value:function(e,t,r,i,n,a){this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=i[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a,++this._extrusionVertexCount}},{key:"_rebuildGeometry",value:function(){var e=this,t=function(t,r,i,n,a){return e.emitVertex(t,r,i,n,a)},r=function(t,r,i,n,a,o){return e.emitCapVertex(t,r,i,n,a,o)};this._extrusionVertexCount=0;var n,a=(0,i.Z)(this.path.vertices);try{for(a.s();!(n=a.n()).done;){var o=n.value;this.originData[3*o.index+0]=o.pos[0],this.originData[3*o.index+1]=o.pos[1],this.originData[3*o.index+2]=o.pos[2]}}catch(l){a.e(l)}finally{a.f()}this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,r);for(var s=1;s<this.path.vertices.length-1;++s)this.extruder.extrude(this.path.vertices[s],this.profile,t);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,r),this.startCap.rebuildCapGeometry(this.path.vertices[0],r),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],r)}},{key:"buildTopology",value:function(){var e=this,t=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1,n=r*i*2*3;this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=t*(this.numExtrusionProfiles-1);for(var a=new Array,o=new Array,s=new Array,l=function(t,r,i){a.push(t),a.push(r),a.push(i),o.push(t),o.push(r),o.push(i),s.push(e.pathVertexData[t]),s.push(e.pathVertexData[r]),s.push(e.pathVertexData[i])},u=0;u<r;++u)for(var c=this.profile.vertexIndices[2*u],h=this.profile.vertexIndices[2*u+1],d=0;d<i;++d){var p=d*t+c,f=(d+1)*t+h,v=d*t+h;l(p,(d+1)*t+c,f),l(p,f,v)}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=(0,xr.mi)(a),this.normalIndices=(0,xr.mi)(o),this.pathVertexIndices=(0,xr.mi)(s)}},{key:"onPathChanged",value:function(){this._rebuildGeometry()}}]),e}(),zn=function(){function e(t){(0,s.Z)(this,e),this.builder=t}return(0,l.Z)(e,[{key:"xform",get:function(){return this.builder.path.xform}},{key:"onPathChanged",value:function(){this.builder.onPathChanged()}}]),e}(),Fn=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var i;return(0,s.Z)(this,r),(i=t.call(this,e)).vertexAttributePosition=null,i.vertexAttributeNormal=null,i.vertexAttributeColor=null,i.vertexAttributePosition=(0,br.xx)(3*i.builder.numVerticesTotal),i.vertexAttributeNormal=(0,br.xx)(3*i.builder.numNormalsTotal),i.vertexAttributeColor=new Uint8Array(4),i.vertexAttributeColor[0]=255,i.vertexAttributeColor[1]=255,i.vertexAttributeColor[2]=255,i.vertexAttributeColor[3]=255,i}return(0,l.Z)(r,[{key:"bakeVertexColors",value:function(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}},{key:"bake",value:function(e){this.size=e;for(var t=0;t<this.builder.numVerticesTotal;++t){var r=this.builder.pathVertexData[t],i=0===r||r===this.builder.path.vertices.length-1;r*=3;var n=Vn;(0,b.s)(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);var a=4*t,o=Hn,s=Nn,l=Wn,u=jn,c=qn,h=0,d=0;if((0,b.s)(u,this.builder.profileRightAxisData[a],this.builder.profileRightAxisData[a+1],this.builder.profileRightAxisData[a+2]),(0,b.s)(c,this.builder.profileUpAxisData[a],this.builder.profileUpAxisData[a+1],this.builder.profileUpAxisData[a+2]),(0,g.s)(s,this.builder.profileVertexAndNormalData[a]*e[0],this.builder.profileVertexAndNormalData[a+1]*e[1]),i)(0,b.f)(l,c,u),h=this.builder.profileRightAxisData[a+3]*e[0],d=this.builder.profileUpAxisData[a+3];else{var p=Gn,f=Bn;(0,g.s)(p,this.builder.profileRightAxisData[a+3],this.builder.profileUpAxisData[a+3]);var v=(0,g.i)(p);(0,g.f)(p,p);var y=(0,g.h)(s,p);if(Math.abs(y)>v){(0,g.s)(f,-p[1],p[0]);var m=(0,g.h)(s,f);(0,g.b)(p,p,v*Math.sign(y)),(0,g.b)(f,f,m),(0,g.j)(s,p,f)}(0,b.s)(l,0,0,0)}(0,b.s)(o,u[0]*s[0]+c[0]*s[1],u[1]*s[0]+c[1]*s[1],u[2]*s[0]+c[2]*s[1]),this.vertexAttributePosition[3*t+0]=n[0]+o[0]+l[0]*h,this.vertexAttributePosition[3*t+1]=n[1]+o[1]+l[1]*h,this.vertexAttributePosition[3*t+2]=n[2]+o[2]+l[2]*h;var _=Nn;(0,g.s)(_,this.builder.profileVertexAndNormalData[a+2],this.builder.profileVertexAndNormalData[a+3]),this.vertexAttributeNormal[3*t+0]=u[0]*_[0]+c[0]*_[1]+l[0]*d,this.vertexAttributeNormal[3*t+1]=u[1]*_[0]+c[1]*_[1]+l[1]*d,this.vertexAttributeNormal[3*t+2]=u[2]*_[0]+c[2]*_[1]+l[2]*d}}},{key:"createGeometryData",value:function(){var e=[[ae.T.POSITION,this.builder.vertexIndices],[ae.T.NORMAL,this.builder.normalIndices]],t=[[ae.T.POSITION,new re.a(this.vertexAttributePosition,3,!0)],[ae.T.NORMAL,new re.a(this.vertexAttributeNormal,3,!0)]];if(this.vertexAttributeColor){var r=this.builder.vertexIndices.length;e.push([ae.T.COLOR,new Array(r).fill(0)]),t.push([ae.T.COLOR,new re.a(this.vertexAttributeColor,4)])}return{vertexAttributes:t,indices:e}}},{key:"onPathChanged",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"onPathChanged",this).call(this),this.bake(this.size)}},{key:"intersect",value:function(e,t,r){var i=this.builder.vertexIndices,n=new re.a(this.vertexAttributePosition,3),a=i.length/3;(0,Vi.CN)(e,t,0,a,i,n,void 0,void 0,r)}}]),r}(zn),Un=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a){var o;(0,s.Z)(this,r),(o=t.call(this,e)).sizeAttributeValue=i,o.colorAttributeValue=n,o.opacityAttributeValue=a,o.vvData=null,o.baked=new Fn(e),o.vvData=(0,br.xx)(4*o.builder.path.vertices.length);for(var l=0;l<o.builder.path.vertices.length;++l){o.vvData[4*l+0]=i,o.vvData[4*l+1]=n,o.vvData[4*l+2]=a;var u=0===l||l===o.builder.path.vertices.length-1;o.vvData[4*l+3]=u?1:0}return o}return(0,l.Z)(r,[{key:"createGeometryData",value:function(){return{vertexAttributes:[[ae.T.POSITION,new re.a(this.builder.originData,3,!0)],[ae.T.PROFILERIGHT,new re.a(this.builder.profileRightAxisData,4,!0)],[ae.T.PROFILEUP,new re.a(this.builder.profileUpAxisData,4,!0)],[ae.T.PROFILEVERTEXANDNORMAL,new re.a(this.builder.profileVertexAndNormalData,4,!0)],[ae.T.FEATUREVALUE,new re.a(this.vvData,4,!0)]],indices:[[ae.T.POSITION,this.builder.pathVertexIndices],[ae.T.PROFILERIGHT,this.builder.vertexIndices],[ae.T.PROFILEUP,this.builder.vertexIndices],[ae.T.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[ae.T.FEATUREVALUE,this.builder.pathVertexIndices]]}}}]),r}(zn),Vn=(0,x.c)(),Nn=(0,_.a)(),Gn=(0,_.a)(),Bn=(0,_.a)(),Hn=(0,x.c)(),Wn=(0,x.c)(),jn=(0,x.c)(),qn=(0,x.c)(),Yn=(0,x.c)(),Jn=Sn(),Xn=(0,W.c)(),Qn=r(96658),Kn=r(23620),$n=r(56529),ea=r(12594),ta=r(75027),ra=r(41481),ia=r(82144),na=r(31132),aa=r(33559),oa=r(78041),sa=r(27627),la=r(50411),ua=r(25920),ca=r(8883),ha=r(21841),da=r(49800),pa=r(36207),fa=new Map([[ae.T.POSITION,0],[ae.T.PROFILERIGHT,1],[ae.T.PROFILEUP,2],[ae.T.PROFILEVERTEXANDNORMAL,3],[ae.T.FEATUREVALUE,4]]),va=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).ambient=(0,x.f)(.2,.2,.2),e.diffuse=(0,x.f)(.8,.8,.8),e.specular=(0,x.f)(0,0,0),e.opacity=1,e}return(0,l.Z)(r)}(ta.C),ya=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"initializeConfiguration",value:function(e,t){t.hasWebGL2Context=e.rctx.type===da.zO.WEBGL2,t.spherical=e.viewingMode===X.JY.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}},{key:"initializeProgram",value:function(e){return new sa.$(e.rctx,r.shader.get().build(this.configuration),fa)}},{key:"initializePipeline",value:function(){var e=this.configuration.transparencyPassType,t=this.configuration,r=e===ua.A.NONE,i=e===ua.A.FrontFace;return(0,pa.sm)({blending:t.output!==oi.H.Color&&t.output!==oi.H.Alpha||!t.transparent?null:r?oa.wu:(0,oa.j7)(e),culling:t.hasSlicePlane&&!t.transparent&&t.doubleSidedMode!==Qn.q.None?pa.sg:null,depthTest:{func:(0,oa.Bh)(e)},depthWrite:r||i?pa.LZ:null,colorWrite:pa.BK,stencilWrite:t.hasOccludees?la.s3:null,stencilTest:t.hasOccludees?la.RY:null,polygonOffset:r||i?null:oa.E0})}}]),r}(na.A);ya.shader=new ia.J(ha.P,(function(){return r.e(24321).then(r.bind(r,24321))}));var ma=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).output=oi.H.Color,e.doubleSidedMode=Qn.q.None,e.transparencyPassType=ua.A.NONE,e.spherical=!1,e.receiveShadows=!1,e.receiveAmbientOcclusion=!1,e.vvSize=!1,e.vvColor=!1,e.vvOpacity=!1,e.hasSlicePlane=!1,e.transparent=!1,e.hasOccludees=!1,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e.doublePrecisionRequiresObfuscation=!1,e}return(0,l.Z)(r)}(ca.W);(0,ei._)([(0,aa.o)({count:oi.H.COUNT})],ma.prototype,"output",void 0),(0,ei._)([(0,aa.o)({count:Qn.q.COUNT})],ma.prototype,"doubleSidedMode",void 0),(0,ei._)([(0,aa.o)({count:ua.A.COUNT})],ma.prototype,"transparencyPassType",void 0),(0,ei._)([(0,aa.o)()],ma.prototype,"spherical",void 0),(0,ei._)([(0,aa.o)()],ma.prototype,"receiveShadows",void 0),(0,ei._)([(0,aa.o)()],ma.prototype,"receiveAmbientOcclusion",void 0),(0,ei._)([(0,aa.o)()],ma.prototype,"vvSize",void 0),(0,ei._)([(0,aa.o)()],ma.prototype,"vvColor",void 0),(0,ei._)([(0,aa.o)()],ma.prototype,"vvOpacity",void 0),(0,ei._)([(0,aa.o)()],ma.prototype,"hasSlicePlane",void 0),(0,ei._)([(0,aa.o)()],ma.prototype,"transparent",void 0),(0,ei._)([(0,aa.o)()],ma.prototype,"hasOccludees",void 0),(0,ei._)([(0,aa.o)()],ma.prototype,"hasMultipassTerrain",void 0),(0,ei._)([(0,aa.o)()],ma.prototype,"cullAboveGround",void 0),(0,ei._)([(0,aa.o)()],ma.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,ei._)([(0,aa.o)({constValue:ra.f7.Disabled})],ma.prototype,"pbrMode",void 0),(0,ei._)([(0,aa.o)({constValue:!0})],ma.prototype,"hasVvInstancing",void 0),(0,ei._)([(0,aa.o)({constValue:!1})],ma.prototype,"useCustomDTRExponentForWater",void 0),(0,ei._)([(0,aa.o)({constValue:!1})],ma.prototype,"useFillLights",void 0);var ga=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var i;return(0,s.Z)(this,r),(i=t.call(this,e,new ba)).supportsEdges=!0,i._vertexAttributeLocations=fa,i._configuration=new ma,i._vertexBufferLayout=r.getVertexBufferLayout(),i}return(0,l.Z)(r,[{key:"getConfiguration",value:function(e,t){return this._configuration.output=e,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==oi.H.Color&&e!==oi.H.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?Qn.q.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?Qn.q.WindingOrder:Qn.q.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!t.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}},{key:"isVisibleForOutput",value:function(e){return e!==oi.H.Shadow&&e!==oi.H.ShadowExcludeHighlight&&e!==oi.H.ShadowHighlight||this.parameters.castShadows}},{key:"isVisible",value:function(){return(0,u.Z)((0,c.Z)(r.prototype),"isVisible",this).call(this)&&this.parameters.opacity>0}},{key:"intersect",value:function(e,t,r,i,n,a){var o=e;if(gn(o)){var s=o.path,l=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){var u=this.parameters.vvSizeOffset,c=this.parameters.vvSizeFactor,h=this.parameters.vvSizeMinSize,d=this.parameters.vvSizeMaxSize,p=s.sizeAttributeValue;l[0]*=(0,gt.uZ)(u[0]+p*c[0],h[0],d[0]),l[1]*=(0,gt.uZ)(u[2]+p*c[2],h[2],d[2])}var v=Math.max(l[0],l[1]),y=e.boundingInfo;if((0,f.Wi)(y))this._intersectTriangles(s,l,i,n,a);else{var m=(0,P.al)(y.bbMin[0]-v,y.bbMin[1]-v,y.bbMin[2]-v,y.bbMax[0]+v,y.bbMax[1]+v,y.bbMax[2]+v),g=[n[0]-i[0],n[1]-i[1],n[2]-i[2]],_=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),b=[_/g[0],_/g[1],_/g[2]];(0,Vi.Tw)(m,i,b,r.tolerance)&&this._intersectTriangles(s,l,i,n,a)}}}},{key:"_intersectTriangles",value:function(e,t,r,i,n){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(r,i,n)}},{key:"createBufferWriter",value:function(){return new ea.G(this._vertexBufferLayout)}},{key:"requiresSlot",value:function(e,t){switch(t){case oi.H.Shadow:case oi.H.ShadowHighlight:case oi.H.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case oi.H.Color:case oi.H.Alpha:case oi.H.Depth:case oi.H.Normal:case oi.H.Highlight:case oi.H.ObjectAndLayerIdColor:return e===(this.parameters.transparent?hi.r.TRANSPARENT_MATERIAL:hi.r.OPAQUE_MATERIAL)||e===hi.r.DRAPED_MATERIAL;default:return!1}}},{key:"createGLMaterial",value:function(e){return new _a(e)}}],[{key:"getVertexBufferLayout",value:function(){return(0,ai.U$)().vec3f(ae.T.POSITION).vec4f(ae.T.PROFILERIGHT).vec4f(ae.T.PROFILEUP).vec4f(ae.T.PROFILEVERTEXANDNORMAL).vec4f(ae.T.FEATUREVALUE)}}]),r}($n.F5),_a=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"_updateShadowState",value:function(e){((0,f.Wi)(this.technique)||e.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}},{key:"beginSlot",value:function(e){return this._output!==oi.H.Color&&this._output!==oi.H.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(ya,e)}}]),r}(Kn.Z),ba=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).doubleSided=!1,e.doubleSidedType="normal",e.receiveSSAO=!0,e.receiveShadows=!1,e.castShadows=!0,e.hasSlicePlane=!1,e.transparent=!1,e.hasOccludees=!1,e}return(0,l.Z)(r)}(va),xa=["polyline"],Sa=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,i,n,a))._intrinsicSize=(0,_.f)(1,1),o._upVectorAlignment=pn.Path,o._stencilWidth=.1,o.ensureDrapedStatus(!1),o}return(0,l.Z)(r,[{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,i,n,o,s,l,u,c,h,d,p,v,y;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,f.pC)(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,r=(0,f.pC)(this.symbolLayer.height)?this.symbolLayer.height:t,this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,r],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=Rt(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},i=this.symbolLayer.anchor||"center",this._upVectorAlignment="heading"===this.symbolLayer.profileRotation?pn.World:pn.Path,n=this.symbolLayer.profile||"circle",e.t0=n,e.next="circle"===e.t0?8:"quad"===e.t0?10:8;break;case 8:return this._profile=wn(yn.t6),e.abrupt("break",11);case 10:this._profile=An();case 11:o=[0,0],e.t1=("center"!==i&&(o={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[i],this._profile.translate(o[0],o[1])),this.symbolLayer.join),e.next="round"===e.t1?15:"bevel"===e.t1?17:"miter"===e.t1?19:21;break;case 15:return this._extruder=new Rn(0,yn.hy),e.abrupt("break",22);case 17:return this._extruder=new Rn(0,1),e.abrupt("break",22);case 19:return this._extruder=new Rn(.8*Math.PI,1),e.abrupt("break",22);case 21:this._extruder=new En;case 22:s=this.symbolLayer.cap||"butt",e.t2=s,e.next="none"===e.t2?26:"butt"===e.t2?28:"square"===e.t2?30:"round"===e.t2?32:28;break;case 26:return this._startCap=new In,this._endCap=new In,e.abrupt("break",35);case 28:return this._startCap=new Zn(this._profile,0),this._endCap=new Zn(this._profile,0,!0),e.abrupt("break",35);case 30:return this._startCap=new Zn(this._profile,-.5),this._endCap=new Zn(this._profile,.5,!0),e.abrupt("break",35);case 32:return l="quad"===n,this._startCap=new Dn({profile:this._profile,flip:!1,breakNormals:l,subdivisions:yn.tZ}),this._endCap=new Dn({profile:this._profile,flip:!0,breakNormals:l,subdivisions:yn.tZ}),e.abrupt("break",35);case 35:if(u=(0,f.U2)(this.symbolLayer,"material","color"),c=this._getCombinedOpacityAndColor(u),h=(0,x.d)(c),d=c[3],p=d<1||this.needsDrivenTransparentPass,v={diffuse:h,ambient:h,opacity:d,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||"none"===s?Oe.Vr.None:Oe.Vr.Back,offsetTransparentBackfaces:!0},this._drivenProperties.size||((0,g.s)(this._intrinsicSize,t,r),(0,ee.ZL)(this._intrinsicSize[0])&&(0,ee.ZL)(this._intrinsicSize[1]))){e.next=38;break}throw new F.Z("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");case 38:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(0,g.b)(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled?(y=(0,M.Z)((0,M.Z)((0,M.Z)({},v),this._fastUpdates.materialParameters),{},{size:(0,_.b)(this._intrinsicSize)}),this._material=new ga(y)):(v.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new ke.Gp(v)),this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material);case 40:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._context.stage.remove(this._material),this._material=null}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,xa,this.symbolLayer.type))return null;var r=this.setGraphicElevationContext(t,new K.o),i=e.renderingInfo;return this._createAs3DShape(t,i,r,t.uid)}},{key:"layerOpacityChanged",value:function(){var e=(0,f.U2)(this.symbolLayer,"material","color"),t=this._getCombinedOpacity(e),r=t<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:t,transparent:r})}},{key:"layerElevationInfoChanged",value:function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Q.B5)}},{key:"slicePlaneEnabledChanged",value:function(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}},{key:"physicalBasedRenderingChanged",value:function(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"skipHighSymbolLodsChanged",value:function(){return!0}},{key:"applyRendererDiff",value:function(e,t){for(var r in e.diff){if("visualVariables"!==r)return te.W.Recreate_Symbol;if(!Lt(this._fastUpdates,t,this._vvConvertOptions))return te.W.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return te.W.Fast_Update}},{key:"_getVertexData",value:function(e){var t,r=0,n=e.paths,a=[],o=e.spatialReference,s=this._context.elevationProvider.spatialReference,l=this._context.renderCoordsHelper.spatialReference,u=(0,i.Z)(n);try{for(u.s();!(t=u.n()).done;){r+=t.value.length}}catch(x){u.e(x)}finally{u.f()}var c,h=(0,ye.bg)(3*r),d=(0,ye.bg)(3*r),p=0,v=(0,i.Z)(n);try{for(v.s();!(c=v.n()).done;){var y=c.value;a.push({index:p,numVertices:y.length});var m,g=(0,i.Z)(y);try{for(g.s();!(m=g.n()).done;){var _=m.value;h[p++]=_[0],h[p++]=_[1],h[p++]=e.hasZ?_[2]:0}}catch(x){g.e(x)}finally{g.f()}}}catch(x){v.e(x)}finally{v.f()}var b=!0;return(0,f.pC)(s)&&!o.equals(s)&&(b=(0,C.CM)(h,o,0,h,s,0,r)),(0,f.pC)(s)&&!s.equals(l)?(0,C.CM)(h,s,0,d,l,0,r):this._copyVertices(h,0,d,0,r),{pathVertexDataInfos:a,vertexDataES:h,vertexDataRS:d,projectionSuccess:b,terrainElevation:0}}},{key:"_copyVertices",value:function(e,t,r,i,n){t*=3,i*=3;for(var a=0;a<n;++a)r[i++]=e[t++],r[i++]=e[t++],r[i++]=e[t++]}},{key:"_createAs3DShape",value:function(e,t,r,n){var a=e.geometry,o=new Array,s=a.spatialReference,l=(0,P.Ue)(),u=this._context.renderCoordsHelper;Aa.spatialReference=s;var c=this._getVertexData(a);if(!c.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0===c.pathVertexDataInfos.length)return 0!==a.paths.length&&a.paths.some((function(e){return e.length>0}))||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;var h,d=(0,i.Z)(c.pathVertexDataInfos);try{for(d.s();!(h=d.n()).done;){var p=h.value,v=p.index,y=p.numVertices;if(!(y<2)&&(!(0,f.pC)(this._context.clippingExtent)||((0,P.cS)(l),(0,P.G1)(l,c.vertexDataES,3*v,y),(0,P.Zp)(l,this._context.clippingExtent)))){for(var m=[],g=v;g<v+3*y;){var _=g++,x=g++,S=g++,C=new Tn;(0,b.s)(C.posES,c.vertexDataES[_],c.vertexDataES[x],c.vertexDataES[S]);var T=(0,Q.w7)(C.posES,this._context.elevationProvider,r,u);(0,b.s)(ka,c.vertexDataRS[_],c.vertexDataRS[x],c.vertexDataRS[S]),u.setAltitude(ka,T),(0,b.c)(C.pos,ka),m.push(C)}var O=new kn(m);Ca(O,this._upVectorAlignment,this._context.renderCoordsHelper);var w=new Mn(O,this._profile,this._extruder,this._startCap,this._endCap),A=null;if(this._fastUpdates.enabled){var k=this._fastUpdates.visualVariables,E=k.size?(0,$.d)(k.size.field,e):0,R=k.color?(0,$.d)(k.color.field,e):0,L=k.opacity?(0,$.d)(k.opacity.field,e):0;A=new Un(w,E,R,L)}else{var I=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){var D=t.size;I[0]*=Pa(D[0],"symbol-value"===D[2]?this.symbolLayer.height||0:D[2],this.symbolLayer.width||0),I[1]*=Pa(D[2],"symbol-value"===D[0]?this.symbolLayer.width||0:D[0],this.symbolLayer.height||0)}var M=void 0;this._drivenProperties.color&&(M=t.color),this._drivenProperties.opacity&&null!=t.opacity&&(M=M?[M[0],M[1],M[2],t.opacity]:[1,1,1,t.opacity]);var z=new Fn(w);z.bake(I),M&&z.bakeVertexColors(M),A=z}var F=A.createGeometryData(),U=F.vertexAttributes,V=F.indices,N=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),G=new mn(this._material,U,V,A,s,this._upVectorAlignment,this._stencilWidth,N);G.transformation=A.xform,o.push(G)}}}catch(j){d.e(j)}finally{d.f()}if(0===o.length)return null;var B={layerUid:this._context.layer.uid,graphicUid:n},H=new Ae.T({geometries:o,metadata:B}),W=new Z.z(this,H,o,null,null,Oa,r);return W.alignedSampledElevation=c.terrainElevation,W.needsElevationUpdates=(0,Q.B5)(r.mode),W}}]),r}($.k);function Ca(e,t,r){switch(t){default:case pn.World:var n,a=(0,i.Z)(e.vertices);try{for(a.s();!(n=a.n()).done;){var o=n.value;(0,b.a)(ka,o.pos,e.offset),r.worldUpAtPosition(ka,ka),o.setFrameFromUpVector(ka),o.rotationFrameUp=o.frame.up,(0,g.s)(o.rotationRight,1,0),(0,b.g)(ka,o.frame.up,(0,b.e)(o.frame.up,o.vLeft)),(0,b.b)(ka,o.vLeft,ka),(0,b.o)(ka,ka),(0,b.n)(ka,ka),(0,b.g)(Ea,o.frame.up,(0,b.e)(o.frame.up,o.vRight)),(0,b.b)(Ea,o.vRight,Ea),(0,b.n)(Ea,Ea),(0,b.f)(Ra,o.rotationFrameUp,o.vLeft);var s=Math.sign((0,b.e)(Ra,o.vRight));if(o.rotationAngle=s*(Math.PI-(0,gt.ZF)((0,b.e)(ka,Ea))),Math.abs(o.rotationAngle)>0){var l=(0,gt.b_)(Math.cos(.5*o.rotationAngle));cn(o.miterStretch,l-1+1,0,0,1)}var u=Math.PI-o.rotationAngle;o.maxStretchDistance=Math.abs(o.vMinSiblingLength/Math.cos(.5*u))}}catch(_){a.e(_)}finally{a.f()}break;case pn.Path:(0,b.a)(ka,e.vertices[0].pos,e.offset),r.worldUpAtPosition(ka,ka),function(e,t){var r=null,i=e.vertices.length,n=.99619469809,a=(0,x.c)(),o=(0,x.c)(),s=(0,x.c)(),l=(0,x.c)(),u=(0,x.c)(),c=(0,x.c)(),h=(0,bn.Ue)(),d=e.vertices[0];(0,b.c)(o,t),(0,b.s)(a,0,1,0),(0,Nt.Ay)(d.vRight,o,a,a,s,o,n),(0,b.c)(d.frame.up,o),(0,b.c)(d.frame.right,s),r=d;for(var p=1;p<i;++p){d=e.vertices[p],(0,b.a)(u,d.vLeft,d.vRight);var f=(0,b.l)(u);f>0?(f=1/Math.sqrt(f),u[0]=u[0]*f,u[1]=u[1]*f,u[2]=u[2]*f):(u[0]=d.vRight[0],u[1]=d.vRight[1],u[2]=d.vRight[2]),(0,b.a)(c,r.pos,r.frame.up),(0,bn.Yq)(d.pos,u,h),(0,bn.BR)(h,(0,xn.re)(c,d.vLeft),l)?((0,b.b)(l,l,d.pos),(0,b.n)(o,l),(0,b.f)(s,u,o),(0,b.n)(s,s)):(0,Nt.Ay)(u,r.frame.up,r.frame.right,a,s,o,n),(0,b.c)(d.frame.up,o),(0,b.c)(d.frame.right,s),r=d}}(e,ka);var c,h=(0,i.Z)(e.vertices);try{for(h.s();!(c=h.n()).done;){var d=c.value,p=Math.sign((0,b.e)(d.frame.right,d.vRight));(0,b.f)(d.rotationFrameUp,d.vRight,d.vLeft),(0,b.g)(d.rotationFrameUp,d.rotationFrameUp,p),(0,b.n)(d.rotationFrameUp,d.rotationFrameUp);var f=(0,b.e)(d.rotationFrameUp,d.frame.up),v=(0,b.e)(d.rotationFrameUp,d.frame.right);if((0,b.g)(ka,d.frame.up,-v),(0,b.g)(Ea,d.frame.right,f),(0,b.a)(ka,ka,Ea),(0,b.n)(ka,ka),Pn(d.rotationRight,d.frame,ka),(0,b.o)(ka,d.vLeft),d.rotationAngle=-p*(Math.PI-(0,gt.ZF)((0,b.e)(ka,d.vRight))),Math.abs(d.rotationAngle)>0){var y=(0,gt.b_)(Math.cos(.5*d.rotationAngle));cn(d.miterStretch,1+(y-1)*d.rotationRight[0]*d.rotationRight[0],(y-1)*d.rotationRight[0]*d.rotationRight[1],(y-1)*d.rotationRight[0]*d.rotationRight[1],1+(y-1)*d.rotationRight[1]*d.rotationRight[1])}var m=Math.PI-d.rotationAngle;d.maxStretchDistance=Math.abs(d.vMinSiblingLength*(0,gt.b_)(Math.cos(.5*m)))}}catch(_){h.e(_)}finally{h.f()}}}function Pa(e,t,r){switch(e){case"symbol-value":return r;case"proportional":return t;default:return e}}function Ta(e,t,r,n){var a,o=0,s=(0,i.Z)(e.vertices);try{for(s.s();!(a=s.n()).done;){var l=a.value;r(l.posES,La),o+=La.sampledElevation,(0,b.a)(ka,l.pos,e.offset),n.setAltitude(ka,La.z),(0,b.b)(l.pos,ka,e.offset)}}catch(u){s.e(u)}finally{s.f()}return e.updatePathVertexInformation(),o/e.vertices.length}function Oa(e,t,r,n,a){var o=e.stageObject,s=o.geometries,l=0;wa.spatialReference=a.spatialReference;var u,c=(0,i.Z)(s);try{for(c.s();!(u=c.n()).done;){var h=u.value;if(gn(h)){var d=h.path,p=d.builder.path,f=h.geometrySR;Aa.spatialReference=f,l+=Ta(p,0,n,a),h.upVectorAlignment!==pn.World&&Ca(p,h.upVectorAlignment,a),d.onPathChanged(),h.invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(h)}}}catch(v){c.e(v)}finally{c.f()}return l/s.length}var wa=(0,w.Tx)(0,0,0,null),Aa=(0,w.Tx)(0,0,0,null),ka=(0,x.c)(),Ea=(0,x.c)(),Ra=(0,x.c)(),La=new Q.Lm,Ia=r(83448);function Za(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;(0,b.s)(Fa,1,0,0),(0,b.s)(Ua,0,1,0),(0,b.s)(Va,0,0,1),Ka(Da,r),ja(r,za)&&qa(za,Fa,Ua,Va,i,Da),(0,g.s)(Na,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),(0,g.s)(Ga,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(var a=0;a<r.length;a+=3){(0,b.s)(Ma,r[a],r[a+1],r[a+2]);var o=(0,b.e)(Fa,Ma),s=(0,b.e)(Ua,Ma);Na[0]=Math.min(Na[0],o),Na[1]=Math.min(Na[1],s),Ga[0]=Math.max(Ga[0],o),Ga[1]=Math.max(Ga[1],s)}var l=(0,b.e)(Va,Da);eo(Ba,Na[0],Na[1],l,Fa,Ua,Va),eo(Ha,Ga[0],Na[1],l,Fa,Ua,Va),eo(Wa,Na[0],Ga[1],l,Fa,Ua,Va),(0,b.b)(Ha,Ha,Ba),(0,b.g)(Ha,Ha,.5),(0,b.b)(Wa,Wa,Ba),(0,b.g)(Wa,Wa,.5),(0,b.a)(Ba,Ba,Ha),(0,b.a)(Ba,Ba,Wa);for(var u=Na[0]%n,c=Na[1]%n,h=Na[0]-u,d=Na[1]-c,p=0;p<r.length;p+=3){(0,b.s)(Ma,r[p],r[p+1],r[p+2]);var f=p/3,v=4*f;e[v]=((0,b.e)(Fa,Ma)-h)/n,e[v+1]=((0,b.e)(Ua,Ma)-d)/n,e[v+2]=h/n,e[v+3]=d/n;for(var y=9*f,m=0;m<3;m++)t[y+m]=Ba[m],t[y+m+3]=Ha[m],t[y+m+6]=Wa[m]}}var Da=(0,x.c)(),Ma=(0,x.c)(),za=(0,bn.Ue)(),Fa=(0,x.c)(),Ua=(0,x.c)(),Va=(0,x.c)(),Na=(0,_.a)(),Ga=(0,_.a)(),Ba=(0,x.c)(),Ha=(0,x.c)(),Wa=(0,x.c)();function ja(e,t){var r=e.length/3-1;return(0,bn.$I)(e,t,0,Math.floor(r/3),Math.floor(r*(2/3)))}function qa(e,t,r,i,n,a){(0,f.pC)(n)?(n.basisMatrixAtPosition(a,Ya),(0,b.s)(Ja,Ya[0],Ya[1],Ya[2]),(0,b.s)(Xa,Ya[4],Ya[5],Ya[6]),(0,b.s)(Qa,Ya[8],Ya[9],Ya[10])):((0,b.s)(Ja,1,0,0),(0,b.s)(Xa,0,1,0),(0,b.s)(Qa,0,0,1));var o=(0,bn.mJ)(e);(0,b.e)(o,Qa)<0&&(0,b.g)(o,o,-1),(0,b.c)(i,o);var s=(0,b.e)(o,Xa),l=(0,b.e)(o,Ja);Math.abs(s)<Math.abs(l)?((0,b.z)(t,Ja,o,-l),(0,b.n)(t,t),(0,b.f)(r,t,o),(0,b.n)(r,r),(0,b.g)(r,r,-1)):((0,b.z)(r,Xa,o,-s),(0,b.n)(r,r),(0,b.f)(t,r,o),(0,b.n)(t,t))}var Ya=(0,W.c)(),Ja=(0,x.c)(),Xa=(0,x.c)(),Qa=(0,x.c)();function Ka(e,t){(0,b.s)($a,0,0,0);for(var r=0;r<t.length-3;r+=3)$a[0]+=t[r],$a[1]+=t[r+1],$a[2]+=t[r+2];(0,b.g)(e,$a,1/(t.length/3-1))}var $a=(0,x.c)();function eo(e,t,r,i,n,a,o){(0,b.s)(e,t*n[0]+r*a[0]+i*o[0],t*n[1]+r*a[1]+i*o[1],t*n[2]+r*a[2]+i*o[2])}var to=r(66832),ro=r(17729),io=r(11983),no=r(33236),ao=r(59771),oo=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"initializeConfiguration",value:function(e,t){t.hasWebGL2Context=e.rctx.type===da.zO.WEBGL2}},{key:"initializeProgram",value:function(e){return new sa.$(e.rctx,r.shader.get().build(this.configuration),uo)}},{key:"_setPipelineState",value:function(e,t){var r=this.configuration,i=e===ua.A.NONE,n=e===ua.A.FrontFace;return(0,pa.sm)({blending:r.output===oi.H.Color||r.output===oi.H.Alpha?i?oa.wu:(0,oa.j7)(e):null,culling:(0,pa.zp)(r.cullFace),depthTest:{func:(0,oa.Bh)(e)},depthWrite:i?r.writeDepth?pa.LZ:null:(0,oa.K5)(e),colorWrite:pa.BK,stencilWrite:r.hasOccludees?la.s3:null,stencilTest:r.hasOccludees?t?la.eD:la.RY:null,polygonOffset:i||n?r.polygonOffset?so:null:(0,oa.je)(r.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:(0,u.Z)((0,c.Z)(r.prototype),"getPipelineState",this).call(this,e,t)}}]),r}(na.A);oo.shader=new ia.J(ao.P,(function(){return r.e(97494).then(r.bind(r,97494))}));var so={factor:1,units:1},lo=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).output=oi.H.Color,e.cullFace=Oe.Vr.None,e.transparencyPassType=ua.A.NONE,e.hasSlicePlane=!1,e.hasVertexColors=!1,e.polygonOffset=!1,e.writeDepth=!0,e.hasOccludees=!1,e.enableOffset=!0,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e}return(0,l.Z)(r)}(ca.W);(0,ei._)([(0,aa.o)({count:oi.H.COUNT})],lo.prototype,"output",void 0),(0,ei._)([(0,aa.o)({count:Oe.Vr.COUNT})],lo.prototype,"cullFace",void 0),(0,ei._)([(0,aa.o)({count:ro.b.COUNT})],lo.prototype,"style",void 0),(0,ei._)([(0,aa.o)({count:ua.A.COUNT})],lo.prototype,"transparencyPassType",void 0),(0,ei._)([(0,aa.o)()],lo.prototype,"hasSlicePlane",void 0),(0,ei._)([(0,aa.o)()],lo.prototype,"hasVertexColors",void 0),(0,ei._)([(0,aa.o)()],lo.prototype,"polygonOffset",void 0),(0,ei._)([(0,aa.o)()],lo.prototype,"writeDepth",void 0),(0,ei._)([(0,aa.o)()],lo.prototype,"hasOccludees",void 0),(0,ei._)([(0,aa.o)()],lo.prototype,"patternSpacing",void 0),(0,ei._)([(0,aa.o)()],lo.prototype,"lineWidth",void 0),(0,ei._)([(0,aa.o)()],lo.prototype,"enableOffset",void 0),(0,ei._)([(0,aa.o)()],lo.prototype,"draped",void 0),(0,ei._)([(0,aa.o)()],lo.prototype,"hasMultipassTerrain",void 0),(0,ei._)([(0,aa.o)()],lo.prototype,"cullAboveGround",void 0);var uo=new Map([[ae.T.POSITION,0],[ae.T.COLOR,3],[ae.T.UVMAPSPACE,4],[ae.T.BOUNDINGRECT,5]]),co=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var i;return(0,s.Z)(this,r),(i=t.call(this,e,new fo)).supportsEdges=!0,i._vertexAttributeLocations=uo,i._configuration=new lo,i}return(0,l.Z)(r,[{key:"getConfiguration",value:function(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<oa.ve,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}},{key:"requiresSlot",value:function(e,t){return!!(t===oi.H.Color||t===oi.H.Alpha||t===oi.H.Highlight||t===oi.H.Depth&&this.parameters.writeLinearDepth)&&(e===hi.r.DRAPED_MATERIAL||(t===oi.H.Highlight?e===hi.r.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?hi.r.TRANSPARENT_MATERIAL:hi.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)))}},{key:"createGLMaterial",value:function(e){return new ho(e)}},{key:"createBufferWriter",value:function(){var e=(0,ai.U$)().vec3f(ae.T.POSITION).vec4u8(ae.T.COLOR).vec4f(ae.T.UVMAPSPACE);return this.parameters.draped||e.mat3f(ae.T.BOUNDINGRECT),new po(e)}}]),r}(io.c),ho=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"_updateParameters",value:function(e){return this.ensureTechnique(oo,e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return this._output!==oi.H.Color&&this._output!==oi.H.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}]),r}(Kn.Z),po=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"write",value:function(e,t,r,n,a){var o,s=(0,i.Z)(this.vertexBufferLayout.fieldNames);try{for(s.s();!(o=s.n()).done;){var l=o.value,u=r.vertexAttributes.get(l),c=r.indices.get(l);if(u&&c)switch(l){case ae.T.POSITION:(0,di.hu)(3===u.size);var h=n.getField(l,j.ct);h&&(0,no.ho)(c,u.data,e,h,a);break;case ae.T.COLOR:(0,di.hu)(3===u.size||4===u.size);var d=n.getField(l,j.mc);d&&(0,no.Vs)(c,u.data,u.size,d,a);break;case ae.T.UVMAPSPACE:(0,di.hu)(4===u.size);var p=n.getField(l,j.ek);p&&(0,no.SW)(c,u.data,p,a);break;case ae.T.BOUNDINGRECT:(0,di.hu)(9===u.size);var f=n.getField(l,j.gK);f&&this.writeBoundingRect(c,u.data,e,f,a)}}}catch(v){s.e(v)}finally{s.f()}}},{key:"writeBoundingRect",value:function(e,t,r,i,n){var a=r,o=i.typedBuffer,s=i.typedBufferStride,l=e.length;n*=s;for(var u=0;u<l;++u){var c=9*e[u],h=t[c],d=t[c+1],p=t[c+2];o[n]=a[0]*h+a[4]*d+a[8]*p+a[12],o[n+1]=a[1]*h+a[5]*d+a[9]*p+a[13],o[n+2]=a[2]*h+a[6]*d+a[10]*p+a[14];for(var f=3;f<9;++f)o[n+f]=t[c+f];n+=s}}}]),r}(ea.G),fo=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).color=(0,nt.f)(1,1,1,1),e.writeDepth=!0,e.writeLinearDepth=!1,e.hasVertexColors=!1,e.polygonOffset=!1,e.hasSlicePlane=!1,e.cullFace=Oe.Vr.None,e.hasOccludees=!1,e.style=ro.b.Cross,e.patternSpacing=10,e.lineWidth=1,e.draped=!0,e}return(0,l.Z)(r)}($n.Mt);function vo(e,t,r){return function(e,t,r){return(0,f.pC)(e)?"none"===e.style||"solid"===e.style?("none"===e.style&&(t.color=(0,nt.f)(0,0,0,0),t.transparent=!0),new to.E(t)):(t.style=function(e){switch(e){case"horizontal":return ro.b.Horizontal;case"vertical":return ro.b.Vertical;case"cross":return ro.b.Cross;case"forward-diagonal":return ro.b.ForwardDiagonal;case"backward-diagonal":return ro.b.BackwardDiagonal;case"diagonal-cross":return ro.b.DiagonalCross;default:return}}(e.style),t.draped=r.isDraped,new co(t)):new to.E(t)}(function(e){return e&&e.pattern||null}(e),t,r)}function yo(e,t){if(function(e){return e.material instanceof co&&!e.material.parameters.draped}(e)){var r=e.vertexAttributes.get(ae.T.POSITION).data;Za(e.getMutableAttribute(ae.T.UVMAPSPACE).data,e.getMutableAttribute(ae.T.BOUNDINGRECT).data,r,t)}}function mo(e,t,r,n,a){var o,s=(0,ct.Wf)(e,t,r,n,a),l=e.stageObject.geometries,u=(0,i.Z)(l);try{for(u.s();!(o=u.n()).done;){yo(o.value,a)}}catch(c){u.e(c)}finally{u.f()}return s}var go=["polyline","polygon","extent"],_o=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,i,n,a))._needsUV=!1,o._hasOutline=!1,o}return(0,l.Z)(r,[{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_ensureMaterials",value:function(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}},{key:"_ensureFillMaterial",value:function(){if(!(0,f.pC)(this._material)){var e=(0,f.U2)(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e);this._material=vo(this.symbolLayer,{color:t,transparent:t[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof co,this._context.stage.add(this._material)}}},{key:"_ensureOutlineMaterial",value:function(){var e=this,t=this.symbolLayer.outline;if(!(0,f.pC)(this._outlineMaterial)&&this._isValidOutline(t)){this._hasOutline=!0;this._outlineMaterial=function(r){var i=(0,ur.Dp)(t.pattern);return new cr.U({width:r,color:e._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:e._context.slicePlaneEnabled,isClosed:!0,stipplePattern:i,stippleScaleWithLineWidth:!0,cap:rr(t.patternCap||"butt")})}((0,tt.F2)(t.size)),this._context.stage.add(this._outlineMaterial)}}},{key:"_isValidOutline",value:function(e){return(0,f.pC)(e)&&null!=e.size&&e.size>0&&(0,f.pC)(e.color)&&((0,f.Wi)(e.pattern)||"style"!==e.pattern.type||"none"!==e.pattern.style)}},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,go,this.symbolLayer.type))return null;var r=this._getVertexOpacityAndColor(e.renderingInfo,255),i=this.setGraphicElevationContext(t,new K.o);return this.ensureDrapedStatus("on-the-ground"===i.mode),this._ensureMaterials(),this.draped?this._createAsOverlay(t,r):this._createAs3DShape(t,r,i)}},{key:"layerOpacityChanged",value:function(){if((0,f.pC)(this._material)){var e=this._material.parameters.color,t=(0,f.U2)(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(t);this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if((0,f.pC)(this._outlineMaterial)){var i=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[i[0],i[1],i[2],this._getOutlineOpacity()]})}}},{key:"layerElevationInfoChanged",value:function(e,t,i){var n=this._elevationContext.mode,a=(0,Q.GC)(r.elevationModeChangeTypes,i,n);if(a!==Q.lO.UPDATE)return a;var o=(0,Q.Xf)(n);return this.updateGraphics3DGraphicElevationInfo(e,t,(function(){return o}))}},{key:"slicePlaneEnabledChanged",value:function(){if((0,f.pC)(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),(0,f.pC)(this._outlineMaterial)){var e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"skipHighSymbolLodsChanged",value:function(){return!0}},{key:"_createAs3DShape",value:function(e,t,r){var i,n=ue(e.geometry);if((0,f.Wi)(n))return null;var a=me(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=new xo(a,t,this._context.layer.uid,e.uid),s=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=(0,br.xx)(4*s,!0),o.boundingRect=(0,ye.bg)(9*s,!0),Za(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=null===(i=this._context.stage.renderView)||void 0===i?void 0:i.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,n.rings,"rings","FillSymbol3DLayer"),0===o.outGeometries.length)return null;var l=new Ae.T({geometries:o.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),u=new Z.z(this,l,o.outGeometries,null,null,mo,r);return u.alignedSampledElevation=o.renderData.sampledElevation,u.needsElevationUpdates=(0,Q.Xf)(r.mode),u}},{key:"_createAs3DShapeFill",value:function(e){var t,r=e.renderData.polygons,n=(0,i.Z)(r);try{for(n.s();!(t=n.n()).done;){var a=t.value,o=a.position,s=a.mapPositions,l=a.holeIndices,u=a.index,c=a.count;if(!(0,f.pC)(this._context.clippingExtent)||((0,P.cS)(bo),(0,P.G1)(bo,s),(0,P.Zp)(bo,this._context.clippingExtent))){var h=(0,N.e)(s,l,3);if(0!==h.length){var d=se({material:(0,f.Wg)(this._material),indices:h,mapPositions:s,attributeData:{position:o,color:e.color,uvMapSpace:this._needsUV?(0,br.AA)(e.uvMapSpace,4*u,4*c):null,boundingRect:this._needsUV?(0,ye.Rq)(e.boundingRect,9*u,9*c):null,objectAndLayerIdColor:e.objectAndLayerIdColor}});e.outGeometries.push(d)}}}}catch(p){n.e(p)}finally{n.f()}}},{key:"_createAs3DShapeOutline",value:function(e){if(this._hasOutline)for(var t=e.renderData.outlines,r=0;r<t.length;++r){var i=t[r],n=i.mapPositions,a=i.position;if(!(0,f.pC)(this._context.clippingExtent)||((0,P.cS)(bo),(0,P.G1)(bo,n),(0,P.Zp)(bo,this._context.clippingExtent))){var o=(0,ar.Y)((0,f.Wg)(this._outlineMaterial),{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:n,attributeData:{position:a}},e.objectAndLayerIdColor),s=o.vertexAttributes.get(ae.T.POSITION);s.data===a&&(s.data=(0,ye.QZ)(a)),e.outGeometries.push(o)}}}},{key:"_createAsOverlay",value:function(e,t){var r,i=ue(e.geometry);if((0,f.Wi)(i))return null;(0,f.Wg)(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2,(0,f.pC)(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);var n=ge(i,this._context.overlaySR),a=new So(n,t,this._context.layer.uid,e.uid),o=a.renderData.position.length/3;return this._needsUV&&(a.uvMapSpace=(0,br.xx)(4*o,!0),function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(r.isGeographic&&i===X.JY.Global){for(var a=(0,ye.bg)(t.length),o=t.length,s=(0,Ia.Iu)(r),l=0;l<o;l+=3)(0,C.gH)(t,l,a,l,s);t=a}(0,g.s)(Na,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(var u=0;u<t.length;u+=3)Na[0]=Math.min(Na[0],t[u]),Na[1]=Math.min(Na[1],t[u+1]);for(var c=Na[0]%n,h=Na[1]%n,d=Na[0]-c,p=Na[1]-h,f=0;f<t.length;f+=3){var v=f/3*4;e[v]=(t[f]-d)/n,e[v+1]=(t[f+1]-p)/n,e[v+2]=d/n,e[v+3]=p/n}}(a.uvMapSpace,a.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),a.outBoundingBox=(0,P.cS)(),a.objectAndLayerIdColor=null===(r=this._context.stage.renderView)||void 0===r?void 0:r.getObjectAndLayerIdColor(a),this._createAsOverlayFill(a),this._hasOutline&&this._createAsOverlayOutline(a),this._logGeometryCreationWarnings(a.renderData,i.rings,"rings","FillSymbol3DLayer"),0===a.outGeometries.length?null:new dt(this,a.outGeometries,a.outBoundingBox,this._context.drapeSourceRenderer)}},{key:"_createAsOverlayFill",value:function(e){var t,r=e.renderData.polygons,n=(0,i.Z)(r);try{for(n.s();!(t=n.n()).done;){var a=t.value,o=a.position,s=a.holeIndices,l=a.index,u=a.count,c=(0,P.cS)(bo);if((0,P.G1)(c,o),(0,P.Zp)(c,this._context.clippingExtent)){var h=(0,N.e)(o,s,3);if(0!==h.length){(0,P.TC)(e.outBoundingBox,c);var d=se({material:(0,f.Wg)(this._material),indices:h,attributeData:{position:o,color:e.color,uvMapSpace:this._needsUV?(0,br.AA)(e.uvMapSpace,4*l,4*u):null,objectAndLayerIdColor:e.objectAndLayerIdColor}}),p=new Gt.z(d,e);(0,it.s)(p.boundingSphere,.5*(c[0]+c[3]),.5*(c[1]+c[4]),0,.5*Math.sqrt((c[3]-c[0])*(c[3]-c[0])+(c[4]-c[1])*(c[4]-c[1]))),e.outGeometries.push(p)}}}}catch(v){n.e(v)}finally{n.f()}}},{key:"_createAsOverlayOutline",value:function(e){if(this._hasOutline)for(var t=e.renderData.outlines,r=0;r<t.length;++r){var i=t[r].position;if((0,P.cS)(bo),(0,P.G1)(bo,i),(0,P.Zp)(bo,this._context.clippingExtent)){(0,P.TC)(e.outBoundingBox,bo);var n=(0,ar.Y)((0,f.Wg)(this._outlineMaterial),{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:i}},e.objectAndLayerIdColor),a=new Gt.z(n,e),o=bo;(0,it.s)(a.boundingSphere,.5*(o[0]+o[3]),.5*(o[1]+o[4]),0,.5*Math.sqrt((o[3]-o[0])*(o[3]-o[0])+(o[4]-o[1])*(o[4]-o[1]))),e.outGeometries.push(a)}}}},{key:"_getOutlineOpacity",value:function(){var e=(0,f.U2)(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*((0,f.pC)(e)?e.a:0)}},{key:"_getOutlineColor",value:function(){var e=(0,f.U2)(this.symbolLayer,"outline","color"),t=this._getOutlineOpacity();return(0,ee.Uu)((0,f.pC)(e)?et.Z.toUnitRGB(e):null,t)}},{key:"test",value:function(){var e=this;return(0,M.Z)((0,M.Z)({},(0,u.Z)((0,c.Z)(r.prototype),"test",this).call(this)),{},{createAsOverlay:function(t,r){return e._createAsOverlay(t,r)},createAs3DShape:function(t,r,i){return e._createAs3DShape(t,r,i)}})}}]),r}($.k);_o.elevationModeChangeTypes={definedChanged:Q.lO.RECREATE,staysOnTheGround:Q.lO.NONE,onTheGroundChanged:Q.lO.RECREATE};var bo=(0,P.Ue)(),xo=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,n,a)).color=i,o}return(0,l.Z)(r)}(ce),So=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,n,a)).color=i,o}return(0,l.Z)(r)}(ce),Co=r(29481),Po=r(64488),To=r(3173),Oo=r(43164),wo=r(5008),Ao=function(){function e(t,r,i){(0,s.Z)(this,e),this._renderer=new wo.tV(t,r,i)}return(0,l.Z)(e,[{key:"key",get:function(){return this._renderer.key}},{key:"baselineAnchorY",get:function(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}},{key:"displayWidth",get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}},{key:"create",value:function(){var e=(0,wo.GZ)(ko,this._renderer.renderedWidth,this._renderer.renderedHeight),t=e.getContext("2d");return t.save(),this._renderer.render(t,0,0),t.restore(),new Bt.x(e,{wrap:{s:Cr.e8.CLAMP_TO_EDGE,t:Cr.e8.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:Oe.CE.PAD})}}]),e}(),ko={canvas:null},Eo=[0,0,1],Ro=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,i,n,a))._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},o.ensureDrapedStatus(!1),o}return(0,l.Z)(r,[{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._drivenProperties.size){e.next=4;break}if(!(t=(0,ee.bh)(this.symbolLayer.size))){e.next=4;break}throw new F.Z("graphics3dtextsymbollayer:invalid-size",t);case 4:return e.next=6,this._createTextRenderParameters();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_createTextRenderParameters",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._context.graphicsCoreOwner.view.state.rasterPixelRatio,e.next=3,Oo.V.fromSymbol(this.symbolLayer,t);case 3:this._textRenderParameters=e.sent;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this)}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic,r=(0,mt.S_)(t.geometry);if((0,f.Wi)(r))return this.logger.warn("unsupported geometry type for text symbol: ".concat(t.geometry.type)),null;var i=this.symbolLayer.text;if((0,f.Wi)(i)||""===i)return null;var n=(0,Co.Pd)(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if((0,f.pC)(n)&&!(0,Co.as)(this.symbolLayer))return this.logger.errorOncePerTick("Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '".concat(this.symbolLayer.horizontalAlignment,"' alignment)")),null;var a=new Po.i(n,this.symbolLayer.horizontalAlignment,(0,yt.j1)(this.symbolLayer.verticalAlignment));return this._createAs3DShape(t,r,i,a)}},{key:"createLabel",value:function(e,t,r,i){var n=e.graphic,a=(0,mt.S_)(n.geometry);if((0,f.Wi)(a))return this.logger.warn("unsupported geometry type for label: ".concat(n.geometry.type)),null;var o=t.text;return!o||/^\s+$/.test(o)?null:this._createAs3DShape(n,a,o,t,r,i)}},{key:"setGraphicElevationContext",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=(0,u.Z)((0,c.Z)(r.prototype),"setGraphicElevationContext",this).call(this,e,t);return n.addOffsetRenderUnits(i),n}},{key:"layerOpacityChanged",value:function(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}},{key:"layerElevationInfoChanged",value:function(e,t){var r=this;return Lo(e,t,(function(e,t){r.updateGraphicElevationContext(t,e)})),Q.lO.UPDATE}},{key:"slicePlaneEnabledChanged",value:function(e,t){var r=this;return Lo(e,t,(function(e){var t,n=(0,i.Z)(e.stageObject.geometries);try{for(n.s();!(t=n.n()).done;){t.value.material.setParameters({hasSlicePlane:r._context.slicePlaneEnabled})}}catch(a){n.e(a)}finally{n.f()}})),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"pixelRatioChanged",value:function(){return!1}},{key:"skipHighSymbolLodsChanged",value:function(){return!0}},{key:"updateGraphicElevationContext",value:function(e,t){var r=t.elevationContext;this.setGraphicElevationContext(e,r,(0,f.pC)(t.metadata)?t.metadata.elevationOffset:0),t.needsElevationUpdates=(0,Q.Xf)(r.mode)||"absolute-height"===r.mode}},{key:"_defaultElevationInfoNoZ",value:function(){return Io}},{key:"_createAs3DShape",value:function(e,t,r,i,n,a){var o=this.setGraphicElevationContext(e,new K.o,i.elevationOffset),s="polyline"===(0,f.U2)(e.geometry,"type"),l=e.uid,u=null,c=null;if((0,f.Wi)(a)){var h=(0,yt.mq)(i.horizontalPlacement);u=new Ao(r,h,this._textRenderParameters);var d=null;if((0,f.pC)(this._context.sharedResources.textures)){c=this._context.sharedResources.textures.fromData(u.key,(function(){return(0,f.Wg)(u).create()}),(function(){(0,f.pC)(d)&&d.release()}));var p=this._context.stage.renderView.textureRepository.acquire(c.texture.id);if((0,f.Wi)(p)||(0,v.y8)(p))return c.release(),null;d=p}}var y,m=function(e,t){if("baseline"===t.verticalPlacement){var r=yt.$A[t.horizontalPlacement],i=(0,f.pC)(e)?e.baselineAnchorY:0;return(0,_.f)(r,i)}var n=(0,yt.QW)(t.horizontalPlacement,t.verticalPlacement);return yt.yY[n]}(u,i),g={occlusionTest:!0,screenOffset:i.screenOffset,anchorPosition:m,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:i.centerOffsetUnits,drawInSecondSlot:!0};if((0,f.pC)(a)?g.textureId=a.id:(0,f.pC)(c)&&(g.textureId=c.texture.id),(0,f.pC)(i.verticalOffset)){var b=i.verticalOffset,x=b.screenLength,S=b.minWorldLength,C=b.maxWorldLength;g.verticalOffset={screenLength:(0,tt.F2)(x),minWorldLength:S||0,maxWorldLength:(0,f.pC)(C)?C:1/0}}if(this._context.screenSizePerspectiveEnabled){var P=this._context.sharedResources,T=P.screenSizePerspectiveSettings,O=P.screenSizePerspectiveSettingsLabels;g.screenSizePerspective=O.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),g.screenSizePerspectiveAlignment=T}if(s&&(g.shaderPolygonOffset=1e-4),g.hasSlicePlane=this._context.slicePlaneEnabled,(0,f.pC)(n)){var w=JSON.stringify(g);y=n.get(w),(0,f.Wi)(y)&&(y=new Ht.A(g),n.add(w,y))}else y=new Ht.A(g);var A=i.translation,k=(0,f.pC)(u)?(0,_.f)(u.displayWidth,u.displayHeight):_.Z,E=i.centerOffset,R=(0,Nt.dV)(y,Eo,A,null,k,E,[0,0],null),L=(0,mt.ZC)(this._context,t,R,o,l);if((0,f.Wi)(L))return null;var I=new Z.z(this,L.object,[R],(0,f.Wi)(n)?[y]:null,c,ct.j3,o);I.alignedSampledElevation=L.sampledElevation,I.needsElevationUpdates=(0,Q.Xf)(o.mode)||"absolute-height"===o.mode;var D=(0,f.pC)(u)?u:i,M=D.displayWidth,z=D.displayHeight;I.getScreenSize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_.a)();return e[0]=M,e[1]=z,e};var F=new To.n(i.elevationOffset,r);return I.metadata=F,(0,mt.dO)(I,t,this._context.elevationProvider),I}}]),r}($.k);function Lo(e,t,r){e&&e.forEach((function(e){var i=t(e);(0,f.pC)(i)&&r(i,e.graphic)}))}var Io={mode:"relative-to-ground",offset:0},Zo=r(29674),Do={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Mo=["polyline","polygon","extent"],zo=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a){return(0,s.Z)(this,r),t.call(this,e,i,n,a)}return(0,l.Z)(r,[{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._context.stage.remove(this._material),this._material=null}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,Mo,this.symbolLayer.type))return null;var r=this.setGraphicElevationContext(t,new K.o);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(t):this._createAs3DShape(t,r,t.uid)}},{key:"ensureMaterial",value:function(){if(!(0,f.pC)(this._material)){var e=new Zo.m,t=this.symbolLayer.color;(0,f.pC)(t)&&(e.color=et.Z.toUnitRGBA(t));var i=this._getCombinedOpacity(t,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=(0,f.pC)(this.symbolLayer.waveDirection)?r.headingVectorFromAngle(this.symbolLayer.waveDirection):(0,_.f)(0,0);var n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,a=Do[n];e.waveStrength=a.waveStrength,e.waveTextureRepeat=a.textureRepeat,e.waveVelocity=a.waveVelocity,e.flowStrength=a.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new Zo.H(e),this._context.stage.add(this._material)}}},{key:"layerOpacityChanged",value:function(){if(!(0,f.Wi)(this._material)){var e=this._material.parameters.color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=t<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],t],transparent:r})}}},{key:"layerElevationInfoChanged",value:function(e,t,i){var n=this._elevationContext.mode,a=(0,Q.GC)(r.elevationModeChangeTypes,i,n);if(a!==Q.lO.UPDATE)return a;var o=(0,Q.Xf)(n);return this.updateGraphics3DGraphicElevationInfo(e,t,(function(){return o}))}},{key:"slicePlaneEnabledChanged",value:function(){return(0,f.pC)(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"pixelRatioChanged",value:function(){return!0}},{key:"skipHighSymbolLodsChanged",value:function(){return!0}},{key:"_createAs3DShape",value:function(e,t,r){var i=ue(e.geometry);if((0,f.Wi)(i))return null;var n=me(i,this._context.elevationProvider,this._context.renderCoordsHelper,t),a=n.position.length/3,o=(0,ye.bg)(2*a);this._createUVCoordsFromVertices(o,n.mapPositions,a,this._context.elevationProvider.spatialReference);var s=new Go(n,o);if(this._create3DShapeGeometries(s),this._logGeometryCreationWarnings(s.renderData,i.rings,"rings","WaterSymbol3DLayer"),0===s.outGeometries.length)return null;var l=new Ae.T({geometries:s.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),u=new Z.z(this,l,s.outGeometries,null,null,ct.Wf,t);return u.alignedSampledElevation=s.renderData.sampledElevation,u.needsElevationUpdates=(0,Q.Xf)(t.mode),u}},{key:"_createUVCoordsFromVertices",value:function(e,t,i,n){var a=(0,V.c9)(n);(0,T.cS)(Uo);for(var o=0;o<i;o++)(0,g.s)(Vo,t[3*o],t[3*o+1]),(0,T.Ho)(Uo,Vo);(0,it.b)(Uo,Uo,a);var s=Uo[0]%r.unitSizeOfTexture,l=Uo[1]%r.unitSizeOfTexture;Fo[0]=Uo[0]-s,Fo[1]=Uo[1]-l;for(var u=0;u<i;u++)e[2*u]=(t[3*u]*a-Fo[0])/r.unitSizeOfTexture,e[2*u+1]=(t[3*u+1]*a-Fo[1])/r.unitSizeOfTexture}},{key:"_create3DShapeGeometries",value:function(e){var t,r=e.renderData.polygons,n=e.uvCoords,a=(0,i.Z)(r);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=o.count,l=o.index,u=o.position,c=o.mapPositions,h=o.holeIndices;if(!(0,f.pC)(this._context.clippingExtent)||((0,P.cS)(No),(0,P.G1)(No,c),(0,P.Zp)(No,this._context.clippingExtent))){var d=(0,N.e)(c,h,3);if(0!==d.length){var p=(0,ye.Rq)(n,2*l,2*s),v=le({material:(0,f.Wg)(this._material),indices:d,mapPositions:c,attributeData:{position:u,uv0:p}});e.outGeometries.push(v)}}}}catch(y){a.e(y)}finally{a.f()}}},{key:"_createAsOverlay",value:function(e){var t=ue(e.geometry);if((0,f.Wi)(t))return null;(0,f.Wg)(this._material).renderPriority=this._renderPriority;var r=ge(t,this._context.overlaySR),i=r.position.length/3,n=(0,ye.bg)(2*i);this._createUVCoordsFromVertices(n,r.position,i,this._context.overlaySR);var a=new Bo(r,n,this._context.layer.uid,e.uid);return a.outBoundingBox=(0,P.cS)(),this._createAsOverlayWater(a),this._logGeometryCreationWarnings(a.renderData,t.rings,"rings","WaterSymbol3DLayer"),0===a.outGeometries.length?null:new dt(this,a.outGeometries,a.outBoundingBox,this._context.drapeSourceRenderer)}},{key:"_createAsOverlayWater",value:function(e){var t,r=e.uvCoords,n=e.renderData.polygons,a=(0,i.Z)(n);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=o.position,l=o.holeIndices,u=o.index,c=o.count;if((0,P.cS)(No),(0,P.G1)(No,s),(0,P.Zp)(No,this._context.clippingExtent)){(0,P.TC)(e.outBoundingBox,No);var h=(0,N.e)(s,l,3);if(0!==h.length){var d=(0,ye.Rq)(r,2*u,2*c),p=le({material:(0,f.Wg)(this._material),indices:h,attributeData:{position:s,uv0:d}}),v=new Gt.z(p,e),y=No;(0,it.s)(v.boundingSphere,.5*(y[0]+y[3]),.5*(y[1]+y[4]),0,.5*Math.sqrt((y[3]-y[0])*(y[3]-y[0])+(y[4]-y[1])*(y[4]-y[1]))),e.outGeometries.push(v)}}}}catch(m){a.e(m)}finally{a.f()}}},{key:"test",value:function(){var e=this;return(0,M.Z)((0,M.Z)({},(0,u.Z)((0,c.Z)(r.prototype),"test",this).call(this)),{},{create3DShape:function(t){return e._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid)},ensureMaterial:function(){return e.ensureMaterial()}})}}],[{key:"headingVectorFromAngle",value:function(e){var t=(0,_.a)(),r=(0,un.t)(e);return t[0]=Math.sin(r),t[1]=Math.cos(r),t}}]),r}($.k);zo.unitSizeOfTexture=100,zo.elevationModeChangeTypes={definedChanged:Q.lO.RECREATE,staysOnTheGround:Q.lO.NONE,onTheGroundChanged:Q.lO.RECREATE};var Fo=(0,_.a)(),Uo=(0,T.Ue)(),Vo=(0,_.a)(),No=(0,P.Ue)(),Go=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i){var n;return(0,s.Z)(this,r),(n=t.call(this,e,null,null)).uvCoords=i,n}return(0,l.Z)(r)}(ce),Bo=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,n,a)).uvCoords=i,o}return(0,l.Z)(r)}(ce);function Ho(e,t,r,i){var n=jo[e.type]&&jo[e.type][t.type]||Wo[t.type];return n?new n(e,t,r,i):(D.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make","unknown symbol type ".concat(t.type)),null)}var Wo={icon:Qt,object:rn,line:dr,path:Sa,fill:_o,extrude:Re,text:Ro,water:zo};var jo={"mesh-3d":{fill:Tr}},qo=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i,n){var a;return(0,s.Z)(this,r),(a=t.call(this,i.schedule))._symbol=e,a._context=i,a._backgroundLayers=n,a._destroyed=!1,a.symbolLayers=new Array,a.referenced=0,a._extentPadding=0,a}return(0,l.Z)(r,[{key:"symbol",get:function(){return this._symbol},set:function(e){var t=this;this._symbol=e,e.symbolLayers.forEach((function(r,i){var n=t.symbolLayers[i];(0,f.pC)(n)&&(n.symbol=e,n.symbolLayer=r)}))}},{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,i,n,s,l,u=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=this._symbol.symbolLayers,this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r)),i=r.length;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length,n=[],s=function(e){var a=r.getItemAt(e);if(!1===a.enabled)return"continue";Yo.renderPriority=1-(1+e)/i,Yo.renderPriorityStep=1/i,Yo.ignoreDrivers=a._ignoreDrivers;var o=Ho(u.symbol,a,u._context,Yo),s=(0,v.$F)(t,(function(){u.symbolLayers[e]=null,o.destroy()}));s&&n.push(s),u.symbolLayers[e]=o},l=0;case 8:if(!(l<i)){e.next=15;break}if("continue"!==s(l)){e.next=12;break}return e.abrupt("continue",12);case 12:l++,e.next=8;break;case 15:return e.next=17,(0,p.Ed)(this.symbolLayers,function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,f.pC)(t)){e.next=10;break}return e.prev=1,e.next=4,t.load();case 4:u._extentPadding+=Math.max(u._extentPadding,t.extentPadding),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),u.symbolLayers[r]=null;case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}());case 17:if(n.forEach((function(e){return e.remove()})),(0,v.k_)(t),!this.symbolLayers.length||this.symbolLayers.some((function(e){return!!e}))){e.next=21;break}throw new Error;case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSymbolLayerSize",value:function(e){var t=this.symbolLayers[e];return(0,f.pC)(t)?t.getCachedSize():null}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"symbologySnappingSupported",get:function(){return this.symbolLayers.some((function(e){return(0,f.pC)(e)&&e.queryForSnapping}))}},{key:"createGraphics3DGraphic",value:function(e,t){for(var r=e.graphic,i=new Array(this.symbolLayers.length),n=0;n<this.symbolLayers.length;n++){var a=this.symbolLayers[n];i[n]=(0,f.pC)(a)?a.createGraphics3DGraphic(e):null}var o=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new I(r,t||this,i,e.layer,o)}},{key:"complexity",get:function(){return(0,Kr.IQ)(this.symbolLayers.map((function(e){return(0,f.U2)(e,"complexity")})))}},{key:"globalPropertyChanged",value:function(e,t){for(var r=this,i=this.symbolLayers.length,n=function(i){var n=r.symbolLayers[i];if((0,f.pC)(n)&&!n.globalPropertyChanged(e,t,(function(e){var t=e.layers[i];return t instanceof Z.z?t:null})))return{v:!1}},a=0;a<i;a++){var o=n(a);if("object"===typeof o)return o.v}return!0}},{key:"applyRendererDiff",value:function(e,t){return this.loadStatus!==jr.P.LOADED?te.W.Recreate_Symbol:this.symbolLayers.reduce((function(r,i){return r!==te.W.Recreate_Symbol&&(0,f.pC)(i)?Math.min(r,i.applyRendererDiff(e,t)):r}),te.W.Fast_Update)}},{key:"prepareSymbolPatch",value:function(e){if(this.loadStatus!==jr.P.FAILED&&"partial"===e.diff.type){var t=e.diff.diff;if(t.symbolLayers&&"partial"===t.symbolLayers.type){var r=t.symbolLayers.diff;this.symbolLayers.forEach((function(t,i){if(!(0,f.Wi)(t)){var a=r[i];if(a){var o,s={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(s),(o=e.symbolStatePatches).push.apply(o,(0,n.Z)(s.symbolLayerStatePatches)),s.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((function(e,t){var r=e.layers[i];(0,f.pC)(r)&&s.graphics3DGraphicPatches.forEach((function(e){return e(r,t)}))}))}}}))}}}},{key:"updateGeometry",value:function(e,t){for(var r=0;r<this.symbolLayers.length;r++){var i=this.symbolLayers[r];if(!(0,f.Wi)(i)){var n=e.layers[r];if((0,f.Wi)(n)||!i.updateGeometry(n,t))return!1}}return!0}},{key:"onRemoveGraphic",value:function(e){for(var t=0;t<this.symbolLayers.length;t++){var r=this.symbolLayers[t];if(!(0,f.Wi)(r)){var i=e.layers[t];(0,f.pC)(i)&&r.onRemoveGraphic(i)}}}},{key:"getFastUpdateStatus",value:function(){var e=0,t=0,r=0;return this.symbolLayers.forEach((function(i){(0,f.Wi)(i)||(i.loadStatus===jr.P.LOADING?e++:i.isFastUpdatesEnabled()?r++:t++)})),{loading:e,slow:t,fast:r}}},{key:"queryForSnapping",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,i,n){var o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.symbolLayers.filter(f.pC).filter((function(e){return(0,f.pC)(e.queryForSnapping)})).map((function(e){return e.queryForSnapping(t,r,i,n)})),e.next=3,Promise.all(o);case 3:return s=e.sent,e.abrupt("return",((0,v.k_)(n),s.flat()));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this);var e,t=(0,i.Z)(this.symbolLayers);try{for(t.s();!(e=t.n()).done;){var n=e.value;(0,f.pC)(n)&&n.destroy()}}catch(a){t.e(a)}finally{t.f()}this.symbolLayers.length=0,this._destroyed=!0}}},{key:"destroyed",get:function(){return this._destroyed}}]),r}(jr.w),Yo={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1}},73614:function(e,t,r){r.d(t,{d:function(){return x},k:function(){return b}});var i=r(15671),n=r(43144),a=r(60136),o=r(92572),s=r(51995),l=(r(93169),r(32718)),u=r(92026),c=r(71353),h=r(67077),d=r(69691),p=r(78935),f=r(8821),v=r(96387),y=r(41325),m=r(85042),g=r(35218),_=l.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),b=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e,n,a,o){var s;return(0,i.Z)(this,r),(s=t.call(this,a.schedule)).symbol=e,s.symbolLayer=n,s._context=a,s._elevationInfoOverride=null,s._ignoreDrivers=!1,s._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},s.complexity=null,s.logger=_,s._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},s._renderPriority=o.renderPriority,s._renderPriorityStep=o.renderPriorityStep,s._elevationContext=new p.o,s.complexity=s.computeComplexity(),s._ignoreDrivers=o.ignoreDrivers,s._ignoreDrivers||(s._drivenProperties=S(s._context.renderer)),s._updateElevationContext(),s}return(0,n.Z)(r,[{key:"getCachedSize",value:function(){return null}},{key:"extentPadding",get:function(){return 0}},{key:"_drivenPropertiesChanged",value:function(e){if(this._ignoreDrivers)return!1;var t=this._drivenProperties,r=S(e);return r.color!==t.color||r.opacity!==t.opacity||r.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||r.size!==t.size}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},{key:"_logGeometryCreationWarnings",value:function(e,t,r,i){var n=e.projectionSuccess,a="polygons"in e?e.polygons:null,o="".concat(i," geometry failed to be created"),s=null;n?!this._logGeometryValidationWarnings(t,r,i)&&a&&0===a.length&&"rings"===r&&t.length>0&&t[0].length>2&&(s="".concat(o," (filled rings should use clockwise winding - try reversing the order of vertices)")):s="".concat(o," (failed to project geometry to view spatial reference)"),s&&_.warnOncePerTick(s)}},{key:"_logGeometryValidationWarnings",value:function(e,t,r){var i="".concat(r," geometry failed to be created");return!e.length||1===e.length&&!e[0].length?(_.warnOncePerTick("".concat(i," (no ").concat(t," were defined)")),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(_.warnOncePerTick("".concat(i," (").concat(t," should be defined as a 2D array)")),!0)}},{key:"_validateGeometry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,u.pC)(t)&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+" symbol: ".concat(e.type)),!1;if("point"===e.type){var i=e;if(!isFinite(i.x)||!isFinite(i.y))return _.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}},{key:"_defaultElevationInfoNoZ",value:function(){return C}},{key:"_defaultElevationInfoZ",value:function(){return P}},{key:"_updateElevationContext",value:function(){(0,u.pC)(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}},{key:"getDefaultElevationInfo",value:function(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}},{key:"getGeometryElevationMode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getDefaultElevationInfo(e);return this._elevationContext.mode||t.mode}},{key:"setElevationInfoOverride",value:function(e){this._elevationInfoOverride=e,this._updateElevationContext()}},{key:"setGraphicElevationContext",value:function(e,t){var r=(0,u.Wg)(e.geometry),i=this.getDefaultElevationInfo(r);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:i.unit,t.mode=this.getGeometryElevationMode(r,i),t.offsetMeters=(0,u.Pt)(this._elevationContext.meterUnitOffset,(0,u.Pt)(i.offset,0));var n=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;n&&(t.mode="relative-to-ground",t.offsetMeters=0);var a=n?f.O$:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(a,e,this._context.layer),t}},{key:"prepareSymbolLayerPatch",value:function(e){}},{key:"updateGeometry",value:function(e,t){return!1}},{key:"onRemoveGraphic",value:function(e){}},{key:"_getLayerOpacity",value:function(){var e;if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return null!==(e=this._context.graphicsCoreOwner.fullOpacity)&&void 0!==e?e:0;var t=this._context.layer.opacity;return null!==t&&void 0!==t?t:1}},{key:"_getCombinedOpacity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T,r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||((0,u.pC)(e)?r*=e.a:t.hasIntrinsicColor||(r=0)),r}},{key:"_getCombinedOpacityAndColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T,r=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return(0,v.Uu)(null,r);var i=(0,u.pC)(e)?s.Z.toUnitRGB(e):c.O;return(0,v.Uu)(i,r)}},{key:"_getVertexOpacityAndColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this._drivenProperties.color?e.color:null,i=this._drivenProperties.opacity?e.opacity:null,n=(0,v.Uu)(r,i);return(0,u.pC)(t)&&(n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t),n}},{key:"isFastUpdatesEnabled",value:function(){return this._fastUpdates&&this._fastUpdates.enabled}},{key:"computeComplexity",value:function(){return(0,g.u)(this.symbol,this.symbolLayer)}},{key:"globalPropertyChanged",value:function(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged(t,r),!0;case"elevationInfo":var i=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,i)!==d.lO.RECREATE;case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged();default:return!1}}},{key:"updateGraphics3DGraphicElevationInfo",value:function(e,t,r){var i=this,n=d.lO.UPDATE;return e.forEach((function(e){var a=t(e);if((0,u.pC)(a)){var o=e.graphic;i.setGraphicElevationContext(o,a.elevationContext),a.needsElevationUpdates=r(a.elevationContext.mode)}else n=d.lO.RECREATE})),n}},{key:"applyRendererDiff",value:function(e,t){return y.W.Recreate_Symbol}},{key:"getFastUpdateAttrValues",value:function(e){if(!this._fastUpdates.enabled)return null;var t=this._fastUpdates.visualVariables,r=t.size?x(t.size.field,e):0,i=t.color?x(t.color.field,e):0,n=t.opacity?x(t.opacity.field,e):0;return(0,h.f)(r,i,n,0)}},{key:"draped",get:function(){return this._draped}},{key:"ensureDrapedStatus",value:function(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&_.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}},{key:"test",value:function(){var e=this;return{drivenProperties:this._drivenProperties,getVisVarFields:function(){var t,r,i,n,a,o,s,l,u,c,h,d,p,f,v,y;return{size:null!==(t=null===(r=e._fastUpdates)||void 0===r||null===(i=r.visualVariables)||void 0===i||null===(n=i.size)||void 0===n?void 0:n.field)&&void 0!==t?t:null,color:null!==(a=null===(o=e._fastUpdates)||void 0===o||null===(s=o.visualVariables)||void 0===s||null===(l=s.color)||void 0===l?void 0:l.field)&&void 0!==a?a:null,opacity:null!==(u=null===(c=e._fastUpdates)||void 0===c||null===(h=c.visualVariables)||void 0===h||null===(d=h.opacity)||void 0===d?void 0:d.field)&&void 0!==u?u:null,rotation:null!==(p=null===(f=e._fastUpdates)||void 0===f||null===(v=f.visualVariables)||void 0===v||null===(y=v.rotation)||void 0===y?void 0:y.field)&&void 0!==p?p:null}}}}}]),r}(m.w);function x(e,t){var r=null!=e?t.attributes[e]:0;return null!=r&&isFinite(r)?r:0}function S(e){var t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach((function(e){switch(e.type){case"color":if(t.color=!0,e.stops)for(var r=0;r<e.stops.length;r++){var i=e.stops[r].color;i&&(t.opacity=!0,i.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}})),t}var C={mode:"on-the-ground",offset:0,unit:"meters"},P={mode:"absolute-height",offset:0,unit:"meters"},T={hasIntrinsicColor:!1}},19477:function(e,t,r){r.d(t,{Z:function(){return v}});var i=r(74165),n=r(15861),a=r(15671),o=r(43144),s=r(11752),l=r(61120),u=r(60136),c=r(92572),h=r(92026),d=r(41325),p=r(85042),f=r(35218),v=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(e,i,n){var o;return(0,a.Z)(this,r),(o=t.call(this,i)).symbol=e,o._convert=n,o.symbologySnappingSupported=!1,o.graphics3DSymbol=null,o.referenced=0,o}return(0,o.Z)(r,[{key:"getSymbolLayerSize",value:function(e){return(0,h.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null}},{key:"symbolLayers",get:function(){return(0,h.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}},{key:"extentPadding",get:function(){return(0,h.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}},{key:"doLoad",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.symbol.fetchSymbol({signal:t});case 2:if((r=e.sent).id=this.symbol.id,this.graphics3DSymbol=this._convert(r),e.t0=(0,h.pC)(this.graphics3DSymbol),!e.t0){e.next=9;break}return e.next=9,this.graphics3DSymbol.load();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createGraphics3DGraphic",value:function(e){return(0,h.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}},{key:"complexity",get:function(){return(0,h.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:f.WU}},{key:"globalPropertyChanged",value:function(e,t){return!!(0,h.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,t)}},{key:"applyRendererDiff",value:function(e,t){return(0,h.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(e,t):d.W.Recreate_Symbol}},{key:"prepareSymbolPatch",value:function(e){(0,h.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)}},{key:"updateGeometry",value:function(e,t){return!!(0,h.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,t)}},{key:"onRemoveGraphic",value:function(){}},{key:"getFastUpdateStatus",value:function(){return(0,h.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}},{key:"destroy",value:function(){(0,h.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,(0,s.Z)((0,l.Z)(r.prototype),"destroy",this).call(this)}},{key:"destroyed",get:function(){return void 0===this.graphics3DSymbol}}]),r}(p.w)},85042:function(e,t,r){r.d(t,{P:function(){return i},w:function(){return u}});var i,n,a=r(15671),o=r(43144),s=r(92026),l=r(66978),u=function(){function e(t){(0,a.Z)(this,e),this.schedule=t,this._abortController=null,this._loadStatus=i.LOADING,this._loadError=null,this._loader=null,this.logger=null}return(0,o.Z)(e,[{key:"destroy",value:function(){this.abortLoad()}},{key:"loadStatus",get:function(){return this._loadStatus}},{key:"load",value:function(e,t){var r=this;return this._loadStatus===i.LOADED?(e&&e(),(0,s.Pt)(this._loader,Promise.resolve())):this._loadStatus===i.FAILED?(t&&t(this._loadError),(0,s.Pt)(this._loader,Promise.resolve())):((0,s.Wi)(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then((function(){r._abortController=null,r._loadStatus=i.LOADED}),(function(e){throw r._loadError=e,r._abortController=null,r._loadStatus=i.FAILED,!(0,l.D_)(e)&&r.logger&&e.message&&r.logger.warn(e.message),e}))),this._loader.then(e,t).catch((function(){})),this._loader)}},{key:"abortLoad",value:function(){(0,s.pC)(this._abortController)?this._abortController=(0,s.IM)(this._abortController):this._loadStatus===i.LOADING&&(this._loadStatus=i.FAILED),this._loader=null}}]),e}();(n=i||(i={}))[n.LOADING=0]="LOADING",n[n.LOADED=1]="LOADED",n[n.FAILED=2]="FAILED"},61310:function(e,t,r){r.d(t,{Z:function(){return n},r:function(){return a}});var i=r(67077),n=1.2,a=i.Z},70446:function(e,t,r){var i,n;r.d(t,{E:function(){return i},P:function(){return n}}),function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"}(i||(i={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(n||(n={}))},41325:function(e,t,r){var i;r.d(t,{W:function(){return i}}),function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"}(i||(i={}))},31908:function(e,t,r){r.d(t,{$A:function(){return a},EP:function(){return u},QW:function(){return c},j1:function(){return h},mq:function(){return s},yY:function(){return o},zi:function(){return l}});var i=r(6394),n=r(5008),a=Object.freeze({left:0,center:.5,right:1}),o=Object.freeze({"bottom-left":(0,i.f)(0,0),bottom:(0,i.f)(.5,0),"bottom-right":(0,i.f)(1,0),left:(0,i.f)(0,.5),center:(0,i.f)(.5,.5),right:(0,i.f)(1,.5),"top-left":(0,i.f)(0,1),top:(0,i.f)(.5,1),"top-right":(0,i.f)(1,1)});function s(e){switch(e){case"left":return n.vU.Left;case"right":return n.vU.Right;default:return n.vU.Center}}function l(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function u(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function c(e,t){switch(t){case"bottom":return"left"===e?"bottom-left":"right"===e?"bottom-right":"bottom";case"center":return e;case"top":return"left"===e?"top-left":"right"===e?"top-right":"top"}}function h(e){return"middle"===e?"center":e}},36759:function(e,t,r){r.d(t,{S_:function(){return f},ZC:function(){return d},dO:function(){return p}});var i=r(92026),n=r(71353),a=r(79803),o=r(41414),s=r(69662),l=r(65618),u=r(69691),c=r(96387),h=r(66327);function d(e,t,r,n,s,l){var c=e.clippingExtent;if((0,a.KC)(t,v,e.elevationProvider.spatialReference),(0,i.pC)(c)&&!(0,o.BD)(c,v))return null;(0,a.KC)(t,v,e.renderCoordsHelper.spatialReference);var d=e.localOriginFactory.getOrigin(v),p=new h.T({castShadow:!1,metadata:{layerUid:e.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0}});return r.shaderTransformer=l,r.localOrigin=d,p.addGeometry(r),{object:p,sampledElevation:(0,u.bD)(p,t,e.elevationProvider,e.renderCoordsHelper,n)}}function p(e,t,r){var n=e.elevationContext,o=r.spatialReference;(0,a.KC)(t,v,o),n.centerPointInElevationSR=(0,l.Tx)(v[0],v[1],t.hasZ?v[2]:0,(0,i.pC)(o)?o:null)}function f(e){switch(e.type){case"point":return e;case"polygon":case"extent":return(0,c.zE)(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var r=(0,s.n8)(t,(0,s.ok)(t)/2);return(0,l.Tx)(r[0],r[1],r[2],e.spatialReference);case"mesh":return e.origin}return null}var v=(0,n.c)()},22894:function(e,t,r){r.d(t,{F:function(){return a},t:function(){return o}});r(93169);var i=r(70619),n=r(72635);function a(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function o(e,t){var r=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{levels:e.map((function(e){var a=t(e.tesselation);return r&&(0,i.Cr)(a),{components:[new n.QD(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}}))}};switch(e){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],(function(e){return(0,i.mj)(t,.5,e,!0)}));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],(function(){return(0,i.IG)(t,1)}));case"cone":return r(s,(function(e){return(0,i.QL)(t,1,.5,e,!1)}),!0);case"inverted-cone":return r(s,(function(e){return(0,i.QL)(t,1,.5,e,!0)}),!0);case"cylinder":return r(s,(function(e){return(0,i.nb)(t,1,.5,e,[0,0,1],[0,0,.5])}));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],(function(){return(0,i.AW)(t,1)}),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],(function(){return(0,i.B2)(t,1)}),!0);default:return}}var s=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]},35218:function(e,t,r){r.d(t,{BN:function(){return _},IQ:function(){return v},V9:function(){return f},WU:function(){return p},bz:function(){return y},u:function(){return g}});var i=r(1413),n=r(37762),a=r(41644),o=r(92026),s=r(73627),l=r(53727),u=r(22894),c=r(97689),h=r(4760),d=r(72635),p={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function f(e){return"web-style"===e.type?p:v(e.symbolLayers.toArray().map((function(t){return g(e,t)})))}function v(e){var t,r=0,i=0,a=0,s=!1,l=0,u={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}},c=(0,n.Z)(e);try{for(c.s();!(t=c.n()).done;){var h=t.value;(0,o.Wi)(h)||(r+=h.primitivesPerFeature,i+=h.primitivesPerCoordinate,a+=h.drawCallsPerFeature,u.bytesPerFeature+=h.memory.bytesPerFeature,u.bytesPerFeatureLabel+=h.memory.bytesPerFeatureLabel,u.bytesPerCoordinate+=h.memory.bytesPerCoordinate,u.resourceBytes+=h.memory.resourceBytes,u.draped.bytesPerFeature+=h.memory.bytesPerFeature,u.draped.bytesPerFeatureLabel+=h.memory.bytesPerFeatureLabel,u.draped.bytesPerCoordinate+=h.memory.bytesPerCoordinate,s=s||h.estimated,++l)}}catch(d){c.e(d)}finally{c.f()}return{primitivesPerFeature:r,primitivesPerCoordinate:i,drawCallsPerFeature:a,estimated:s,memory:u,numComplexities:l}}function y(e){var t=v(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}var m={};function g(e,t){var r=_(e,t),n=(0,c.eU)(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:n,estimated:!1,memory:r};case"fill":return"mesh-3d"===e.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:n,estimated:!1,memory:r}:(0,o.pC)(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:(0,i.Z)((0,i.Z)({},function(e){var t=m[e];if(t)return t;var r=(0,u.t)(e,null);return t={primitivesPerFeature:(0,d.VV)(r.levels[0]).reduce((function(e,t){return e+t.indices.get(h.T.POSITION).length/3}),0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},m[e]=t,t}(t.resource&&t.resource.primitive||s.S)),{},{memory:r});case"path":var p,f=0,v=0;switch(t.profile){case"circle":f=l.t6;break;case"quad":f=4;break;default:return void(0,a.Bg)(t.profile)}switch(null!==(p=t.join)&&void 0!==p?p:"simple"){case"round":v=l.hy;break;case"miter":case"bevel":v=1;break;default:return}var y=2*f,g=f*v*2,b=-2*g-y;switch(t.cap){case"none":break;case"butt":case"square":b+=2*(f-1);break;case"round":b+=2*(f*(l.tZ-1)*2+f);break;default:return}return{primitivesPerFeature:b,primitivesPerCoordinate:g+y,drawCallsPerFeature:0,estimated:!1,memory:r};case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function _(e,t){var r="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?b.EXTRUDE_EDGES:b.EXTRUDE;case"fill":return(0,o.pC)(t.outline)&&t.outline.size>0?b.FILL_OUTLINE:b.FILL;case"water":return b.FILL;case"line":return"round"===t.join?b.LINE_ROUND:b.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return b.PATH_ROUND_CIRCLE;case"quad":return b.PATH_ROUND_QUAD;default:return void(0,a.Bg)(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return b.PATH_MITER_CIRCLE;case"quad":return b.PATH_MITER_QUAD;default:return void(0,a.Bg)(t.profile)}default:return}case"object":return r?b.OBJECT_POINT:b.OBJECT_POLYGON;case"icon":case"text":return r?b.ICON_POINT:b.ICON_POLYGON;default:return}}var b={ICON_POINT:{bytesPerFeature:3293.7707557538765,bytesPerFeatureLabel:1020.2764,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2213.51585392203,bytesPerFeatureLabel:1008.84664,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:4745.397589234022,bytesPerFeatureLabel:1006.5440666666666,bytesPerCoordinate:3.8971910718981526,resourceBytes:0,draped:{bytesPerFeature:3711.9299672493826,bytesPerFeatureLabel:991.1003999999999,bytesPerCoordinate:3.916858016273668}},OBJECT_POINT:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855,resourceBytes:0,draped:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855}},LINE_MITER:{bytesPerFeature:5757.019675077085,bytesPerFeatureLabel:998.6150266666667,bytesPerCoordinate:24.456810187064043,resourceBytes:0,draped:{bytesPerFeature:4101.480288021862,bytesPerFeatureLabel:1007.7540599999999,bytesPerCoordinate:18.25629912730874}},LINE_ROUND:{bytesPerFeature:5770.95297166408,bytesPerFeatureLabel:1017.77396,bytesPerCoordinate:24.60919037084966,resourceBytes:0,draped:{bytesPerFeature:4089.5796612121826,bytesPerFeatureLabel:987.8320266666666,bytesPerCoordinate:18.43599029126731}},PATH_MITER_CIRCLE:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863,resourceBytes:0,draped:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863}},PATH_ROUND_CIRCLE:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177,resourceBytes:0,draped:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177}},PATH_MITER_QUAD:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994,resourceBytes:0,draped:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994}},PATH_ROUND_QUAD:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293,resourceBytes:0,draped:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293}},FILL:{bytesPerFeature:6141.501452970723,bytesPerFeatureLabel:1008.2056066666665,bytesPerCoordinate:9.669541106191478,resourceBytes:0,draped:{bytesPerFeature:4615.812654782311,bytesPerFeatureLabel:1004.2114200000001,bytesPerCoordinate:7.378043214430644}},FILL_OUTLINE:{bytesPerFeature:9038.575581319641,bytesPerFeatureLabel:1017.9996066666668,bytesPerCoordinate:14.96569682175086,resourceBytes:0,draped:{bytesPerFeature:6369.386021594582,bytesPerFeatureLabel:1008.9863733333334,bytesPerCoordinate:10.25287774000214}},EXTRUDE:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849,resourceBytes:0,draped:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849}},EXTRUDE_EDGES:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031,resourceBytes:0,draped:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031}}}},97689:function(e,t,r){r.d(t,{hM:function(){return c},C8:function(){return h},$s:function(){return d},eU:function(){return u}});var i=r(1413),n=r(51995),a=(r(93169),r(92026)),o=r(17842),s=r(67077);var l=r(77958);function u(e){return e&&e.enabled&&(function(e){return"extrude"===e.type}(e)||function(e){return"fill"===e.type}(e))&&(0,a.pC)(e.edges)}function c(e,t){return h(function(e){return e&&e.enabled&&e.edges||null}(e),t)}function h(e,t){if((0,a.Wi)(e))return null;var r,l=(0,a.pC)(e.color)?(0,s.b)(n.Z.toUnitRGBA(e.color)):(0,s.f)(0,0,0,0),u=(0,o.F2)(e.size),c=(0,o.F2)(e.extensionLength);switch(e.type){case"solid":return d((0,i.Z)({color:l,size:u,extensionLength:c},t));case"sketch":return r=(0,i.Z)({color:l,size:u,extensionLength:c},t),(0,i.Z)((0,i.Z)((0,i.Z)({},f),r),{},{type:"sketch"});default:return}}function d(e){return(0,i.Z)((0,i.Z)((0,i.Z)({},p),e),{},{type:"solid"})}var p={color:(0,s.f)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:l.i.OPAQUE,hasSlicePlane:!1},f={color:(0,s.f)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:l.i.OPAQUE,hasSlicePlane:!1}},57557:function(e,t,r){r.d(t,{q:function(){return P}});var i=r(37762),n=r(15671),a=r(43144),o=r(41644),s=r(16889),l=r(14226),u=r(81949),c=r(11186),h=r(71353),d=r(83448),p=r(79803),f=r(41414),v=r(65156),y=r(95773),m=r(85981),g=r(55652),_=r(40885),b=r(50951),x=r(83281),S=.5*Math.PI,C=S/Math.PI*180,P=function(){function e(t){(0,n.Z)(this,e),this._renderCoordsHelper=t.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:(0,h.c)(),direction:(0,h.c)()};for(var r=0;r<4;r++)this._extent[r]={origin:(0,h.c)(),direction:(0,h.c)(),cap:{next:null,direction:(0,h.c)()}},this._planes[r]=(0,g.Ue)();this._planes[y.Nu.NEAR]=(0,g.Ue)(),this._planes[y.Nu.FAR]=(0,g.Ue)(),this._planesWithoutFar=this._planes.slice(0,5)}return(0,a.Z)(e,[{key:"update",value:function(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=this._extent;this._toRenderBoundingExtent(e,t,r),(0,c.a)(this._center.origin,n[0].origin,n[2].origin),(0,c.g)(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),i||(0,c.g)(this._center.direction,this._center.direction,-1);for(var a=0;a<4;a++){var o=n[a];this._renderCoordsHelper.worldUpAtPosition(o.origin,o.direction);var s=n[3===a?0:a+1];o.cap.next=s.origin,(0,c.r)(o.cap.direction,o.origin,s.origin),(0,g.my)(o.direction,o.cap.direction,o.origin,this._planes[a]),i||(0,c.g)(o.direction,o.direction,-1)}(0,g.my)(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[y.Nu.NEAR]),i?(0,g.tk)(this._planes[y.Nu.NEAR],this._planes[y.Nu.FAR]):((0,g.JG)(this._planes[y.Nu.FAR],this._planes[y.Nu.NEAR]),(0,g.tk)(this._planes[y.Nu.NEAR],this._planes[y.Nu.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=t,this._minGlobalAltitude=.9*(0,d.Iu)(this._maxSpanSpatialReference).radius}},{key:"isVisibleInFrustum",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e)return!1;if(this._renderCoordsHelper.viewingMode===b.JY.Global){var i=this._maxSpanSpatialReference.isGeographic?C:S*t;if(this._maxSpan>i)return!0;if(null!=e.altitude&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(0===this._maxSpan){var n=this._extent[0];return!(r||!e.intersectsRay((0,_.re)(n.origin,n.direction)))}for(var a=0;a<this._extent.length;a++){var o=this._extent[a];if(!r&&e.intersectsRay((0,_.re)(o.origin,o.direction)))return!0;if(e.intersectsLineSegment((0,m.zk)(o.origin,o.cap.next,R),o.cap.direction))return!0}for(var s=r?this._planes:this._planesWithoutFar,l=0;l<e.lines.length;l++){var u=e.lines[l];if((0,x.kD)(s,u.origin,u.endpoint,u.direction))return!0}return!1}},{key:"_toRenderBoundingExtentGlobal",value:function(e,t,r){(0,v.be)(e,O),O[2]=r,(0,p.Bm)(t,O,w,this._renderCoordsHelper.spatialReference),(0,l.a)(A,w),(0,f.cS)(k);var n,a=(0,i.Z)(T);try{for(a.s();!(n=a.n()).done;)for(var o=n.value,u=o.x0,h=o.x1,d=o.y0,y=o.y1,m=0;m<5;m++){var g=m/4;O[0]=(0,s.t7)(e[u],e[h],g),O[1]=(0,s.t7)(e[d],e[y],g),O[2]=r,(0,p.SH)(O,t,O,this._renderCoordsHelper.spatialReference),(0,c.m)(O,O,A),(0,f.pp)(k,O)}}catch(b){a.e(b)}finally{a.f()}(0,c.s)(this._extent[0].origin,k[0],k[1],k[2]),(0,c.s)(this._extent[1].origin,k[3],k[1],k[2]),(0,c.s)(this._extent[2].origin,k[3],k[4],k[2]),(0,c.s)(this._extent[3].origin,k[0],k[4],k[2]);for(var _=0;_<4;++_)(0,c.m)(this._extent[_].origin,this._extent[_].origin,w)}},{key:"_toRenderBoundingExtentLocal",value:function(e,t,r){(0,p.dH)(e,t,E,this._renderCoordsHelper.spatialReference),(0,c.s)(this._extent[0].origin,E[0],E[1],r),(0,c.s)(this._extent[1].origin,E[2],E[1],r),(0,c.s)(this._extent[2].origin,E[2],E[3],r),(0,c.s)(this._extent[3].origin,E[0],E[3],r)}},{key:"_toRenderBoundingExtent",value:function(e,t,r){switch(this._renderCoordsHelper.viewingMode){case b.JY.Global:this._toRenderBoundingExtentGlobal(e,t,r);break;case b.JY.Local:this._toRenderBoundingExtentLocal(e,t,r);break;default:(0,o.Bg)(this._renderCoordsHelper.viewingMode)}}},{key:"_isVisibleInFrustumGlobal",value:function(e){if((0,g.jH)(e.planes[y.Nu.NEAR],this._center.origin)<0&&(0,c.e)(this._center.direction,e.direction)<0)return!0;for(var t=0;t<4;t++){var r=this._extent[t];if((0,g.jH)(e.planes[y.Nu.NEAR],r.origin)<0&&(0,c.e)(r.direction,e.direction)<0)return!0}return!1}}]),e}(),T=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],O=(0,h.c)(),w=(0,u.c)(),A=(0,u.c)(),k=(0,f.Ue)(),E=(0,v.Ue)(),R=(0,m.Ue)()},65206:function(e,t,r){r.d(t,{G:function(){return s},O:function(){return o}});var i=r(92026),n=r(71353),a=r(79803);function o(e,t,r){if((0,i.Wi)(e)||(0,i.Wi)(r))return!1;var n=!0;return l[0]=null!=e.xmin?e.xmin:0,l[1]=null!=e.ymin?e.ymin:0,l[2]=null!=e.zmin?e.zmin:0,n=n&&(0,a.CM)(l,e.spatialReference,0,t,r,0,1),l[0]=null!=e.xmax?e.xmax:0,l[1]=null!=e.ymax?e.ymax:0,l[2]=null!=e.zmax?e.zmax:0,n=n&&(0,a.CM)(l,e.spatialReference,0,t,r,3,1),null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.zmin&&(t[2]=-1/0),null==e.xmax&&(t[3]=1/0),null==e.ymax&&(t[4]=1/0),null==e.zmax&&(t[5]=1/0),n}function s(e,t,r){if((0,i.Wi)(e)||(0,i.Wi)(r))return!1;var n=!0;return l[0]=null!=e.xmin?e.xmin:0,l[1]=null!=e.ymin?e.ymin:0,l[2]=null!=e.zmin?e.zmin:0,n=n&&(0,a.CM)(l,e.spatialReference,0,l,r,0,1),t[0]=l[0],t[1]=l[1],l[0]=null!=e.xmax?e.xmax:0,l[1]=null!=e.ymax?e.ymax:0,l[2]=null!=e.zmax?e.zmax:0,n=n&&(0,a.CM)(l,e.spatialReference,0,l,r,0,1),t[2]=l[0],t[3]=l[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),n}var l=(0,n.c)()},83281:function(e,t,r){r.d(t,{W8:function(){return l},kD:function(){return s}});var i=r(6394),n=r(11186),a=r(71353),o=r(55652);function s(e,t,r,i){return d(e,t,r,c(i,t,r,!0))}function l(e,t,r,i){var a=(0,n.e)(r,(0,n.b)(e,i,t));return(0,n.a)(e,t,(0,n.g)(e,r,a))}var u={dir:(0,a.c)(),len:0,clip:(0,i.a)()};function c(e,t,r,i){var a=u;return e?(r&&i&&(a.len=(0,n.i)(t,r)),(0,n.c)(a.dir,e)):i?(a.len=(0,n.i)(t,r),(0,n.b)(a.dir,r,t),(0,n.g)(a.dir,a.dir,1/a.len)):((0,n.b)(a.dir,r,t),(0,n.n)(a.dir,a.dir)),a}function h(e,t,r){var i=(0,n.e)((0,o.mJ)(e),r.dir),a=-(0,o.jH)(e,t);if(a<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return a>0;if((a<0||i<0)&&!(a<0&&i<0))return!0;var s=a/i;return i>0?s<r.clip[1]&&(r.clip[1]=s):s>r.clip[0]&&(r.clip[0]=s),r.clip[0]<=r.clip[1]}function d(e,t,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(var n=0;n<e.length;n++)if(!h(e[n],t,i))return!1;return!0}},75027:function(e,t,r){r.d(t,{C:function(){return k},W:function(){return A}});var i,n,a,o,s,l,u,c,h,d,p,f=r(43144),v=r(15671),y=r(60136),m=r(92572),g=r(30168),_=r(6394),b=r(52276),x=r(82999),S=r(49450),C=r(59150),P=r(699),T=r(98634),O=r(4760),w=r(65964);function A(e,t){var r=O.T.FEATUREVALUE;e.attributes.add(r,"vec4");var f=e.vertex;f.code.add((0,T.H)(i||(i=(0,g.Z)(["\n  bool isCapVertex() {\n    return ",".w == 1.0;\n  }\n  "])),r)),f.uniforms.add(new x.A("size",(function(e){return e.size}))),t.vvSize?(f.uniforms.add(new S.J("vvSizeMinSize",(function(e){return e.vvSizeMinSize}))),f.uniforms.add(new S.J("vvSizeMaxSize",(function(e){return e.vvSizeMaxSize}))),f.uniforms.add(new S.J("vvSizeOffset",(function(e){return e.vvSizeOffset}))),f.uniforms.add(new S.J("vvSizeFactor",(function(e){return e.vvSizeFactor}))),f.code.add((0,T.H)(n||(n=(0,g.Z)(["\n    vec2 getSize() {\n      return size * clamp(vvSizeOffset + ",".x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n    }\n    "])),r))):f.code.add((0,T.H)(a||(a=(0,g.Z)(["vec2 getSize(){\nreturn size;\n}"])))),t.vvOpacity?(f.constants.add("vvOpacityNumber","int",8),f.uniforms.add([new P.O("vvOpacityValues",(function(e){return e.vvOpacityValues}),8),new P.O("vvOpacityOpacities",(function(e){return e.vvOpacityOpacities}),8)]),f.code.add((0,T.H)(o||(o=(0,g.Z)(["\n    vec4 applyOpacity(vec4 color) {\n      float value = ",".z;\n      if (value <= vvOpacityValues[0]) {\n        return vec4( color.xyz, vvOpacityOpacities[0]);\n      }\n\n      for (int i = 1; i < vvOpacityNumber; ++i) {\n        if (vvOpacityValues[i] >= value) {\n          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n        }\n      }\n\n      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);\n    }\n    "])),r))):f.code.add((0,T.H)(s||(s=(0,g.Z)(["vec4 applyOpacity(vec4 color){\nreturn color;\n}"])))),t.vvColor?(f.constants.add("vvColorNumber","int",w.x),f.uniforms.add([new P.O("vvColorValues",(function(e){return e.vvColorValues}),w.x),new C.b("vvColorColors",(function(e){return e.vvColorColors}),w.x)]),f.code.add((0,T.H)(l||(l=(0,g.Z)(["\n    vec4 getColor() {\n      float value = ",".y;\n      if (value <= vvColorValues[0]) {\n        return applyOpacity(vvColorColors[0]);\n      }\n\n      for (int i = 1; i < vvColorNumber; ++i) {\n        if (vvColorValues[i] >= value) {\n          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n        }\n      }\n\n      return applyOpacity(vvColorColors[vvColorNumber - 1]);\n    }\n    "])),r))):f.code.add((0,T.H)(u||(u=(0,g.Z)(["vec4 getColor(){\nreturn applyOpacity(vec4(1, 1, 1, 1));\n}"])))),e.include(b.f),e.attributes.add(O.T.PROFILERIGHT,"vec4"),e.attributes.add(O.T.PROFILEUP,"vec4"),e.attributes.add(O.T.PROFILEVERTEXANDNORMAL,"vec4"),f.code.add((0,T.H)(c||(c=(0,g.Z)(["vec3 calculateVPos() {\nvec2 size = getSize();\nvec3 origin = position;\nvec3 right = profileRight.xyz;\nvec3 up = profileUp.xyz;\nvec3 forward = cross(up, right);\nvec2 profileVertex = profileVertexAndNormal.xy * size;\nvec2 profileNormal = profileVertexAndNormal.zw;\nfloat positionOffsetAlongProfilePlaneNormal = 0.0;\nfloat normalOffsetAlongProfilePlaneNormal = 0.0;"])))),f.code.add((0,T.H)(h||(h=(0,g.Z)(["if(!isCapVertex()) {\nvec2 rotationRight = vec2(profileRight.w, profileUp.w);\nfloat maxDistance = length(rotationRight);"])))),f.code.add((0,T.H)(d||(d=(0,g.Z)(["rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);\nfloat rx = dot(profileVertex, rotationRight);\nif (abs(rx) > maxDistance) {\nvec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);\nfloat ry = dot(profileVertex, rotationUp);\nprofileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n}\n}else{\npositionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];\nnormalOffsetAlongProfilePlaneNormal = profileUp.w;\n}\nvec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\nreturn origin + offset;\n}"])))),f.code.add((0,T.H)(p||(p=(0,g.Z)(["vec3 localNormal() {\nvec3 right = profileRight.xyz;\nvec3 up = profileUp.xyz;\nvec3 forward = cross(up, right);\nvec2 profileNormal = profileVertexAndNormal.zw;\nvec3 normal = right * profileNormal.x + up * profileNormal.y;\nif(isCapVertex()) {\nnormal += forward * profileUp.w;\n}\nreturn normal;\n}"]))))}var k=function(e){(0,y.Z)(r,e);var t=(0,m.Z)(r);function r(){var e;return(0,v.Z)(this,r),(e=t.apply(this,arguments)).size=(0,_.f)(1,1),e}return(0,f.Z)(r)}(w.n)},17579:function(e,t,r){r.d(t,{T:function(){return l}});var i=r(43144),n=r(15671),a=r(60136),o=r(92572),s=r(92026);r(40779).Z;function l(e){return(0,s.pC)(e.mapPositions)}},43164:function(e,t,r){r.d(t,{V:function(){return d}});var i=r(74165),n=r(15861),a=r(15671),o=r(43144),s=r(51995),l=r(32718),u=r(92026),c=r(17842),h=r(67077),d=function(){function e(t){(0,a.Z)(this,e),this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=0!==t.background.color[3]?this._colorToRGBA(t.background.color):null}return(0,o.Z)(e,[{key:"fontString",value:function(e){var t=this.definition.font;return"".concat(t.style," ").concat(t.weight," ").concat(e,"px ").concat(t.family,", sans-serif")}},{key:"_colorToRGB",value:function(e){return"rgb(".concat(e.slice(0,3).map((function(e){return Math.floor(255*e)})).toString(),")")}},{key:"_colorToRGBA",value:function(e){return"rgba(".concat(e.slice(0,3).map((function(e){return Math.floor(255*e)})).toString(),",").concat(e[3],")")}}],[{key:"fromSymbol",value:function(){var t=(0,n.Z)((0,i.Z)().mark((function t(r,n){var a,o,d,p,f,v,y,m,g,_;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=(0,u.U2)(r,"material","color"),o=(0,u.R2)(a,h.Z,s.Z.toUnitRGBA),d=(0,u.R2)(r.size,12,c.F2),p=r.lineHeight,f=(0,u.pC)(r.background)?(0,u.Wg)(s.Z.toUnitRGBA(r.background.color)):h.Z,v={family:(0,u.R2)(r.font,"sans-serif",(function(e){return e.family})),decoration:(0,u.R2)(r.font,"none",(function(e){return e.decoration})),weight:(0,u.R2)(r.font,"normal",(function(e){return e.weight})),style:(0,u.R2)(r.font,"normal",(function(e){return e.style}))},y=r.halo,m=(0,u.pC)(y)&&(0,u.pC)(y.color)&&y.size>0?{size:(0,c.F2)(y.size),color:s.Z.toUnitRGBA(y.color)}:{size:0,color:h.Z},g=new e({color:o,size:d,background:{color:f,padding:(0,u.pC)(r.background)?[.65*d,.5*d]:[0,0],borderRadius:(0,u.pC)(r.background)?d*(6/16):0},lineSpacingFactor:p,font:v,halo:m,pixelRatio:n}),_=g.fontString(d),t.prev=1,t.next=4,document.fonts.load(_);case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),l.Z.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce("Failed to preload font '".concat(_,"'. Some text symbology may be rendered using the default browser font."));case 9:return t.abrupt("return",g);case 10:case"end":return t.stop()}}),t,null,[[1,6]])})));return function(e,r){return t.apply(this,arguments)}}()}]),e}()},5008:function(e,t,r){r.d(t,{GZ:function(){return v},tV:function(){return d},vU:function(){return i}});for(var i,n,a=r(29439),o=r(37762),s=r(15671),l=r(43144),u=r(16889),c=r(92026),h=r(94463),d=function(){function e(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2048;(0,s.Z)(this,e),this.text=t,this._alignment=r,this._parameters=i,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key="TextRenderer-".concat(this._parameters.key,"-").concat(this._alignment,"--").concat(t),this._lines=t.split(/\r?\n/)}return(0,l.Z)(e,[{key:"displayWidth",get:function(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}},{key:"displayHeight",get:function(){var e=this._lineSpacing*(this._lines.length-1),t=this._lineHeight;return Math.ceil(e+t+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}},{key:"renderedWidth",get:function(){return Math.ceil(this._toRenderUnit(this.displayWidth))}},{key:"renderedHeight",get:function(){return Math.ceil(this._toRenderUnit(this.displayHeight))}},{key:"firstRenderedBaselinePosition",get:function(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}},{key:"_firstLineYOffset",get:function(){return this._backgroundTopPadding+this._haloSize}},{key:"_metrics",get:function(){var e=this;if((0,c.Wi)(this._metricsCached)){var t=v(y,g,g).getContext("2d");this._setFontProperties(t,this._fontSize);var r=2*this._haloSize,i=this._parameters.definition.font;"italic"!==i.style&&"oblique"!==i.style&&"bold"!==i.weight&&"bolder"!==i.weight||(r+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;var n,a,o=0,s=0,l=0;this._lines.forEach((function(i,u){var c=t.measureText(i),h=c.width,d=h+r;e._textWidths.push(h),e._lineWidths.push(d),o=Math.max(o,d),s=Math.max(s,c.actualBoundingBoxAscent),l=Math.max(l,c.actualBoundingBoxDescent),0===u&&(n=c),u===e._lines.length-1&&(a=c)}));var u=t.font,h=C.get(u);if(!h){var d=t.measureText(b);h=new S(d.actualBoundingBoxAscent,d.actualBoundingBoxDescent),C.set(u,h)}s=Math.max(s,h.actualBoundingBoxAscent),l=Math.max(l,h.actualBoundingBoxDescent);var p=s+l,f=this._hasBackground?n.actualBoundingBoxAscent:s,m=this._hasBackground?a.actualBoundingBoxDescent:l;this._metricsCached=new x(s-f,l-m,p,o,s)}return this._metricsCached}},{key:"_lineSpacing",get:function(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}},{key:"_lineHeight",get:function(){return this._metrics.lineHeight}},{key:"_linePadding",get:function(){return this._lineHeight*m}},{key:"_baselinePosition",get:function(){return this._metrics.baselinePosition}},{key:"_renderedFontSize",get:function(){return this._toRenderUnit(this._fontSize)}},{key:"_fontSize",get:function(){return this._parameters.definition.size}},{key:"_renderedHaloSize",get:function(){return this._toRenderUnit(this._haloSize)}},{key:"_haloSize",get:function(){return this._parameters.haloSize}},{key:"_backgroundHorizontalPadding",get:function(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}},{key:"_backgroundVerticalPadding",get:function(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}},{key:"_backgroundTopPadding",get:function(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}},{key:"_backgroundBottomPadding",get:function(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}},{key:"_hasBackground",get:function(){return!!this._parameters.backgroundStyle}},{key:"renderPixelRatio",get:function(){if((0,c.Wi)(this._renderPixelRatio)){var e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}},{key:"_getLineXOffset",value:function(e){switch(this._alignment){case i.Left:return this._backgroundHorizontalPadding;case i.Center:return(this.displayWidth-this._lineWidths[e])/2;case i.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}},{key:"render",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e.save();var i=t/=this.renderPixelRatio,n=r/=this.renderPixelRatio,a=this._haloSize,o=this._firstLineYOffset;t+=a,r+=o+this._baselinePosition;var s=this._haloSize>0;s&&this._renderHalo(e,i,n,a,o),this._setFontProperties(e,this._renderedFontSize);for(var l=0;l<this._lines.length;++l){var u=this._lines[l],c=this._getLineXOffset(l);s&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,t+c,r),this._renderLineDecoration(e,t+c,r,this._textWidths[l])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,t+this._getLineXOffset(l),r),this._renderLineDecoration(e,t+c,r,this._textWidths[l]),r+=this._lineSpacing}if(h.Z.TEXT_SHOW_BASELINE){e.strokeStyle=_,e.setLineDash([2,2]),e.lineWidth=1;for(var d=n+o,p=0;p<this._lines.length;++p){var f=d+this._baselinePosition;this._drawLine(e,[i,f],[i+this.displayWidth,f]),d+=this._lineSpacing}}if(h.Z.TEXT_SHOW_BORDER&&(e.strokeStyle=_,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[i,n],[this.displayWidth,this.displayHeight])),this._hasBackground){var v=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,i,n,v),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}},{key:"_renderLineDecoration",value:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("none"!==this._parameters.definition.font.decoration&&0!==i){var a=1,o=Math.max(this._parameters.definition.size/16,a);switch(this._parameters.definition.font.decoration){case"underline":r+=2*o;break;case"line-through":r-=.33*this._baselinePosition}var s=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(o+2*s),e.beginPath(),e.moveTo(this._toRenderUnit(t-s),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(t+i+s),this._toRenderUnit(r)),e.stroke()}}},{key:"_roundedRect",value:function(e,t,r,i){t=this._toRenderUnit(t),r=this._toRenderUnit(r);var n=this.renderedWidth,a=this.renderedHeight;0!==i?(i=(0,u.uZ)(i,0,Math.floor(a/2)),e.beginPath(),e.moveTo(t,r+i),e.arcTo(t,r,t+i,r,i),e.lineTo(t+n-i,r),e.arcTo(t+n,r,t+n,r+i,i),e.lineTo(t+n,r+a-i),e.arcTo(t+n,r+a,t+n-i,r+a,i),e.lineTo(t+i,r+a),e.arcTo(t,r+a,t,r+a-i,i),e.closePath()):e.rect(t,r,n,a)}},{key:"_renderHalo",value:function(e,t,r,i,n){var a=this.renderedWidth,o=this.renderedHeight,s=v(y,Math.max(a,g),Math.max(o,g)),l=s.getContext("2d");l.clearRect(0,0,a,o),this._setFontProperties(l,this._renderedFontSize),l.fillStyle=this._parameters.haloStyle,l.strokeStyle=this._parameters.haloStyle;var u=this._renderedHaloSize<3;l.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(l,i,n):this._renderHaloNative(l,i,n);for(var c=n+this._baselinePosition,h=0;h<this._lines.length;++h){var d=this._getLineXOffset(h);this._renderLineDecoration(l,i+d,c,this._textWidths[h],!0),c+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(s,0,0,a,o,this._toRenderUnit(t),this._toRenderUnit(r),a,o),e.globalAlpha=1}},{key:"_renderHaloEmulated",value:function(e,t,r){r+=this._baselinePosition;for(var i=0;i<this._lines.length;++i){var n,s=this._lines[i],l=this._getLineXOffset(i),u=(0,o.Z)(p);try{for(u.s();!(n=u.n()).done;){var c=(0,a.Z)(n.value,2),h=c[0],d=c[1];this._fillText(e,s,t+l+this._haloSize*h,r+this._haloSize*d)}}catch(f){u.e(f)}finally{u.f()}r+=this._lineSpacing}}},{key:"_renderHaloNative",value:function(e,t,r){var i=2*this._haloSize;r+=this._baselinePosition;for(var n=0;n<this._lines.length;++n){for(var a=this._lines[n],o=this._getLineXOffset(n),s=0;s<5;s++){var l=.6+.1*s;e.lineWidth=this._toRenderUnit(l*i),this._strokeText(e,a,t+o,r)}r+=this._lineSpacing}}},{key:"_setFontProperties",value:function(e,t){e.font=this._parameters.fontString(t),e.textAlign="left",e.textBaseline="alphabetic"}},{key:"_displayWidth",get:function(){return this._metrics.displayWidth}},{key:"_toRenderUnit",value:function(e){return e*this.renderPixelRatio}},{key:"_toRoundedRenderUnit",value:function(e){return Math.round(e*this.renderPixelRatio)}},{key:"_fillText",value:function(e,t,r,i){e.fillText(t,this._toRenderUnit(r),this._toRenderUnit(i))}},{key:"_strokeText",value:function(e,t,r,i){e.strokeText(t,this._toRenderUnit(r),this._toRenderUnit(i))}},{key:"_drawLine",value:function(e,t,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(t[0])+.5,this._toRoundedRenderUnit(t[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}},{key:"_drawBox",value:function(e,t,r){var i=this._toRenderUnit(t[0]),n=this._toRenderUnit(t[1]),a=this._toRenderUnit(r[0]),o=this._toRenderUnit(r[1]),s=Math.floor(i)+.5,l=Math.ceil(i+a)-.5,u=Math.floor(n)+.5,c=Math.ceil(n+o)-.5;e.beginPath(),e.moveTo(s,u),e.lineTo(l,u),e.lineTo(l,c),e.lineTo(s,c),e.lineTo(s,u),e.stroke()}}]),e}(),p=[],f=0;f<360;f+=22.5)p.push([Math.cos(Math.PI*f/180),Math.sin(Math.PI*f/180)]);function v(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}(n=i||(i={}))[n.Left=0]="Left",n[n.Center=1]="Center",n[n.Right=2]="Right";var y={canvas:null},m=.2,g=512,_="rgb(255, 0, 255, 0.5)",b=function(){for(var e="",t=32;t<127;t++)e+=String.fromCharCode(t);return e}(),x=(0,l.Z)((function e(t,r,i,n,a){(0,s.Z)(this,e),this.paddingTop=t,this.paddingBottom=r,this.lineHeight=i,this.displayWidth=n,this.baselinePosition=a})),S=(0,l.Z)((function e(t,r){(0,s.Z)(this,e),this.actualBoundingBoxAscent=t,this.actualBoundingBoxDescent=r})),C=new Map},77958:function(e,t,r){var i;r.d(t,{i:function(){return i}}),function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"}(i||(i={}))},22255:function(e,t,r){r.d(t,{w:function(){return h},x:function(){return c}});var i=r(43144),n=r(15671),a=r(60136),o=r(92572),s=r(54463),l=r(55848),u=r(22178),c=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e,i,a,o,s,l){var u;return(0,n.Z)(this,r),(u=t.call(this,e,i)).layerUid=e,u.graphicUid=i,u.geometryId=a,u.triangleNr=o,u.baseBoundingSphere=s,u.numLodLevels=l,u}return(0,i.Z)(r)}(l.Dx);function h(e){return(0,u.nn)(e)&&e.intersector===s.q7.LOD&&!!e.target}},72635:function(e,t,r){r.d(t,{QD:function(){return l},VQ:function(){return c},VV:function(){return h},aH:function(){return u},ci:function(){return d}});var i=r(93433),n=r(43144),a=r(15671),o=r(63780),s=r(92026),l=(0,n.Z)((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,a.Z)(this,e),this.geometry=t,this.textures=r}));function u(e){var t=[];return e.levels.forEach((function(e){return e.components.forEach((function(e){return t.push(e.geometry.material)}))})),(0,o.Tw)(t)}function c(e){var t=new Array;return e.levels.forEach((function(e){e.components.forEach((function(e){(0,s.pC)(e.textures)&&t.push.apply(t,(0,i.Z)(e.textures))}))})),(0,o.Tw)(t)}function h(e){var t=e.components.map((function(e){return e.geometry}));return(0,o.Tw)(t)}function d(e){var t=[];return e.levels.forEach((function(e){e.components.forEach((function(e){t.push(e.geometry)}))})),(0,o.Tw)(t)}},21317:function(e,t,r){r.d(t,{X:function(){return R}});var i=r(15671),n=r(43144),a=r(60136),o=r(92572),s=r(92026),l=r(11186),u=r(71353),c=r(55158),h=r(37081),d=r(17363),p=r(56529),f=r(93822),v=r(4760),y=r(65964),m=r(11752),g=r(61120),_=r(82144),b=r(31132),x=r(78041),S=r(27627),C=r(50411),P=r(25920),T=r(83609),O=r(36207),w=new Map([[v.T.POSITION,0],[v.T.UV0,2],[v.T.AUXPOS1,3],[v.T.NORMAL,4],[v.T.COLOR,5],[v.T.COLORFEATUREATTRIBUTE,5],[v.T.SIZE,6],[v.T.SIZEFEATUREATTRIBUTE,6],[v.T.OPACITYFEATUREATTRIBUTE,7]]),A=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,n.Z)(r,[{key:"initializeProgram",value:function(e){return new S.$(e.rctx,r.shader.get().build(this.configuration),w)}},{key:"_makePipelineState",value:function(e,t){var r=this.configuration,i=e===P.A.NONE;return(0,O.sm)({blending:r.output===h.H.Color||r.output===h.H.Alpha?i?x.wu:(0,x.j7)(e):null,depthTest:{func:(0,x.Bh)(e)},depthWrite:i?r.writeDepth?O.LZ:null:(0,x.K5)(e),colorWrite:O.BK,stencilWrite:r.hasOccludees?C.s3:null,stencilTest:r.hasOccludees?t?C.eD:C.RY:null,polygonOffset:{factor:0,units:-10}})}},{key:"initializePipeline",value:function(){return this.configuration.occluder&&(this._occluderPipelineTransparent=(0,O.sm)({blending:x.wu,depthTest:C.zV,depthWrite:null,colorWrite:O.BK,stencilWrite:null,stencilTest:C.YD}),this._occluderPipelineOpaque=(0,O.sm)({blending:x.wu,depthTest:C.zV,depthWrite:null,colorWrite:O.BK,stencilWrite:C.P7,stencilTest:C.ii}),this._occluderPipelineMaskWrite=(0,O.sm)({blending:null,depthTest:C.JN,depthWrite:null,colorWrite:null,stencilWrite:C.s3,stencilTest:C.eD})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===f.r.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===f.r.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:(0,m.Z)((0,g.Z)(r.prototype),"getPipelineState",this).call(this,e,t)}}]),r}(b.A);A.shader=new _.J(T.L,(function(){return r.e(22668).then(r.bind(r,22668))}));var k=r(33720),E=r(737),R=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e,new I))._vertexAttributeLocations=w,n._configuration=new k.PI,n._layout=n.createLayout(),n}return(0,n.Z)(r,[{key:"dispose",value:function(){}},{key:"getConfiguration",value:function(e,t){return this._configuration.output=e,this._configuration.space=t.slot===f.r.DRAPED_MATERIAL?k.I9.Draped:this.parameters.worldSpace?k.I9.World:k.I9.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==E.R.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.occluder=this.parameters.renderOccluded===p.yD.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}},{key:"intersect",value:function(){}},{key:"createLayout",value:function(){var e=(0,c.U$)().vec3f(v.T.POSITION).vec2f(v.T.UV0).vec3f(v.T.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(v.T.NORMAL),this.parameters.vvSizeEnabled?e.f32(v.T.SIZEFEATUREATTRIBUTE):e.f32(v.T.SIZE),this.parameters.vvColorEnabled?e.f32(v.T.COLORFEATUREATTRIBUTE):e.vec4f(v.T.COLOR),this.parameters.vvOpacityEnabled&&e.f32(v.T.OPACITYFEATUREATTRIBUTE),e}},{key:"createBufferWriter",value:function(){return new Z(this._layout,this.parameters)}},{key:"requiresSlot",value:function(e,t){return(t===h.H.Color||t===h.H.Alpha||t===h.H.Highlight||t===h.H.Depth)&&(e===f.r.DRAPED_MATERIAL||(this.parameters.renderOccluded===p.yD.OccludeAndTransparentStencil?e===f.r.OPAQUE_MATERIAL||e===f.r.OCCLUDER_MATERIAL||e===f.r.TRANSPARENT_OCCLUDER_MATERIAL:t===h.H.Color||t===h.H.Alpha?e===(this.parameters.writeDepth?f.r.TRANSPARENT_MATERIAL:f.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===f.r.OPAQUE_MATERIAL))}},{key:"createGLMaterial",value:function(e){return new L(e)}}]),r}(p.F5),L=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,n.Z)(r,[{key:"_updateParameters",value:function(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(A,e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return this._output!==h.H.Color&&this._output!==h.H.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}]),r}(d.F),I=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments)).width=0,e.color=[1,1,1,1],e.placement="end",e.cap=E.R.BUTT,e.anchor=k.i5.Center,e.hasTip=!1,e.worldSpace=!1,e.hideOnShortSegments=!1,e.writeDepth=!0,e.hasSlicePlane=!1,e.vvFastUpdate=!1,e.hasOccludees=!1,e}return(0,n.Z)(r)}(y.n),Z=function(){function e(t,r){(0,i.Z)(this,e),this.vertexBufferLayout=t,this._parameters=r}return(0,n.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(){return"begin-end"===this._parameters.placement?12:6}},{key:"write",value:function(e,t,r,i,n){var a=this,o=r.vertexAttributes.get(v.T.POSITION).data,u=o.length/3,c=[1,0,0],h=r.vertexAttributes.get(v.T.NORMAL);this._parameters.worldSpace&&(0,s.pC)(h)&&(c=h.data);var d=1,p=0;this._parameters.vvSizeEnabled?p=r.vertexAttributes.get(v.T.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(v.T.SIZE)&&(d=r.vertexAttributes.get(v.T.SIZE).data[0]);var f=[1,1,1,1],y=0;this._parameters.vvColorEnabled?y=r.vertexAttributes.get(v.T.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(v.T.COLOR)&&(f=r.vertexAttributes.get(v.T.COLOR).data);var m=0;this._parameters.vvOpacityEnabled&&(m=r.vertexAttributes.get(v.T.OPACITYFEATUREATTRIBUTE).data[0]);var g,_,b=new Float32Array(i.buffer),x=n*(this.vertexBufferLayout.stride/4),S=function(e,t,r,i){if(b[x++]=e[0],b[x++]=e[1],b[x++]=e[2],b[x++]=r[0],b[x++]=r[1],b[x++]=t[0],b[x++]=t[1],b[x++]=t[2],a._parameters.worldSpace&&(b[x++]=c[0],b[x++]=c[1],b[x++]=c[2]),a._parameters.vvSizeEnabled?b[x++]=p:b[x++]=d,a._parameters.vvColorEnabled)b[x++]=y;else{var n=Math.min(4*i,f.length-4);b[x++]=f[n+0],b[x++]=f[n+1],b[x++]=f[n+2],b[x++]=f[n+3]}a._parameters.vvOpacityEnabled&&(b[x++]=m)};(_=g||(g={}))[_.ASCENDING=1]="ASCENDING",_[_.DESCENDING=-1]="DESCENDING";var C=function(t,r){var i=(0,l.s)(D,o[3*t],o[3*t+1],o[3*t+2]),n=M,a=t+r;do{(0,l.s)(n,o[3*a],o[3*a+1],o[3*a+2]),a+=r}while((0,l.F)(i,n)&&a>=0&&a<u);e&&((0,l.m)(i,i,e),(0,l.m)(n,n,e)),S(i,n,[-1,-1],t),S(i,n,[1,-1],t),S(i,n,[1,1],t),S(i,n,[-1,-1],t),S(i,n,[1,1],t),S(i,n,[-1,1],t)},P=this._parameters.placement;"begin"!==P&&"begin-end"!==P||C(0,g.ASCENDING),"end"!==P&&"begin-end"!==P||C(u-1,g.DESCENDING)}}]),e}(),D=(0,u.c)(),M=(0,u.c)()},17729:function(e,t,r){var i;r.d(t,{b:function(){return i}}),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"}(i||(i={}))}}]);
//# sourceMappingURL=36271.39e2b4c9.chunk.js.map