"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[86487],{30494:function(e,t,i){i.d(t,{T:function(){return o}});var a=i(74165),n=i(15861),r=i(76200),s=i(10064),l=i(92026);function o(e,t,i,a,n,r){return u.apply(this,arguments)}function u(){return u=(0,n.Z)((0,a.Z)().mark((function e(t,i,n,o,u,c){var p,d,h,v,f;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=null,!(0,l.pC)(n)){e.next=17;break}return d="".concat(t,"/nodepages/"),h=d+Math.floor(n.rootIndex/n.nodesPerPage),e.prev=3,e.next=6,(0,r.default)(h,{query:{f:"json",token:o},responseType:"json",signal:c});case 6:return e.t0=e.sent.data,e.t1=n.rootIndex,e.t2=n.nodesPerPage,e.t3=n.lodSelectionMetricType,e.t4=d,e.abrupt("return",{type:"page",rootPage:e.t0,rootIndex:e.t1,pageSize:e.t2,lodMetric:e.t3,urlPrefix:e.t4});case 14:e.prev=14,e.t5=e.catch(3),(0,l.pC)(u)&&u.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",h,e.t5),p=e.t5;case 17:if(i){e.next=19;break}return e.abrupt("return",null);case 19:return v="".concat(t,"/nodes/"),f=v+(i&&i.split("/").pop()),e.prev=20,e.next=23,(0,r.default)(f,{query:{f:"json",token:o},responseType:"json",signal:c});case 23:return e.t6=e.sent.data,e.t7=v,e.abrupt("return",{type:"node",rootNode:e.t6,urlPrefix:e.t7});case 28:throw e.prev=28,e.t8=e.catch(20),new s.Z("sceneservice:root-node-missing","Root node missing.",{pageError:p,nodeError:e.t8,url:f});case 31:case"end":return e.stop()}}),e,null,[[3,14],[20,28]])}))),u.apply(this,arguments)}},96664:function(e,t,i){i.d(t,{O:function(){return l},s:function(){return o}});var a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",n="data:image/png;base64,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",r=i(1487),s={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function l(e){return e.fromData(a,(function(){return new r.x(a,s)}))}function o(e){return e.fromData(n,(function(){return new r.x(n,s)}))}},94018:function(e,t,i){i.r(t),i.d(t,{default:function(){return le}});var a=i(15671),n=i(43144),r=i(60136),s=i(92572),l=i(27366),o=i(85015),u=i(92026),c=i(49861),p=(i(25243),i(63780),i(69912)),d=i(98074),h=i(77372),v=i(100),f=i(32718),y=i(94172),w=i(82218),g=i(30651),_=i(59147),D=i(38978),P=i(33906),m=i(41644);var C="esri.views.3d.analysis.Slice.SliceController",b=f.Z.getLogger(C),k=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e))._handles=new v.Z,n._internalChange=!1,n._currentSlicePlane=null,n}return(0,n.Z)(i,[{key:"initialize",value:function(){var e=this;this._handles.add(this.analysis.excludedLayers.on("before-add",(function(t){var i=t.item;null!=i&&(i instanceof g.Z||i instanceof _.Z)?i instanceof g.Z&&function(e){switch(e.type){case"building-scene":case"csv":case"dimension":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-notes":case"ogc-feature":case"oriented-imagery":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return(0,m.Bg)(e.type),!1}}(i)?(b.error("excludedLayers","Layer '".concat(i.title,", id:").concat(i.id,"' of type '").concat(i.type,"' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.")),t.preventDefault()):e.analysis.excludedLayers.includes(i)&&t.preventDefault():(b.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),t.preventDefault())}))),function(e,t){var i;M.has(e)||M.set(e,{all:[],activeController:null}),null===(i=M.get(e))||void 0===i||i.all.push(t)}(this.view,this),this._handles.add([(0,y.YP)((function(){return e.analysisViewData.plane}),(function(){e._internalChange||e._updateSlicePlaneFromBoundedPlane(),e._updateLayerViews()}),{sync:!0}),(0,y.YP)((function(){return e.analysis.excludeGroundSurface}),(function(){return e._updateLayerViews()}),{sync:!0}),this.analysis.excludedLayers.on("change",(function(){return e._updateLayerViews()})),(0,y.YP)((function(){return[e.analysisViewData.active,e.analysisViewData.visible]}),(function(){e._updateActiveController(),e._updateViewSlicePlane()}),{sync:!0}),(0,y.YP)((function(){return e._allLayerAndSubLayerViews}),(function(){return e._updateLayerViews()}))]),this._handles.add([(0,y.YP)((function(){return e.analysis.shape}),(function(){e._internalChange||(e._updateBoundedPlaneFromSlicePlane(),e._updateViewSlicePlane())}),{sync:!0})],"analysis"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}},{key:"destroy",value:function(){this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null),function(e,t){var i;if(!M.has(e))throw new Error("view expected in global slice register");var a=M.get(e),n=null!==(i=null===a||void 0===a?void 0:a.all.lastIndexOf(t))&&void 0!==i?i:-1;if(!a||-1===n)throw new Error("controller expected in global slice register");a.all.splice(n,1),0===a.all.length&&M.delete(e)}(this.view,this),this._handles.destroy(),this.set("view",null)}},{key:"_allLayerAndSubLayerViews",get:function(){var e=this.view.allLayerViews.items;return e.concat(e.filter(D.lR).flatMap((function(e){return e.sublayerViews.items})))}},{key:"_updateBoundedPlaneFromSlicePlane",value:function(){var e=this.analysis.shape,t=this._currentSlicePlane;if(!((0,u.Wi)(t)&&(0,u.Wi)(e)||(0,u.pC)(t)&&(0,u.pC)(e)&&e.equals(t))){var i=null,a=null;if((0,u.pC)(e)&&(0,u.pC)(e.position)){var n=e.position.spatialReference,r=(0,D.m3)(e,this.view);(0,u.Wi)(r)&&(0,P.e)(this.analysis,n,b),i=(0,D.oP)(r,this.view,{tiltEnabled:this.analysis.tiltEnabled},(0,w.a)()),(0,u.pC)(i)&&(a={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._currentSlicePlane=a,this._internalChange=!0,this.analysisViewData.plane=i,this._internalChange=!1}}},{key:"_updateSlicePlaneFromBoundedPlane",value:function(){var e=this.analysisViewData.plane,t=(0,D.Hq)(e,this.view,this.view.spatialReference,new h.Z),i=null;(0,u.pC)(t)&&(i={heading:t.heading,tilt:t.tilt,position:t.position,width:t.width,height:t.height}),this._currentSlicePlane=i,this._internalChange=!0,this.analysis.shape=t,this._internalChange=!1,this._updateViewSlicePlane()}},{key:"_updateActiveController",value:function(){if(!V){var e=A(this.view);if(e)if(this.analysisViewData.active)(0,u.pC)(e.activeController)&&e.activeController!==this?(V=!0,e.activeController.analysisViewData.active=!1,V=!1):(0,u.pC)(e.activeController)&&e.activeController,this._updateLayerViews(),e.activeController=this;else{if((0,u.pC)(e.activeController)&&e.activeController!==this)return;(0,u.pC)(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}}},{key:"_updateViewSlicePlane",value:function(){!function(e){var t,i=null===(t=A(e))||void 0===t?void 0:t.activeController;(0,u.pC)(i)&&(0,u.pC)(i.analysisViewData.plane)&&i.analysisViewData.visible?e.slicePlane=i.analysisViewData.plane:e.slicePlane=null}(this.view)}},{key:"_updateLayerViews",value:function(){var e=(0,u.pC)(this.analysisViewData.plane)&&this.analysisViewData.visible&&this.analysisViewData.active,t=[];this.analysis.excludedLayers.forEach((function e(i){"layers"in i?i.layers.forEach(e):t.push(i)})),this.view.allLayerViews.forEach((function(i){i.destroyed||("slicePlaneEnabled"in i&&(i.slicePlaneEnabled=e&&!t.includes(i.layer)),"sublayerViews"in i&&i.sublayerViews.forEach((function(i){i.slicePlaneEnabled=e&&!t.includes(i.sublayer)})))})),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface)}}]),i}(o.Z);(0,l._)([(0,c.Cb)()],k.prototype,"view",void 0),(0,l._)([(0,c.Cb)()],k.prototype,"analysis",void 0),(0,l._)([(0,c.Cb)()],k.prototype,"analysisViewData",void 0),(0,l._)([(0,c.Cb)()],k.prototype,"_allLayerAndSubLayerViews",null),k=(0,l._)([(0,p.j)(C)],k);var M=new Map,V=!1;function A(e){return M.get(e)}var E,T=i(1413),S=i(84702),x=i(99346),H=i(17842),I=i(14226),R=i(11186),z=i(71353),L=i(55652),G=i(40885),Z=i(51378),W=i(3319),Q=i(96664),O=i(83639),U=i(51328),B=i(81703),F=i(88153),q=i(54463),Y=i(86509),N=i(74229),j=i(72612),K=E=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e))._clock=S.m,n._previewPlaneOpacity=1,n.removeIncompleteOnCancel=!1,n.layersMode="none",n.shiftManipulator=null,n.rotateHeadingManipulator=null,n.rotateTiltManipulator=null,n.resizeManipulators=null,n._handles=new v.Z,n._viewHandles=new v.Z,n._frameTask=null,n._pointerMoveTimerMs=W.N3,n._prevPointerMoveTimeout=null,n._previewPlaneGridVisualElement=null,n._previewPlaneOutlineVisualElement=null,n._startPlane=(0,w.a)(),n._previewPlane=null,n._activeKeyModifiers={},n._lastCursorPosition=(0,H.vW)(),n._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],n._intersector=(0,F.Z8)(e.view.state.viewingMode),n._intersector.options.store=q.eC.MIN,n}return(0,n.Z)(i,[{key:"initialize",value:function(){var e=this;if(null==this.analysis)throw new Error("SliceTool requires valid analysis, but null was provided.");this._rotateHeadingImage=(0,Q.O)(this.view.toolViewManager.textures),this._rotateTiltImage=(0,Q.s)(this.view.toolViewManager.textures);var t=function(t){e._updateManipulatorsInteractive(t),t.grabbing||((0,u.pC)(e.analysisViewData.plane)&&(0,w.c)(e.analysisViewData.plane,e._startPlane),e.inputState=null)};this.shiftManipulator=(0,D.Pt)(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",(function(i){e._onShiftGrab(i),t(e.shiftManipulator)})),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=(0,D.Ju)(this.view,this._rotateHeadingImage.texture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",(function(i){e._onRotateHeadingGrab(i),t(e.rotateHeadingManipulator)})),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=(0,D.Ju)(this.view,this._rotateTiltImage.texture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",(function(i){e._onRotateTiltGrab(i),t(e.rotateTiltManipulator)})),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map((function(i,a){var n=(0,D.vw)(e.view,i);return n.events.on("grab-changed",(function(i){e._onResizeGrab(i,a),t(n)})),e._handles.add(e._createResizeDragPipeline(n)),n})),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=(0,D.R_)(this.view),this._previewPlaneOutlineVisualElement=(0,D.i3)(this.view),this._previewPlaneOutlineVisualElement.width=W.q7,this._handles.add((0,y.YP)((function(){return e.analysisViewData.plane}),(function(){return e._updateManipulators()}),y.Z_));var i=(0,y.YP)((function(){return e.state}),(function(t){"sliced"===t&&e.finishToolCreation()}),y.tX);this._handles.add([i,(0,y.YP)((function(){return e.view.state.camera}),(function(){return e._onCameraChange()}))])}},{key:"destroy",value:function(){this._rotateHeadingImage=(0,u.RY)(this._rotateHeadingImage),this._rotateTiltImage=(0,u.RY)(this._rotateTiltImage),this._handles=(0,u.SC)(this._handles),this._viewHandles=(0,u.SC)(this._viewHandles),this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=(0,u.SC)(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=(0,u.SC)(this._previewPlaneGridVisualElement)}},{key:"state",get:function(){var e=!!this.analysisViewData.plane,t=!!this.inputState;return e?e&&t?"slicing":e&&!t?"sliced":"ready":"ready"}},{key:"cursor",get:function(){return this._isPlacingSlicePlane||"exclude"===this.layersMode?"crosshair":(0,u.pC)(this._creatingPointerId)?"grabbing":null}},{key:"analysis",set:function(e){if(null==e)throw new Error("SliceTool requires valid analysis, but null was provided.");this._handles.remove("analysis"),this._set("analysis",e)}},{key:"inputState",get:function(){return this._get("inputState")},set:function(e){this._set("inputState",e),this.analysisViewData.showGrid=(0,u.pC)(e)&&"resize"===e.type,this._updateMaterials()}},{key:"_isPlacingSlicePlane",get:function(){return!this.inputState&&!this.analysisViewData.plane&&this.active}},{key:"_creatingPointerId",get:function(){return(0,u.pC)(this.inputState)&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}},{key:"enterExcludeLayerMode",value:function(){(0,u.Wi)(this.analysisViewData.plane)||(this._set("layersMode","exclude"),this.active||(this.view.activeTool=this))}},{key:"exitExcludeLayerMode",value:function(){(0,u.Wi)(this.analysisViewData.plane)||(this._set("layersMode","none"),this.active&&(this.view.activeTool=null))}},{key:"onDeactivate",value:function(){this._set("layersMode","none"),this._updatePreviewPlane(null)}},{key:"onShow",value:function(){this._updateVisibility(!0)}},{key:"onHide",value:function(){this._updateVisibility(!1)}},{key:"_updateVisibility",value:function(e){this._updateManipulators(),e||this._clearPointerMoveTimeout()}},{key:"onInputEvent",value:function(e){switch(e.type){case"pointer-drag":if(!J(e))return;this._isPlacingSlicePlane?this._onClickPlacePlane(e)&&e.stopPropagation():this._onPointerDrag(e)&&e.stopPropagation();break;case"pointer-move":this._onPointerMove(e);break;case"pointer-up":this._onPointerUp(e)&&e.stopPropagation();break;case"immediate-click":if(!J(e))return;this._onClickPlacePlane(e)&&e.stopPropagation();break;case"click":if(!J(e))return;this._onClickExcludeLayer(e)&&e.stopPropagation();break;case"drag":this.inputState&&e.stopPropagation();break;case"key-down":this._onKeyDown(e)&&e.stopPropagation();break;case"key-up":this._onKeyUp(e)&&e.stopPropagation()}}},{key:"onEditableChange",value:function(){this.analysisViewData.editable=this.internallyEditable}},{key:"_onPointerDrag",value:function(e){var t=this.inputState;if(e.pointerId===this._creatingPointerId&&(0,u.pC)(t)&&"shift"===t.type){var i=(0,j.vT)(e);return this.shiftManipulator.events.emit("drag",{action:t.hasBeenDragged?"update":"start",pointerType:e.pointerType,start:i,screenPoint:i}),t.hasBeenDragged=!0,!0}return!1}},{key:"_onPointerMove",value:function(e){this._lastCursorPosition.x=e.x,this._lastCursorPosition.y=e.y,this._resetPointerMoveTimeout(),"touch"!==e.pointerType&&this._updatePreviewPlane((0,j.vT)(e),this._activeKeyModifiers)}},{key:"_onCameraChange",value:function(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()}},{key:"_onPointerUp",value:function(e){if(e.pointerId===this._creatingPointerId&&(0,u.pC)(this.analysisViewData.plane)){var t=(0,j.vT)(e);return this.shiftManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),(0,w.c)(this.analysisViewData.plane,this._startPlane),this.inputState=null,!0}return!1}},{key:"_onClickPlacePlane",value:function(e){if("exclude"===this.layersMode)return!1;if(this._isPlacingSlicePlane){var t=(0,j.vT)(e),i=(0,w.a)();if(this._pickPlane(t,!1,this._activeKeyModifiers,i)){if((0,w.c)(i,this._startPlane),this.analysis.shape=(0,D.Hq)(i,this.view,this.view.spatialReference,new h.Z),"pointer-drag"===e.type){var a=this._calculatePickRay(t);this.inputState=X(a,e.pointerId,i.origin,i)}return!0}}return!1}},{key:"_onClickExcludeLayer",value:function(e){var t=this;return!("exclude"!==this.layersMode||!this.created)&&(this.view.hitTest((0,j.vT)(e)).then((function(e){if(e.results.length){var i=e.results[0],a="graphic"===(null===i||void 0===i?void 0:i.type)&&i.graphic;if(a){var n=a.sourceLayer||a.layer;n&&t.analysis.excludedLayers.push(n)}}else e.ground.layer?t.analysis.excludedLayers.push(e.ground.layer):t.analysis.excludeGroundSurface=!0})),this._set("layersMode","none"),this.active&&(this.view.activeTool=null),!0)}},{key:"_onKeyDown",value:function(e){return(e.key===W.GI||e.key===W.tW)&&(this._activeKeyModifiers[e.key]=!0,(0,u.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}},{key:"_onKeyUp",value:function(e){return!(e.key!==W.GI&&e.key!==W.tW||!this._activeKeyModifiers[e.key])&&(delete this._activeKeyModifiers[e.key],(0,u.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}},{key:"_onShiftGrab",value:function(e){if("start"===e.action&&!(0,u.Wi)(this.analysisViewData.plane)&&e.screenPoint){var t=this._calculatePickRay(e.screenPoint);(0,w.c)(this.analysisViewData.plane,this._startPlane),this.inputState=X(t,null,this.shiftManipulator.renderLocation,this.analysisViewData.plane)}}},{key:"_createShiftDragPipeline",value:function(e){var t=this;return(0,N.Xd)(e,(function(e,i,a){var n=t.inputState;if(!(0,u.Wi)(n)&&"shift"===n.type){var r=(0,u.pC)(t.analysisViewData.plane)?(0,w.c)(t.analysisViewData.plane,(0,w.a)()):null;i.next((0,U._N)(t.view,n.shiftPlane)).next(t._shiftDragAdjustSensitivity(n)).next(t._shiftDragUpdatePlane(n)),a.next((function(){(0,u.pC)(r)&&t._updateBoundedPlane(r)}))}}))}},{key:"_shiftDragAdjustSensitivity",value:function(e){var t=this;return function(i){if((0,u.Wi)(t.analysisViewData.plane))return null;var a=Math.min((1-Math.abs((0,R.e)((0,w.n)(t.analysisViewData.plane),i.ray.direction)/(0,R.l)(i.ray.direction)))/.001,1),n=-(0,L.jH)(t._startPlane.plane,i.renderEnd),r=-(0,L.jH)(t._startPlane.plane,e.startPoint);return e.depth=e.depth*(1-a)+n*a-r,i}}},{key:"_shiftDragUpdatePlane",value:function(e){var t=this;return function(){if(!(0,u.Wi)(t.analysisViewData.plane)){var i=(0,R.c)(Z.WM.get(),t._startPlane.origin),a=(0,R.c)(Z.WM.get(),(0,w.n)(t._startPlane));(0,R.g)(a,a,-e.depth),(0,R.a)(a,a,i);var n=(0,w.f)(a,t.analysisViewData.plane.basis1,t.analysisViewData.plane.basis2,(0,w.a)());t._updateBoundedPlane(n)}}}},{key:"_onRotateHeadingGrab",value:function(e){if("start"===e.action&&!(0,u.Wi)(this.analysisViewData.plane)&&e.screenPoint){var t=(0,D.Rd)(this.analysisViewData.plane,this.view.renderCoordsHelper,D.aZ.HEADING,(0,L.Ue)()),i=this._calculatePickRay(e.screenPoint),a=(0,z.c)();(0,L.BR)(t,i,a)&&((0,w.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}}},{key:"_createRotateHeadingDragPipeline",value:function(e){var t=this;return(0,N.Xd)(e,(function(e,i,a){var n=t.inputState;if(!(0,u.Wi)(n)&&"rotate"===n.type){var r=(0,u.pC)(t.analysisViewData.plane)?(0,w.c)(t.analysisViewData.plane,(0,w.a)()):null;i.next((0,U._N)(t.view,n.rotatePlane)).next(t._rotateDragRenderPlaneToRotate(n)).next(t._rotateDragUpdatePlaneFromRotate()),a.next((function(){(0,u.pC)(r)&&t._updateBoundedPlane(r)}))}}))}},{key:"_onRotateTiltGrab",value:function(e){if("start"===e.action&&!(0,u.Wi)(this.analysisViewData.plane)&&e.screenPoint){var t=(0,D.Rd)(this.analysisViewData.plane,this.view.renderCoordsHelper,D.aZ.TILT,(0,L.Ue)()),i=this._calculatePickRay(e.screenPoint),a=(0,z.c)();(0,L.BR)(t,i,a)&&((0,w.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}}},{key:"_createRotateTiltDragPipeline",value:function(e){var t=this;return(0,N.Xd)(e,(function(e,i,a){var n=t.inputState;if(!(0,u.Wi)(n)&&"rotate"===n.type){var r=(0,u.pC)(t.analysisViewData.plane)?(0,w.c)(t.analysisViewData.plane,(0,w.a)()):null;i.next((0,U._N)(t.view,n.rotatePlane)).next(t._rotateDragRenderPlaneToRotate(n)).next(t._rotateDragUpdatePlaneFromRotate()),a.next((function(){(0,u.pC)(r)&&t._updateBoundedPlane(r)}))}}))}},{key:"_rotateDragRenderPlaneToRotate",value:function(e){var t=this;return function(i){if((0,u.Wi)(t.analysisViewData.plane))return null;var a=(0,L.mJ)(e.rotatePlane),n=(0,O.Gd)(e.startPoint,i.renderEnd,t.analysisViewData.plane.origin,a);return(0,T.Z)((0,T.Z)({},i),{},{rotateAxis:a,rotateAngle:n})}}},{key:"_rotateDragUpdatePlaneFromRotate",value:function(){var e=this;return function(t){if(!(0,u.Wi)(e.analysisViewData.plane)){var i=(0,I.d)(Z.MP.get(),t.rotateAngle,t.rotateAxis);if(!(0,u.Wi)(i)){var a=(0,R.m)(Z.WM.get(),e._startPlane.basis1,i),n=(0,R.m)(Z.WM.get(),e._startPlane.basis2,i),r=(0,w.f)(e.analysisViewData.plane.origin,a,n,(0,w.a)());e._updateBoundedPlane(r)}}}}},{key:"_onResizeGrab",value:function(e,t){if("start"===e.action&&!(0,u.Wi)(this.analysisViewData.plane)&&e.screenPoint){var i=this._calculatePickRay(e.screenPoint),a=Z.WM.get();(0,L.BR)(this.analysisViewData.plane.plane,i,a)&&((0,w.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:t,startPoint:(0,z.a)(a)})}}},{key:"_createResizeDragPipeline",value:function(e){var t=this;return(0,N.Xd)(e,(function(e,i,a){var n=t.inputState;if(!(0,u.Wi)(n)&&"resize"===n.type&&!(0,u.Wi)(t.analysisViewData.plane)){var r=(0,w.c)(t.analysisViewData.plane,(0,w.a)());i.next((0,U._N)(t.view,t.analysisViewData.plane.plane)).next(t._resizeDragUpdatePlane(n)),a.next((function(){t._updateBoundedPlane(r)}))}}))}},{key:"_resizeDragUpdatePlane",value:function(e){var t=this;return function(i){if(!(0,u.Wi)(t.analysisViewData.plane)){var a=t._resizeHandles[e.activeHandleIdx],n=(0,D.Q3)(a,e.startPoint,i.renderEnd,t.view.state.camera,t._startPlane,(0,w.c)(t.analysisViewData.plane));t._updateBoundedPlane(n)}}}},{key:"_updateBoundedPlane",value:function(e){var t=this.analysisViewData;if(!(0,u.pC)(t))throw new Error("valid internal object expected");t.plane=e}},{key:"_updatePreviewPlane",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this._previewPlane;if(this._previewPlane=null,(0,u.Wi)(e))return this._removeFrameTask(),void this._updateManipulators();if(!this.analysisViewData.plane&&this.active){var n=(0,u.pC)(a)?a:(0,w.a)();if(a=(0,u.pC)(a)?(0,w.c)(a,$):null,this._pickPlane(e,!0,i,n)){var r=W.Vj,s=!1;(0,u.pC)(a)&&(s=(0,R.e)(a.plane,n.plane)<r||(0,R.e)((0,R.n)(Z.WM.get(),a.basis1),(0,R.n)(Z.WM.get(),n.basis1))<r),s&&(this._previewPlaneOpacity=0),this._previewPlane=n}}(0,u.pC)(this._previewPlane)&&(0,u.Wi)(this._frameTask)&&0===this._previewPlaneOpacity?this._frameTask=(0,x.A)({update:function(e){var i=e.deltaTime;t._previewPlaneOpacity=Math.min(t._previewPlaneOpacity+i/(1e3*W.Fj),1),t._updateManipulators(),1===t._previewPlaneOpacity&&t._removeFrameTask()}}):(0,u.Wi)(this._previewPlane)&&(0,u.pC)(this._frameTask)?this._removeFrameTask():(0,u.pC)(this._previewPlane)&&this._updateManipulators()}},{key:"_removeFrameTask",value:function(){this._frameTask=(0,u.hw)(this._frameTask)}},{key:"_calculatePickRay",value:function(e){var t=(0,G.Ue)(),i=(0,H.md)(e,ee);return(0,B.u4)(this.view.state.camera,i,t),(0,R.n)(t.direction,t.direction),t}},{key:"_pickMinResult",value:function(e){var t=(0,H.md)(e,Z.qW.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector),this._intersector.results.min}},{key:"_pickPlane",value:function(e,t,i,a){var n=this._pickMinResult(e),r=Z.WM.get();if(!n.getIntersectionPoint(r))return!1;var s=n.getTransformedNormal(Z.WM.get()),l=this.view.state.camera;(0,R.e)(s,l.viewForward)>0&&(0,R.g)(s,s,-1);var o=(0,D.fT)(r,l),u=(t?1:-1)*o*W.go,c=(0,R.g)(Z.WM.get(),s,u);(0,R.a)(c,c,r);var p=this.analysis.tiltEnabled?D.ww.TILTED:D.ww.HORIZONTAL_OR_VERTICAL,d=i[W.GI]?D.ww.VERTICAL:i[W.tW]?D.ww.HORIZONTAL:p;return(0,D.j6)(c,s,o,o,l,d,this.view.renderCoordsHelper,a),!0}},{key:"_clearPointerMoveTimeout",value:function(){this._prevPointerMoveTimeout=(0,u.hw)(this._prevPointerMoveTimeout)}},{key:"_resetPointerMoveTimeout",value:function(){var e=this;this._clearPointerMoveTimeout(),this.shiftManipulator.state|=D.do,this.rotateHeadingManipulator.state|=D.do,this.rotateTiltManipulator.state|=D.do,this._prevPointerMoveTimeout=this._clock.setTimeout((function(){e.shiftManipulator.state&=~D.do,e.rotateHeadingManipulator.state&=~D.do,e.rotateTiltManipulator.state&=~D.do}),this._pointerMoveTimerMs)}},{key:"_updateManipulators",value:function(){var e=this;if(!E.disableEngineLayers){var t,i=!1;if((0,u.pC)(this.analysisViewData.plane))t=this.analysisViewData.plane,i=!1;else{if(!(0,u.pC)(this._previewPlane))return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((function(e){return e.available=!1})),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);t=this._previewPlane,i=!0}var a=(0,D.zY)(t,Z.MP.get());i?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((function(e){return e.available=!1})),this._previewPlaneOutlineVisualElement.attached=!0,this._previewPlaneGridVisualElement.attached=!0,this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.analysis.tiltEnabled,this.resizeManipulators.forEach((function(e){return e.available=!0})),(0,D.tF)(this.shiftManipulator,a,t,this.view.state.camera),(0,D.A5)(this.rotateHeadingManipulator,a,t,this.view.renderCoordsHelper),(0,D.wj)(this.rotateTiltManipulator,a,t),this.resizeManipulators.forEach((function(i,n){return(0,D.EC)(i,e._resizeHandles[n],a,t)})),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);var n=(0,R.s)(Z.WM.get(),(0,R.l)(t.basis1),(0,R.l)(t.basis2),1),r=(0,I.E)(Z.MP.get(),n),s=(0,I.m)(r,a,r);this._previewPlaneOutlineVisualElement.transform=s,this._previewPlaneGridVisualElement.transform=s,this._updateMaterials()}}},{key:"_updateMaterials",value:function(){var e=[W.hf[0],W.hf[1],W.hf[2],W.hf[3]*this._previewPlaneOpacity];this._previewPlaneOutlineVisualElement.color=e;var t=[W.wk[0],W.wk[1],W.wk[2],W.wk[3]*this._previewPlaneOpacity];this._previewPlaneGridVisualElement.backgroundColor=t,this._previewPlaneGridVisualElement.gridColor=[0,0,0,0]}},{key:"_updateManipulatorsInteractive",value:function(e){if(!e.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach((function(e){e.interactive=!0}));this.shiftManipulator.interactive=this.shiftManipulator===e,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===e,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===e,this.resizeManipulators.forEach((function(t){t.interactive=t===e}))}},{key:"testData",value:function(){var e=this;return{plane:this.analysisViewData.plane,setPointerMoveTimerMs:function(t){e._pointerMoveTimerMs=t}}}}]),i}(Y.f);function X(e,t,i,a){var n=(0,D.TA)(i,(0,w.n)(a),e.direction,(0,L.Ue)()),r=(0,z.c)();return(0,L.BR)(n,e,r)?{type:"shift",creatingPointerId:t,hasBeenDragged:!1,shiftPlane:n,depth:0,startPoint:r}:null}function J(e){return"mouse"!==e.pointerType||0===e.button}K.disableEngineLayers=!1,(0,l._)([(0,c.Cb)()],K.prototype,"_clock",void 0),(0,l._)([(0,c.Cb)({constructOnly:!0})],K.prototype,"view",void 0),(0,l._)([(0,c.Cb)()],K.prototype,"analysisViewData",void 0),(0,l._)([(0,c.Cb)({readOnly:!0})],K.prototype,"state",null),(0,l._)([(0,c.Cb)({readOnly:!0})],K.prototype,"cursor",null),(0,l._)([(0,c.Cb)()],K.prototype,"analysis",null),(0,l._)([(0,c.Cb)()],K.prototype,"removeIncompleteOnCancel",void 0),(0,l._)([(0,c.Cb)({readOnly:!0})],K.prototype,"layersMode",void 0),(0,l._)([(0,c.Cb)({value:null})],K.prototype,"inputState",null),(0,l._)([(0,c.Cb)()],K.prototype,"_isPlacingSlicePlane",null),(0,l._)([(0,c.Cb)()],K.prototype,"_creatingPointerId",null),K=E=(0,l._)([(0,p.j)("esri.views.3d.analysis.Slice.SliceTool")],K);var $=(0,w.a)(),ee=(0,H.s1)(),te=K,ie=i(67077),ae=i(86700),ne=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e))._handles=new v.Z,n._gridVisualElement=null,n._outlineVisualElement=null,n.showGrid=!1,n.preview=!0,n}return(0,n.Z)(i,[{key:"initialize",value:function(){var e=this,t=this.analysisViewData;if((0,u.Wi)(t))throw new Error("expected internal object to be valid");this._gridVisualElement=(0,D.R_)(this.view),this._outlineVisualElement=(0,D.i3)(this.view),this._handles.add([(0,y.YP)((function(){return{visible:(0,u.pC)(t.plane)&&e.analysisViewData.visible,active:e.analysisViewData.active,preview:e.preview,showGrid:e.showGrid}}),(function(t){return e._updateMaterials(t)}),y.tX),(0,y.YP)((function(){return t.plane}),(function(t){return e._updatePlane(t)}),y.tX)],"internal")}},{key:"destroy",value:function(){this._handles.destroy(),this._gridVisualElement=(0,u.SC)(this._gridVisualElement),this._outlineVisualElement=(0,u.SC)(this._outlineVisualElement),this.set("view",null)}},{key:"_updatePlane",value:function(e){if(!(0,u.Wi)(e)){this._gridVisualElement.attached=!0,this._outlineVisualElement.attached=!0;var t=(0,R.s)(Z.WM.get(),(0,R.l)(e.basis1),(0,R.l)(e.basis2),1),i=(0,I.E)(Z.MP.get(),t),a=(0,D.zY)(e,Z.MP.get()),n=(0,I.m)(i,a,i);this._outlineVisualElement.transform=n,this._gridVisualElement.transform=n}}},{key:"_updateMaterials",value:function(e){var t=e.visible,i=e.active,a=e.preview,n=e.showGrid;this._outlineVisualElement.color=W.hf,this._outlineVisualElement.width=a?W.q7:W.kq,this._outlineVisualElement.stipplePattern=i?null:(0,ae.z5)(5),this._gridVisualElement.backgroundColor=W.wk,this._gridVisualElement.gridColor=n?W.A:ie.Z,this._gridVisualElement.visible=t,this._outlineVisualElement.visible=t}}]),i}(o.Z);(0,l._)([(0,c.Cb)()],ne.prototype,"view",void 0),(0,l._)([(0,c.Cb)()],ne.prototype,"analysis",void 0),(0,l._)([(0,c.Cb)()],ne.prototype,"analysisViewData",void 0),(0,l._)([(0,c.Cb)()],ne.prototype,"showGrid",void 0),(0,l._)([(0,c.Cb)()],ne.prototype,"preview",void 0),ne=(0,l._)([(0,p.j)("esri.views.3d.analysis.Slice.SliceVisualization")],ne);var re=i(70209),se=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).type="slice-view-3d",n.analysis=null,n.tool=null,n.analysisVisualization=null,n.analysisController=null,n.plane=null,n.active=!0,n}return(0,n.Z)(i,[{key:"initialize",value:function(){this.analysisVisualization=new ne({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new k({view:this.view,analysis:this.analysis,analysisViewData:this}),this.addHandles((0,re.Lp)(this,te))}},{key:"destroy",value:function(){(0,re.Yq)(this),this.analysisVisualization=(0,u.SC)(this.analysisVisualization),this.analysisController=(0,u.SC)(this.analysisController)}},{key:"showGrid",get:function(){var e,t;return null!==(e=null===(t=this.analysisVisualization)||void 0===t?void 0:t.showGrid)&&void 0!==e&&e},set:function(e){this.analysisVisualization&&(this.analysisVisualization.showGrid=e)}},{key:"editable",get:function(){return!this.analysisVisualization.preview},set:function(e){this.analysisVisualization.preview=!e}},{key:"testData",get:function(){return{visualization:this.analysisVisualization,controller:this.analysisController,tool:(0,u.Wg)(this.tool)}}}]),i}((0,d.p)(o.Z));(0,l._)([(0,c.Cb)({readOnly:!0})],se.prototype,"type",void 0),(0,l._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],se.prototype,"analysis",void 0),(0,l._)([(0,c.Cb)()],se.prototype,"tool",void 0),(0,l._)([(0,c.Cb)()],se.prototype,"plane",void 0),(0,l._)([(0,c.Cb)()],se.prototype,"active",void 0),(0,l._)([(0,c.Cb)()],se.prototype,"showGrid",null),(0,l._)([(0,c.Cb)()],se.prototype,"editable",null);var le=se=(0,l._)([(0,p.j)("esri.views.3d.analysis.SliceAnalysisView3D")],se)},51328:function(e,t,i){i.d(t,{G:function(){return k},J4:function(){return T},Sp:function(){return A},VG:function(){return M},_N:function(){return P},_y:function(){return V},bB:function(){return m},gv:function(){return S},zP:function(){return E}});var a,n,r=i(1413),s=i(92026),l=i(17842),o=i(11186),u=i(71353),c=i(79803),p=i(55652),d=i(40885),h=i(40927),v=i(51378),f=i(74509),y=i(81703),w=i(88153),g=i(54463),_=i(76783),D=i(74229);function P(e,t){return C(e,(function(){return t}))}function m(e){return C(e,(function(e){return e.plane}))}function C(e,t){var i=(0,u.c)(),a=(0,u.c)(),n=!1;return function(o){var u=t(o);if("start"===o.action){var c=(0,l.md)(o.screenStart,(0,l.c$)(v.qW.get())),d=(0,y.u4)(e.state.camera,c,I);(0,s.pC)(d)&&(n=(0,p.BR)(u,d,i))}if(!n)return null;var h=(0,l.md)(o.screenEnd,(0,l.c$)(v.qW.get())),f=(0,y.u4)(e.state.camera,h,I);return(0,s.Wi)(f)?null:(0,p.BR)(u,f,a)?(0,r.Z)((0,r.Z)({},o),{},{renderStart:i,renderEnd:a,plane:u,ray:f}):null}}function b(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=null;return function(u){if("start"===u.action&&(o=e.sceneIntersectionHelper.intersectElevationFromScreen((0,l.s1)(u.screenStart.x,u.screenStart.y),t,i,n),(0,s.pC)(o)&&(0,s.pC)(a)&&!(0,c.nF)(o,o,a)))return null;if((0,s.Wi)(o))return null;var p=e.sceneIntersectionHelper.intersectElevationFromScreen((0,l.s1)(u.screenEnd.x,u.screenEnd.y),t,i,n);return(0,s.pC)(p)?(0,s.pC)(a)&&!(0,c.nF)(p,p,a)?null:(0,r.Z)((0,r.Z)({},u),{},{mapStart:o,mapEnd:p}):null}}function k(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return b(e,i,(0,f.Ou)(t,e,i),a,n)}function M(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return k(e,i,(0,f.RL)(t),a,n)}function V(e,t,i,a){var n=t.toMap(e.screenStart,{include:[i]});return(0,s.pC)(n)?M(t,i,n,a):null}function A(e,t,i){var a=null,n=new D.hM;return n.next(P(e,function(e,t){var i=x,a=H,n=(0,p.Ue)();e.renderCoordsHelper.worldUpAtPosition(t,i);var r=(0,o.f)(n,i,(0,o.b)(a,t,e.state.camera.eye));return(0,o.f)(r,r,i),(0,p.Yq)(t,r,n)}(e,t))).next(function(e,t){var i=(0,u.c)(),a=(0,o.l)(t);e.renderCoordsHelper.worldUpAtPosition(t,i);var n=(0,u.c)(),r=(0,u.c)(),s=function(n){return(0,o.b)(n,n,t),(0,h.nF)(i,n,n),"global"===e.viewingMode&&(0,o.l)(n)*Math.sign((0,o.e)(i,n))<.001-a&&(0,o.b)(n,(0,o.g)(n,i,.001),t),(0,o.a)(n,n,t),n};return function(e){return e.renderStart=s((0,o.c)(n,e.renderStart)),e.renderEnd=s((0,o.c)(r,e.renderEnd)),e}}(e,t)).next(E(e,i)).next((function(e){e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,a=e})),function(e){return a=null,n.execute(e),a}}function E(e,t){var i=e.renderCoordsHelper;return function(e){var a=i.fromRenderCoords(e.renderStart,t),n=i.fromRenderCoords(e.renderEnd,t);return(0,s.pC)(a)&&(0,s.pC)(n)?(0,r.Z)((0,r.Z)({},e),{},{mapStart:a,mapEnd:n}):null}}function T(e){var t=null;return function(i){switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":(0,s.pC)(t)&&(t.remove(),t=null)}return i}}function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=(0,w.Z8)(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=g.eC.MIN,i.options.hud=!1;var n,o=(0,l.s1)(),c={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},p=(0,u.c)(),d=(0,s.Pt)(t,e.spatialReference),h=function(t){e.map.ground&&e.map.ground.opacity<1?c.exclude.add(_.cy):c.exclude.delete(_.cy),e.sceneIntersectionHelper.intersectIntersectorScreen((0,l.md)(t,o),i,c);var n,r=i.results.min;if(r.getIntersectionPoint(p))n=r.intersector===g.q7.TERRAIN?a.GROUND:a.OTHER;else{if(!i.results.ground.getIntersectionPoint(p))return null;n=a.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(p,d),surfaceType:n}};return function(e){if("start"===e.action){var t=h(e.screenStart);n=(0,s.pC)(t)?t.location:null}if((0,s.Wi)(n))return null;var i=h(e.screenEnd);return(0,s.pC)(i)&&(0,s.pC)(i.location)?(0,r.Z)((0,r.Z)({},e),{},{mapStart:n,mapEnd:i.location,surfaceType:i.surfaceType}):null}}(n=a||(a={}))[n.GROUND=0]="GROUND",n[n.OTHER=1]="OTHER";var x=(0,u.c)(),H=(0,u.c)(),I=(0,d.Ue)()},70209:function(e,t,i){i.d(t,{Er:function(){return u},Lp:function(){return c},Yq:function(){return p}});var a=i(74165),n=i(15861),r=i(14921),s=i(92026),l=i(66978),o=i(94172);function u(e,t){e.interactive=!0;var i=e.tool,u=e.view;u.activeTool=i;var c=(0,l.fu)(t,(function(){u.activeTool===i&&(u.activeTool=null)}));return(0,r.vr)(function(){var e=(0,n.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.N1)((function(){return(0,s.Wi)(i)||!i.active}),t);case 2:c=(0,s.hw)(c);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t)}function c(e,t){return(0,o.YP)((function(){return e.interactive}),(function(){return function(e,t){e.interactive?function(e,t){p(e);var i=e.view,a=e.analysis,n=new t({view:i,analysis:a,analysisViewData:e});e.tool=n,i.tools.add(n)}(e,t):p(e)}(e,t)}),o.tX)}function p(e){var t=e.view,i=e.tool;(0,s.Wi)(i)||(t.tools.remove(i),e.tool=null)}},86509:function(e,t,i){i.d(t,{f:function(){return p}});var a=i(15671),n=i(43144),r=i(60136),s=i(92572),l=i(27366),o=i(94172),u=i(49861),c=(i(25243),i(63780),i(69912)),p=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(e){return(0,a.Z)(this,i),t.call(this,e)}return(0,n.Z)(i,[{key:"initialize",value:function(){var e=this;this.addHandles((0,o.YP)((function(){return e.analysisViewData.visible}),(function(t){return e.visible=t}),o.tX))}},{key:"deactivate",value:function(){this.onDeactivate(),this.created||this.analysis.clear()}},{key:"resetCreated",value:function(){this._set("created",!1)}}]),i}(i(29919).m);(0,l._)([(0,u.Cb)({constructOnly:!0})],p.prototype,"analysis",void 0),(0,l._)([(0,u.Cb)()],p.prototype,"analysisViewData",void 0),p=(0,l._)([(0,c.j)("esri.views.interactive.AnalysisToolBase")],p)},24405:function(e,t,i){i.d(t,{V:function(){return c},e:function(){return o}});var a=i(74165),n=i(93433),r=i(15861),s=i(92026),l=i(80031);function o(e){return u.apply(this,arguments)}function u(){return u=(0,r.Z)((0,a.Z)().mark((function e(t){var i,r,o,u,c,p,d,h,v,f,y,w=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=w.length>1&&void 0!==w[1]?w[1]:t.popupTemplate,!(0,s.Wi)(o)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,o.getRequiredFields(t.fieldsIndex);case 5:if(u=e.sent,c=o.lastEditInfoEnabled,p=t.objectIdField,d=t.typeIdField,h=t.globalIdField,v=t.relationships,!u.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!c){e.next=19;break}return e.next=16,(0,l.CH)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return f=e.t0,y=(0,l.Q0)(t.fieldsIndex,[].concat((0,n.Z)(u),(0,n.Z)(f))),e.abrupt("return",(d&&y.push(d),y&&p&&null!==(i=t.fieldsIndex)&&void 0!==i&&i.has(p)&&!y.includes(p)&&y.push(p),y&&h&&null!==(r=t.fieldsIndex)&&void 0!==r&&r.has(h)&&!y.includes(h)&&y.push(h),v&&v.forEach((function(e){var i,a=e.keyField;y&&a&&(null===(i=t.fieldsIndex)||void 0===i?void 0:i.has(a))&&!y.includes(a)&&y.push(a)})),y));case 23:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}function c(e,t){return e.popupTemplate?e.popupTemplate:(0,s.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,s.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=86487.4ef839e7.chunk.js.map