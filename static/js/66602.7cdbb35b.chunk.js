"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[66602,65905],{65905:function(e,t,i){i.d(t,{V:function(){return c},b:function(){return u}});var n=i(42265),r=i(76200),a=i(10064),s=i(32718),o=i(35995),l=s.Z.getLogger("esri.assets");function u(e,t){return(0,r.default)(c(e),t)}function c(e){if(!n.Z.assetsPath)throw l.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new a.Z("assets:path-not-set","config.assetsPath is not set");return(0,o.v_)(n.Z.assetsPath,e)}},18759:function(e,t,i){i.d(t,{WJ:function(){return v},Xq:function(){return f},an:function(){return h},lN:function(){return n}});var n,r,a=i(29439),s=i(37762),o=i(15671),l=i(43144),u=i(92026),c=i(27546),h=-3;(r=n||(n={}))[r.ALL=0]="ALL",r[r.SOME=1]="SOME";var f=function(){function e(t,i,n){(0,o.Z)(this,e),this._namespace=t,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",n&&(this._storage.registerRemoveFunc(this._namespace,n),this._removeFunc=!0)}return(0,l.Z)(e,[{key:"destroy",value:function(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}},{key:"namespace",get:function(){return this._namespace.slice(0,-1)}},{key:"hitRate",get:function(){return this._hit/(this._hit+this._miss)}},{key:"size",get:function(){return this._storage.size}},{key:"maxSize",get:function(){return this._storage.maxSize}},{key:"resetHitRate",value:function(){this._hit=this._miss=0}},{key:"put",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._storage.put(this._namespace+e,t,i,n)}},{key:"get",value:function(e){var t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}},{key:"pop",value:function(e){var t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}},{key:"updateSize",value:function(e,t,i){this._storage.updateSize(this._namespace+e,t,i)}},{key:"clear",value:function(){this._storage.clear(this._namespace)}},{key:"clearAll",value:function(){this._storage.clearAll()}},{key:"getStats",value:function(){return this._storage.getStats()}},{key:"resetStats",value:function(){this._storage.resetStats()}}]),e}(),v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10485760;(0,o.Z)(this,e),this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new c.Z,this._users=new c.Z}return(0,l.Z)(e,[{key:"destroy",value:function(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}},{key:"register",value:function(e){this._users.push(e)}},{key:"deregister",value:function(e){this._users.removeUnordered(e)}},{key:"registerRemoveFunc",value:function(e,t){this._removeFuncs.push([e,t])}},{key:"deregisterRemoveFunc",value:function(e){this._removeFuncs.filterInPlace((function(t){return t[0]!==e}))}},{key:"size",get:function(){return this._size}},{key:"maxSize",get:function(){return this._maxSize},set:function(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}},{key:"put",value:function(e,t,i,r){var a=this._db.get(e);if(a&&(this._size-=a.size,this._db.delete(e),a.entry!==t&&this._notifyRemove(e,a.entry,n.ALL)),i>this._maxSize)this._notifyRemove(e,t,n.ALL);else if(void 0!==t)if(!i||i<0)console.warn("Refusing to cache entry with invalid size "+i);else{var s=1+Math.max(r,h)-h;this._db.set(e,{entry:t,size:i,lifetime:s,lives:s}),this._size+=i,this._checkSizeLimit()}else console.warn("Refusing to cache undefined entry ")}},{key:"updateSize",value:function(e,t,i){var r=this._db.get(e);if(r&&r.entry===t){for(this._size-=r.size;i>this._maxSize;){var a=this._notifyRemove(e,t,n.SOME);if(!((0,u.pC)(a)&&a>0))return void this._db.delete(e);i=a}r.size=i,this._size+=i,this._checkSizeLimit()}}},{key:"pop",value:function(e){var t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss}},{key:"get",value:function(e){var t=this._db.get(e);if(void 0!==t)return this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry;++this._miss}},{key:"getStats",value:function(){var e=this,t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},n=new Array;this._db.forEach((function(t,r){var a=t.lifetime;n[a]=(n[a]||0)+t.size,e._users.forAll((function(e){var n=e.namespace;if(r.startsWith(n)){var a=i[n]||0;i[n]=a+t.size}}))}));var r={};this._users.forAll((function(e){var t=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){var n=i[t]||0;i[t]=n,r[t]=Math.round(100*e.hitRate)+"%"}else r[t]="0%"}));var a=Object.keys(i);a.sort((function(e,t){return i[t]-i[e]})),a.forEach((function(e){return t[e]=Math.round(i[e]/Math.pow(2,20))+"MB / "+r[e]}));for(var s=n.length-1;s>=0;--s){var o=n[s];o&&(t["Priority "+(s+h-1)]=Math.round(o/this.size*100)+"%")}return t}},{key:"resetStats",value:function(){this._hit=this._miss=0,this._users.forAll((function(e){return e.resetHitRate()}))}},{key:"clear",value:function(e){var t=this;this._db.forEach((function(i,r){r.startsWith(e)&&(t._size-=i.size,t._db.delete(r),t._notifyRemove(r,i.entry,n.ALL))}))}},{key:"clearAll",value:function(){var e=this;this._db.forEach((function(t,i){return e._notifyRemove(i,t.entry,n.ALL)})),this._size=0,this._db.clear()}},{key:"_getHitRate",value:function(){return this._hit/(this._hit+this._miss)}},{key:"_notifyRemove",value:function(e,t,i){var n;return this._removeFuncs.some((function(r){if(e.startsWith(r[0])){var a=r[1](t,i);return"number"==typeof a&&(n=a),!0}return!1})),n}},{key:"_checkSizeLimit",value:function(){if(!(this._size<=this._maxSize)){var e,t=(0,s.Z)(this._db);try{for(t.s();!(e=t.n()).done;){var i=(0,a.Z)(e.value,2),r=i[0],o=i[1];if(this._db.delete(r),o.lives<=1){this._size-=o.size;var l=this._notifyRemove(r,o.entry,n.SOME);(0,u.pC)(l)&&l>0&&(this._size+=l,o.lives=o.lifetime,o.size=l,this._db.set(r,o))}else--o.lives,this._db.set(r,o);if(this._size<=.9*this.maxSize)return}}catch(c){t.e(c)}finally{t.f()}}}}]),e}()},59896:function(e,t,i){function n(e){return 32+e.length}function r(e){return 16}function a(e){if(!e)return 0;var t=c;for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];switch(typeof r){case"string":t+=n(r);break;case"number":t+=16;break;case"boolean":t+=4}}return t}function s(e){if(!e)return 0;if(Array.isArray(e))return function(e){var t=e.length;if(0===t||"number"==typeof e[0])return 32+8*t;for(var i=h,n=0;n<t;n++)i+=o(e[n]);return i}(e);var t=c;for(var i in e)e.hasOwnProperty(i)&&(t+=o(e[i]));return t}function o(e){switch(typeof e){case"object":return s(e);case"string":return n(e);case"number":return 16;case"boolean":return 4;default:return 8}}function l(e,t){return h+e.length*t}i.d(t,{G3:function(){return r},Ul:function(){return s},Y8:function(){return u},do:function(){return l},f2:function(){return a},hH:function(){return n}});var u,c=32,h=32;!function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(u||(u={}))},59068:function(e,t,i){i.d(t,{Z:function(){return p}});var n,r=i(15671),a=i(43144),s=i(60136),o=i(92572),l=i(27366),u=i(46784),c=i(49861),h=i(25243),f=(i(63780),i(69912)),v=n=function(e){(0,s.Z)(i,e);var t=(0,o.Z)(i);function i(e){var n;return(0,r.Z)(this,i),(n=t.call(this,e)).cols=null,n.level=0,n.levelValue=null,n.origin=null,n.resolution=0,n.rows=null,n.scale=0,n}return(0,a.Z)(i,[{key:"clone",value:function(){return new n({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}}]),i}(u.wq);(0,l._)([(0,c.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],v.prototype,"cols",void 0),(0,l._)([(0,c.Cb)({type:h.z8,json:{write:!0}})],v.prototype,"level",void 0),(0,l._)([(0,c.Cb)({type:String,json:{write:!0}})],v.prototype,"levelValue",void 0),(0,l._)([(0,c.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],v.prototype,"origin",void 0),(0,l._)([(0,c.Cb)({type:Number,json:{write:!0}})],v.prototype,"resolution",void 0),(0,l._)([(0,c.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],v.prototype,"rows",void 0),(0,l._)([(0,c.Cb)({type:Number,json:{write:!0}})],v.prototype,"scale",void 0);var p=v=n=(0,l._)([(0,f.j)("esri.layers.support.LOD")],v)},22824:function(e,t,i){i.d(t,{Z:function(){return A}});var n,r=i(1413),a=i(15671),s=i(43144),o=i(60136),l=i(92572),u=i(27366),c=i(43404),h=i(46784),f=i(92026),v=i(68860),p=i(49861),d=i(25243),_=(i(63780),i(38511)),m=i(69912),y=i(31201),g=i(585),b=i(78952),w=i(65156),z=i(92975),k=i(81753),S=i(59068),Z=i(87960),O=new c.X({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"}),x=n=function(e){(0,o.Z)(i,e);var t=(0,l.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).dpi=96,n.format=null,n.origin=null,n.minScale=0,n.maxScale=0,n.size=null,n.spatialReference=null,n}return(0,s.Z)(i,[{key:"isWrappable",get:function(){var e=this.spatialReference,t=this.origin;if(e&&t){var i=(0,z.C5)(e);return e.isWrappable&&!!i&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}},{key:"readOrigin",value:function(e,t){return g.Z.fromJSON((0,r.Z)({spatialReference:t.spatialReference},e))}},{key:"lods",set:function(e){var t=0,i=0,n=[],r=this._levelToLOD={};e&&(t=-1/0,i=1/0,e.forEach((function(e){n.push(e.scale),t=e.scale>t?e.scale:t,i=e.scale<i?e.scale:i,r[e.level]=e}))),this._set("scales",n),this._set("minScale",t),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}},{key:"readSize",value:function(e,t){return[t.cols,t.rows]}},{key:"writeSize",value:function(e,t){t.cols=e[0],t.rows=e[1]}},{key:"zoomToScale",value:function(e){var t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];var i=Math.floor(e),n=i+1;return t[i]/Math.pow(t[i]/t[n],e-i)}},{key:"scaleToZoom",value:function(e){for(var t=this.scales,i=t.length-1,n=0;n<i;n++){var r=t[n],a=t[n+1];if(r<=e)return n;if(a===e)return n+1;if(r>e&&a<e)return n+Math.log(r/e)/Math.log(r/a)}return n}},{key:"snapScale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}},{key:"tileAt",value:function(e,t,i,n){var r,a,s=this.lodAt(e);if(!s)return null;if("number"==typeof t)r=t,a=i;else if((0,z.fS)(t.spatialReference,this.spatialReference))r=t.x,a=t.y,n=i;else{var o=(0,k.iV)(t,this.spatialReference);if((0,f.Wi)(o))return null;r=o.x,a=o.y,n=i}var l=s.resolution*this.size[0],u=s.resolution*this.size[1];return n||(n=new Z.f(null,0,0,0,(0,w.Ue)())),n.level=e,n.row=Math.floor((this.origin.y-a)/u+.001),n.col=Math.floor((r-this.origin.x)/l+.001),this.updateTileInfo(n),n}},{key:"updateTileInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.ExtrapolateOptions.NONE,i=this.lodAt(e.level);if(!i&&t===n.ExtrapolateOptions.POWER_OF_TWO){var r=this.lods[this.lods.length-1];r.level<e.level&&(i=r)}if(i){var a=e.level-i.level,s=i.resolution*this.size[0]/Math.pow(2,a),o=i.resolution*this.size[1]/Math.pow(2,a);e.id="".concat(e.level,"/").concat(e.row,"/").concat(e.col),e.extent||(e.extent=(0,w.Ue)()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*o,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+o}}},{key:"upsampleTile",value:function(e){var t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}},{key:"getTileBounds",value:function(e,t){var i=this.lodAt(t.level);if(null==i)return null;var n=i.resolution,r=n*this.size[0],a=n*this.size[1];return e[0]=this.origin.x+t.col*r,e[1]=this.origin.y-(t.row+1)*a,e[2]=e[0]+r,e[3]=e[1]+a,e}},{key:"lodAt",value:function(e){var t,i;return null!==(t=null===(i=this._levelToLOD)||void 0===i?void 0:i[e])&&void 0!==t?t:null}},{key:"clone",value:function(){return n.fromJSON(this.write({}))}},{key:"getOrCreateCompatible",value:function(e,t){if(256===this.size[0]&&256===this.size[1])return 256===e?this:null;for(var i=[],r=this.lods.length,a=0;a<r;a++){var s=this.lods[a],o=s.resolution*t;i.push(new S.Z({level:s.level,scale:s.scale,resolution:o}))}return new n({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}},{key:"_initializeUpsampleLevels",value:function(){var e=this.lods;this._upsampleLevels=[];for(var t=null,i=0;i<e.length;i++){var n=e[i];this._upsampleLevels[n.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/n.resolution:0},t=n}}}],[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.resolutionFactor,i=void 0===t?1:t,r=e.scales,a=e.size,s=void 0===a?256:a,o=e.spatialReference,l=void 0===o?b.Z.WebMercator:o,u=e.numLODs,c=void 0===u?24:u;if(!(0,z.JY)(l)){var h=[];if(r)for(var f=0;f<r.length;f++){var p=r[f];h.push(new S.Z({level:f,scale:p,resolution:p}))}else for(var d=5e-4,_=c-1;_>=0;_--)h.unshift(new S.Z({level:_,scale:d,resolution:d})),d*=2;return new n({dpi:96,lods:h,origin:new g.Z(0,0,l),size:[s,s],spatialReference:l})}var m=(0,z.C5)(l),y=e.origin?new g.Z({x:e.origin.x,y:e.origin.y,spatialReference:l}):new g.Z(m?{x:m.origin[0],y:m.origin[1],spatialReference:l}:{x:0,y:0,spatialReference:l}),w=96,k=1/(39.37*(0,v.c9)(l)*w),Z=[];if(r)for(var O=0;O<r.length;O++){var x=r[O],A=x*k;Z.push(new S.Z({level:O,scale:x,resolution:A}))}else{var L=(0,z.sT)(l)?512/s*591657527.5917094:256/s*591657527.591555,T=Math.ceil(c/i);Z.push(new S.Z({level:0,scale:L,resolution:L*k}));for(var R=1;R<T;R++){var M=L/Math.pow(2,i),C=M*k;Z.push(new S.Z({level:R,scale:M,resolution:C})),L=M}}return new n({dpi:w,lods:Z,origin:y,size:[s,s],spatialReference:l})}}]),i}(h.wq);(0,u._)([(0,p.Cb)({type:Number,json:{write:!0}})],x.prototype,"compressionQuality",void 0),(0,u._)([(0,p.Cb)({type:Number,json:{write:!0}})],x.prototype,"dpi",void 0),(0,u._)([(0,p.Cb)({type:String,json:{read:O.read,write:O.write,origins:{"web-scene":{read:!1,write:!1}}}})],x.prototype,"format",void 0),(0,u._)([(0,p.Cb)({readOnly:!0})],x.prototype,"isWrappable",null),(0,u._)([(0,p.Cb)({type:g.Z,json:{write:!0}})],x.prototype,"origin",void 0),(0,u._)([(0,_.r)("origin")],x.prototype,"readOrigin",null),(0,u._)([(0,p.Cb)({type:[S.Z],value:null,json:{write:!0}})],x.prototype,"lods",null),(0,u._)([(0,p.Cb)({readOnly:!0})],x.prototype,"minScale",void 0),(0,u._)([(0,p.Cb)({readOnly:!0})],x.prototype,"maxScale",void 0),(0,u._)([(0,p.Cb)({readOnly:!0})],x.prototype,"scales",void 0),(0,u._)([(0,p.Cb)({cast:function(e){return Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]}})],x.prototype,"size",void 0),(0,u._)([(0,_.r)("size",["rows","cols"])],x.prototype,"readSize",null),(0,u._)([(0,y.c)("size",{cols:{type:d.z8},rows:{type:d.z8}})],x.prototype,"writeSize",null),(0,u._)([(0,p.Cb)({type:b.Z,json:{write:!0}})],x.prototype,"spatialReference",void 0),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}((x=n=(0,u._)([(0,m.j)("esri.layers.support.TileInfo")],x))||(x={}));var A=x},87960:function(e,t,i){i.d(t,{f:function(){return a}});var n=i(43144),r=i(15671),a=(0,n.Z)((function e(t,i,n,a,s){(0,r.Z)(this,e),this.id=t,this.level=i,this.row=n,this.col=a,this.extent=s}))},23638:function(e,t,i){i.d(t,{y:function(){return M}});var n,r=i(74165),a=i(15861),s=i(1413),o=i(15671),l=i(43144),u=i(60136),c=i(92572),h=i(27366),f=i(76200),v=i(31319),p=i(59896),d=i(10064),_=i(41691),m=i(32718),y=i(16054),g=i(27546),b=i(66978),w=i(94172),z=i(99346),k=i(35995),S=i(49861),Z=i(89125),O=i(63780),x=i(69912),A=i(87960),L=i(84652),T=function(){function e(){(0,o.Z)(this,e),this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}return(0,l.Z)(e,[{key:"getAvailability",value:function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;var i=(e-this.location.top)*this.location.width+(t-this.location.left),n=i%8,r=i>>3,a=this._tileAvailabilityBitSet;return r<0||r>a.length?"unknown":a[r]&1<<n?"available":"unavailable"}},{key:"_updateFromData",value:function(e){for(var t=this.location.width,i=this.location.height,n=!0,r=!0,a=Math.ceil(t*i/8),s=new Uint8Array(a),o=0,l=0;l<e.length;l++){var u=l%8;e[l]?(r=!1,s[o]|=1<<u):n=!1,7===u&&++o}r?this._allAvailability="unavailable":n?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=s,this.byteSize+=s.length)}}],[{key:"fromDefinition",value:function(t,i){var n=t.service.request||f.default,r=t.row,a=t.col,o=t.width,l=t.height,u={query:{f:"json"}};return i=i?(0,s.Z)((0,s.Z)({},u),i):u,n(function(e){var t;if("vector-tile"===e.service.type)t="".concat(e.service.url,"/tilemap/").concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height);else{var i=e.service.tileServers;t="".concat(i&&i.length?i[e.row%i.length]:e.service.url,"/tilemap/").concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height)}var n=e.service.query;return n&&(t="".concat(t,"?").concat(n)),t}(t),i).then((function(e){return e.data})).catch((function(e){if(e&&e.details&&422===e.details.httpStatus)return{location:{top:r,left:a,width:o,height:l},valid:!0,data:(0,O.a9)(o*l,0)};throw e})).then((function(t){if(t.location&&(t.location.top!==r||t.location.left!==a||t.location.width!==o||t.location.height!==l))throw new d.Z("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:r,left:a,width:o,height:l}});return e.fromJSON(t)}))}},{key:"fromJSON",value:function(t){e._validateJSON(t);var i=new e;return i.location=Object.freeze((0,L.d9)(t.location)),i._updateFromData(t.data),Object.freeze(i)}},{key:"_validateJSON",value:function(e){if(!e||!e.location)throw new d.Z("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new d.Z("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new d.Z("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new d.Z("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new d.Z("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}}]),e}();function R(e){return"".concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height)}var M=n=function(e){(0,u.Z)(i,e);var t=(0,c.Z)(i);function i(e){var n;return(0,o.Z)(this,i),(n=t.call(this,e))._pendingTilemapRequests={},n._availableLevels={},n.levels=5,n.cacheByteSize=2*p.Y8.MEGABYTES,n.request=f.default,n._prefetchingEnabled=!0,n}return(0,l.Z)(i,[{key:"initialize",value:function(){var e=this;this._tilemapCache=new y.Z(this.cacheByteSize),this.addHandles([(0,w.YP)((function(){var t=e.layer;return[null===t||void 0===t?void 0:t.parsedUrl,null===t||void 0===t?void 0:t.tileServers,null===t||void 0===t?void 0:t.apiKey,null===t||void 0===t?void 0:t.customParameters]}),(function(){return e._initializeTilemapDefinition()})),(0,w.YP)((function(){var t,i;return null===(t=e.layer)||void 0===t||null===(i=t.tileInfo)||void 0===i?void 0:i.lods}),(function(t){return e._initializeAvailableLevels(t)}),w.tX)]),this._initializeTilemapDefinition()}},{key:"castLevels",value:function(e){return e<=2?(m.Z.getLogger(this.declaredClass).error("Minimum levels for Tilemap is 3, but got ",e),3):e}},{key:"size",get:function(){return 1<<this.levels}},{key:"fetchTilemap",value:function(e,t,i,n){var r=this;if(!this._availableLevels[e])return Promise.reject(new d.Z("tilemap-cache:level-unavailable","Level ".concat(e," is unavailable in the service")));var a=this._tmpTilemapDefinition,o=this._tilemapFromCache(e,t,i,a);if(o)return Promise.resolve(o);var l=n&&n.signal;return n=(0,s.Z)((0,s.Z)({},n),{},{signal:null}),new Promise((function(e,t){(0,b.fu)(l,(function(){return t((0,b.zE)())}));var i=R(a),s=r._pendingTilemapRequests[i];if(!s){s=T.fromDefinition(a,n).then((function(e){return r._tilemapCache.put(i,e,e.byteSize),e}));var o=function(){return delete r._pendingTilemapRequests[i]};r._pendingTilemapRequests[i]=s,s.then(o,o)}s.then(e,t)}))}},{key:"getAvailability",value:function(e,t,i){if(!this._availableLevels[e])return"unavailable";var n=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return n?n.getAvailability(t,i):"unknown"}},{key:"fetchAvailability",value:function(e,t,i,n){return this._availableLevels[e]?this.fetchTilemap(e,t,i,n).catch((function(e){return e})).then((function(n){if(n instanceof T){var r=n.getAvailability(t,i);if("unavailable"===r)throw new d.Z("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i});return r}if((0,b.D_)(n))throw n;return"unknown"})):Promise.reject(new d.Z("tilemap-cache:level-unavailable","Level ".concat(e," is unavailable in the service")))}},{key:"fetchAvailabilityUpsample",value:function(e,t,i,n,r){var a=this;n.level=e,n.row=t,n.col=i;var s=this.layer.tileInfo;s.updateTileInfo(n);var o=this.fetchAvailability(e,t,i,r).catch((function(e){if((0,b.D_)(e))throw e;if(s.upsampleTile(n))return a.fetchAvailabilityUpsample(n.level,n.row,n.col,n);throw e}));return this._fetchAvailabilityUpsamplePrefetch(n.id,e,t,i,r,o),o}},{key:"_fetchAvailabilityUpsamplePrefetch",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i,a,o,l,u){var c,h,f,v,p,d,_,m,y,g=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._prefetchingEnabled&&null!=t){e.next=2;break}return e.abrupt("return");case 2:if(c="prefetch-".concat(t),!this.handles.has(c)){e.next=5;break}return e.abrupt("return");case 5:return h=new AbortController,u.then((function(){return h.abort()}),(function(){return h.abort()})),f=!1,v={remove:function(){f||(f=!0,h.abort())}},this.handles.add(v,c),e.next=12,(0,z.MU)(10,h.signal).catch((function(){}));case 12:if(f||(f=!0,this.handles.remove(c)),!(0,b.Hc)(h)){e.next=15;break}return e.abrupt("return");case 15:for(p=new A.f(t,i,a,o),d=(0,s.Z)((0,s.Z)({},l),{},{signal:h.signal}),_=this.layer.tileInfo,m=function(e){var t=g.fetchAvailability(p.level,p.row,p.col,d);n._prefetches.push(t);var i=function(){n._prefetches.removeUnordered(t)};t.then(i,i)},y=0;n._prefetches.length<n._maxPrefetch&&_.upsampleTile(p);++y)m();case 18:case"end":return e.stop()}}),e,this)})));return function(t,i,n,r,a,s){return e.apply(this,arguments)}}()},{key:"_initializeTilemapDefinition",value:function(){var e;if(this.layer.parsedUrl){var t=this.layer,i=t.parsedUrl,n=t.apiKey,r=t.customParameters;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:i.path,query:(0,k.B7)((0,s.Z)((0,s.Z)((0,s.Z)({},i.query),r),{},{token:null!==n&&void 0!==n?n:null===(e=i.query)||void 0===e?void 0:e.token})),tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}}},{key:"_tilemapFromCache",value:function(e,t,i,n){n.level=e,n.row=t-t%this.size,n.col=i-i%this.size;var r=R(n);return this._tilemapCache.get(r)}},{key:"_initializeAvailableLevels",value:function(e){var t=this;this._availableLevels={},e&&e.forEach((function(e){return t._availableLevels[e.level]=!0}))}},{key:"test",get:function(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:function(t,i,n){return!!e._tilemapFromCache(t,i,n,e._tmpTilemapDefinition)}}}}]),i}((0,_.p)(v.Z));M._maxPrefetch=4,M._prefetches=new g.Z({initialSize:n._maxPrefetch}),(0,h._)([(0,S.Cb)({constructOnly:!0,type:Number})],M.prototype,"levels",void 0),(0,h._)([(0,Z.p)("levels")],M.prototype,"castLevels",null),(0,h._)([(0,S.Cb)({readOnly:!0,type:Number})],M.prototype,"size",null),(0,h._)([(0,S.Cb)({constructOnly:!0,type:Number})],M.prototype,"cacheByteSize",void 0),(0,h._)([(0,S.Cb)({constructOnly:!0})],M.prototype,"layer",void 0),(0,h._)([(0,S.Cb)({constructOnly:!0})],M.prototype,"request",void 0),M=n=(0,h._)([(0,x.j)("esri.layers.support.TilemapCache")],M)},71466:function(e,t,i){i.d(t,{d:function(){return s},h:function(){return a}});var n=i(1413),r=i(22824),a={type:r.Z,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:s}}}}};function s(e,t,i,a){if(!e)return null;var s=t.minScale,o=t.maxScale,l=t.minLOD,u=t.maxLOD;if(null!=l&&null!=u)return a&&a.ignoreMinMaxLOD?r.Z.fromJSON(e):r.Z.fromJSON((0,n.Z)((0,n.Z)({},e),{},{lods:e.lods.filter((function(e){var t=e.level;return null!=t&&t>=l&&t<=u}))}));if(0!==s&&0!==o){var c=function(e){return Math.round(1e4*e)/1e4},h=s?c(s):1/0,f=o?c(o):-1/0;return r.Z.fromJSON((0,n.Z)((0,n.Z)({},e),{},{lods:e.lods.filter((function(e){var t=c(e.scale);return t<=h&&t>=f}))}))}return r.Z.fromJSON(e)}}}]);
//# sourceMappingURL=66602.7cdbb35b.chunk.js.map