"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[76183],{66848:function(t,e,n){n.d(e,{f:function(){return h},u:function(){return f}});var r=n(74165),i=n(15861),a=n(48103),s=n(16529),o=n(29690),c=n(63326),u=n(35137);function l(){var t=(0,a.g)();return t.push({objectKey:"status",modelKey:"data.status"}),t.push({objectKey:"catalog",modelKey:"data.catalog"}),t.push({objectKey:"permissions",modelKey:"data.permissions"}),t.push({objectKey:"capabilities",modelKey:"data.settings.capabilities"}),t.push({objectKey:"contacts",modelKey:"data.contacts"}),t.push({objectKey:"timeline",modelKey:"data.timeline"}),t}function p(t,e,n){var r,i;n.authentication&&(i=n.authentication.token);return e.thumbnailUrl=(0,o.a)(t.item,n,i),e.createdDate=new Date(t.item.created),e.createdDateSource="item.created",e.updatedDate=new Date(t.item.modified),e.updatedDateSource="item.modified",e.capabilities=(0,a.p)((null===(r=t.data.settings)||void 0===r?void 0:r.capabilities)||{},s.c),e}function f(t,e){return d.apply(this,arguments)}function d(){return(d=(0,i.Z)((0,r.Z)().mark((function t(e,n){var i,s,o,c,u;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.b)({slug:e.slug,existingId:e.id},n);case 2:return e.slug=t.sent,t.next=5,(0,a.c)(e.id,n);case 5:return i=t.sent,s=new a.P(l()),o=s.objectToModel(e,i),t.next=10,(0,a.d)(o,n);case 10:return c=t.sent,u=s.modelToObject(c,e),u=p(i,u,n),t.abrupt("return",u);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function h(t,e){return((0,c.i)(t)?(0,u.g)(t,e):(0,a.a)(t,e)).then((function(t){return t?function(t,e){return v.apply(this,arguments)}(t,e):null}))}function v(){return(v=(0,i.Z)((0,r.Z)().mark((function t(e,n){var i,s,o;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.f)(e,n);case 2:return i=t.sent,s=new a.P(l()),o=s.modelToObject(i,{}),t.abrupt("return",p(i,o,n));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},16529:function(t,e,n){n.d(e,{I:function(){return s},a:function(){return a},b:function(){return i},c:function(){return r}});var r={overview:!0,details:!0,settings:!0},i=[{entity:"initiative",capability:"overview",permissions:["hub:initiative:view"]},{entity:"initiative",capability:"details",permissions:["hub:initiative:edit"]},{entity:"initiative",capability:"settings",permissions:["hub:initiative:edit"]}],a=["hub:initiative:create","hub:initiative:delete","hub:initiative:edit","hub:initiative:view"],s=[{permission:"hub:initiative:create",subsystems:["projects"],authenticated:!0,privileges:["portal:user:createItem"],licenses:["hub-premium"]},{permission:"hub:initiative:view",subsystems:["projects"],authenticated:!1,licenses:["hub-premium"]},{permission:"hub:initiative:edit",authenticated:!0,subsystems:["projects"],entityEdit:!0,licenses:["hub-premium"]},{permission:"hub:initiative:delete",authenticated:!0,subsystems:["projects"],entityOwner:!0,licenses:["hub-premium"]}]},76183:function(t,e,n){n.r(e),n.d(e,{arcgis_hub_entity_editor:function(){return G}});var r=n(74165),i=n(15671),a=n(43144),s=n(93433),o=n(15861),c=n(5692),u=n(54825),l=n(13129),p=(n(74967),n(61584));function f(t,e){var n={translate:function(e){return t.t(e)}};return(0,p.i)(e,{},n)}var d=n(60841),h=n(58669),v=n(76880),g=n(12969),m=n(48103),y=n(80673),b=n(67908),w=n(84907),k=n(66848),x=n(44288);n(7597),n(67450),n(25212),n(17684),n(1319),n(72528),n(35137),n(29398),n(54805),n(27529),n(16529),n(60415),n(39318),n(47268),n(16063),n(8402);function Z(t,e,n,r){return E.apply(this,arguments)}function E(){return(E=(0,o.Z)((0,r.Z)().mark((function t(e,n,i,a){var s;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,y.r)(Object.assign({id:e,resource:n,owner:i},a));case 3:if((s=t.sent).success){t.next=6;break}throw new m.H("Remove Item Resource","Unknown error removing resource.");case 6:return t.abrupt("return",s);case 9:if(t.prev=9,t.t0=t.catch(0),!(t.t0 instanceof Error)){t.next=15;break}throw new m.H("Remove Item Resource",t.t0.message,t.t0);case 15:throw new m.H("Remove Item Resource","Unknown error removing resource.");case 16:case"end":return t.stop()}}),t,null,[[0,9]])})))).apply(this,arguments)}function j(t){return t&&"."!==t.slice(-1)?"".concat(t,"."):t}function C(t,e,n,r){if("item"===n)return function(t,e,n){var r;t=j(t);var i=function(t,e,n){t=j(t);var r=function(t,e){return{appAndMap:{key:"appAndMap",label:"{{".concat(t,"collection.appsAndMaps:translate}}"),targetEntity:e,include:[],scope:{targetEntity:e,filters:[{predicates:[{type:[].concat((0,s.Z)((0,v.o)("app")),(0,s.Z)((0,v.o)("map")))}]}]}},dataset:{key:"dataset",label:"{{".concat(t,"collection.dataset:translate}}"),targetEntity:e,include:[],scope:{targetEntity:e,filters:[{predicates:[{type:(0,v.o)("dataset")}]}]}},document:{key:"document",label:"{{".concat(t,"collection.documents:translate}}"),targetEntity:e,include:[],scope:{targetEntity:e,filters:[{predicates:[{type:(0,v.o)("document")}]}]}},feedback:{key:"feedback",label:"{{".concat(t,"collection.feedback:translate}}"),targetEntity:e,include:[],scope:{targetEntity:e,filters:[{predicates:[{type:(0,v.o)("feedback")}]}]}},site:{key:"site",label:"{{".concat(t,"collection.sites:translate}}"),targetEntity:e,include:[],scope:{targetEntity:e,filters:[{predicates:[{type:(0,v.o)("site")}]}]}},template:{key:"template",label:"{{".concat(t,"collection.templates:translate}}"),targetEntity:e,include:[],scope:{targetEntity:e,filters:[{predicates:[{type:(0,v.o)("template")}]}]}}}}(t,e),i=["appAndMap","dataset","document","feedback","site"];return((null===n||void 0===n?void 0:n.length)?n:i).reduce((function(t,e){return r[e]&&t.push(r[e]),t}),[])}(t,"item",null===n||void 0===n?void 0:n.collectionNames);switch(e){case"myContent":I(e,n),r=S(t,e,[{owner:n.user.username}],i);break;case"favorites":I(e,n),r=S(t,e,[{group:n.user.favGroupId}],i);break;case"organization":I(e,n),r=S(t,e,[{orgid:n.user.orgId,access:"org"}],i);break;case"world":r=S(t,e,[{access:"public"}],i)}return r}(t,e,r);throw new Error('Wellknown catalog not implemented for "'.concat(n,'"'))}function S(t,e,n,r){return{schemaVersion:1,title:"{{".concat(t,"catalog.").concat(e,":translate}}"),scopes:{item:{targetEntity:"item",filters:[{predicates:n}]}},collections:r}}function I(t,e){if(!e||!e.user)throw new Error('User needed to get "'.concat(t,'" catalog'))}function R(){return A.apply(this,arguments)}function A(){return A=(0,o.Z)((0,r.Z)().mark((function t(){var e,n,i,a,s,o,c,u,l,p,h,v,g=arguments;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=g.length>0&&void 0!==g[0]?g[0]:{},n=g.length>1?g[1]:void 0,i=g.length>2?g[2]:void 0,c=(null===n||void 0===n?void 0:n.isAuthenticated)?"?token=".concat(n.session.token):"",u=(0,d.c)("".concat(null===(a=e.view)||void 0===a?void 0:a.featuredImageUrl).concat(c)),l=!!(null===(s=e.extent)||void 0===s?void 0:s.length),t.next=8,D(e,n);case 8:return p=t.sent,h=["myContent","favorites","organization","world"].map((function(t){var e=C("project.fields.featuredContent",t,"item",{user:n.currentUser});return f(i,e)})),v=[{label:i.t("project.fields.featuredContent.facets.type"),key:"type",display:"multi-select",field:"type",options:[],operation:"OR",aggLimit:100},{label:i.t("project.fields.featuredContent.facets.sharing"),key:"access",display:"multi-select",field:"access",options:[],operation:"OR"}],t.abrupt("return",[{scope:"/properties/extent",options:{sources:[{value:"none",selected:!l},{selected:l,value:"item",labelKey:l?"{{i18nScope}}.fields.extent.project":"{{i18nScope}}.fields.extent.org",graphic:{geometry:Object.assign({type:"extent"},p)}}]}},{scope:"/properties/view/properties/featuredImage",options:{imgSrc:(null===(o=e.view)||void 0===o?void 0:o.featuredImageUrl)&&u}},{scope:"/properties/view/properties/featuredContentIds",options:{catalogs:h,facets:v}}]);case 13:case"end":return t.stop()}}),t)}))),A.apply(this,arguments)}function O(t,e){return K.apply(this,arguments)}function K(){return(K=(0,o.Z)((0,r.Z)().mark((function t(e,n){var i;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=(0,g.c)(e),t.next=3,D(e,n);case 3:return i.extent=t.sent,t.abrupt("return",i);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function F(t,e){return H.apply(this,arguments)}function H(){return(H=(0,o.Z)((0,r.Z)().mark((function t(e,n){var i,a,s;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((i=(0,g.c)(e)).extent=(0,h.a)(i.extent),!i.view.featuredImage){t.next=15;break}if(s=i.view.featuredImage,delete i.view.featuredImage,!s.blob){t.next=11;break}return t.next=8,(0,m.u)(e.id,e.owner,s.blob,"featuredImage.png",n.userRequestOptions);case 8:a=t.sent,t.next=14;break;case 11:return a=null,t.next=14,Z(e.id,"featuredImage.png",e.owner,n.userRequestOptions);case 14:i.view.featuredImageUrl=a;case 15:return t.abrupt("return",(0,b.u)(i,n.userRequestOptions));case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function D(t,e){return U.apply(this,arguments)}function U(){return(U=(0,o.Z)((0,r.Z)().mark((function t(e,n){var i;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null===(i=e.extent)||void 0===i?void 0:i.length)){t.next=5;break}t.t0=(0,h.b)(e.extent),t.next=8;break;case 5:return t.next=7,(0,h.c)(n.hubRequestOptions);case 7:t.t0=t.sent;case 8:return t.abrupt("return",t.t0);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _(t,e,n){return q.apply(this,arguments)}function q(){return(q=(0,o.Z)((0,r.Z)().mark((function t(e,n,i){var a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e,t.next="project"===t.t0?3:"site"===t.t0?7:"initiative"===t.t0?11:15;break;case 3:return t.next=5,(0,b.u)(n,i.userRequestOptions);case 5:case 9:case 13:return a=t.sent,t.abrupt("break",15);case 7:return t.next=9,(0,x.u)(n,i.hubRequestOptions);case 11:return t.next=13,(0,k.u)(n,i.userRequestOptions);case 15:return t.abrupt("return",a);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function P(t,e,n){return W.apply(this,arguments)}function W(){return(W=(0,o.Z)((0,r.Z)().mark((function t(e,n,i){var a,s,o,c,u,l;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=(0,w.g)(e),s={project:{config:b.g,options:R}},o={type:"object",properties:{}},c={config:function(){return{schema:o}},options:function(){return[]}},u=s[a]||c,t.next=7,u.options(e,n,i);case 7:return l=t.sent,t.abrupt("return",u.config(a,"edit",l));case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function M(t,e){return z.apply(this,arguments)}function z(){return(z=(0,o.Z)((0,r.Z)().mark((function t(e,n){var i,a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=(0,w.g)(e),a={project:O}[i]||function(){return e},t.abrupt("return",a(e,n));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function T(t,e){return L.apply(this,arguments)}function L(){return(L=(0,o.Z)((0,r.Z)().mark((function t(e,n){var i,a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=(0,w.g)(e),a={project:F}[i]||_.bind(void 0,i),t.abrupt("return",a(e,n));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var G=function(){function t(e){(0,i.Z)(this,t),(0,c.r)(this,e),this.arcgisHubWorkspaceEntityChange=(0,c.c)(this,"arcgisHubWorkspaceEntityChange",7),this.isSaving=!1,(0,u.b)(this,"translationFunc","handleEntityEditorSave","handleEntityEditorChange","setConfigurationFormEl")}return(0,a.Z)(t,[{key:"componentWillLoad",value:function(){var t=(0,o.Z)((0,r.Z)().mark((function t(){var e,n,i,a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.i.loadIntlForComponent(this.element);case 2:return this.intl=t.sent,t.prev=3,t.next=6,P(this.entity,this.context,this.intl);case 6:e=t.sent,n=e.schema,i=e.uiSchema,this.schema=n,this.uiSchema=i,t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),console.error("Could not fetch the editor config:",t.t0);case 16:return t.next=18,M(this.entity,this.context);case 18:a=t.sent,this.values=a;case 20:case"end":return t.stop()}}),t,this,[[3,13]])})));return function(){return t.apply(this,arguments)}}()},{key:"setConfigurationFormEl",value:function(t){this.configurationFormEl=t}},{key:"translationFunc",value:function(t,e,n){return this.intl.t(t,e,n)}},{key:"handleEntityEditorChange",value:function(){this.arcgisHubWorkspaceEntityChange.emit({isDirty:!0,entity:this.entity})}},{key:"handleEntityEditorSave",value:function(){var t=(0,o.Z)((0,r.Z)().mark((function t(e){var n;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.entity,t.prev=1,this.isSaving=!0,t.next=5,T(e.detail,this.context);case 5:n=t.sent,this.configurationFormEl.triggerAlert({kind:"success",title:this.intl.t("success")}),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),console.error("Unable to save entity changes:",t.t0),this.configurationFormEl.triggerAlert({kind:"danger",title:this.intl.t("error"),message:t.t0.toString()});case 13:return t.prev=13,this.isSaving=!1,this.arcgisHubWorkspaceEntityChange.emit({isDirty:!1,entity:n}),t.finish(13);case 17:case"end":return t.stop()}}),t,this,[[1,9,13,17]])})));return function(e){return t.apply(this,arguments)}}()},{key:"render",value:function(){return(0,c.h)(c.H,{"data-element":"entity-editor"},(0,c.h)("arcgis-hub-workspace-panel",null,(0,c.h)("h2",{slot:"title"},this.intl.t("details")),(0,c.h)("arcgis-configuration-form",{context:this.context,isSaving:this.isSaving,onArcgisConfigurationFormChanged:this.handleEntityEditorChange,onArcgisConfigurationFormSaved:this.handleEntityEditorSave,ref:this.setConfigurationFormEl,schema:this.schema,t:this.translationFunc,uiSchema:this.uiSchema,values:this.values})))}},{key:"element",get:function(){return(0,c.g)(this)}}],[{key:"assetsDirs",get:function(){return["locales"]}}]),t}();G.style='.sc-arcgis-hub-entity-editor-h{display:block;height:100%}h2[slot="title"].sc-arcgis-hub-entity-editor{margin:0px;font-size:var(--calcite-font-size-3);line-height:2rem;font-weight:var(--calcite-font-weight-bold)}arcgis-configuration-form.sc-arcgis-hub-entity-editor{--arcgis-configuration-form-footer-bg-color:var(--calcite-ui-foreground-2);--arcgis-configuration-form-footer-negative-margin:2rem}'},60841:function(t,e,n){n.d(e,{c:function(){return r}});var r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"v";if(!t)return t;var n=t.indexOf("?")>-1?"&":"?";return t+="".concat(n).concat(e,"=").concat((new Date).getTime())}},54825:function(t,e,n){n.d(e,{b:function(){return r}});var r=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];n.forEach((function(e){if("function"!==typeof t[e])throw new Error("Cannot bind context. ".concat(e," must be a function"));t[e]=t[e].bind(t)}))}},84907:function(t,e,n){function r(t){var e;switch(t.type){case"Hub Site Application":case"Site Application":e="site";break;case"Hub Page":case"Site Page":e="page";break;case"Hub Project":e="project";break;case"Hub Initiative":e="initiative"}return e}n.d(e,{g:function(){return r}})},80673:function(t,e,n){n.d(e,{a:function(){return o},r:function(){return c}});var r=n(29847),i=n(46356),a=n(35137),s=n(67450);function o(t){return(0,a.d)(t).then((function(e){var n=(0,i.g)(t)+"/content/users/"+e+"/items/"+t.id+"/delete";return(0,s.r)(n,t)}))}function c(t){return(0,a.d)(t).then((function(e){var n=(0,i.g)(t)+"/content/users/"+e+"/items/"+t.id+"/removeResources";return t.params=(0,r._)((0,r._)({},t.params),{resource:t.resource}),"undefined"!==typeof t.deleteAll&&(t.params.deleteAll=t.deleteAll),(0,s.r)(n,t)}))}},74967:function(t,e,n){var r,i;n.d(e,{E:function(){return i},P:function(){return r}}),function(t){t.overview="home",t.details="edit-attributes",t.settings="gear"}(r||(r={})),function(t){t.project="projects",t.site="web",t.initiative="initiative"}(i||(i={}))}}]);
//# sourceMappingURL=76183.6cf8c4f6.chunk.js.map