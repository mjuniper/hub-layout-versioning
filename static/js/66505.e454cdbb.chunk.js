"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[66505],{45028:function(e,t,n){n.d(t,{C:function(){return D},b:function(){return I}});var r,i,a,o,s,u,l,c,d,h,f=n(30168),p=n(22357),v=n(37081),g=n(33280),m=n(94951),y=n(14801),_=n(48655),T=n(16574),x=n(137),S=n(15226),O=n(26461),w=n(116),b=n(41012),C=n(95276),A=n(98634),R=n(64201),E=n(25920),P=n(4760);function I(e){var t=new R.kG,n=t.vertex,I=t.fragment,D=e.output===v.H.Depth,M=e.hasMultipassTerrain&&(e.output===v.H.Color||e.output===v.H.Alpha);return(0,b.Sv)(n,e),t.include(m.w,e),t.include(_.c,e),t.include(y.R,e),t.attributes.add(P.T.POSITION,"vec3"),t.varyings.add("vpos","vec3"),M&&t.varyings.add("depth","float"),D&&(t.include(T.F,e),(0,p.Zu)(t),(0,p.Lm)(t)),n.code.add((0,A.H)(r||(r=(0,f.Z)(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      forwardObjectAndLayerIdColor();\n      ","\n      gl_Position = ","\n    }\n  "])),M?"depth = (view * vec4(vpos, 1.0)).z;":"",D?(0,A.H)(i||(i=(0,f.Z)(["transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);"]))):(0,A.H)(a||(a=(0,f.Z)(["transformPosition(proj, view, vpos);"]))))),t.include(g.f5,e),M&&t.include(S.l,e),I.include(w.Y),I.uniforms.add(new C.N("eColor",(function(e){return e.color}))),e.output===v.H.Highlight&&t.include(x.bA,e),I.code.add((0,A.H)(o||(o=(0,f.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n    vec4 fColor = ","\n\n    ","\n\n    if (fColor.a < ",") {\n      discard;\n    }\n\n    ","\n\n    ","\n    ",";\n    ",";\n    ","\n  }\n  "])),M?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasVertexColors?"vColor * eColor;":"eColor;",e.output===v.H.ObjectAndLayerIdColor?(0,A.H)(s||(s=(0,f.Z)(["fColor.a = 1.0;"]))):"",A.H.float(O.b),e.output===v.H.Alpha?(0,A.H)(u||(u=(0,f.Z)(["gl_FragColor = vec4(fColor.a);"]))):"",e.output===v.H.Color?(0,A.H)(l||(l=(0,f.Z)(["gl_FragColor = highlightSlice(fColor, vpos); ",""])),e.transparencyPassType===E.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"",e.output===v.H.Highlight?(0,A.H)(c||(c=(0,f.Z)(["outputHighlight();"]))):"",e.output===v.H.Depth?(0,A.H)(d||(d=(0,f.Z)(["outputDepth(linearDepth);"]))):"",e.output===v.H.ObjectAndLayerIdColor?(0,A.H)(h||(h=(0,f.Z)(["outputObjectAndLayerIdColor();"]))):"")),t}var D=Object.freeze(Object.defineProperty({__proto__:null,build:I},Symbol.toStringTag,{value:"Module"}))},18442:function(e,t,n){n.d(t,{H:function(){return ie},b:function(){return Q},c:function(){return te}});var r,i,a,o,s,u,l,c,d,h,f,p,v,g,m,y,_,T,x,S,O,w=n(30168),b=n(92026),C=n(88396),A=n(6394),R=n(67077),E=n(67794),P=n(37081),I=n(33280),D=n(14801),M=n(28156),N=n(81879),Z=n(50913),L=n(137),k=n(18607),H=n(26461),F=n(116),z=n(78980),U=n(62993),j=n(82999),V=n(95276),W=n(59150),B=n(58406),G=n(699),q=n(98634),J=n(64201),Y=n(19253),X=n(25920),$=n(4760),K=n(65964);function Q(e){var t=new J.kG,n=e.signedDistanceFieldEnabled;if(t.include(M.H),t.include(N.R,e),t.include(I.f5,e),e.occlusionPass)return t.include(Z.R,e),t;var Q=t.vertex,ne=t.fragment;t.include(U.cK),ne.include(z.n),ne.include(F.Y),t.include(k.k,e),t.include(D.R,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),Q.uniforms.add([new V.N("viewport",(function(e,t){return t.camera.fullViewport})),new j.A("screenOffset",(function(e,t){return(0,C.s)(re,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio)})),new j.A("anchorPosition",(function(e){return te(e)})),new V.N("materialColor",(function(e){return e.color})),new B.p("pixelRatio",(function(e,t){return t.camera.pixelRatio}))]),n&&(Q.uniforms.add(new V.N("outlineColor",(function(e){return e.outlineColor}))),ne.uniforms.add([new V.N("outlineColor",(function(e){return ee(e)?e.outlineColor:R.Z})),new B.p("outlineSize",(function(e){return ee(e)?e.outlineSize:0}))])),e.hasScreenSizePerspective&&((0,U.ww)(Q),(0,U.m8)(Q)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add($.T.UV0,"vec2"),t.attributes.add($.T.COLOR,"vec4"),t.attributes.add($.T.SIZE,"vec2"),t.attributes.add($.T.AUXPOS2,"vec4"),Q.code.add((0,q.H)(r||(r=(0,w.Z)(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      forwardObjectAndLayerIdColor();\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "])),e.hasScreenSizePerspective?(0,q.H)(i||(i=(0,w.Z)(["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):(0,q.H)(a||(a=(0,w.Z)(["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(auxpos2).xx;":"",e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":"",e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""));var ie=(0,q.H)(o||(o=(0,w.Z)(["vec2 uv01 = floor(uv0);\nvec2 uv = uv0 - uv01;\nquadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;"]))),ae=e.pixelSnappingEnabled?n?(0,q.H)(s||(s=(0,w.Z)(["posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):(0,q.H)(u||(u=(0,w.Z)(["posProj += quadOffset;\nif (inputSize.x == size.x) {\nposProj = alignToPixelOrigin(posProj, viewport.zw);\n}"]))):(0,q.H)(l||(l=(0,w.Z)(["posProj += quadOffset;"])));e.vvColor&&Q.uniforms.add([new W.b("vvColorColors",(function(e){return e.vvColorColors}),K.x),new G.O("vvColorValues",(function(e){return e.vvColorValues}),K.x)]),Q.uniforms.add(new j.A("textureCoordinateScaleFactor",(function(e){return(0,b.pC)(e.texture)&&(0,b.pC)(e.texture.descriptor.textureCoordinateScaleFactor)?e.texture.descriptor.textureCoordinateScaleFactor:A.O}))),Q.code.add((0,q.H)(c||(c=(0,w.Z)(["\n    ","\n    ","\n    ","\n\n    ","\n\n    bool alphaDiscard = vcolor.a < ",";\n    ",'\n    if (alphaDiscard) {\n      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n      return;\n    } else {\n      ',"\n      gl_Position = posProj;\n    }\n\n    vtc = uv * textureCoordinateScaleFactor;\n\n    ","\n    vsize = inputSize;\n    ","\n  }\n  "])),e.occlusionTestEnabled?"if (visible) {":"",ie,e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;",e.output===P.H.ObjectAndLayerIdColor?(0,q.H)(d||(d=(0,w.Z)(["vcolor.a = 1.0;"]))):"",q.H.float(H.b),n?"alphaDiscard = alphaDiscard && outlineColor.a < ".concat(q.H.float(H.b),";"):"",ae,e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?(0,q.H)(h||(h=(0,w.Z)(["} else { vtc = vec2(0.0);\n      ",""])),e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),ne.uniforms.add(new Y.A("tex",(function(e){return e.texture})));var oe=e.debugDrawLabelBorder?(0,q.H)(f||(f=(0,w.Z)(["(isBorder > 0.0 ? 0.0 : ",")"])),q.H.float(H.F)):q.H.float(H.F),se=(0,q.H)(p||(p=(0,w.Z)(["\n    ","\n\n    ","\n\n    // Draw debug border with transparency, so that original texels along border are still partially visible\n    ","\n  "])),e.debugDrawLabelBorder?(0,q.H)(v||(v=(0,w.Z)(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",n?(0,q.H)(g||(g=(0,w.Z)(["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = ",";\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),q.H.float(E.Ph),oe,q.H.float(H.b),oe):(0,q.H)(m||(m=(0,w.Z)(["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "])),oe),e.debugDrawLabelBorder?(0,q.H)(y||(y=(0,w.Z)(["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);"]))):"");return e.output===P.H.Alpha&&ne.code.add((0,q.H)(_||(_=(0,w.Z)(["\n      void main() {\n        ","\n        gl_FragColor = vec4(gl_FragColor.a);\n      }\n      "])),se)),e.output===P.H.ObjectAndLayerIdColor&&ne.code.add((0,q.H)(T||(T=(0,w.Z)(["\n      void main() {\n        ","\n        outputObjectAndLayerIdColor();\n      }\n      "])),se)),e.output===P.H.Color&&ne.code.add((0,q.H)(x||(x=(0,w.Z)(["\n    void main() {\n      ","\n      ","\n    }\n    "])),se,e.transparencyPassType===X.A.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":"")),e.output===P.H.Highlight&&(t.include(L.bA,e),ne.code.add((0,q.H)(S||(S=(0,w.Z)(["\n    void main() {\n      ","\n      ","\n    }\n    "])),se,e.binaryHighlightOcclusionEnabled?(0,q.H)(O||(O=(0,w.Z)(["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();"))),t}function ee(e){return e.outlineColor[3]>0&&e.outlineSize>0}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re;return e.textureIsSignedDistanceField?ne(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,C.c)(t,e.anchorPosition),t}function ne(e,t,n){(0,b.pC)(t)?(0,C.s)(n,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,C.s)(n,0,0)}var re=(0,A.a)(),ie=Object.freeze(Object.defineProperty({__proto__:null,build:Q,calculateAnchorPosForRendering:te},Symbol.toStringTag,{value:"Module"}))},99337:function(e,t,n){n.d(t,{N:function(){return P},b:function(){return E}});var r,i,a,o,s,u,l,c,d,h,f,p,v=n(30168),g=n(37081),m=n(33280),y=n(94951),_=n(48655),T=n(137),x=n(60300),S=n(26461),O=n(41012),w=n(95276),b=n(58406),C=n(98634),A=n(64201),R=n(4760);function E(e){var t=new A.kG,n=t.vertex,E=t.fragment;return t.include(y.w,e),t.include(_.c,e),t.include(x.q,e),(0,O.Sv)(n,e),e.stippleEnabled&&(t.attributes.add(R.T.UV0,"vec2"),t.attributes.add(R.T.AUXPOS1,"vec3"),n.uniforms.add(new w.N("viewport",(function(e,t){return t.camera.fullViewport})))),t.attributes.add(R.T.POSITION,"vec3"),t.varyings.add("vpos","vec3"),n.code.add((0,C.H)(r||(r=(0,v.Z)(["void main(void) {\nvpos = position;\nforwardNormalizedVertexColor();\ngl_Position = transformPosition(proj, view, vpos);"])))),e.stippleEnabled&&(n.code.add((0,C.H)(i||(i=(0,v.Z)(["vec4 vpos2 = transformPosition(proj, view, auxpos1);\nvec2 ndcToPixel = viewport.zw * 0.5;\nfloat lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);"])))),e.draped?n.uniforms.add(new b.p("worldToScreenRatio",(function(e,t){return 1/t.screenToPCSRatio}))):n.code.add((0,C.H)(a||(a=(0,v.Z)(["vec3 segmentCenter = (position + auxpos1) * 0.5;\nfloat worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);"])))),n.code.add((0,C.H)(o||(o=(0,v.Z)(["float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);"])))),e.draped?n.code.add((0,C.H)(s||(s=(0,v.Z)(["float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);\nfloat segmentLengthPseudoScreen = lineSegmentPixelSize;"])))):n.code.add((0,C.H)(u||(u=(0,v.Z)(["float segmentLengthRender = length(position - auxpos1);\nfloat startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;\nfloat segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;"])))),n.uniforms.add(new b.p("stipplePatternPixelSize",(function(e){return(0,x.C)(e)}))),n.code.add((0,C.H)(l||(l=(0,v.Z)(["vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);\nvStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);\nvStippleDistance *= gl_Position.w;"]))))),n.code.add((0,C.H)(c||(c=(0,v.Z)(["}"])))),e.output===g.H.Highlight&&t.include(T.bA,e),t.include(m.f5,e),E.uniforms.add(new b.p("alphaCoverage",(function(e,t){return Math.min(1,e.width*t.camera.pixelRatio)}))),e.hasVertexColors||E.uniforms.add(new w.N("constantColor",(function(e){return e.color}))),E.code.add((0,C.H)(d||(d=(0,v.Z)(["\n  void main() {\n    discardBySlice(vpos);\n\n    vec4 color = ",";\n\n    float stippleAlpha = getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);\n\n    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);\n\n    ","\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "])),e.hasVertexColors?"vColor":"constantColor",e.output===g.H.ObjectAndLayerIdColor?(0,C.H)(h||(h=(0,v.Z)(["finalColor.a = 1.0;"]))):"",C.H.float(S.b),e.output===g.H.Color?(0,C.H)(f||(f=(0,v.Z)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",e.output===g.H.Highlight?(0,C.H)(p||(p=(0,v.Z)(["outputHighlight();"]))):"")),t}var P=Object.freeze(Object.defineProperty({__proto__:null,build:E},Symbol.toStringTag,{value:"Module"}))},98186:function(e,t,n){n.d(t,{R:function(){return _e},a:function(){return xe},b:function(){return Te}});var r,i,a,o,s,u,l,c,d,h,f,p,v,g,m,y,_,T,x,S,O,w,b,C,A,R,E,P,I,D,M,N,Z,L,k,H,F,z,U,j,V,W,B,G,q,J=n(30168),Y=n(92026),X=n(22357),$=n(37081),K=n(33280),Q=n(14801),ee=n(48353),te=n(16574),ne=n(60300),re=n(40526),ie=n(15226),ae=n(85586),oe=n(26461),se=n(116),ue=n(41012),le=n(82999),ce=n(95276),de=n(58406),he=n(98634),fe=n(8654),pe=n(64201),ve=n(25920),ge=n(4760),me=n(33720),ye=n(737),_e=1;function Te(e){var t=new pe.kG,n=t.vertex,Te=t.fragment,xe=e.hasMultipassTerrain&&(e.output===$.H.Color||e.output===$.H.Alpha);t.include(ae.e),t.include(ee.U,e),t.include(ne.q,e);var Se=e.applyMarkerOffset&&!e.draped;Se&&(n.uniforms.add(new de.p("markerScale",(function(e){return e.markerScale}))),t.include(re.Q,{space:me.I9.World})),e.output===$.H.Depth&&t.include(te.F,e),t.include(Q.R,e),(0,ue.Sv)(n,e),n.uniforms.add([new fe.g("inverseProjectionMatrix",(function(e,t){return t.camera.inverseProjectionMatrix})),new le.A("nearFar",(function(e,t){return t.camera.nearFar})),new de.p("miterLimit",(function(e){return"miter"!==e.join?0:e.miterLimit})),new ce.N("viewport",(function(e,t){return t.camera.fullViewport}))]),n.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(ge.T.POSITION,"vec3"),t.attributes.add(ge.T.SUBDIVISIONFACTOR,"float"),t.attributes.add(ge.T.UV0,"vec2"),t.attributes.add(ge.T.AUXPOS1,"vec3"),t.attributes.add(ge.T.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),(0,X.Lm)(t),xe&&t.varyings.add("depth","float");var Oe=e.capType===ye.R.ROUND,we=e.stippleEnabled&&e.stippleScaleWithLineWidth||Oe;we&&t.varyings.add("vLineWidth","float");var be=e.stippleEnabled&&e.stippleScaleWithLineWidth;be&&t.varyings.add("vLineSizeInv","float");var Ce=e.innerColorEnabled||Oe;Ce&&t.varyings.add("vLineDistance","float");var Ae=e.stippleEnabled&&Oe,Re=e.falloffEnabled||Ae;Re&&t.varyings.add("vLineDistanceNorm","float"),Oe&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),n.code.add((0,he.H)(r||(r=(0,J.Z)(["#define PERPENDICULAR(v) vec2(v.y, -v.x);\nfloat interp(float ncp, vec4 a, vec4 b) {\nreturn (-ncp - a.z) / (b.z - a.z);\n}\nvec2 rotate(vec2 v, float a) {\nfloat s = sin(a);\nfloat c = cos(a);\nmat2 m = mat2(c, -s, s, c);\nreturn m * v;\n}"])))),n.code.add((0,he.H)(i||(i=(0,J.Z)(["vec4 projectAndScale(vec4 pos) {\nvec4 posNdc = proj * pos;\nposNdc.xy *= viewport.zw / posNdc.w;\nreturn posNdc;\n}"])))),(0,X.bA)(t),n.code.add((0,he.H)(a||(a=(0,J.Z)(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearFar[0] * 0.99;\n\n      if(pos.z > -nearFar[0]) {\n        //current pos behind ncp --\x3e we need to clip\n        if (!isStartVertex) {\n          if(prev.z < -nearFar[0]) {\n            //previous in front of ncp\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        } else {\n          if(next.z < -nearFar[0]) {\n            //next in front of ncp\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        if (prev.z > -nearFar[0]) {\n          //previous behind ncp\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        if (next.z > -nearFar[0]) {\n          //next behind ncp\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      ","\n      linearDepth = calculateLinearDepth(nearFar,pos.z);\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n  "])),xe?"depth = pos.z;":"")),n.uniforms.add(new de.p("pixelRatio",(function(e,t){return t.camera.pixelRatio}))),n.code.add((0,he.H)(o||(o=(0,J.Z)(["\n  void main(void) {\n    // unpack values from uv0.y\n    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n\n    float coverage = 1.0;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isJoin = abs(uv0.y) < 3.0;\n\n      float lineSize = getSize();\n      float lineWidth = lineSize * pixelRatio;\n\n      ","\n      ","\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth < 1.0) {\n        coverage = lineWidth;\n        lineWidth = 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth = floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  = view * vec4(position.xyz, 1.0);\n      vec4 prev = view * vec4(auxpos1.xyz, 1.0);\n      vec4 next = view * vec4(auxpos2.xyz, 1.0);\n  "])),we?(0,he.H)(s||(s=(0,J.Z)(["vLineWidth = lineWidth;"]))):"",be?(0,he.H)(u||(u=(0,J.Z)(["vLineSizeInv = 1.0 / lineSize;"]))):"")),Se&&n.code.add((0,he.H)(l||(l=(0,J.Z)(["vec4 other = isStartVertex ? next : prev;\nbool markersHidden = areWorldMarkersHidden(pos, other);\nif(!isJoin && !markersHidden) {\npos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;\n}"])))),n.code.add((0,he.H)(c||(c=(0,J.Z)(["clipAndTransform(pos, prev, next, isStartVertex);\nvec2 left = (pos.xy - prev.xy);\nvec2 right = (next.xy - pos.xy);\nfloat leftLen = length(left);\nfloat rightLen = length(right);"])))),(e.stippleEnabled||Oe)&&n.code.add((0,he.H)(d||(d=(0,J.Z)(["\n      float isEndVertex = float(!isStartVertex);\n      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);\n      vec2 segment = mix(right, left, isEndVertex);\n      ","\n    "])),Oe?(0,he.H)(h||(h=(0,J.Z)(["vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);"]))):"")),n.code.add((0,he.H)(f||(f=(0,J.Z)(["left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\nright = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\nvec2 capDisplacementDir = vec2(0, 0);\nvec2 joinDisplacementDir = vec2(0, 0);\nfloat displacementLen = lineWidth;\nif (isJoin) {\nbool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;\njoinDisplacementDir = normalize(left + right);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\nif (leftLen > 0.001 && rightLen > 0.001) {\nfloat nDotSeg = dot(joinDisplacementDir, left);\ndisplacementLen /= length(nDotSeg * left - joinDisplacementDir);\nif (!isOutside) {\ndisplacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n}\n}\nif (isOutside && (displacementLen > miterLimit * lineWidth)) {"])))),e.roundJoins?n.code.add((0,he.H)(p||(p=(0,J.Z)(["\n        vec2 startDir = leftLen < 0.001 ? right : left;\n        startDir = PERPENDICULAR(startDir);\n\n        vec2 endDir = rightLen < 0.001 ? left : right;\n        endDir = PERPENDICULAR(endDir);\n\n        float factor = ",";\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);\n      "])),e.stippleEnabled?(0,he.H)(v||(v=(0,J.Z)(["min(1.0, subdivisionFactor * ",")"])),he.H.float((_e+2)/(_e+1))):(0,he.H)(g||(g=(0,J.Z)(["subdivisionFactor"]))))):n.code.add((0,he.H)(m||(m=(0,J.Z)(["if (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;\n}\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);"]))));var Ee=e.capType!==ye.R.BUTT;return n.code.add((0,he.H)(y||(y=(0,J.Z)(["\n        displacementLen = lineWidth;\n      }\n    } else {\n      // CAP handling ---------------------------------------------------\n      joinDisplacementDir = isStartVertex ? right : left;\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      ","\n    }\n  "])),Ee?(0,he.H)(_||(_=(0,J.Z)(["capDisplacementDir = isStartVertex ? -right : left;"]))):"")),n.code.add((0,he.H)(T||(T=(0,J.Z)(["\n    // Displacement (in pixels) caused by join/or cap\n    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n    ","\n\n    ","\n    ","\n\n    pos.xy += dpos;\n  "])),Re||Ce?(0,he.H)(x||(x=(0,J.Z)(["float lineDistNorm = sign(uv0.y) * pos.w;"]))):"",Ce?(0,he.H)(S||(S=(0,J.Z)(["vLineDistance = lineWidth * lineDistNorm;"]))):"",Re?(0,he.H)(O||(O=(0,J.Z)(["vLineDistanceNorm = lineDistNorm;"]))):"")),Oe&&n.code.add((0,he.H)(w||(w=(0,J.Z)(["vec2 segmentDir = normalize(segment);\nvSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;\nvReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);"])))),e.stippleEnabled&&(e.draped?n.uniforms.add(new de.p("worldToScreenRatio",(function(e,t){return 1/t.screenToPCSRatio}))):n.code.add((0,he.H)(b||(b=(0,J.Z)(["vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);\nfloat worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);"])))),n.code.add((0,he.H)(C||(C=(0,J.Z)(["float segmentLengthScreenDouble = length(segment);\nfloat segmentLengthScreen = segmentLengthScreenDouble * 0.5;\nfloat discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);\nfloat segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));\nvStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;"])))),e.draped?n.code.add((0,he.H)(A||(A=(0,J.Z)(["float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;\nfloat startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);"])))):n.code.add((0,he.H)(R||(R=(0,J.Z)(["float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;\nfloat segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;"])))),n.uniforms.add(new de.p("stipplePatternPixelSize",(function(e){return(0,ne.C)(e)}))),n.code.add((0,he.H)(E||(E=(0,J.Z)(["\n      float patternLength = "," stipplePatternPixelSize;\n\n      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader\n      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);\n\n      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);\n\n      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)\n      if (segmentLengthScreenDouble >= 0.001) {\n        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the\n        // original vertex positions, and slightly outside of that range at the displaced positions\n        vec2 stippleDisplacement = pos.xy - segmentOrigin;\n        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);\n\n        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)\n        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);\n      }\n\n      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance\n      vStippleDistanceLimits *= pos.w;\n      vStippleDistance *= pos.w;\n\n      // Disable stipple distance limits on caps\n      vStippleDistanceLimits = isJoin ?\n                                 vStippleDistanceLimits :\n                                 isStartVertex ?\n                                  vec2(-1e038, vStippleDistanceLimits.y) :\n                                  vec2(vStippleDistanceLimits.x, 1e038);\n    "])),e.stippleScaleWithLineWidth?"lineSize * ":""))),n.code.add((0,he.H)(P||(P=(0,J.Z)(["\n      // Convert back into NDC\n      pos.xy = (pos.xy / viewport.zw) * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      ","\n\n      // transform final position to camera space for slicing\n      vpos = (inverseProjectionMatrix * pos).xyz;\n      gl_Position = pos;\n      forwardObjectAndLayerIdColor();\n    }\n  }\n  "])),e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":"")),xe&&t.include(ie.l,e),t.include(K.f5,e),Te.include(se.Y),Te.code.add((0,he.H)(I||(I=(0,J.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n  "])),xe?"terrainDepthTest(gl_FragCoord, depth);":"")),e.wireframe?Te.code.add((0,he.H)(D||(D=(0,J.Z)(["vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);"])))):(Oe&&Te.code.add((0,he.H)(M||(M=(0,J.Z)(["\n      float sdf = min(vSegmentSDF, vReverseSegmentSDF);\n      vec2 fragmentPosition = vec2(\n        min(sdf, 0.0),\n        vLineDistance\n      ) * gl_FragCoord.w;\n\n      float fragmentRadius = length(fragmentPosition);\n      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);\n\n      if (capCoverage < ",") {\n        discard;\n      }\n    "])),he.H.float(oe.b))),Ae?Te.code.add((0,he.H)(N||(N=(0,J.Z)(["\n      vec2 stipplePosition = vec2(\n        min(getStippleSDF() * 2.0 - 1.0, 0.0),\n        vLineDistanceNorm * gl_FragCoord.w\n      );\n      float stippleRadius = length(stipplePosition * vLineWidth);\n      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);\n      float stippleAlpha = step(",", stippleCoverage);\n      "])),he.H.float(oe.b))):Te.code.add((0,he.H)(Z||(Z=(0,J.Z)(["float stippleAlpha = getStippleAlpha();"])))),Te.uniforms.add(new ce.N("intrinsicColor",(function(e){return e.color}))),e.output!==$.H.ObjectAndLayerIdColor&&Te.code.add((0,he.H)(L||(L=(0,J.Z)(["discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);"])))),Te.code.add((0,he.H)(k||(k=(0,J.Z)(["vec4 color = intrinsicColor * vColor;"])))),e.innerColorEnabled&&(Te.uniforms.add(new ce.N("innerColor",(function(e){return(0,Y.Pt)(e.innerColor,e.color)}))),Te.uniforms.add(new de.p("innerWidth",(function(e,t){return e.innerWidth*t.camera.pixelRatio}))),Te.code.add((0,he.H)(H||(H=(0,J.Z)(["float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\nfloat innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\nfloat innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\ncolor = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);"]))))),Te.code.add((0,he.H)(F||(F=(0,J.Z)(["vec4 finalColor = blendStipple(color, stippleAlpha);"])))),e.falloffEnabled&&(Te.uniforms.add(new de.p("falloff",(function(e){return e.falloff}))),Te.code.add((0,he.H)(z||(z=(0,J.Z)(["finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);"])))))),Te.code.add((0,he.H)(U||(U=(0,J.Z)(["\n    ","\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n    ","\n    ","\n    ","\n    ","\n  }\n  "])),e.output===$.H.ObjectAndLayerIdColor?(0,he.H)(j||(j=(0,J.Z)(["finalColor.a = 1.0;"]))):"",he.H.float(oe.b),e.output===$.H.Alpha?(0,he.H)(V||(V=(0,J.Z)(["gl_FragColor = vec4(finalColor.a);"]))):"",e.output===$.H.Color?(0,he.H)(W||(W=(0,J.Z)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",e.output===$.H.Color&&e.transparencyPassType===ve.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":"",e.output===$.H.Highlight?(0,he.H)(B||(B=(0,J.Z)(["gl_FragColor = vec4(1.0);"]))):"",e.output===$.H.Depth?(0,he.H)(G||(G=(0,J.Z)(["outputDepth(linearDepth);"]))):"",e.output===$.H.ObjectAndLayerIdColor?(0,he.H)(q||(q=(0,J.Z)(["outputObjectAndLayerIdColor();"]))):"")),t}var xe=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:_e,build:Te},Symbol.toStringTag,{value:"Module"}))},49810:function(e,t,n){n.d(t,{W:function(){return k},b:function(){return L}});var r,i,a,o,s,u,l,c,d,h,f=n(30168),p=n(22357),v=n(37081),g=n(33280),m=n(94951),y=n(137),_=n(60750),T=n(92395),x=n(15226),S=n(8555),O=n(41481),w=n(58335),b=n(68618),C=n(79246),A=n(26461),R=n(116),E=n(41012),P=n(95276),I=n(58406),D=n(98634),M=n(64201),N=n(25920),Z=n(4760);function L(e){var t=new M.kG,n=t.vertex,L=t.fragment;(0,E.Sv)(n,e),t.include(m.w,e),t.attributes.add(Z.T.POSITION,"vec3"),t.attributes.add(Z.T.UV0,"vec2");var k=new P.N("waterColor",(function(e){return e.color}));if(e.output===v.H.Color&&e.isDraped)return t.varyings.add("vpos","vec3"),n.uniforms.add(k),n.code.add((0,D.H)(r||(r=(0,f.Z)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),D.H.float(A.b))),L.uniforms.add(k),L.code.add((0,D.H)(i||(i=(0,f.Z)(["void main() {\ngl_FragColor = waterColor;\n}"])))),t;switch(e.output!==v.H.Color&&e.output!==v.H.Alpha||(t.include(S.n,e),t.include(p.qj,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),n.uniforms.add(k),n.code.add((0,D.H)(a||(a=(0,f.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        ","\n\n        gl_Position = transformPosition(proj, view, vpos);\n        ","\n      }\n    "])),D.H.float(A.b),e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":"",e.output===v.H.Color?"forwardLinearDepth();":""))),t.include(x.l,e),e.output){case v.H.Alpha:t.include(g.f5,e),L.uniforms.add(k),L.code.add((0,D.H)(o||(o=(0,f.Z)(["\n        void main() {\n          discardBySlice(vpos);\n          ","\n\n          gl_FragColor = vec4(waterColor.a);\n        }\n      "])),e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""));break;case v.H.Color:t.include(T.kR,e),t.include(_._,{pbrMode:O.f7.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(C.M),t.include(g.f5,e),t.include(w.XE,e),t.include(b.B,e),L.uniforms.add([k,new I.p("timeElapsed",(function(e){return e.timeElapsed})),n.uniforms.get("view"),n.uniforms.get("localOrigin")]),(0,E.hY)(L,e),L.include(R.Y),(0,T.Pe)(L),(0,T.F1)(L),L.code.add((0,D.H)(s||(s=(0,f.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - cameraPosition);\n        float shadow = ",";\n        vec4 vPosView = view * vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n        ","\n      }\n    "])),e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":"",e.receiveShadows?(0,D.H)(u||(u=(0,f.Z)(["1.0 - readShadowMap(vpos, linearDepth)"]))):"1.0",e.transparencyPassType===N.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""));break;case v.H.Normal:t.include(S.n,e),t.include(C.M,e),t.include(g.f5,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),n.uniforms.add(k),n.code.add((0,D.H)(l||(l=(0,f.Z)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),D.H.float(A.b))),L.uniforms.add(new I.p("timeElapsed",(function(e){return e.timeElapsed}))),L.code.add((0,D.H)(c||(c=(0,f.Z)(["void main() {\ndiscardBySlice(vpos);\nvec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\ntangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\ngl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n}"]))));break;case v.H.Highlight:t.include(y.bA,e),t.varyings.add("vpos","vec3"),n.uniforms.add(k),n.code.add((0,D.H)(d||(d=(0,f.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "])),D.H.float(A.b))),t.include(g.f5,e),L.code.add((0,D.H)(h||(h=(0,f.Z)(["void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}"]))))}return t}var k=Object.freeze(Object.defineProperty({__proto__:null,build:L},Symbol.toStringTag,{value:"Module"}))},82218:function(e,t,n){n.d(t,{B:function(){return T},a:function(){return x},b:function(){return Q},c:function(){return S},d:function(){return L},e:function(){return N},f:function(){return O},g:function(){return C},h:function(){return M},i:function(){return A},n:function(){return F},r:function(){return H},t:function(){return k},u:function(){return w}});var r=n(37762),i=n(43144),a=n(15671),o=(n(93169),n(32718)),s=n(16889),u=n(21530),l=n(14226),c=n(81949),d=n(11186),h=n(71353),f=n(14320),p=n(85981),v=n(55652),g=n(40885),m=n(40927),y=n(51378),_=o.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane"),T=(0,i.Z)((function e(){(0,a.Z)(this,e),this.plane=(0,v.Ue)(),this.origin=(0,h.c)(),this.basis1=(0,h.c)(),this.basis2=(0,h.c)()}));function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;return{plane:(0,v.Ue)(e.plane),origin:(0,h.a)(e.origin),basis1:(0,h.a)(e.basis1),basis2:(0,h.a)(e.basis2)}}function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x();return O(e.origin,e.basis1,e.basis2,t)}function O(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x();return(0,d.c)(r.origin,e),(0,d.c)(r.basis1,t),(0,d.c)(r.basis2,n),w(r),V(r,"fromValues()"),r}function w(e){(0,v.my)(e.basis2,e.basis1,e.origin,e.plane)}function b(e,t,n){e!==n&&S(e,n);var r=(0,d.g)(y.WM.get(),F(e),t);return(0,d.a)(n.origin,n.origin,r),n.plane[3]-=t,n}function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x(),n=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return(0,d.s)(t.origin,e[0]+n,e[1]+r,0),(0,d.s)(t.basis1,n,0,0),(0,d.s)(t.basis2,0,r,0),(0,v.al)(0,0,1,0,t.plane),t}function A(e,t,n){return!!(0,v.BR)(e.plane,t,n)&&z(e,n)}function R(e,t,n){var i=G.get();W(e,t,i,G.get());var a,o=Number.POSITIVE_INFINITY,u=(0,r.Z)(X);try{for(u.s();!(a=u.n()).done;){var l=j(e,a.value,q.get()),c=y.WM.get();if((0,v.rx)(i,l,c)){var h=(0,d.r)(y.WM.get(),t.origin,c),f=Math.abs((0,s.ZF)((0,d.e)(t.direction,h)));f<o&&(o=f,(0,d.c)(n,c))}}}catch(p){u.e(p)}finally{u.f()}return o===Number.POSITIVE_INFINITY?E(e,t,n):n}function E(e,t,n){if(A(e,t,n))return n;var i=G.get(),a=G.get();W(e,t,i,a);var o,s=Number.POSITIVE_INFINITY,u=(0,r.Z)(X);try{for(u.s();!(o=u.n()).done;){var l=j(e,o.value,q.get()),c=y.WM.get();if((0,v.dZ)(i,l,c)){var h=(0,g.Jk)(t,c);if(!(0,v.Ac)(a,c))continue;h<s&&(s=h,(0,d.c)(n,c))}}}catch(f){u.e(f)}finally{u.f()}return D(e,t.origin)<s&&P(e,t.origin,n),n}function P(e,t,n){var r=(0,v.nF)(e.plane,t,y.WM.get()),i=(0,p.ct)(U(e,e.basis1),r,-1,1,y.WM.get()),a=(0,p.ct)(U(e,e.basis2),r,-1,1,y.WM.get());return(0,d.b)(n,(0,d.a)(y.WM.get(),i,a),e.origin),n}function I(e,t,n){var r=e.origin,i=e.basis1,a=e.basis2,o=(0,d.b)(y.WM.get(),t,r),s=(0,m.SR)(i,o),u=(0,m.SR)(a,o),l=(0,m.SR)(F(e),o);return(0,d.s)(n,s,u,l)}function D(e,t){var n=I(e,t,y.WM.get()),r=e.basis1,i=e.basis2,a=(0,d.l)(r),o=(0,d.l)(i),s=Math.max(Math.abs(n[0])-a,0),u=Math.max(Math.abs(n[1])-o,0),l=n[2];return s*s+u*u+l*l}function M(e,t){return Math.sqrt(D(e,t))}function N(e,t){return(0,v.Ac)(e.plane,t)&&z(e,t)}function Z(e,t){var n=-e.plane[3];return(0,m.SR)(F(e),t)-n}function L(e,t){return(0,d.k)(e.basis1,t.basis1)&&(0,d.k)(e.basis2,t.basis2)&&(0,d.k)(e.origin,t.origin)}function k(e,t,n){return e!==n&&S(e,n),(0,l.a)($,t),(0,l.t)($,$),(0,d.m)(n.basis1,e.basis1,$),(0,d.m)(n.basis2,e.basis2,$),(0,d.m)((0,v.mJ)(n.plane),(0,v.mJ)(e.plane),$),(0,d.m)(n.origin,e.origin,t),(0,v.T5)(n.plane,n.plane,n.origin),n}function H(e,t,n,r){return e!==r&&S(e,r),(0,l.d)(K,t,n),(0,d.m)(r.basis1,e.basis1,K),(0,d.m)(r.basis2,e.basis2,K),w(r),r}function F(e){return(0,v.mJ)(e.plane)}function z(e,t){var n=(0,d.b)(y.WM.get(),t,e.origin),r=(0,d.p)(e.basis1),i=(0,d.p)(e.basis2),a=(0,d.e)(e.basis1,n),o=(0,d.e)(e.basis2,n);return-a-r<0&&a-r<0&&-o-i<0&&o-i<0}function U(e,t){var n=q.get();return(0,d.c)(n.origin,e.origin),(0,d.c)(n.vector,t),n}function j(e,t,n){var r=e.basis1,i=e.basis2,a=e.origin,o=(0,d.g)(y.WM.get(),r,t.origin[0]),s=(0,d.g)(y.WM.get(),i,t.origin[1]);(0,d.a)(n.origin,o,s),(0,d.a)(n.origin,n.origin,a);var u=(0,d.g)(y.WM.get(),r,t.direction[0]),l=(0,d.g)(y.WM.get(),i,t.direction[1]);return(0,d.g)(n.vector,(0,d.a)(u,u,l),2),n}function V(e,t){Math.abs((0,d.e)(e.basis1,e.basis2)/((0,d.l)(e.basis1)*(0,d.l)(e.basis2)))>1e-6&&_.warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,d.e)(e.basis1,F(e)))>1e-6&&_.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,d.e)(F(e),e.origin)-e.plane[3])>1e-6&&_.warn(t,"Plane offset is not consistent with plane origin")}function W(e,t,n,r){var i=F(e);(0,v.my)(i,t.direction,t.origin,n),(0,v.my)((0,v.mJ)(n),i,t.origin,r)}var B={plane:(0,v.Ue)(),origin:(0,h.f)(0,0,0),basis1:(0,h.f)(1,0,0),basis2:(0,h.f)(0,1,0)},G=new u.x(v.Ue),q=new u.x(p.Ue),J=(0,h.c)(),Y=new u.x((function(){return x()})),X=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],$=(0,c.c)(),K=(0,c.c)(),Q=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:T,UP:B,altitudeAt:Z,axisAt:function(e,t,n,r){return function(e,t,n){switch(t){case f.R.X:(0,d.c)(n,e.basis1),(0,d.n)(n,n);break;case f.R.Y:(0,d.c)(n,e.basis2),(0,d.n)(n,n);break;case f.R.Z:(0,d.c)(n,F(e))}return n}(e,n,r)},closestPoint:E,closestPointOnSilhouette:R,copy:S,copyWithoutVerify:function(e,t){(0,d.c)(t.origin,e.origin),(0,d.c)(t.basis1,e.basis1),(0,d.c)(t.basis2,e.basis2),(0,v.JG)(t.plane,e.plane)},create:x,distance:M,distance2:D,distanceToSilhouette:function(e,t){var n,i=Number.NEGATIVE_INFINITY,a=(0,r.Z)(X);try{for(a.s();!(n=a.n()).done;){var o=j(e,n.value,q.get()),s=(0,p.Jk)(o,t);s>i&&(i=s)}}catch(u){a.e(u)}finally{a.f()}return Math.sqrt(i)},elevate:b,equals:L,extrusionContainsPoint:N,fromAABoundingRect:C,fromValues:O,intersectRay:A,intersectRayClosestSilhouette:function(e,t,n){if(A(e,t,n))return n;var r=R(e,t,y.WM.get());return(0,d.a)(n,t.origin,(0,d.g)(y.WM.get(),t.direction,(0,d.i)(t.origin,r)/(0,d.l)(t.direction))),n},normal:F,projectPoint:P,projectPointLocal:I,rotate:H,setAltitudeAt:function(e,t,n,r){var i=Z(e,t),a=(0,d.g)(J,F(e),n-i);return(0,d.a)(r,t,a),r},setExtent:function(e,t,n){return C(t,n),b(n,Z(e,e.origin),n),n},transform:k,updateUnboundedPlane:w,wrap:function(e,t,n){var r=Y.get();return r.origin=e,r.basis1=t,r.basis2=n,r.plane=(0,v.re)(0,0,0,0),w(r),r}},Symbol.toStringTag,{value:"Module"}))},79347:function(e,t,n){n.d(t,{e:function(){return o}});var r,i,a,o={},s={get exports(){return o},set exports(e){o=e}};r=s,i=function(){function e(e,n,i){i=i||2;var a,o,s,l,c,d,h,f=n&&n.length,p=f?n[0]*i:e.length,v=t(e,0,p,i,!0),g=[];if(!v||v.next===v.prev)return g;if(f&&(v=u(e,n,v,i)),e.length>80*i){a=s=e[0],o=l=e[1];for(var m=i;m<p;m+=i)(c=e[m])<a&&(a=c),(d=e[m+1])<o&&(o=d),c>s&&(s=c),d>l&&(l=d);h=0!==(h=Math.max(s-a,l-o))?1/h:0}return r(v,g,i,a,o,h),g}function t(e,t,n,r,i){var a,o;if(i===R(e,t,n,r)>0)for(a=t;a<n;a+=r)o=b(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=b(a,e[a],e[a+1],o);if(o&&_(o,o.next)){var s=o.next;C(o),o=s}return o}function n(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!_(r,r.next)&&0!==y(r.prev,r,r.next))r=r.next;else{var i=r.prev;if(C(r),(r=t=i)===r.next)break;n=!0}}while(n||r!==t);return t}function r(e,t,u,l,c,d,h){if(e){!h&&d&&f(e,l,c,d);for(var p,v,g=e;e.prev!==e.next;)if(p=e.prev,v=e.next,d?a(e,l,c,d):i(e))t.push(p.i/u),t.push(e.i/u),t.push(v.i/u),C(e),e=v.next,g=v.next;else if((e=v)===g){h?1===h?r(e=o(n(e),t,u),t,u,l,c,d,2):2===h&&s(e,t,u,l,c,d):r(n(e),t,u,l,c,d,1);break}}}function i(e){var t=e.prev,n=e,r=e.next;if(y(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(g(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&y(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(e,t,n,r){var i=e.prev,a=e,o=e.next;if(y(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,u=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,l=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,c=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,d=p(s,u,t,n,r),h=p(l,c,t,n,r),f=e.prevZ,v=e.nextZ;f&&f.z>=d&&v&&v.z<=h;){if(f!==e.prev&&f!==e.next&&g(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,v!==e.prev&&v!==e.next&&g(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;f&&f.z>=d;){if(f!==e.prev&&f!==e.next&&g(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;v&&v.z<=h;){if(v!==e.prev&&v!==e.next&&g(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function o(e,t,r){var i=e;do{var a=i.prev,o=i.next.next;!_(a,o)&&T(a,i,i.next,o)&&O(a,o)&&O(o,a)&&(t.push(a.i/r),t.push(i.i/r),t.push(o.i/r),C(i),C(i.next),i=e=o),i=i.next}while(i!==e);return n(i)}function s(e,t,i,a,o,s){var u=e;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&m(u,l)){var c=w(u,l);return u=n(u,u.next),c=n(c,c.next),r(u,t,i,a,o,s),void r(c,t,i,a,o,s)}l=l.next}u=u.next}while(u!==e)}function u(e,r,i,a){var o,s,u,c=[];for(o=0,s=r.length;o<s;o++)(u=t(e,r[o]*a,o<s-1?r[o+1]*a:e.length,a,!1))===u.next&&(u.steiner=!0),c.push(v(u));for(c.sort(l),o=0;o<c.length;o++)i=n(i=d(c[o],i),i.next);return i}function l(e,t){return e.x-t.x}function c(e){if(e.next.prev===e)return e;for(var t=e;;){var n=t.next;if(n.prev===t||n===t||n===e)break;t=n}return t}function d(e,t){var r=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n;var u,l=n,c=n.x,d=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&g(a<d?i:o,a,c,d,a<d?o:i,a,r.x,r.y)&&(u=Math.abs(a-r.y)/(i-r.x),O(r,e)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&h(n,r)))&&(n=r,f=u)),r=r.next}while(r!==l);return n}(e,t);if(!r)return t;var i=w(r,e),a=n(r,r.next),o=c(i);return n(o,o.next),a=c(a),c(t===r?a:t)}function h(e,t){return y(e.prev,e,t.prev)<0&&y(t.next,e,e.next)<0}function f(e,t,n,r){var i=e;do{null===i.z&&(i.z=p(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,u,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,l*=2}while(o>1)}(i)}function p(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function v(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function g(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&T(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(O(e,t)&&O(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(y(e.prev,e,t.prev)||y(e,t.prev,t))||_(e,t)&&y(e.prev,e,e.next)>0&&y(t.prev,t,t.next)>0)}function y(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function T(e,t,n,r){var i=S(y(e,t,n)),a=S(y(e,t,r)),o=S(y(n,r,e)),s=S(y(n,r,t));return i!==a&&o!==s||!(0!==i||!x(e,n,t))||!(0!==a||!x(e,r,t))||!(0!==o||!x(n,e,r))||!(0!==s||!x(n,t,r))}function x(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function S(e){return e>0?1:e<0?-1:0}function O(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function w(e,t){var n=new A(e.i,e.x,e.y),r=new A(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function b(e,t,n,r){var i=new A(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function C(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function A(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function R(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}return e.deviation=function(e,t,n,r){var i=t&&t.length,a=i?t[0]*n:e.length,o=Math.abs(R(e,0,a,n));if(i)for(var s=0,u=t.length;s<u;s++){var l=t[s]*n,c=s<u-1?t[s+1]*n:e.length;o-=Math.abs(R(e,l,c,n))}var d=0;for(s=0;s<r.length;s+=3){var h=r[s]*n,f=r[s+1]*n,p=r[s+2]*n;d+=Math.abs((e[h]-e[p])*(e[f+1]-e[h+1])-(e[h]-e[f])*(e[p+1]-e[h+1]))}return 0===o&&0===d?0:Math.abs((d-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[i][a][o]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n},e},void 0!==(a=i())&&(r.exports=a)},46228:function(e,t,n){n.d(t,{I:function(){return i},v:function(){return a}});var r=n(16889);function i(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=(0,r.uZ)(e,0,u),a=0;a<4;a++)t[n+a]=Math.floor(256*l(i*o[a]))}function a(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0,r=0;r<4;r++)n+=e[t+r]*s[r];return n}var o=[1,256,65536,16777216],s=[1/256,1/65536,1/16777216,1/4294967296],u=a(new Uint8ClampedArray([255,255,255,255]));function l(e){return e-Math.floor(e)}},70444:function(e,t,n){n.d(t,{S$:function(){return c},Ue:function(){return o},Ws:function(){return l},_k:function(){return u},iL:function(){return s}});var r=n(21530),i=n(11186),a=n(40885);function o(e){return e?{ray:(0,a.Ue)(e.ray),c0:e.c0,c1:e.c1}:{ray:(0,a.Ue)(),c0:0,c1:Number.MAX_VALUE}}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o();return(0,a.JG)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o(),r=(0,i.l)(e.vector);return(0,a.al)(e.origin,t,n.ray),n.c0=0,n.c1=r,n}function l(e,t){return d(e,e.c0,t)}function c(e,t){return d(e,e.c1,t)}function d(e,t,n){return(0,i.a)(n,e.ray.origin,(0,i.g)(n,e.ray.direction,t))}new r.x((function(){return o()}))},95773:function(e,t,n){n.d(t,{Hf:function(){return g},JG:function(){return m},Jp:function(){return _},NQ:function(){return i},Nu:function(){return r},Ue:function(){return v},Zr:function(){return x},g8:function(){return w},hr:function(){return T},q_:function(){return y},rN:function(){return O},tc:function(){return C},xu:function(){return R},zq:function(){return S}});var r,i,a,o=n(21530),s=n(14226),u=n(11186),l=n(71353),c=n(90045),d=n(67077),h=n(70444),f=n(55652),p=n(51378);function v(e){return e?[(0,f.Ue)(e[0]),(0,f.Ue)(e[1]),(0,f.Ue)(e[2]),(0,f.Ue)(e[3]),(0,f.Ue)(e[4]),(0,f.Ue)(e[5])]:[(0,f.Ue)(),(0,f.Ue)(),(0,f.Ue)(),(0,f.Ue)(),(0,f.Ue)(),(0,f.Ue)()]}function g(){return[(0,l.c)(),(0,l.c)(),(0,l.c)(),(0,l.c)(),(0,l.c)(),(0,l.c)(),(0,l.c)(),(0,l.c)()]}function m(e,t){for(var n=0;n<C.NUM;n++)(0,f.JG)(e[n],t[n])}function y(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:I,i=(0,s.m)(p.MP.get(),t,e);(0,s.a)(i,i);for(var a=0;a<A.NUM;++a){var o=(0,c.t)(p.o6.get(),E[a],i);(0,u.s)(r[a],o[0]/o[3],o[1]/o[3],o[2]/o[3])}_(n,r)}function _(e,t){(0,f.zk)(t[i.FAR_BOTTOM_LEFT],t[i.NEAR_BOTTOM_LEFT],t[i.NEAR_TOP_LEFT],e[r.LEFT]),(0,f.zk)(t[i.NEAR_BOTTOM_RIGHT],t[i.FAR_BOTTOM_RIGHT],t[i.FAR_TOP_RIGHT],e[r.RIGHT]),(0,f.zk)(t[i.FAR_BOTTOM_LEFT],t[i.FAR_BOTTOM_RIGHT],t[i.NEAR_BOTTOM_RIGHT],e[r.BOTTOM]),(0,f.zk)(t[i.NEAR_TOP_LEFT],t[i.NEAR_TOP_RIGHT],t[i.FAR_TOP_RIGHT],e[r.TOP]),(0,f.zk)(t[i.NEAR_BOTTOM_LEFT],t[i.NEAR_BOTTOM_RIGHT],t[i.NEAR_TOP_RIGHT],e[r.NEAR]),(0,f.zk)(t[i.FAR_BOTTOM_RIGHT],t[i.FAR_BOTTOM_LEFT],t[i.FAR_TOP_LEFT],e[r.FAR])}function T(e,t){for(var n=0;n<C.NUM;n++){var r=e[n];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function x(e,t){return b(e,(0,h.iL)(t,P.get()))}function S(e,t){for(var n=0;n<C.NUM;n++){var r=e[n];if(!(0,f.Er)(r,t))return!1}return!0}function O(e,t,n){return b(e,(0,h._k)(t,n,P.get()))}function w(e,t){for(var n=0;n<C.NUM;n++)if((0,f.jH)(e[n],t)>0)return!1;return!0}function b(e,t){for(var n=0;n<C.NUM;n++)if(!(0,f.oq)(e[n],t))return!1;return!0}(a=r||(r={}))[a.LEFT=0]="LEFT",a[a.RIGHT=1]="RIGHT",a[a.BOTTOM=2]="BOTTOM",a[a.TOP=3]="TOP",a[a.NEAR=4]="NEAR",a[a.FAR=5]="FAR",function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(i||(i={}));var C,A,R={bottom:[i.FAR_BOTTOM_RIGHT,i.NEAR_BOTTOM_RIGHT,i.NEAR_BOTTOM_LEFT,i.FAR_BOTTOM_LEFT],near:[i.NEAR_BOTTOM_LEFT,i.NEAR_BOTTOM_RIGHT,i.NEAR_TOP_RIGHT,i.NEAR_TOP_LEFT],far:[i.FAR_BOTTOM_RIGHT,i.FAR_BOTTOM_LEFT,i.FAR_TOP_LEFT,i.FAR_TOP_RIGHT],right:[i.NEAR_BOTTOM_RIGHT,i.FAR_BOTTOM_RIGHT,i.FAR_TOP_RIGHT,i.NEAR_TOP_RIGHT],left:[i.FAR_BOTTOM_LEFT,i.NEAR_BOTTOM_LEFT,i.NEAR_TOP_LEFT,i.FAR_TOP_LEFT],top:[i.FAR_TOP_LEFT,i.NEAR_TOP_LEFT,i.NEAR_TOP_RIGHT,i.FAR_TOP_RIGHT]};!function(e){e[e.NUM=6]="NUM"}(C||(C={})),function(e){e[e.NUM=8]="NUM"}(A||(A={}));var E=[(0,d.f)(-1,-1,-1,1),(0,d.f)(1,-1,-1,1),(0,d.f)(1,1,-1,1),(0,d.f)(-1,1,-1,1),(0,d.f)(-1,-1,1,1),(0,d.f)(1,-1,1,1),(0,d.f)(1,1,1,1),(0,d.f)(-1,1,1,1)],P=new o.x(h.Ue),I=g()},35888:function(e,t,n){n.d(t,{d:function(){return a}});var r=n(16889),i=n(72838);function a(e,t,n){var a,c=Array.isArray(e),d=c?e.length/t:e.byteLength/(4*t),h=c?e:new Uint32Array(e,0,d*t),f=null!==(a=null===n||void 0===n?void 0:n.minReduction)&&void 0!==a?a:0,p=(null===n||void 0===n?void 0:n.originalIndices)||null,v=p?p.length:0,g=(null===n||void 0===n?void 0:n.componentOffsets)||null,m=0;if(g)for(var y=0;y<g.length-1;y++){var _=g[y+1]-g[y];_>m&&(m=_)}else m=d;var T=Math.floor(1.1*m)+1;(null==l||l.length<2*T)&&(l=new Uint32Array((0,r.Sf)(2*T)));for(var x=0;x<2*T;x++)l[x]=0;for(var S=0,O=!!g&&!!p,w=O?v:d,b=(0,i.$z)(d/3),C=new Uint32Array(v),A=1.96,R=0!==f?Math.ceil(4*A*A/(f*f)*f*(1-f)):w,E=1,P=g?g[1]:w,I=0;I<w;I++){if(I===R){var D=1-S/I;if(D+A*Math.sqrt(D*(1-D)/I)<f)return null;R*=2}if(I===P){for(var M=0;M<2*T;M++)l[M]=0;if(p)for(var N=g[E-1];N<g[E];N++)C[N]=b[p[N]];P=g[++E]}for(var Z=O?p[I]:I,L=Z*t,k=u(h,L,t),H=k%T,F=S;0!==l[2*H+1];){if(l[2*H]===k){var z=l[2*H+1]-1;if(o(h,L,z*t,t)){F=b[z];break}}++H>=T&&(H-=T)}F===S&&(l[2*H]=k,l[2*H+1]=Z+1,S++),b[Z]=F}if(0!==f&&1-S/d<f)return null;if(O){for(var U=g[E-1];U<C.length;U++)C[U]=b[p[U]];b=(0,i.mi)(C)}var j=c?new Array(S):new Uint32Array(S*t);S=0;for(var V=0;V<w;V++)b[V]===S&&(s(h,(O?p[V]:V)*t,j,S*t,t),S++);if(p&&!O){for(var W=new Uint32Array(v),B=0;B<W.length;B++)W[B]=b[p[B]];b=(0,i.mi)(W)}return{buffer:Array.isArray(j)?j:j.buffer,indices:b,uniqueCount:S}}function o(e,t,n,r){for(var i=0;i<r;i++)if(e[t+i]!==e[n+i])return!1;return!0}function s(e,t,n,r,i){for(var a=0;a<i;a++)n[r+a]=e[t+a]}function u(e,t,n){for(var r=0,i=0;i<n;i++)r=(r=e[t+i]+r|0)+(r<<11)+(r>>>2)|0;return r>>>0}var l=null},91320:function(e,t,n){n.d(t,{Mk:function(){return d},ZI:function(){return r},bT:function(){return c}});var r,i,a=n(37762),o=n(79347),s=n(69662),u=n(35888),l=n(88699);function c(e){var t,n=d(e.rings,e.hasZ,r.CCW_IS_HOLE),i=new Array,s=0,c=0,h=(0,a.Z)(n.polygons);try{var f=function(){var e=t.value,r=e.count,a=e.index,u=(0,l.Rq)(n.position,3*a,3*r),d=e.holeIndices.map((function(e){return e-a})),h=new Uint32Array((0,o.e)(u,d,3));i.push({position:u,faces:h}),s+=u.length,c+=h.length};for(h.s();!(t=h.n()).done;)f()}catch(g){h.e(g)}finally{h.f()}var p=function(e,t,n){if(1===e.length)return e[0];var r,i=(0,l.bg)(t),o=new Uint32Array(n),s=0,u=0,c=0,d=(0,a.Z)(e);try{for(d.s();!(r=d.n()).done;){for(var h=r.value,f=0;f<h.position.length;f++)i[s++]=h.position[f];for(var p=0;p<h.faces.length;p++)o[u++]=h.faces[p]+c;c=s/3}}catch(g){d.e(g)}finally{d.f()}return{position:i,faces:o}}(i,s,c),v=Array.isArray(p.position)?(0,u.d)(p.position,3,{originalIndices:p.faces}):(0,u.d)(p.position.buffer,6,{originalIndices:p.faces});return p.position=new Float64Array(v.buffer),p.faces=v.indices,p}function d(e,t,n){for(var i=e.length,a=new Array(i),o=new Array(i),s=new Array(i),u=0,c=0,d=0,p=0,v=0;v<i;++v)p+=e[v].length;for(var g=(0,l.bg)(3*p),m=0,y=i-1;y>=0;y--){var _=e[y],T=n===r.CCW_IS_HOLE&&f(_);if(T&&1!==i)a[u++]=_;else{for(var x=_.length,S=0;S<u;++S)x+=a[S].length;var O={index:m,pathLengths:new Array(u+1),count:x,holeIndices:new Array(u)};O.pathLengths[0]=_.length,_.length>0&&(s[d++]={index:m,count:_.length}),m=T?h(_,_.length-1,-1,g,m,_.length,t):h(_,0,1,g,m,_.length,t);for(var w=0;w<u;++w){var b=a[w];O.holeIndices[w]=m,O.pathLengths[w+1]=b.length,b.length>0&&(s[d++]={index:m,count:b.length}),m=h(b,0,1,g,m,b.length,t)}u=0,O.count>0&&(o[c++]=O)}}for(var C=0;C<u;++C){var A=a[C];A.length>0&&(s[d++]={index:m,count:A.length}),m=h(A,0,1,g,m,A.length,t)}return o.length=c,s.length=d,{position:g,polygons:o,outlines:s}}function h(e,t,n,r,i,a,o){i*=3;for(var s=0;s<a;++s){var u=e[t];r[i++]=u[0],r[i++]=u[1],r[i++]=o?u[2]:0,t+=n}return i/3}function f(e){return!(0,s.bu)(e,!1,!1)}(i=r||(r={}))[i.NONE=0]="NONE",i[i.CCW_IS_HOLE=1]="CCW_IS_HOLE"},81020:function(e,t,n){function r(e){return"point"===e.type}n.d(t,{f:function(){return r}})},37818:function(e,t,n){n.d(t,{D:function(){return _},Ou:function(){return d},WG:function(){return y},kB:function(){return p},mW:function(){return f}});var r=n(37762),i=(n(59486),n(52639)),a=(n(93169),n(84652)),o=n(92026),s=n(18722),u=n(77981),l=n(65618),c=n(78952);function d(e){return"declaredClass"in e}function h(e){return"declaredClass"in e}function f(e,t){return e?function(e){return"declaredClass"in e}(e)?e:new i.Z({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,a.d9)(e.symbol),attributes:(0,a.d9)(e.attributes),geometry:p(e.geometry)}):null}function p(e){return(0,o.Wi)(e)?null:d(e)?e:(0,u.im)(function(e){var t=e.spatialReference,n=t.wkid,r=t.wkt,i=t.latestWkid,a={wkid:n,wkt:r,latestWkid:i};switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:a};case"polygon":var o=e.rings,s=e.hasZ,u=e.hasM;return{rings:v(o),hasZ:s,hasM:u,spatialReference:a};case"polyline":var l=e.paths,c=e.hasZ,d=e.hasM;return{paths:v(l),hasZ:c,hasM:d,spatialReference:a};case"extent":return{xmin:e.xmin,xmax:e.xmax,ymin:e.ymin,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax,hasZ:e.hasZ,hasM:e.hasM,spatialReference:a};case"multipoint":var h=e.points,f=e.hasZ,p=e.hasM;return{points:m(h)?g(h):h,hasZ:f,hasM:p,spatialReference:a};default:return}}(e))}function v(e){return function(e){var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(0!==i.length)return m(i)}}catch(a){n.e(a)}finally{n.f()}return!1}(e)?e.map((function(e){return g(e)})):e}function g(e){return e.map((function(e){return Array.from(e)}))}function m(e){return e.length>0&&((0,s.xZ)(e[0])||(0,s.fS)(e[0]))}function y(e,t){if(!e)return null;var n;if(h(e)){if(null==t)return e.clone();if(h(t))return t.copy(e)}return null!=t?((n=t).x=e.x,n.y=e.y,n.spatialReference=e.spatialReference,e.hasZ?(n.z=e.z,n.hasZ=e.hasZ):(n.z=void 0,n.hasZ=!1),e.hasM?(n.m=e.m,n.hasM=!0):(n.m=void 0,n.hasM=!1)):(n=(0,l.Tx)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(n.m=e.m,n.hasM=!0)),n}function _(e){var t={wkid:e.wkid,wkt:e.wkt,latestWkid:e.latestWkid};return c.Z.fromJSON(t)}},79563:function(e,t,n){n.d(t,{Ne:function(){return m},Od:function(){return p},Sp:function(){return g},_M:function(){return f},mx:function(){return v}});var r=n(65905),i=n(51995),a=n(76200),o=n(59026),s=n(17842),u=n(49729),l="picture-fill",c="simple-fill",d="simple-marker",h=new o.Z(1e3);function f(e){var t=e.style,n=null;if(e)switch(e.type){case d:"cross"!==t&&"x"!==t&&(n=e.color);break;case c:"solid"===t?n=e.color:"none"!==t&&(n={type:"pattern",x:0,y:0,src:(0,r.V)("esri/symbols/patterns/".concat(t,".png")),width:5,height:5});break;case l:n={type:"pattern",src:e.url,width:(0,s.F2)(e.width)*e.xscale,height:(0,s.F2)(e.height)*e.yscale,x:(0,s.F2)(e.xoffset),y:(0,s.F2)(e.yoffset)};break;case"text":n=e.color;break;case"cim":n=(0,u.iW)(e)}return n}function p(e,t){var n=e+"-"+t;return void 0!==h.get(n)?Promise.resolve(h.get(n)):(0,a.default)(e,{responseType:"image"}).then((function(e){var r=e.data,i=r.naturalWidth,a=r.naturalHeight,o=document.createElement("canvas");o.width=i,o.height=a;var s=o.getContext("2d");s.fillStyle=t,s.fillRect(0,0,i,a),s.globalCompositeOperation="destination-in",s.drawImage(r,0,0);var u=o.toDataURL();return h.put(n,u),u}))}function v(e){if(!e)return null;var t=null;switch(e.type){case c:case l:case d:t=v(e.outline);break;case"simple-line":var n=(0,s.F2)(e.width);null!=e.style&&"none"!==e.style&&0!==n&&(t={color:e.color,style:g(e.style),width:n,cap:e.cap,join:"miter"===e.join?(0,s.F2)(e.miterLimit):e.join});break;default:t=null}return t}var g=function(){var e={};return function(t){if(e[t])return e[t];var n=t.replace(/-/g,"");return e[t]=n,n}}(),m=new i.Z([128,128,128])},74579:function(e,t,n){n.d(t,{BR:function(){return F},Q8:function(){return j},QL:function(){return U},Y6:function(){return g},YW:function(){return m},_h:function(){return _},e3:function(){return k},nf:function(){return y},tb:function(){return x},wJ:function(){return z}});var r=n(74165),i=n(37762),a=n(15861),o=n(51995),s=n(51508),u=n(14921),l=(n(93169),n(92026)),c=n(17842),d=n(71353),h=n(60676),f=n(79563),p=n(32537),v=new o.Z("white");function g(e){var t;if(!e)return 0;if((0,s.dU)(e)){var n=function(e){var t=e.symbolLayers&&e.symbolLayers.length;if(t){var n=e.symbolLayers.getItemAt(t-1);return"outline"in n?(0,l.U2)(n,"outline","size"):void 0}}(e);return(0,l.pC)(n)?n:0}return(0,c.Wz)(null===(t=(0,f.mx)(e))||void 0===t?void 0:t.width)}function m(e){if((0,l.Wi)(e)||!("symbolLayers"in e)||(0,l.Wi)(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((function(e){return"object"===e.type}));case"line-3d":return e.symbolLayers.some((function(e){return"path"===e.type}));case"polygon-3d":return e.symbolLayers.some((function(e){return"object"===e.type||"extrude"===e.type}));default:return!1}}function y(e){return(0,l.s3)(e.resource).href}function _(e,t){if(!e)return null;var n=null;return(0,s.dU)(e)?n=function(e){var t=e.symbolLayers;if(!t)return null;var n=null;return t.forEach((function(e){var t;"object"===e.type&&null!=(null===(t=e.resource)||void 0===t?void 0:t.href)||(n="water"===e.type?(0,l.Wg)(e.color):(0,l.pC)(e.material)?(0,l.Wg)(e.material.color):null)})),n?new o.Z(n):null}(e):(0,s.cT)(e)&&(n=e.color?new o.Z(e.color):null),n?T(n,t):null}function T(e,t){if(null==t||null==e)return e;var n=e.toRgba();return n[3]=n[3]*t,new o.Z(n)}function x(e,t,n){e&&(t||null!=n)&&(t&&(t=new o.Z(t)),(0,s.dU)(e)?function(e,t,n){var r=e.symbolLayers;if(r){var i=function(e){var r,i,a=(0,l.pC)(e)?e:null;return T(t=null!==(r=null!==(i=t)&&void 0!==i?i:a)&&void 0!==r?r:null!=n?v:null,n)};r.forEach((function(e){var r;if("object"!==e.type||null==(null===(r=e.resource)||void 0===r?void 0:r.href)||t)if("water"===e.type)e.color=i(e.color);else{var a=(0,l.pC)(e.material)?e.material.color:null,o=i(a);(0,l.Wi)(e.material)?e.material=new p.b({color:o}):e.material.color=o,null!=n&&"outline"in e&&(0,l.pC)(e.outline)&&(0,l.pC)(e.outline.color)&&(e.outline.color=T(e.outline.color,n))}}))}}(e,t,n):(0,s.cT)(e)&&function(e,t,n){var r;(t=null!==(r=t)&&void 0!==r?r:e.color)&&(e.color=T(t,n)),null!=n&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=T(e.outline.color,n))}(e,t,n))}function S(e,t){return O.apply(this,arguments)}function O(){return O=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.symbolLayers,e.t0=i,!e.t0){e.next=5;break}return e.next=5,(0,u.Ed)(i,function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}}),e)}))),O.apply(this,arguments)}function w(e,t){return b.apply(this,arguments)}function b(){return(b=(0,a.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="extrude"===e.t0?3:"icon"===e.t0||"line"===e.t0||"text"===e.t0?5:"path"===e.t0?7:"object"===e.t0?9:11;break;case 3:return R(t,n),e.abrupt("break",11);case 5:return C(t,n),e.abrupt("break",11);case 7:return I(t,n),e.abrupt("break",11);case 9:return e.next=11,E(t,n);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e,t){var n=A(t);(0,l.pC)(n)&&(e.size=n)}function A(e){var t,n=(0,i.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("number"==typeof r)return r}}catch(a){n.e(a)}finally{n.f()}return null}function R(e,t){e.size="number"==typeof t[2]?t[2]:0}function E(e,t){return P.apply(this,arguments)}function P(){return(P=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i,a,o,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t);case 2:i=e.sent,a=i.resourceSize,o=i.symbolSize,s=D(n,a,o),t.width=Z(n[0],o[0],a[0],s),t.depth=Z(n[1],o[1],a[1],s),t.height=Z(n[2],o[2],a[2],s);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t){var n=D(t,d.O,[e.width,void 0,e.height]);e.width=Z(t[0],e.width,1,n),e.height=Z(t[2],e.height,1,n)}function D(e,t,n){for(var r=0;r<3;r++){var i=e[r];switch(i){case"symbol-value":var a=n[r];return null!=a?a/t[r]:1;case"proportional":break;default:if(i&&t[r])return i/t[r]}}return 1}function M(e){return N.apply(this,arguments)}function N(){return(N=(0,a.Z)((0,r.Z)().mark((function e(t){var i,a,o,s,u,l,c,d,h,f;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(23657).then(n.bind(n,23657));case 2:return i=e.sent,e.next=5,i.computeObjectLayerResourceSize(t,10);case 5:a=e.sent,o=t.width,s=t.height,u=t.depth,l=[o,u,s],c=1,d=0;case 12:if(!(d<3)){e.next=20;break}if(null==(h=l[d])){e.next=17;break}return c=h/a[d],e.abrupt("break",20);case 17:d++,e.next=12;break;case 20:for(f=0;f<3;f++)null==l[f]&&(l[f]=a[f]*c);return e.abrupt("return",{resourceSize:a,symbolSize:l});case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e,t,n,r){switch(e){case"proportional":return n*r;case"symbol-value":return null!=t?t:n;default:return e}}function L(e,t){var n=A(t);if(!(0,l.Wi)(n))switch(e.type){case"simple-marker":e.size=n;break;case"picture-marker":var r=e.width/e.height;r>1?(e.width=n,e.height=n*r):(e.width=n*r,e.height=n);break;case"simple-line":e.width=n;break;case"text":e.font.size=n}}function k(e,t){return H.apply(this,arguments)}function H(){return(H=(0,a.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!n){e.next=2;break}return e.abrupt("return",(0,s.dU)(t)?S(t,n):void((0,s.cT)(t)&&L(t,n)));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t,n){if(e&&null!=t)if((0,s.dU)(e)){var r=e.symbolLayers;r&&r.forEach((function(e){if(e&&"object"===e.type)switch(n){case"tilt":e.tilt=t;break;case"roll":e.roll=t;break;default:e.heading=t}}))}else(0,s.cT)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle=t))}function z(e){if(!e)return null;var t=e.effects.filter((function(e){return"bloom"!==e.type})).map((function(e){return e.toJSON()}));return(0,h.rM)(t)}function U(e){return(0,l.pC)(e)&&"polygon-3d"===e.type&&e.symbolLayers.some((function(e){return"extrude"===e.type}))}function j(e,t){return V.apply(this,arguments)}function V(){return(V=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fetchSymbol(n);case 2:return i=e.sent,e.abrupt("return",i||t.fetchCIMSymbol(n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},91226:function(e,t,n){n.d(t,{YF:function(){return r},co:function(){return i},hZ:function(){return a},ii:function(){return h}});var r,i,a,o,s=n(15671),u=n(43144),l=n(81949),c=n(71353),d=n(46208),h=function(){function e(){(0,s.Z)(this,e),this.readChannels=d.uz.RG,this.renderingStage=d.jL.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,c.c)(),this.isCameraPositionFinal=!0,this.parallax=new f,this.parallaxNew=new f,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:i.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:r.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:a.FINISHED,factor:-1}}return(0,u.Z)(e,[{key:"isFading",get:function(){return this.fadeInOut.stage===i.FADE_OUT||this.fadeInOut.stage===i.FADE_IN||this.fadeIn.stage===r.FADE_IN||this.fadeInOutHeight.stage!==a.FINISHED||this.renderingStage===d.jL.FADING_TEXTURE_CHANNELS}}]),e}();(o=r||(r={}))[o.FINISHED=0]="FINISHED",o[o.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",o[o.FADE_IN=2]="FADE_IN",function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(i||(i={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(a||(a={}));var f=(0,u.Z)((function e(){(0,s.Z)(this,e),this.anchorPointClouds=(0,c.c)(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=(0,l.c)()}))},46208:function(e,t,n){n.d(t,{Ck:function(){return s},WU:function(){return u},jL:function(){return r},uz:function(){return i}});var r,i,a,o=n(92026);function s(e){return(0,o.pC)(e)&&(0,o.pC)(e.cubeMap)}function u(e){return(0,o.pC)(e)&&!e.running}(a=r||(r={}))[a.RENDERING=0]="RENDERING",a[a.FINISHED_RENDERING=1]="FINISHED_RENDERING",a[a.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",a[a.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",a[a.FINISHED=4]="FINISHED",function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(i||(i={}))},78935:function(e,t,n){n.d(t,{o:function(){return u}});var r=n(15671),i=n(43144),a=n(92026),o=n(88152),s=n(8821),u=function(){function e(){(0,r.Z)(this,e),this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}return(0,i.Z)(e,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(e){this._unit=e,this._metersPerElevationInfoUnit=(0,o.Z7)(e)}},{key:"requiresSampledElevationInfo",get:function(){return"absolute-height"!==this.mode}},{key:"reset",value:function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}},{key:"offsetMeters",set:function(e){this._meterUnitOffset=e,this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}},{key:"addOffsetRenderUnits",value:function(e){this._renderUnitOffset+=e}},{key:"geometryZWithOffset",value:function(e,t){var n=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?n:e+n}},{key:"calculateOffsetRenderUnits",value:function(e){var t=this._meterUnitOffset,n=this.featureExpressionInfoContext;return null!=n&&(t+=(0,s.ht)(n)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}},{key:"setFromElevationInfo",value:function(e){this.mode=e.mode,this.unit=(0,o.lt)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=(0,a.Pt)(e.offset,0)}},{key:"updateFeatureExpressionInfoContext",value:function(e,t,n){if((0,a.Wi)(e))this._featureExpressionInfoContext=null;else{var r=e&&e.arcade;r&&(0,a.pC)(t)&&(0,a.pC)(n)?(this._featureExpressionInfoContext=(0,s.d9)(e),(0,s.aO)(this._featureExpressionInfoContext,(0,s.Tz)(r.modules,t,n))):this._featureExpressionInfoContext=e}}}],[{key:"fromElevationInfo",value:function(t){var n=new e;return(0,a.pC)(t)&&n.setFromElevationInfo(t),n}}]),e}()},69691:function(e,t,n){n.d(t,{B5:function(){return y},GC:function(){return g},Lm:function(){return x},Xf:function(){return m},bD:function(){return _},lO:function(){return T},qZ:function(){return p},rR:function(){return f},w7:function(){return v}});var r=n(43144),i=n(15671),a=n(92026),o=n(14226),s=n(81949),u=n(71353),l=n(79803),c=n(81020),d=n(96387),h=n(77648);function f(e,t,n,r,i,a,o,s,u,c,d){var h,f,p=S[d.mode],v=0;if((0,l.CM)(e,t,n,r,u.spatialReference,i,s))return p.requiresAlignment(d)?(v=p.applyElevationAlignmentBuffer(r,i,a,o,s,u,c,d),h=a,f=o):(h=r,f=i),(0,l.CM)(h,u.spatialReference,f,a,c.spatialReference,o,s)?v:void 0}function p(e,t,n,r,i){var o=((0,c.f)(e)?e.z:(0,h.Fb)(e)?e.array[e.offset+2]:e[2])||0;switch(n.mode){case"on-the-ground":var s=(0,a.Pt)((0,h.KO)(t,e,"ground"),0);return i.verticalDistanceToGround=0,i.sampledElevation=s,void(i.z=s);case"relative-to-ground":var u=(0,a.Pt)((0,h.KO)(t,e,"ground"),0),l=n.geometryZWithOffset(o,r);return i.verticalDistanceToGround=l,i.sampledElevation=u,void(i.z=l+u);case"relative-to-scene":var d=(0,a.Pt)((0,h.KO)(t,e,"scene"),0),f=n.geometryZWithOffset(o,r);return i.verticalDistanceToGround=f,i.sampledElevation=d,void(i.z=f+d);case"absolute-height":var p=n.geometryZWithOffset(o,r),v=(0,a.Pt)((0,h.KO)(t,e,"ground"),0);return i.verticalDistanceToGround=p-v,i.sampledElevation=v,void(i.z=p);default:return void(i.z=0)}}function v(e,t,n,r){return p(e,t,n,r,w),w.z}function g(e,t,n){return null==t||null==n?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?T.UPDATE:e.onTheGroundChanged}function m(e){return"relative-to-ground"===e||"relative-to-scene"===e}function y(e){return"absolute-height"!==e}function _(e,t,n,r,i){p(t,n,i,r,w),(0,d.CV)(e,w.verticalDistanceToGround);var a=w.sampledElevation,s=(0,o.c)(O,e.transformation);return b[0]=t.x,b[1]=t.y,b[2]=w.z,(0,l.Bm)(t.spatialReference,b,s,r.spatialReference)?e.transformation=s:console.warn("Could not locate symbol object properly, it might be misplaced"),a}var T,x=(0,r.Z)((function e(){(0,i.Z)(this,e),this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}));!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(T||(T={}));var S={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a,o,s){var u=s.calculateOffsetRenderUnits(o),l=s.featureExpressionInfoContext;t*=3,r*=3;for(var c=0;c<i;++c){var d=e[t+0],h=e[t+1],f=e[t+2];n[r+0]=d,n[r+1]=h,n[r+2]=null==l?f+u:u,t+=3,r+=3}return 0},requiresAlignment:function(e){var t=e.meterUnitOffset,n=e.featureExpressionInfoContext;return 0!==t||null!=n}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o){var s=0,u=o.spatialReference;t*=3,r*=3;for(var l=0;l<i;++l){var c=e[t+0],d=e[t+1],h=e[t+2],f=(0,a.Pt)(o.getElevation(c,d,h,u,"ground"),0);s+=f,n[r+0]=c,n[r+1]=d,n[r+2]=f,t+=3,r+=3}return s/i},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o,s,u){var l=0,c=u.calculateOffsetRenderUnits(s),d=u.featureExpressionInfoContext,h=o.spatialReference;t*=3,r*=3;for(var f=0;f<i;++f){var p=e[t+0],v=e[t+1],g=e[t+2],m=(0,a.Pt)(o.getElevation(p,v,g,h,"ground"),0);l+=m,n[r+0]=p,n[r+1]=v,n[r+2]=null==d?g+m+c:m+c,t+=3,r+=3}return l/i},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o,s,u){var l=0,c=u.calculateOffsetRenderUnits(s),d=u.featureExpressionInfoContext,h=o.spatialReference;t*=3,r*=3;for(var f=0;f<i;++f){var p=e[t+0],v=e[t+1],g=e[t+2],m=(0,a.Pt)(o.getElevation(p,v,g,h,"scene"),0);l+=m,n[r+0]=p,n[r+1]=v,n[r+2]=null==d?g+m+c:m+c,t+=3,r+=3}return l/i},requiresAlignment:function(){return!0}}},O=(0,s.c)(),w=new x,b=(0,u.c)()},8821:function(e,t,n){n.d(t,{O$:function(){return y},Tz:function(){return p},WI:function(){return m},aO:function(){return v},bw:function(){return d},d9:function(){return c},ht:function(){return g},kr:function(){return h}});var r=n(74165),i=n(15861),a=n(32718),o=n(66978),s=n(37818),u=n(819),l=a.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function c(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function d(e){var t=e&&e.expression;if("string"==typeof t){var n=T(t);if(null!=n)return{cachedResult:n}}return null}function h(e,t,n,r){return f.apply(this,arguments)}function f(){return f=(0,i.Z)((0,r.Z)().mark((function e(t,n,i,a){var s,l,c,d,h;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof(s=t&&t.expression)){e.next=3;break}return e.abrupt("return",null);case 3:if(null==(l=T(s))){e.next=6;break}return e.abrupt("return",{cachedResult:l});case 6:return e.next=8,(0,u.LC)();case 8:return c=e.sent,(0,o.k_)(i),d=c.arcadeUtils,h=d.createSyntaxTree(s),e.abrupt("return",d.dependsOnView(h)?(null!=a&&a.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:d.createFunction(h),context:d.createExecContext(null,{sr:n}),modules:c}});case 12:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function p(e,t,n){return e.arcadeUtils.createFeature(t.attributes,t.geometry,n)}function v(e,t){if(null!=e&&!_(e)){if(!t||!e.arcade)return void l.errorOncePerTick("Arcade support required but not provided");var n=t;n._geometry&&(n._geometry=(0,s.kB)(n._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function g(e){if(null!=e){if(_(e))return e.cachedResult;var t=e.arcade,n=null===t||void 0===t?void 0:t.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0}function m(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e&&e.featureExpressionInfo,i=r&&r.expression;return n||"0"===i||(r=null),null!==(t=r)&&void 0!==t?t:null}var y={cachedResult:0};function _(e){return null!=e.cachedResult}function T(e){return"0"===e?0:null}},96387:function(e,t,n){n.d(t,{$o:function(){return b},CV:function(){return O},Go:function(){return S},Si:function(){return P},Uu:function(){return w},ZL:function(){return R},_Z:function(){return E},bD:function(){return C},bh:function(){return A},zE:function(){return _}});var r=n(37762),i=n(92026),a=n(68860),o=n(14226),s=n(81949),u=n(71353),l=n(90045),c=n(67077),d=n(79803),h=n(41414),f=n(65156),p=n(4954),v=n(69662),g=n(65618),m=n(37818),y=n(4760);function _(e,t){if("point"===e.type)return x(e,t,!1);if((0,m.Ou)(e))switch(e.type){case"extent":return x(e.center,t,!1);case"polygon":return x(e.centroid,t,!1);case"polyline":return x(T(e),t,!0);case"mesh":return x(e.origin,t,!1)}else switch(e.type){case"extent":return x(function(e){return(0,g.Tx)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return x(function(e){var t=e.rings[0];if(!t||0===t.length)return null;var n=(0,p.a)(e.rings,!!e.hasZ);return(0,g.Tx)(n[0],n[1],n[2],e.spatialReference)}(e),t,!0);case"polyline":return x(T(e),t,!0)}}function T(e){var t=e.paths[0];if(!t||0===t.length)return null;var n=(0,v.n8)(t,(0,v.ok)(t)/2);return(0,g.Tx)(n[0],n[1],n[2],e.spatialReference)}function x(e,t,n){var r=n?e:(0,m.WG)(e);return t&&e?(0,d.nF)(e,r,t)?r:null:r}function S(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e){t||(t=(0,f.Ue)());var i=e,a=.5*i.width*(n-1),o=.5*i.height*(n-1);return i.width<1e-7*i.height?a+=o/20:i.height<1e-7*i.width&&(o+=a/20),(0,l.s)(t,i.xmin-a-r,i.ymin-o-r,i.xmax+a+r,i.ymax+o+r),t}return null}function O(e,t){for(var n=0;n<e.geometries.length;++n){var r=e.geometries[n].getMutableAttribute(y.T.AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometries[n]))}}function w(e,t){var n=(0,c.d)(c.O);return(0,i.pC)(e)&&(n[0]=e[0],n[1]=e[1],n[2]=e[2]),(0,i.pC)(t)?n[3]=t:(0,i.pC)(e)&&e.length>3&&(n[3]=e[3]),n}function b(e,t,n,r,a){for(var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[0,0,0,0],s=0;s<3;++s)(0,i.pC)(e)&&null!=e[s]?o[s]=e[s]:(0,i.pC)(n)&&null!=n[s]?o[s]=n[s]:o[s]=a[s];return(0,i.pC)(t)?o[3]=t:(0,i.pC)(r)?o[3]=r:o[3]=a[3],o}function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.O,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=new Array(3);if((0,i.Wi)(t)||(0,i.Wi)(n))a[0]=1,a[1]=1,a[2]=1;else{for(var o,s=0,l=2;l>=0;l--){var c=e[l],d=void 0,h=null!=c,f=0===l&&!o&&!h,p=n[l];"symbol-value"===c||f?d=0!==p?t[l]/p:1:h&&"proportional"!==c&&isFinite(c)&&(d=0!==p?c/p:1),null!=d&&(a[l]=d,o=d,s=Math.max(s,Math.abs(d)))}for(var v=2;v>=0;v--)null==a[v]?a[v]=o:0===a[v]&&(a[v]=.001*s)}for(var g=2;g>=0;g--)a[g]/=r;return(0,u.d)(a)}function A(e){return R(function(e){return null!=e.isPrimitive}(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function R(e){if(Array.isArray(e)){var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){if(!R(t.value))return!1}}catch(i){n.e(i)}finally{n.f()}return!0}return null==e||e>=0}function E(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,s.c)(),i=e||0,a=t||0,u=n||0;return 0!==i&&(0,o.o)(r,r,-i/180*Math.PI),0!==a&&(0,o.r)(r,r,a/180*Math.PI),0!==u&&(0,o.n)(r,r,u/180*Math.PI),r}function P(e,t,n){if(null!=n.minDemResolution)return n.minDemResolution;var r=(0,a.c9)(t),i=(0,h.bf)(e)*r,o=(0,h.Ye)(e)*r,s=(0,h.Cb)(e)*(t.isGeographic?1:r);return 0===i&&0===o&&0===s?n.minDemResolutionForPoints:.01*Math.max(i,o,s)}},26279:function(e,t,n){var r,i,a;n.d(t,{Lw:function(){return r},al:function(){return a},eZ:function(){return i}}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(r||(r={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(i||(i={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(a||(a={}))},77648:function(e,t,n){n.d(t,{Fb:function(){return u},KO:function(){return l},sb:function(){return s}});var r=n(43144),i=n(15671),a=n(92026),o=n(81020),s=(0,r.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,i.Z)(this,e),this.array=t,this.spatialReference=n,this.offset=r}));function u(e){return"array"in e}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if((0,o.f)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,n);if(u(t)){var r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,(0,a.Pt)(t.spatialReference,e.spatialReference),n)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,n)}},50256:function(e,t,n){n.d(t,{K:function(){return a}});var r=n(8548),i=n(61109);function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.stride;return e.fieldNames.filter((function(t){var n=e.fields.get(t).optional;return!(n&&n.glPadding)})).map((function(r){var a=e.fields.get(r),s=a.constructor.ElementCount,u=o(a.constructor.ElementType),l=a.offset,c=!(!a.optional||!a.optional.glNormalized);return new i.G(r,s,u,l,n,c,t)}))}function o(e){var t=s[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}var s={u8:r.g.UNSIGNED_BYTE,u16:r.g.UNSIGNED_SHORT,u32:r.g.UNSIGNED_INT,i8:r.g.BYTE,i16:r.g.SHORT,i32:r.g.INT,f32:r.g.FLOAT}},94463:function(e,t,n){n.d(t,{Z:function(){return h}});var r=n(43144),i=n(15671),a=n(60136),o=n(92572),s=n(27366),u=n(85015),l=n(49861),c=(n(25243),n(63780),n(69912)),d=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,e.DECONFLICTOR_SHOW_VISIBLE=!1,e.DECONFLICTOR_SHOW_INVISIBLE=!1,e.DECONFLICTOR_SHOW_GRID=!1,e.LABELS_SHOW_BORDER=!1,e.TEXT_SHOW_BASELINE=!1,e.TEXT_SHOW_BORDER=!1,e.OVERLAY_DRAW_DEBUG_TEXTURE=!1,e.OVERLAY_SHOW_CENTER=!1,e.SHOW_POI=!1,e.TESTS_DISABLE_OPTIMIZATIONS=!1,e.TESTS_DISABLE_FAST_UPDATES=!1,e.DRAW_MESH_GEOMETRY_NORMALS=!1,e.FEATURE_TILE_FETCH_SHOW_TILES=!1,e.FEATURE_TILE_TREE_SHOW_TILES=!1,e.TERRAIN_TILE_TREE_SHOW_TILES=!1,e.I3S_TREE_SHOW_TILES=!1,e.I3S_SHOW_MODIFICATIONS=!1,e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,e.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,e.LINE_WIREFRAMES=!1,e.TERRAIN_USE_LEGACY_SHADING=!1,e}return(0,r.Z)(n)}(u.Z);(0,s._)([(0,l.Cb)()],d.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"LABELS_SHOW_BORDER",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"TEXT_SHOW_BASELINE",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"TEXT_SHOW_BORDER",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"SHOW_POI",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"LINE_WIREFRAMES",void 0),(0,s._)([(0,l.Cb)()],d.prototype,"TERRAIN_USE_LEGACY_SHADING",void 0);var h=new(d=(0,s._)([(0,c.j)("esri.views.3d.support.DebugFlags")],d))},79685:function(e,t,n){n.d(t,{Y:function(){return m},c:function(){return R}});var r=n(92026),i=n(88396),a=n(11186),o=n(71353),s=n(67077),u=n(83448),l=n(79803),c=n(50951),d=n(91526),h=n(79100),f=n(88699),p=n(73840),v=n(40779),g=n(4760);function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=[],i=[],a=t.mapPositions;y(t,i,r);var o=i[0][1].data,s=r[0][1].length,u=new Array(s).fill(0);return _(t,i,r,u),S(t,i,r,u),T(t,i,r,u),x(t,i,r,u),O(t,i,r,u),w(t,i,r,u),b(t,i,r,o),new v.Z(e,i,r,a,h.U.Line,n)}function y(e,t,n){for(var r=e.attributeData.position,i=e.removeDuplicateStartEnd,a=function(e){var t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(r)&&i,o=r.length/3-(a?1:0),s=new Array(2*(o-1)),u=a?r.slice(0,r.length-3):r,l=0,c=0;c<o-1;c++)s[l++]=c,s[l++]=c+1;t.push([g.T.POSITION,new d.a(u,3,a)]),n.push([g.T.POSITION,s])}function _(e,t,n,i){if(!(0,r.pC)(e.attributeData.colorFeature)){var a=e.attributeData.color;t.push([g.T.COLOR,new d.a((0,r.Pt)(a,s.O),4)]),n.push([g.T.COLOR,i])}}function T(e,t,n,i){if((0,r.pC)(e.attributeData.normal)){var a=e.attributeData.normal;t.push([g.T.NORMAL,new d.a(a,3)]),n.push([g.T.NORMAL,i])}}function x(e,t,n,i){var a=e.attributeData.colorFeature;(0,r.Wi)(a)||(t.push([g.T.COLORFEATUREATTRIBUTE,new d.a([a],1,!0)]),n.push([g.T.COLOR,i]))}function S(e,t,n,i){if(!(0,r.pC)(e.attributeData.sizeFeature)){var a=e.attributeData.size;t.push([g.T.SIZE,new d.a([(0,r.Pt)(a,1)],1,!0)]),n.push([g.T.SIZE,i])}}function O(e,t,n,i){var a=e.attributeData.sizeFeature;(0,r.Wi)(a)||(t.push([g.T.SIZEFEATUREATTRIBUTE,new d.a([a],1,!0)]),n.push([g.T.SIZEFEATUREATTRIBUTE,i]))}function w(e,t,n,i){var a=e.attributeData.opacityFeature;(0,r.Wi)(a)||(t.push([g.T.OPACITYFEATUREATTRIBUTE,new d.a([a],1,!0)]),n.push([g.T.OPACITYFEATUREATTRIBUTE,i]))}function b(e,t,n,o){if(!(0,r.Wi)(e.overlayInfo)&&e.overlayInfo.renderCoordsHelper.viewingMode===c.JY.Global&&e.overlayInfo.spatialReference.isGeographic){for(var s=(0,f.bg)(o.length),h=(0,u.Iu)(e.overlayInfo.spatialReference),v=0;v<s.length;v+=3)(0,l.gH)(o,v,s,v,h);var m=o.length/3,y=(0,p.xx)(m+1),_=C,T=A,x=0,S=0;(0,a.s)(_,s[S++],s[S++],s[S++]),y[0]=0;for(var O=1;O<m+1;++O){var w;O===m&&(S=0),(0,a.s)(T,s[S++],s[S++],s[S++]),x+=(0,i.p)(_,T),y[O]=x,_=(w=[T,_])[0],T=w[1]}t.push([g.T.DISTANCETOSTART,new d.a(y,1,!0)]),n.push([g.T.DISTANCETOSTART,n[0][1]])}}var C=(0,o.c)(),A=(0,o.c)();function R(e,t){if((0,r.Wi)(e)||0===e.length)return[];var n=[];return e.forEach((function(e){var r=e.length,i=(0,f.bg)(3*r);e.forEach((function(e,t){i[3*t+0]=e[0],i[3*t+1]=e[1],i[3*t+2]=e[2]}));var a={attributeData:{position:i,normal:t},removeDuplicateStartEnd:!1};n.push(a)})),n}},2522:function(e,t,n){n.d(t,{Ch:function(){return a},Hl:function(){return u},_Z:function(){return s},uM:function(){return l},vT:function(){return i}});var r=n(67794),i=64,a=i/2,o=a/5,s=i/o,u=.25;function l(e,t){return e.fromData("".concat(t,"-marker"),(function(){return(0,r.cU)(t,i,a,o)}))}},67794:function(e,t,n){n.d(t,{Ns:function(){return s},Ph:function(){return o},cU:function(){return u}});n(93169);var r=n(46228),i=n(1487),a=n(8548),o=128,s=.5;function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=l(e,t,n,r);return new i.x(u,{mipmap:!1,wrap:{s:a.e8.CLAMP_TO_EDGE,t:a.e8.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;switch(e){case"circle":default:return c(t,n);case"square":return d(t,n);case"cross":return f(t,n,r);case"x":return p(t,n,r);case"kite":return h(t,n);case"triangle":return v(t,n);case"arrow":return g(t,n)}}function c(e,t){var n=e/2-.5;return x(e,_(n,n,t/2))}function d(e,t){return m(e,t,!1)}function h(e,t){return m(e,t,!0)}function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return y(e,t,!1,n)}function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return y(e,t,!0,n)}function v(e,t){return x(e,T(e/2,t,t/2))}function g(e,t){var n=t,r=t/2,i=e/2,a=.8*n,o=_(i,(e-t)/2-a,Math.sqrt(a*a+r*r)),s=T(i,n,r);return x(e,(function(e,t){return Math.max(s(e,t),-o(e,t))}))}function m(e,t,n){return n&&(t/=Math.SQRT2),x(e,(function(r,i){var a=r-.5*e+.25,o=.5*e-i-.75;if(n){var s=(a+o)/Math.SQRT2;o=(o-a)/Math.SQRT2,a=s}return Math.max(Math.abs(a),Math.abs(o))-.5*t}))}function y(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t-=r,n&&(t*=Math.SQRT2);var i=.5*t;return x(e,(function(t,a){var o,s=t-.5*e,u=.5*e-a-1;if(n){var l=(s+u)/Math.SQRT2;u=(u-s)/Math.SQRT2,s=l}return o=(s=Math.abs(s))>(u=Math.abs(u))?s>i?Math.sqrt((s-i)*(s-i)+u*u):u:u>i?Math.sqrt(s*s+(u-i)*(u-i)):s,o-=r/2}))}function _(e,t,n){return function(r,i){var a=r-e,o=i-t;return Math.sqrt(a*a+o*o)-n}}function T(e,t,n){var r=Math.sqrt(t*t+n*n);return function(i,a){var o=Math.abs(i-e)-n,s=a-e+t/2+.75,u=(t*o+n*s)/r,l=-s;return Math.max(u,l)}}function x(e,t){for(var n=new Uint8Array(4*e*e),i=0;i<e;i++)for(var a=0;a<e;a++){var o=a+e*i,s=t(a,i);s=s/e+.5,(0,r.I)(s,n,4*o)}return n}},78081:function(e,t,n){n.d(t,{V:function(){return c},r:function(){return d}});var r=n(37762),i=n(92026),a=n(79803),o=n(91320),s=n(69691),u=n(19384),l=n(88699);function c(e,t,n,r){var i="polygon"===e.type?o.ZI.CCW_IS_HOLE:o.ZI.NONE,a="polygon"===e.type?e.rings:e.paths,u=(0,o.Mk)(a,!!e.hasZ,i),c=u.position,d=u.outlines,f=(0,l.bg)(c.length),p=(0,s.rR)(c,e.spatialReference,0,f,0,c,0,c.length/3,t,n,r),v=null!=p;return{lines:v?h(d,c,f):[],projectionSuccess:v,sampledElevation:p}}function d(e,t){for(var n="polygon"===e.type?o.ZI.CCW_IS_HOLE:o.ZI.NONE,r="polygon"===e.type?e.rings:e.paths,i=(0,o.Mk)(r,!1,n),s=i.position,l=i.outlines,c=(0,a.CM)(s,e.spatialReference,0,s,t,0,s.length/3),d=2;d<s.length;d+=3)s[d]=u.Rn;return{lines:c?h(l,s):[],projectionSuccess:c}}function h(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=new Array,s=(0,r.Z)(e);try{for(s.s();!(n=s.n()).done;){var u=n.value,c=u.index,d=u.count;if(!(d<=1)){var h=3*c,f=3*d;o.push({position:(0,l.Rq)(t,3*c,3*d),mapPositions:(0,i.pC)(a)?(0,l.Rq)(a,h,f):void 0})}}}catch(p){s.e(p)}finally{s.f()}return o}},43449:function(e,t,n){n.d(t,{T6:function(){return d},TX:function(){return c},j9:function(){return h}});var r=n(43144),i=n(15671),a=n(60136),o=n(92572),s=n(54463),u=n(55848),l=n(22178);function c(e){return(0,l.nn)(e)&&e.intersector===s.q7.TERRAIN&&!!e.target}var d=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a){var o;return(0,i.Z)(this,n),(o=t.call(this,e,r)).triangleNr=a,o}return(0,r.Z)(n)}(u.Dx);function h(e){return(0,l.nn)(e)&&e.intersector===s.q7.OVERLAY&&!!e.target}},1883:function(e,t,n){n.d(t,{$:function(){return r},a:function(){return d}});var r,i=n(37762),a=n(15671),o=n(43144),s=n(65156),u=n(54134),l=n(68401),c=n(61403);!function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded",e[e.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"}(r||(r={}));var d=function(){function e(t,n){(0,a.Z)(this,e),this.index=t,this.renderTargets=n,this._extent=(0,s.Ue)(),this.resolution=0,this.renderLocalOrigin=(0,c.a)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new h,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(n.renderTargets.length).fill(!1)}return(0,o.Z)(e,[{key:"extent",get:function(){return this._extent}},{key:"getValidTexture",value:function(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}},{key:"_needsColorWithoutRasterImage",get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}},{key:"getColorTexture",value:function(e){var t=e===r.ColorAndWater?this.renderTargets.getTarget(u.NH.Color):e===r.Highlight?this.renderTargets.getTarget(u.NH.Highlight):e===r.ObjectAndLayerIdColor?this.renderTargets.getTarget(u.NH.ObjectAndLayerIdColor):this.renderTargets.getTarget(u.NH.Occluded);return t?t.getTexture():null}},{key:"getColorTextureNoRasterImage",value:function(){return this._needsColorWithoutRasterImage?this.getValidTexture(u.NH.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(u.NH.Color):null}},{key:"getNormalTexture",value:function(e){var t=e===r.ColorAndWater?this.renderTargets.getTarget(u.NH.Water):null;return t?t.getTexture():null}},{key:"draw",value:function(e,t){var n,r=this.computeRenderTargetValidityBitfield(),a=(0,i.Z)(this.renderTargets.renderTargets);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.type!==u.NH.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[o.type]=e.drawTarget(this,o,t):this.validTargets[o.type]=!1}}catch(s){a.e(s)}finally{a.f()}return r^this.computeRenderTargetValidityBitfield()?l.Yg.CHANGED:l.Yg.UNCHANGED}},{key:"computeRenderTargetValidityBitfield",value:function(){var e=this.validTargets;return+e[u.NH.Color]|+e[u.NH.ColorNoRasterImage]<<1|+e[u.NH.Highlight]<<2|+e[u.NH.Water]<<3|+e[u.NH.Occluded]<<4}},{key:"setupGeometryViewsCyclical",value:function(e){this.setupGeometryViewsDirect();var t=.001*e.range;if(this._extent[0]-t<=e.min){var n=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,s.cv)(this._extent,e.range,0,n)}if(this._extent[2]+t>=e.max){var r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,s.cv)(this._extent,-e.range,0,r)}}},{key:"setupGeometryViewsDirect",value:function(){this.canvasGeometries.numViews=1,(0,s.JG)(this.canvasGeometries.extents[0],this._extent)}},{key:"hasSomeSizedView",value:function(){for(var e=0;e<this.canvasGeometries.numViews;e++){var t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}},{key:"applyViewport",value:function(e){e.setViewport(this.index===u.fu.INNER?0:this.resolution,0,this.resolution,this.resolution)}}]),e}(),h=(0,o.Z)((function e(){(0,a.Z)(this,e),this.extents=[(0,s.Ue)(),(0,s.Ue)(),(0,s.Ue)()],this.numViews=0}))},19384:function(e,t,n){n.d(t,{Rn:function(){return ce},CB:function(){return se},Qi:function(){return de}});var r=n(74165),i=n(15861),a=n(29439),o=n(37762),s=n(1413),u=n(15671),l=n(43144),c=n(60136),d=n(92572),h=n(27366),f=n(85015),p=n(91505),v=n(100),g=n(77427),m=n(92026),y=n(27546),_=n(94172),T=n(92377),x=n(49861),S=(n(25243),n(63780),n(69912)),O=n(14226),w=n(11186),b=n(71353),C=n(50951),A=n(26279),R=n(94463),E=n(54134),P=n(1883),I=n(15245),D=n(8548),M=n(53634),N=function(){function e(t,n){(0,u.Z)(this,e),this._size=(0,I.c)(),this._fbo=null,this._fbo=new M.X(t,{colorTarget:D.Lm.TEXTURE,depthStencilTarget:D.OU.NONE},{target:D.No.TEXTURE_2D,pixelFormat:D.VI.RGBA,dataType:D.Br.UNSIGNED_BYTE,wrapMode:D.e8.CLAMP_TO_EDGE,samplingMode:D.cw.LINEAR_MIPMAP_LINEAR,hasMipmap:n,maxAnisotropy:8,width:0,height:0})}return(0,l.Z)(e,[{key:"dispose",value:function(){this._fbo=(0,m.M2)(this._fbo)}},{key:"getTexture",value:function(){return this._fbo?this._fbo.colorTexture:null}},{key:"isValid",value:function(){return null!==this._fbo}},{key:"resize",value:function(e,t){this._size[0]=e,this._size[1]=t,this._fbo.resize(this._size[0],this._size[1])}},{key:"bind",value:function(e){e.bindFramebuffer(this._fbo)}},{key:"generateMipMap",value:function(){var e=this._fbo.colorTexture;e.descriptor.hasMipmap&&e.generateMipmap()}},{key:"disposeRenderTargetMemory",value:function(){var e;null===(e=this._fbo)||void 0===e||e.resize(0,0)}},{key:"gpuMemoryUsage",get:function(){var e,t;return null!==(e=null===(t=this._fbo)||void 0===t?void 0:t.gpuMemoryUsage)&&void 0!==e?e:0}}]),e}(),Z=n(93169),L=n(37081),k=(0,l.Z)((function e(t,n,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];(0,u.Z)(this,e),this.output=n,this.type=r,this.valid=!1,this.lastUsed=1/0,this.fbo=new N(t,i)})),H=function(){function e(t){(0,u.Z)(this,e),this.renderTargets=[new k(t,L.H.Color,E.NH.Color),new k(t,L.H.Color,E.NH.ColorNoRasterImage),new k(t,L.H.Highlight,E.NH.Highlight,!1),new k(t,L.H.Normal,E.NH.Water),new k(t,L.H.Color,E.NH.Occluded)],(0,Z.Z)("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new k(t,L.H.ObjectAndLayerIdColor,E.NH.ObjectAndLayerIdColor))}return(0,l.Z)(e,[{key:"getTarget",value:function(e){return this.renderTargets[e].fbo}},{key:"dispose",value:function(){var e,t=(0,o.Z)(this.renderTargets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.dispose()}}catch(n){t.e(n)}finally{t.f()}}},{key:"disposeRenderTargetMemory",value:function(){var e,t=(0,o.Z)(this.renderTargets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.disposeRenderTargetMemory()}}catch(n){t.e(n)}finally{t.f()}}},{key:"validateUsageForTarget",value:function(e,t,n){if(e)t.lastUsed=n;else if(n-t.lastUsed>F)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}},{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((function(e,t){return e+t.fbo.gpuMemoryUsage}),0)}}]),e}(),F=1e3,z=n(61863),U=n(51992),j=n(86755),V=n(53252),W=n(20684),B=n(19962),G=n(56529),q=n(46293),J=n(93822),Y=n(471),X=n(81341),$=n(71568),K=n(5195),Q=n(25049),ee=n(25920),te=n(78485),ne=n(11954),re=n(82031),ie=n(93463),ae=n(371),oe=n(3384),se=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e))._overlays=null,r._overlayRenderTarget=null,r._hasHighlights=!1,r._rendersOccluded=!1,r._hasWater=!1,r._handles=new v.Z,r._renderers=new Map,r._sortedDrapeSourceRenderersDirty=!1,r._sortedRenderers=new y.Z,r._passParameters=new z.T,r._rctx=null,r._materialRepository=null,r._screenToWorldRatio=1,r._localOriginFactory=null,r._camera=new j.V,r.worldToPCSRatio=1,r.events=new p.Z,r.longitudeCyclical=null,r}return(0,l.Z)(n,[{key:"_bindParameters",get:function(){return this._renderContext.bindParameters}},{key:"rctx",get:function(){return this._rctx}},{key:"materialRepository",get:function(){return this._materialRepository}},{key:"screenToWorldRatio",get:function(){return this._screenToWorldRatio}},{key:"localOriginFactory",get:function(){return this._localOriginFactory}},{key:"initialize",value:function(){var e=this,t=this.view._stage.renderView;this._rctx=t.renderingContext;var n=t.waterTextureRepository;this._stippleTextureRepository=new re.h0(t.renderingContext),this._shaderTechniqueRepository=new U.M({rctx:this._rctx,viewingMode:C.JY.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:n}),this._renderContext=new q.Y(this._rctx,new Y.l(this._rctx,this.view.state.viewingMode),new $.L(this.view,this._shaderTechniqueRepository,this._rctx,(function(){}))),this._handles.add([(0,_.YP)((function(){return n.updating}),(function(){return e.events.emit("content-changed")}),_.tX),(0,_.YP)((function(){return e.spatialReference}),(function(t){return e._localOriginFactory=new B.C(t)}),_.tX),(0,_.on)((function(){return e.view.allLayerViews}),"after-changes",(function(){return e._sortedDrapeSourceRenderersDirty=!0}))]),this._materialRepository=new V.h(t.textureRepository,this._shaderTechniqueRepository,(function(t){(t.renderOccluded&de)>0!==e._rendersOccluded&&e._updateRendersOccluded(),e.events.emit("content-changed"),e.notifyChange("updating"),e.notifyChange("isEmpty")}),(function(){return e.events.emit("content-changed")})),this._bindParameters.slot=J.r.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=(0,W.hf)(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=ee.A.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new ne.Mi((0,b.f)(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(ie.T8.STAGE,this))}},{key:"destroy",value:function(){this._handles.destroy(),this._renderers.forEach((function(e){return e.destroy()})),this._renderers.clear(),this._debugTextureTechnique=(0,m.RY)(this._debugTextureTechnique),this._passParameters.texture=(0,m.M2)(this._passParameters.texture),this._bindParameters.highlightDepthTexture=(0,m.M2)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=(0,m.SC)(this._shaderTechniqueRepository),this._temporaryFBO=(0,m.M2)(this._temporaryFBO),this._quadVAO=(0,m.M2)(this._quadVAO),this.disposeOverlays()}},{key:"updating",get:function(){return this._sortedDrapeSourceRenderersDirty||(0,g.oE)(this._renderers,(function(e){return e.updating}))}},{key:"hasOverlays",get:function(){return(0,m.pC)(this._overlays)&&(0,m.pC)(this._overlayRenderTarget)}},{key:"gpuMemoryUsage",get:function(){return(0,m.pC)(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"createGeometryDrapeSourceRenderer",value:function(e){return this.createDrapeSourceRenderer(e,X.S)}},{key:"createDrapeSourceRenderer",value:function(e,t,n){var r=this,i=this._renderers.get(e);(0,m.pC)(i)&&i.destroy();var a=new t((0,s.Z)((0,s.Z)({},n),{},{rendererContext:this,drapeSource:e}));return this._renderers.set(e,a),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add((0,_.YP)((function(){return e.fullOpacity}),(function(){return r.events.emit("content-changed")})),e),a}},{key:"removeDrapeSourceRenderer",value:function(e){if(!(0,m.Wi)(e)){var t=this._renderers.get(e);(0,m.Wi)(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),t.destroy())}}},{key:"collectUnusedRenderTargetMemory",value:function(e){var t=!1;if((0,m.pC)(this._overlayRenderTarget)){var n,r=(0,o.Z)(this._overlayRenderTarget.renderTargets);try{for(r.s();!(n=r.n()).done;){var i=n.value,s=(0,a.Z)(this.overlays,2),u=s[0],l=s[1],c=u.validTargets[i.type]||!l.validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(c,i,e)||t}}catch(d){r.e(d)}finally{r.f()}}return t}},{key:"overlays",get:function(){return(0,m.Pt)(this._overlays,[])}},{key:"ensureDrapeTargets",value:function(e){(0,m.pC)(this._overlays)&&this._overlays.forEach((function(t){return t.hasTargetWithoutRasterImage=(0,T.f)(e,(function(e){return e.drapeTargetType===A.al.WithoutRasterImage}))}))}},{key:"ensureDrapeSources",value:function(e){(0,m.pC)(this._overlays)&&this._overlays.forEach((function(t){t.hasDrapedFeatureSource=(0,T.f)(e,(function(e){return e.drapeSourceType===A.Lw.Features})),t.hasDrapedRasterSource=(0,T.f)(e,(function(e){return e.drapeSourceType===A.Lw.RasterImage}))}))}},{key:"ensureOverlays",value:function(e,t){(0,m.Wi)(this._overlays)&&(this._overlayRenderTarget=new H(this._rctx),this._overlays=[new P.a(E.fu.INNER,this._overlayRenderTarget),new P.a(E.fu.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}},{key:"disposeOverlays",value:function(){this._overlays=null,this._overlayRenderTarget=(0,m.M2)(this._overlayRenderTarget),this.events.emit("textures-disposed")}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(e){this._processDrapeSources(e,(function(){return!0}))}},{key:"_processDrapeSources",value:function(e,t){var n,r=!1,i=(0,o.Z)(this._renderers);try{for(i.s();!(n=i.n()).done;){var s=(0,a.Z)(n.value,2),u=s[0],l=s[1];if(e.done)break;(u.destroyed||t(u))&&l.commitChanges()&&(r=!0,e.madeProgress())}}catch(c){i.e(c)}finally{i.f()}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&((0,m.pC)(this._overlays)&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}},{key:"processSyncDrapeSources",value:function(){this._processDrapeSources(ie.G5,(function(e){return e.updatePolicy===te.j.SYNC}))}},{key:"isEmpty",get:function(){return!R.Z.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,g.oE)(this._renderers,(function(e){return!e.isEmpty}))}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"updateAnimation",value:function(e){var t=!1;return this._renderers.forEach((function(n){return t=n.updateAnimation(e)||t})),t}},{key:"updateDrapeSourceOrder",value:function(){this._sortedDrapeSourceRenderersDirty=!0}},{key:"drawTarget",value:function(e,t,n){var r=this,i=e.canvasGeometries;if(0===i.numViews)return!1;this._screenToWorldRatio=n*e.mapUnitsPerPixel;var a=t.output;if(this.isEmpty||a===L.H.Highlight&&!this.hasHighlights||a===L.H.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;var o=t.fbo;if(!o.isValid())return!1;var s=2*e.resolution,u=e.resolution;o.resize(s,u);var l=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*n,this._renderContext.output=a,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===L.H.Normal?J.r.DRAPED_WATER:J.r.DRAPED_MATERIAL,e.applyViewport(this._rctx),o.bind(l),e.index===E.fu.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(D.lk.COLOR_BUFFER_BIT)),t.type===E.NH.Occluded&&(this._renderContext.renderOccludedMask=de),R.Z.OVERLAY_DRAW_DEBUG_TEXTURE&&t.type!==E.NH.Occluded)for(var c=0;c<i.numViews;c++)this._setViewParameters(i.extents[c],e),this._drawDebugTexture(e.resolution,le[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll((function(n){var c=n.drapeSource,d=n.renderer;if(t.type!==E.NH.ColorNoRasterImage||c.drapeSourceType!==A.Lw.RasterImage){var h=c.fullOpacity,f=(0,m.pC)(h)&&h<1&&a===L.H.Color;f&&(r.bindTemporaryFramebuffer(r._rctx,s,u),l.clearSafe(D.lk.COLOR_BUFFER_BIT));for(var p=0;p<i.numViews;p++)r._setViewParameters(i.extents[p],e),d.render(r._renderContext);f&&(0,m.pC)(r._temporaryFBO)&&(o.bind(l),r.view._stage.renderView.compositingHelper.compositeOverlay(r._renderContext.bindParameters,r._temporaryFBO.getTexture(),h,e.index))}})),l.bindFramebuffer(null),o.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}},{key:"bindTemporaryFramebuffer",value:function(e,t,n){(0,m.Wi)(this._temporaryFBO)&&(this._temporaryFBO=new N(e,!1)),this._temporaryFBO.resize(t,n),this._temporaryFBO.bind(e)}},{key:"reloadShaders",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._shaderTechniqueRepository.reloadAll();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifyContentChanged",value:function(){this.events.emit("content-changed")}},{key:"intersect",value:function(e,t,n,r){var i,a=0,s=(0,o.Z)(this._renderers.values());try{for(s.s();!(i=s.n()).done;){var u,l,c=i.value;a=null!==(u=null===(l=c.intersect)||void 0===l?void 0:l.call(c,e,t,n,r,a))&&void 0!==u?u:a}}catch(d){s.e(d)}finally{s.f()}}},{key:"_updateSortedDrapeSourceRenderers",value:function(){var e=this;if(this._sortedRenderers.clear(),0!==this._renderers.size){var t=this.view.map.allLayers;this._renderers.forEach((function(n,r){var i,a=t.indexOf(r.layer),o=a>=0,s=e._renderers.size*(null!==(i=r.renderGroup)&&void 0!==i?i:o?A.eZ.MapLayer:A.eZ.ViewLayer)+(o?a:0);e._sortedRenderers.push(new ue(r,n,s))})),this._sortedRenderers.sort((function(e,t){return e.index-t.index}))}}},{key:"_setViewParameters",value:function(e,t){var n=this._camera;n.viewport=[0,0,t.resolution,t.resolution],(0,O.x)(n.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],n.near,n.far),(0,O.f)(n.viewMatrix,[-e[0],-e[1],0])}},{key:"_updateHasWater",value:function(){var e=(0,g.oE)(this._renderers,(function(e){return e.hasWater}));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}},{key:"_updateHasHighlights",value:function(){var e=(0,g.oE)(this._renderers,(function(e){return e.hasHighlights}));e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}},{key:"_updateRendersOccluded",value:function(){var e=(0,g.oE)(this._renderers,(function(e){return e.rendersOccluded}));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}},{key:"_drawDebugTexture",value:function(e,t){this._ensureDebugPatternResources(e,e,t);var n=this._rctx;n.bindTechnique(this._debugTextureTechnique,this._passParameters,null),n.bindVAO(this._quadVAO),n.drawArrays(D.MX.TRIANGLE_STRIP,0,(0,oe._V)(this._quadVAO,"geometry"))}},{key:"_ensureDebugPatternResources",value:function(e,t,n){if((0,w.s)(this._passParameters.color,n[0],n[1],n[2]),!this._passParameters.texture){for(var r=new Uint8Array(e*t*4),i=0,a=0;a<t;a++)for(var o=0;o<e;o++){var s=Math.floor(o/10),u=Math.floor(a/10);s<2||u<2||10*s>e-20||10*u>t-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&s&&1&u?1&o^1&a?0:255:1&s^1&u?0:128)}this._passParameters.texture=new ae.x(this._rctx,{target:D.No.TEXTURE_2D,pixelFormat:D.VI.RGBA,dataType:D.Br.UNSIGNED_BYTE,samplingMode:D.cw.NEAREST,width:e,height:t},r);var l=new Q.V;l.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(K.K,l),this._quadVAO=(0,W.ow)(this._rctx)}}},{key:"test",get:function(){var e=this;return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:function(t){return e._renderers.get(t)}}}}]),n}(f.Z);(0,h._)([(0,x.Cb)()],se.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,h._)([(0,x.Cb)({autoDestroy:!0})],se.prototype,"_shaderTechniqueRepository",void 0),(0,h._)([(0,x.Cb)({autoDestroy:!0})],se.prototype,"_stippleTextureRepository",void 0),(0,h._)([(0,x.Cb)({constructOnly:!0})],se.prototype,"view",void 0),(0,h._)([(0,x.Cb)()],se.prototype,"worldToPCSRatio",void 0),(0,h._)([(0,x.Cb)()],se.prototype,"spatialReference",void 0),(0,h._)([(0,x.Cb)({type:Boolean,readOnly:!0})],se.prototype,"updating",null),(0,h._)([(0,x.Cb)()],se.prototype,"isEmpty",null),se=(0,h._)([(0,S.j)("esri.views.3d.terrain.OverlayRenderer")],se);var ue=(0,l.Z)((function e(t,n,r){(0,u.Z)(this,e),this.drapeSource=t,this.renderer=n,this.index=r})),le=[[1,.5,.5],[.5,.5,1]],ce=-2,de=G.yD.OccludeAndTransparent},54134:function(e,t,n){var r,i,a,o,s,u,l;n.d(t,{NH:function(){return s},Ns:function(){return u},VB:function(){return o},Xo:function(){return a},fu:function(){return r},ir:function(){return l},tk:function(){return i}}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(r||(r={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(i||(i={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(a||(a={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(o||(o={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(s||(s={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(u||(u={})),function(e){e[e.INSIDE=0]="INSIDE",e[e.INTERSECTS=1]="INTERSECTS",e[e.OUTSIDE=2]="OUTSIDE"}(l||(l={}))},48353:function(e,t,n){n.d(t,{U:function(){return m}});var r,i,a,o,s,u,l=n(30168),c=n(49450),d=n(59150),h=n(58406),f=n(699),p=n(98634),v=n(4760),g=n(65964);function m(e,t){var n=e.vertex;n.uniforms.add(new h.p("intrinsicWidth",(function(e){return e.width}))),t.vvSize?(e.attributes.add(v.T.SIZEFEATUREATTRIBUTE,"float"),n.uniforms.add(new c.J("vvSizeMinSize",(function(e){return e.vvSizeMinSize}))),n.uniforms.add(new c.J("vvSizeMaxSize",(function(e){return e.vvSizeMaxSize}))),n.uniforms.add(new c.J("vvSizeOffset",(function(e){return e.vvSizeOffset}))),n.uniforms.add(new c.J("vvSizeFactor",(function(e){return e.vvSizeFactor}))),n.code.add((0,p.H)(r||(r=(0,l.Z)(["float getSize() {\nreturn intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n}"]))))):(e.attributes.add(v.T.SIZE,"float"),n.code.add((0,p.H)(i||(i=(0,l.Z)(["float getSize(){\nreturn intrinsicWidth * size;\n}"]))))),t.vvOpacity?(e.attributes.add(v.T.OPACITYFEATUREATTRIBUTE,"float"),n.constants.add("vvOpacityNumber","int",8),n.uniforms.add([new f.O("vvOpacityValues",(function(e){return e.vvOpacityValues}),8),new f.O("vvOpacityOpacities",(function(e){return e.vvOpacityOpacities}),8)]),n.code.add((0,p.H)(a||(a=(0,l.Z)(["float interpolateOpacity( float value ){\nif (value <= vvOpacityValues[0]) {\nreturn vvOpacityOpacities[0];\n}\nfor (int i = 1; i < vvOpacityNumber; ++i) {\nif (vvOpacityValues[i] >= value) {\nfloat f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\nreturn mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n}\n}\nreturn vvOpacityOpacities[vvOpacityNumber - 1];\n}\nvec4 applyOpacity( vec4 color ){\nreturn vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n}"]))))):n.code.add((0,p.H)(o||(o=(0,l.Z)(["vec4 applyOpacity( vec4 color ){\nreturn color;\n}"])))),t.vvColor?(e.attributes.add(v.T.COLORFEATUREATTRIBUTE,"float"),n.constants.add("vvColorNumber","int",g.x),n.uniforms.add(new f.O("vvColorValues",(function(e){return e.vvColorValues}),g.x)),n.uniforms.add(new d.b("vvColorColors",(function(e){return e.vvColorColors}),g.x)),n.code.add((0,p.H)(s||(s=(0,l.Z)(["vec4 interpolateColor( float value ) {\nif (value <= vvColorValues[0]) {\nreturn vvColorColors[0];\n}\nfor (int i = 1; i < vvColorNumber; ++i) {\nif (vvColorValues[i] >= value) {\nfloat f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\nreturn mix(vvColorColors[i-1], vvColorColors[i], f);\n}\n}\nreturn vvColorColors[vvColorNumber - 1];\n}\nvec4 getColor(){\nreturn applyOpacity(interpolateColor(colorFeatureAttribute));\n}"]))))):(e.attributes.add(v.T.COLOR,"vec4"),n.code.add((0,p.H)(u||(u=(0,l.Z)(["vec4 getColor(){\nreturn applyOpacity(color);\n}"])))))}},28156:function(e,t,n){n.d(t,{H:function(){return s}});var r,i,a=n(30168),o=n(98634);function s(e){var t=(0,o.H)(r||(r=(0,a.Z)(["vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"]))),n=(0,o.H)(i||(i=(0,a.Z)(["vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"])));e.vertex.code.add(t),e.vertex.code.add(n),e.fragment.code.add(t),e.fragment.code.add(n)}},81879:function(e,t,n){n.d(t,{R:function(){return x},d:function(){return c}});var r,i,a,o,s,u,l,c,d=n(30168),h=n(49223),f=n(80733),p=n(62993),v=n(41012),g=n(95276),m=n(58406),y=n(98634),_=n(19253),T=n(4760);function x(e,t){e.include(p.cK),e.attributes.add(T.T.POSITION,"vec3"),e.attributes.add(T.T.NORMAL,"vec3"),e.attributes.add(T.T.AUXPOS1,"vec4");var n=e.vertex;(0,v.Sv)(n,t),(0,v.hY)(n,t),n.uniforms.add([new g.N("viewport",(function(e,t){return t.camera.fullViewport})),new m.p("polygonOffset",(function(e){return e.shaderPolygonOffset})),new m.p("cameraGroundRelative",(function(e,t){return t.camera.aboveGround?1:-1})),new m.p("renderTransparentlyOccludedHUD",(function(e,t){return t.renderTransparentlyOccludedHUD===f.v.Occluded?1:t.renderTransparentlyOccludedHUD===f.v.NotOccluded?0:.75})),new _.A("hudVisibilityTexture",(function(e,t){return t.hudVisibilityTexture}))]),t.hasVerticalOffset&&(0,h.V)(n),n.constants.add("smallOffsetAngle","float",.984807753012208),n.code.add((0,y.H)(r||(r=(0,d.Z)(["struct ProjectHUDAux {\nvec3 posModel;\nvec3 posView;\nvec3 vnormal;\nfloat distanceToCamera;\nfloat absCosAngle;\n};"])))),n.code.add((0,y.H)(i||(i=(0,d.Z)(["float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\nfloat pointGroundSign = sign(pointGroundDistance);\nif (pointGroundSign == 0.0) {\npointGroundSign = cameraGroundRelative;\n}\nfloat groundRelative = cameraGroundRelative * pointGroundSign;\nif (polygonOffset > .0) {\nfloat cosAlpha = clamp(absCosAngle, 0.01, 1.0);\nfloat tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\nfloat factor = (1.0 - tanAlpha / viewport[2]);\nif (groundRelative > 0.0) {\nposView *= factor;\n}\nelse {\nposView /= factor;\n}\n}\nreturn groundRelative;\n}"])))),t.isDraped&&!t.hasVerticalOffset||(0,v._8)(n),t.isDraped||(n.uniforms.add(new m.p("perDistancePixelRatio",(function(e,t){return Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)}))),n.code.add((0,y.H)(a||(a=(0,d.Z)(["void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\nfloat distanceToCamera = length(posView);\nfloat pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\nvec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\nvec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\nposModel += modelOffset;\nposView += viewOffset;\n}"]))))),t.screenCenterOffsetUnitsEnabled===c.Screen&&n.uniforms.add(new m.p("pixelRatio",(function(e,t){return t.camera.pixelRatio}))),t.hasScreenSizePerspective&&(0,p.m8)(n),n.code.add((0,y.H)(o||(o=(0,d.Z)(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n      ","\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);",t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===c.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.hasVerticalOffset?(0,y.H)(s||(s=(0,d.Z)(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",t.screenCenterOffsetUnitsEnabled!==c.Screen?(0,y.H)(u||(u=(0,d.Z)(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",t.screenCenterOffsetUnitsEnabled===c.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",t.screenCenterOffsetUnitsEnabled===c.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":"")),n.code.add((0,y.H)(l||(l=(0,d.Z)(["bool testVisibilityHUD(vec4 posProj) {\nvec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\nvec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\nif (renderTransparentlyOccludedHUD > 0.5) {\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;\n}\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n}"]))))}!function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"}(c||(c={}))},50913:function(e,t,n){n.d(t,{R:function(){return m}});var r,i,a,o,s=n(93433),u=n(30168),l=n(21002),c=n(43565),d=n(78980),h=n(75993),f=n(82999),p=n(98634),v=n(19253),g=n(97528);function m(e,t){var n=e.vertex,m=e.fragment;t.hasMultipassGeometry&&n.include(c.S),t.hasMultipassTerrain&&e.varyings.add("depth","float"),n.code.add((0,p.H)(r||(r=(0,u.Z)(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      ","\n\n      ","\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n\n    } else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])),t.hasMultipassGeometry?(0,p.H)(i||(i=(0,u.Z)(["\n        // Don't draw vertices behind geometry\n        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){\n          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n        }"]))):"",t.hasMultipassTerrain?"depth = projectAux.posView.z;":"")),t.hasMultipassTerrain&&m.include(l.S),t.hasMultipassTerrain&&m.uniforms.add([].concat((0,s.Z)((0,v.J)("terrainDepthTexture",(function(e,t){return t.multipassTerrain.linearDepthTexture}),t.hasWebGL2Context?g.D.None:g.D.InvSize)),[new f.A("nearFar",(function(e,t){return t.camera.nearFar}))])),m.include(d.n),m.code.add((0,p.H)(a||(a=(0,u.Z)(["\n  void main() {\n    gl_FragColor = vec4(1, 1, 1, 1);\n    ","\n  }\n  "])),t.hasMultipassTerrain?(0,p.H)(o||(o=(0,u.Z)(["\n          vec2 uv = gl_FragCoord.xy;\n\n          // Read the rgba data from the texture linear depth\n          vec4 terrainDepthData = ",";\n\n          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);\n\n          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)\n          // Mark the HUD vertex as occluded by transparent terrain\n          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){\n            gl_FragColor.g = 0.5;\n          }"])),(0,h.b6)(t,"terrainDepthTexture","uv")):""))}},80733:function(e,t,n){var r;n.d(t,{v:function(){return r}}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(r||(r={}))},7683:function(e,t,n){n.d(t,{E:function(){return u},K:function(){return s}});var r,i,a=n(30168),o=n(98634);function s(e){e.fragment.code.add((0,o.H)(r||(r=(0,a.Z)(["float normals2FoamIntensity(vec3 n, float waveStrength){\nfloat normalizationFactor =  max(0.015, waveStrength);\nreturn max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n}"]))))}function u(e){e.fragment.code.add((0,o.H)(i||(i=(0,a.Z)(["vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\nreturn foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n}"]))))}},29202:function(e,t,n){n.d(t,{D:function(){return o}});var r,i=n(30168),a=n(98634);function o(e){e.fragment.code.add((0,a.H)(r||(r=(0,i.Z)(["const float GAMMA = 2.2;\nconst float INV_GAMMA = 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\nreturn vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\nreturn pow(color, vec3(GAMMA));\n}"]))))}},60300:function(e,t,n){n.d(t,{q:function(){return L},C:function(){return H}});var r=n(30168),i=n(92026),a=n(78980),o=n(41012),s=n(75993),u=n(95276),l=n(58406),c=n(98634),d=n(19253),h=n(97528),f=n(82031),p=n(90045),v=n(67077);function g(e){return(0,i.Wi)(e)?v.Z:4===e.length?e:(0,p.s)(Z,e[0],e[1],e[2],1)}var m,y,_,T,x,S,O,w,b,C,A,R,E,P,I,D,M,N,Z=(0,v.c)();function L(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?k(e,t):function(e){e.fragment.code.add((0,c.H)(N||(N=(0,r.Z)(["float getStippleAlpha() { return 1.0; }\n#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n#define blendStipple(color, _stippleAlpha_) color"]))))}(e)}function k(e,t){var n=!(t.draped&&t.stipplePreferContinuous),p=e.vertex,v=e.fragment;v.include(a.n),t.draped||((0,o.hY)(p,t),p.uniforms.add(new l.p("worldToScreenPerDistanceRatio",(function(e,t){return 1/t.camera.perScreenPixelRatio}))),p.code.add((0,c.H)(m||(m=(0,r.Z)(["float computeWorldToScreenRatio(vec3 segmentCenter) {\nfloat segmentDistanceToCamera = length(segmentCenter - cameraPosition);\nreturn worldToScreenPerDistanceRatio / segmentDistanceToCamera;\n}"]))))),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),p.code.add((0,c.H)(y||(y=(0,r.Z)(["\n    float discretizeWorldToScreenRatio(float worldToScreenRatio) {\n      float step = ",";\n\n      float discreteWorldToScreenRatio = log(worldToScreenRatio);\n      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;\n      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);\n      return discreteWorldToScreenRatio;\n    }\n  "])),F)),p.code.add((0,c.H)(_||(_=(0,r.Z)(["vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {"])))),p.code.add((0,c.H)(T||(T=(0,r.Z)(["\n    if (segmentLengthPseudoScreen >= ",") {\n  "])),n?"patternLength":"1e4")),p.uniforms.add(new l.p("pixelRatio",(function(e,t){return t.camera.pixelRatio}))),p.code.add((0,c.H)(x||(x=(0,r.Z)(["\n        // Round the screen length to get an integer number of pattern repetitions (minimum 1).\n        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);\n        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));\n        float segmentLengthScreenRounded = flooredRepetitions * patternLength;\n\n        ","\n\n        return vec2(0.0, segmentLengthScreenRounded);\n      }\n      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);\n    }\n  "])),t.stippleRequiresStretchMeasure?(0,c.H)(S||(S=(0,r.Z)(["\n              float stretch = repetitions / flooredRepetitions;\n\n              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.\n              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.\n              vStipplePatternStretch = max(0.75, stretch);"]))):"")),v.constants.add("stippleTexturePadding","float",f.it);var N=t.hasWebGL2Context?h.D.None:h.D.Size;v.uniforms.add((0,d.J)("stipplePatternTexture",(function(e){return e.stippleTexture}),N)),v.uniforms.add([new l.p("stipplePatternSDFNormalizer",(function(e){return function(e){return(0,i.pC)(e)?(Math.floor(.5*((0,f.kj)(e)-1))+.5)/e.pixelRatio:1}(e.stipplePattern)})),new l.p("stipplePatternPixelSizeInv",(function(e){return 1/H(e)}))]),v.code.add((0,c.H)(O||(O=(0,r.Z)(["\n    float padStippleTexture(float u) {\n      float paddedTextureSize = ",".x;\n      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;\n\n      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;\n    }\n  "])),(0,s.w_)(t,"stipplePatternTexture"))),v.code.add((0,c.H)(w||(w=(0,r.Z)(["\n    float getStippleSDF(out bool isClamped) {\n      ","\n\n      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;\n      ","\n      u = padStippleTexture(fract(u));\n\n      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));\n      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;\n\n      ","\n    }\n\n    float getStippleSDF() {\n      bool ignored;\n      return getStippleSDF(ignored);\n    }\n\n    float getStippleAlpha() {\n      bool isClamped;\n      float stippleSDF = getStippleSDF(isClamped);\n\n      float antiAliasedResult = ","\n\n      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;\n    }\n  "])),t.stippleRequiresClamp?(0,c.H)(b||(b=(0,r.Z)(["\n          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);\n          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;\n          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;"]))):(0,c.H)(C||(C=(0,r.Z)(["\n          float stippleDistanceClamped = vStippleDistance;\n          isClamped = false;"]))),t.stippleScaleWithLineWidth?(0,c.H)(A||(A=(0,r.Z)(["u *= vLineSizeInv;"]))):"",t.stippleRequiresStretchMeasure?(0,c.H)(R||(R=(0,r.Z)(["return (sdf - 0.5) * vStipplePatternStretch + 0.5;"]))):(0,c.H)(E||(E=(0,r.Z)(["return sdf;"]))),t.stippleScaleWithLineWidth?(0,c.H)(P||(P=(0,r.Z)(["clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);"]))):(0,c.H)(I||(I=(0,r.Z)(["clamp(stippleSDF + 0.5, 0.0, 1.0);"]))))),t.stippleOffColorEnabled?(v.uniforms.add(new u.N("stippleOffColor",(function(e){return g(e.stippleOffColor)}))),v.code.add((0,c.H)(D||(D=(0,r.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) {}\n#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)"]))))):v.code.add((0,c.H)(M||(M=(0,r.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)"]))))}function H(e){var t=e.stipplePattern;return(0,i.pC)(t)?(0,f.$A)(e.stipplePattern)/t.pixelRatio:1}var F=c.H.float(.4)},40526:function(e,t,n){n.d(t,{Q:function(){return d}});var r,i,a=n(30168),o=n(92026),s=n(2522),u=n(58406),l=n(98634),c=n(33720);function d(e,t){var n=e.vertex;e.constants.add("markerSizePerLineWidth","float",s._Z),n.uniforms.add(new u.p("pixelRatio",(function(e,t){return t.camera.pixelRatio}))),(0,o.Wi)(n.uniforms.get("markerScale"))&&n.constants.add("markerScale","float",1),n.code.add((0,l.H)(r||(r=(0,a.Z)(["float getLineWidth() {\nreturn max(getSize(), 1.0) * pixelRatio;\n}\nfloat getScreenMarkerSize() {\nreturn markerSizePerLineWidth * markerScale * getLineWidth();\n}"])))),t.space===c.I9.World&&(n.constants.add("maxSegmentLengthFraction","float",.45),n.uniforms.add(new u.p("perRenderPixelRatio",(function(e,t){return t.camera.perRenderPixelRatio}))),n.code.add((0,l.H)(i||(i=(0,a.Z)(["float getWorldMarkerSize(vec4 pos) {\nfloat distanceToCamera = length(pos.xyz);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nreturn getScreenMarkerSize() * screenToWorldRatio;\n}\nbool areWorldMarkersHidden(vec4 pos, vec4 other) {\nvec3 midPoint = mix(pos.xyz, other.xyz, 0.5);\nfloat distanceToCamera = length(midPoint);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nfloat worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;\nfloat segmentLen = length(pos.xyz - other.xyz);\nreturn worldMarkerSize > maxSegmentLengthFraction * segmentLen;\n}"])))))}},43565:function(e,t,n){n.d(t,{S:function(){return d},_:function(){return h}});var r,i=n(43144),a=n(15671),o=n(30168),s=n(21002),u=n(82999),l=n(98634),c=n(19253);function d(e){e.include(s.S),e.uniforms.add([new c.A("geometryDepthTexture",(function(e,t){return t.multipassGeometry.linearDepthTexture})),new u.A("nearFar",(function(e,t){return t.camera.nearFar}))]),e.code.add((0,l.H)(r||(r=(0,o.Z)(["bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);\nreturn (elementDepth < (geometryDepth - 1.0));\n}"]))))}var h=(0,i.Z)((function e(){(0,a.Z)(this,e),this.enabled=!1}))},8555:function(e,t,n){n.d(t,{n:function(){return l}});var r,i,a,o,s=n(30168),u=n(98634);function l(e,t){t.spherical?e.vertex.code.add((0,u.H)(r||(r=(0,s.Z)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn normalize(pos + origin);\n}"])))):e.vertex.code.add((0,u.H)(i||(i=(0,s.Z)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn vec3(0.0, 0.0, 1.0);\n}"])))),t.spherical?e.vertex.code.add((0,u.H)(a||(a=(0,s.Z)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"])))):e.vertex.code.add((0,u.H)(o||(o=(0,s.Z)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = vec3(1.0, 0.0, 0.0);\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"]))))}},40854:function(e,t,n){n.d(t,{O:function(){return v},P:function(){return p}});var r,i=n(43144),a=n(15671),o=n(30168),s=n(81949),u=n(21002),l=n(82999),c=n(58406),d=n(98634),h=n(8654),f=n(19253);function p(e,t){var n=e.fragment;n.include(u.S),n.uniforms.add(new l.A("nearFar",(function(e,t){return t.camera.nearFar}))),n.uniforms.add(new f.A("depthMap",(function(e,t){return t.linearDepthTexture}))),n.uniforms.add(new h.g("proj",(function(e,t){return t.ssr.camera.projectionMatrix}))),n.uniforms.add(new c.p("invResolutionHeight",(function(e,t){return 1/t.ssr.camera.height}))),n.uniforms.add(new h.g("reprojectionMatrix",(function(e,t){return t.ssr.reprojectionMatrix}))),n.code.add((0,d.H)(r||(r=(0,o.Z)(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy * 0.5 + 0.5;\n  }\n\n  const int maxSteps = ",";\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n        return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150":"75"))}var v=(0,i.Z)((function e(){(0,a.Z)(this,e),this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=(0,s.c)()}))},68618:function(e,t,n){n.d(t,{B:function(){return x}});var r,i,a,o,s,u,l,c,d=n(30168),h=n(7683),f=n(29202),p=n(2116),v=n(40854),g=n(73619),m=n(58406),y=n(98634),_=n(8654),T=n(19253);function x(e,t){e.include(p.g,t),e.include(f.D),e.include(h.E),t.hasCloudsReflections&&e.include(g.j,t),t.hasScreenSpaceReflections&&e.include(v.P,t);var n=e.fragment;n.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),n.code.add((0,y.H)(r||(r=(0,d.Z)(["PBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\nfloat exponent = pow((1.0 - cosTheta), fresnelSky[2]);\nreturn mix(zenit, horizon, exponent);\n}"])))),n.uniforms.add([new m.p("lightingSpecularStrength",(function(e,t){return t.lighting.mainLight.specularStrength})),new m.p("lightingEnvironmentStrength",(function(e,t){return t.lighting.mainLight.environmentStrength}))]),n.code.add((0,y.H)(i||(i=(0,d.Z)(["vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {\nfloat reflectionHit = 0.0;\nfloat reflectionHitDiffused = 0.0;\nvec3 seaWaterColor = linearizeGamma(color);\nvec3 h = normalize(l + v);\nshadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\nshadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\nshadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\nshadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\nshadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\nshadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\nfloat upDotV = max(dot(localUp,v), 0.0);\nvec3 skyHorizon = linearizeGamma(skyColor);\nvec3 skyZenit = linearizeGamma(skyZenitColor);\nvec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\nfloat upDotL = max(dot(localUp,l),0.0);\nfloat daytimeMod = 0.1 + upDotL * 0.9;\nskyColor *= daytimeMod;\nfloat shadowModifier = clamp(shadow, 0.8, 1.0);\nvec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\nvec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;\nvec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\nvec3 specular = vec3(0.0);\nif(upDotV > 0.0 && upDotL > 0.0) {\nvec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\nvec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\nspecular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;\n}\nvec3 foam = vec3(0.0);\nif(upDotV > 0.0) {\nfoam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n}\nfloat correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);\nvec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);\nvec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));"])))),t.hasCloudsReflections&&n.code.add((0,y.H)(a||(a=(0,d.Z)(["vec4 cloudsColor = renderClouds(reflectedWorld, position);\ncloudsColor.a = 1.0 - cloudsColor.a;\ncloudsColor = pow(cloudsColor, vec4(GAMMA));\ncloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);"])))),t.hasScreenSpaceReflections?(n.uniforms.add([new _.g("view",(function(e,t){return t.ssr.camera.viewMatrix})),new T.A("lastFrameColorTexture",(function(e,t){return t.ssr.lastFrameColorTexture})),new m.p("fadeFactor",(function(e,t){return t.ssr.fadeFactor}))]),n.code.add((0,y.H)(o||(o=(0,d.Z)(["vec3 viewDir = normalize(viewPosition);\nvec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);\nvec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\nvec4 viewUp = view * vec4(localUp, 0.0);\nvec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\nvec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));\nvec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);\nvec3 reflectedColor = vec3(0.0);\nif (hitCoordinate.z > 0.0)\n{\nvec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\nvec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\nfloat heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);\nreflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactor;\nreflectionHitDiffused = waterDiffusion * reflectionHit;\nreflectedColor = linearizeGamma(texture2D(lastFrameColorTexture, reprojectedCoordinate).xyz) *\nreflectionHitDiffused * fresnelModifier.y * ssrIntensity;\n}\nfloat seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);\nvec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +\nreflSea * seaColorMod + specular + foam);"]))))):n.code.add((0,y.H)(s||(s=(0,d.Z)(["vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);"])))),t.hasCloudsReflections?t.hasScreenSpaceReflections?n.code.add((0,y.H)(u||(u=(0,d.Z)(["return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;\n}"])))):n.code.add((0,y.H)(l||(l=(0,d.Z)(["return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;\n}"])))):n.code.add((0,y.H)(c||(c=(0,d.Z)(["return waterRenderedColor;\n}"]))))}},79246:function(e,t,n){n.d(t,{M:function(){return y},U:function(){return _}});var r,i=n(43144),a=n(15671),o=n(60136),s=n(92572),u=n(30168),l=n(88396),c=n(6394),d=n(90045),h=n(67077),f=n(7683),p=n(82999),v=n(95276),g=n(98634),m=n(19253);function y(e){e.fragment.uniforms.add(new m.A("texWaveNormal",(function(e){return e.waveNormal}))),e.fragment.uniforms.add(new m.A("texWavePerturbation",(function(e){return e.wavePertubation}))),e.fragment.uniforms.add([new v.N("waveParams",(function(e){return(0,d.s)(T,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)})),new p.A("waveDirection",(function(e){return(0,l.s)(x,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity)}))]),e.include(f.K),e.fragment.code.add((0,g.H)(r||(r=(0,u.Z)(["const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\nvec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture2D(_tex, _uv).rg - 1.0;\n}\nfloat sampleNoiseTexture(vec2 _uv) {\nreturn texture2D(texWavePerturbation, _uv).b;\n}\nvec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n}\nfloat computeProgress(vec2 uv, float time) {\nreturn fract(time);\n}\nfloat computeWeight(vec2 uv, float time) {\nfloat progress = computeProgress(uv, time);\nreturn 1.0 - abs(1.0 - 2.0 * progress);\n}\nvec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\nfloat flowStrength = waveParams[2];\nfloat flowOffset = waveParams[3];\nvec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\nfloat progress = computeProgress(uv, time + phaseOffset);\nfloat weight = computeWeight(uv, time + phaseOffset);\nvec2 result = uv;\nresult -= flowVector * (progress + flowOffset);\nresult += phaseOffset;\nresult += (time - progress) * FLOW_JUMP;\nreturn vec3(result, weight);\n}\nconst float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\nconst float TIME_NOISE_STRENGTH = 7.77;\nvec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\nfloat waveStrength = waveParams[0];\nvec2 waveMovement = time * -_waveDir;\nfloat timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\nvec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\nvec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\nvec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\nvec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\nvec3 mixNormal = normalize(normal_A + normal_B);\nmixNormal.xy *= waveStrength;\nmixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\nreturn mixNormal;\n}\nvec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\nfloat waveTextureRepeat = waveParams[1];\nvec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\nfloat foam  = normals2FoamIntensity(normal, waveParams[0]);\nreturn vec4(normal, foam);\n}"]))))}var _=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n)}(g.K),T=(0,h.c)(),x=(0,c.a)()},73619:function(e,t,n){n.d(t,{j:function(){return P}});var r,i,a,o,s,u,l,c,d=n(30168),h=n(16889),f=n(92026),p=n(22186),v=n(91226),g=n(46208),m=n(92395),y=n(13773),_=n(49450),T=n(58406),x=n(98634),S=n(8654),O=n(43144),w=n(15671),b=n(60136),C=n(92572),A=n(61809),R=n(99340),E=function(e){(0,b.Z)(n,e);var t=(0,C.Z)(n);function n(e,r){return(0,w.Z)(this,n),t.call(this,e,"samplerCube",R.P.Pass,(function(t,n,i){return t.bindTexture(e,r(n,i))}))}return(0,O.Z)(n)}(A.x);function P(e){var t=e.fragment;t.uniforms.add([new S.g("rotationMatrixClouds",(function(e,t){return t.cloudsFade.parallax.transform})),new S.g("rotationMatrixCloudsCrossFade",(function(e,t){return t.cloudsFade.parallaxNew.transform})),new _.J("anchorPosition",(function(e,t){return t.cloudsFade.parallax.anchorPointClouds})),new _.J("anchorPositionCrossFade",(function(e,t){return t.cloudsFade.parallaxNew.anchorPointClouds})),new T.p("cloudsHeight",(function(e,t){return t.cloudsFade.parallax.cloudsHeight})),new T.p("radiusCurvatureCorrectionFactor",(function(e,t){return t.cloudsFade.parallax.radiusCurvatureCorrectionFactor})),new T.p("totalFadeInOut",(function(e,t){return t.cloudsFade.fadeInOut.stage===v.co.FINISHED?t.cloudsFade.fadeInOutHeight.factor+1-t.cloudsFade.fadeIn.factor:t.cloudsFade.fadeInOutHeight.factor+1-t.cloudsFade.fadeInOut.factor})),new T.p("crossFadeAnchorFactor",(function(e,t){return(0,h.uZ)(t.cloudsFade.crossFade.factor,0,1)})),new E("cubeMap",(function(e,t){return(0,f.pC)(t.cloudsFade.data)&&(0,f.pC)(t.cloudsFade.data.cubeMap)?t.cloudsFade.data.cubeMap.colorTexture:null})),new y.U("crossFade",(function(e,t){return t.cloudsFade.crossFade.enabled})),new y.U("readChannelsRG",(function(e,t){return t.cloudsFade.readChannels===g.uz.RG})),new y.U("fadeTextureChannels",(function(e,t){return t.cloudsFade.renderingStage===g.jL.FADING_TEXTURE_CHANNELS}))]),t.constants.add("planetRadius","float",p.sv.radius),t.code.add((0,x.H)(r||(r=(0,d.Z)(["vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)\n{\nfloat radiusClouds = planetRadius + cloudsHeight;\nfloat B = 2.0 * dot(cameraPosition, dir);\nfloat C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;\nfloat det = B * B - 4.0 * C;\nfloat pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));\nvec3 intersectionPont = cameraPosition + dir * pointIntDist;\nintersectionPont =  intersectionPont - spherePos;\nreturn intersectionPont;\n}"])))),t.code.add((0,x.H)(i||(i=(0,d.Z)(["vec3 correctForPlanetCurvature(vec3 dir)\n{\ndir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;\nreturn dir;\n}"])))),t.code.add((0,x.H)(a||(a=(0,d.Z)(["vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)\n{\nreturn (rotMat * vec4(inVec, 0.0)).xyz;\n}"])))),(0,m.Pe)(t),(0,m.F1)(t),t.code.add((0,x.H)(o||(o=(0,d.Z)(["const float SUNSET_TRANSITION_FACTOR = 0.3;\nconst vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);\nconst float RIM_SCATTERING_FACTOR = 140.0;\nconst float BACKLIGHT_FACTOR = 0.2;\nconst float BACKLIGHT_SCATTERING_FACTOR = 10.0;\nconst float BACKLIGHT_TRANSITION_FACTOR = 0.3;\nvec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)\n{\nfloat upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));\nfloat dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);\nfloat sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);\nvec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);\nvec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);\nvec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));\nvec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));\nfloat scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);\nfloat rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);\nvec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;\nfloat additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;\nreturn vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);\n}"])))),t.code.add((0,x.H)(s||(s=(0,d.Z)(["vec4 getCloudData(vec3 rayDir, bool readOtherChannel)\n{\nvec4 cloudData = textureCube(cubeMap, rayDir);\nfloat mu = dot(rayDir, vec3(0, 0, 1));\nbool readChannels = readChannelsRG ^^ readOtherChannel;\nif (readChannels) {\ncloudData = vec4(vec3(cloudData.r), cloudData.g);\n} else {\ncloudData = vec4(vec3(cloudData.b), cloudData.a);\n}\nif (length(cloudData) == 0.0) {\nreturn vec4(cloudData.rgb, 1.0);\n}\nreturn cloudData;\n}"])))),t.code.add((0,x.H)(u||(u=(0,d.Z)(["vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nfloat totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudData.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);\n}"])))),t.code.add((0,x.H)(l||(l=(0,d.Z)(["vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nvec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\nintersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);\nworldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));\nworldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\ncloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);\nvec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\ncloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);\nfloat totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudColor.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(cloudColor.rgb, totalTransmittance);\n}"])))),t.code.add((0,x.H)(c||(c=(0,d.Z)(["vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)\n{\nreturn crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);\n}"]))))}},51992:function(e,t,n){n.d(t,{M:function(){return c}});var r=n(74165),i=n(15861),a=n(15671),o=n(43144),s=n(92026),u=n(59447),l=n(33559),c=function(){function e(t){(0,a.Z)(this,e),this._context=t,this._perConstructorInstances=new u.r,this._frameCounter=0,this._keepAliveFrameCount=h}return(0,o.Z)(e,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}},{key:"destroy",value:function(){this._perConstructorInstances.forEach((function(e){return e.forEach((function(e){return e.technique.destroy()}))})),this._perConstructorInstances.clear()}},{key:"acquire",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f,r=n.key,i=this._perConstructorInstances.get(e,r);if((0,s.Wi)(i)){var a=new e(this._context,n,(function(){return t.release(a)}));i=new d(a),this._perConstructorInstances.set(e,r,i)}return++i.refCount,i.technique}},{key:"releaseAndAcquire",value:function(e,t,n){if((0,s.pC)(n)){if(t.key===n.key)return n;this.release(n)}return this.acquire(e,t)}},{key:"release",value:function(e){if(!(0,s.Wi)(e)&&!this._perConstructorInstances.empty){var t=this._perConstructorInstances.get(e.constructor,e.key);(0,s.Wi)(t)||(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}}},{key:"frameUpdate",value:function(){var e=this;this._frameCounter++,this._keepAliveFrameCount!==h&&this._perConstructorInstances.forEach((function(t,n){t.forEach((function(t,r){0===t.refCount&&t.refZeroFrame+e._keepAliveFrameCount<e._frameCounter&&(t.technique.destroy(),e._perConstructorInstances.delete(n,r))}))}))}},{key:"reloadAll",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,n=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Array,this._perConstructorInstances.forEach((function(e,a){var o=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,i){var a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.shader,e.t0=a,!e.t0){e.next=6;break}return e.next=5,a.reload();case 5:t.forEach((function(e){return e.technique.reload(n._context)}));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();t.push(o(e,a))})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),d=(0,o.Z)((function e(t){(0,a.Z)(this,e),this.technique=t,this.refCount=0,this.refZeroFrame=0})),h=-1,f=new l.m},83377:function(e,t,n){n.d(t,{p:function(){return p}});var r=n(15671),i=n(43144),a=n(6394),o=n(91226),s=n(43565),u=n(15226),l=n(40854),c=n(86755),d=n(93822),h=n(25920),f=n(48919),p=function(){function e(t,n,i){(0,r.Z)(this,e),this.shadowMap=t,this.ssaoHelper=n,this.slicePlane=i,this.slot=d.r.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=h.A.NONE,this._camera=new c.V,this._inverseViewport=(0,a.a)(),this.oldLighting=new f.c,this.newLighting=new f.c,this._fadedLighting=new f.c,this._lighting=this.newLighting,this.ssr=new l.O,this.multipassTerrain=new u.a,this.multipassGeometry=new s._,this.overlays=[],this.cloudsFade=new o.ii}return(0,i.Z)(e,[{key:"camera",get:function(){return this._camera},set:function(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}},{key:"inverseViewport",get:function(){return this._inverseViewport}},{key:"lighting",get:function(){return this._lighting}},{key:"weatherFading",get:function(){return this._lighting===this._fadedLighting}},{key:"fadeLighting",value:function(e){var t=this.oldLighting,n=this.newLighting;e>=1?this._lighting=n:(this._fadedLighting.lerpLighting(t,n,e),this._lighting=this._fadedLighting)}}]),e}()},86755:function(e,t,n){n.d(t,{V:function(){return A},N:function(){return R}});var r,i=n(15671),a=n(43144),o=n(60136),s=n(92572),u=n(27366),l=n(85015),c=n(32718),d=n(16889),h=n(17842),f=n(49861),p=(n(25243),n(63780),n(69912)),v=n(14226),g=n(81949),m=n(88396),y=n(6394),_=n(11186),T=n(71353),x=n(90045),S=n(67077),O=n(95773),w=n(40885),b=n(40927),C=n(50951);var A=r=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.Z)(this,n),(e=t.call(this,r))._center=(0,T.c)(),e._up=(0,T.c)(),e._viewUp=(0,T.c)(),e._viewForward=(0,T.c)(),e._viewRight=(0,T.c)(),e._ray=(0,w.Ue)(),e._viewport=(0,S.f)(0,0,1,1),e._padding=(0,S.f)(0,0,0,0),e._fov=55/180*Math.PI,e._nearFar=(0,y.f)(1,1e3),e._viewDirty=!0,e._viewMatrix=(0,g.c)(),e._viewProjectionDirty=!0,e._viewProjectionMatrix=(0,g.c)(),e._viewInverseTransposeMatrixDirty=!0,e._viewInverseTransposeMatrix=(0,g.c)(),e._frustumDirty=!0,e._frustum=(0,O.Ue)(),e._fullViewport=(0,S.c)(),e._pixelRatio=1,e.relativeElevation=0,e}return(0,a.Z)(n,[{key:"pixelRatio",get:function(){return this._pixelRatio},set:function(e){this._pixelRatio=e>0?e:1}},{key:"eye",get:function(){return this._ray.origin},set:function(e){this._compareAndSetView(e,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center,"_center")}},{key:"ray",get:function(){return(0,_.b)(this._ray.direction,this.center,this.eye),this._ray}},{key:"up",get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up,"_up")}},{key:"viewMatrix",get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){(0,v.c)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"viewForward",get:function(){return this._ensureViewClean(),this._viewForward}},{key:"viewUp",get:function(){return this._ensureViewClean(),this._viewUp}},{key:"viewRight",get:function(){return this._ensureViewClean(),this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}},{key:"far",get:function(){return this._nearFar[1]},set:function(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}},{key:"viewport",get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}},{key:"screenViewport",get:function(){if(1===this.pixelRatio)return this._viewport;var e=(0,x.b)((0,S.c)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,x.h)(e,t)?t:e}},{key:"x",get:function(){return this._viewport[0]},set:function(e){e+=this._padding[R.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}},{key:"y",get:function(){return this._viewport[1]},set:function(e){e+=this._padding[R.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}},{key:"width",get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}},{key:"height",get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[R.RIGHT]+this._padding[R.LEFT]},set:function(e){this.width=e-(this._padding[R.RIGHT]+this._padding[R.LEFT])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[R.TOP]+this._padding[R.BOTTOM]},set:function(e){this.height=e-(this._padding[R.TOP]+this._padding[R.BOTTOM])}},{key:"fullViewport",get:function(){return this._fullViewport[0]=this._viewport[0]-this._padding[R.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[R.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}},{key:"_aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(e){(0,x.g)(this._padding,e)||(this._viewport[0]+=e[R.LEFT]-this._padding[R.LEFT],this._viewport[1]+=e[R.BOTTOM]-this._padding[R.BOTTOM],this._viewport[2]-=e[R.RIGHT]+e[R.LEFT]-(this._padding[R.RIGHT]+this._padding[R.LEFT]),this._viewport[3]-=e[R.TOP]+e[R.BOTTOM]-(this._padding[R.TOP]+this._padding[R.BOTTOM]),(0,x.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}},{key:"viewProjectionMatrix",get:function(){return this._viewProjectionDirty&&((0,v.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){var e=this.width,t=this.height,n=this.near*Math.tan(this.fovY/2),r=n*this._aspect,i=(0,v.q)((0,g.c)(),-r*(1+2*this._padding[R.LEFT]/e),r*(1+2*this._padding[R.RIGHT]/e),-n*(1+2*this._padding[R.BOTTOM]/t),n*(1+2*this._padding[R.TOP]/t),this.near,this.far),a=this._get("projectionMatrix");return a&&(0,v.h)(a,i)?a:i}},{key:"inverseProjectionMatrix",get:function(){return(0,v.a)((0,g.c)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,g.c)()}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovX",get:function(){return function(e,t,n){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+n*n))}(this._fov,this.width,this.height)},set:function(e){this._fov=function(e,t,n){return 2*Math.atan(Math.sqrt(t*t+n*n)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovY",get:function(){return function(e,t,n){return 2*Math.atan(n*Math.tan(.5*e)/Math.sqrt(t*t+n*n))}(this._fov,this.width,this.height)},set:function(e){this._fov=function(e,t,n){return 2*Math.atan(Math.sqrt(t*t+n*n)*Math.tan(.5*e)/n)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"distance",get:function(){return(0,_.i)(this.center,this.eye)}},{key:"frustum",get:function(){return this._recomputeFrustum(),this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,v.a)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,v.t)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}},{key:"depthNDCToWorld",value:function(e){var t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return null!=this.relativeElevation&&this.relativeElevation>=0}},{key:"copyFrom",value:function(e){(0,_.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,x.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,x.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,m.c)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.relativeElevation=e.relativeElevation;var t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,v.c)(this._viewMatrix,e.viewMatrix),(0,_.c)(this._viewRight,e.viewRight),(0,_.c)(this._viewUp,e.viewUp),(0,_.c)(this._viewForward,e.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,O.JG)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,v.c)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,x.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}},{key:"copyViewFrom",value:function(e){this.eye=e.eye,this.center=e.center,this.up=e.up}},{key:"clone",value:function(){return(new r).copyFrom(this)}},{key:"equals",value:function(e){return(0,_.k)(this.eye,e.eye)&&(0,_.k)(this.center,e.center)&&(0,_.k)(this.up,e.up)&&(0,x.g)(this._viewport,e.viewport)&&(0,x.g)(this._padding,e.padding)&&(0,m.m)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}},{key:"almostEquals",value:function(e){if(Math.abs(e.fov-this._fov)>=.001||(0,x.i)(e.padding,this._padding)>=.5||(0,x.i)(this.screenViewport,e.screenViewport)>=.5)return!1;(0,_.w)(D,e.eye,e.center),(0,_.w)(M,this.eye,this.center);var t=(0,_.e)(D,M),n=(0,_.D)(D),r=(0,_.D)(M),i=5e-4;return t*t>=(1-1e-10)*n*r&&(0,_.E)(e.eye,this.eye)<Math.max(n,r)*i*i}},{key:"computeRenderPixelSizeAt",value:function(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}},{key:"computeRenderPixelSizeAtDist",value:function(e){return e*this.perRenderPixelRatio}},{key:"computeScreenPixelSizeAt",value:function(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}},{key:"_viewDirectionDistance",value:function(e){return Math.abs((0,b.SR)(this.viewForward,(0,_.b)(D,e,this.eye)))}},{key:"computeScreenPixelSizeAtDist",value:function(e){return e*this.perScreenPixelRatio}},{key:"computeDistanceFromRadius",value:function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}},{key:"getScreenCenter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.s1)();return e[0]=(this.padding[R.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[R.TOP]+this.height/2)/this.pixelRatio,e}},{key:"getRenderCenter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e[0]=this.padding[R.LEFT]+this.width*t,e[1]=this.padding[R.BOTTOM]+this.height*n,e[2]=.5,e}},{key:"setGLViewport",value:function(e){var t=this.viewport,n=this.padding;e.setViewport(t[0]-n[3],t[1]-n[2],t[2]+n[1]+n[3],t[3]+n[0]+n[2])}},{key:"applyProjection",value:function(e,t){e!==P&&(0,_.c)(P,e),P[3]=1,(0,x.t)(P,P,this.projectionMatrix);var n=Math.abs(P[3]);(0,_.g)(P,P,1/n);var r=this.fullViewport;t[0]=(0,d.t7)(0,r[0]+r[2],.5+.5*P[0]),t[1]=(0,d.t7)(0,r[1]+r[3],.5+.5*P[1]),t[2]=.5*(P[2]+1),t[3]=n}},{key:"unapplyProjection",value:function(e,t){var n=this.fullViewport;P[0]=(e[0]/(n[0]+n[2])*2-1)*e[3],P[1]=(e[1]/(n[1]+n[3])*2-1)*e[3],P[2]=(2*e[2]-1)*e[3],P[3]=e[3],null!=this.inverseProjectionMatrix&&((0,x.t)(P,P,this.inverseProjectionMatrix),t[0]=P[0],t[1]=P[1],t[2]=P[2])}},{key:"projectToScreen",value:function(e,t){return this.projectToRenderScreen(e,N),this.renderToScreen(N,t),t}},{key:"projectToRenderScreen",value:function(e,t){if(P[0]=e[0],P[1]=e[1],P[2]=e[2],P[3]=1,(0,x.t)(P,P,this.viewProjectionMatrix),0===P[3])return null;(0,_.g)(P,P,1/Math.abs(P[3]));var n=this.fullViewport;return"x"in t?(t.x=(0,d.t7)(0,n[0]+n[2],.5+.5*P[0]),t.y=(0,d.t7)(0,n[1]+n[3],.5+.5*P[1])):(t[0]=(0,d.t7)(0,n[0]+n[2],.5+.5*P[0]),t[1]=(0,d.t7)(0,n[1]+n[3],.5+.5*P[1]),t.length>2&&(t[2]=.5*(P[2]+1))),t}},{key:"unprojectFromScreen",value:function(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,N),t)}},{key:"unprojectFromRenderScreen",value:function(e,t){if((0,v.m)(I,this.projectionMatrix,this.viewMatrix),!(0,v.a)(I,I))return null;var n=this.fullViewport;return P[0]=2*(e[0]-n[0])/n[2]-1,P[1]=2*(e[1]-n[1])/n[3]-1,P[2]=2*e[2]-1,P[3]=1,(0,x.t)(P,P,I),0===P[3]?null:(t[0]=P[0]/P[3],t[1]=P[1]/P[3],t[2]=P[2]/P[3],t)}},{key:"constrainWindowSize",value:function(e,t,n,r){var i=e*this.pixelRatio,a=t*this.pixelRatio,o=Math.max(i-n/2,0),s=Math.max(this.fullHeight-a-r/2,0),u=-Math.min(i-n/2,0),l=-Math.min(this.fullHeight-a-r/2,0);return[o,s,n-u- -Math.min(this.fullWidth-i-n/2,0),r-l- -Math.min(a-r/2,0)]}},{key:"computeUp",value:function(e){e===C.JY.Global?this._computeUpGlobal():this._computeUpLocal()}},{key:"screenToRender",value:function(e,t){var n=e[0]*this.pixelRatio,r=this.fullHeight-e[1]*this.pixelRatio;return t[0]=n,t[1]=r,t}},{key:"renderToScreen",value:function(e,t){var n=e[0]/this.pixelRatio,r=(this.fullHeight-e[1])/this.pixelRatio;t[0]=n,t[1]=r}},{key:"_computeUpGlobal",value:function(){(0,_.b)(D,this.center,this.eye);var e=(0,_.l)(this.center);e<1?((0,_.s)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,_.e)(D,this.center))>.9999*(0,_.l)(D)*e||((0,_.f)(this._up,D,this.center),(0,_.f)(this._up,this._up,D),(0,_.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}},{key:"_computeUpLocal",value:function(){(0,_.r)(D,this.eye,this.center),Math.abs(D[2])<=.9999&&((0,_.g)(D,D,D[2]),(0,_.s)(this._up,-D[0],-D[1],1-D[2]),(0,_.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}},{key:"_compareAndSetView",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,_.k)(e,t)||((0,_.c)(t,e),this._markViewDirty(),n.length&&this.notifyChange(n)):c.Z.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}},{key:"_markViewDirty",value:function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}},{key:"_recomputeFrustum",value:function(){this._frustumDirty&&((0,O.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}},{key:"_ensureViewClean",value:function(){this._viewDirty&&((0,v.u)(this._viewMatrix,this.eye,this.center,this.up),(0,_.s)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),(0,_.s)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),(0,_.s)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}]),n}(l.Z);(0,u._)([(0,f.Cb)()],A.prototype,"_center",void 0),(0,u._)([(0,f.Cb)()],A.prototype,"_up",void 0),(0,u._)([(0,f.Cb)()],A.prototype,"_viewport",void 0),(0,u._)([(0,f.Cb)()],A.prototype,"_padding",void 0),(0,u._)([(0,f.Cb)()],A.prototype,"_fov",void 0),(0,u._)([(0,f.Cb)()],A.prototype,"_nearFar",void 0),(0,u._)([(0,f.Cb)()],A.prototype,"_pixelRatio",void 0),(0,u._)([(0,f.Cb)()],A.prototype,"pixelRatio",null),(0,u._)([(0,f.Cb)()],A.prototype,"eye",null),(0,u._)([(0,f.Cb)()],A.prototype,"center",null),(0,u._)([(0,f.Cb)()],A.prototype,"up",null),(0,u._)([(0,f.Cb)({readOnly:!0})],A.prototype,"nearFar",null),(0,u._)([(0,f.Cb)()],A.prototype,"near",null),(0,u._)([(0,f.Cb)()],A.prototype,"far",null),(0,u._)([(0,f.Cb)()],A.prototype,"viewport",null),(0,u._)([(0,f.Cb)({readOnly:!0})],A.prototype,"screenViewport",null),(0,u._)([(0,f.Cb)()],A.prototype,"x",null),(0,u._)([(0,f.Cb)()],A.prototype,"y",null),(0,u._)([(0,f.Cb)()],A.prototype,"width",null),(0,u._)([(0,f.Cb)()],A.prototype,"height",null),(0,u._)([(0,f.Cb)()],A.prototype,"fullWidth",null),(0,u._)([(0,f.Cb)()],A.prototype,"fullHeight",null),(0,u._)([(0,f.Cb)({readOnly:!0})],A.prototype,"_aspect",null),(0,u._)([(0,f.Cb)()],A.prototype,"padding",null),(0,u._)([(0,f.Cb)({readOnly:!0})],A.prototype,"projectionMatrix",null),(0,u._)([(0,f.Cb)({readOnly:!0})],A.prototype,"inverseProjectionMatrix",null),(0,u._)([(0,f.Cb)()],A.prototype,"fov",null),(0,u._)([(0,f.Cb)()],A.prototype,"fovX",null),(0,u._)([(0,f.Cb)()],A.prototype,"fovY",null),A=r=(0,u._)([(0,p.j)("esri.views.3d.webgl-engine.lib.Camera")],A);var R,E,P=(0,S.c)(),I=(0,g.c)(),D=(0,T.c)(),M=(0,T.c)(),N=(0,h.J$)();(E=R||(R={}))[E.TOP=0]="TOP",E[E.RIGHT=1]="RIGHT",E[E.BOTTOM=2]="BOTTOM",E[E.LEFT=3]="LEFT"},78976:function(e,t,n){n.d(t,{as:function(){return o},t9:function(){return u}});var r=n(15671),i=n(43144),a=n(27546),o=function(){function e(){(0,r.Z)(this,e),this.adds=new a.Z,this.removes=new a.Z,this.updates=new a.Z({allocator:function(e){return e||new s},deallocator:function(e){return e.renderGeometry=null,e}})}return(0,i.Z)(e,[{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.updates.clear()}},{key:"prune",value:function(){this.adds.prune(),this.removes.prune(),this.updates.prune()}},{key:"empty",get:function(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}]),e}(),s=(0,i.Z)((function e(){(0,r.Z)(this,e)})),u=(0,i.Z)((function e(){(0,r.Z)(this,e),this.adds=new Array,this.removes=new Array,this.updates=new Array}))},88699:function(e,t,n){n.d(t,{QZ:function(){return a},Rq:function(){return o},bg:function(){return i}});var r=n(18722);function i(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=r.DB?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function a(e){return length<=r.DB?Array.from(e):new Float64Array(e)}function o(e,t,n){return Array.isArray(e)?e.slice(t,t+n):e.subarray(t,t+n)}},73840:function(e,t,n){n.d(t,{AA:function(){return o},XO:function(){return a},xx:function(){return i}});var r=n(18722);function i(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=r.DB?t?new Array(e).fill(0):new Array(e):new Float32Array(e)}function a(e){return length<=r.DB?Array.from(e):new Float32Array(e)}function o(e,t,n){return Array.isArray(e)?e.slice(t,t+n):e.subarray(t,t+n)}},53252:function(e,t,n){n.d(t,{h:function(){return l}});var r=n(15671),i=n(43144),a=n(32718),o=n(92026),s=n(59447),u=n(97731),l=function(){function e(t,n,i,a){(0,r.Z)(this,e),this._textureRepository=t,this._techniqueRepository=n,this.materialChanged=i,this.requestRender=a,this._id2glMaterialRef=new s.r}return(0,i.Z)(e,[{key:"dispose",value:function(){this._textureRepository.destroy()}},{key:"acquire",value:function(e,t,n){if(this._ownMaterial(e),!e.requiresSlot(t,n))return null;var r=this._id2glMaterialRef.get(n,e.id);if((0,o.Wi)(r)){var i=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:n});r=new c(i),this._id2glMaterialRef.set(n,e.id,r)}return r.ref(),r.glMaterial}},{key:"release",value:function(e,t){var n=this._id2glMaterialRef.get(t,e.id);(0,o.pC)(n)&&(n.unref(),n.referenced||((0,o.M2)(n.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}},{key:"_ownMaterial",value:function(e){(0,o.pC)(e.repository)&&e.repository!==this&&a.Z.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}]),e}(),c=function(){function e(t){(0,r.Z)(this,e),this.glMaterial=t,this._refCnt=0}return(0,i.Z)(e,[{key:"ref",value:function(){++this._refCnt}},{key:"unref",value:function(){--this._refCnt,(0,u.hu)(this._refCnt>=0)}},{key:"referenced",get:function(){return this._refCnt>0}}]),e}()},94425:function(e,t,n){n.d(t,{p:function(){return s}});var r=n(15671),i=n(43144),a=n(92026),o=n(68401),s=function(){function e(t,n){(0,r.Z)(this,e),this._material=t,this._repository=n,this._map=new Map}return(0,i.Z)(e,[{key:"destroy",value:function(){var e=this;this._map.forEach((function(t,n){(0,a.pC)(t)&&e._repository.release(e._material,n)}))}},{key:"load",value:function(e,t,n){if(!this._material.requiresSlot(t,n))return null;this._map.has(n)||this._map.set(n,this._repository.acquire(this._material,t,n));var r=this._map.get(n);if((0,a.pC)(r)){if(r.ensureResources(e)===o.Rw.LOADED)return r;this._repository.requestRender()}return null}}]),e}()},70619:function(e,t,n){n.d(t,{Cr:function(){return se},IG:function(){return R},QL:function(){return ee},nb:function(){return te},B2:function(){return M},DA:function(){return ae},x2:function(){return re},dV:function(){return $},xu:function(){return X},mj:function(){return Y},rh:function(){return ie},PI:function(){return J},g7:function(){return Q},AW:function(){return q},PD:function(){return ne},Ay:function(){return le},mx:function(){return oe}});var r,i=n(92026),a=n(11186),o=n(8229),s=n(71353),u=n(55652),l=n(40885),c=n(91526);!function(e){e.length=function(e,t){var n=e[t],r=e[t+1],i=e[t+2];return Math.sqrt(n*n+r*r+i*i)},e.normalize=function(e,t){var n=e[t],r=e[t+1],i=e[t+2],a=1/Math.sqrt(n*n+r*r+i*i);e[t]*=a,e[t+1]*=a,e[t+2]*=a},e.scale=function(e,t,n){e[t]*=n,e[t+1]*=n,e[t+2]*=n},e.add=function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(i=i||e)[a]=e[t]+n[r],i[a+1]=e[t+1]+n[r+1],i[a+2]=e[t+2]+n[r+2]},e.subtract=function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(i=i||e)[a]=e[t]-n[r],i[a+1]=e[t+1]-n[r+1],i[a+2]=e[t+2]-n[r+2]}}(r||(r={}));for(var d=n(79100),h=n(88699),f=n(73840),p=n(40779),v=n(72838),g=n(97731),m=n(4760),y=r,_=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],T=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],x=[0,0,1,0,1,1,0,1],S=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],O=new Array(36),w=0;w<6;w++)for(var b=0;b<6;b++)O[6*w+b]=w;for(var C=new Array(36),A=0;A<6;A++)C[6*A+0]=0,C[6*A+1]=1,C[6*A+2]=2,C[6*A+3]=2,C[6*A+4]=3,C[6*A+5]=0;function R(e,t){Array.isArray(t)||(t=[t,t,t]);for(var n=new Array(24),r=0;r<8;r++)n[3*r]=_[r][0]*t[0],n[3*r+1]=_[r][1]*t[1],n[3*r+2]=_[r][2]*t[2];return new p.Z(e,[[m.T.POSITION,new c.a(n,3,!0)],[m.T.NORMAL,new c.a(T,3)],[m.T.UV0,new c.a(x,2)]],[[m.T.POSITION,S],[m.T.NORMAL,O],[m.T.UV0,C]])}var E=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],P=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],I=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],D=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function M(e,t){Array.isArray(t)||(t=[t,t,t]);for(var n=new Array(18),r=0;r<6;r++)n[3*r]=E[r][0]*t[0],n[3*r+1]=E[r][1]*t[1],n[3*r+2]=E[r][2]*t[2];return new p.Z(e,[[m.T.POSITION,new c.a(n,3,!0)],[m.T.NORMAL,new c.a(P,3)]],[[m.T.POSITION,I],[m.T.NORMAL,D]])}var N=(0,o.f)(-.5,0,-.5),Z=(0,o.f)(.5,0,-.5),L=(0,o.f)(0,0,.5),k=(0,o.f)(0,.5,0),H=(0,o.c)(),F=(0,o.c)(),z=(0,o.c)(),U=(0,o.c)(),j=(0,o.c)();(0,a.b)(H,N,k),(0,a.b)(F,N,Z),(0,a.f)(z,H,F),(0,a.n)(z,z),(0,a.b)(H,Z,k),(0,a.b)(F,Z,L),(0,a.f)(U,H,F),(0,a.n)(U,U),(0,a.b)(H,L,k),(0,a.b)(F,L,N),(0,a.f)(j,H,F),(0,a.n)(j,j);var V=[N,Z,L,k],W=[0,-1,0,z[0],z[1],z[2],U[0],U[1],U[2],j[0],j[1],j[2]],B=[0,1,2,3,1,0,3,2,1,3,0,2],G=[0,0,0,1,1,1,2,2,2,3,3,3];function q(e,t){Array.isArray(t)||(t=[t,t,t]);for(var n=new Array(12),r=0;r<4;r++)n[3*r]=V[r][0]*t[0],n[3*r+1]=V[r][1]*t[1],n[3*r+2]=V[r][2]*t[2];return new p.Z(e,[[m.T.POSITION,new c.a(n,3,!0)],[m.T.NORMAL,new c.a(W,3)]],[[m.T.POSITION,B],[m.T.NORMAL,G]])}function J(e,t,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{uv:!0},a=-Math.PI,o=2*Math.PI,s=-Math.PI/2,u=Math.PI,l=Math.max(3,Math.floor(n)),d=Math.max(2,Math.floor(r)),h=(l+1)*(d+1),v=(0,f.xx)(3*h),g=(0,f.xx)(3*h),y=(0,f.xx)(2*h),_=[],T=0,x=0;x<=d;x++){for(var S=[],O=x/d,w=s+O*u,b=Math.cos(w),C=0;C<=l;C++){var A=C/l,R=a+A*o,E=Math.cos(R)*b,P=Math.sin(w),I=-Math.sin(R)*b;v[3*T]=E*t,v[3*T+1]=P*t,v[3*T+2]=I*t,g[3*T]=E,g[3*T+1]=P,g[3*T+2]=I,y[2*T]=A,y[2*T+1]=O,S.push(T),++T}_.push(S)}for(var D=new Array,M=0;M<d;M++)for(var N=0;N<l;N++){var Z=_[M][N],L=_[M][N+1],k=_[M+1][N+1],H=_[M+1][N];0===M?(D.push(Z),D.push(k),D.push(H)):M===d-1?(D.push(Z),D.push(L),D.push(k)):(D.push(Z),D.push(L),D.push(k),D.push(k),D.push(H),D.push(Z))}var F=[[m.T.POSITION,D],[m.T.NORMAL,D]],z=[[m.T.POSITION,new c.a(v,3,!0)],[m.T.NORMAL,new c.a(g,3,!0)]];return i.uv&&(z.push([m.T.UV0,new c.a(y,2,!0)]),F.push([m.T.UV0,D])),i.offset&&(F[0][0]=m.T.OFFSET,z[0][0]=m.T.OFFSET,F.push([m.T.POSITION,new Array(D.length).fill(0)]),z.push([m.T.POSITION,new c.a(Float64Array.from(i.offset),3,!0)])),new p.Z(e,z,F)}function Y(e,t,n,r){var i=X(t,n,r),a=i.vertexAttributes,o=i.indices;return new p.Z(e,a,o)}function X(e,t,n){var r,i,a=e;if(n)r=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],i=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{var o=a*(1+Math.sqrt(5))/2;r=[-a,o,0,a,o,0,-a,-o,0,a,-o,0,0,-a,o,0,a,o,0,-a,-o,0,a,-o,o,0,-a,o,0,a,-o,0,-a,-o,0,a],i=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(var s=0;s<r.length;s+=3)y.scale(r,s,e/y.length(r,s));var u={};function l(t,n){var i;t>n&&(t=(i=[n,t])[0],n=i[1]);var a=t.toString()+"."+n.toString();if(u[a])return u[a];var o=r.length;return r.length+=3,y.add(r,3*t,r,3*n,r,o),y.scale(r,o,e/y.length(r,o)),o/=3,u[a]=o,o}for(var d=0;d<t;d++){for(var h=i.length,p=new Array(4*h),v=0;v<h;v+=3){var g=i[v],_=i[v+1],T=i[v+2],x=l(g,_),S=l(_,T),O=l(T,g),w=4*v;p[w]=g,p[w+1]=x,p[w+2]=O,p[w+3]=_,p[w+4]=S,p[w+5]=x,p[w+6]=T,p[w+7]=O,p[w+8]=S,p[w+9]=x,p[w+10]=S,p[w+11]=O}i=p,u={}}for(var b=(0,f.XO)(r),C=0;C<b.length;C+=3)y.normalize(b,C);var A=[[m.T.POSITION,i],[m.T.NORMAL,i]];return{vertexAttributes:[[m.T.POSITION,new c.a((0,f.XO)(r),3,!0)],[m.T.NORMAL,new c.a(b,3,!0)]],indices:A}}function $(e,t,n,r,a,o,s,u){var l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=n?[n[0],n[1],n[2]]:[0,0,0],f=t?[t[0],t[1],t[2]]:[0,0,1];s=s||[0,0];var v=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],g=(0,i.pC)(a)&&2===a.length?a:[1,1],y=[[m.T.POSITION,new c.a(h,3,!0)],[m.T.NORMAL,new c.a(f,3,!0)],[m.T.UV0,new c.a(s,s.length)],[m.T.COLOR,new c.a(v,4,!0)],[m.T.SIZE,new c.a(g,2)]];if(null!=o){var _=[o[0],o[1],o[2],o[3]];y.push([m.T.AUXPOS1,new c.a(_,4)])}if(null!=u){var T=[u[0],u[1],u[2],u[3]];y.push([m.T.AUXPOS2,new c.a(T,4)])}return new p.Z(e,y,null,null,d.U.Point,l)}var K=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function Q(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K,n=new Array(12),r=0;r<4;r++)for(var i=0;i<3;i++)n[3*r+i]=t[r][i];var a=[0,1,2,2,3,0],o=[0,0,1],s=[0,0,0,0,0,0],u=[0,0,1,0,1,1,0,1],l=[255,255,255,255],d=[[m.T.POSITION,a],[m.T.NORMAL,s],[m.T.UV0,a],[m.T.COLOR,s]],h=[[m.T.POSITION,new c.a(n,3,!0)],[m.T.NORMAL,new c.a(o,3,!0)],[m.T.UV0,new c.a(u,2,!0)],[m.T.COLOR,new c.a(l,4,!0)]];return new p.Z(e,h,d)}function ee(e,t,n,r,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=0,l=n,d=t,h=(0,o.f)(0,u,0),v=(0,o.f)(0,u+d,0),g=(0,o.f)(0,-1,0),y=(0,o.f)(0,1,0);i&&(u=d,v=(0,o.f)(0,0,0),h=(0,o.f)(0,u,0),g=(0,o.f)(0,1,0),y=(0,o.f)(0,-1,0));var _=[v,h],T=[g,y],x=r+2,S=Math.sqrt(d*d+l*l);if(i)for(var O=r-1;O>=0;O--){var w=O*(2*Math.PI/r),b=(0,o.f)(Math.cos(w)*l,u,Math.sin(w)*l);_.push(b);var C=(0,o.f)(d*Math.cos(w)/S,-l/S,d*Math.sin(w)/S);T.push(C)}else for(var A=0;A<r;A++){var R=A*(2*Math.PI/r),E=(0,o.f)(Math.cos(R)*l,u,Math.sin(R)*l);_.push(E);var P=(0,o.f)(d*Math.cos(R)/S,l/S,d*Math.sin(R)/S);T.push(P)}var I=new Array,D=new Array;if(a){for(var M=3;M<_.length;M++)I.push(1),I.push(M-1),I.push(M),D.push(0),D.push(0),D.push(0);I.push(_.length-1),I.push(2),I.push(1),D.push(0),D.push(0),D.push(0)}if(s){for(var N=3;N<_.length;N++)I.push(N),I.push(N-1),I.push(0),D.push(N),D.push(N-1),D.push(1);I.push(0),I.push(2),I.push(_.length-1),D.push(1),D.push(2),D.push(T.length-1)}for(var Z=(0,f.xx)(3*x),L=0;L<x;L++)Z[3*L]=_[L][0],Z[3*L+1]=_[L][1],Z[3*L+2]=_[L][2];for(var k=(0,f.xx)(3*x),H=0;H<x;H++)k[3*H]=T[H][0],k[3*H+1]=T[H][1],k[3*H+2]=T[H][2];var F=[[m.T.POSITION,I],[m.T.NORMAL,D]],z=[[m.T.POSITION,new c.a(Z,3,!0)],[m.T.NORMAL,new c.a(k,3,!0)]];return new p.Z(e,z,F)}function te(e,t,n,r,i,s,u){var l,d=i?(0,o.b)(i):(0,o.f)(1,0,0),h=s?(0,o.b)(s):(0,o.f)(0,0,0);u=null===(l=u)||void 0===l||l;var v=(0,o.c)();(0,a.n)(v,d);var g=(0,o.c)();(0,a.g)(g,v,Math.abs(t));var y=(0,o.c)();(0,a.g)(y,g,-.5),(0,a.a)(y,y,h);var _=(0,o.f)(0,1,0);Math.abs(1-(0,a.e)(v,_))<.2&&(0,a.s)(_,0,0,1);var T=(0,o.c)();(0,a.f)(T,v,_),(0,a.n)(T,T),(0,a.f)(_,T,v);var x=2*r+(u?2:0),S=r+(u?2:0),O=(0,f.xx)(3*x),w=(0,f.xx)(3*S),b=(0,f.xx)(2*x),C=new Array(3*r*(u?4:2)),A=new Array(3*r*(u?4:2));u&&(O[3*(x-2)+0]=y[0],O[3*(x-2)+1]=y[1],O[3*(x-2)+2]=y[2],b[2*(x-2)]=0,b[2*(x-2)+1]=0,O[3*(x-1)+0]=O[3*(x-2)+0]+g[0],O[3*(x-1)+1]=O[3*(x-2)+1]+g[1],O[3*(x-1)+2]=O[3*(x-2)+2]+g[2],b[2*(x-1)]=1,b[2*(x-1)+1]=1,w[3*(S-2)+0]=-v[0],w[3*(S-2)+1]=-v[1],w[3*(S-2)+2]=-v[2],w[3*(S-1)+0]=v[0],w[3*(S-1)+1]=v[1],w[3*(S-1)+2]=v[2]);for(var R=function(e,t,n){C[e]=t,A[e]=n},E=0,P=(0,o.c)(),I=(0,o.c)(),D=0;D<r;D++){var M=D*(2*Math.PI/r);(0,a.g)(P,_,Math.sin(M)),(0,a.g)(I,T,Math.cos(M)),(0,a.a)(P,P,I),w[3*D+0]=P[0],w[3*D+1]=P[1],w[3*D+2]=P[2],(0,a.g)(P,P,n),(0,a.a)(P,P,y),O[3*D+0]=P[0],O[3*D+1]=P[1],O[3*D+2]=P[2],b[2*D+0]=D/r,b[2*D+1]=0,O[3*(D+r)+0]=O[3*D+0]+g[0],O[3*(D+r)+1]=O[3*D+1]+g[1],O[3*(D+r)+2]=O[3*D+2]+g[2],b[2*(D+r)+0]=D/r,b[2*D+1]=1;var N=(D+1)%r;R(E++,D,D),R(E++,D+r,D),R(E++,N,N),R(E++,N,N),R(E++,D+r,D),R(E++,N+r,N)}if(u){for(var Z=0;Z<r;Z++){var L=(Z+1)%r;R(E++,x-2,S-2),R(E++,Z,S-2),R(E++,L,S-2)}for(var k=0;k<r;k++){var H=(k+1)%r;R(E++,k+r,S-1),R(E++,x-1,S-1),R(E++,H+r,S-1)}}var F=[[m.T.POSITION,C],[m.T.NORMAL,A],[m.T.UV0,C]],z=[[m.T.POSITION,new c.a(O,3,!0)],[m.T.NORMAL,new c.a(w,3,!0)],[m.T.UV0,new c.a(b,2,!0)]];return new p.Z(e,z,F)}function ne(e,t,n,r,i,a){r=r||10,i=null==i||i,(0,g.hu)(t.length>1);for(var o=[],s=[],u=0;u<r;u++){o.push([0,-u-1,-(u+1)%r-1]);var l=u/r*2*Math.PI;s.push([Math.cos(l)*n,Math.sin(l)*n])}return re(e,s,t,[[0,0,0]],o,i,a)}function re(e,t,n,r,i,d){var h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,o.f)(0,0,0),v=t.length,g=(0,f.xx)(n.length*v*3+(6*r.length||0)),y=(0,f.xx)(n.length*v*3+(r?6:0)),_=new Array,T=new Array,x=0,S=0,O=(0,o.c)(),w=(0,o.c)(),b=(0,o.c)(),C=(0,o.c)(),A=(0,o.c)(),R=(0,o.c)(),E=(0,o.c)(),P=(0,s.c)(),I=(0,o.c)(),D=(0,o.c)(),M=(0,o.c)(),N=(0,o.c)(),Z=(0,o.c)(),L=(0,u.Ue)();(0,a.s)(I,0,1,0),(0,a.b)(w,n[1],n[0]),(0,a.n)(w,w),d?((0,a.a)(P,n[0],h),(0,a.n)(b,P)):(0,a.s)(b,0,0,1),le(w,b,I,I,A,b,ce),(0,a.c)(C,b),(0,a.c)(N,A);for(var k=0;k<r.length;k++)(0,a.g)(R,A,r[k][0]),(0,a.g)(P,b,r[k][2]),(0,a.a)(R,R,P),(0,a.a)(R,R,n[0]),g[x++]=R[0],g[x++]=R[1],g[x++]=R[2];y[S++]=-w[0],y[S++]=-w[1],y[S++]=-w[2];for(var H=0;H<i.length;H++)_.push(i[H][0]>0?i[H][0]:-i[H][0]-1+r.length),_.push(i[H][1]>0?i[H][1]:-i[H][1]-1+r.length),_.push(i[H][2]>0?i[H][2]:-i[H][2]-1+r.length),T.push(0),T.push(0),T.push(0);for(var F=r.length,z=r.length-1,U=0;U<n.length;U++){var j=!1;U>0&&((0,a.c)(O,w),U<n.length-1?((0,a.b)(w,n[U+1],n[U]),(0,a.n)(w,w)):j=!0,(0,a.a)(D,O,w),(0,a.n)(D,D),(0,a.a)(M,n[U-1],C),(0,u.Yq)(n[U],D,L),(0,u.BR)(L,(0,l.re)(M,O),P)?((0,a.b)(P,P,n[U]),(0,a.n)(b,P),(0,a.f)(A,D,b),(0,a.n)(A,A)):le(D,C,N,I,A,b,ce),(0,a.c)(C,b),(0,a.c)(N,A)),d&&((0,a.a)(P,n[U],h),(0,a.n)(Z,P));for(var V=0;V<v;V++)if((0,a.g)(R,A,t[V][0]),(0,a.g)(P,b,t[V][1]),(0,a.a)(R,R,P),(0,a.n)(E,R),y[S++]=E[0],y[S++]=E[1],y[S++]=E[2],(0,a.a)(R,R,n[U]),g[x++]=R[0],g[x++]=R[1],g[x++]=R[2],!j){var W=(V+1)%v;_.push(F+V),_.push(F+v+V),_.push(F+W),_.push(F+W),_.push(F+v+V),_.push(F+v+W);for(var B=0;B<6;B++){var G=_.length-6;T.push(_[G+B]-z)}}F+=v}for(var q=n[n.length-1],J=0;J<r.length;J++)(0,a.g)(R,A,r[J][0]),(0,a.g)(P,b,r[J][1]),(0,a.a)(R,R,P),(0,a.a)(R,R,q),g[x++]=R[0],g[x++]=R[1],g[x++]=R[2];var Y=S/3;y[S++]=w[0],y[S++]=w[1],y[S++]=w[2];for(var X=F-v,$=0;$<i.length;$++)_.push(i[$][0]>=0?F+i[$][0]:-i[$][0]-1+X),_.push(i[$][2]>=0?F+i[$][2]:-i[$][2]-1+X),_.push(i[$][1]>=0?F+i[$][1]:-i[$][1]-1+X),T.push(Y),T.push(Y),T.push(Y);var K=[[m.T.POSITION,_],[m.T.NORMAL,T]],Q=[[m.T.POSITION,new c.a(g,3,!0)],[m.T.NORMAL,new c.a(y,3,!0)]];return new p.Z(e,Q,K)}function ie(e,t,n,r){(0,g.hu)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,g.hu)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,g.hu)(null==n||n.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,g.hu)(null==n||3===n[0].length,"createPolylineGeometry(): malformed normal");for(var i=(0,h.bg)(3*t.length),a=new Array(2*(t.length-1)),o=0,s=0,u=0;u<t.length;u++){for(var l=0;l<3;l++)i[o++]=t[u][l];u>0&&(a[s++]=u-1,a[s++]=u)}var y=[],_=[];if(y.push([m.T.POSITION,a]),_.push([m.T.POSITION,new c.a(i,3,!0)]),n){for(var T=(0,f.xx)(3*n.length),x=0,S=0;S<t.length;S++)for(var O=0;O<3;O++)T[x++]=n[S][O];y.push([m.T.NORMAL,a]),_.push([m.T.NORMAL,new c.a(T,3,!0)])}return r&&(_.push([m.T.COLOR,new c.a(r,4)]),y.push([m.T.COLOR,(0,v.p)(r.length/4)])),new p.Z(e,_,y,null,d.U.Line)}function ae(e,t,n,r,i){for(var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=new Array(18),s=[[-n,a,i/2],[r,a,i/2],[0,t+a,i/2],[-n,a,-i/2],[r,a,-i/2],[0,t+a,-i/2]],u=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],l=0;l<6;l++)o[3*l]=s[l][0],o[3*l+1]=s[l][1],o[3*l+2]=s[l][2];return new p.Z(e,[[m.T.POSITION,new c.a(o,3,!0)]],[[m.T.POSITION,u]])}function oe(e,t){for(var n=e.getMutableAttribute(m.T.POSITION).data,r=0;r<n.length;r+=3){var i=n[r],o=n[r+1],s=n[r+2];(0,a.s)(de,i,o,s),(0,a.m)(de,de,t),n[r]=de[0],n[r+1]=de[1],n[r+2]=de[2]}}function se(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=e.vertexAttributes,r=n.get(m.T.POSITION).data,i=n.get(m.T.NORMAL).data;if(i)for(var a=t.getMutableAttribute(m.T.NORMAL).data,o=0;o<i.length;o+=3){var s=i[o+1];a[o+1]=-i[o+2],a[o+2]=s}if(r)for(var u=t.getMutableAttribute(m.T.POSITION).data,l=0;l<r.length;l+=3){var c=r[l+1];u[l+1]=-r[l+2],u[l+2]=c}}function ue(e,t,n,r,i){return!(Math.abs((0,a.e)(t,e))>i)&&((0,a.f)(n,e,t),(0,a.n)(n,n),(0,a.f)(r,n,e),(0,a.n)(r,r),!0)}function le(e,t,n,r,i,a,o){return ue(e,t,i,a,o)||ue(e,n,i,a,o)||ue(e,r,i,a,o)}var ce=.99619469809,de=(0,o.c)()},19962:function(e,t,n){n.d(t,{C:function(){return x}});var r=n(93433),i=n(15671),a=n(43144),o=n(92026),s=n(95439),u=n(11186),l=n(71353),c=n(67077),d=n(79803),h=n(91526),f=n(79100),p=n(40779),v=n(61403),g=n(66327),m=n(17852),y=n(4760),_=n(97882),T=n(58901),x=function(){function e(t){(0,i.Z)(this,e),this._originSR=t,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+(0,s.D)()}return(0,a.Z)(e,[{key:"getOrigin",value:function(e){var t=this._origins.get(this._rootOriginId);if(null==t){var n=m.p.rootOrigin;if((0,o.pC)(n))return this._origins.set(this._rootOriginId,(0,v.a)(n[0],n[1],n[2],this._rootOriginId)),this.getOrigin(e);var i=(0,v.a)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,i),i}var a=this._gridSize,s=Math.round(e[0]/a),l=Math.round(e[1]/a),c=Math.round(e[2]/a),d="".concat(s,"/").concat(l,"/").concat(c),h=this._origins.get(d),f=.5*a;if((0,u.b)(S,e,t.vec3),S[0]=Math.abs(S[0]),S[1]=Math.abs(S[1]),S[2]=Math.abs(S[2]),S[0]<f&&S[1]<f&&S[2]<f){if(h){var p=Math.max.apply(Math,(0,r.Z)(S));if((0,u.b)(S,e,h.vec3),S[0]=Math.abs(S[0]),S[1]=Math.abs(S[1]),S[2]=Math.abs(S[2]),Math.max.apply(Math,(0,r.Z)(S))<p)return h}return t}return h||(h=(0,v.a)(s*a,l*a,c*a,d),this._origins.set(d,h)),h}},{key:"_drawOriginBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,c.f)(1,1,0,1),n=window.view,r=n._stage,i=t.toString();if(!this._objects.has(i)){this._material=new T.U({width:2,color:t}),r.add(this._material);var a=new _.F({pickable:!1}),o=new g.T({castShadow:!1});r.add(o),a.add(o),r.add(a),this._objects.set(i,o)}for(var s=this._objects.get(i),u=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=u.length,v=new Array(3*l),m=new Array,x=.5*this._gridSize,S=0;S<l;S++)v[3*S+0]=e[0]+(1&u[S]?x:-x),v[3*S+1]=e[1]+(2&u[S]?x:-x),v[3*S+2]=e[2]+(4&u[S]?x:-x),S>0&&m.push(S-1,S);(0,d.CM)(v,this._originSR,0,v,n.renderSpatialReference,0,l);var O=new p.Z(this._material,[[y.T.POSITION,new h.a(v,3,!0)]],[[y.T.POSITION,m]],null,f.U.Line);r.add(O),s.addGeometry(O)}},{key:"test",get:function(){var e=this;return{set gridSize(t){e._gridSize=t}}}}]),e}(),S=(0,l.c)()},88153:function(e,t,n){n.d(t,{LP:function(){return A},Z8:function(){return O},vh:function(){return x}});var r=n(60136),i=n(92572),a=n(37762),o=n(15671),s=n(43144),u=n(92026),l=n(14226),c=n(81949),d=n(11186),h=n(71353),f=n(90045),p=n(67077),v=n(40885),g=n(50951),m=n(54463),y=n(55848),_=n(22178),T=n(76783),x=1e-5,S=function(){function e(t){(0,o.Z)(this,e),this.options=new m.om,this._results=new w,this.transform=new T.yn,this.tolerance=x,this.verticalOffset=null,this._ray=(0,v.Ue)(),this._rayEnd=(0,h.c)(),this._rayBeginTransformed=(0,h.c)(),this._rayEndTransformed=(0,h.c)(),this.viewingMode=null!==t&&void 0!==t?t:g.JY.Global}return(0,s.Z)(e,[{key:"results",get:function(){return this._results}},{key:"ray",get:function(){return this._ray}},{key:"rayBegin",get:function(){return this._ray.origin}},{key:"rayEnd",get:function(){return this._rayEnd}},{key:"reset",value:function(e,t,n){this.resetWithRay((0,v.zk)(e,t,this._ray),n)}},{key:"resetWithRay",value:function(e,t){this.camera=t,e!==this._ray&&(0,v.JG)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===g.JY.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,d.a)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}},{key:"intersect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;this.point=n,this.filterPredicate=i,this.tolerance=null!==r&&void 0!==r?r:x;var s=(0,T.W9)(this.verticalOffset);(0,u.pC)(t)&&t.length>0&&function(){var n,r=o?function(t){o(t)&&e.intersectObject(t)}:function(t){e.intersectObject(t)},i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var l=n.value,c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();(0,u.pC)(c)?((0,u.pC)(s)?c.forEachAlongRayWithVerticalOffset(e._ray.origin,e._ray.direction,r,s):c.forEachAlongRay(e._ray.origin,e._ray.direction,r),e.options.selectionMode&&e.options.hud&&c.forEachDegenerateObject(r)):l.objects.forAll((function(e){return r(e)}))}}catch(d){i.e(d)}finally{i.f()}}(),this.sortResults()}},{key:"intersectObject",value:function(e){var t=this,n=e.geometries;if(n){var r,i=e.transformation,o=(0,T.W9)(this.verticalOffset),s=(0,a.Z)(n);try{var l=function(){var n=r.value;if(!n.visible)return"continue";var a=n.material,s=n.id;t.transform.setAndInvalidateLazyTransforms(i,n.shaderTransformation),(0,d.m)(t._rayBeginTransformed,t.rayBegin,t.transform.inverse),(0,d.m)(t._rayEndTransformed,t.rayEnd,t.transform.inverse);var l=t.transform.transform;(0,u.pC)(o)&&(o.objectTransform=t.transform),a.intersect(n,t.transform.transform,t,t._rayBeginTransformed,t._rayEndTransformed,(function(n,r,i,a,o,d){if(n>=0){if((0,u.pC)(t.filterPredicate)&&!t.filterPredicate(t._ray.origin,t._rayEnd,n))return;var h=a?t._results.hud:t._results,f=a?function(t){var a=new y.RA(e,s,i,d);t.set(m.q7.HUD,a,n,r,c.I,o)}:function(t){return t.set(m.q7.OBJECT,{object:e,geometryId:s,triangleNr:i},n,r,l,o)};if((null==h.min.drapedLayerOrder||o>=h.min.drapedLayerOrder)&&(null==h.min.dist||n<h.min.dist)&&f(h.min),t.options.store!==m.eC.MIN&&(null==h.max.drapedLayerOrder||o<h.max.drapedLayerOrder)&&(null==h.max.dist||n>h.max.dist)&&f(h.max),t.options.store===m.eC.ALL)if(a){var p=new C(t._ray);f(p),t._results.hud.all.push(p)}else{var v=new b(t._ray);f(v),t._results.all.push(v)}}}))};for(s.s();!(r=s.n()).done;)l()}catch(h){s.e(h)}finally{s.f()}}}},{key:"sortResults",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._results.all;e.sort((function(e,t){return e.dist!==t.dist?(0,u.Pt)(e.dist,0)-(0,u.Pt)(t.dist,0):e.drapedLayerOrder!==t.drapedLayerOrder?(0,u.Pt)(e.drapedLayerOrder,Number.MAX_VALUE)-(0,u.Pt)(t.drapedLayerOrder,Number.MAX_VALUE):(0,u.Pt)(t.drapedLayerGraphicOrder,Number.MIN_VALUE)-(0,u.Pt)(e.drapedLayerGraphicOrder,Number.MIN_VALUE)}))}}]),e}();function O(e){return new S(e)}var w=function(){function e(){(0,o.Z)(this,e),this.min=new b((0,v.Ue)()),this.max=new b((0,v.Ue)()),this.hud={min:new C((0,v.Ue)()),max:new C((0,v.Ue)()),all:new Array},this.ground=new b((0,v.Ue)()),this.all=[]}return(0,s.Z)(e,[{key:"init",value:function(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}]),e}(),b=function(){function e(t){(0,o.Z)(this,e),this.intersector=m.q7.OBJECT,this.normal=(0,h.c)(),this.transformation=(0,c.c)(),this._ray=(0,v.Ue)(),this.init(t)}return(0,s.Z)(e,[{key:"ray",get:function(){return this._ray}},{key:"distanceInRenderSpace",get:function(){return(0,u.pC)(this.dist)?((0,d.g)(R,this.ray.direction,this.dist),(0,d.l)(R)):null}},{key:"getIntersectionPoint",value:function(e){return!!(0,_.nn)(this)&&((0,d.g)(R,this.ray.direction,this.dist),(0,d.a)(e,this.ray.origin,R),!0)}},{key:"getTransformedNormal",value:function(e){return(0,d.c)(E,this.normal),E[3]=0,(0,f.t)(E,E,this.transformation),(0,d.c)(e,E),(0,d.n)(e,e)}},{key:"init",value:function(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=m.q7.OBJECT,(0,v.JG)(e,this._ray)}},{key:"set",value:function(e,t,n,r,i,a,o){this.intersector=e,this.dist=n,(0,d.c)(this.normal,(0,u.Pt)(r,h.U)),(0,l.c)(this.transformation,(0,u.Pt)(i,c.I)),this.target=t,this.drapedLayerOrder=a,this.drapedLayerGraphicOrder=o}},{key:"copy",value:function(e){(0,v.JG)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,d.c)(this.normal,e.normal),(0,l.c)(this.transformation,e.transformation)}}]),e}(),C=function(e){(0,r.Z)(n,e);var t=(0,i.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).intersector=m.q7.HUD,e}return(0,s.Z)(n)}(b);function A(e){return new b(e)}var R=(0,h.c)(),E=(0,p.c)()},54463:function(e,t,n){n.d(t,{eC:function(){return i},om:function(){return s},q7:function(){return r}});var r,i,a=n(43144),o=n(15671);!function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"}(r||(r={}));var s=(0,a.Z)((function e(){(0,o.Z)(this,e),this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=i.ALL}));!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(i||(i={}))},55848:function(e,t,n){n.d(t,{Dx:function(){return d},RA:function(){return l},Zh:function(){return c}});var r=n(60136),i=n(92572),a=n(43144),o=n(15671),s=n(92026),u=n(71353),l=function(e){(0,r.Z)(n,e);var t=(0,i.Z)(n);function n(e,r,i,a){var l;return(0,o.Z)(this,n),(l=t.call(this,e,r,i)).center=(0,s.pC)(a)?(0,u.a)(a):null,l}return(0,a.Z)(n)}((0,a.Z)((function e(t,n,r){(0,o.Z)(this,e),this.object=t,this.geometryId=n,this.triangleNr=r}))),c=(0,a.Z)((function e(t){(0,o.Z)(this,e),this.layerUid=t})),d=function(e){(0,r.Z)(n,e);var t=(0,i.Z)(n);function n(e,r){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).graphicUid=r,i}return(0,a.Z)(n)}(c)},61403:function(e,t,n){n.d(t,{a:function(){return s}});var r=n(43144),i=n(15671),a=n(71353),o=(0,r.Z)((function e(t,n){(0,i.Z)(this,e),this.vec3=t,this.id=n}));function s(e,t,n,r){return new o((0,a.f)(e,t,n),r)}},78289:function(e,t,n){var r,i;n.d(t,{$:function(){return i},T:function(){return r}}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(r||(r={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(i||(i={}))},66327:function(e,t,n){n.d(t,{T:function(){return x}});var r=n(37762),i=n(15671),a=n(43144),o=n(60136),s=n(92572),u=n(92026),l=n(14226),c=n(81949),d=n(11186),h=n(71353),f=n(23470),p=n(80064),v=n(68401),g=n(1395),m=n(79100),y=n(47669),_=n(97731),T=n(32683),x=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.Z)(this,n),(e=t.call(this)).type=m.U.Object,e._geometries=new Array,e._transformation=(0,c.c)(),e._bvObjectSpace=new O,e._bvWorldSpace=new O,e._bvDirty=!0,e._hasVolatileTransformation=!1,e._visible=!0,e.castShadow=null==r.castShadow||r.castShadow,e.metadata=r.metadata,e.metadata&&e.metadata.isElevationSource&&(e.metadata.lastValidElevationBB=new S);var a=r.geometries;return(0,u.pC)(a)&&(e._geometries=Array.from(a)),e}return(0,a.Z)(n,[{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._transformation},set:function(e){(0,l.c)(this._transformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}},{key:"dispose",value:function(){this._geometries.length=0}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(e){(0,_.hu)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}},{key:"addGeometry",value:function(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}},{key:"removeGeometry",value:function(e){var t=this._geometries.splice(e,1)[0];t&&(this._emit("objectGeometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}},{key:"removeAllGeometries",value:function(){for(;this._geometries.length>0;)this.removeGeometry(0)}},{key:"geometryVertexAttrsUpdated",value:function(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}},{key:"visible",get:function(){return this._visible},set:function(e){if(this._visible!==e){this._visible=e;var t,n=(0,r.Z)(this._geometries);try{for(n.s();!(t=n.n()).done;){t.value.visible=this._visible}}catch(i){n.e(i)}finally{n.f()}this._emit("visibilityChanged",this)}}},{key:"maskOccludee",value:function(){var e,t=new y.O(v.V_.MaskOccludee),n=(0,r.Z)(this._geometries);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.occludees=(0,T.lr)(i.occludees,t)}}catch(a){n.e(a)}finally{n.f()}return this._emit("occlusionChanged",this),t}},{key:"removeOcclude",value:function(e){var t,n=(0,r.Z)(this._geometries);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.occludees=(0,T.U_)(i.occludees,e)}}catch(a){n.e(a)}finally{n.f()}this._emit("occlusionChanged",this)}},{key:"highlight",value:function(){var e,t=new y.O(v.V_.Highlight),n=(0,r.Z)(this._geometries);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.highlights=(0,T.lr)(i.highlights,t)}}catch(a){n.e(a)}finally{n.f()}return this._emit("highlightChanged",this),t}},{key:"removeHighlight",value:function(e){var t,n=(0,r.Z)(this._geometries);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.highlights=(0,T.U_)(i.highlights,e)}}catch(a){n.e(a)}finally{n.f()}this._emit("highlightChanged",this)}},{key:"getCombinedStaticTransformation",value:function(e,t){return(0,l.m)(t,this.transformation,e.transformation)}},{key:"_getCombinedShaderTransformation",value:function(e){return(0,l.m)((0,c.c)(),this.transformation,e.shaderTransformation)}},{key:"hasVolativeTransformation",value:function(){return this._hasVolatileTransformation}},{key:"boundingVolumeWorldSpace",get:function(){return this._validateBoundingVolume(),this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){return this._validateBoundingVolume(),this._bvObjectSpace}},{key:"_validateBoundingVolume",value:function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();var e,t=(0,r.Z)(this._geometries);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=n.boundingInfo;(0,u.pC)(i)&&(w(i,this._bvObjectSpace,n.shaderTransformation),w(i,this._bvWorldSpace,this._getCombinedShaderTransformation(n)))}}catch(S){t.e(S)}finally{t.f()}(0,d.h)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),(0,d.h)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);var a,o=(0,h.c)(),s=(0,h.c)(),l=(0,p.u1)(this.transformation),c=(0,r.Z)(this._geometries);try{for(c.s();!(a=c.n()).done;){var f=a.value,v=f.boundingInfo;if(!(0,u.Wi)(v)){var g=f.shaderTransformation,m=(0,p.u1)(g);(0,d.m)(o,v.center,g);var y=(0,d.i)(o,this._bvObjectSpace.bounds),_=v.radius*m;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],y+_),(0,d.m)(s,o,this.transformation);var T=(0,d.i)(s,this._bvWorldSpace.bounds),x=_*l;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],T+x)}}}catch(S){c.e(S)}finally{c.f()}this._bvDirty=!1}}},{key:"_invalidateBoundingVolume",value:function(){this._bvDirty=!0,(0,u.pC)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}},{key:"_emit",value:function(e,t){(0,u.pC)(this._parentLayer)&&this._parentLayer.events.emit(e,t)}},{key:"test",get:function(){var e=this;return{hasGeometry:function(t){return e._geometries.includes(t)},getGeometryIndex:function(t){return e._geometries.indexOf(t)}}}}]),n}(g.c),S=function(){function e(){(0,i.Z)(this,e),this.min=(0,h.f)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,h.f)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}return(0,a.Z)(e,[{key:"isEmpty",value:function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}]),e}(),O=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).bounds=(0,f.c)(),e}return(0,a.Z)(n,[{key:"init",value:function(){(0,d.s)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),(0,d.s)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),(0,f.l)(this.bounds)}}]),n}(S);function w(e,t,n){var r=e.bbMin,i=e.bbMax;if((0,l.y)(n)){var a=(0,d.s)(b,n[12],n[13],n[14]);(0,d.a)(C,r,a),(0,d.a)(A,i,a);for(var o=0;o<3;++o)t.min[o]=Math.min(t.min[o],C[o]),t.max[o]=Math.max(t.max[o],A[o])}else if((0,d.m)(C,r,n),(0,d.k)(r,i))for(var s=0;s<3;++s)t.min[s]=Math.min(t.min[s],C[s]),t.max[s]=Math.max(t.max[s],C[s]);else{(0,d.m)(A,i,n);for(var u=0;u<3;++u)t.min[u]=Math.min(t.min[u],C[u],A[u]),t.max[u]=Math.max(t.max[u],C[u],A[u]);for(var c=0;c<3;++c){(0,d.c)(C,r),(0,d.c)(A,i),C[c]=i[c],A[c]=r[c],(0,d.m)(C,C,n),(0,d.m)(A,A,n);for(var h=0;h<3;++h)t.min[h]=Math.min(t.min[h],C[h],A[h]),t.max[h]=Math.max(t.max[h],C[h],A[h])}}}var b=(0,h.c)(),C=(0,h.c)(),A=(0,h.c)()},78329:function(e,t,n){n.d(t,{Z:function(){return U}});var r=n(37762),i=n(15671),a=n(43144),o=n(92026),s=n(13005),u=n(27546),l=n(11186),c=n(71353),d=n(95773),h=n(40885),f=n(23470),p=n(97731),v=function(){function e(t,n){(0,i.Z)(this,e),this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new g,this._objectCount=0,n&&(void 0!==n.maximumObjectsPerNode&&(this._maximumObjectsPerNode=n.maximumObjectsPerNode),void 0!==n.maximumDepth&&(this._maximumDepth=n.maximumDepth))}return(0,a.Z)(e,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",get:function(){return this._root.node}},{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}},{key:"destroy",value:function(){this._degenerateObjects.clear(),g.clearPool(),R[0]=null,M.prune(),F.prune()}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;this._objectCount+=t,this._grow(e,t);for(var n=g.acquire(),r=0;r<t;r++){var i=e[r];this._isDegenerate(i)?this._degenerateObjects.add(i):(n.init(this._root),this._add(i,n))}g.release(n)}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._objectCount-=e.length;var n,i=g.acquire(),a=(0,r.Z)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value,u=(0,o.pC)(t)?t:(0,f.h)(this._objectToBoundingSphere(s),N);w(u[3])?(i.init(this._root),this._remove(s,u,i)):this._degenerateObjects.delete(s)}}catch(l){a.e(l)}finally{a.f()}g.release(i),this._shrink()}},{key:"update",value:function(e,t){if(w(t[3])||!this._isDegenerate(e)){var n=function(e){return R[0]=e,R}(e);this.remove(n,t),this.add(n)}}},{key:"forEachAlongRay",value:function(e,t,n){var r=this,i=(0,h.re)(e,t);this._forEachNode(this._root,(function(e){if(!r._intersectsNode(i,e))return!1;var t=e.node;return t.terminals.forAll((function(e){r._intersectsObject(i,e)&&n(e)})),null!==t.residents&&t.residents.forAll((function(e){r._intersectsObject(i,e)&&n(e)})),!0}))}},{key:"forEachAlongRayWithVerticalOffset",value:function(e,t,n,r){var i=this,a=(0,h.re)(e,t);this._forEachNode(this._root,(function(e){if(!i._intersectsNodeWithOffset(a,e,r))return!1;var t=e.node;return t.terminals.forAll((function(e){i._intersectsObjectWithOffset(a,e,r)&&n(e)})),null!==t.residents&&t.residents.forAll((function(e){i._intersectsObjectWithOffset(a,e,r)&&n(e)})),!0}))}},{key:"forEach",value:function(e){this._forEachNode(this._root,(function(t){var n=t.node;return n.terminals.forAll(e),null!==n.residents&&n.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}},{key:"forEachDegenerateObject",value:function(e){this._degenerateObjects.forEach(e)}},{key:"findClosest",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return!0},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,o=1/0,s=1/0,u=null,c=S(e,t),h=function(l){if(--a,i(l)){var c=r._objectToBoundingSphere(l);if((0,d.hr)(n,c)){var h=O(e,t,(0,f.g)(c)),p=h-c[3],v=h+c[3];p<o&&(o=p,s=v,u=l)}}};return this._forEachNodeDepthOrdered(this._root,(function(r){if(a<=0||!(0,d.hr)(n,r.bounds))return!1;if((0,l.g)(P,c,r.halfSize),(0,l.a)(P,P,r.bounds),O(e,t,P)>s)return!1;var i=r.node;return i.terminals.forAll((function(e){return h(e)})),null!==i.residents&&i.residents.forAll((function(e){return h(e)})),!0}),e,t),u}},{key:"forEachInDepthRange",value:function(t,n,r,i,a,o,s){var u=this,c=-1/0,h=1/0,p={setRange:function(t){r===e.DepthOrder.FRONT_TO_BACK?(c=Math.max(c,t.near),h=Math.min(h,t.far)):(c=Math.max(c,-t.far),h=Math.min(h,-t.near))}};p.setRange(i);var v=O(n,r,t),g=S(n,r),m=S(n,-r),y=function(e){if(s(e)){var t=u._objectToBoundingSphere(e),i=(0,f.g)(t),l=O(n,r,i)-v,g=l-t[3],m=l+t[3];g>h||m<c||!(0,d.hr)(o,t)||a(e,p)}};this._forEachNodeDepthOrdered(this._root,(function(e){if(!(0,d.hr)(o,e.bounds))return!1;if((0,l.g)(P,g,e.halfSize),(0,l.a)(P,P,e.bounds),O(n,r,P)-v>h)return!1;if((0,l.g)(P,m,e.halfSize),(0,l.a)(P,P,e.bounds),O(n,r,P)-v<c)return!1;var t=e.node;return t.terminals.forAll((function(e){return y(e)})),null!==t.residents&&t.residents.forAll((function(e){return y(e)})),!0}),n,r)}},{key:"forEachNode",value:function(e){this._forEachNode(this._root,(function(t){return e(t.node,t.bounds,t.halfSize)}))}},{key:"forEachNeighbor",value:function(e,t){var n=this,r=(0,f.a)(t),i=(0,f.g)(t),a=function(t){var a=n._objectToBoundingSphere(t),o=(0,f.a)(a),s=r+o;return!((0,l.d)((0,f.g)(a),i)-s*s<=0)||e(t)},o=!0,s=function(e){o&&(o=a(e))};this._forEachNode(this._root,(function(e){var t=(0,f.a)(e.bounds),n=r+t;if((0,l.d)((0,f.g)(e.bounds),i)-n*n>0)return!1;var a=e.node;return a.terminals.forAll(s),o&&null!==a.residents&&a.residents.forAll(s),o})),o&&this.forEachDegenerateObject(s)}},{key:"_intersectsNode",value:function(e,t){return _(t.bounds,2*-t.halfSize,I),_(t.bounds,2*t.halfSize,D),(0,p.yK)(e.origin,e.direction,I,D)}},{key:"_intersectsNodeWithOffset",value:function(e,t,n){return _(t.bounds,2*-t.halfSize,I),_(t.bounds,2*t.halfSize,D),n.applyToMinMax(I,D),(0,p.yK)(e.origin,e.direction,I,D)}},{key:"_intersectsObject",value:function(e,t){var n=this._objectToBoundingSphere(t);return!(n[3]>0)||(0,f.j)(n,e)}},{key:"_intersectsObjectWithOffset",value:function(e,t,n){var r=this._objectToBoundingSphere(t);return!(r[3]>0)||(0,f.j)(n.applyToBoundingSphere(r),e)}},{key:"_forEachNode",value:function(e,t){for(var n=g.acquire().init(e),r=[n];0!==r.length;){if(t(n=r.pop())&&!n.isLeaf())for(var i=0;i<n.node.children.length;i++)n.node.children[i]&&r.push(g.acquire().init(n).advance(i));g.release(n)}}},{key:"_forEachNodeDepthOrdered",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DepthOrder.FRONT_TO_BACK,a=g.acquire().init(t),o=[a];for(x(r,i,z);0!==o.length;){if(n(a=o.pop())&&!a.isLeaf())for(var s=7;s>=0;--s){var u=z[s];a.node.children[u]&&o.push(g.acquire().init(a).advance(u))}g.release(a)}}},{key:"_remove",value:function(e,t,n){M.clear();var r=n.advanceTo(t,(function(e,t){M.push(e.node),M.push(t)}))?n.node.terminals:n.node.residents;if(r.removeUnordered(e),0===r.length)for(var i=M.length-2;i>=0;i-=2){var a=M.data[i],o=M.data[i+1];if(!this._purge(a,o))break}}},{key:"_nodeIsEmpty",value:function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}},{key:"_purge",value:function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new u.Z({shrink:!0})),!0)}},{key:"_add",value:function(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}},{key:"_split",value:function(e){var t=e.node.residents;e.node.residents=null;for(var n=0;n<t.length;n++){var r=g.acquire().init(e);this._add(t.getItemAt(n),r),g.release(r)}}},{key:"_grow",value:function(e,t){var n=this;if(0!==t&&(T(e,t,(function(e){return n._objectToBoundingSphere(e)}),Z),w(Z[3])&&!this._fitsInsideTree(Z)))if(this._nodeIsEmpty(this._root.node))(0,f.h)(Z,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{var r=this._rootBoundsForRootAsSubNode(Z);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(Z,r):this._growRootAsSubNode(r),g.release(r)}}},{key:"_rebuildTree",value:function(e,t){var n=this;(0,l.c)(L,t.bounds),L[3]=t.halfSize,T([e,L],2,(function(e){return e}),k);var r=g.acquire().init(this._root);this._root.initFrom(null,k,k[3]),this._root.increaseHalfSize(1.25),this._forEachNode(r,(function(e){return n.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&n.add(e.node.residents.data,e.node.residents.length),!0})),g.release(r)}},{key:"_placingRootViolatesMaxDepth",value:function(e){var t=this,n=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E,r=0;return this._forEachNode(this._root,(function(e){return(r=Math.max(r,e.depth))+n<=t._maximumDepth})),r+n>this._maximumDepth}},{key:"_rootBoundsForRootAsSubNode",value:function(e){for(var t=e[3],n=e,r=-1/0,i=this._root.bounds,a=this._root.halfSize,o=0;o<3;o++){var s=i[o]-a-(n[o]-t),u=n[o]+t-(i[o]+a),l=Math.max(0,Math.ceil(s/(2*a))),c=Math.max(0,Math.ceil(u/(2*a)))+1,d=Math.pow(2,Math.ceil(Math.log(l+c)*Math.LOG2E));r=Math.max(r,d),H[o].min=l,H[o].max=c}for(var h=0;h<3;h++){var f=H[h].min,p=H[h].max,v=(r-(f+p))/2;f+=Math.ceil(v),p+=Math.floor(v);var m=i[h]-a-f*a*2;E[h]=m+(p+f)*a}var y=r*a;return E[3]=y*A,g.acquire().initFrom(null,E,y,0)}},{key:"_growRootAsSubNode",value:function(e){var t=this._root.node;(0,l.c)(Z,this._root.bounds),Z[3]=this._root.halfSize,this._root.init(e),e.advanceTo(Z,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}},{key:"_shrink",value:function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}},{key:"_findShrinkIndex",value:function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,n=0,r=0;r<t.length&&null==e;)e=t[n=r++];for(;r<t.length;)if(t[r++])return-1;return n}},{key:"_isDegenerate",value:function(e){return!w(this._objectToBoundingSphere(e)[3])}},{key:"_fitsInsideTree",value:function(e){var t=this._root.bounds,n=this._root.halfSize;return e[3]<=n&&e[0]>=t[0]-n&&e[0]<=t[0]+n&&e[1]>=t[1]-n&&e[1]<=t[1]+n&&e[2]>=t[2]-n&&e[2]<=t[2]+n}}]),e}(),g=function(){function e(){(0,i.Z)(this,e),this.bounds=(0,f.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}return(0,a.Z)(e,[{key:"init",value:function(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}},{key:"initFrom",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.depth;return this.node=(0,o.pC)(t)?t:e.createEmptyNode(),(0,o.pC)(n)&&(0,f.h)(n,this.bounds),this.halfSize=r,this.depth=i,this}},{key:"increaseHalfSize",value:function(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}},{key:"updateBoundsRadiusFromHalfSize",value:function(){this.bounds[3]=this.halfSize*A}},{key:"advance",value:function(t){var n=this.node.children[t];n||(n=e.createEmptyNode(),this.node.children[t]=n),this.node=n,this.halfSize/=2,this.depth++;var r=b[t];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}},{key:"advanceTo",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!n)return t&&t(this,-1),!1;this.node.residents=null}var r=this._childIndex(e);t&&t(this,r),this.advance(r)}}},{key:"isLeaf",value:function(){return null!=this.node.residents}},{key:"isTerminalFor",value:function(e){return e[3]>this.halfSize/2}},{key:"_childIndex",value:function(e){var t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}}],[{key:"createEmptyNode",value:function(){return{children:[null,null,null,null,null,null,null,null],terminals:new u.Z({shrink:!0}),residents:new u.Z({shrink:!0})}}},{key:"acquire",value:function(){return e._pool.acquire()}},{key:"release",value:function(t){e._pool.release(t)}},{key:"clearPool",value:function(){e._pool.prune()}}]),e}();function m(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function y(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function _(e,t,n){n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t}function T(e,t,n,r){if(1===t){var i=n(e[0]);(0,f.h)(i,r)}else{I[0]=1/0,I[1]=1/0,I[2]=1/0,D[0]=-1/0,D[1]=-1/0,D[2]=-1/0;for(var a=0;a<t;a++){var o=n(e[a]);w(o[3])&&(m(I,o),y(D,o))}(0,l.h)(r,I,D,.5),r[3]=Math.max(D[0]-I[0],D[1]-I[1],D[2]-I[2])/2}}function x(e,t,n){if(!F.length)for(var r=0;r<8;++r)F.push({index:0,distance:0});for(var i=0;i<8;++i){var a=b[i];F.data[i].index=i,F.data[i].distance=O(e,t,a)}F.sort((function(e,t){return e.distance-t.distance}));for(var o=0;o<8;++o)n[o]=F.data[o].index}function S(e,t){for(var n,r=1/0,i=0;i<8;++i){var a=O(e,t,C[i]);a<r&&(r=a,n=C[i])}return n}function O(e,t,n){return t*(e[0]*n[0]+e[1]*n[1]+e[2]*n[2])}function w(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}g._pool=new s.Z(g),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(v||(v={}));var b=[(0,c.f)(-1,-1,-1),(0,c.f)(1,-1,-1),(0,c.f)(-1,1,-1),(0,c.f)(1,1,-1),(0,c.f)(-1,-1,1),(0,c.f)(1,-1,1),(0,c.f)(-1,1,1),(0,c.f)(1,1,1)],C=[(0,c.f)(-1,-1,-1),(0,c.f)(-1,-1,1),(0,c.f)(-1,1,-1),(0,c.f)(-1,1,1),(0,c.f)(1,-1,-1),(0,c.f)(1,-1,1),(0,c.f)(1,1,-1),(0,c.f)(1,1,1)],A=Math.sqrt(3),R=[null];var E=(0,f.c)(),P=(0,c.c)(),I=(0,c.c)(),D=(0,c.c)(),M=new u.Z,N=(0,f.c)(),Z=(0,f.c)(),L=(0,f.c)(),k=(0,f.c)(),H=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],F=new u.Z,z=[0,0,0,0,0,0,0,0],U=v},46293:function(e,t,n){n.d(t,{V:function(){return p},Y:function(){return f}});var r=n(60136),i=n(92572),a=n(15671),o=n(43144),s=n(92026),u=n(38499),l=n(37081),c=n(83377),d=n(86755),h=n(56529),f=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,a.Z)(this,e),this.rctx=t,this.sliceHelper=i,this.lastFrameCamera=new d.V,this.output=l.H.Color,this.renderOccludedMask=v,this.bindParameters=new c.p(n,r,(0,s.pC)(i)?i.plane:null)}return(0,o.Z)(e,[{key:"resetRenderOccludedMask",value:function(){this.renderOccludedMask=v}}]),e}(),p=function(e){(0,r.Z)(n,e);var t=(0,i.Z)(n);function n(e,r,i,o,s){var l;return(0,a.Z)(this,n),(l=t.call(this,e,i,o,s)).offscreenRenderingHelper=r,l.sliceHelper=s,l.time=(0,u.HA)(0),l}return(0,o.Z)(n)}(f),v=h.yD.Occlude|h.yD.OccludeAndTransparent|h.yD.OccludeAndTransparentStencil},39077:function(e,t,n){n.d(t,{z:function(){return h}});var r=n(15671),i=n(43144),a=n(92026),o=n(95439),s=n(14226),u=n(81949),l=n(11186),c=n(67077),d=n(80064),h=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,r.Z)(this,e),this.geometry=t,this.boundingSphere=(0,c.c)(),this.screenToWorldRatio=1,this._transformation=(0,u.c)(),this._shaderTransformationDirty=!0,this.id=(0,o.D)(),this.layerUid=n.layerUid,this.graphicUid=n.graphicUid,this.boundingInfo=n.boundingInfo,this.shaderTransformer=n.shaderTransformer,this.castShadow=!!n.castShadow&&n.castShadow}return(0,i.Z)(e,[{key:"transformation",get:function(){return this._transformation}},{key:"updateTransformation",value:function(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}},{key:"shaderTransformationChanged",value:function(){this._shaderTransformationDirty=!0}},{key:"computeBoundingSphere",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,d.u1)(e);(0,a.Wi)(this.boundingInfo)||((0,l.m)(t,this.boundingInfo.center,e),t[3]=this.boundingInfo.radius*n)}},{key:"hasShaderTransformation",get:function(){return(0,a.pC)(this.shaderTransformer)}},{key:"material",get:function(){return this.geometry.material}},{key:"type",get:function(){return this.geometry.type}},{key:"shaderTransformation",get:function(){return(0,a.Wi)(this.shaderTransformer)?this.transformation:(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=(0,u.c)()),(0,s.c)(this._shaderTransformation,this.shaderTransformer(this.transformation)),this._shaderTransformationDirty=!1),this._shaderTransformation)}},{key:"indices",get:function(){return this.geometry.indices}},{key:"vertexAttributes",get:function(){return this.geometry.vertexAttributes}},{key:"highlights",get:function(){return this.geometry.highlights}},{key:"occludees",get:function(){return this.geometry.occludees}},{key:"visible",get:function(){return this.geometry.visible},set:function(e){this.geometry.visible=e}}]),e}()},471:function(e,t,n){n.d(t,{l:function(){return D},i:function(){return w}});var r=n(43144),i=n(15671),a=n(93169),o=n(16889),s=n(92026),u=n(11873),l=n(14226),c=n(81949),d=n(88396),h=n(6394),f=n(11186),p=n(71353),v=n(90045),g=n(67077),m=n(50951),y=n(60136),_=n(92572),T=n(27366),x=n(49861),S=(n(25243),n(63780),n(69912)),O=function(e){(0,y.Z)(n,e);var t=(0,_.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments))._projectionMatrix=(0,c.c)(),e}return(0,r.Z)(n,[{key:"projectionMatrix",get:function(){return this._projectionMatrix}}]),n}(n(86755).V);(0,T._)([(0,x.Cb)()],O.prototype,"_projectionMatrix",void 0),(0,T._)([(0,x.Cb)({readOnly:!0})],O.prototype,"projectionMatrix",null),O=(0,T._)([(0,S.j)("esri.views.3d.webgl-engine.lib.CascadeCamera")],O);var w,b,C=n(97731),A=n(8548),R=n(53634),E=n(371),P=n(3384);(b=w||(w={}))[b.Highlight=0]="Highlight",b[b.Default=1]="Default";for(var I=(0,r.Z)((function e(){(0,i.Z)(this,e),this.camera=new O,this.lightMat=(0,c.c)()})),D=function(){function e(t,n){(0,i.Z)(this,e),this._rctx=t,this._viewingMode=n,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._maxNumCascades=4,this._projectionView=(0,c.c)(),this._projectionViewInverse=(0,c.c)(),this._modelViewLight=(0,c.c)(),this._splitSchemeLambda=0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,g.c)(),this._cascades=[new I,new I,new I,new I],this._lastOrigin=null,this._maxTextureSize=Math.min((0,a.Z)("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}return(0,r.Z)(e,[{key:"depthTexture",get:function(){return this._depthTexture}},{key:"textureSize",get:function(){return this._textureSize}},{key:"numCascades",get:function(){return this._numCascades}},{key:"cascadeDistances",get:function(){return(0,v.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}},{key:"dispose",value:function(){this.enabled=!1,this.disposeOffscreenBuffers()}},{key:"disposeOffscreenBuffers",value:function(){this._discardDepthTexture(),this._discardAllSnapshots()}},{key:"maxCascades",get:function(){return this._maxNumCascades},set:function(e){this._maxNumCascades=(0,o.uZ)(Math.floor(e),1,4)}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,e||(this._discardDepthTexture(),this._discardAllSnapshots())}},{key:"ready",get:function(){return this._enabled&&(0,s.pC)(this._depthTexture)}},{key:"getSnapshot",value:function(e){return this.enabled?this._snapshots[e]:null}},{key:"cascades",get:function(){for(var e=0;e<this._numCascades;++e)V[e]=this._cascades[e];return V.length=this._numCascades,V}},{key:"start",value:function(e,t,n){(0,C.hu)(this.enabled),this._textureSize=this._computeTextureSize(e.fullWidth,e.fullHeight),this._ensureDepthTexture();var r=this._clampNearFar(n),i=r.near,a=r.far;this._computeCascadeDistances(a,i),this._setupMatrices(e,t);for(var o=e.viewMatrix,s=e.projectionMatrix,u=0;u<this._numCascades;++u)this._constructCascade(u,s,o,t);this._lastOrigin=null,this.clear()}},{key:"finish",value:function(e){(0,C.hu)(this.enabled),this._rctx.bindFramebuffer(e)}},{key:"getShadowMapMatrices",value:function(e){if(!this._lastOrigin||!(0,f.k)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,p.c)(),(0,f.c)(this._lastOrigin,e);for(var t=0;t<this._numCascades;++t){(0,l.w)(W,this._cascades[t].lightMat,e);for(var n=0;n<16;++n)B[16*t+n]=W[n]}}return B}},{key:"takeCascadeSnapshotTo",value:function(e,t){(0,C.hu)(this.enabled);var n=this._ensureSnapshot(t);this._bindFbo();var r=this._rctx,i=r.bindTexture(n,E.x.TEXTURE_UNIT_FOR_UPDATES);r.gl.copyTexSubImage2D(A.No.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),r.bindTexture(i,E.x.TEXTURE_UNIT_FOR_UPDATES)}},{key:"clear",value:function(){var e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(A.lk.COLOR_BUFFER_BIT|A.lk.DEPTH_BUFFER_BIT)}},{key:"_computeTextureSize",value:function(e,t){var n=.5*Math.log(e*e+t*t)*Math.LOG2E,r=Math.pow(2,Math.round(n+.35));return Math.min(this._maxTextureSize,2*r)}},{key:"_ensureDepthTexture",value:function(){if(!(0,s.pC)(this._depthTexture)||this._depthTexture.descriptor.width!==this._textureSize){this._discardDepthTexture();var e={target:A.No.TEXTURE_2D,pixelFormat:A.VI.RGBA,dataType:A.Br.UNSIGNED_BYTE,wrapMode:A.e8.CLAMP_TO_EDGE,samplingMode:A.cw.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new E.x(this._rctx,e),this._fbo=new R.X(this._rctx,{colorTarget:A.Lm.TEXTURE,depthStencilTarget:A.OU.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}}},{key:"_ensureSnapshot",value:function(e){var t=this._snapshots[e];if((0,s.pC)(t)&&t.descriptor.width===this._textureSize)return t;this._discardSnapshot(e);var n={target:A.No.TEXTURE_2D,pixelFormat:A.VI.RGBA,dataType:A.Br.UNSIGNED_BYTE,wrapMode:A.e8.CLAMP_TO_EDGE,samplingMode:A.cw.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return t=new E.x(this._rctx,n),this._snapshots[e]=t,t}},{key:"_discardDepthTexture",value:function(){this._fbo=(0,s.M2)(this._fbo),this._depthTexture=(0,s.M2)(this._depthTexture)}},{key:"_discardSnapshot",value:function(e){this._snapshots[e]=(0,s.M2)(this._snapshots[e])}},{key:"_discardAllSnapshots",value:function(){for(var e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}},{key:"_bindFbo",value:function(){var e=this._rctx;e.unbindTexture(this._depthTexture),e.bindFramebuffer(this._fbo)}},{key:"_constructCascade",value:function(e,t,n,r){var i=this._cascades[e],a=-this._cascadeDistances[e],s=-this._cascadeDistances[e+1],u=(t[10]*a+t[14])/Math.abs(t[11]*a+t[15]),c=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]);(0,C.hu)(u<c);for(var h=0;h<8;++h){(0,v.s)(N,h%4==0||h%4==3?-1:1,h%4==0||h%4==1?-1:1,h<4?u:c,1);var p=Z[h];(0,v.t)(p,N,this._projectionViewInverse),p[0]/=p[3],p[1]/=p[3],p[2]/=p[3]}(0,f.o)(j,Z[0]),i.camera.viewMatrix=(0,l.w)(M,this._modelViewLight,j);for(var g=0;g<8;++g)(0,f.m)(Z[g],Z[g],i.camera.viewMatrix);for(var m=Z[0][2],y=Z[0][2],_=1;_<8;++_)m=Math.min(m,Z[_][2]),y=Math.max(y,Z[_][2]);m-=200,y+=200,i.camera.near=-y,i.camera.far=-m,function(e,t,n,r,i){var a=1/Z[0][3],s=1/Z[4][3];(0,C.hu)(a<s);var u=a+Math.sqrt(a*s),l=Math.sin((0,o.ZF)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));u/=l,function(e,t,n,r,i,a,o,s){(0,d.s)(G,0,0);for(var u=0;u<4;++u)(0,d.j)(G,G,e[u]);(0,d.b)(G,G,.25),(0,d.s)(q,0,0);for(var l=4;l<8;++l)(0,d.j)(q,q,e[l]);(0,d.b)(q,q,.25),(0,d.l)(J[0],e[4],e[5],.5),(0,d.l)(J[1],e[5],e[6],.5),(0,d.l)(J[2],e[6],e[7],.5),(0,d.l)(J[3],e[7],e[4],.5);for(var c=0,h=(0,d.k)(J[0],G),f=1;f<4;++f){var p=(0,d.k)(J[f],G);p<h&&(h=p,c=f)}(0,d.a)(Y,J[c],e[c+4]);var v,g,m=Y[0];Y[0]=-Y[1],Y[1]=m,(0,d.a)(X,q,G),(0,d.h)(X,Y)<0&&(0,d.n)(Y,Y),(0,d.l)(Y,Y,X,n),(0,d.f)(Y,Y),v=g=(0,d.h)((0,d.a)($,e[0],G),Y);for(var y=1;y<8;++y){var _=(0,d.h)((0,d.a)($,e[y],G),Y);_<v?v=_:_>g&&(g=_)}(0,d.c)(r,G),(0,d.b)($,Y,v-t),(0,d.j)(r,r,$);for(var T=-1,x=1,S=0,O=0,w=0;w<8;++w){(0,d.a)(K,e[w],r),(0,d.f)(K,K);var b=Y[0]*K[1]-Y[1]*K[0];b>0?b>T&&(T=b,S=w):b<x&&(x=b,O=w)}(0,C.T)(T>0,"leftArea"),(0,C.T)(x<0,"rightArea"),(0,d.b)(Q,Y,v),(0,d.j)(Q,Q,G),(0,d.b)(ee,Y,g),(0,d.j)(ee,ee,G),te[0]=-Y[1],te[1]=Y[0];var A=(0,C.ep)(r,e[O],ee,(0,d.j)($,ee,te),1,i),R=(0,C.ep)(r,e[S],ee,$,1,a),E=(0,C.ep)(r,e[S],Q,(0,d.j)($,Q,te),1,o),P=(0,C.ep)(r,e[O],Q,$,1,s);(0,C.T)(A,"rayRay"),(0,C.T)(R,"rayRay"),(0,C.T)(E,"rayRay"),(0,C.T)(P,"rayRay")}(Z,u,l,k,H,F,z,U),function(e,t,n,r,i){(0,d.a)(ae,n,r),(0,d.b)(ae,ae,.5),oe[0]=ae[0],oe[1]=ae[1],oe[2]=0,oe[3]=ae[1],oe[4]=-ae[0],oe[5]=0,oe[6]=ae[0]*ae[0]+ae[1]*ae[1],oe[7]=ae[0]*ae[1]-ae[1]*ae[0],oe[8]=1,oe[ne(0,2)]=-(0,d.h)(ie(oe,0),e),oe[ne(1,2)]=-(0,d.h)(ie(oe,1),e);var a=(0,d.h)(ie(oe,0),n)+oe[ne(0,2)],o=(0,d.h)(ie(oe,1),n)+oe[ne(1,2)],s=(0,d.h)(ie(oe,0),r)+oe[ne(0,2)],u=(0,d.h)(ie(oe,1),r)+oe[ne(1,2)];a=-(a+s)/(o+u),oe[ne(0,0)]+=oe[ne(1,0)]*a,oe[ne(0,1)]+=oe[ne(1,1)]*a,oe[ne(0,2)]+=oe[ne(1,2)]*a,a=1/((0,d.h)(ie(oe,0),n)+oe[ne(0,2)]),o=1/((0,d.h)(ie(oe,1),n)+oe[ne(1,2)]),oe[ne(0,0)]*=a,oe[ne(0,1)]*=a,oe[ne(0,2)]*=a,oe[ne(1,0)]*=o,oe[ne(1,1)]*=o,oe[ne(1,2)]*=o,oe[ne(2,0)]=oe[ne(1,0)],oe[ne(2,1)]=oe[ne(1,1)],oe[ne(2,2)]=oe[ne(1,2)],oe[ne(1,2)]+=1,a=(0,d.h)(ie(oe,1),t)+oe[ne(1,2)],o=(0,d.h)(ie(oe,2),t)+oe[ne(2,2)],s=(0,d.h)(ie(oe,1),n)+oe[ne(1,2)],u=(0,d.h)(ie(oe,2),n)+oe[ne(2,2)],a=-.5*(a/o+s/u),oe[ne(1,0)]+=oe[ne(2,0)]*a,oe[ne(1,1)]+=oe[ne(2,1)]*a,oe[ne(1,2)]+=oe[ne(2,2)]*a,a=(0,d.h)(ie(oe,1),t)+oe[ne(1,2)],o=(0,d.h)(ie(oe,2),t)+oe[ne(2,2)],s=-o/a,oe[ne(1,0)]*=s,oe[ne(1,1)]*=s,oe[ne(1,2)]*=s,i[0]=oe[0],i[1]=oe[1],i[2]=0,i[3]=oe[2],i[4]=oe[3],i[5]=oe[4],i[6]=0,i[7]=oe[5],i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=oe[6],i[13]=oe[7],i[14]=0,i[15]=oe[8]}(k,H,z,U,i.projectionMatrix),i.projectionMatrix[10]=2/(n-r),i.projectionMatrix[14]=-(n+r)/(n-r)}(n,r,m,y,i.camera),(0,l.m)(i.lightMat,i.camera.projectionMatrix,i.camera.viewMatrix);var T=this._textureSize/2;i.camera.viewport=[e%2==0?0:T,0===Math.floor(e/2)?0:T,T,T]}},{key:"_setupMatrices",value:function(e,t){(0,l.m)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,l.a)(this._projectionViewInverse,this._projectionView);var n=this._viewingMode===m.JY.Global?e.eye:(0,f.s)(j,0,0,1);(0,l.u)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],n)}},{key:"_clampNearFar",value:function(e){var t=e.near,n=e.far;return t<2&&(t=2),n<2&&(n=2),t>=n&&(t=2,n=4),{near:t,far:n}}},{key:"_computeCascadeDistances",value:function(e,t){this._numCascades=Math.min(1+Math.floor((0,C.E6)(e/t,4)),this._maxNumCascades);for(var n=(e-t)/this._numCascades,r=Math.pow(e/t,1/this._numCascades),i=t,a=t,s=0;s<this._numCascades+1;++s)this._cascadeDistances[s]=(0,o.t7)(i,a,this._splitSchemeLambda),i*=r,a+=n}},{key:"gpuMemoryUsage",get:function(){var e,t;return this._snapshots.reduce((function(e,t){return e+(0,P.un)(t)}),null!==(e=null===(t=this._fbo)||void 0===t?void 0:t.gpuMemoryUsage)&&void 0!==e?e:0)}},{key:"test",get:function(){var e=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(t){e._splitSchemeLambda=t},get splitSchemeLambda(){return e._splitSchemeLambda}}}}]),e}(),M=(0,c.c)(),N=(0,g.c)(),Z=[],L=0;L<8;++L)Z.push((0,g.c)());var k=(0,h.a)(),H=(0,h.a)(),F=(0,h.a)(),z=(0,h.a)(),U=(0,h.a)(),j=(0,p.c)(),V=[],W=(0,c.c)(),B=new Float32Array(64),G=(0,h.a)(),q=(0,h.a)(),J=[(0,h.a)(),(0,h.a)(),(0,h.a)(),(0,h.a)()],Y=(0,h.a)(),X=(0,h.a)(),$=(0,h.a)(),K=(0,h.a)(),Q=(0,h.a)(),ee=(0,h.a)(),te=(0,h.a)();function ne(e,t){return 3*t+e}var re=(0,h.a)();function ie(e,t){return(0,d.s)(re,e[t],e[t+3]),re}var ae=(0,h.a)(),oe=(0,u.c)()},81341:function(e,t,n){n.d(t,{S:function(){return O}});var r=n(37762),i=n(15671),a=n(43144),o=n(60136),s=n(92572),u=n(27366),l=n(85015),c=n(77427),d=n(92026),h=n(27546),f=n(49861),p=(n(25243),n(63780),n(69912)),v=n(6394),g=n(43449),m=n(78976),y=n(88153),_=n(54463),T=n(78289),x=n(41947),S=n(80903),O=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._pending=new w,r._changes=new m.as,r._materialRenderers=new Map,r._sortedMaterialRenderers=new h.Z,r._geometries=new Map,r._hasHighlights=!1,r._hasWater=!1,r}return(0,a.Z)(n,[{key:"destroy",value:function(){this._changes.prune(),this._materialRenderers.forEach((function(e){return e.dispose()})),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}},{key:"updating",get:function(){return!this._pending.empty||this._changes.updates.length>0}},{key:"rctx",get:function(){return this.rendererContext.rctx}},{key:"_materialRepository",get:function(){return this.rendererContext.materialRepository}},{key:"_localOriginFactory",get:function(){return this.rendererContext.localOriginFactory}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return(0,c.oE)(this._materialRenderers,(function(e){return e.rendersOccluded}))}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}},{key:"commitChanges",value:function(){var e=this;if(!this.updating)return!1;this._processAddsRemoves();var t=(0,x.q)(this._changes),n=!1,r=!1,i=!1;return t.forEach((function(t,a){var o=e._materialRenderers.get(a);if(!o&&t.adds.length>0&&(o=new S.A(e.rctx,e._materialRepository,a),e._materialRenderers.set(a,o),n=!0,r=!0,i=!0),o){var s=r||o.hasHighlights,u=i||o.hasWater;o.modify(t),r=r||s!==o.hasHighlights,i=i||u!==o.hasWater,o.isEmpty&&(e._materialRenderers.delete(a),o.dispose(),n=!0)}})),this._changes.clear(),n&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=(0,c.oE)(this._materialRenderers,(function(e){return e.hasHighlights}))),i&&(this._hasWater=(0,c.oE)(this._materialRenderers,(function(e){return e.hasWater}))),this.notifyChange("updating"),!0}},{key:"addGeometries",value:function(e,t){if(0!==e.length){var n,i=this._validateRenderGeometries(e),a=(0,r.Z)(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;this._geometries.set(o.id,o)}}catch(d){a.e(d)}finally{a.f()}var s,u=this._pending.empty,l=(0,r.Z)(i);try{for(l.s();!(s=l.n()).done;){var c=s.value;this._pending.adds.add(c)}}catch(d){l.e(d)}finally{l.f()}u&&this.notifyChange("updating"),t===T.T.UPDATE&&this._notifyGraphicGeometryChanged(e)}}},{key:"removeGeometries",value:function(e,t){var n,i=this._pending.empty,a=this._pending.adds,o=(0,r.Z)(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;a.has(s)?(this._pending.removed.add(s),a.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete((0,d.Wg)(s.id))}}catch(u){o.e(u)}finally{o.f()}i&&!this._pending.empty&&this.notifyChange("updating"),t===T.T.UPDATE&&this._notifyGraphicGeometryChanged(e)}},{key:"modifyGeometries",value:function(e,t){var n,i=0===this._changes.updates.length,a=(0,r.Z)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(o),s.updateType=t}}catch(u){a.e(u)}finally{a.f()}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case T.$.TRANSFORMATION:case T.$.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case T.$.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}},{key:"updateAnimation",value:function(e){var t=!1;return this._sortedMaterialRenderers.forAll((function(n){return t=n.updateAnimation(e)||t})),t}},{key:"render",value:function(e){this._sortedMaterialRenderers.forAll((function(t){t.material.shouldRender(e)&&t.render(e.output,e.bindParameters)}))}},{key:"intersect",value:function(e,t,n,r,i){var a=this;return this._geometries.forEach((function(o){if(!r||r(o)){a._intersectRenderGeometry(o,n,t,0,e,i);var s=a.rendererContext.longitudeCyclical;s&&(o.boundingSphere[0]-o.boundingSphere[3]<s.min&&a._intersectRenderGeometry(o,n,t,s.range,e,i),o.boundingSphere[0]+o.boundingSphere[3]>s.max&&a._intersectRenderGeometry(o,n,t,-s.range,e,i)),i++}})),i}},{key:"_updateSortedMaterialRenderers",value:function(){var e=this;this._sortedMaterialRenderers.clear();var t=0;this._materialRenderers.forEach((function(n,r){r.insertOrder=t++,e._sortedMaterialRenderers.push(n)})),this._sortedMaterialRenderers.sort((function(e,t){var n=t.material.renderPriority-e.material.renderPriority;return 0!==n?n:e.material.insertOrder-t.material.insertOrder}))}},{key:"_processAddsRemoves",value:function(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(var e=0;e<this._changes.updates.length;){var t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}},{key:"_intersectRenderGeometry",value:function(e,t,n,r,i,a){if(e.visible){var o;r+=e.transformation[12],o=e.transformation[13],b[0]=n[0]-r,b[1]=n[1]-o,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,i,b,(function(n,r,o){!function(e,t,n,r,i,a,o){var s=new g.T6(a,o,t),u=function(t){t.set(_.q7.OVERLAY,s,e.dist,e.normal,e.transformation,n,r)};if((null==i.results.min.drapedLayerOrder||n>=i.results.min.drapedLayerOrder)&&(null==i.results.min.dist||i.results.ground.dist<=i.results.min.dist)&&u(i.results.min),i.options.store!==_.eC.MIN&&(null==i.results.max.drapedLayerOrder||n<i.results.max.drapedLayerOrder)&&(null==i.results.max.dist||i.results.ground.dist>i.results.max.dist)&&u(i.results.max),i.options.store===_.eC.ALL){var l=(0,y.LP)(i.ray);u(l),i.results.all.push(l)}}(t,o,e.material.renderPriority,a,i,e.layerUid,e.graphicUid)}),t)}}},{key:"_notifyGraphicGeometryChanged",value:function(e){if(!(0,d.Wi)(this.drapeSource.notifyGraphicGeometryChanged)){var t,n,i=(0,r.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value.graphicUid;(0,d.pC)(a)&&a!==t&&(this.drapeSource.notifyGraphicGeometryChanged(a),t=a)}}catch(o){i.e(o)}finally{i.f()}}}},{key:"_notifyGraphicVisibilityChanged",value:function(e){if(!(0,d.Wi)(this.drapeSource.notifyGraphicVisibilityChanged)){var t,n,i=(0,r.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value.graphicUid;(0,d.pC)(a)&&a!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(a),t=a)}}catch(o){i.e(o)}finally{i.f()}}}},{key:"_validateRenderGeometries",value:function(e){var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._validateRenderGeometry(i)}}catch(a){n.e(a)}finally{n.f()}return e}},{key:"_validateRenderGeometry",value:function(e){return(0,d.Wi)(e.localOrigin)&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]),n}(l.Z);(0,u._)([(0,f.Cb)()],O.prototype,"drapeSource",void 0),(0,u._)([(0,f.Cb)()],O.prototype,"updating",null),(0,u._)([(0,f.Cb)()],O.prototype,"rctx",null),(0,u._)([(0,f.Cb)()],O.prototype,"rendererContext",void 0),(0,u._)([(0,f.Cb)()],O.prototype,"_materialRepository",null),(0,u._)([(0,f.Cb)()],O.prototype,"_localOriginFactory",null),(0,u._)([(0,f.Cb)({readOnly:!0})],O.prototype,"isEmpty",null),(0,u._)([(0,f.Cb)()],O.prototype,"_materialRenderers",void 0),(0,u._)([(0,f.Cb)()],O.prototype,"_geometries",void 0),O=(0,u._)([(0,p.j)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],O);var w=function(){function e(){(0,i.Z)(this,e),this.adds=new Set,this.removes=new Set,this.removed=new Set}return(0,a.Z)(e,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}},{key:"has",value:function(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}},{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}]),e}();var b=(0,v.a)()},5195:function(e,t,n){n.d(t,{K:function(){return p}});var r=n(15671),i=n(43144),a=n(60136),o=n(92572),s=n(61863),u=n(82144),l=n(31132),c=n(7566),d=n(27627),h=n(8548),f=n(36207),p=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"initializeProgram",value:function(e){return new d.$(e.rctx,n.shader.get().build(),c.i)}},{key:"initializePipeline",value:function(){return this.configuration.hasAlpha?(0,f.sm)({blending:(0,f.wK)(h.zi.SRC_ALPHA,h.zi.ONE,h.zi.ONE_MINUS_SRC_ALPHA,h.zi.ONE_MINUS_SRC_ALPHA),colorWrite:f.BK}):(0,f.sm)({colorWrite:f.BK})}}]),n}(l.A);p.shader=new u.J(s.a,(function(){return n.e(77026).then(n.bind(n,77026))}))},25049:function(e,t,n){n.d(t,{V:function(){return l}});var r=n(43144),i=n(15671),a=n(60136),o=n(92572),s=n(27366),u=n(33559),l=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).hasAlpha=!1,e}return(0,r.Z)(n)}(u.m);(0,s._)([(0,u.o)()],l.prototype,"hasAlpha",void 0)},78485:function(e,t,n){var r;n.d(t,{j:function(){return r}}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(r||(r={}))},97882:function(e,t,n){n.d(t,{F:function(){return m},e:function(){return y}});var r=n(37762),i=n(15671),a=n(43144),o=n(60136),s=n(92572),u=n(91505),l=n(100),c=n(92026),d=n(27546),h=n(1395),f=n(79100),p=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"],v=n(78329),g=n(78485),m=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r,a,o,s,c,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(0,i.Z)(this,n),(c=t.call(this)).apiLayerUid=h,c.type=f.U.Layer,c.events=new u.Z,c.sliceable=!1,c._objects=new d.Z,c._objectsAdded=new d.Z,c._stageHandles=new l.Z,c.apiLayerUid=h,c.visible=null===(r=null===e||void 0===e?void 0:e.visible)||void 0===r||r,c.pickable=null===(a=null===e||void 0===e?void 0:e.pickable)||void 0===a||a,c.updatePolicy=null!==(o=null===e||void 0===e?void 0:e.updatePolicy)&&void 0!==o?o:g.j.ASYNC,c._disableOctree=null!==(s=null===e||void 0===e?void 0:e.disableOctree)&&void 0!==s&&s,c}return(0,a.Z)(n,[{key:"objects",get:function(){return this._objects}},{key:"destroy",value:function(){this.detachStage(),this._stage=null}},{key:"attachStage",value:function(e){var t=this;this.detachStage(),this._stage=e;var n,i=(0,r.Z)(p);try{var a=function(){var r=n.value;t._stageHandles.add(t.events.on(r,(function(t){return e.handleEvent(r,t)})))};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}}},{key:"detachStage",value:function(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}},{key:"add",value:function(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),(0,c.pC)(this._octree)&&this._objectsAdded.push(e)}},{key:"remove",value:function(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),(0,c.pC)(this._octree)&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}},{key:"addMany",value:function(e){this._objects.pushArray(e);var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){t.value.parentLayer=this}}catch(i){n.e(i)}finally{n.f()}this.events.emit("layerObjectsAdded",{layer:this,objects:e}),(0,c.pC)(this._octree)&&this._objectsAdded.pushArray(e)}},{key:"removeMany",value:function(e){var t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){var n,i=(0,r.Z)(t);try{for(i.s();!(n=i.n()).done;){n.value.parentLayer=null}}catch(o){i.e(o)}finally{i.f()}if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),(0,c.pC)(this._octree)){for(var a=0;a<t.length;)this._objectsAdded.removeUnordered(t[a])?(t[a]=t[t.length-1],t.length-=1):++a;this._octree.remove(t)}}}},{key:"sync",value:function(){(0,c.pC)(this._stage)&&this.updatePolicy!==g.j.SYNC&&this._stage.syncLayer(this.id)}},{key:"notifyObjectBBChanged",value:function(e,t){(0,c.pC)(this._octree)&&!this._objectsAdded.includes(e)&&this._octree.update(e,t)}},{key:"getSpatialQueryAccelerator",value:function(){return(0,c.Wi)(this._octree)&&this._objects.length>50&&!this._disableOctree?(this._octree=new v.Z((function(e){return e.boundingVolumeWorldSpace.bounds})),this._octree.add(this._objects.data,this._objects.length)):(0,c.pC)(this._octree)&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}},{key:"shaderTransformationChanged",value:function(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}},{key:"invalidateSpatialQueryAccelerator",value:function(){this._octree=(0,c.SC)(this._octree),this._objectsAdded.clear()}}]),n}(h.c);function y(e){return(0,c.pC)(e)&&e.type===f.U.Layer}},22178:function(e,t,n){n.d(t,{G1:function(){return d},e4:function(){return l},es:function(){return c},nn:function(){return u}});var r=n(92026),i=n(11186),a=n(71353),o=n(82218),s=n(54463);function u(e){return(0,r.pC)(e)&&(0,r.pC)(e.dist)}function l(e){return function(t,n,r){return(0,i.h)(h,t,n,r),!(0,o.e)(e,h)}}function c(e){return u(e)&&e.intersector===s.q7.OBJECT&&!!e.target}function d(e){return u(e)&&e.intersector===s.q7.HUD&&!!e.target&&"center"in e.target&&(0,r.pC)(e.target.center)}var h=(0,a.c)()},41947:function(e,t,n){n.d(t,{q:function(){return i}});var r=n(78976);function i(e){var t=new Map,n=function(e){var n=t.get(e);return n||(n=new r.t9,t.set(e,n)),n};return e.removes.forAll((function(e){a(e)&&n(e.material).removes.push(e)})),e.adds.forAll((function(e){a(e)&&n(e.material).adds.push(e)})),e.updates.forAll((function(e){a(e.renderGeometry)&&n(e.renderGeometry.material).updates.push(e)})),t}function a(e){return e.geometry.indexCount>=1}},17852:function(e,t,n){n.d(t,{p:function(){return i},y:function(){return r}});var r={orderedRepackingEnabled:!1},i={rootOrigin:null}},66832:function(e,t,n){n.d(t,{E:function(){return N}});var r=n(15671),i=n(43144),a=n(60136),o=n(92572),s=n(93169),u=n(67077),l=n(37081),c=n(68401),d=n(23620),h=n(56529),f=n(78041),p=n(93822),v=n(12594),g=n(64642),m=n(11983),y=n(11752),_=n(61120),T=n(82144),x=n(31132),S=n(7566),O=n(27627),w=n(50411),b=n(25920),C=n(45028),A=n(49800),R=n(36207),E=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"initializeConfiguration",value:function(e,t){t.hasWebGL2Context=e.rctx.type===A.zO.WEBGL2}},{key:"initializeProgram",value:function(e){return new O.$(e.rctx,n.shader.get().build(this.configuration),S.i)}},{key:"_createPipeline",value:function(e,t){var n=this.configuration,r=e===b.A.NONE,i=e===b.A.FrontFace;return(0,R.sm)({blending:n.output!==l.H.Color&&n.output!==l.H.Alpha||!n.transparent?null:r?f.wu:(0,f.j7)(e),culling:(0,R.zp)(n.cullFace),depthTest:{func:(0,f.Bh)(e)},depthWrite:(r||i)&&n.writeDepth?R.LZ:null,colorWrite:R.BK,stencilWrite:n.hasOccludees?w.s3:null,stencilTest:n.hasOccludees?t?w.eD:w.RY:null,polygonOffset:r||i?n.polygonOffset?P:null:(0,f.je)(n.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:(0,y.Z)((0,_.Z)(n.prototype),"getPipelineState",this).call(this,e,t)}}]),n}(x.A);E.shader=new T.J(C.C,(function(){return n.e(23173).then(n.bind(n,23173))}));var P={factor:1,units:1},I=n(27366),D=n(33559),M=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).output=l.H.Color,e.cullFace=c.Vr.None,e.hasSlicePlane=!1,e.hasVertexColors=!1,e.transparent=!1,e.polygonOffset=!1,e.enableOffset=!0,e.writeDepth=!0,e.hasOccludees=!1,e.transparencyPassType=b.A.NONE,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e.objectAndLayerIdColorInstanced=!1,e}return(0,i.Z)(n)}(n(8883).W);(0,I._)([(0,D.o)({count:l.H.COUNT})],M.prototype,"output",void 0),(0,I._)([(0,D.o)({count:c.Vr.COUNT})],M.prototype,"cullFace",void 0),(0,I._)([(0,D.o)()],M.prototype,"hasSlicePlane",void 0),(0,I._)([(0,D.o)()],M.prototype,"hasVertexColors",void 0),(0,I._)([(0,D.o)()],M.prototype,"transparent",void 0),(0,I._)([(0,D.o)()],M.prototype,"polygonOffset",void 0),(0,I._)([(0,D.o)()],M.prototype,"enableOffset",void 0),(0,I._)([(0,D.o)()],M.prototype,"writeDepth",void 0),(0,I._)([(0,D.o)()],M.prototype,"hasOccludees",void 0),(0,I._)([(0,D.o)({count:b.A.COUNT})],M.prototype,"transparencyPassType",void 0),(0,I._)([(0,D.o)()],M.prototype,"hasMultipassTerrain",void 0),(0,I._)([(0,D.o)()],M.prototype,"cullAboveGround",void 0),(0,I._)([(0,D.o)()],M.prototype,"objectAndLayerIdColorInstanced",void 0);var N=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e,new L)).supportsEdges=!0,i._configuration=new M,i}return(0,i.Z)(n,[{key:"getConfiguration",value:function(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<f.ve,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}},{key:"requiresSlot",value:function(e,t){return!!(t===l.H.Color||t===l.H.Alpha||t===l.H.Highlight||t===l.H.Depth&&this.parameters.writeLinearDepth||t===l.H.ObjectAndLayerIdColor)&&(e===p.r.DRAPED_MATERIAL||(t===l.H.Highlight?e===p.r.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?p.r.TRANSPARENT_MATERIAL:p.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:p.r.OPAQUE_MATERIAL)))}},{key:"createGLMaterial",value:function(e){return new Z(e)}},{key:"createBufferWriter",value:function(){return new v.G((0,s.Z)("enable-feature:objectAndLayerId-rendering")?g.ck:g.IM)}}]),n}(m.c),Z=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return this._output!==l.H.Color&&this._output!==l.H.Alpha||this._updateOccludeeState(e),this.ensureTechnique(E,e)}}]),n}(d.Z),L=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).color=u.Z,e.transparent=!1,e.writeDepth=!0,e.writeLinearDepth=!1,e.hasVertexColors=!1,e.polygonOffset=!1,e.hasSlicePlane=!1,e.cullFace=c.Vr.None,e.hasOccludees=!1,e}return(0,i.Z)(n)}(h.Mt)},64642:function(e,t,n){n.d(t,{IM:function(){return s},W1:function(){return o},ck:function(){return u},wp:function(){return a}});var r=n(55158),i=n(4760),a=(0,r.U$)().vec3f(i.T.POSITION),o=(0,r.U$)().vec3f(i.T.POSITION).vec2f(i.T.UV0),s=(0,r.U$)().vec3f(i.T.POSITION).vec4u8(i.T.COLOR),u=((0,r.U$)().vec3f(i.T.POSITION).vec4u8(i.T.OBJECTANDLAYERIDCOLOR),(0,r.U$)().vec3f(i.T.POSITION).vec2f(i.T.UV0).vec4u8(i.T.OBJECTANDLAYERIDCOLOR),(0,r.U$)().vec3f(i.T.POSITION).vec4u8(i.T.COLOR).vec4u8(i.T.OBJECTANDLAYERIDCOLOR))},73059:function(e,t,n){n.d(t,{w:function(){return u}});var r=n(43144),i=n(15671),a=n(60136),o=n(92572),s=n(71353),u=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.c)();return(0,i.Z)(this,n),(e=t.call(this)).origin=r,e.slicePlaneLocalOrigin=e.origin,e}return(0,r.Z)(n)}(n(85380).Pf)},21400:function(e,t,n){n.d(t,{A:function(){return Q}});var r=n(1413),i=n(15671),a=n(43144),o=n(60136),s=n(92572),u=n(93169),l=n(16889),c=n(92026),d=n(22753),h=n(11873),f=n(14226),p=n(81949),v=n(88396),g=n(6394),m=n(11186),y=n(71353),_=n(67077);function T(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}var x=n(65156),S=n(25158),O=n(94463),w=n(55158),b=n(37081),C=n(81879),A=n(17363),R=n(56529),E=n(93822),P=n(65216),I=n(97731),D=n(4760),M=n(21166),N=n(33236),Z=n(22909),L=n(18442),k=n(50951),H=n(82144),F=n(31132),z=n(7566),U=n(78041),j=n(27627),V=n(25920),W=n(49800),B=n(8548),G=n(36207),q=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"initializeConfiguration",value:function(e,t){t.hasWebGL2Context=e.rctx.type===W.zO.WEBGL2,t.spherical=e.viewingMode===k.JY.Global}},{key:"initializeProgram",value:function(e){return new j.$(e.rctx,n.shader.get().build(this.configuration),z.i)}},{key:"_setPipelineState",value:function(e){var t=this.configuration,n=e===V.A.NONE,r=e===V.A.FrontFace,i=this.configuration.hasPolygonOffset?J:null,a=(n||r)&&t.output!==b.H.Highlight&&(t.depthEnabled||t.occlusionPass)?G.LZ:null;return(0,G.sm)({blending:t.output===b.H.Color||t.output===b.H.Alpha||t.output===b.H.Highlight?n?Y:(0,U.j7)(e):null,depthTest:{func:B.wb.LEQUAL},depthWrite:a,colorWrite:G.BK,polygonOffset:i})}},{key:"initializePipeline",value:function(){return this._setPipelineState(this.configuration.transparencyPassType)}},{key:"primitiveType",get:function(){return this.configuration.occlusionPass?B.MX.POINTS:B.MX.TRIANGLES}}]),n}(F.A);q.shader=new H.J(L.H,(function(){return n.e(16823).then(n.bind(n,16823))}));var J={factor:0,units:-4},Y=(0,G.if)(B.zi.ONE,B.zi.ONE_MINUS_SRC_ALPHA),X=n(27366),$=n(33559),K=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).output=b.H.Color,e.screenCenterOffsetUnitsEnabled=C.d.World,e.transparencyPassType=V.A.NONE,e.spherical=!1,e.occlusionTestEnabled=!0,e.signedDistanceFieldEnabled=!1,e.vvSize=!1,e.vvColor=!1,e.hasVerticalOffset=!1,e.hasScreenSizePerspective=!1,e.debugDrawLabelBorder=!1,e.binaryHighlightOcclusionEnabled=!0,e.hasSlicePlane=!1,e.hasPolygonOffset=!1,e.depthEnabled=!0,e.pixelSnappingEnabled=!0,e.isDraped=!1,e.hasMultipassGeometry=!1,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e.occlusionPass=!1,e.objectAndLayerIdColorInstanced=!1,e}return(0,a.Z)(n)}(n(8883).W);(0,X._)([(0,$.o)({count:b.H.COUNT})],K.prototype,"output",void 0),(0,X._)([(0,$.o)({count:C.d.COUNT})],K.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,X._)([(0,$.o)({count:V.A.COUNT})],K.prototype,"transparencyPassType",void 0),(0,X._)([(0,$.o)()],K.prototype,"spherical",void 0),(0,X._)([(0,$.o)()],K.prototype,"occlusionTestEnabled",void 0),(0,X._)([(0,$.o)()],K.prototype,"signedDistanceFieldEnabled",void 0),(0,X._)([(0,$.o)()],K.prototype,"vvSize",void 0),(0,X._)([(0,$.o)()],K.prototype,"vvColor",void 0),(0,X._)([(0,$.o)()],K.prototype,"hasVerticalOffset",void 0),(0,X._)([(0,$.o)()],K.prototype,"hasScreenSizePerspective",void 0),(0,X._)([(0,$.o)()],K.prototype,"debugDrawLabelBorder",void 0),(0,X._)([(0,$.o)()],K.prototype,"binaryHighlightOcclusionEnabled",void 0),(0,X._)([(0,$.o)()],K.prototype,"hasSlicePlane",void 0),(0,X._)([(0,$.o)()],K.prototype,"hasPolygonOffset",void 0),(0,X._)([(0,$.o)()],K.prototype,"depthEnabled",void 0),(0,X._)([(0,$.o)()],K.prototype,"pixelSnappingEnabled",void 0),(0,X._)([(0,$.o)()],K.prototype,"isDraped",void 0),(0,X._)([(0,$.o)()],K.prototype,"hasMultipassGeometry",void 0),(0,X._)([(0,$.o)()],K.prototype,"hasMultipassTerrain",void 0),(0,X._)([(0,$.o)()],K.prototype,"cullAboveGround",void 0),(0,X._)([(0,$.o)()],K.prototype,"occlusionPass",void 0),(0,X._)([(0,$.o)()],K.prototype,"objectAndLayerIdColorInstanced",void 0),(0,X._)([(0,$.o)({constValue:!0})],K.prototype,"hasSliceInVertexProgram",void 0),(0,X._)([(0,$.o)({constValue:!1})],K.prototype,"hasVvInstancing",void 0);var Q=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e,new Te))._configuration=new K,r}return(0,a.Z)(n,[{key:"getConfiguration",value:function(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?C.d.Screen:C.d.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=t.slot===E.r.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===b.H.Color||e===b.H.Alpha),e===b.H.Color&&(this._configuration.debugDrawLabelBorder=!!O.Z.LABELS_SHOW_BORDER),e===b.H.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassGeometry=t.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}},{key:"intersect",value:function(e,t,n,r,i,a){if(n.options.selectionMode&&n.options.hud&&e.visible){var o=this.parameters,s=1,u=1;if((0,d.f)(ce,t),(0,c.pC)(e.shaderTransformer)){var l=e.shaderTransformer(ve);s=l[0],u=l[5],function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=1/Math.sqrt(t*t+n*n+r*r),d=1/Math.sqrt(i*i+a*a+o*o),h=1/Math.sqrt(s*s+u*u+l*l);e[0]=t*c,e[1]=n*c,e[2]=r*c,e[3]=i*d,e[4]=a*d,e[5]=o*d,e[6]=s*h,e[7]=u*h,e[8]=l*h}(ce)}var h=e.vertexAttributes.get(D.T.POSITION),p=e.vertexAttributes.get(D.T.SIZE),v=e.vertexAttributes.get(D.T.NORMAL),g=e.vertexAttributes.get(D.T.AUXPOS1);(0,I.hu)(h.size>=3);var _=n.point,T=n.camera,x=(0,L.c)(o);s*=T.pixelRatio,u*=T.pixelRatio;for(var S="screen"===this.parameters.centerOffsetUnits,O=0;O<h.data.length/h.size;O++){var w=O*h.size;(0,m.s)(ae,h.data[w],h.data[w+1],h.data[w+2]),(0,m.m)(ae,ae,t);var b=O*p.size;ye[0]=p.data[b]*s,ye[1]=p.data[b+1]*u,(0,m.m)(ae,ae,T.viewMatrix);var C=O*g.size;if((0,m.s)(fe,g.data[C+0],g.data[C+1],g.data[C+2]),!S&&(ae[0]+=fe[0],ae[1]+=fe[1],0!==fe[2])){var A=fe[2];(0,m.n)(fe,ae),(0,m.b)(ae,ae,(0,m.g)(fe,fe,A))}var R=O*v.size;if((0,m.s)(oe,v.data[R],v.data[R+1],v.data[R+2]),this._normalAndViewAngle(oe,ce,T,pe),this._applyVerticalOffsetTransformationView(ae,pe,T,re),T.applyProjection(ae,se),se[0]>-1){se[0]=Math.floor(se[0]),se[1]=Math.floor(se[1]),S&&(fe[0]||fe[1])&&(se[0]+=fe[0],0!==fe[1]&&(se[1]+=(0,P.sX)(fe[1],re.factorAlignment)),T.unapplyProjection(se,ae)),se[0]+=this.parameters.screenOffset[0],se[1]+=this.parameters.screenOffset[1],(0,P.TU)(ye,re.factor,ye);var E=ge*T.pixelRatio,M=0;if(o.textureIsSignedDistanceField&&(M=o.outlineSize*T.pixelRatio/2),_&&ne(_,se[0],se[1],ye,E,M,o,x)){var N=n.ray;if((0,m.m)(le,ae,(0,f.a)(he,T.viewMatrix)),se[0]=_[0],se[1]=_[1],T.unprojectFromRenderScreen(se,ae)){var Z=(0,y.c)();(0,m.c)(Z,N.direction);var k=1/(0,m.l)(Z);(0,m.g)(Z,Z,k),a((0,m.i)(N.origin,ae)*k,Z,-1,!0,1,le)}}}}}}},{key:"intersectDraped",value:function(e,t,n,r,i,a){var o=e.vertexAttributes.get(D.T.POSITION),s=e.vertexAttributes.get(D.T.SIZE),u=this.parameters,l=(0,L.c)(u),d=1,h=1;if((0,c.pC)(e.shaderTransformer)){var f=e.shaderTransformer(ve);d=f[0],h=f[5]}d*=e.screenToWorldRatio,h*=e.screenToWorldRatio;for(var p=me*e.screenToWorldRatio,v=0;v<o.data.length/o.size;v++){var g=v*o.size,m=o.data[g],y=o.data[g+1],_=v*s.size;ye[0]=s.data[_]*d,ye[1]=s.data[_+1]*h;var T=0;u.textureIsSignedDistanceField&&(T=u.outlineSize*e.screenToWorldRatio/2),ne(r,m,y,ye,p,T,u,l)&&i(a.dist,a.normal,-1,!1)}}},{key:"createBufferWriter",value:function(){return new Oe(this)}},{key:"_normalAndViewAngle",value:function(e,t,n,r){return T(t)&&(t=(0,d.f)(de,t)),(0,m.t)(r.normal,e,t),(0,m.m)(r.normal,r.normal,n.viewInverseTransposeMatrix),r.cosAngle=(0,m.e)(ue,_e),r}},{key:"_updateScaleInfo",value:function(e,t,n){var r=this.parameters;(0,c.pC)(r.screenSizePerspective)?(0,P.PV)(n,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),(0,c.pC)(r.screenSizePerspectiveAlignment)?(0,P.PV)(n,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}},{key:"applyShaderOffsetsView",value:function(e,t,n,r,i,a,o){var s=this._normalAndViewAngle(t,n,i,pe);return this._applyVerticalGroundOffsetView(e,s,i,o),this._applyVerticalOffsetTransformationView(o,s,i,a),this._applyPolygonOffsetView(o,s,r[3],i,o),this._applyCenterOffsetView(o,r,o),o}},{key:"applyShaderOffsetsNDC",value:function(e,t,n,r,i){return this._applyCenterOffsetNDC(e,t,n,r),(0,c.pC)(i)&&(0,m.c)(i,r),this._applyPolygonOffsetNDC(r,t,n,r),r}},{key:"_applyPolygonOffsetView",value:function(e,t,n,r,i){var a=r.aboveGround?1:-1,o=Math.sign(n);0===o&&(o=a);var s=a*o;if(this.parameters.shaderPolygonOffset<=0)return(0,m.c)(i,e);var u=(0,l.uZ)(Math.abs(t.cosAngle),.01,1),c=1-Math.sqrt(1-u*u)/u/r.viewport[2];return(0,m.g)(i,e,s>0?c:1/c),i}},{key:"_applyVerticalGroundOffsetView",value:function(e,t,n,r){var i=(0,m.l)(e),a=n.aboveGround?1:-1,o=.5*n.computeRenderPixelSizeAtDist(i),s=(0,m.g)(ae,t.normal,a*o);return(0,m.a)(r,e,s),r}},{key:"_applyVerticalOffsetTransformationView",value:function(e,t,n,r){var i=this.parameters;if(!i.verticalOffset||!i.verticalOffset.screenLength){if(i.screenSizePerspective||i.screenSizePerspectiveAlignment){var a=(0,m.l)(e);this._updateScaleInfo(r,a,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}var o=(0,m.l)(e),s=(0,c.Pt)(i.screenSizePerspectiveAlignment,i.screenSizePerspective),u=(0,Z.Hx)(n,o,i.verticalOffset,t.cosAngle,s);return this._updateScaleInfo(r,o,t.cosAngle),(0,m.g)(t.normal,t.normal,u),(0,m.a)(e,e,t.normal)}},{key:"_applyCenterOffsetView",value:function(e,t,n){var r="screen"!==this.parameters.centerOffsetUnits;return n!==e&&(0,m.c)(n,e),r&&(n[0]+=t[0],n[1]+=t[1],t[2]&&((0,m.n)(oe,n),(0,m.a)(n,n,(0,m.g)(oe,oe,t[2])))),n}},{key:"_applyCenterOffsetNDC",value:function(e,t,n,r){var i="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,m.c)(r,e),i||(r[0]+=t[0]/n.fullWidth*2,r[1]+=t[1]/n.fullHeight*2),r}},{key:"_applyPolygonOffsetNDC",value:function(e,t,n,r){var i=this.parameters.shaderPolygonOffset;if(e!==r&&(0,m.c)(r,e),i){var a=n.aboveGround?1:-1,o=a*Math.sign(t[3]);r[2]-=(o||a)*i}return r}},{key:"requiresSlot",value:function(e,t){if(t===b.H.Color||t===b.H.Alpha||t===b.H.Highlight||t===b.H.ObjectAndLayerIdColor){if(e===E.r.DRAPED_MATERIAL)return!0;var n=this.parameters,r=n.drawInSecondSlot,i=n.occlusionTest;return e===(r?E.r.LABEL_MATERIAL:E.r.HUD_MATERIAL)||i&&e===E.r.OCCLUSION_PIXELS}return!1}},{key:"createGLMaterial",value:function(e){return new ee(e)}},{key:"calculateRelativeScreenBounds",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,x.Ue)();return te(this.parameters,e,t,n),n[2]=n[0]+e[0],n[3]=n[1]+e[1],n}}]),n}(R.F5),ee=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,(0,r.Z)((0,r.Z)({},e),e.material.parameters))}return(0,a.Z)(n,[{key:"selectProgram",value:function(e){return this.ensureTechnique(q,e)}},{key:"beginSlot",value:function(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}]),n}(A.F);function te(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ie;return(0,v.c)(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*n,r[1]+=e.screenOffset[1]*n,r}function ne(e,t,n,r,i,a,o,s){var u=t-i-(s[0]>0?r[0]*s[0]:0),l=u+r[0]+2*i,d=n-i-(s[1]>0?r[1]*s[1]:0),h=d+r[1]+2*i,f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&(0,c.pC)(f)&&(u+=r[0]*f[0],d+=r[1]*f[1],l-=r[0]*(1-f[2]),h-=r[1]*(1-f[3]),u-=a,l+=a,d-=a,h+=a),e[0]>u&&e[0]<l&&e[1]>d&&e[1]<h}var re=new M.G,ie=(0,g.a)(),ae=(0,y.c)(),oe=(0,y.c)(),se=(0,_.c)(),ue=(0,y.c)(),le=(0,y.c)(),ce=(0,h.c)(),de=(0,h.c)(),he=(0,p.c)(),fe=(0,y.c)(),pe={normal:ue,cosAngle:0},ve=(0,p.c)(),ge=1,me=2,ye=[0,0],_e=(0,y.f)(0,0,1),Te=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).renderOccluded=R.yD.Occlude,e.color=(0,_.f)(1,1,1,1),e.texCoordScale=[1,1],e.polygonOffset=!1,e.anchorPosition=(0,g.f)(.5,.5),e.screenOffset=[0,0],e.shaderPolygonOffset=1e-5,e.textureIsSignedDistanceField=!1,e.outlineColor=(0,_.f)(1,1,1,1),e.outlineSize=0,e.vvSizeEnabled=!1,e.vvSizeMinSize=[1,1,1],e.vvSizeMaxSize=[100,100,100],e.vvSizeOffset=[0,0,0],e.vvSizeFactor=[1,1,1],e.vvColorEnabled=!1,e.vvColorValues=[0,0,0,0,0,0,0,0],e.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],e.hasSlicePlane=!1,e.pixelSnappingEnabled=!0,e.occlusionTest=!0,e.binaryHighlightOcclusion=!0,e.centerOffsetUnits="world",e.drawInSecondSlot=!1,e.depthEnabled=!0,e.isDraped=!1,e}return(0,a.Z)(n)}(A.E),xe=(0,w.U$)().vec3f(D.T.POSITION).vec3f(D.T.NORMAL).vec2f(D.T.UV0).vec4u8(D.T.COLOR).vec2f(D.T.SIZE).vec4f(D.T.AUXPOS1).vec4f(D.T.AUXPOS2),Se=xe.clone().vec4u8(D.T.OBJECTANDLAYERIDCOLOR),Oe=function(){function e(t){(0,i.Z)(this,e),this._material=t,this.vertexBufferLayout=(0,u.Z)("enable-feature:objectAndLayerId-rendering")?Se:xe}return(0,a.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return 6*e.indices.get(D.T.POSITION).length}},{key:"write",value:function(e,t,n,r,i){(0,N.ho)(n.indices.get(D.T.POSITION),n.vertexAttributes.get(D.T.POSITION).data,e,r.position,i,6),(0,N.s5)(n.indices.get(D.T.NORMAL),n.vertexAttributes.get(D.T.NORMAL).data,t,r.normal,i,6);var a,o,s,u,l=n.vertexAttributes.get(D.T.UV0).data;if(null==l||l.length<4){var d=this._material.parameters;a=0,o=0,s=d.texCoordScale[0],u=d.texCoordScale[1]}else a=l[0],o=l[1],s=l[2],u=l[3];s=Math.min(1.99999,s+1),u=Math.min(1.99999,u+1);for(var h=n.indices.get(D.T.POSITION).length,f=i,p=r.uv0,v=0;v<h;++v)p.set(f,0,a),p.set(f,1,o),f+=1,p.set(f,0,s),p.set(f,1,o),f+=1,p.set(f,0,s),p.set(f,1,u),f+=1,p.set(f,0,s),p.set(f,1,u),f+=1,p.set(f,0,a),p.set(f,1,u),f+=1,p.set(f,0,a),p.set(f,1,o),f+=1;(0,N.Vs)(n.indices.get(D.T.COLOR),n.vertexAttributes.get(D.T.COLOR).data,4,r.color,i,6);var g=n.indices.get(D.T.SIZE),m=n.vertexAttributes.get(D.T.SIZE).data;h=g.length;var y=r.size;f=i;for(var _=0;_<h;++_)for(var T=m[2*g[_]],x=m[2*g[_]+1],O=0;O<6;++O)y.set(f,0,T),y.set(f,1,x),f+=1;if(n.indices.get(D.T.AUXPOS1)&&n.vertexAttributes.get(D.T.AUXPOS1)?(0,N.SW)(n.indices.get(D.T.AUXPOS1),n.vertexAttributes.get(D.T.AUXPOS1).data,r.auxpos1,i,6):(0,N.h)(r.auxpos1,i,6*h),n.indices.get(D.T.AUXPOS2)&&n.vertexAttributes.get(D.T.AUXPOS2)?(0,N.SW)(n.indices.get(D.T.AUXPOS2),n.vertexAttributes.get(D.T.AUXPOS2).data,r.auxpos2,i,6):(0,N.h)(r.auxpos2,i,6*h),(0,c.pC)(n.objectAndLayerIdColor)&&n.indices.get(D.T.POSITION)){var w=n.indices.get(D.T.POSITION).length,b=r.getField(D.T.OBJECTANDLAYERIDCOLOR,S.mc);(0,N.xP)(n.objectAndLayerIdColor,b,w,i,6)}}}]),e}()},24231:function(e,t,n){n.d(t,{Y:function(){return W}});var r=n(11752),i=n(61120),a=n(15671),o=n(43144),s=n(60136),u=n(92572),l=n(32718),c=n(16889),d=n(92026),h=n(17842),f=n(88396),p=n(11186),v=n(71353),g=n(67077),m=n(95773),y=n(85981),_=n(55652),T=n(25158),x=n(37081),S=n(23620),O=n(56529),w=n(93822),b=n(97731),C=n(4760),A=n(12594),R=n(64642),E=n(33236),P=n(82144),I=n(31132),D=n(7566),M=n(27627),N=n(50411),Z=n(99337),L=n(49800),k=n(8548),H=n(36207),F=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"_stippleEnabled",get:function(){return this.configuration.stippleEnabled&&this.configuration.output!==x.H.Highlight}},{key:"initializeConfiguration",value:function(e,t){t.hasWebGL2Context=e.rctx.type===L.zO.WEBGL2}},{key:"initializeProgram",value:function(e){return new M.$(e.rctx,n.shader.get().build(this.configuration),D.i)}},{key:"initializePipeline",value:function(){var e=this.configuration,t=(0,H.wK)(k.zi.SRC_ALPHA,k.zi.ONE,k.zi.ONE_MINUS_SRC_ALPHA,k.zi.ONE_MINUS_SRC_ALPHA),n=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,H.sm)({blending:n,depthTest:N.JN,depthWrite:r,colorWrite:H.BK,stencilWrite:e.hasOccludees?N.s3:null,stencilTest:e.hasOccludees?t?N.eD:N.RY:null})};return e.output===x.H.Color?(this._occludeePipelineState=n(!0,e.transparent||this._stippleEnabled?t:null,H.LZ),n(!1,e.transparent||this._stippleEnabled?t:null,H.LZ)):n(!1)}},{key:"primitiveType",get:function(){return k.MX.LINES}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:(0,r.Z)((0,i.Z)(n.prototype),"getPipelineState",this).call(this,e,t)}}]),n}(I.A);F.shader=new P.J(Z.N,(function(){return n.e(78569).then(n.bind(n,78569))}));var z,U=n(27366),j=n(33559),V=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments)).output=x.H.Color,e.hasSlicePlane=!1,e.hasVertexColors=!1,e.transparent=!1,e.draped=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stipplePreferContinuous=!0,e.hasOccludees=!1,e}return(0,o.Z)(n)}(n(8883).W);(0,U._)([(0,j.o)({count:x.H.COUNT})],V.prototype,"output",void 0),(0,U._)([(0,j.o)()],V.prototype,"hasSlicePlane",void 0),(0,U._)([(0,j.o)()],V.prototype,"hasVertexColors",void 0),(0,U._)([(0,j.o)()],V.prototype,"transparent",void 0),(0,U._)([(0,j.o)()],V.prototype,"draped",void 0),(0,U._)([(0,j.o)()],V.prototype,"stippleEnabled",void 0),(0,U._)([(0,j.o)()],V.prototype,"stippleOffColorEnabled",void 0),(0,U._)([(0,j.o)()],V.prototype,"stipplePreferContinuous",void 0),(0,U._)([(0,j.o)()],V.prototype,"hasOccludees",void 0),(0,U._)([(0,j.o)({constValue:!1})],V.prototype,"stippleRequiresClamp",void 0),(0,U._)([(0,j.o)({constValue:!1})],V.prototype,"stippleScaleWithLineWidth",void 0),(0,U._)([(0,j.o)({constValue:!1})],V.prototype,"stippleRequiresStretchMeasure",void 0),function(e){e[e.START=0]="START",e[e.END=1]="END"}(z||(z={}));var W=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,a.Z)(this,n),(r=t.call(this,e,new q))._configuration=new V,r}return(0,o.Z)(n,[{key:"getConfiguration",value:function(e,t){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=t.slot===w.r.DRAPED_MATERIAL;var n=(0,d.pC)(this.parameters.stipplePattern);return this._configuration.stippleEnabled=n,this._configuration.stippleOffColorEnabled=n&&(0,d.pC)(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}},{key:"intersect",value:function(e,t,n,r,i,a){if(n.options.selectionMode&&e.visible)if((0,b.kG)(t)){var o=e.vertexAttributes.get(C.T.POSITION).data,s=n.camera,u=ie;(0,f.c)(u,n.point);(0,p.s)(ae[0],u[0]-2,u[1]+2,0),(0,p.s)(ae[1],u[0]+2,u[1]+2,0),(0,p.s)(ae[2],u[0]+2,u[1]-2,0),(0,p.s)(ae[3],u[0]-2,u[1]-2,0);for(var c=0;c<4;c++)if(!s.unprojectFromRenderScreen(ae[c],oe[c]))return;(0,_.zk)(s.eye,oe[0],oe[1],se),(0,_.zk)(s.eye,oe[1],oe[2],ue),(0,_.zk)(s.eye,oe[2],oe[3],le),(0,_.zk)(s.eye,oe[3],oe[0],ce);for(var d=Number.MAX_VALUE,h=0,v=0;v<o.length-5;v+=3)if(J[0]=o[v]+t[12],J[1]=o[v+1]+t[13],J[2]=o[v+2]+t[14],Y[0]=o[v+3]+t[12],Y[1]=o[v+4]+t[13],Y[2]=o[v+5]+t[14],!((0,_.jH)(se,J)<0&&(0,_.jH)(se,Y)<0||(0,_.jH)(ue,J)<0&&(0,_.jH)(ue,Y)<0||(0,_.jH)(le,J)<0&&(0,_.jH)(le,Y)<0||(0,_.jH)(ce,J)<0&&(0,_.jH)(ce,Y)<0)){if(s.projectToRenderScreen(J,K),s.projectToRenderScreen(Y,Q),K[2]<0&&Q[2]>0){(0,p.b)(X,J,Y);var g=s.frustum,T=-(0,_.jH)(g[m.Nu.NEAR],J)/(0,p.e)(X,(0,_.mJ)(g[m.Nu.NEAR]));(0,p.g)(X,X,T),(0,p.a)(J,J,X),s.projectToRenderScreen(J,K)}else if(K[2]>0&&Q[2]<0){(0,p.b)(X,Y,J);var x=s.frustum,S=-(0,_.jH)(x[m.Nu.NEAR],Y)/(0,p.e)(X,(0,_.mJ)(x[m.Nu.NEAR]));(0,p.g)(X,X,S),(0,p.a)(Y,Y,X),s.projectToRenderScreen(Y,Q)}else if(K[2]<0&&Q[2]<0)continue;K[2]=0,Q[2]=0;var O=(0,y.Jk)((0,y.zk)(K,Q,ne),u);O<d&&(d=O,(0,p.c)(ee,J),(0,p.c)(te,Y),h=v/3)}var w=n.rayBegin,A=n.rayEnd;if(d<4){var R=Number.MAX_VALUE;if((0,y.AR)((0,y.zk)(ee,te,ne),(0,y.zk)(w,A,re),$)){(0,p.b)($,$,w);var E=(0,p.l)($);(0,p.g)($,$,1/E),R=E/(0,p.i)(w,A)}a(R,$,h,!1)}}else l.Z.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix")}},{key:"intersectDraped",value:function(e,t,n,r,i,a){if(n.options.selectionMode){for(var o=e.vertexAttributes.get(C.T.POSITION).data,s=e.vertexAttributes.get(C.T.SIZE),u=s?s.data[0]:0,l=r[0],d=r[1],h=((u+1)/2+4)*e.screenToWorldRatio,f=Number.MAX_VALUE,p=0,v=0;v<o.length-5;v+=3){var g=o[v],m=o[v+1],y=l-g,_=d-m,T=o[v+3]-g,x=o[v+4]-m,S=(0,c.uZ)((T*y+x*_)/(T*T+x*x),0,1),O=T*S-y,w=x*S-_,b=O*O+w*w;b<f&&(f=b,p=v/3)}f<h*h&&i(a.dist,a.normal,p,!1)}}},{key:"requiresSlot",value:function(e,t){return!(t!==x.H.Color&&t!==x.H.Highlight&&t!==x.H.ObjectAndLayerIdColor||e!==w.r.OPAQUE_MATERIAL&&e!==w.r.DRAPED_MATERIAL)}},{key:"createGLMaterial",value:function(e){return new B(e)}},{key:"createBufferWriter",value:function(){var e=this.parameters.hasVertexColors?R.IM:R.wp;return(0,d.Wi)(this.parameters.stipplePattern)?new A.G(e):new G(e.clone().vec3f(C.T.AUXPOS1).vec2f(C.T.UV0))}}]),n}(O.F5),B=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments))._stipplePattern=null,e}return(0,o.Z)(n,[{key:"dispose",value:function(){(0,r.Z)((0,i.Z)(n.prototype),"dispose",this).call(this),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){this._output===x.H.Color&&this._updateOccludeeState(e);var t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,t)),this._stipplePattern=t),this.ensureTechnique(F,e)}}]),n}(S.Z),G=function(){function e(t){(0,a.Z)(this,e),this.vertexBufferLayout=t}return(0,o.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get(C.T.POSITION).length}},{key:"write",value:function(e,t,n,r,i){(0,E.NK)(n,this.vertexBufferLayout,e,t,r,i),this._writeAuxpos1(e,n,r,i),this._writeUV0(e,n,r,i)}},{key:"_writeAuxpos1",value:function(e,t,n,r){var i=n.getField(C.T.AUXPOS1,T.ct),a=t.indices.get(C.T.POSITION),o=t.vertexAttributes.get(C.T.POSITION).data,s=e,u=i.typedBufferStride,l=i.typedBuffer;r*=u;for(var c=0;c<a.length-1;c+=2)for(var d=0,h=[1,0];d<h.length;d++){var f=3*a[c+h[d]],p=o[f],v=o[f+1],g=o[f+2],m=s[0]*p+s[4]*v+s[8]*g+s[12],y=s[1]*p+s[5]*v+s[9]*g+s[13],_=s[2]*p+s[6]*v+s[10]*g+s[14];l[r]=m,l[r+1]=y,l[r+2]=_,r+=u}}},{key:"_writeUV0",value:function(e,t,n,r){var i,a=n.getField(C.T.UV0,T.Eu),o=t.indices.get(C.T.POSITION),s=t.vertexAttributes.get(C.T.POSITION).data,u=null===(i=t.vertexAttributes.get(C.T.DISTANCETOSTART))||void 0===i?void 0:i.data,l=a.typedBufferStride,c=a.typedBuffer,d=0;c[r*=l]=z.START,c[r+1]=d,r+=l;var h=3*o[0],f=(0,p.s)(J,s[h],s[h+1],s[h+2]);e&&(0,p.m)(f,f,e);for(var v=Y,g=o.length-1,m=1,y=u?function(e,t,n){return d=u[n]}:function(e,t,n){return d+=(0,p.i)(e,t)},_=1;_<g;_+=2){var x=3*o[_];(0,p.s)(v,s[x],s[x+1],s[x+2]),e&&(0,p.m)(v,v,e),y(f,v,m++);for(var S=0;S<2;++S)c[r]=1-S,c[r+1]=d,r+=l;(0,p.c)(f,v)}var O=3*o[g];(0,p.s)(v,s[O],s[O+1],s[O+2]),e&&(0,p.m)(v,v,e),y(f,v,m),c[r]=z.END,c[r+1]=d}}]),e}(),q=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments)).color=g.O,e.hasVertexColors=!1,e.hasSlicePlane=!1,e.width=1,e.stipplePreferContinuous=!0,e.hasOccludees=!1,e.stippleTexture=null,e}return(0,o.Z)(n)}(O.Mt),J=(0,v.c)(),Y=(0,v.c)(),X=(0,v.c)(),$=(0,v.c)(),K=(0,h.J$)(),Q=(0,h.J$)(),ee=(0,v.c)(),te=(0,v.c)(),ne=(0,y.Ue)(),re=(0,y.Ue)(),ie=(0,v.c)(),ae=[(0,h.J$)(),(0,h.J$)(),(0,h.J$)(),(0,h.J$)()],oe=[(0,v.c)(),(0,v.c)(),(0,v.c)(),(0,v.c)()],se=(0,_.Ue)(),ue=(0,_.Ue)(),le=(0,_.Ue)(),ce=(0,_.Ue)()},58901:function(e,t,n){n.d(t,{U:function(){return W}});var r=n(11752),i=n(61120),a=n(15671),o=n(43144),s=n(60136),u=n(92572),l=n(93169),c=n(32718),d=n(16889),h=n(92026),f=n(17842),p=n(88396),v=n(11186),g=n(71353),m=n(67077),y=n(95773),_=n(85981),T=n(55652),x=n(55158),S=n(37081),O=n(23620),w=n(56529),b=n(93822),C=n(97731),A=n(4760),R=n(65964),E=n(33720),P=n(98186),I=n(82144),D=n(31132),M=n(78041),N=n(27627),Z=n(50411),L=n(25920),k=n(8548),H=n(36207),F=new Map([[A.T.POSITION,0],[A.T.SUBDIVISIONFACTOR,1],[A.T.UV0,2],[A.T.AUXPOS1,3],[A.T.AUXPOS2,4],[A.T.COLOR,5],[A.T.COLORFEATUREATTRIBUTE,5],[A.T.SIZE,6],[A.T.SIZEFEATUREATTRIBUTE,6],[A.T.OPACITYFEATUREATTRIBUTE,7],[A.T.OBJECTANDLAYERIDCOLOR,8]]),z=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"initializeProgram",value:function(e){return new N.$(e.rctx,n.shader.get().build(this.configuration),F)}},{key:"_makePipelineState",value:function(e,t){var n=this.configuration,r=e===L.A.NONE,i=e===L.A.FrontFace;return(0,H.sm)({blending:n.output===S.H.Color||n.output===S.H.Alpha?r?M.wu:(0,M.j7)(e):null,depthTest:{func:(0,M.Bh)(e)},depthWrite:r?n.writeDepth?H.LZ:null:(0,M.K5)(e),colorWrite:H.BK,stencilWrite:n.hasOccludees?Z.s3:null,stencilTest:n.hasOccludees?t?Z.eD:Z.RY:null,polygonOffset:r||i?n.hasPolygonOffset?j:null:M.E0})}},{key:"initializePipeline",value:function(){var e=this.configuration;if(e.occluder){var t=e.hasPolygonOffset?j:null;this._occluderPipelineTransparent=(0,H.sm)({blending:M.wu,polygonOffset:t,depthTest:Z.zV,depthWrite:null,colorWrite:H.BK,stencilWrite:null,stencilTest:Z.YD}),this._occluderPipelineOpaque=(0,H.sm)({blending:M.wu,polygonOffset:t,depthTest:Z.zV,depthWrite:null,colorWrite:H.BK,stencilWrite:Z.P7,stencilTest:Z.ii}),this._occluderPipelineMaskWrite=(0,H.sm)({blending:null,polygonOffset:t,depthTest:Z.JN,depthWrite:null,colorWrite:null,stencilWrite:Z.s3,stencilTest:Z.eD})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}},{key:"primitiveType",get:function(){return this.configuration.wireframe?k.MX.LINES:k.MX.TRIANGLE_STRIP}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===b.r.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===b.r.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:(0,r.Z)((0,i.Z)(n.prototype),"getPipelineState",this).call(this,e,t)}}]),n}(D.A);z.shader=new I.J(P.a,(function(){return n.e(56279).then(n.bind(n,56279))}));var U,j={factor:0,units:-4},V=n(737);!function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"}(U||(U={}));var W=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,a.Z)(this,n),(r=t.call(this,e,new G))._configuration=new V.G,r._vertexAttributeLocations=F,r._layout=r.createLayout(),r}return(0,o.Z)(n,[{key:"isClosed",value:function(e,t){return X(this.parameters,e,t)}},{key:"getConfiguration",value:function(e,t){this._configuration.output=e,this._configuration.draped=t.slot===b.r.DRAPED_MATERIAL;var n=(0,h.pC)(this.parameters.stipplePattern)&&e!==S.H.Highlight;return this._configuration.stippleEnabled=n,this._configuration.stippleOffColorEnabled=n&&(0,h.pC)(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=n&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=n&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=!!(0,h.pC)(this.parameters.markerParameters)&&function(e){return e.anchor===E.i5.Tip&&e.hideOnShortSegments&&"begin-end"===e.placement&&e.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&(0,h.pC)(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===w.yD.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}},{key:"intersectDraped",value:function(e,t,n,r,i,a){if(n.options.selectionMode){var o=e.vertexAttributes.get(A.T.POSITION).data,s=e.vertexAttributes.get(A.T.SIZE),u=this.parameters.width;if(this.parameters.vvSizeEnabled){var l=e.vertexAttributes.get(A.T.SIZEFEATUREATTRIBUTE).data[0];u*=(0,d.uZ)(this.parameters.vvSizeOffset[0]+l*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else s&&(u*=s.data[0]);for(var c=r[0],h=r[1],f=(u/2+4)*e.screenToWorldRatio,p=Number.MAX_VALUE,v=0,g=0;g<o.length-5;g+=3){var m=o[g],y=o[g+1],_=c-m,T=h-y,x=o[g+3]-m,S=o[g+4]-y,O=(0,d.uZ)((x*_+S*T)/(x*x+S*S),0,1),w=x*O-_,b=S*O-T,C=w*w+b*b;C<p&&(p=C,v=g/3)}p<f*f&&i(a.dist,a.normal,v,!1)}}},{key:"intersect",value:function(e,t,n,r,i,a){if(n.options.selectionMode&&e.visible)if((0,C.kG)(t)){var o=e.vertexAttributes,s=o.get(A.T.POSITION).data,u=this.parameters.width;if(this.parameters.vvSizeEnabled){var l=o.get(A.T.SIZEFEATUREATTRIBUTE).data[0];u*=(0,d.uZ)(this.parameters.vvSizeOffset[0]+l*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o.has(A.T.SIZE)&&(u*=o.get(A.T.SIZE).data[0]);var h=n.camera,f=te;(0,p.c)(f,n.point);var g=u*h.pixelRatio/2+4*h.pixelRatio;(0,v.s)(de[0],f[0]-g,f[1]+g,0),(0,v.s)(de[1],f[0]+g,f[1]+g,0),(0,v.s)(de[2],f[0]+g,f[1]-g,0),(0,v.s)(de[3],f[0]-g,f[1]-g,0);for(var m=0;m<4;m++)if(!h.unprojectFromRenderScreen(de[m],he[m]))return;(0,T.zk)(h.eye,he[0],he[1],fe),(0,T.zk)(h.eye,he[1],he[2],pe),(0,T.zk)(h.eye,he[2],he[3],ve),(0,T.zk)(h.eye,he[3],he[0],ge);for(var x=Number.MAX_VALUE,S=0,O=Y(this.parameters,o,e.indices)?s.length-2:s.length-5,w=0;w<O;w+=3){$[0]=s[w]+t[12],$[1]=s[w+1]+t[13],$[2]=s[w+2]+t[14];var b=(w+3)%s.length;if(K[0]=s[b]+t[12],K[1]=s[b+1]+t[13],K[2]=s[b+2]+t[14],!((0,T.jH)(fe,$)<0&&(0,T.jH)(fe,K)<0||(0,T.jH)(pe,$)<0&&(0,T.jH)(pe,K)<0||(0,T.jH)(ve,$)<0&&(0,T.jH)(ve,K)<0||(0,T.jH)(ge,$)<0&&(0,T.jH)(ge,K)<0)){if(h.projectToRenderScreen($,ne),h.projectToRenderScreen(K,re),ne[2]<0&&re[2]>0){(0,v.b)(Q,$,K);var R=h.frustum,E=-(0,T.jH)(R[y.Nu.NEAR],$)/(0,v.e)(Q,(0,T.mJ)(R[y.Nu.NEAR]));(0,v.g)(Q,Q,E),(0,v.a)($,$,Q),h.projectToRenderScreen($,ne)}else if(ne[2]>0&&re[2]<0){(0,v.b)(Q,K,$);var P=h.frustum,I=-(0,T.jH)(P[y.Nu.NEAR],K)/(0,v.e)(Q,(0,T.mJ)(P[y.Nu.NEAR]));(0,v.g)(Q,Q,I),(0,v.a)(K,K,Q),h.projectToRenderScreen(K,re)}else if(ne[2]<0&&re[2]<0)continue;ne[2]=0,re[2]=0;var D=(0,_.Jk)((0,_.zk)(ne,re,oe),f);D<x&&(x=D,(0,v.c)(ie,$),(0,v.c)(ae,K),S=w/3)}}var M=n.rayBegin,N=n.rayEnd;if(x<g*g){var Z=Number.MAX_VALUE;if((0,_.AR)((0,_.zk)(ie,ae,oe),(0,_.zk)(M,N,se),ee)){(0,v.b)(ee,ee,M);var L=(0,v.l)(ee);(0,v.g)(ee,ee,1/L),Z=L/(0,v.i)(M,N)}a(Z,ee,S,!1)}}else c.Z.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix")}},{key:"createLayout",value:function(){var e=(0,x.U$)().vec3f(A.T.POSITION).f32(A.T.SUBDIVISIONFACTOR).vec2f(A.T.UV0).vec3f(A.T.AUXPOS1).vec3f(A.T.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(A.T.SIZEFEATUREATTRIBUTE):e.f32(A.T.SIZE),this.parameters.vvColorEnabled?e.f32(A.T.COLORFEATUREATTRIBUTE):e.vec4f(A.T.COLOR),this.parameters.vvOpacityEnabled&&e.f32(A.T.OPACITYFEATUREATTRIBUTE),(0,l.Z)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(A.T.OBJECTANDLAYERIDCOLOR),e}},{key:"createBufferWriter",value:function(){return new q(this._layout,this.parameters)}},{key:"requiresSlot",value:function(e,t){return(t===S.H.Color||t===S.H.Alpha||t===S.H.Highlight||t===S.H.Depth||t===S.H.ObjectAndLayerIdColor)&&(e===b.r.DRAPED_MATERIAL||(this.parameters.renderOccluded===w.yD.OccludeAndTransparentStencil?e===b.r.OPAQUE_MATERIAL||e===b.r.OCCLUDER_MATERIAL||e===b.r.TRANSPARENT_OCCLUDER_MATERIAL:t===S.H.Color||t===S.H.Alpha?e===(this.parameters.writeDepth?b.r.TRANSPARENT_MATERIAL:b.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===b.r.OPAQUE_MATERIAL))}},{key:"createGLMaterial",value:function(e){return new B(e)}},{key:"validateParameters",value:function(e){"miter"!==e.join&&(e.miterLimit=0),(0,h.pC)(e.markerParameters)&&(e.markerScale=e.markerParameters.width/e.width)}}]),n}(w.F5),B=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments))._stipplePattern=null,e}return(0,o.Z)(n,[{key:"dispose",value:function(){(0,r.Z)((0,i.Z)(n.prototype),"dispose",this).call(this),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){this._output!==S.H.Color&&this._output!==S.H.Alpha||this._updateOccludeeState(e);var t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,t)),this._stipplePattern=t),this.ensureTechnique(z,e)}}]),n}(O.Z),G=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments)).width=0,e.color=m.O,e.join="miter",e.cap=V.R.BUTT,e.miterLimit=5,e.writeDepth=!0,e.hasPolygonOffset=!1,e.stippleTexture=null,e.stippleScaleWithLineWidth=!1,e.stipplePreferContinuous=!0,e.markerParameters=null,e.markerScale=1,e.hasSlicePlane=!1,e.vvFastUpdate=!1,e.isClosed=!1,e.falloff=0,e.innerWidth=0,e.hasOccludees=!1,e.wireframe=!1,e}return(0,o.Z)(n)}(R.n),q=function(){function e(t,n){(0,a.Z)(this,e),this._parameters=n,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;var r=n.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=P.R+r}}return(0,o.Z)(e,[{key:"_isClosed",value:function(e){return Y(this._parameters,e.vertexAttributes,e.indices)}},{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){var t=e.indices.get(A.T.POSITION).length/2+1,n=this._isClosed(e),r=n?2:4;return r+=((n?t:t-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),r+=2,this._parameters.wireframe&&(r=2+4*(r-2)),r}},{key:"write",value:function(e,t,n,r,i){var a,o=this,s=ue,u=le,c=ce,d=n.vertexAttributes.get(A.T.POSITION).data,f=n.indices&&n.indices.get(A.T.POSITION),p=null===(a=n.vertexAttributes.get(A.T.DISTANCETOSTART))||void 0===a?void 0:a.data;f&&f.length!==2*(d.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");var g=1,m=0;this._parameters.vvSizeEnabled?m=n.vertexAttributes.get(A.T.SIZEFEATUREATTRIBUTE).data[0]:n.vertexAttributes.has(A.T.SIZE)&&(g=n.vertexAttributes.get(A.T.SIZE).data[0]);var y=[1,1,1,1],_=0;this._parameters.vvColorEnabled?_=n.vertexAttributes.get(A.T.COLORFEATUREATTRIBUTE).data[0]:n.vertexAttributes.has(A.T.COLOR)&&(y=n.vertexAttributes.get(A.T.COLOR).data);var T=(0,l.Z)("enable-feature:objectAndLayerId-rendering")?n.objectAndLayerIdColor:null,x=0;this._parameters.vvOpacityEnabled&&(x=n.vertexAttributes.get(A.T.OPACITYFEATUREATTRIBUTE).data[0]);var S=d.length/3,O=new Float32Array(r.buffer),w=(0,l.Z)("enable-feature:objectAndLayerId-rendering")?new Uint8Array(r.buffer):null,b=this.vertexBufferLayout.stride/4,C=i*b,R=C,E=0,P=p?function(e,t,n){return E=p[n]}:function(e,t,n){return E+=(0,v.i)(e,t)},I=(0,l.Z)("enable-feature:objectAndLayerId-rendering"),D=function(e,t,n,r,i,a,s){if(O[C++]=t[0],O[C++]=t[1],O[C++]=t[2],O[C++]=r,O[C++]=s,O[C++]=i,O[C++]=e[0],O[C++]=e[1],O[C++]=e[2],O[C++]=n[0],O[C++]=n[1],O[C++]=n[2],o._parameters.vvSizeEnabled?O[C++]=m:O[C++]=g,o._parameters.vvColorEnabled)O[C++]=_;else{var u=Math.min(4*a,y.length-4);O[C++]=y[u],O[C++]=y[u+1],O[C++]=y[u+2],O[C++]=y[u+3]}o._parameters.vvOpacityEnabled&&(O[C++]=x),I&&((0,h.pC)(T)&&(w[4*C]=T[0],w[4*C+1]=T[1],w[4*C+2]=T[2],w[4*C+3]=T[3]),C++)};C+=b,(0,v.s)(u,d[0],d[1],d[2]),e&&(0,v.m)(u,u,e);var M=this._isClosed(n);if(M){var N=d.length-3;(0,v.s)(s,d[N],d[N+1],d[N+2]),e&&(0,v.m)(s,s,e)}else(0,v.s)(c,d[3],d[4],d[5]),e&&(0,v.m)(c,c,e),D(u,u,c,1,U.LEFT_CAP_START,0,0),D(u,u,c,1,U.RIGHT_CAP_START,0,0),(0,v.c)(s,u),(0,v.c)(u,c);for(var Z=M?0:1,L=M?S:S-1,k=Z;k<L;k++){var H=(k+1)%S*3;(0,v.s)(c,d[H],d[H+1],d[H+2]),e&&(0,v.m)(c,c,e),P(s,u,k),D(s,u,c,0,U.LEFT_JOIN_END,k,E),D(s,u,c,0,U.RIGHT_JOIN_END,k,E);for(var F=this.numJoinSubdivisions,z=0;z<F;++z){var j=(z+1)/(F+1);D(s,u,c,j,U.LEFT_JOIN_END,k,E),D(s,u,c,j,U.RIGHT_JOIN_END,k,E)}D(s,u,c,1,U.LEFT_JOIN_START,k,E),D(s,u,c,1,U.RIGHT_JOIN_START,k,E),(0,v.c)(s,u),(0,v.c)(u,c)}M?((0,v.s)(c,d[3],d[4],d[5]),e&&(0,v.m)(c,c,e),E=P(s,u,L),D(s,u,c,0,U.LEFT_JOIN_END,Z,E),D(s,u,c,0,U.RIGHT_JOIN_END,Z,E)):(E=P(s,u,L),D(s,u,u,0,U.LEFT_CAP_END,L,E),D(s,u,u,0,U.RIGHT_CAP_END,L,E)),J(O,R+b,O,R,b),C=J(O,C-b,O,C,b),this._parameters.wireframe&&this._addWireframeVertices(r,R,C,b)}},{key:"_addWireframeVertices",value:function(e,t,n,r){for(var i=new Float32Array(e.buffer,n*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,n-t),o=0,s=function(e){return o=J(a,e,i,o,r)},u=0;u<a.length-1;u+=2*r)s(u),s(u+2*r),s(u+1*r),s(u+2*r),s(u+1*r),s(u+3*r)}}]),e}();function J(e,t,n,r,i){for(var a=0;a<i;a++)n[r++]=e[t++];return r}function Y(e,t,n){return X(e,t.get(A.T.POSITION).data,n?n.get(A.T.POSITION):null)}function X(e,t,n){return!!e.isClosed&&(n?n.length>2:t.length>6)}var $=(0,g.c)(),K=(0,g.c)(),Q=(0,g.c)(),ee=(0,g.c)(),te=(0,g.c)(),ne=(0,f.J$)(),re=(0,f.J$)(),ie=(0,g.c)(),ae=(0,g.c)(),oe=(0,_.Ue)(),se=(0,_.Ue)(),ue=(0,g.c)(),le=(0,g.c)(),ce=(0,g.c)(),de=[(0,f.J$)(),(0,f.J$)(),(0,f.J$)(),(0,f.J$)()],he=[(0,g.c)(),(0,g.c)(),(0,g.c)(),(0,g.c)()],fe=(0,T.Ue)(),pe=(0,T.Ue)(),ve=(0,T.Ue)(),ge=(0,T.Ue)()},21166:function(e,t,n){n.d(t,{G:function(){return a}});var r=n(43144),i=n(15671),a=(0,r.Z)((function e(){(0,i.Z)(this,e),this.factor=new o,this.factorAlignment=new o})),o=(0,r.Z)((function e(){(0,i.Z)(this,e),this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}))},82031:function(e,t,n){n.d(t,{$A:function(){return y},h0:function(){return p},it:function(){return T},kj:function(){return _}});var r=n(93433),i=n(37762),a=n(60136),o=n(92572),s=n(15671),u=n(43144),l=n(46228),c=n(92026),d=n(98634),h=n(8548),f=n(371),p=function(){function e(t){(0,s.Z)(this,e),this._rctx=t,this._cache=new Map}return(0,u.Z)(e,[{key:"destroy",value:function(){this._cache.forEach((function(e){return(0,c.M2)(e.stippleTexture)})),this._cache.clear()}},{key:"_acquire",value:function(e){if((0,c.Wi)(e))return null;var t=this._patternId(e),n=this._cache.get(t);if(n)return n.refCount++,n;var r=g(e),i=r.encodedData,a=r.paddedPixels,o=new v(new f.x(this._rctx,{width:a,height:1,internalFormat:h.VI.RGBA,pixelFormat:h.VI.RGBA,dataType:h.Br.UNSIGNED_BYTE,wrapMode:h.e8.CLAMP_TO_EDGE},i));return this._cache.set(t,o),o}},{key:"release",value:function(e){if(!(0,c.Wi)(e)){var t=this._patternId(e),n=this._cache.get(t);n&&(n.refCount--,0===n.refCount&&((0,c.pC)(n.stippleTexture)&&n.stippleTexture.dispose(),this._cache.delete(t)))}}},{key:"swap",value:function(e,t){var n=this._acquire(t);return this.release(e),n}},{key:"_patternId",value:function(e){return"".concat(e.pattern.join(","),"-r").concat(e.pixelRatio)}}]),e}(),v=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this)).stippleTexture=e,r.refCount=1,r}return(0,u.Z)(n)}(d.K);function g(e){var t,n=m(e),a=1/e.pixelRatio,o=y(e),s=_(e),u=(Math.floor(.5*(s-1))+.5)*a,c=[],d=1,h=(0,i.Z)(n);try{for(h.s();!(t=h.n()).done;){for(var f=t.value,p=0;p<f;p++){var v=d*(Math.min(p,f-1-p)+.5)*a/u*.5+.5;c.push(v)}d=-d}}catch(R){h.e(R)}finally{h.f()}var g,x=Math.round(n[0]/2),S=[].concat((0,r.Z)(c.slice(x)),(0,r.Z)(c.slice(0,x))),O=o+T,w=new Uint8Array(4*O),b=4,C=(0,i.Z)(S);try{for(C.s();!(g=C.n()).done;){var A=g.value;(0,l.I)(A,w,b),b+=4}}catch(R){C.e(R)}finally{C.f()}return w.copyWithin(0,b-4,b),w.copyWithin(b,4,8),{encodedData:w,paddedPixels:O}}function m(e){return e.pattern.map((function(t){return Math.round(t*e.pixelRatio)}))}function y(e){if((0,c.Wi)(e))return 1;var t=m(e);return Math.floor(t.reduce((function(e,t){return e+t})))}function _(e){return m(e).reduce((function(e,t){return Math.max(e,t)}))}var T=2},11983:function(e,t,n){n.d(t,{c:function(){return l}});var r=n(15671),i=n(43144),a=n(60136),o=n(92572),s=n(56529),u=n(22909),l=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"intersect",value:function(e,t,n,r,i,a){return(0,u.Bw)(e,n,r,i,void 0,a)}}]),n}(s.F5)},29674:function(e,t,n){n.d(t,{H:function(){return k},m:function(){return H}});var r=n(15671),i=n(43144),a=n(60136),o=n(92572),s=n(38499),u=n(6394),l=n(67077),c=n(37081),d=n(96856),h=n(56529),f=n(78041),p=n(93822),v=n(12594),g=n(64642),m=n(11983),y=n(92026),_=n(23620),T=n(27366),x=n(50951),S=n(41481),O=n(79246),w=n(82144),b=n(31132),C=n(33559),A=n(7566),R=n(27627),E=n(25920),P=n(8883),I=n(49810),D=n(49800),M=n(36207),N=(O.U,function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"initializeConfiguration",value:function(e,t){t.hasWebGL2Context=e.rctx.type===D.zO.WEBGL2,t.spherical=e.viewingMode===x.JY.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}},{key:"initializeProgram",value:function(e){return new R.$(e.rctx,n.shader.get().build(this.configuration),A.i)}},{key:"_setPipelineState",value:function(e){var t=this.configuration,n=e===E.A.NONE,r=e===E.A.FrontFace;return(0,M.sm)({blending:t.output!==c.H.Normal&&t.output!==c.H.Highlight&&t.transparent?n?f.wu:(0,f.j7)(e):null,depthTest:{func:(0,f.Bh)(e)},depthWrite:n?t.writeDepth?M.LZ:null:(0,f.K5)(e),colorWrite:M.BK,polygonOffset:n||r?null:(0,f.je)(t.enableOffset)})}},{key:"initializePipeline",value:function(){return this._setPipelineState(this.configuration.transparencyPassType)}}]),n}(b.A));N.shader=new w.J(I.W,(function(){return n.e(19106).then(n.bind(n,19106))}));var Z=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).output=c.H.Color,e.transparencyPassType=E.A.NONE,e.spherical=!1,e.receiveShadows=!1,e.hasSlicePlane=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!1,e.hasScreenSpaceReflections=!1,e.doublePrecisionRequiresObfuscation=!1,e.hasCloudsReflections=!1,e.isDraped=!1,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e}return(0,i.Z)(n)}(P.W);(0,T._)([(0,C.o)({count:c.H.COUNT})],Z.prototype,"output",void 0),(0,T._)([(0,C.o)({count:E.A.COUNT})],Z.prototype,"transparencyPassType",void 0),(0,T._)([(0,C.o)()],Z.prototype,"spherical",void 0),(0,T._)([(0,C.o)()],Z.prototype,"receiveShadows",void 0),(0,T._)([(0,C.o)()],Z.prototype,"hasSlicePlane",void 0),(0,T._)([(0,C.o)()],Z.prototype,"transparent",void 0),(0,T._)([(0,C.o)()],Z.prototype,"enableOffset",void 0),(0,T._)([(0,C.o)()],Z.prototype,"writeDepth",void 0),(0,T._)([(0,C.o)()],Z.prototype,"hasScreenSpaceReflections",void 0),(0,T._)([(0,C.o)()],Z.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,T._)([(0,C.o)()],Z.prototype,"hasCloudsReflections",void 0),(0,T._)([(0,C.o)()],Z.prototype,"isDraped",void 0),(0,T._)([(0,C.o)()],Z.prototype,"hasMultipassTerrain",void 0),(0,T._)([(0,C.o)()],Z.prototype,"cullAboveGround",void 0),(0,T._)([(0,C.o)({constValue:S.f7.Water})],Z.prototype,"pbrMode",void 0),(0,T._)([(0,C.o)({constValue:!0})],Z.prototype,"useCustomDTRExponentForWater",void 0),(0,T._)([(0,C.o)({constValue:!0})],Z.prototype,"highStepCount",void 0),(0,T._)([(0,C.o)({constValue:!1})],Z.prototype,"useFillLights",void 0);var L=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"_updateShadowState",value:function(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}},{key:"_updateSSRState",value:function(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}},{key:"_updateCloudsReflectionState",value:function(e){var t=(0,y.pC)(e.cloudsFade.data);t!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:t})}},{key:"ensureResources",value:function(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}},{key:"beginSlot",value:function(e){return this._output===c.H.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(N,e)}}]),n}(_.Z),k=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e,new H))._configuration=new Z,i.animation=new d.d,i}return(0,i.Z)(n,[{key:"getConfiguration",value:function(e,t){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<f.ve,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}},{key:"update",value:function(e){var t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<F;var n=this.animation.advance(e);return this.setParameters({timeElapsed:(0,s.D9)(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&n}},{key:"requiresSlot",value:function(e,t){switch(t){case c.H.Normal:return e===p.r.DRAPED_WATER;case c.H.Color:if(this.parameters.isDraped)return e===p.r.DRAPED_MATERIAL;break;case c.H.Alpha:break;case c.H.Highlight:return e===p.r.OPAQUE_MATERIAL||e===p.r.DRAPED_MATERIAL;default:return!1}var n=p.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(n=this.parameters.writeDepth?p.r.TRANSPARENT_MATERIAL:p.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===n}},{key:"createGLMaterial",value:function(e){return new L(e)}},{key:"createBufferWriter",value:function(){return new v.G(g.W1)}}]),n}(m.c),H=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).waveStrength=.06,e.waveTextureRepeat=32,e.waveDirection=(0,u.f)(1,0),e.waveVelocity=.05,e.flowStrength=.015,e.flowOffset=-.5,e.animationSpeed=.35,e.timeElapsed=0,e.color=(0,l.f)(0,0,0,0),e.transparent=!0,e.writeDepth=!0,e.hasSlicePlane=!1,e.isDraped=!1,e.receiveShadows=!0,e.hasScreenSpaceReflections=!1,e.hasCloudsReflections=!1,e}return(0,i.Z)(n)}(h.Mt),F=35e3},86700:function(e,t,n){n.d(t,{Dp:function(){return u},z5:function(){return s}});var r=n(93433),i=n(92026),a={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},o={dash:a.dash,"dash-dot":[].concat((0,r.Z)(a.dash),(0,r.Z)(a.dot)),dot:a.dot,"long-dash":a["long-dash"],"long-dash-dot":[].concat((0,r.Z)(a["long-dash"]),(0,r.Z)(a.dot)),"long-dash-dot-dot":[].concat((0,r.Z)(a["long-dash"]),(0,r.Z)(a.dot),(0,r.Z)(a.dot)),none:null,"short-dash":a["short-dash"],"short-dash-dot":[].concat((0,r.Z)(a["short-dash"]),(0,r.Z)(a["short-dot"])),"short-dash-dot-dot":[].concat((0,r.Z)(a["short-dash"]),(0,r.Z)(a["short-dot"]),(0,r.Z)(a["short-dot"])),"short-dot":a["short-dot"],solid:null};function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return{pattern:[e,e],pixelRatio:t}}function u(e){return(0,i.pC)(e)&&"style"===e.type?function(e){return(0,i.pC)(e)?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return(0,i.Wi)(e)?e:{pattern:e.slice(),pixelRatio:t}}(o[e],8):null}(e.style):null}},80903:function(e,t,n){n.d(t,{A:function(){return z}});var r=n(37762),i=n(15671),a=n(43144),o=n(63780),s=n(77427),u=n(92026),l=n(59447),c=n(27546),d=n(14226),h=n(81949),f=n(50256),p=n(37081),v=n(44070),g=n(8548),m=function(){function e(t){(0,i.Z)(this,e),this._rctx=t,this._indexBuffer=this._createIndexbuffer(),this._program=this._createProgram()}return(0,a.Z)(e,[{key:"_createProgram",value:function(){return this._rctx.programCache.acquire("\n    void main(void) {\n      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }","\n    void main(void) {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n    }",new Map([]))}},{key:"_createIndexbuffer",value:function(){return v.f.createIndex(this._rctx,g.l1.STATIC_DRAW,new Uint32Array([0]))}},{key:"resetIndicesType",value:function(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,g.w0.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(g.MX.POINTS,1,g.g.UNSIGNED_INT,0))}},{key:"dispose",value:function(){this._program.dispose(),this._indexBuffer.dispose()}}]),e}(),y=n(94425),_=n(56529),T=n(78289),x=n(97731),S=n(73059),O=n(29674),w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,i.Z)(this,e),this.from=t,this.to=n}return(0,a.Z)(e,[{key:"numElements",get:function(){return this.to-this.from}}]),e}();function b(e){var t=new Map;e.forAll((function(e){return t.set(e.from,e)}));for(var n=!0;n;)n=!1,e.forEach((function(r){var i=t.get(r.to);i&&(r.to=i.to,t.delete(i.from),e.removeUnordered(i),n=!0)}))}var C=n(60136),A=n(92572),R=function(e){(0,C.Z)(n,e);var t=(0,A.Z)(n);function n(e,r,a){var o;return(0,i.Z)(this,n),(o=t.call(this,r,a)).geometry=e,o}return(0,a.Z)(n,[{key:"isVisible",get:function(){return this.geometry.visible}},{key:"hasHighlights",get:function(){return(0,u.pC)(this.geometry.highlights)&&this.isVisible}},{key:"hasOccludees",get:function(){return(0,u.pC)(this.geometry.occludees)}}]),n}(w),E=(0,a.Z)((function e(){(0,i.Z)(this,e),this.first=0,this.count=0})),P=function(){function e(){(0,i.Z)(this,e),this._numElements=0,this._instances=new Map,this.holes=new c.Z({allocator:function(e){return e||new w},deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=I(),this.drawCommandsHighlight=I(),this.drawCommandsOccludees=I(),this.drawCommandsShadowHighlightRest=I()}return(0,a.Z)(e,[{key:"numElements",get:function(){return this._numElements}},{key:"instances",get:function(){return this._instances}},{key:"addInstance",value:function(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}},{key:"deleteInstance",value:function(e){var t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}},{key:"updateInstance",value:function(e,t,n){var r=this._instances.get(e);r&&(this._numElements-=r.numElements,r.from=t,r.to=n,this._numElements+=r.numElements)}},{key:"updateDrawState",value:function(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}},{key:"updateDrawCommands",value:function(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0!==this._instances.size){if(!this.needsMultipleCommands()){var t=this.drawCommandsDefault.pushNew(),n=this.holes.front();return(0,u.pC)(this.vao)&&1===this.holes.length&&n.to===Math.floor(this.vao.size/e)?(t.first=0,void(t.count=n.from)):(t.first=1/0,t.count=0,this._instances.forEach((function(e){t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}var i,a=Array.from(this._instances.values()).sort((function(e,t){return e.from===t.from?e.to-t.to:e.from-t.from})),o=(0,r.Z)(a);try{for(o.s();!(i=o.n()).done;){var s=i.value;s.isVisible&&(D(s.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,s),D(s.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,s))}}catch(l){o.e(l)}finally{o.f()}}}},{key:"needsMultipleCommands",value:function(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}]),e}();function I(){return new c.Z({allocator:function(e){return e||new E},deallocator:function(e){return e}})}function D(e,t){var n=e.back();if(null==n){var r=e.pushNew();return r.first=t.from,void(r.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(n,t)){var i=t.from-n.first+t.numElements;n.count=i}else{var a=e.pushNew();a.first=t.from,a.count=t.numElements}}var M=function(){function e(t){(0,i.Z)(this,e),this.origin=t,this.buffers=new Array}return(0,a.Z)(e,[{key:"dispose",value:function(){this.buffers.forEach((function(e){return e.vao.dispose()})),this.buffers.length=0}},{key:"findBuffer",value:function(e){return this.buffers.find((function(t){return t.instances.has(e)}))}}]),e}(),N=n(18759),Z=n(95439),L=n(80658),k=N.an+1,H=function(){function e(t,n,r){(0,i.Z)(this,e),this._rctx=t,this._locations=n,this._layout=r,this._cache=t.newCache("VaoCache ".concat((0,Z.D)()),F)}return(0,a.Z)(e,[{key:"dispose",value:function(){this._cache.destroy()}},{key:"newVao",value:function(e){var t=e.toString(),n=this._cache.pop(t);if((0,u.pC)(n)){var r=n.pop();return n.length>0&&this._cache.put(t,n,e*n.length,k),r}var i=new L.U(this._rctx,this._locations,{geometry:this._layout},{geometry:v.f.createVertex(this._rctx,g.l1.STATIC_DRAW)});return i.vertexBuffers.geometry.setSize(e),i}},{key:"deleteVao",value:function(e){if((0,u.Wi)(e))return null;var t=e.size,n=t.toString(),r=this._cache.pop(n);return(0,u.pC)(r)?(r.push(e),this._cache.put(n,r,t*r.length,-1)):this._cache.put(n,[e],t,-1),null}}]),e}();function F(e,t){if(t!==N.lN.ALL){var n=e.pop(),r=e.length*n.size;return n.dispose(),r}e.forEach((function(e){return e.dispose()}))}var z=function(){function e(t,n,r){(0,i.Z)(this,e),this._rctx=t,this._materialRepository=n,this.material=r,this._dataByOrigin=new Map,this._appleAmdDriverHelper=null,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new y.p(this.material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._vaoCache=new H(t,r.vertexAttributeLocations,(0,f.K)(this._bufferWriter.vertexBufferLayout)),this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new m(this._rctx))}return(0,a.Z)(e,[{key:"dispose",value:function(){var e;this._glMaterials.destroy(),this._dataByOrigin.forEach((function(e){return e.dispose()})),this._dataByOrigin.clear(),this._vaoCache.dispose(),null===(e=this._appleAmdDriverHelper)||void 0===e||e.dispose()}},{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&this.material instanceof O.H}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&this.material.renderOccluded!==_.yD.Occlude}},{key:"numGeometries",get:function(){var e=0;return this._dataByOrigin.forEach((function(t){return e+=t.buffers.reduce((function(e,t){return e+t.instances.size}),0)})),e}},{key:"forEachGeometry",value:function(e){this._dataByOrigin.forEach((function(t){return t.buffers.forEach((function(t){return t.instances.forEach((function(t){return e(t.geometry)}))}))}))}},{key:"modify",value:function(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}},{key:"_updateGeometries",value:function(e){var t,n=this._bufferWriter,i=n.vertexBufferLayout.stride/4,a=(0,r.Z)(e);try{for(a.s();!(t=a.n()).done;){var o,s=t.value,l=s.renderGeometry,c=null===(o=this._dataByOrigin.get(l.localOrigin.id))||void 0===o?void 0:o.findBuffer(l.id);if((0,u.Wi)(c))return;var d=c.instances.get(l.id);if(s.updateType&(T.$.GEOMETRY|T.$.TRANSFORMATION)){var h=K(n.elementCount(d.geometry.geometry)*i),f=n.vertexBufferLayout.createView(h.buffer);this._writeGeometry(l,f,0),c.vao.vertexBuffers.geometry.setSubData(h,d.from*i,0,d.numElements*i)}s.updateType&(T.$.HIGHLIGHT|T.$.OCCLUDEE|T.$.VISIBILITY)&&(c.drawCommandsDirty=!0)}}catch(p){a.e(p)}finally{a.f()}}},{key:"_computeDeltas",value:function(e,t){var n,i=new l.r,a=(0,r.Z)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=o.localOrigin;if(!(0,u.Wi)(s)){var c=i.get(s.id,null);(0,u.Wi)(c)&&(c=new U(s.vec3),i.set(s.id,null,c)),c.changes.push(o)}}}catch(y){a.e(y)}finally{a.f()}var d,h=(0,r.Z)(t);try{for(h.s();!(d=h.n()).done;){var f,p=d.value,v=p.localOrigin;if(!(0,u.Wi)(v)){var g=null===(f=this._dataByOrigin.get(v.id))||void 0===f?void 0:f.findBuffer(p.id);if(!(0,u.Wi)(g)){var m=i.get(v.id,g);(0,u.Wi)(m)&&(m=new U(v.vec3),i.set(v.id,g,m)),m.changes.push(p)}}}}catch(y){h.e(y)}finally{h.f()}return i}},{key:"_addAndRemoveGeometries",value:function(e,t){var n=this,r=this._bufferWriter,i=this._dataByOrigin,a=r.vertexBufferLayout.stride/4,s=this._computeDeltas(e,t);s.forEach((function(e,t){var l=e.get(null),c=(0,u.pC)(l)?l.changes:[];s.delete(t,null);var d=i.get(t);if(e.forEach((function(e,l){if(s.delete(t,l),(0,u.Wi)(l))(0,x.hu)(!1,"No VAO for removed geometries");else{if(l.instances.size===e.changes.length)return n._vaoCache.deleteVao(l.vao),(0,o.e$)(d.buffers,l),void(0===d.buffers.length&&0===c.length&&i.delete(t));var h=l.numElements,f=l.vao.size/4,p=c.reduce((function(e,t){return e+r.elementCount(t.geometry)}),0),v=e.changes.reduce((function(e,t){return e+r.elementCount(t.geometry)}),0),g=Math.min((h+p-v)*a,X),m=g>f;g>q&&g<f/2?(e.changes.forEach((function(e){var t=e.id;return l.deleteInstance(t)})),l.instances.forEach((function(e){var t=e.geometry;return c.push(t)})),n._vaoCache.deleteVao(l.vao),(0,o.e$)(d.buffers,l)):m?n._applyAndRebuild(l,c,e):n._applyRemoves(l,e)}})),c.length>0)for((0,u.Wi)(d)&&(d=new M(l.origin),i.set(t,d)),d.buffers.forEach((function(e){return n._applyAdds(e,c)}));c.length>0;)d.buffers.push(n._applyAndRebuild(new P,c,null))}))}},{key:"_updateDrawCommands",value:function(){var e=this;this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((function(t){t.buffers.forEach((function(t){t.drawCommandsDirty&&(t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,(0,s.oE)(t.instances,(function(e){return t.updateDrawState(e),t.hasHiddenInstances&&t.hasHighlights&&t.hasOccludees})),t.updateDrawCommands(e._bufferWriter.vertexBufferLayout.stride)),e._hasHighlights=e._hasHighlights||t.hasHighlights,e._hasOccludees=e._hasOccludees||t.hasOccludees}))}))}},{key:"_applyAndRebuild",value:function(e,t,n){var i=this;if((0,u.pC)(n)){var a,o=(0,r.Z)(n.changes);try{for(o.s();!(a=o.n()).done;){var s=a.value;e.deleteInstance(s.id)}}catch(O){o.e(O)}finally{o.f()}}for(var l=this._bufferWriter,c=l.vertexBufferLayout.stride,d=c/4,h=Math.floor(X/d),f=e.numElements;t.length>0;){var p=t.pop(),v=l.elementCount(p.geometry);if(f+v>h&&f>0){t.push(p);break}f+=v;var g=new R(p,0,0);(0,x.hu)(null==e.instances.get(p.id)),e.addInstance(p.id,g)}var m=f*d,y=K(m),_=l.vertexBufferLayout.createView(y.buffer),T=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((function(t,n){i._writeGeometry(t.geometry,_,T);var r=T;T+=l.elementCount(t.geometry.geometry),e.updateInstance(n,r,T),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Q(m)),e.vao.vertexBuffers.geometry.setSubData(y,0,0,T*d),e.holes.clear();var S=e.holes.pushNew();return S.from=T,S.to=Math.floor(e.vao.size/c),e.updateDrawCommands(c),e}},{key:"_applyRemoves",value:function(e,t){if(0!==t.changes.length){var n,i=(0,r.Z)(t.changes);try{for(i.s();!(n=i.n()).done;){var a=n.value.id,o=e.instances.get(a);if(o){e.deleteInstance(a);var s=G.back();if(s){if(s.to===o.from){s.to=o.to;continue}if(s.from===o.to){s.from=o.from;continue}}var u=G.pushNew();u.from=o.from,u.to=o.to}}}catch(f){i.e(f)}finally{i.f()}b(G);var l=this._bufferWriter.vertexBufferLayout.stride/4,c=G.reduce((function(e,t){return Math.max(e,t.numElements)}),0)*l,d=K(c);d.fill(0,0,c);var h=e.vao.vertexBuffers.geometry;G.forAll((function(e){return h.setSubData(d,e.from*l,0,e.numElements*l)})),e.holes.pushArray(G.data,G.length),G.forAll((function(e,t){return G.data[t]=null})),G.clear(),e.drawCommandsDirty=!0}}},{key:"_applyAdds",value:function(e,t){var n=this;if(0!==t.length)if(function(e){return(0,u.pC)(e.vao)}(e)){var i=this._bufferWriter,a=i.vertexBufferLayout.stride/4,s=e.numElements,l=t.reduce((function(e,t){return e+i.elementCount(t.geometry)}),0),c=Math.min((s+l)*a,X),d=4*c;if(e.vao.size<Q(X-q)&&d>e.vao.size)this._applyAndRebuild(e,t,null);else{b(e.holes);var h,f=new Array,p=(0,r.Z)(t);try{for(p.s();!(h=p.n()).done;){var v=h.value,g=i.elementCount(v.geometry),m=j(e.holes,g);f.push(m)}}catch(A){p.e(A)}finally{p.f()}var y=e.vao.vertexBuffers.geometry,_=0,T=0,S=0,O=K(c),w=i.vertexBufferLayout.createView(O.buffer);t.forEach((function(t,r){var o=f[r];if(!(0,u.Wi)(o)){if(S!==o){var s=S-T;s>0&&y.setSubData(O,T*a,0,s*a),T=o,_=0}var l=i.elementCount(t.geometry);n._writeGeometry(t,w,_),_+=l,S=o+l;var c=new R(t,o,o+l);(0,x.hu)(null==e.instances.get(t.id)),e.addInstance(t.id,c),e.drawCommandsDirty=!0}}));var C=S-T;C>0&&y.setSubData(O,T*a,0,C*a),(0,o.hv)(t,(function(e,t){return(0,u.Wi)(f[t])}))}}else this._applyAndRebuild(e,t,null)}},{key:"_writeGeometry",value:function(e,t,n){var r=e.localOrigin.vec3;(0,x.u_)(V,-r[0],-r[1],-r[2]);var i=(0,d.m)(W,V,e.transformation);(0,d.a)(B,i),(0,d.t)(B,B),this._bufferWriter.write(i,B,e.geometry,t,n)}},{key:"updateAnimation",value:function(e){return this.material.update(e)}},{key:"requiresSlot",value:function(e,t){return this.material.requiresSlot(e,t)}},{key:"render",value:function(e,t){var n,i=this;if(!this.requiresSlot(t.slot,e))return!1;var a=e===p.H.Highlight||e===p.H.ShadowHighlight;if(a&&!this._hasHighlights)return!1;var o,s=e===p.H.ShadowExcludeHighlight,l=!(a||s),c=this._rctx,d=function(){if((0,u.pC)(o))return o;var n=i._glMaterials.load(c,t.slot,e);return(0,u.Wi)(n)?null:(o=n.beginSlot(t),(0,u.Wi)(o)?null:(c.bindTechnique(o,i.material.parameters,t),o))};null===(n=this._appleAmdDriverHelper)||void 0===n||n.resetIndicesType();var h,f=(0,r.Z)(this._dataByOrigin.values());try{for(f.s();!(h=f.n()).done;){var v,g=h.value,m=(0,r.Z)(g.buffers);try{for(m.s();!(v=m.n()).done;){var y=v.value;if(!a||y.hasHighlights){var _=(a?y.drawCommandsHighlight:s&&y.needsMultipleCommands()?y.drawCommandsShadowHighlightRest:y.drawCommandsDefault)||null,T=l&&y.drawCommandsOccludees||null;if(null!==_&&void 0!==_&&_.length||null!==T&&void 0!==T&&T.length){var x=function(){var e=d();if((0,u.Wi)(e))return{v:!1};e.program.bindDraw(new S.w(g.origin),t,i.material.parameters),e.ensureAttributeLocations(y.vao),c.bindVAO(y.vao),null!==_&&void 0!==_&&_.length&&(e.bindPipelineState(c,t.slot,!1),_.forAll((function(t){return c.drawArrays(e.primitiveType,t.first,t.count)}))),(null===T||void 0===T?void 0:T.length)&&(e.bindPipelineState(c,t.slot,!0),T.forAll((function(t){return c.drawArrays(e.primitiveType,t.first,t.count)})))}();if("object"===typeof x)return x.v}}}}catch(O){m.e(O)}finally{m.f()}}}catch(O){f.e(O)}finally{f.f()}return(0,u.pC)(o)}},{key:"test",get:function(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}]),e}(),U=(0,a.Z)((function e(t){(0,i.Z)(this,e),this.origin=t,this.changes=new Array}));function j(e,t){var n;if(!e.some((function(e){return!(e.numElements<t)&&(n=e,!0)})))return null;var r=n.from;return n.from+=t,n.from>=n.to&&e.removeUnordered(n),r}var V=(0,h.c)(),W=(0,h.c)(),B=(0,h.c)(),G=new c.Z({allocator:function(e){return e||new w},deallocator:null}),q=65536,J=4*q,Y=16777216,X=Y/4,$=new Float32Array(q);function K(e){return $.length<e&&($=new Float32Array(e)),$}function Q(e){var t=4*e;return t<J?J:Math.max(Math.min(Math.ceil(1.5*t/J)*J,Y),t)}},33720:function(e,t,n){n.d(t,{I9:function(){return r},PI:function(){return v},i5:function(){return i}});var r,i,a,o=n(43144),s=n(15671),u=n(60136),l=n(92572),c=n(27366),d=n(37081),h=n(33559),f=n(25920),p=n(8883);(a=r||(r={}))[a.Draped=0]="Draped",a[a.Screen=1]="Screen",a[a.World=2]="World",a[a.COUNT=3]="COUNT",function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(i||(i={}));var v=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;return(0,s.Z)(this,n),(e=t.apply(this,arguments)).output=d.H.Color,e.transparencyPassType=f.A.NONE,e.occluder=!1,e.hasSlicePlane=!1,e.writeDepth=!1,e.space=r.Screen,e.hideOnShortSegments=!1,e.hasCap=!1,e.anchor=i.Center,e.hasTip=!1,e.vvSize=!1,e.vvColor=!1,e.vvOpacity=!1,e.hasOccludees=!1,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e}return(0,o.Z)(n)}(p.W);(0,c._)([(0,h.o)({count:d.H.COUNT})],v.prototype,"output",void 0),(0,c._)([(0,h.o)({count:f.A.COUNT})],v.prototype,"transparencyPassType",void 0),(0,c._)([(0,h.o)()],v.prototype,"occluder",void 0),(0,c._)([(0,h.o)()],v.prototype,"hasSlicePlane",void 0),(0,c._)([(0,h.o)()],v.prototype,"writeDepth",void 0),(0,c._)([(0,h.o)({count:r.COUNT})],v.prototype,"space",void 0),(0,c._)([(0,h.o)()],v.prototype,"hideOnShortSegments",void 0),(0,c._)([(0,h.o)()],v.prototype,"hasCap",void 0),(0,c._)([(0,h.o)({count:i.COUNT})],v.prototype,"anchor",void 0),(0,c._)([(0,h.o)()],v.prototype,"hasTip",void 0),(0,c._)([(0,h.o)()],v.prototype,"vvSize",void 0),(0,c._)([(0,h.o)()],v.prototype,"vvColor",void 0),(0,c._)([(0,h.o)()],v.prototype,"vvOpacity",void 0),(0,c._)([(0,h.o)()],v.prototype,"hasOccludees",void 0),(0,c._)([(0,h.o)()],v.prototype,"hasMultipassTerrain",void 0),(0,c._)([(0,h.o)()],v.prototype,"cullAboveGround",void 0),(0,c._)([(0,h.o)({constValue:!0})],v.prototype,"hasVvInstancing",void 0),(0,c._)([(0,h.o)({constValue:!0})],v.prototype,"hasSliceTranslatedView",void 0)},737:function(e,t,n){n.d(t,{G:function(){return p},R:function(){return r}});var r,i,a=n(43144),o=n(15671),s=n(60136),u=n(92572),l=n(27366),c=n(37081),d=n(33559),h=n(25920),f=n(8883);(i=r||(r={}))[i.BUTT=0]="BUTT",i[i.SQUARE=1]="SQUARE",i[i.ROUND=2]="ROUND",i[i.COUNT=3]="COUNT";var p=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).output=c.H.Color,e.capType=r.BUTT,e.transparencyPassType=h.A.NONE,e.occluder=!1,e.hasSlicePlane=!1,e.hasPolygonOffset=!1,e.writeDepth=!1,e.draped=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stippleScaleWithLineWidth=!1,e.stipplePreferContinuous=!0,e.roundJoins=!1,e.applyMarkerOffset=!1,e.vvSize=!1,e.vvColor=!1,e.vvOpacity=!1,e.falloffEnabled=!1,e.innerColorEnabled=!1,e.hasOccludees=!1,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e.wireframe=!1,e.objectAndLayerIdColorInstanced=!1,e}return(0,a.Z)(n)}(f.W);(0,l._)([(0,d.o)({count:c.H.COUNT})],p.prototype,"output",void 0),(0,l._)([(0,d.o)({count:r.COUNT})],p.prototype,"capType",void 0),(0,l._)([(0,d.o)({count:h.A.COUNT})],p.prototype,"transparencyPassType",void 0),(0,l._)([(0,d.o)()],p.prototype,"occluder",void 0),(0,l._)([(0,d.o)()],p.prototype,"hasSlicePlane",void 0),(0,l._)([(0,d.o)()],p.prototype,"hasPolygonOffset",void 0),(0,l._)([(0,d.o)()],p.prototype,"writeDepth",void 0),(0,l._)([(0,d.o)()],p.prototype,"draped",void 0),(0,l._)([(0,d.o)()],p.prototype,"stippleEnabled",void 0),(0,l._)([(0,d.o)()],p.prototype,"stippleOffColorEnabled",void 0),(0,l._)([(0,d.o)()],p.prototype,"stippleScaleWithLineWidth",void 0),(0,l._)([(0,d.o)()],p.prototype,"stipplePreferContinuous",void 0),(0,l._)([(0,d.o)()],p.prototype,"roundJoins",void 0),(0,l._)([(0,d.o)()],p.prototype,"applyMarkerOffset",void 0),(0,l._)([(0,d.o)()],p.prototype,"vvSize",void 0),(0,l._)([(0,d.o)()],p.prototype,"vvColor",void 0),(0,l._)([(0,d.o)()],p.prototype,"vvOpacity",void 0),(0,l._)([(0,d.o)()],p.prototype,"falloffEnabled",void 0),(0,l._)([(0,d.o)()],p.prototype,"innerColorEnabled",void 0),(0,l._)([(0,d.o)()],p.prototype,"hasOccludees",void 0),(0,l._)([(0,d.o)()],p.prototype,"hasMultipassTerrain",void 0),(0,l._)([(0,d.o)()],p.prototype,"cullAboveGround",void 0),(0,l._)([(0,d.o)()],p.prototype,"wireframe",void 0),(0,l._)([(0,d.o)({constValue:!0})],p.prototype,"stippleRequiresClamp",void 0),(0,l._)([(0,d.o)({constValue:!0})],p.prototype,"stippleRequiresStretchMeasure",void 0),(0,l._)([(0,d.o)({constValue:!0})],p.prototype,"hasVvInstancing",void 0),(0,l._)([(0,d.o)({constValue:!0})],p.prototype,"hasSliceTranslatedView",void 0),(0,l._)([(0,d.o)()],p.prototype,"objectAndLayerIdColorInstanced",void 0)}}]);
//# sourceMappingURL=66505.e454cdbb.chunk.js.map