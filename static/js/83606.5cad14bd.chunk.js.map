{"version":3,"file":"static/js/83606.5cad14bd.chunk.js","mappings":"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","sources":["../.yalc/@esri/hub-components/dist/esm/getService-49b539e3.js","../.yalc/@esri/hub-components/dist/esm/hub-download-card.entry.js","../.yalc/@esri/hub-components/dist/esm/is-guid-8127621d.js","../.yalc/@esri/hub-components/dist/esm/remove-020c0573.js","../.yalc/@esri/hub-components/dist/esm/slugs-150ad0db.js","../.yalc/@esri/hub-components/dist/esm/update-fec93fc5.js"],"sourcesContent":["import { r as request } from './request-c15cc2af.js';\nimport { c as cleanUrl } from './clean-url-be7c0879.js';\n\n/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * ```js\n * import { getService } from '@esri/arcgis-rest-feature-layer';\n * //\n * getService({\n *   url: \"https://sampleserver6.arcgisonline.com/arcgis/rest/services/ServiceRequest/FeatureServer\"\n * })\n *   .then(response) // { name: \"311\", id: 0, ... }\n * ```\n * Feature Service request. See the [REST Documentation](https://developers.arcgis.com/rest/services-reference/feature-service.htm) for more information.\n *\n * @param options - Options for the request.\n * @returns A Promise that will resolve with the getService response.\n */\nfunction getService(options) {\n    return request(cleanUrl(options.url), options);\n}\n\nexport { getService as g };\n","import { r as registerInstance, c as createEvent, h, H as Host, g as getElement } from './index-0d95d9d4.js';\nimport { c as createCommonjsModule } from './_commonjsHelpers-11ca3be1.js';\nimport { i as intlManager } from './intl-manager-821aea3b.js';\nimport { d as dist } from './index-bcc98773.js';\nimport { b as bind } from './context-7d8f7366.js';\nimport { U as UserSession } from './UserSession-d3a97494.js';\nimport { g as getProp } from './get-prop-d82e4fa6.js';\nimport { d as determineOwner, j as getItemStatus, g as getItem } from './get-f2cd18e7.js';\nimport { s as searchItems } from './search-3af9e278.js';\nimport { f as flattenArray } from './util-2150bd9e.js';\nimport { S as SearchQueryBuilder } from './generic-search-069e22da.js';\nimport { p as parseDatasetId, g as getLayer } from './slugs-150ad0db.js';\nimport { g as getService } from './getService-49b539e3.js';\nimport { g as getPortalUrl } from './get-portal-url-423a76f5.js';\nimport { r as request } from './request-c15cc2af.js';\nimport { a as createFolder } from './create-7cf3c372.js';\nimport { u as updateItem, m as moveItem } from './update-fec93fc5.js';\nimport { s as setItemAccess } from './access-c6f01a39.js';\nimport { a as removeItem } from './remove-020c0573.js';\nimport './index-4e91769f.js';\nimport './clean-url-be7c0879.js';\nimport './tslib.es6-3669ad41.js';\nimport './append-custom-params-fd9b7e72.js';\nimport './is-guid-8127621d.js';\nimport './get-859a2960.js';\n\n/**\n * ```js\n * import { getUserContent } from \"@esri/arcgis-rest-portal\";\n * //\n * getUserContent({\n *    owner: 'geemike',\n *    folderId: 'bao7',\n *    start: 1,\n *    num: 20,\n *    authentication\n * })\n * ```\n * Returns a listing of the user's content. If the `username` is not supplied, it defaults to the username of the authenticated user. If `start` is not specificed it defaults to the first page.\n * If the `num` is not supplied it is defaulted to 10. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/user-content.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise<IUserContentResponse>\n */\nvar getUserContent = function (requestOptions) {\n    var folder = requestOptions.folderId, _a = requestOptions.start, start = _a === void 0 ? 1 : _a, _b = requestOptions.num, num = _b === void 0 ? 10 : _b, authentication = requestOptions.authentication;\n    var suffix = folder ? \"/\" + folder : \"\";\n    return determineOwner(requestOptions)\n        .then(function (owner) { return getPortalUrl(requestOptions) + \"/content/users/\" + owner + suffix; })\n        .then(function (url) { return request(url, {\n        httpMethod: \"GET\",\n        authentication: authentication,\n        params: {\n            start: start,\n            num: num,\n        },\n    }); });\n};\n\n/**\n * ```js\n * import { exportItem } from \"@esri/arcgis-rest-portal\";\n * //\n * exportItem({\n *      id: '3daf',\n *      owner: 'geemike',\n *      exportFormat: 'CSV',\n *      exportParameters: {\n *        layers: [\n *          { id: 0 },\n *          { id: 1, where: 'POP1999 > 100000' }\n *        ]\n *      },\n *      authentication,\n *    })\n * ```\n * Exports an item from the portal. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/export-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise<IExportItemResponse>\n */\nvar exportItem = function (requestOptions) {\n    var authentication = requestOptions.authentication, itemId = requestOptions.id, title = requestOptions.title, exportFormat = requestOptions.exportFormat, exportParameters = requestOptions.exportParameters;\n    return determineOwner(requestOptions)\n        .then(function (owner) { return getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/export\"; })\n        .then(function (url) { return request(url, {\n        httpMethod: 'POST',\n        authentication: authentication,\n        params: {\n            itemId: itemId,\n            title: title,\n            exportFormat: exportFormat,\n            exportParameters: exportParameters\n        }\n    }); });\n};\n\n/**\n * Implementation of atob() according to the HTML and Infra specs, except that\n * instead of throwing INVALID_CHARACTER_ERR we return null.\n */\nfunction atob(data) {\n  // Web IDL requires DOMStrings to just be converted using ECMAScript\n  // ToString, which in our case amounts to using a template literal.\n  data = `${data}`;\n  // \"Remove all ASCII whitespace from data.\"\n  data = data.replace(/[ \\t\\n\\f\\r]/g, \"\");\n  // \"If data's length divides by 4 leaving no remainder, then: if data ends\n  // with one or two U+003D (=) code points, then remove them from data.\"\n  if (data.length % 4 === 0) {\n    data = data.replace(/==?$/, \"\");\n  }\n  // \"If data's length divides by 4 leaving a remainder of 1, then return\n  // failure.\"\n  //\n  // \"If data contains a code point that is not one of\n  //\n  // U+002B (+)\n  // U+002F (/)\n  // ASCII alphanumeric\n  //\n  // then return failure.\"\n  if (data.length % 4 === 1 || /[^+/0-9A-Za-z]/.test(data)) {\n    return null;\n  }\n  // \"Let output be an empty byte sequence.\"\n  let output = \"\";\n  // \"Let buffer be an empty buffer that can have bits appended to it.\"\n  //\n  // We append bits via left-shift and or.  accumulatedBits is used to track\n  // when we've gotten to 24 bits.\n  let buffer = 0;\n  let accumulatedBits = 0;\n  // \"Let position be a position variable for data, initially pointing at the\n  // start of data.\"\n  //\n  // \"While position does not point past the end of data:\"\n  for (let i = 0; i < data.length; i++) {\n    // \"Find the code point pointed to by position in the second column of\n    // Table 1: The Base 64 Alphabet of RFC 4648. Let n be the number given in\n    // the first cell of the same row.\n    //\n    // \"Append to buffer the six bits corresponding to n, most significant bit\n    // first.\"\n    //\n    // atobLookup() implements the table from RFC 4648.\n    buffer <<= 6;\n    buffer |= atobLookup(data[i]);\n    accumulatedBits += 6;\n    // \"If buffer has accumulated 24 bits, interpret them as three 8-bit\n    // big-endian numbers. Append three bytes with values equal to those\n    // numbers to output, in the same order, and then empty buffer.\"\n    if (accumulatedBits === 24) {\n      output += String.fromCharCode((buffer & 0xff0000) >> 16);\n      output += String.fromCharCode((buffer & 0xff00) >> 8);\n      output += String.fromCharCode(buffer & 0xff);\n      buffer = accumulatedBits = 0;\n    }\n    // \"Advance position by 1.\"\n  }\n  // \"If buffer is not empty, it contains either 12 or 18 bits. If it contains\n  // 12 bits, then discard the last four and interpret the remaining eight as\n  // an 8-bit big-endian number. If it contains 18 bits, then discard the last\n  // two and interpret the remaining 16 as two 8-bit big-endian numbers. Append\n  // the one or two bytes with values equal to those one or two numbers to\n  // output, in the same order.\"\n  if (accumulatedBits === 12) {\n    buffer >>= 4;\n    output += String.fromCharCode(buffer);\n  } else if (accumulatedBits === 18) {\n    buffer >>= 2;\n    output += String.fromCharCode((buffer & 0xff00) >> 8);\n    output += String.fromCharCode(buffer & 0xff);\n  }\n  // \"Return output.\"\n  return output;\n}\n/**\n * A lookup table for atob(), which converts an ASCII character to the\n * corresponding six-bit number.\n */\n\nconst keystr$1 =\n  \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n\nfunction atobLookup(chr) {\n  const index = keystr$1.indexOf(chr);\n  // Throw exception if character is not in the lookup string; should not be hit in tests\n  return index < 0 ? undefined : index;\n}\n\nvar atob_1 = atob;\n\n/**\n * btoa() as defined by the HTML and Infra specs, which mostly just references\n * RFC 4648.\n */\nfunction btoa(s) {\n  let i;\n  // String conversion as required by Web IDL.\n  s = `${s}`;\n  // \"The btoa() method must throw an \"InvalidCharacterError\" DOMException if\n  // data contains any character whose code point is greater than U+00FF.\"\n  for (i = 0; i < s.length; i++) {\n    if (s.charCodeAt(i) > 255) {\n      return null;\n    }\n  }\n  let out = \"\";\n  for (i = 0; i < s.length; i += 3) {\n    const groupsOfSix = [undefined, undefined, undefined, undefined];\n    groupsOfSix[0] = s.charCodeAt(i) >> 2;\n    groupsOfSix[1] = (s.charCodeAt(i) & 0x03) << 4;\n    if (s.length > i + 1) {\n      groupsOfSix[1] |= s.charCodeAt(i + 1) >> 4;\n      groupsOfSix[2] = (s.charCodeAt(i + 1) & 0x0f) << 2;\n    }\n    if (s.length > i + 2) {\n      groupsOfSix[2] |= s.charCodeAt(i + 2) >> 6;\n      groupsOfSix[3] = s.charCodeAt(i + 2) & 0x3f;\n    }\n    for (let j = 0; j < groupsOfSix.length; j++) {\n      if (typeof groupsOfSix[j] === \"undefined\") {\n        out += \"=\";\n      } else {\n        out += btoaLookup(groupsOfSix[j]);\n      }\n    }\n  }\n  return out;\n}\n\n/**\n * Lookup table for btoa(), which converts a six-bit number into the\n * corresponding ASCII character.\n */\nconst keystr =\n  \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n\nfunction btoaLookup(index) {\n  if (index >= 0 && index < 64) {\n    return keystr[index];\n  }\n\n  // Throw INVALID_CHARACTER_ERR exception here -- won't be hit in the tests.\n  return undefined;\n}\n\nvar btoa_1 = btoa;\n\nvar abab = {\n  atob: atob_1,\n  btoa: btoa_1\n};\n\nconst WGS84_WKID = \"4326\";\nconst PORTAL_EXPORT_TYPES = {\n    csv: {\n        name: \"CSV\",\n        itemTypes: [\"CSV\", \"CSV Collection\"],\n        supportsProjection: true,\n    },\n    kml: {\n        name: \"KML\",\n        itemTypes: [\"KML\", \"KML Collection\"],\n        supportsProjection: false,\n    },\n    shapefile: {\n        name: \"Shapefile\",\n        itemTypes: [\"Shapefile\"],\n        supportsProjection: true,\n    },\n    fileGeodatabase: {\n        name: \"File Geodatabase\",\n        itemTypes: [\"File Geodatabase\"],\n        supportsProjection: true,\n    },\n    geojson: {\n        name: \"GeoJson\",\n        itemTypes: [\"GeoJson\"],\n        supportsProjection: false,\n    },\n    excel: {\n        name: \"Excel\",\n        itemTypes: [\"Microsoft Excel\"],\n        supportsProjection: true,\n    },\n    featureCollection: {\n        name: \"Feature Collection\",\n        itemTypes: [\"Feature Collection\"],\n        supportsProjection: true,\n    },\n};\n/**\n * Puts a spatial reference into a serialized format that can be used\n * for item typeKeywords.\n *\n * **Note**: discards \"latestWkid\"\n *\n * In the past we used `JSON.stringify`, but that causes problems because\n * it can include commas which are interpreted by the portal [update item call](https://developers.arcgis.com/rest/users-groups-and-items/update-item.htm)\n * as being separate typekeywords. With `JSON.stringify`, equality was also\n * dependent on the order of the properties in the spatial reference.\n *\n * Check https://developers.arcgis.com/web-map-specification/objects/spatialReference/\n * for more details on what this object looks like.\n */\nfunction serializeSpatialReference(spatialReference) {\n    if (typeof spatialReference === \"object\") {\n        const { wkid, wkt } = spatialReference;\n        return wkid ? wkid + \"\" : abab.btoa(wkt);\n    }\n    else {\n        return spatialReference;\n    }\n}\n/**\n * spatialRefId can currently take the form of either a WKID string or a\n * serialized ISpatialReference object.\n *\n * TODO - we shouldn't need this function. Instead, spatialRefId should\n * always be consistent, maybe by using serializeSpatialReference\n *\n * @private\n */\nfunction parseSpatialRefId(spatialRefId) {\n    let _spatialRefId;\n    try {\n        _spatialRefId = JSON.parse(spatialRefId);\n    }\n    catch (_a) {\n        _spatialRefId = spatialRefId;\n    }\n    return _spatialRefId;\n}\n/**\n * Builds the Portal API query string to search for exports from a given dataset\n *\n * @param itemId - The dataset ID\n * @param options - A set of options including item types, layerId, and spatialRefId\n * @returns\n */\nfunction buildExistingExportsPortalQuery(itemId, options) {\n    const { onlyTypes, layerId, spatialRefId } = maybeExtractOptions(options);\n    const formatInfos = Object.keys(PORTAL_EXPORT_TYPES).map((key) => PORTAL_EXPORT_TYPES[key]);\n    const noProjectionItemTypes = new Set(flattenArray(formatInfos\n        .filter((info) => !info.supportsProjection)\n        .map((info) => info.itemTypes)));\n    let types;\n    if (!onlyTypes) {\n        types = flattenArray(formatInfos.map((info) => info.itemTypes));\n    }\n    else {\n        types = onlyTypes;\n    }\n    const queryBuilder = new SearchQueryBuilder()\n        .startGroup()\n        .match(getExportItemTypeKeyword(itemId))\n        .in(\"typekeywords\")\n        .and()\n        .match(getExportLayerTypeKeyword(layerId))\n        .in(\"typekeywords\")\n        .endGroup()\n        .and()\n        .startGroup();\n    buildExportTypesClause(queryBuilder, {\n        types,\n        spatialRefId,\n        noProjectionItemTypes,\n    });\n    queryBuilder.endGroup();\n    return queryBuilder.toParam();\n}\nfunction maybeExtractOptions(options) {\n    if (options) {\n        return {\n            onlyTypes: options.onlyTypes,\n            layerId: options.layerId,\n            spatialRefId: options.spatialRefId,\n        };\n    }\n    return {};\n}\nfunction buildExportTypesClause(builder, options) {\n    const { types, noProjectionItemTypes, spatialRefId } = options;\n    const getSpatialRefIdWithDefaults = (_spatialRefId, itemType) => {\n        let ret = WGS84_WKID;\n        if (_spatialRefId && !noProjectionItemTypes.has(itemType)) {\n            ret = _spatialRefId;\n        }\n        return ret;\n    };\n    const buildQueryForType = (type, _builder) => {\n        _builder\n            .startGroup()\n            .match(/\\s/g.test(type) ? type : `\"${type}\"`) // temporary logic until https://github.com/Esri/arcgis-rest-js/issues/916 is resolved\n            .in(\"type\")\n            .and()\n            .match(getSpatialRefTypeKeyword(getSpatialRefIdWithDefaults(spatialRefId, type)))\n            .in(\"typekeywords\")\n            .endGroup();\n    };\n    types.forEach((type, i) => {\n        buildQueryForType(type, builder);\n        if (i < types.length - 1) {\n            builder.or();\n        }\n    });\n}\n/**\n * Generates typekeyword for identifying which spatialRefId an export is\n * @param spatialRefId - either a WKID, WKT, or stringified ISpatialReference\n * @private\n */\nfunction getSpatialRefTypeKeyword(spatialRefId) {\n    const parsedSpatialReference = parseSpatialRefId(spatialRefId);\n    const serializedSpatialReference = serializeSpatialReference(parsedSpatialReference);\n    return `spatialRefId:${serializedSpatialReference}`;\n}\n/**\n * Returns the keyword identifying exports by the item they originate from\n * @param itemId - ID for the item from which the export originated\n * @private\n */\nfunction getExportItemTypeKeyword(itemId) {\n    return `exportItem:${itemId}`;\n}\n/**\n * Returns the keyword identifying exports by the layer they originate from\n * @param layerId - ID for the layer from which the export originated\n * @private\n */\nfunction getExportLayerTypeKeyword(layerId) {\n    // NOTE - Layer Id's need to be padded with \"0\" so that /search results are predictable. Searches for typeKeywords:\"exportLayer:1\" don't work.\n    // See https://github.com/Esri/hub.js/pull/472 for more information.\n    // TODO - use `filter` when Enterprise Sites adds support.\n    return layerId ? `exportLayer:0${layerId}` : `exportLayer:null`;\n}\n\nvar eventemitter3 = createCommonjsModule(function (module) {\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\n{\n  module.exports = EventEmitter;\n}\n});\n\n/**\n * @ignore\n */\nclass RemoteServerError extends Error {\n    constructor(message, url, status) {\n        super(message);\n        this.status = status;\n        this.url = url;\n    }\n}\n\n// TODO: next breaking change remove this\n// and use buildUrl() from @esri/hub-common instead\n/**\n * @private\n */\nfunction urlBuilder(params) {\n    const { host, route, query } = params;\n    const baseUrl = host.endsWith(\"/\") ? host : `${host}/`;\n    const url = new URL(route, baseUrl);\n    url.search = buildQueryString(query);\n    return url.toString();\n}\nfunction buildQueryString(params = {}) {\n    const queryParams = Object.keys(params)\n        .filter(key => {\n        return params[key] !== undefined;\n    })\n        .reduce((acc, key) => {\n        acc[key] = params[key];\n        return acc;\n    }, {});\n    return new URLSearchParams(queryParams).toString();\n}\n/**\n * @private\n */\nfunction composeDownloadId(params) {\n    const { datasetId, format, spatialRefId, geometry, where } = params;\n    return `${datasetId}:${format}:${spatialRefId}:${geometry}:${where}`;\n}\n\nconst HUB_FORMAT_LOOKUP = {\n    Shapefile: \"shp\",\n    CSV: \"csv\",\n    \"File Geodatabase\": \"fgdb\",\n    GeoJson: \"geojson\",\n    KML: \"kml\"\n};\n/**\n * @private\n */\nfunction convertToHubFormat(format) {\n    if (!HUB_FORMAT_LOOKUP[format]) {\n        throw new Error(`Unsupported Hub download format: ${format}`);\n    }\n    return HUB_FORMAT_LOOKUP[format];\n}\n\n/**\n * @private\n */\nfunction hubRequestDownloadMetadata(params) {\n    const { host, datasetId, spatialRefId, geometry, where } = params;\n    const queryParams = {\n        spatialRefId,\n        formats: convertToHubFormat(params.format),\n        geometry: geometry ? JSON.stringify(geometry) : undefined,\n        where\n    };\n    const url = urlBuilder({\n        host,\n        route: `/api/v3/datasets/${datasetId}/downloads`,\n        query: queryParams\n    });\n    return fetch(url)\n        .then(resp => {\n        const { ok, status, statusText } = resp;\n        if (!ok) {\n            throw new RemoteServerError(statusText, url, status);\n        }\n        return resp.json();\n    })\n        .then(json => {\n        validateApiResponse(json);\n        return formatApiResponse(json, composeDownloadId(params));\n    });\n}\nfunction validateApiResponse({ data }) {\n    if (!data) {\n        throw new Error('Unexpected API response; no \"data\" property.');\n    }\n    if (!Array.isArray(data)) {\n        throw new Error('Unexpected API response; \"data\" is not an array.');\n    }\n    if (data.length > 1) {\n        throw new Error('Unexpected API response; \"data\" contains more than one download.');\n    }\n}\nfunction formatApiResponse(json, downloadId) {\n    const { data: [metadata] } = json;\n    if (!metadata) {\n        return {\n            downloadId,\n            status: \"not_ready\"\n        };\n    }\n    const { attributes: { contentLastModified, lastModified, status, errors, contentLength, cacheTime, source: { lastEditDate } }, links: { content: downloadUrl } } = metadata;\n    return {\n        downloadId,\n        contentLastModified,\n        lastEditDate,\n        lastModified,\n        status,\n        errors: errors || [],\n        downloadUrl,\n        contentLength,\n        cacheTime\n    };\n}\n\n/* istanbul ignore next */\nclass HubPoller {\n    disablePoll() {\n        clearInterval(this.pollTimer);\n        this.pollTimer = null;\n    }\n    activatePoll(params) {\n        const { downloadId, eventEmitter, pollingInterval, existingFileDate = new Date(0).toISOString(), } = params;\n        const existingFileTimestamp = new Date(existingFileDate).getTime();\n        this.pollTimer = setInterval(() => {\n            hubRequestDownloadMetadata(params)\n                .then((metadata) => {\n                if (isReady(metadata, existingFileTimestamp)) {\n                    eventEmitter.emit(`${downloadId}ExportComplete`, {\n                        detail: { metadata },\n                    });\n                    return this.disablePoll();\n                }\n                if (exportDatasetFailed(metadata)) {\n                    const { errors: [error], } = metadata;\n                    eventEmitter.emit(`${downloadId}ExportError`, {\n                        detail: { error, metadata },\n                    });\n                    return this.disablePoll();\n                }\n            })\n                .catch((error) => {\n                eventEmitter.emit(`${downloadId}PollingError`, {\n                    detail: { error, metadata: { status: \"error\" } },\n                });\n                return this.disablePoll();\n            });\n        }, pollingInterval);\n    }\n}\n/* istanbul ignore next */\n/**\n * @private\n */\nfunction hubPollDownloadMetadata(params) {\n    const poller = new HubPoller();\n    poller.activatePoll(params);\n    return poller;\n}\n/* istanbul ignore next */\nfunction isReady(metadata, preExportFileTimestamp) {\n    const { status, lastModified } = metadata;\n    const currentFileDate = new Date(lastModified).getTime();\n    return (status === \"ready\" ||\n        (status === \"ready_unknown\" && currentFileDate > preExportFileTimestamp));\n}\n/* istanbul ignore next */\nfunction exportDatasetFailed(metadata) {\n    return (metadata &&\n        (metadata.status === \"error_updating\" ||\n            metadata.status === \"error_creating\"));\n}\n\n/**\n * @private\n */\nfunction getExportsFolderId(authentication) {\n    return getUserContent({ authentication })\n        .then((userContent) => {\n        const exportFolder = userContent.folders.find((folder) => {\n            return folder.title === \"item-exports\";\n        });\n        if (exportFolder) {\n            return { folder: exportFolder };\n        }\n        return createFolder({ authentication, title: \"item-exports\" });\n    })\n        .then((response) => {\n        const { folder } = response;\n        return folder.id;\n    });\n}\n\nvar DownloadStatus;\n(function (DownloadStatus) {\n    DownloadStatus[\"READY\"] = \"ready\";\n    DownloadStatus[\"READY_UNKNOWN\"] = \"ready_unknown\";\n    DownloadStatus[\"STALE\"] = \"stale\";\n    DownloadStatus[\"NOT_READY\"] = \"not_ready\";\n    DownloadStatus[\"LOCKED\"] = \"locked\";\n    DownloadStatus[\"STALE_LOCKED\"] = \"stale_locked\";\n    DownloadStatus[\"DISABLED\"] = \"disabled\";\n    DownloadStatus[\"CREATING\"] = \"creating\";\n    DownloadStatus[\"UPDATING\"] = \"updating\";\n    DownloadStatus[\"ERROR_CREATING\"] = \"error_creating\";\n    DownloadStatus[\"ERROR_UPDATING\"] = \"error_updating\";\n    DownloadStatus[\"ERROR\"] = \"error\";\n})(DownloadStatus || (DownloadStatus = {}));\n\n/**\n * @private\n */\nclass ExportCompletionError extends Error {\n    constructor(message) {\n        super(message);\n        Object.setPrototypeOf(this, ExportCompletionError.prototype);\n    }\n}\n\n/**\n * @private\n */\nfunction exportSuccessHandler(params) {\n    const { downloadId, datasetId, exportCreated, spatialRefId, eventEmitter, authentication, } = params;\n    const { itemId, layerId } = parseDatasetId(datasetId);\n    const typeKeywords = [\n        getExportItemTypeKeyword(itemId),\n        getExportLayerTypeKeyword(layerId),\n        `modified:${exportCreated}`,\n        getSpatialRefTypeKeyword(spatialRefId),\n    ];\n    return updateItem({\n        item: {\n            id: downloadId,\n            typekeywords: typeKeywords.join(\",\"),\n        },\n        authentication,\n    })\n        .then(() => {\n        return setItemAccess({\n            id: downloadId,\n            authentication,\n            access: \"private\",\n        });\n    })\n        .then(() => {\n        return getExportsFolderId(authentication);\n    })\n        .then((exportFolderId) => {\n        return moveItem({\n            itemId: downloadId,\n            folderId: exportFolderId,\n            authentication,\n        });\n    })\n        .catch((err) => {\n        if (err && err.code === \"CONT_0011\") {\n            // Skipping file move, already exists in target folder\n            return;\n        }\n        removeItem({\n            id: downloadId,\n            authentication,\n        });\n        throw new ExportCompletionError(err.message);\n    })\n        .then(() => {\n        return eventEmitter.emit(`${downloadId}ExportComplete`, {\n            detail: {\n                metadata: {\n                    downloadId,\n                    status: DownloadStatus.READY,\n                    lastModified: new Date().toISOString(),\n                    downloadUrl: urlBuilder({\n                        host: authentication.portal,\n                        route: `content/items/${downloadId}/data`,\n                        query: { token: authentication.token },\n                    }),\n                },\n            },\n        });\n    });\n}\n\nclass PortalPoller {\n    disablePoll() {\n        clearInterval(this.pollTimer);\n        this.pollTimer = null;\n    }\n    activatePoll(params) {\n        const { downloadId, datasetId, format, spatialRefId, jobId, authentication, exportCreated, eventEmitter, pollingInterval } = params;\n        this.pollTimer = setInterval(() => {\n            getItemStatus({\n                id: downloadId,\n                jobId,\n                jobType: \"export\",\n                authentication\n            })\n                .then((metadata) => {\n                if (metadata.status === \"completed\") {\n                    return exportSuccessHandler({\n                        datasetId,\n                        format,\n                        authentication,\n                        downloadId,\n                        spatialRefId,\n                        exportCreated,\n                        eventEmitter\n                    }).then(() => {\n                        this.disablePoll();\n                    });\n                }\n                if (metadata.status === \"failed\") {\n                    eventEmitter.emit(`${downloadId}ExportError`, {\n                        detail: {\n                            error: new Error(metadata.statusMessage),\n                            metadata: {\n                                status: DownloadStatus.ERROR,\n                                errors: [new Error(metadata.statusMessage)]\n                            }\n                        }\n                    });\n                    return this.disablePoll();\n                }\n            })\n                .catch((error) => {\n                if (error instanceof ExportCompletionError) {\n                    eventEmitter.emit(`${downloadId}ExportError`, {\n                        detail: {\n                            error,\n                            metadata: {\n                                status: DownloadStatus.ERROR,\n                                errors: [error]\n                            }\n                        }\n                    });\n                }\n                else {\n                    eventEmitter.emit(`${downloadId}PollingError`, {\n                        detail: {\n                            error,\n                            metadata: {\n                                status: DownloadStatus.ERROR,\n                                errors: [error]\n                            }\n                        }\n                    });\n                }\n                return this.disablePoll();\n            });\n        }, pollingInterval);\n    }\n}\n/**\n * @private\n */\nfunction portalPollExportJobStatus(params) {\n    const poller = new PortalPoller();\n    poller.activatePoll(params);\n    return poller;\n}\n\n/**\n *\n * Poll the status of a download job / portal export. Emit event when completed\n * (with download link) or failed (with error)\n * @param params - parameters defining a dataset export job\n */\nfunction pollDownloadMetadata(params) {\n    const { target, downloadId, datasetId, jobId, format, authentication, exportCreated, eventEmitter, pollingInterval, spatialRefId, geometry, where, host, existingFileDate } = params;\n    if (!target || target === \"hub\") {\n        return hubPollDownloadMetadata({\n            host,\n            downloadId,\n            datasetId,\n            format,\n            eventEmitter,\n            pollingInterval,\n            spatialRefId,\n            geometry,\n            where,\n            existingFileDate\n        });\n    }\n    return portalPollExportJobStatus({\n        downloadId,\n        datasetId,\n        jobId,\n        authentication,\n        exportCreated,\n        format,\n        spatialRefId,\n        eventEmitter,\n        pollingInterval,\n        geometry,\n        where\n    });\n}\n\n/**\n * @private\n */\nfunction hubRequestDatasetExport(params) {\n    const { host, datasetId, spatialRefId, geometry, where } = params;\n    const body = {\n        spatialRefId,\n        format: convertToHubFormat(params.format),\n        geometry,\n        where\n    };\n    // TODO: add @esri/hub-common as a peer dependency  next breaking change\n    // and use buildUrl() for the following:\n    const url = urlBuilder({\n        host,\n        route: `/api/v3/datasets/${datasetId}/downloads`\n    });\n    // TODO: add @esri/hub-common as a peer dependency  next breaking change\n    // and use hubRequest() for the following:\n    return fetch(url, {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(body)\n    })\n        .then(resp => {\n        const { ok, status, statusText } = resp;\n        if (!ok) {\n            throw new RemoteServerError(statusText, url, status);\n        }\n        return undefined;\n    })\n        .then(() => {\n        return { downloadId: composeDownloadId(params) };\n    });\n}\n\n/**\n * @private\n */\nfunction portalRequestDatasetExport(params) {\n    const { datasetId, title, format, authentication } = params;\n    // TODO: parseItemId()\n    const [itemId] = datasetId.split(\"_\");\n    return exportItem({\n        id: itemId,\n        exportFormat: format,\n        exportParameters: composeExportParameters(params),\n        title,\n        authentication\n    }).then((resp) => {\n        const { size, jobId, exportItemId } = resp;\n        return {\n            downloadId: exportItemId,\n            jobId,\n            size,\n            exportCreated: Date.now()\n        };\n    });\n}\nfunction composeExportParameters(params) {\n    const { datasetId, spatialRefId, where } = params;\n    // TODO: move parseDatasetId() to hub-common and use that here\n    const layerId = datasetId.split(\"_\")[1];\n    if (!layerId) {\n        return spatialRefId ? { targetSR: { wkid: Number(spatialRefId) } } : {};\n    }\n    const layers = [{ id: Number(layerId), where }];\n    return spatialRefId\n        ? {\n            layers,\n            targetSR: {\n                wkid: Number(spatialRefId)\n            }\n        }\n        : { layers };\n}\n\n/**\n * ```js\n * import { requestDatasetExport } from \"@esri/hub-downloads\";\n *\n * Request an export of a dataset to a particular file format.\n * @param params - parameters defining a dataset export job\n */\nfunction requestDatasetExport(params) {\n    const { host, datasetId, format, spatialRefId, geometry, where, title, target, authentication } = params;\n    if (!target || target === \"hub\") {\n        return hubRequestDatasetExport({\n            host,\n            datasetId,\n            format,\n            spatialRefId,\n            geometry,\n            where\n        });\n    }\n    return portalRequestDatasetExport({\n        datasetId,\n        format,\n        title,\n        authentication,\n        spatialRefId,\n        where\n    });\n}\n\nvar DownloadFormats;\n(function (DownloadFormats) {\n    DownloadFormats[\"Shapefile\"] = \"Shapefile\";\n    DownloadFormats[\"CSV\"] = \"CSV\";\n    DownloadFormats[\"KML\"] = \"KML\";\n    DownloadFormats[\"GeoJson\"] = \"GeoJson\";\n    DownloadFormats[\"Excel\"] = \"Excel\";\n    DownloadFormats[\"File Geodatabase\"] = \"File Geodatabase\";\n    DownloadFormats[\"Feature Collection\"] = \"Feature Collection\";\n    DownloadFormats[\"Scene Package\"] = \"Scene Package\";\n})(DownloadFormats || (DownloadFormats = {}));\n\nconst DOWNLOADS_LOCK_MS = 10 * 60 * 1000;\n/**\n * @private\n */\nfunction isRecentlyUpdated(target, lastEditDate) {\n    return (target === \"portal\" &&\n        lastEditDate &&\n        new Date().getTime() - lastEditDate <= DOWNLOADS_LOCK_MS);\n}\n/**\n * @private\n */\nfunction isDownloadEnabled(item, format) {\n    const lowercasedFormat = format ? format.toLowerCase() : \"\";\n    const isItemLevelDownloadEnabled = getProp(item, \"properties.downloadsConfig.enabled\") !== false;\n    const formats = getProp(item, \"properties.downloadsConfig.formats\") || {};\n    const isFormatDownloadEnabled = !formats[lowercasedFormat] || formats[lowercasedFormat].enabled !== false;\n    return isItemLevelDownloadEnabled ? isFormatDownloadEnabled : false;\n}\n\nvar ItemTypes;\n(function (ItemTypes) {\n    ItemTypes[\"FeatureService\"] = \"Feature Service\";\n    ItemTypes[\"MapService\"] = \"Map Service\";\n})(ItemTypes || (ItemTypes = {}));\nconst isCollectionType = (format) => format === DownloadFormats.CSV || format === DownloadFormats.KML;\n/**\n * @private\n */\nfunction portalRequestDownloadMetadata(params) {\n    const { datasetId, authentication, format, spatialRefId, target, portal } = params;\n    const { itemId, layerId } = parseDatasetId(datasetId);\n    let serviceLastEditDate;\n    let itemModifiedDate;\n    let itemType;\n    let fetchedItem;\n    return getItem(itemId, { authentication, portal })\n        .then((item) => {\n        const { type, modified, url } = item;\n        fetchedItem = item;\n        itemModifiedDate = modified;\n        itemType = type;\n        return fetchCacheSearchMetadata({\n            url,\n            authentication,\n            type,\n            modified,\n            format,\n            layerId,\n            portal,\n        });\n    })\n        .then((metadata) => {\n        const { modified, format: searchFormat } = metadata;\n        serviceLastEditDate = modified;\n        return searchItems({\n            q: buildExistingExportsPortalQuery(itemId, {\n                layerId,\n                onlyTypes: [searchFormat],\n                spatialRefId,\n            }),\n            num: 1,\n            sortField: \"modified\",\n            sortOrder: \"DESC\",\n            authentication,\n            portal,\n        });\n    })\n        .then((searchResponse) => {\n        return formatDownloadMetadata({\n            cachedDownload: searchResponse.results[0],\n            datasetId,\n            format,\n            spatialRefId,\n            serviceLastEditDate,\n            itemModifiedDate,\n            itemType,\n            authentication,\n            target,\n            item: fetchedItem,\n            portal,\n        });\n    })\n        .catch((err) => {\n        throw err;\n    });\n}\nfunction fetchCacheSearchMetadata(params) {\n    const { format, layerId, url, type, modified, authentication, portal } = params;\n    if (type !== ItemTypes.FeatureService && type !== ItemTypes.MapService) {\n        return Promise.resolve({\n            modified,\n            format,\n        });\n    }\n    return retryWithoutAuthOnFail(getService({ url, authentication, portal }))\n        .then((response) => {\n        const layers = response.layers || [];\n        const promises = layers.map((layer) => {\n            return retryWithoutAuthOnFail(getLayer({ url: `${url}/${layer.id}`, authentication, portal }));\n        });\n        return Promise.all(promises);\n    })\n        .then((layers) => {\n        return {\n            format: getPortalFormat({ format, layerId, layers }),\n            modified: extractLastEditDate(layers),\n        };\n    });\n}\nfunction getPortalFormat(params) {\n    const { format, layerId, layers } = params;\n    const multilayer = isMultilayerRequest(layerId, layers);\n    return multilayer && isCollectionType(format)\n        ? `${format} Collection`\n        : format;\n}\nfunction isMultilayerRequest(layerId, layers) {\n    return layerId === undefined && layers.length > 1;\n}\nfunction extractLastEditDate(layers) {\n    const result = layers\n        .map((layer) => {\n        const { editingInfo: { lastEditDate } = {} } = layer;\n        return lastEditDate;\n    })\n        .filter((timestamp) => {\n        return timestamp !== undefined;\n    })\n        .sort((a, b) => {\n        return b - a;\n    });\n    return result[0];\n}\nfunction formatDownloadMetadata(params) {\n    const { cachedDownload, serviceLastEditDate, authentication, target, item, format, portal, } = params;\n    const lastEditDate = serviceLastEditDate === undefined\n        ? undefined\n        : new Date(serviceLastEditDate).toISOString();\n    const { created, id } = cachedDownload || {};\n    const recentlyUpdated = isRecentlyUpdated(target, serviceLastEditDate);\n    const canDownload = isDownloadEnabled(item, format);\n    const status = canDownload\n        ? determineStatus(serviceLastEditDate, created, recentlyUpdated)\n        : DownloadStatus.DISABLED;\n    if (!cachedDownload) {\n        return {\n            downloadId: composeDownloadId(params),\n            status,\n            lastEditDate,\n        };\n    }\n    return {\n        downloadId: id,\n        status,\n        lastEditDate,\n        contentLastModified: new Date(created).toISOString(),\n        lastModified: new Date(created).toISOString(),\n        downloadUrl: urlBuilder({\n            host: portal || authentication.portal,\n            route: `content/items/${id}/data`,\n            query: { token: authentication === null || authentication === void 0 ? void 0 : authentication.token },\n        }),\n    };\n}\nfunction determineStatus(serviceLastEditDate, exportCreatedDate, recentlyUpdated) {\n    if (!exportCreatedDate) {\n        return recentlyUpdated ? DownloadStatus.LOCKED : DownloadStatus.NOT_READY;\n    }\n    if (!serviceLastEditDate) {\n        return DownloadStatus.READY_UNKNOWN;\n    }\n    if (serviceLastEditDate > exportCreatedDate) {\n        return recentlyUpdated ? DownloadStatus.STALE_LOCKED : DownloadStatus.STALE;\n    }\n    return DownloadStatus.READY;\n}\n/**\n * Takes a request promise and retries the request without authentication\n * if it fails.\n *\n * TODO - consider incorporating this into rest-js. Discussion at https://github.com/Esri/arcgis-rest-js/issues/920\n *\n * @param requestPromise\n * @private\n */\nfunction retryWithoutAuthOnFail(requestPromise) {\n    return requestPromise.catch((error) => {\n        if (error.name === \"ArcGISAuthError\") {\n            // try again with no auth\n            return error.retry(() => Promise.resolve(null), 1);\n        }\n        else {\n            throw error;\n        }\n    });\n}\n\n/**\n * ```js\n * import { requestDownloadMetadata } from \"@esri/hub-downloads\";\n * const params = {\n *   host: 'https://opendata.arcgis.com,\n *   datasetId: 'abcdef0123456789abcdef0123456789_0',\n *   format: 'CSV',\n *   target: 'hub'\n * };\n * requestDownloadMetadata(params)\n *   .then(response => {\n *     // {\n *     //   downloadId: 'abcdef0123456789abcdef0123456789_0::csv',\n *     //   contentLastModified: '2020-06-17T01:16:01.933Z',\n *     //   lastEditDate: '2020-06-18T01:17:31.492Z',\n *     //   lastModified: '2020-06-17T13:04:28.000Z',\n *     //   status: 'stale',\n *     //   downloadUrl: 'https://dev-hub-indexer.s3.amazonaws.com/files/dd4580c810204019a7b8eb3e0b329dd6/0/full/4326/dd4580c810204019a7b8eb3e0b329dd6_0_full_4326.csv',\n *     //   contentLength: 1391454,\n *     //   cacheTime: 13121\n *     // }\n *   });\n * ```\n * Fetch metadata for a Hub download.\n * @param {IDownloadMetadataRequestParams} params\n * @returns {Promise<ISearchResult>}\n */\nfunction requestDownloadMetadata(params) {\n    const { host, datasetId, spatialRefId, format, geometry, where, target, authentication, } = params;\n    if (!target || target === \"hub\") {\n        return hubRequestDownloadMetadata({\n            host,\n            datasetId,\n            format,\n            spatialRefId,\n            geometry,\n            where,\n        });\n    }\n    return portalRequestDownloadMetadata({\n        portal: `${host}/sharing/rest`,\n        datasetId,\n        format,\n        authentication,\n        spatialRefId,\n        target,\n    });\n}\n\nfunction calculateSize(contentLength) {\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n  const bytes = contentLength;\n  if (bytes === 0) {\n    return 'n/a';\n  }\n  const i = Math.floor(Math.log(bytes) / Math.log(1024));\n  if (i === 0) {\n    return [bytes, sizes[i]];\n  }\n  return [(bytes / (1024 ** i)).toFixed(1), sizes[i]];\n}\n\nconst hubDownloadCardCss = \":host{font-size:1em}calcite-card div{font-size:1em}h3{font-size:1.25em}dl{font-size:inherit}dt,dd,calcite-dropdown-item{font-size:0.875em}dt{float:left;clear:left;margin-right:0.25rem}dt.ltr::after{content:':'}dd.rtl::after{content:':'}dd{margin:0px;padding:0px;margin-left:110px;-webkit-margin-start:0;margin-inline-start:0}a{vertical-align:middle}calcite-icon{margin-left:0.25rem}a:visited{color:inherit}calcite-dropdown{width:100%;--calcite-dropdown-width:100%;position:relative}calcite-dropdown-item span{color:#323232}calcite-button{width:100%}calcite-card div{width:100%}div[slot=\\\"footer-leading\\\"]{display:block}\";\n\nconst POLLING_INTERVAL = 5000;\nconst dateFormatOptions = { year: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric', hour12: false };\nfunction userCanExport(target, username) {\n  // TODO - if the user is authenticated, this function should verify the user's export privs\n  return (target === 'hub' || !!username);\n}\nconst HubDownloadCard = class {\n  constructor(hostRef) {\n    registerInstance(this, hostRef);\n    this.hubTelemetry = createEvent(this, \"hubTelemetry\", 7);\n    this.hubDownloadCardSuccess = createEvent(this, \"hubDownloadCardSuccess\", 7);\n    this.exportRequested = false;\n    this.contentLengthString = null;\n    this.poller = null;\n    /**\n     * API target for download requests. Public/Opendata downloads target `hub` (default), private downloads target 'portal', and Enterprise downloads target `enterprise`.\n     */\n    this.target = 'hub';\n    /**\n     * The well-known identifier of the coordinate system for the download data. Optional. For Hub API downloads, it must be either 4326 or the dataset's native coordinate system.\n     */\n    this.spatialRefId = '4326';\n    bind(this, 'exportDatasetComplete', 'exportDatasetError', 'exportPollingError', 'download', 'downloadKeyDown', 'exportDataset', 'exportDatasetKeyDown');\n  }\n  async componentWillLoad() {\n    this.resetUndefinedProps();\n    await this.setLocalization();\n    this.setAuthentication();\n    await this.fetchMetadataAndSetState();\n    this.setTranslations();\n  }\n  buildDownloadTelemetry({ isSuccess = true, isCached = true } = {}) {\n    return Object.assign(Object.assign({}, isCached ? dist.dictionary.category.interaction.action.download.details.cache : dist.dictionary.category.interaction.action.download.details.export), { label: this.format, response: isSuccess ? dist.constants.response.SUCCESS : dist.constants.response.FAILURE });\n  }\n  resetUndefinedProps() {\n    // Storybook knobs will set some of these to \"undefined\"\n    ['spatialRefId', 'where', 'geometry', 'filename', 'target'].forEach(prop => {\n      this[prop] = this[prop] === 'undefined' ? undefined : this[prop];\n    });\n    if (!this.spatialRefId) {\n      this.spatialRefId = '4326';\n    }\n  }\n  async setLocalization() {\n    this.intl = await intlManager.loadIntlForComponent(this.element);\n    // TODO: replace this w/ this.intl.formatDate()\n    this.dateTimeFormatter = new Intl.DateTimeFormat(this.intl.locale, dateFormatOptions);\n    // NOTE: ordinarily we'd just use this.intl.t() inline\n    // but this component was already built around a hash of labels\n    this.setLabels();\n  }\n  setLabels() {\n    const labelKeys = ['buttonDownload', 'fileCreated', 'fileSize', 'buttonOptions', 'menuRequest'];\n    this.labels = labelKeys.reduce((accum, key) => {\n      accum[key] = this.intl.t(key);\n      return accum;\n    }, {});\n  }\n  setAuthentication() {\n    if (this.username && this.token) {\n      this.authentication = new UserSession({\n        username: this.username,\n        portal: `${this.host}/sharing/rest`,\n        token: this.token,\n      });\n      this.authentication.getToken = () => new Promise((resolve) => {\n        resolve(this.token);\n      });\n    }\n  }\n  setTranslations() {\n    this.setContentLengthString();\n  }\n  setContentLengthString() {\n    const { metadata: { contentLength } = {} } = this;\n    if (contentLength) {\n      const fileSize = calculateSize(contentLength);\n      this.contentLengthString = typeof fileSize === 'string'\n        ? this.intl.t(fileSize.toLowerCase()) // 'n/a'\n        : `${fileSize[0]} ${this.intl.t(fileSize[1].toLowerCase())}`;\n    }\n  }\n  async watchHandler() {\n    this.resetUndefinedProps();\n    await this.fetchMetadataAndSetState();\n  }\n  async disconnectedCallback() {\n    this.resetUndefinedProps();\n    if (this.poller) {\n      this.poller.disablePoll();\n    }\n  }\n  async fetchMetadataAndSetState() {\n    if (this.poller) {\n      this.poller.disablePoll();\n    }\n    const params = this.getServiceParams();\n    try {\n      this.metadata = await requestDownloadMetadata(params);\n      this.pollingEvent = new eventemitter3();\n      if (this.exportInProgress()) {\n        this.poll();\n      }\n    }\n    catch (error) {\n      this.apiError = error;\n    }\n  }\n  getServiceParams() {\n    const params = {\n      host: this.host,\n      datasetId: this.datasetId,\n      format: this.format,\n      target: this.target,\n      authentication: this.authentication,\n      spatialRefId: this.spatialRefId,\n    };\n    if (this.where) {\n      params['where'] = this.where;\n    }\n    if (this.geometry) {\n      params['geometry'] = this.geometry;\n    }\n    return params;\n  }\n  poll() {\n    const params = this.getServiceParams();\n    this.pollingEvent.on(`${this.metadata.downloadId}ExportComplete`, this.exportDatasetComplete);\n    this.pollingEvent.on(`${this.metadata.downloadId}ExportError`, this.exportDatasetError);\n    this.pollingEvent.on(`${this.metadata.downloadId}PollingError`, this.exportPollingError);\n    this.poller = pollDownloadMetadata(Object.assign(Object.assign({}, params), { downloadId: this.metadata.downloadId, jobId: this.metadata.jobId, exportCreated: this.metadata.exportCreated, eventEmitter: this.pollingEvent, pollingInterval: POLLING_INTERVAL, existingFileDate: (new Date(this.metadata.lastModified || 0)).toISOString() }));\n  }\n  async download() {\n    if (this.metadata && this.metadata.downloadUrl) {\n      try {\n        const file = this.transferFile(this.metadata.downloadUrl);\n        this.hubTelemetry.emit(this.buildDownloadTelemetry());\n        this.hubDownloadCardSuccess.emit();\n        return file;\n      }\n      catch (error) {\n        this.hubTelemetry.emit(this.buildDownloadTelemetry({ isSuccess: false }));\n        throw error;\n      }\n    }\n    // In certain file states, the \"Download\" button actually triggers an export\n    return await this.exportDataset();\n  }\n  transferFile(url) {\n    if (this.format === 'Feature Collection') {\n      return window.open(url);\n    }\n    return window.location.href = url;\n  }\n  async exportDataset() {\n    this.exportRequested = true;\n    this.metadata.status = this.downloadCached() ? 'updating' : 'creating';\n    const params = Object.assign({ title: this.filename }, this.getServiceParams());\n    try {\n      const result = await requestDatasetExport(params);\n      this.metadata = Object.assign(Object.assign({}, this.metadata), result);\n      this.poll();\n    }\n    catch (error) {\n      this.apiError = error;\n      this.metadata.status = 'error';\n      this.metadata.errors = [error];\n    }\n  }\n  exportDatasetComplete(event) {\n    this.exportDatasetHandler(event);\n    this.hubTelemetry.emit(this.buildDownloadTelemetry({ isCached: false }));\n    this.hubDownloadCardSuccess.emit();\n    if (this.exportRequested) {\n      const { downloadUrl } = this.metadata;\n      if (downloadUrl) {\n        return this.transferFile(downloadUrl);\n      }\n    }\n  }\n  exportDatasetError(event) {\n    this.exportDatasetHandler(event);\n    this.hubTelemetry.emit(this.buildDownloadTelemetry({ isSuccess: false, isCached: false }));\n  }\n  exportPollingError(event) {\n    this.apiError = event.detail.error;\n    this.exportDatasetHandler(event);\n    this.hubTelemetry.emit(this.buildDownloadTelemetry({ isSuccess: false, isCached: false }));\n  }\n  exportDatasetHandler(event) {\n    this.metadata = Object.assign(Object.assign({}, this.metadata), event.detail.metadata);\n    this.pollingEvent.off(`${this.metadata.downloadId}ExportComplete`, this.exportDatasetComplete);\n    this.pollingEvent.off(`${this.metadata.downloadId}ExportError`, this.exportDatasetError);\n    this.pollingEvent.off(`${this.metadata.downloadId}PollingError`, this.exportDatasetError);\n  }\n  renderNotice() {\n    const { metadata, apiError, exportRequested } = this;\n    const { status } = metadata || {};\n    // TEMPORARY - Overwrite lock logic that remains in Hub.js for private downloads\n    let modifiedStatus = status;\n    if (status === 'locked') {\n      modifiedStatus = 'not_ready';\n    }\n    else if (status === 'stale_locked') {\n      modifiedStatus = 'stale';\n    }\n    const error = apiError ? apiError.status || apiError.message : undefined;\n    return h(\"hub-download-notice\", { \"api-error\": error, \"cannot-export\": !userCanExport(this.target, this.username), \"export-requested\": exportRequested, \"file-status\": modifiedStatus });\n  }\n  exportInProgress() {\n    const { metadata: { status } = {} } = this;\n    return status === 'creating' || status === 'updating';\n  }\n  downloadCached() {\n    const { metadata: { status } = {} } = this;\n    return ['ready', 'ready_unknown', 'stale', 'stale_locked', 'updating', 'error_updating'].includes(status);\n  }\n  downloadUpToDate() {\n    return this.metadata && this.metadata.status === 'ready';\n  }\n  isFormatDownloadDisabled() {\n    return this.metadata && this.metadata.status === 'disabled';\n  }\n  renderFileDescription() {\n    const fileDescription = [];\n    const { metadata: { lastModified } = {} } = this;\n    if (!this.downloadCached()) {\n      return null;\n    }\n    if (lastModified) {\n      if (this.intl.direction === 'rtl') {\n        fileDescription.push(h(\"dt\", null, this.dateTimeFormatter.format(new Date(lastModified))), h(\"dd\", { class: \"rtl\" }, this.labels.fileCreated));\n      }\n      else {\n        fileDescription.push(h(\"dt\", { class: \"ltr\" }, this.labels.fileCreated), h(\"dd\", null, this.dateTimeFormatter.format(new Date(lastModified))));\n      }\n    }\n    if (this.contentLengthString) {\n      if (this.intl.direction === 'rtl') {\n        fileDescription.push(h(\"dt\", null, this.contentLengthString), h(\"dd\", { class: \"rtl\" }, this.labels.fileSize));\n      }\n      else {\n        fileDescription.push(h(\"dt\", { class: \"ltr\" }, this.labels.fileSize), h(\"dd\", null, this.contentLengthString));\n      }\n    }\n    return fileDescription;\n  }\n  // needed for accessibility\n  exportDatasetKeyDown(event) {\n    if (['Enter', ' '].includes(event.key)) {\n      this.exportDataset();\n    }\n  }\n  // needed for acessibility\n  downloadKeyDown(event) {\n    if (['Enter', ' '].includes(event.key)) {\n      this.download();\n    }\n  }\n  renderDownloadControl() {\n    if (this.shouldUseDownloadButton()) {\n      return h(\"calcite-button\", { appearance: \"solid\", color: \"blue\", disabled: this.shouldDisableDownload(), \"icon-position\": \"start\", onClick: this.download, scale: \"m\", width: \"full\" }, this.labels.buttonDownload);\n    }\n    return (h(\"calcite-dropdown\", { placement: \"top\", scale: \"m\", type: \"click\" }, h(\"calcite-button\", { appearance: \"solid\", color: \"blue\", \"icon-end\": \"caretUp\", scale: \"m\", slot: \"dropdown-trigger\" }, this.labels.buttonOptions), h(\"calcite-dropdown-group\", { \"selection-mode\": \"none\" }, h(\"calcite-dropdown-item\", { hidden: this.exportInProgress(), onClick: this.exportDataset, onKeyDown: this.exportDatasetKeyDown, role: \"menuitem\", \"selection-mode\": \"none\", tabindex: \"0\" }, h(\"span\", null, this.labels.menuRequest)), h(\"calcite-dropdown-item\", { onClick: this.download, onKeyDown: this.downloadKeyDown, role: \"menuitem\", \"selection-mode\": \"none\", tabindex: \"0\" }, h(\"span\", null, this.intl.t('menuDownload', { createdDate: this.dateTimeFormatter.format(new Date(this.metadata.lastModified)) }))))));\n  }\n  shouldUseDownloadButton() {\n    return this.downloadUpToDate()\n      || !this.downloadCached()\n      || this.isFormatDownloadDisabled()\n      || !userCanExport(this.target, this.username);\n  }\n  shouldDisableDownload() {\n    return this.isFormatDownloadDisabled() || (this.exportInProgress() && !this.downloadCached());\n  }\n  render() {\n    return (h(Host, { \"data-element\": \"download-card\" }, h(\"calcite-card\", { dir: this.intl.direction }, h(\"h3\", { slot: \"title\" }, this.name), h(\"dl\", { slot: \"subtitle\" }, this.renderFileDescription()), h(\"div\", { slot: \"footer-leading\" }, this.renderNotice(), this.renderDownloadControl()))));\n  }\n  static get assetsDirs() { return [\"locales\"]; }\n  get element() { return getElement(this); }\n  static get watchers() { return {\n    \"host\": [\"watchHandler\"],\n    \"datasetId\": [\"watchHandler\"],\n    \"format\": [\"watchHandler\"],\n    \"spatialRefId\": [\"watchHandler\"],\n    \"where\": [\"watchHandler\"],\n    \"geometry\": [\"watchHandler\"],\n    \"target\": [\"watchHandler\"],\n    \"username\": [\"watchHandler\"],\n    \"token\": [\"watchHandler\"]\n  }; }\n};\nHubDownloadCard.style = hubDownloadCardCss;\n\nexport { HubDownloadCard as hub_download_card };\n","/**\n * Is a String a GUID?\n * @param {string} stringToTest string to check if it's a GUID\n */\nfunction isGuid(stringToTest) {\n    // strip curlies if sent...\n    if (stringToTest[0] === \"{\") {\n        stringToTest = stringToTest.substring(1, stringToTest.length - 1);\n    }\n    // ughh... seems legit\n    const regexGuid = /^(\\{){0,1}[0-9a-fA-F]{8}[-]?[0-9a-fA-F]{4}[-]?[0-9a-fA-F]{4}[-]?[0-9a-fA-F]{4}[-]?[0-9a-fA-F]{12}(\\}){0,1}$/gi;\n    // test\n    return regexGuid.test(stringToTest);\n}\n\nexport { isGuid as i };\n","import { _ as __assign } from './tslib.es6-3669ad41.js';\nimport { g as getPortalUrl } from './get-portal-url-423a76f5.js';\nimport { d as determineOwner } from './get-f2cd18e7.js';\nimport { r as request } from './request-c15cc2af.js';\n\n/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * ```js\n * import { removeItem } from \"@esri/arcgis-rest-portal\";\n * //\n * removeItem({\n *   id: \"3ef\",\n *   authentication\n * })\n * ```\n * Delete an item from the portal. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/delete-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that deletes an item.\n */\nfunction removeItem(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/delete\";\n        return request(url, requestOptions);\n    });\n}\n/**\n * Remove a resource associated with an item\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that deletes an item resource.\n */\nfunction removeItemResource(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/removeResources\";\n        // mix in user supplied params\n        requestOptions.params = __assign(__assign({}, requestOptions.params), { resource: requestOptions.resource });\n        // only override the deleteAll param specified previously if it is passed explicitly\n        if (typeof requestOptions.deleteAll !== \"undefined\") {\n            requestOptions.params.deleteAll = requestOptions.deleteAll;\n        }\n        return request(url, requestOptions);\n    });\n}\n\nexport { removeItem as a, removeItemResource as r };\n","import { r as request } from './request-c15cc2af.js';\nimport { c as cleanUrl } from './clean-url-be7c0879.js';\nimport { i as isGuid } from './is-guid-8127621d.js';\n\n/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * ```js\n * import { getLayer } from '@esri/arcgis-rest-feature-layer';\n * //\n * getLayer({\n *   url: \"https://sampleserver6.arcgisonline.com/arcgis/rest/services/ServiceRequest/FeatureServer/0\"\n * })\n *   .then(response) // { name: \"311\", id: 0, ... }\n * ```\n * Layer (Feature Service) request. See the [REST Documentation](https://developers.arcgis.com/rest/services-reference/layer-feature-service-.htm) for more information.\n *\n * @param options - Options for the request.\n * @returns A Promise that will resolve with the addFeatures response.\n */\nfunction getLayer(options) {\n    return request(cleanUrl(options.url), options);\n}\n\n//////////////////////\n// Slug Helpers\n//////////////////////\n/**\n * Parse item ID and layer ID (if any) from dataset record ID\n *\n * @param datasetId Hub API dataset record id ({itemId}_{layerId} or {itemId})\n * @returns A hash with the `itemId` and `layerId` (if any)\n */\nfunction parseDatasetId(datasetId) {\n    const [itemId, layerId] = datasetId ? datasetId.split(\"_\") : [];\n    return { itemId, layerId };\n}\n/**\n * Determine if an identifier is a Hub API slug\n *\n * @param identifier Hub API slug ({orgKey}::{title-as-slug} or {title-as-slug})\n * or record id ((itemId}_{layerId} or {itemId})\n * @returns true if the identifier is valid _and_ is **not** a record id\n */\nfunction isSlug(identifier) {\n    const { itemId } = parseDatasetId(identifier);\n    if (!itemId || isGuid(itemId)) {\n        // it's either invalid, or an item id, or a dataset id\n        return false;\n    }\n    // otherwise assume it's a slug\n    return true;\n}\n/**\n * Add a context (prefix) to slug if it doesn't already have one\n *\n * @param slug Hub API slug (with or without context)\n * @param context usually a portal's orgKey\n * @returns slug with context ({context}::{slug})\n */\nfunction addContextToSlug(slug, context) {\n    // the slug has an org key already e.g. dc::crime-incidents\n    if (/.+::.+/.test(slug)) {\n        return slug;\n        // the slug belongs to the org that owns the site e.g. crime-incidents\n    }\n    else {\n        return `${context}::${slug}`;\n    }\n}\n\nexport { addContextToSlug as a, getLayer as g, isSlug as i, parseDatasetId as p };\n","import { _ as __assign } from './tslib.es6-3669ad41.js';\nimport { g as getPortalUrl } from './get-portal-url-423a76f5.js';\nimport { d as determineOwner, s as serializeItem, i as isBBox, b as bboxToString } from './get-f2cd18e7.js';\nimport { r as request } from './request-c15cc2af.js';\n\n/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * ```js\n * import { updateItem } from \"@esri/arcgis-rest-portal\";\n * //\n * updateItem({\n *   item: {\n *     id: \"3ef\",\n *     description: \"A three hour tour\"\n *   },\n *   authentication\n * })\n *   .then(response)\n * ```\n * Update an Item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-item.htm) for more information.\n *\n * @param requestOptions - Options for the request.\n * @returns A Promise that updates an item.\n */\nfunction updateItem(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = requestOptions.folderId\n            ? getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/\" + requestOptions.folderId + \"/items/\" + requestOptions.item.id + \"/update\"\n            : getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.item.id + \"/update\";\n        // serialize the item into something Portal will accept\n        requestOptions.params = __assign(__assign({}, requestOptions.params), serializeItem(requestOptions.item));\n        // convert extent, if present, into a string from bbox\n        // processParams was previously doing this sort of work,\n        // however now we need to let array of arrays through\n        // Thus for extents we need to move this logic here\n        if (requestOptions.params.extent && isBBox(requestOptions.params.extent)) {\n            requestOptions.params.extent = bboxToString(requestOptions.params.extent);\n        }\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```js\n * import { updateItemResource } from \"@esri/arcgis-rest-portal\";\n * //\n * updateItemResource({\n *   id: '3ef',\n *   resource: file,\n *   name: 'bigkahuna.jpg',\n *   authentication\n * })\n *   .then(response)\n * ```\n * Update a resource associated with an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-resources.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that updates an item resource.\n */\nfunction updateItemResource(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/updateResources\";\n        // mix in user supplied params\n        requestOptions.params = __assign({ file: requestOptions.resource, fileName: requestOptions.name, resourcesPrefix: requestOptions.prefix, text: requestOptions.content }, requestOptions.params);\n        // only override the access specified previously if 'private' is passed explicitly\n        if (typeof requestOptions.private !== \"undefined\") {\n            requestOptions.params.access = requestOptions.private\n                ? \"private\"\n                : \"inherit\";\n        }\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```js\n * import { moveItem } from \"@esri/arcgis-rest-portal\";\n * //\n * moveItem({\n *   itemId: \"3ef\",\n *   folderId: \"7c5\",\n *   authentication: userSession\n * })\n * ```\n * Move an item to a folder. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/move-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that resolves with owner and folder details once the move has been completed\n */\nfunction moveItem(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.itemId + \"/move\";\n        var folderId = requestOptions.folderId;\n        if (!folderId) {\n            folderId = \"/\";\n        }\n        requestOptions.params = __assign({ folder: folderId }, requestOptions.params);\n        return request(url, requestOptions);\n    });\n}\n\nexport { updateItemResource as a, moveItem as m, updateItem as u };\n"],"names":["getService","options","request","cleanUrl","url","atobLookup","chr","index","indexOf","undefined","btoaLookup","abab","atob","data","replace","length","test","output","buffer","accumulatedBits","i","String","fromCharCode","btoa","s","charCodeAt","out","groupsOfSix","j","WGS84_WKID","PORTAL_EXPORT_TYPES","csv","name","itemTypes","supportsProjection","kml","shapefile","fileGeodatabase","geojson","excel","featureCollection","buildExistingExportsPortalQuery","itemId","types","onlyTypes","layerId","spatialRefId","maybeExtractOptions","formatInfos","Object","keys","map","key","noProjectionItemTypes","Set","flattenArray","filter","info","queryBuilder","SearchQueryBuilder","startGroup","match","getExportItemTypeKeyword","in","and","getExportLayerTypeKeyword","endGroup","builder","getSpatialRefIdWithDefaults","_spatialRefId","itemType","ret","has","buildQueryForType","type","_builder","getSpatialRefTypeKeyword","forEach","or","buildExportTypesClause","toParam","parsedSpatialReference","JSON","parse","_a","parseSpatialRefId","serializedSpatialReference","spatialReference","wkid","wkt","serializeSpatialReference","eventemitter3","createCommonjsModule","module","prototype","hasOwnProperty","prefix","Events","EE","fn","context","once","this","addListener","emitter","event","TypeError","listener","evt","_events","push","_eventsCount","clearEvent","EventEmitter","create","__proto__","eventNames","events","names","call","slice","getOwnPropertySymbols","concat","listeners","handlers","l","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","args","len","arguments","removeListener","apply","on","removeAllListeners","off","prefixed","exports","RemoteServerError","message","status","Error","urlBuilder","params","host","route","query","baseUrl","endsWith","URL","search","queryParams","reduce","acc","URLSearchParams","toString","buildQueryString","composeDownloadId","datasetId","format","geometry","where","HUB_FORMAT_LOOKUP","Shapefile","CSV","GeoJson","KML","convertToHubFormat","hubRequestDownloadMetadata","formats","stringify","fetch","then","resp","ok","statusText","json","isArray","validateApiResponse","downloadId","metadata","attributes","contentLastModified","lastModified","errors","contentLength","cacheTime","lastEditDate","source","downloadUrl","links","content","formatApiResponse","DownloadStatus","HubPoller","clearInterval","pollTimer","eventEmitter","pollingInterval","existingFileDate","Date","toISOString","existingFileTimestamp","getTime","setInterval","preExportFileTimestamp","currentFileDate","isReady","detail","disablePoll","exportDatasetFailed","error","catch","getExportsFolderId","authentication","requestOptions","folder","folderId","start","_b","num","suffix","determineOwner","owner","getPortalUrl","httpMethod","getUserContent","userContent","exportFolder","folders","find","title","createFolder","response","id","ExportCompletionError","setPrototypeOf","DownloadFormats","PortalPoller","jobId","exportCreated","getItemStatus","jobType","parseDatasetId","typeKeywords","updateItem","item","typekeywords","join","setItemAccess","access","exportFolderId","moveItem","err","code","removeItem","READY","portal","token","exportSuccessHandler","statusMessage","ERROR","pollDownloadMetadata","target","poller","activatePoll","portalPollExportJobStatus","hubPollDownloadMetadata","portalRequestDatasetExport","split","exportFormat","exportParameters","exportItem","composeExportParameters","size","exportItemId","now","targetSR","Number","layers","requestDatasetExport","body","method","headers","hubRequestDatasetExport","ItemTypes","portalRequestDownloadMetadata","serviceLastEditDate","itemModifiedDate","fetchedItem","getItem","modified","FeatureService","MapService","Promise","resolve","retryWithoutAuthOnFail","promises","layer","getLayer","all","getPortalFormat","extractLastEditDate","fetchCacheSearchMetadata","searchFormat","searchItems","q","sortField","sortOrder","searchResponse","cachedDownload","created","recentlyUpdated","isRecentlyUpdated","canDownload","lowercasedFormat","toLowerCase","isItemLevelDownloadEnabled","getProp","isFormatDownloadEnabled","enabled","isDownloadEnabled","exportCreatedDate","LOCKED","NOT_READY","READY_UNKNOWN","STALE_LOCKED","STALE","determineStatus","DISABLED","formatDownloadMetadata","results","multilayer","isMultilayerRequest","isCollectionType","editingInfo","timestamp","sort","a","b","requestPromise","retry","requestDownloadMetadata","dateFormatOptions","year","month","day","hour","minute","hour12","userCanExport","username","HubDownloadCard","hostRef","registerInstance","hubTelemetry","createEvent","hubDownloadCardSuccess","exportRequested","contentLengthString","bind","resetUndefinedProps","setLocalization","setAuthentication","fetchMetadataAndSetState","setTranslations","isSuccess","isCached","assign","dist","label","prop","intlManager","element","intl","dateTimeFormatter","Intl","DateTimeFormat","locale","setLabels","labels","accum","t","UserSession","getToken","setContentLengthString","fileSize","sizes","bytes","Math","floor","log","toFixed","calculateSize","getServiceParams","pollingEvent","exportInProgress","poll","apiError","exportDatasetComplete","exportDatasetError","exportPollingError","file","transferFile","buildDownloadTelemetry","exportDataset","window","open","location","href","downloadCached","filename","result","exportDatasetHandler","modifiedStatus","h","includes","fileDescription","direction","class","fileCreated","download","shouldUseDownloadButton","appearance","color","disabled","shouldDisableDownload","onClick","scale","width","buttonDownload","placement","slot","buttonOptions","hidden","onKeyDown","exportDatasetKeyDown","role","tabindex","menuRequest","downloadKeyDown","createdDate","downloadUpToDate","isFormatDownloadDisabled","Host","dir","renderFileDescription","renderNotice","renderDownloadControl","getElement","style","isGuid","stringToTest","substring","removeItemResource","__assign","resource","deleteAll","isSlug","identifier","addContextToSlug","slug","serializeItem","extent","isBBox","bboxToString","updateItemResource","fileName","resourcesPrefix","text","private"],"sourceRoot":""}