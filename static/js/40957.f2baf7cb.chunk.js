"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[40957],{97613:function(e,t,n){n.d(t,{Z:function(){return b}});var i=n(15671),r=n(43144),o=n(60136),a=n(92572),s=n(27366),l=n(84314),u=n(85015),c=n(11582),d=n(46784),v=n(92026),p=n(49861),h=(n(25243),n(63780),n(69912)),f=n(96866),y=n(585),g=n(64575),_=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).position=null,r.elevationInfo=null,r.feature=null,r}return(0,r.Z)(n,[{key:"equals",value:function(e){return(0,v._W)(this.position,e.position)&&(0,v._W)(this.elevationInfo,e.elevationInfo)&&(0,l.kk)(this.feature,e.feature)}}]),n}((0,d.eC)((0,c.J)(u.Z)));(0,s._)([(0,p.Cb)({type:y.Z}),(0,f.B)()],_.prototype,"position",void 0),(0,s._)([(0,p.Cb)({type:g.Z}),(0,f.B)()],_.prototype,"elevationInfo",void 0),(0,s._)([(0,p.Cb)(l.rX)],_.prototype,"feature",void 0);var b=_=(0,s._)([(0,h.j)("esri.analysis.LineOfSightAnalysisObserver")],_)},33985:function(e,t,n){n.d(t,{Z:function(){return _}});var i=n(15671),r=n(43144),o=n(60136),a=n(92572),s=n(27366),l=n(84314),u=n(11582),c=n(46784),d=n(92026),v=n(49861),p=(n(25243),n(63780),n(69912)),h=n(96866),f=n(585),y=n(64575),g=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).position=null,r.elevationInfo=null,r.feature=null,r}return(0,r.Z)(n,[{key:"equals",value:function(e){return(0,d._W)(this.position,e.position)&&(0,d._W)(this.elevationInfo,e.elevationInfo)&&(0,l.kk)(this.feature,e.feature)}}]),n}((0,c.eC)(u.j));(0,s._)([(0,v.Cb)({type:f.Z}),(0,h.B)()],g.prototype,"position",void 0),(0,s._)([(0,v.Cb)({type:y.Z}),(0,h.B)()],g.prototype,"elevationInfo",void 0),(0,s._)([(0,v.Cb)(l.rX)],g.prototype,"feature",void 0);var _=g=(0,s._)([(0,p.j)("esri.analysis.LineOfSightAnalysisTarget")],g)},84314:function(e,t,n){n.d(t,{kk:function(){return r},pD:function(){return o},rX:function(){return a}});var i=n(92026);function r(e,t){return o(e)===o(t)}function o(e){if((0,i.Wi)(e))return null;var t,n=null!=e.layer?e.layer.id:"";return null==(t=null!=e.objectId?e.objectId:null!=e.layer&&"objectIdField"in e.layer&&null!=e.layer.objectIdField&&null!=e.attributes?e.attributes[e.layer.objectIdField]:e.uid)?null:"o-".concat(n,"-").concat(t)}var a={json:{write:{writer:function(e,t){var n;(0,i.Wi)(e)||null==(null===(n=e.layer)||void 0===n?void 0:n.objectIdField)||null==e.attributes||(t.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})},target:{"feature.layerId":{type:[Number,String]},"feature.objectId":{type:[Number,String]}}},origins:{"web-scene":{read:function(e){if(null!=e.layerId&&null!=e.objectId)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}}}}}},96866:function(e,t,n){n.d(t,{B:function(){return f}});var i=n(74165),r=n(15861),o=n(1413),a=n(37762),s=n(80292),l=n(35995),u=n(71907),c=n(33397),d=n(25265),v=n(49861),p=n(22892),h=n(53283);function f(e){var t,n=null!==(t=null===e||void 0===e?void 0:e.origins)&&void 0!==t?t:[void 0];return function(t,i){var r,u=function(e,t,n){var i;if("resource"===(null===e||void 0===e?void 0:e.type))return function(e,t,n){var i=(0,c.Oe)(t,n);return{type:String,read:function(e,t,n){var r=(0,h.r)(e,t,n);return i.type===String?r:"function"==typeof i.type?new i.type({url:r}):void 0},write:{writer:function(t,r,a,u){if(!u||!u.resources)return"string"==typeof t?void(r[a]=(0,h.t)(t,u)):void(r[a]=t.write({},u));var c=function(e){return null==e?null:"string"==typeof e?e:e.url}(t),v=(0,h.t)(c,(0,o.Z)((0,o.Z)({},u),{},{verifyItemRelativeUrls:u&&u.verifyItemRelativeUrls?{writtenUrls:u.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0}),h.M.NO),f=i.type!==String&&(!(0,s.l)(this)||u&&u.origin&&this.originIdOf(n)>(0,d.M9)(u.origin)),b={object:this,propertyName:n,value:t,targetUrl:v,dest:r,targetPropertyName:a,context:u,params:e};u&&u.portalItem&&v&&!(0,l.YP)(v)?f?function(e){var t,n=e.context,i=e.targetUrl,r=e.params,a=e.value,s=e.dest,u=e.targetPropertyName;if(!n.portalItem)return;var c=n.portalItem.resourceFromPath(i),d=_(a,i,n),v=(0,p.B)(d),h=(0,l.Ml)(c.path),f=null!==(t=null===r||void 0===r?void 0:r.compress)&&void 0!==t&&t;v===h?(n.resources&&g((0,o.Z)((0,o.Z)({},e),{},{resource:c,content:d,compress:f,updates:n.resources.toUpdate})),s[u]=i):y(e)}(b):function(e){var t=e.context,n=e.targetUrl,i=e.dest,r=e.targetPropertyName;t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(n),compress:!1}),i[r]=n)}(b):u&&u.portalItem&&(null==v||null!=(0,h.i)(v)||(0,l.jc)(v)||f)?y(b):r[a]=v}}}}(e,t,n);switch(null!==(i=null===e||void 0===e?void 0:e.type)&&void 0!==i?i:"other"){case"other":return{read:!0,write:!0};case"url":return{read:h.a.read,write:h.a.write}}}(e,t,i),f=(0,a.Z)(n);try{for(f.s();!(r=f.n()).done;){var b=r.value,C=(0,v.CJ)(t,b,i);for(var m in u)C[m]=u[m]}}catch(w){f.e(w)}finally{f.f()}}}function y(e){var t,n,i,r=e.targetUrl,a=e.params,s=e.value,c=e.context,d=e.dest,v=e.targetPropertyName;if(c.portalItem){var f=(0,h.p)(r),y=null!==(t=null===f||void 0===f?void 0:f.filename)&&void 0!==t?t:(0,u.D)(),C=null!==(n=null===a||void 0===a?void 0:a.prefix)&&void 0!==n?n:null===f||void 0===f?void 0:f.prefix,m=_(s,r,c),w=(0,l.v_)(C,y),Z="".concat(w,".").concat((0,p.B)(m)),k=c.portalItem.resourceFromPath(Z);(0,l.jc)(r)&&c.resources&&c.resources.pendingOperations.push(function(e){return b.apply(this,arguments)}(r).then((function(e){k.path="".concat(w,".").concat((0,p.B)(e)),d[v]=k.itemRelativeUrl})).catch((function(){})));var O=null!==(i=null===a||void 0===a?void 0:a.compress)&&void 0!==i&&i;c.resources&&g((0,o.Z)((0,o.Z)({},e),{},{resource:k,content:m,compress:O,updates:c.resources.toAdd})),d[v]=k.itemRelativeUrl}}function g(e){var t=e.object,n=e.propertyName,i=e.updates,r=e.resource,o=e.content,a=e.compress;i.push({resource:r,content:o,compress:a,finish:function(e){!function(e,t,n){"string"==typeof e[t]?e[t]=n.url:e[t].url=n.url}(t,n,e)}})}function _(e,t,n){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(n))],{type:"application/json"})}function b(){return(b=(0,r.Z)((0,i.Z)().mark((function e(t){var r,o,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(n.bind(n,76200));case 2:return r=e.sent.default,e.next=5,r(t,{responseType:"blob"});case 5:return o=e.sent,a=o.data,e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},22892:function(e,t,n){n.d(t,{B:function(){return r}});var i=n(35995);function r(e){return o[function(e){return e instanceof Blob?e.type:function(e){var t=(0,i.Ml)(e);return l[t]||a}(e.url)}(e)]||s}var o={},a="text/plain",s=o[a],l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(var u in l)o[l[u]]=u},40957:function(e,t,n){n.r(t),n.d(t,{default:function(){return Qe}});var i=n(15671),r=n(43144),o=n(60136),a=n(92572),s=n(27366),l=n(85015),u=n(80987),c=n(91505),d=n(92026),v=n(49861),p=(n(25243),n(63780)),h=n(69912),f=n(71353),y=n(98074),g=n(51995),_=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).innerWidth=2,r.outerWidth=8,r.visibleInnerColor=new g.Z([3,252,111,1]),r.visibleOuterColor=new g.Z([3,252,111,.15]),r.occludedInnerColor=new g.Z([252,3,69,1]),r.occludedOuterColor=new g.Z([252,3,69,.1]),r.undefinedInnerColor=new g.Z([255,255,255,1]),r.undefinedOuterColor=new g.Z([127,127,127,.2]),r}return(0,r.Z)(n)}(l.Z);(0,s._)([(0,v.Cb)({type:Number})],_.prototype,"innerWidth",void 0),(0,s._)([(0,v.Cb)({type:Number})],_.prototype,"outerWidth",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],_.prototype,"visibleInnerColor",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],_.prototype,"visibleOuterColor",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],_.prototype,"occludedInnerColor",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],_.prototype,"occludedOuterColor",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],_.prototype,"undefinedInnerColor",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],_.prototype,"undefinedOuterColor",void 0),_=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSight.LineOfSightConfiguration")],_);var b=n(74165),C=n(15861),m=n(37762),w=(n(59486),n(84314)),Z=n(14921),k=n(100),O=n(42537),I=n(32718),T=n(66978),S=n(94172),P=n(11186),L=n(61826),V=n(79803),R=n(65156),E=n(40885),A=n(74509),H=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).target=null,r.intersectedGraphic=null,r.intersectedLocation=null,r.elevationAlignedTargetLocation=null,r.visible=void 0,r}return(0,r.Z)(n)}(l.Z);(0,s._)([(0,v.Cb)()],H.prototype,"target",void 0),(0,s._)([(0,v.Cb)()],H.prototype,"intersectedGraphic",void 0),(0,s._)([(0,v.Cb)()],H.prototype,"intersectedLocation",void 0),(0,s._)([(0,v.Cb)()],H.prototype,"elevationAlignedTargetLocation",void 0),(0,s._)([(0,v.Cb)({type:Boolean})],H.prototype,"visible",void 0),H=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSightAnalysisResult")],H);var M=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).elevationAlignedTargetLocation=null,r.inputPoints={isValid:!1,observer:(0,f.c)(),observerSurfaceNormal:null,observerFeatureId:null,target:(0,f.c)(),targetSurfaceNormal:null,targetFeatureId:null,observerAdjusted:(0,f.c)(),targetAdjusted:(0,f.c)()},r.computationResult={start:(0,f.c)(),end:(0,f.c)(),intersection:(0,f.c)(),isValid:!1,isTargetVisible:!1},r.result=null,r}return(0,r.Z)(n,[{key:"notifyResultChanged",value:function(){this.notifyChange("computationResult")}},{key:"notifyInputPointsChanged",value:function(){this.notifyChange("inputPoints")}}]),n}(l.Z);(0,s._)([(0,v.Cb)()],M.prototype,"target",void 0),(0,s._)([(0,v.Cb)()],M.prototype,"elevationAlignedTargetLocation",void 0),(0,s._)([(0,v.Cb)()],M.prototype,"inputPoints",void 0),(0,s._)([(0,v.Cb)()],M.prototype,"computationResult",void 0),(0,s._)([(0,v.Cb)()],M.prototype,"result",void 0),M=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSight.LineOfSightComputation")],M);var j,D=n(17842),W=n(51378),z=n(65618),F=n(84652),x=j=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,e)}return(0,r.Z)(n,[{key:"clone",value:function(){return new j({type:this.type,id:(0,F.d9)(this.id),mapPoint:(0,F.d9)(this.mapPoint),renderPoint:(0,f.a)(this.renderPoint),normal:(0,F.d9)(this.normal),ray:(0,F.d9)(this.ray),graphic:this.graphic})}},{key:"equals",value:function(e){return this.type===e.type&&this.id===e.id&&(0,d._W)(this.mapPoint,e.mapPoint)&&(0,P.F)(this.renderPoint,e.renderPoint)&&(0,p.fS)(this.normal,e.normal)&&(0,E.fS)(this.ray,e.ray)&&this.graphic===e.graphic}}]),n}(l.Z);(0,s._)([(0,v.Cb)()],x.prototype,"type",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],x.prototype,"id",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],x.prototype,"mapPoint",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],x.prototype,"renderPoint",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],x.prototype,"normal",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],x.prototype,"graphic",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],x.prototype,"ray",void 0),x=j=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],x);var N=n(85312),G=n(81703),B=n(43449),U=n(88153),q=n(54463),J=n(41781),X=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._terrainIntersectionOptionsLayerUids=new Set(["terrain"]),r}return(0,r.Z)(n,[{key:"initialize",value:function(){this.intersector=(0,U.Z8)(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=q.eC.MIN}},{key:"getScreenPointIntersection",value:function(e){var t=(0,D.md)(e,W.qW.get()),n=(0,G.u4)(this.view.state.camera,t,ee);return this._getRayIntersection(n)}},{key:"_getRayIntersection",value:function(e,t){if((0,d.Wi)(e)||(0,d.Wi)(this.view.sceneIntersectionHelper))return null;this.intersector.options.store=q.eC.MIN,this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,this.intersector,t);var n=this.intersector.results.min,i=(0,f.c)();if(!n.getIntersectionPoint(i))return null;var r=this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference),o=(0,f.a)(n.normal);if((0,N.GS)(n))return new x({type:q.q7.OBJECT,id:"".concat(n.target.layerUid,"/").concat(n.target.nodeIndex,"/").concat(n.target.componentIndex),mapPoint:r,renderPoint:i,normal:o,ray:(0,E.JG)(e),graphic:null});if((0,B.TX)(n))return new x({type:q.q7.TERRAIN,id:n.target.lij.slice(),mapPoint:r,renderPoint:i,normal:o,ray:(0,E.JG)(e),graphic:null});var a=(0,J.tB)(n,this.view);if((0,d.pC)(a)){var s,l=a.layer,u=a.sourceLayer;return s=u&&"scene"===u.type?(0,z.MS)(a,u.objectIdField):a.uid,new x({type:q.q7.OBJECT,id:"".concat(null===l||void 0===l?void 0:l.uid,"/").concat(s),mapPoint:r,renderPoint:i,normal:o,ray:(0,E.JG)(e),graphic:a})}return null}},{key:"updateFromGroundIntersection",value:function(e,t,n){var i=Y,r=Q,o=K,a=$;(0,P.c)(r,e),this.view.renderCoordsHelper.worldUpAtPosition(r,o),(0,P.n)(o,o);var s=this.view.basemapTerrain.visibleElevationBounds,l=s?Math.abs(s.max-s.min):100,u=t>=0?1:-1;(0,P.g)(a,o,u*(l+Math.abs(t))),(0,P.a)(i,r,a),(0,E.zk)(i,r,ee);var c=this._getRayIntersection(ee,{include:this._terrainIntersectionOptionsLayerUids});return(0,d.pC)(c)?((0,P.g)(a,o,u*t),(0,P.a)(n,c.renderPoint,a),(0,f.a)(c.normal)):((0,P.c)(n,e),null)}}]),n}(l.Z);(0,s._)([(0,v.Cb)()],X.prototype,"view",void 0),(0,s._)([(0,v.Cb)()],X.prototype,"intersector",void 0),X=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],X);var Y=(0,f.c)(),Q=(0,f.c)(),K=(0,f.c)(),$=(0,f.c)(),ee=(0,E.Ue)(),te=n(33906),ne=n(93463),ie=n(585),re="esri.views.3d.analysis.LineOfSight.LineOfSightController",oe=I.Z.getLogger(re),ae=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).updateOnCameraChange=!0,r._observerGroundOffsetRenderSpace=0,r._effectiveObserverElevationMode="absolute-height",r._observerFeatureId=null,r._updatingHandles=new L.t,r._frameTask=ne.sq,r._handles=new k.Z,r._computationHandles=new k.Z,r._externalObserverUpdate=!0,r}return(0,r.Z)(n,[{key:"initialize",value:function(){var e,t=null===(e=this.view.resourceController)||void 0===e?void 0:e.scheduler;this._frameTask=t?t.registerTask(ne.T8.LINE_OF_SIGHT_TOOL):ne.sq,this._intersector=new X({view:this.view}),this._handles.add([this._connectObserver(),this._connectComputations(),this._connectTargets()])}},{key:"destroy",value:function(){this._handles.destroy(),this._computationHandles.destroy(),this._computations.removeAll(),this._updatingHandles.destroy()}},{key:"updating",get:function(){return this._frameTask.updating||this._updatingHandles.updating}},{key:"priority",get:function(){return this._frameTask.priority},set:function(e){this._frameTask.priority=e}},{key:"_computations",get:function(){return this.analysisViewData.computations}},{key:"_elevationAlignedObserverPositionRenderSpace",get:function(){return this.analysisViewData.observerEngineLocation},set:function(e){this.analysisViewData.observerEngineLocation=e}},{key:"_screenPixelSize",get:function(){return this.view.state.camera.computeScreenPixelSizeAt(this._elevationAlignedObserverPositionRenderSpace)}},{key:"_computeResult",value:function(e){var t=e.computation,n=t.inputPoints,i=t.computationResult,r=n.observerAdjusted,o=n.targetAdjusted,a=i.start,s=i.end;(0,P.c)(a,r),(0,P.c)(s,o),this._canCompute(t)?this._computeIntersection(e):this._interpolateIntersection(e),t.notifyResultChanged(),this.emit("result-changed",{target:e.computation.target,result:t.result})}},{key:"_updateAdjustedPointsFromFeatures",value:function(e){var t=this.view,n=t.sceneIntersectionHelper,i=e.inputPoints,r=i.observerAdjusted,o=i.observerFeatureId,a=i.targetFeatureId,s=i.targetAdjusted;if(!(0,d.Wi)(o)||!(0,d.Wi)(a)){var l=(0,P.i)(r,s),u=this._intersector.intersector,c=(0,E.zk)(i.observer,i.target,ue);u.options.store=q.eC.ALL,n.intersectToolIntersectorRay(c,u);var v,p=null,h=null,y=null,g=null,_=(0,m.Z)(u.results.all);try{for(_.s();!(v=_.n()).done;){var b=v.value,C=(0,J.tB)(b,this.view);if(!(0,d.Wi)(C)&&!(0,d.Wi)(b.distanceInRenderSpace)){var Z=(0,w.pD)(C);(0,d.Wi)(Z)||((0,d.pC)(o)&&Z===o&&((0,d.Wi)(p)&&(p=this._getFeatureDistanceThreshold(b,t,l)),b.distanceInRenderSpace<p&&(y=b)),(0,d.pC)(a)&&Z===a&&((0,d.Wi)(h)&&(h=this._getFeatureDistanceThreshold(b,t,l)),(0,d.Wi)(g)&&b.distanceInRenderSpace<l&&l-b.distanceInRenderSpace<h&&(g=b)))}}}catch(k){_.e(k)}finally{_.f()}(0,d.pC)(y)&&y.getIntersectionPoint(r)&&(i.observerSurfaceNormal=y.getTransformedNormal((0,f.c)())),(0,d.pC)(g)&&g.getIntersectionPoint(s)&&(i.targetSurfaceNormal=g.getTransformedNormal((0,f.c)()))}}},{key:"_getFeatureDistanceThreshold",value:function(e,t,n){if((0,J._s)(e)){var i=(0,J.VB)(e,t);if((0,d.pC)(i))return Math.min(i*de,n)}return 1e-5*n}},{key:"_adjustStartEndPositions",value:function(e){var t=this._screenPixelSize,n=this.view,i=e.inputPoints,r=i.observer,o=i.observerSurfaceNormal,a=i.target,s=i.targetSurfaceNormal,l=i.observerAdjusted,u=i.targetAdjusted,c=le;(0,P.c)(l,r),(0,P.c)(u,a),this._updateAdjustedPointsFromFeatures(e),(0,d.pC)(o)?(0,P.c)(c,o):(0,P.b)(c,u,l);var v=t;(0,P.n)(c,c),(0,P.g)(c,c,Math.min(v,1)),(0,P.a)(l,l,c),(0,d.pC)(s)?(0,P.c)(c,s):(0,P.b)(c,l,u);var p=n.state.camera.computeScreenPixelSizeAt(u);(0,P.n)(c,c),(0,P.g)(c,c,Math.min(p,1)),(0,P.a)(u,u,c)}},{key:"_computeIntersection",value:function(e){var t=e.computation,n=e.interpolationInfo,i=this.view,r=i.sceneIntersectionHelper,o=i.renderCoordsHelper;if(!(0,d.Wi)(r)){var a=this._intersector.intersector,s=t.computationResult,l=t.inputPoints,u=l.observer,c=l.target,v=s.start,p=s.end,h=(0,E.zk)(v,p,ue);a.options.store=q.eC.MIN,r.intersectToolIntersectorRay(h,a);var f=a.results.min,y=s.intersection,g=le,_=!0;if((0,d.pC)(f)&&f.getIntersectionPoint(y)){(0,P.c)(n.originalIntersection,y),(0,P.c)(n.originalObserver,v),(0,P.c)(n.originalTarget,p),o.fromRenderCoords(y,g,i.spatialReference);var b=1-(0,P.j)(p,c)/(0,P.j)(v,c);_=(0,P.j)(u,y)>=b*(0,P.j)(u,c)}var C=new ie.Z(g,i.spatialReference),m=t.result,w=t.target;(0,d.pC)(m)?(m.target=w,m.intersectedGraphic=_?null:(0,J.tB)(f,i),m.intersectedLocation=_?null:C,m.visible=_):t.result=new H({target:w,elevationAlignedTargetLocation:t.elevationAlignedTargetLocation,intersectedGraphic:_?null:(0,J.tB)(f,i),intersectedLocation:_?null:C,visible:_}),s.isValid=l.isValid=!0,s.isTargetVisible=_}}},{key:"_interpolateIntersection",value:function(e){var t=e.computation,n=e.interpolationInfo,i=t.computationResult,r=t.inputPoints,o=i.start,a=i.end,s=i.intersection,l=n.originalIntersection,u=n.originalObserver,c=n.originalTarget;if((0,P.c)(s,l),r.isValid){var d=le,v=(0,P.j)(u,l)/(0,P.j)(u,c);(0,P.w)(d,o,u),(0,P.g)(d,d,1-v),(0,P.a)(s,s,d),(0,P.w)(d,a,c),(0,P.g)(d,d,v),(0,P.a)(s,s,d),i.isValid=!0}else t.result=null,i.isValid=!1,i.isTargetVisible=!1}},{key:"_canCompute",value:function(e){var t=this.analysisViewData.elevationAlignedObserver,n=this.view.frustum;if((0,d.Wi)(t)||(0,d.Wi)(e.elevationAlignedTargetLocation)||(0,d.Wi)(n))return!1;var i=e.inputPoints,r=i.observerAdjusted,o=i.targetAdjusted,a=n.intersectsPoint(r),s=n.intersectsPoint(o);return a&&s}},{key:"_onObserverPositionChange",value:function(e,t,n,i,r){if(this._externalObserverUpdate=r,(0,d.Wi)(e))return this.analysisViewData.elevationAlignedObserver=null,void(this._observerFeatureId=null);if((0,d.Wi)(t))return(0,te.e)(this.analysis,e.spatialReference,oe),void(this.analysisViewData.elevationAlignedObserver=null);var o=this._getEffectiveElevationInfo(t,n),a=(0,A.tq)(t.x,t.y,t.z,this.view.spatialReference,this.view,o),s=a.absoluteZ,l=a.elevation,u=t.clone();u.z=s,this._effectiveObserverElevationMode=o.mode,this.analysisViewData.elevationAlignedObserver=u;var c=(0,f.c)();this.view.renderCoordsHelper.toRenderCoords(u,c),this._elevationAlignedObserverPositionRenderSpace=c,this._observerGroundOffsetRenderSpace=s-l,this._observerFeatureId=(0,w.pD)(i),this.priority=ne.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_onObserverRenderSpacePositionChangeForComputation",value:function(e,t,n,i,r){var o=e.inputPoints;switch((0,P.c)(o.observer,t),o.observerFeatureId=r,o.observerSurfaceNormal=null,i){case"on-the-ground":case"relative-to-ground":var a=this._intersector.updateFromGroundIntersection(o.observer,n,o.observer);(0,d.Wi)(o.observerFeatureId)&&(o.observerSurfaceNormal=a)}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=ne.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_onTargetPositionChange",value:function(e,t,n,i,r){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=e.inputPoints;if(o&&(a.isValid=!1),(0,d.Wi)(n))return(0,d.pC)(t)&&(0,te.e)(this.analysis,t.spatialReference,oe),e.elevationAlignedTargetLocation=null,void e.notifyInputPointsChanged();var s=this._getEffectiveElevationInfo(n,i),l=(0,A.tq)(n.x,n.y,n.z,this.view.spatialReference,this.view,s),u=l.absoluteZ,c=l.elevation,v=n.clone();switch(v.z=u,e.elevationAlignedTargetLocation=v,this.view.renderCoordsHelper.toRenderCoords(e.elevationAlignedTargetLocation,a.target),a.targetFeatureId=(0,w.pD)(r),a.targetSurfaceNormal=null,s.mode){case"on-the-ground":case"relative-to-ground":var p=this._intersector.updateFromGroundIntersection(a.target,u-c,a.target);(0,d.Wi)(a.targetFeatureId)&&(a.targetSurfaceNormal=p)}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=ne.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_connectComputationToTarget",value:function(e){var t=this;return(0,O.AL)([this._updatingHandles.add((function(){return{computation:e,targetPosition:e.target.position,targetElevationInfo:e.target.elevationInfo,targetFeatureInfo:e.target.feature,projectedTargetPosition:(0,V.dz)(e.target.position,t.view.spatialReference)}}),(function(e){var n=e.computation,i=e.targetPosition,r=e.targetElevationInfo,o=e.targetFeatureInfo,a=e.projectedTargetPosition;(0,d.pC)(a.pending)?t._updatingHandles.addPromise(a.pending):t._onTargetPositionChange(n,i,a.geometry,r,o)}),S.nn)])}},{key:"_connectComputationToObserver",value:function(e){var t=this;return this._updatingHandles.add((function(){return{computation:e,observer:t.analysisViewData.elevationAlignedObserver}}),(function(e){var n=e.computation;t._externalObserverUpdate&&(n.inputPoints.isValid=!1,n.notifyInputPointsChanged())}),S.nn)}},{key:"_connectComputationToRenderSpaceObserver",value:function(e){var t=this;return this._updatingHandles.add((function(){return{computation:e,observer:t._elevationAlignedObserverPositionRenderSpace,observerGroundOffset:t._observerGroundOffsetRenderSpace,observerElevationMode:t._effectiveObserverElevationMode,observerFeatureId:t._observerFeatureId}}),(function(e){var n=e.computation,i=e.observer,r=e.observerGroundOffset,o=e.observerElevationMode,a=e.observerFeatureId;t._onObserverRenderSpacePositionChangeForComputation(n,i,r,o,a)}),S.nn)}},{key:"_connectComputationToCamera",value:function(e){var t=this;return this._updatingHandles.add((function(){return{camera:t.view.state.camera,isDirty:t._isCameraDirty}}),(function(n){var i=n.isDirty;!t.updateOnCameraChange||e.inputPoints.isValid&&!i||e.notifyInputPointsChanged()}))}},{key:"_connectComputationToSlicePlane",value:function(e){var t=this;return this._updatingHandles.add((function(){return t.view.slicePlane}),(function(){e.inputPoints.isValid=!1,e.notifyInputPointsChanged()}))}},{key:"_connectComputationToElevation",value:function(e){var t=this,n=function n(i,r){var o=t.analysis.observer,a=e.target,s=null,l=null,u=null,c=null,v=null,p=null;if((0,d.pC)(o)&&(0,d.pC)(o.position)){var h=(0,V.dz)(o.position,t.view.spatialReference);if((0,d.pC)(h.pending))return t._updatingHandles.addPromise(h.pending),void h.pending.finally((function(){return n(i,r)}));s=h.geometry,l=o.elevationInfo,u=o.feature}if((0,d.pC)(a.position)){var f=(0,V.dz)(a.position,t.view.spatialReference);if((0,d.pC)(f.pending))return t._updatingHandles.addPromise(f.pending),void f.pending.finally((function(){return n(i,r)}));c=f.geometry,v=a.elevationInfo,p=a.feature}(0,d.Wi)(s)&&(0,d.Wi)(c)||((0,V.dH)(i,r,ce,t.view.spatialReference),(0,d.pC)(s)&&(0,R.Qn)(ce,s)&&t._onObserverPositionChange((0,d.pC)(o)?o.position:null,s,l,u,!1),(0,d.pC)(c)&&(0,R.Qn)(ce,c)&&t._onTargetPositionChange(e,a.position,c,v,p,!1),(0,d.pC)(s)&&(0,d.pC)(c)&&(0,R.I7)(ce,s,c)&&e.notifyInputPointsChanged())};return this.view.elevationProvider.on("elevation-change",(function(e){return n(e.extent,e.spatialReference)}))}},{key:"_connectComputationToTask",value:function(e){var t=this,n=d.YP,i={computation:e,interpolationInfo:{originalIntersection:(0,f.c)(),originalObserver:(0,f.c)(),originalTarget:(0,f.c)()}};return(0,O.AL)([this._updatingHandles.add((function(){return e.inputPoints}),(function(){n=(0,d.IM)(n),n=(0,Z.vr)(function(){var e=(0,C.Z)((0,b.Z)().mark((function e(n){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,T.R8)(t._frameTask.schedule((function(){return t._computeResult(i)}),n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),{initial:!0,equals:function(){return!1}}),(0,O.kB)((function(){return n=(0,d.IM)(n)}))])}},{key:"_connectComputation",value:function(e){var t=this._computationHandles;t.has(e)||t.add([this._connectComputationToTarget(e),this._connectComputationToObserver(e),this._connectComputationToRenderSpaceObserver(e),this._connectComputationToCamera(e),this._connectComputationToSlicePlane(e),this._connectComputationToElevation(e),this._connectComputationToTask(e)],e)}},{key:"_disconnectComputation",value:function(e){this._computationHandles.remove(e)}},{key:"_onComputationCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,m.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(u){r.e(u)}finally{r.f()}var a,s=(0,m.Z)(n);try{for(s.s();!(a=s.n()).done;){var l=a.value;this._connectComputation(l)}}catch(u){s.e(u)}finally{s.f()}}},{key:"_onTargetCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,m.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._removeTarget(o)}}catch(u){r.e(u)}finally{r.f()}var a,s=(0,m.Z)(n);try{for(s.s();!(a=s.n()).done;){var l=a.value;this._addTarget(l)}}catch(u){s.e(u)}finally{s.f()}}},{key:"_onCursorTargetChange",value:function(e,t){(0,d.pC)(t)&&this._removeTarget(t),(0,d.pC)(e)&&this._addTarget(e)}},{key:"_addTarget",value:function(e){this._computations.some((function(t){return t.target===e}))||this._computations.add(new M({target:e}))}},{key:"_removeTarget",value:function(e){var t=this._computations.findIndex((function(t){return t.target===e}));this._computations.removeAt(t)}},{key:"_connectObserver",value:function(){var e=this;return(0,O.AL)([this._updatingHandles.add((function(){return{observerPosition:(0,d.pC)(e.analysis.observer)?e.analysis.observer.position:null,projectedObserverPosition:(0,V.dz)((0,d.pC)(e.analysis.observer)?e.analysis.observer.position:null,e.view.spatialReference),observerElevationInfo:(0,d.pC)(e.analysis.observer)?e.analysis.observer.elevationInfo:null,observerFeatureInfo:(0,d.pC)(e.analysis.observer)?e.analysis.observer.feature:null}}),(function(t){var n=t.observerPosition,i=t.projectedObserverPosition,r=t.observerElevationInfo,o=t.observerFeatureInfo;(0,d.pC)(i.pending)?e._updatingHandles.addPromise(i.pending):e._onObserverPositionChange(n,i.geometry,r,o,!0)}),S.nn)])}},{key:"_connectComputations",value:function(){var e=this;return this._updatingHandles.addOnCollectionChange((function(){return e._computations}),(function(t){return e._onComputationCollectionChange(t)}),{initial:!0,final:!0})}},{key:"_connectTargets",value:function(){var e=this;return(0,O.AL)([this._updatingHandles.addOnCollectionChange((function(){return e.analysis.targets}),(function(t){return e._onTargetCollectionChange(t)}),{initial:!0,final:!0}),this._updatingHandles.add((function(){return e.analysisViewData.cursorTarget}),(function(t,n){e._onCursorTargetChange(t,n)}))])}},{key:"_isCameraDirty",get:function(){var e=this.analysisViewData.elevationAlignedObserver,t=this.view,n=t.renderCoordsHelper;if((0,d.Wi)(e)||(0,d.Wi)(n))return!1;var i=le;n.toRenderCoords(e,i);var r=t.state.camera.computeScreenPixelSizeAt(i);return Math.abs((r-this._screenPixelSize)/this._screenPixelSize)>se}},{key:"_getEffectiveElevationInfo",value:function(e,t){return e.hasZ?(0,d.Pt)(t,{mode:"absolute-height",offset:0}):{mode:"on-the-ground",offset:0}}}]),n}(c.Z.EventedMixin(l.Z));(0,s._)([(0,v.Cb)({constructOnly:!0})],ae.prototype,"analysis",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],ae.prototype,"analysisViewData",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],ae.prototype,"view",void 0),(0,s._)([(0,v.Cb)()],ae.prototype,"updating",null),(0,s._)([(0,v.Cb)()],ae.prototype,"priority",null),(0,s._)([(0,v.Cb)()],ae.prototype,"updateOnCameraChange",void 0),(0,s._)([(0,v.Cb)()],ae.prototype,"_computations",null),(0,s._)([(0,v.Cb)()],ae.prototype,"_elevationAlignedObserverPositionRenderSpace",null),(0,s._)([(0,v.Cb)()],ae.prototype,"_observerGroundOffsetRenderSpace",void 0),(0,s._)([(0,v.Cb)()],ae.prototype,"_effectiveObserverElevationMode",void 0),(0,s._)([(0,v.Cb)()],ae.prototype,"_observerFeatureId",void 0),(0,s._)([(0,v.Cb)()],ae.prototype,"_screenPixelSize",null),(0,s._)([(0,v.Cb)({readOnly:!0})],ae.prototype,"_updatingHandles",void 0),(0,s._)([(0,v.Cb)()],ae.prototype,"_frameTask",void 0),(0,s._)([(0,v.Cb)()],ae.prototype,"_isCameraDirty",null),ae=(0,s._)([(0,h.j)(re)],ae);var se=.1,le=(0,f.c)(),ue=(0,E.Ue)(),ce=(0,R.cS)(),de=.05,ve=n(1413),pe=n(97613),he=n(33985),fe=n(85981),ye=n(64575),ge=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).enabled=!0,r.glowColor=new g.Z([255,127,0]),r.glowWidth=8,r.innerColor=new g.Z([255,255,255]),r.innerWidth=.75,r.globalAlpha=.75,r}return(0,r.Z)(n)}(l.Z);(0,s._)([(0,v.Cb)({type:Boolean})],ge.prototype,"enabled",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],ge.prototype,"glowColor",void 0),(0,s._)([(0,v.Cb)({type:Number})],ge.prototype,"glowWidth",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],ge.prototype,"innerColor",void 0),(0,s._)([(0,v.Cb)({type:Number})],ge.prototype,"innerWidth",void 0),(0,s._)([(0,v.Cb)({type:Number})],ge.prototype,"globalAlpha",void 0),ge=(0,s._)([(0,h.j)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightLaserLineConfiguration")],ge);var _e=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).size=.5,r.color=new g.Z([255,127,0,.75]),r}return(0,r.Z)(n)}(l.Z);(0,s._)([(0,v.Cb)({type:Number})],_e.prototype,"size",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],_e.prototype,"color",void 0),_e=(0,s._)([(0,h.j)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightObserverConfiguration")],_e);var be=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).size=.5,r.visibleColor=new g.Z([3,252,111,.75]),r.occludedColor=new g.Z([252,3,69,.75]),r.undefinedColor=new g.Z([127,127,127,.75]),r}return(0,r.Z)(n)}(l.Z);(0,s._)([(0,v.Cb)({type:Number})],be.prototype,"size",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],be.prototype,"visibleColor",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],be.prototype,"occludedColor",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],be.prototype,"undefinedColor",void 0),be=(0,s._)([(0,h.j)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTargetConfiguration")],be);var Ce=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).innerWidth=2,r.outerWidth=8,r.visibleInnerColor=new g.Z([3,252,111,1]),r.visibleOuterColor=new g.Z([3,252,111,.15]),r.occludedInnerColor=new g.Z([252,3,69,1]),r.occludedOuterColor=new g.Z([252,3,69,.1]),r.undefinedInnerColor=new g.Z([255,255,255,1]),r.undefinedOuterColor=new g.Z([127,127,127,.2]),r}return(0,r.Z)(n)}(l.Z);(0,s._)([(0,v.Cb)({type:Number})],Ce.prototype,"innerWidth",void 0),(0,s._)([(0,v.Cb)({type:Number})],Ce.prototype,"outerWidth",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],Ce.prototype,"visibleInnerColor",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],Ce.prototype,"visibleOuterColor",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],Ce.prototype,"occludedInnerColor",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],Ce.prototype,"occludedOuterColor",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],Ce.prototype,"undefinedInnerColor",void 0),(0,s._)([(0,v.Cb)({type:g.Z})],Ce.prototype,"undefinedOuterColor",void 0);var me=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).laserLine=new ge,r.observer=new _e,r.target=new be,r.lineOfSight=new Ce,r}return(0,r.Z)(n)}(l.Z);(0,s._)([(0,v.Cb)({type:ge})],me.prototype,"laserLine",void 0),(0,s._)([(0,v.Cb)({type:_e})],me.prototype,"observer",void 0),(0,s._)([(0,v.Cb)({type:be})],me.prototype,"target",void 0),(0,s._)([(0,v.Cb)({type:Ce})],me.prototype,"lineOfSight",void 0),me=(0,s._)([(0,h.j)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightToolConfiguration")],me);var we=n(35284),Ze=n(83639),ke=n(40508),Oe=n(81655),Ie=n(70619),Te=n(99034);function Se(e,t,n){return new ke.r((0,Ie.PI)((0,Ze.EA)(g.Z.toUnitRGBA(t)),e,32,32),n)}function Pe(e){var t=[];return e.customColor1&&t.push(Se(e.size,e.customColor1,Te.jg.Custom1)),e.customColor2&&t.push(Se(e.size,e.customColor2,Te.jg.Custom2)),e.customColor3&&t.push(Se(e.size,e.customColor3,Te.jg.Custom3)),e.color&&t.push(Se(e.size,e.color)),t}var Le,Ve=n(62389),Re=(n(84057),n(86509)),Ee=n(74229),Ae=n(72612),He=n(63920);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(Le||(Le={}));var Me=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).removeIncompleteOnCancel=!1,r.configuration=new me,r.analysisViewData=null,r._latestPointerMovePointerType=null,r._laserlineVisualElement=null,r._grabbedManipulator=null,r._analysisHandles=new k.Z,r._handles=new k.Z,r._updatingHandles=new L.t,r._manipulatorHandles=new k.Z,r._targetTrackerManipulator=null,r}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this;this._intersector=new X({view:this.view}),this._handles.add((0,S.YP)((function(){return e.state}),(function(t){t===Le.Created&&e.finishToolCreation()}),S.tX)),this._observerManipulator=this._createObserverManipulator(),this._handles.add([this._updatingHandles.add((function(){return(0,ve.Z)({},e.configuration.observer)}),(function(){return e._updateObserverManipulatorStyle()})),this._updatingHandles.add((function(){var t;return null===(t=e.analysisViewData)||void 0===t?void 0:t.elevationAlignedObserver}),(function(t){return e._onObserverLocationChange(t)}),S.nn),this._updatingHandles.add((function(){return(0,ve.Z)({},e.configuration.laserLine)}),(function(){return e._createVisualElements()}),S.nn),this._updatingHandles.add((function(){return e._laserLineRendererDependencies()}),(function(t){return e._updateLaserLineRenderer(t)})),this._connectComputations(),this._updatingHandles.addWhen((function(){return!e._shouldRenderTracker}),(function(){return e._clearCursorTracker()}),S.nn)])}},{key:"destroy",value:function(){this._updatingHandles=(0,d.SC)(this._updatingHandles),this._handles=(0,d.SC)(this._handles),this._manipulatorHandles=(0,d.SC)(this._manipulatorHandles),this._analysisHandles=(0,d.SC)(this._analysisHandles),this._observerManipulator=null,this._clearCursorTracker(),this._removeVisualElements(),this._intersector=null,this._set("analysis",null)}},{key:"state",get:function(){return this.active?this.hasGrabbedManipulators?Le.Created:Le.Creating:(0,d.pC)(this.analysis.observer)&&(0,d.pC)(this.analysis.observer.position)?Le.Created:Le.Ready}},{key:"cursor",get:function(){return this.active&&this._showTracker?"crosshair":null}},{key:"updating",get:function(){return(0,d.pC)(this.analysisViewData)&&this.analysisViewData.updating||this._updatingHandles.updating}},{key:"_showTracker",get:function(){return this.active&&"mouse"===this._latestPointerMovePointerType}},{key:"_shouldRenderTracker",get:function(){return this._showTracker&&(0,d.pC)(this.analysis.observer)&&(0,d.pC)(this.analysis.observer.position)&&!this.hasGrabbedManipulators}},{key:"continue",value:function(){this.view.activeTool=this}},{key:"stop",value:function(){this.view.activeTool=null}},{key:"onEditableChange",value:function(){this.analysisViewData.editable=this.internallyEditable}},{key:"onInputEvent",value:function(e){switch(e.type){case"immediate-double-click":this._doubleClickHandler(e);break;case"key-down":this._keyDownHandler(e);break;case"pointer-move":this._pointerMoveHandler(e)}}},{key:"onInputEventAfter",value:function(e){"immediate-click"===e.type&&this._clickHandler(e)}},{key:"onShow",value:function(){}},{key:"onHide",value:function(){}},{key:"onDeactivate",value:function(){this._clearCursorTracker()}},{key:"_connectComputations",value:function(){var e=this;return this._updatingHandles.addOnCollectionChange((function(){return e.analysisViewData.computations}),(function(t){return e._onComputationsCollectionChange(t)}),{initial:!0,final:!0})}},{key:"_onComputationsCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,m.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(u){r.e(u)}finally{r.f()}var a,s=(0,m.Z)(n);try{for(s.s();!(a=s.n()).done;){var l=a.value;this._connectComputation(l)}}catch(u){s.e(u)}finally{s.f()}}},{key:"_connectComputation",value:function(e){var t=this;if(this.destroyed)I.Z.getLogger(this.declaredClass).warn("Attempting to connect an analysis to a destroyed LineOfSight tool. Ignoring.");else{var n=this._analysisHandles;if(!n.has(e)){var i=this._createTargetManipulator(e.target);(0,d.Wi)(this._targetTrackerManipulator)&&i.metadata.target===this.analysisViewData.cursorTarget&&(this._targetTrackerManipulator=i,this._targetTrackerManipulator.available=!1,this._targetTrackerManipulator.interactive=!1,this._updateLaserLineRenderer()),n.add([this._updatingHandles.add((function(){return t._getLineOfSightManipulatorStateDependencies(e)}),(function(){return t._updateManipulatorState(i,e)}),S.nn),this._updatingHandles.add((function(){return e.elevationAlignedTargetLocation}),(function(e){return t._onTargetLocationChange(e,i)}),S.nn)],e)}}}},{key:"_disconnectComputation",value:function(e){if(this.destroyed)I.Z.getLogger(this.declaredClass).warn("Attempting to disconnect an analysis from a destroyed LineOfSight tool. Ignoring.");else{this._analysisHandles.remove(e);var t=this._getTargetManipulator(e.target);(0,d.pC)(t)&&(this.manipulators.remove(t),this._manipulatorHandles.remove(t),(0,d.pC)(this._targetTrackerManipulator)&&this._targetTrackerManipulator===t&&(this._targetTrackerManipulator=null))}}},{key:"_clearCursorTracker",value:function(){this.analysisViewData.cursorTarget=(0,d.SC)(this.analysisViewData.cursorTarget)}},{key:"_createManipulator",value:function(e,t,n){var i=this,r=function(e,t){var n=Pe(t),i=new we.Z({view:e,renderObjects:n,elevationInfo:{mode:"absolute-height",offset:0}});return(0,Oe.t)(i),i}(this.view,e);return r.metadata=n,this._manipulatorHandles.add([t(r),r.events.on("grab-changed",(function(e){return i._manipulatorGrabChanged(r,e)})),r.events.on("immediate-click",(function(e){return i._manipulatorClick(r,e)}))],r),this.manipulators.add(r),r}},{key:"_createTargetManipulator",value:function(e){var t=this,n=this.configuration,i={size:n.target.size,customColor1:n.target.visibleColor,customColor2:n.target.occludedColor,customColor3:n.target.undefinedColor,visible:!0},r={target:e,type:"target"},o=this._createManipulator(i,(function(e){return t._createTargetManipulatorDragPipeline(e)}),r);return(0,d.pC)(e.position)?o.elevationAlignedLocation=e.position:o.available=!1,o}},{key:"_getTargetManipulator",value:function(e){var t=null;return this.manipulators.forEach((function(n){var i=n.manipulator;(0,d.Wi)(t)&&"target"===i.metadata.type&&i.metadata.target===e&&(t=i)})),t}},{key:"_createObserverManipulator",value:function(){var e=this,t=this.configuration,n={size:t.observer.size,color:t.observer.color,visible:!0};return this._createManipulator(n,(function(t){return e._createObserverManipulatorDragPipeline(t)}),{type:"observer",intersection:null})}},{key:"_updateObserverManipulatorStyle",value:function(){var e=this._observerManipulator,t=this.configuration.observer,n={size:t.size,color:t.color,visible:e.available};e.renderObjects=Pe(n)}},{key:"_screenToIntersection",value:function(){var e=this;return function(t){var n=e._intersector.getScreenPointIntersection(t.screenEnd);return(0,d.Wi)(n)?null:(0,ve.Z)((0,ve.Z)({},t),{},{intersection:n})}}},{key:"_createTargetManipulatorDragPipeline",value:function(e){var t=this;return(0,Ee.Xd)(e,(function(n,i,r){i.next(t._screenToIntersection()).next(t._updateTargetDragStep(e)).next((function(){return t._updateLaserLineRenderer()})),r.next(t._cancelTargetDragStep(e.metadata.target)).next((function(){return t._updateLaserLineRenderer()}))}))}},{key:"_createObserverManipulatorDragPipeline",value:function(e){var t=this;return(0,Ee.Xd)(e,(function(e,n,i){n.next(t._screenToIntersection()).next(t._updateObserverDragStep()).next((function(){return t._updateLaserLineRenderer()})),i.next(t._cancelObserverDragStep()).next((function(){return t._updateLaserLineRenderer()}))}))}},{key:"_updateObserverDragStep",value:function(){var e=this;return function(t){return(0,d.pC)(t.intersection.mapPoint)?((0,d.Wi)(e.analysis.observer)&&(e.analysis.observer=new pe.Z),e._updateFromIntersection(e.analysis.observer,t.intersection)):e.analysis.observer=null,t}}},{key:"_cancelObserverDragStep",value:function(){var e=this,t=(0,d.pC)(this.analysis.observer)&&(0,d.pC)(this.analysis.observer.position)?this.analysis.observer.clone():null;return function(n){return e.analysis.observer=t,n}}},{key:"_updateTargetDragStep",value:function(e){var t=this;return function(n){t._updateFromIntersection(e.metadata.target,n.intersection);var i=n.intersection.mapPoint;return(0,d.pC)(i)&&(e.elevationAlignedLocation=i),n}}},{key:"_cancelTargetDragStep",value:function(e){var t=(0,d.yw)(e.position,(function(e){return e.clone()}));return function(n){return e.position=t,n}}},{key:"_manipulatorGrabChanged",value:function(e,t){switch(t.action){case"start":this._grabbedManipulator=e;break;case"end":this._grabbedManipulator===e&&(this._grabbedManipulator=null)}}},{key:"_updateManipulatorState",value:function(e,t){var n=t.computationResult,i=n.isValid,r=n.isTargetVisible;e.state=i?r?Te.jg.Custom1:Te.jg.Custom2:Te.jg.Custom3}},{key:"_getLineOfSightManipulatorStateDependencies",value:function(e){var t=e.computationResult;return{isValid:t.isValid,isTargetVisible:t.isTargetVisible}}},{key:"_laserLineRendererDependencies",value:function(){return{laserlineVisualElement:this._laserlineVisualElement,grabbedManipulator:this._grabbedManipulator,shouldRenderTracker:this._shouldRenderTracker,observerPosition:(0,d.pC)(this.analysis.observer)?this.analysis.observer.position:null,visible:this.visible}}},{key:"_updateLaserLineRenderer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._laserLineRendererDependencies(),t=e.laserlineVisualElement,n=e.grabbedManipulator,i=e.shouldRenderTracker,r=e.observerPosition,o=e.visible;if(!(0,d.Wi)(t)){var a=(0,d.pC)(n)?n:i&&(0,d.pC)(r)?this._targetTrackerManipulator:null;this.configuration.laserLine.enabled&&(0,d.pC)(a)&&o?(t.visible=!0,t.heightManifoldTarget=a.renderLocation,a!==this._observerManipulator?t.lineVerticalPlaneSegment=(0,fe.zk)(this._observerManipulator.renderLocation,a.renderLocation,je):t.lineVerticalPlaneSegment=null):(t.visible=!1,t.heightManifoldTarget=null,t.lineVerticalPlaneSegment=null)}}},{key:"_createVisualElements",value:function(){var e=this.configuration.laserLine;this._removeVisualElements(),this._laserlineVisualElement=new Ve.W({view:this.view,attached:!0,visible:this.visible,style:{glowColor:g.Z.toUnitRGB(e.glowColor),glowWidth:e.glowWidth,innerColor:g.Z.toUnitRGB(e.innerColor),innerWidth:e.innerWidth,globalAlpha:e.globalAlpha}})}},{key:"_removeVisualElements",value:function(){(0,d.pC)(this._laserlineVisualElement)&&(this._laserlineVisualElement.destroy(),this._laserlineVisualElement=null)}},{key:"_onObserverLocationChange",value:function(e){(0,d.Wi)(e)?this._observerManipulator.available=!1:(this._observerManipulator.metadata.intersection=null,this._observerManipulator.available=!0,this._observerManipulator.elevationAlignedLocation=e)}},{key:"_onTargetLocationChange",value:function(e,t){(0,d.pC)(e)?(t.elevationAlignedLocation=e,t!==this._targetTrackerManipulator&&(t.available=!0)):t.available=!1}},{key:"_addPointFromClickEvent",value:function(e){var t=this._intersector.getScreenPointIntersection(e);if(!(0,d.Wi)(t)&&!(0,d.Wi)(t.mapPoint))if((0,d.pC)(this.analysis.observer)&&(0,d.pC)(this.analysis.observer.position)){this._clearCursorTracker();var n=new he.Z;this._updateFromIntersection(n,t),this.analysis.targets.add(n)}else{var i=new pe.Z;this._updateFromIntersection(i,t),this.analysis.observer=i}}},{key:"_clickHandler",value:function(e){this.active&&e.button!==He.t.Right&&(this._addPointFromClickEvent((0,Ae.vT)(e)),e.stopPropagation())}},{key:"_doubleClickHandler",value:function(e){this.active&&e.button!==He.t.Right&&(this.stop(),e.stopPropagation())}},{key:"_keyDownHandler",value:function(e){this.active&&"Escape"===e.key&&(this.stop(),e.stopPropagation())}},{key:"_pointerMoveHandler",value:function(e){if(!this.hasGrabbedManipulators&&(this._latestPointerMovePointerType=e.pointerType,this._updateLaserLineRenderer(),this._showTracker&&!(0,d.Wi)(this.analysis.observer)&&!(0,d.Wi)(this.analysis.observer.position))){var t=(0,Ae.vT)(e),n=this._intersector.getScreenPointIntersection(t);(0,d.pC)(n)&&(0,d.pC)(n.mapPoint)&&((0,d.Wi)(this.analysisViewData.cursorTarget)&&(this.analysisViewData.cursorTarget=new he.Z),this._updateFromIntersection(this.analysisViewData.cursorTarget,n),this._updateLaserLineRenderer())}}},{key:"_updateFromIntersection",value:function(e,t){if((0,d.Wi)(t.mapPoint))return e.position=null,e.elevationInfo=null,void(e.feature=null);switch(t.type){case q.q7.OBJECT:if((0,d.pC)(t.graphic)){var n=t.graphic,i=(0,A.RL)(n);"on-the-ground"===i.mode&&(i.mode="relative-to-ground",i.offset=0),e.elevationInfo=new ye.Z(i),e.feature=n}else e.elevationInfo=null,e.feature=null;break;case q.q7.TERRAIN:case q.q7.I3S:e.elevationInfo=new ye.Z({mode:"on-the-ground"}),e.feature=null;break;default:e.elevationInfo=null,e.feature=null}var r=t.mapPoint.clone();r.z=(0,A.vQ)(this.view,r,{mode:"absolute-height",offset:0},e.elevationInfo),e.position=r}},{key:"_manipulatorClick",value:function(e,t){if(!("observer"===e.metadata.type||e.grabbing||e.dragging||t.button!==He.t.Right||this.analysis.targets.length<=1)){var n=e.metadata.target;this.analysis.targets.remove(n),t.stopPropagation()}}},{key:"testInfo",get:function(){return{laserLineVisualElement:this._laserlineVisualElement}}}]),n}(Re.f);(0,s._)([(0,v.Cb)({constructOnly:!0})],Me.prototype,"view",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],Me.prototype,"analysis",void 0),(0,s._)([(0,v.Cb)({readOnly:!0})],Me.prototype,"state",null),(0,s._)([(0,v.Cb)({readOnly:!0})],Me.prototype,"cursor",null),(0,s._)([(0,v.Cb)()],Me.prototype,"removeIncompleteOnCancel",void 0),(0,s._)([(0,v.Cb)({readOnly:!0})],Me.prototype,"updating",null),(0,s._)([(0,v.Cb)({type:me})],Me.prototype,"configuration",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],Me.prototype,"analysisViewData",void 0),(0,s._)([(0,v.Cb)({readOnly:!0})],Me.prototype,"_showTracker",null),(0,s._)([(0,v.Cb)()],Me.prototype,"_latestPointerMovePointerType",void 0),(0,s._)([(0,v.Cb)()],Me.prototype,"_shouldRenderTracker",null),(0,s._)([(0,v.Cb)()],Me.prototype,"_laserlineVisualElement",void 0),(0,s._)([(0,v.Cb)()],Me.prototype,"_grabbedManipulator",void 0),Me=(0,s._)([(0,h.j)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool")],Me);var je=(0,fe.Ue)(),De=n(81949),We=function(){function e(t,n,r,o){(0,i.Z)(this,e),this.visibleLineVisualElement=t,this.occludedLineVisualElement=n,this.undefinedLineVisualElement=r,this.targetVisualElement=o}return(0,r.Z)(e,[{key:"destroy",value:function(){this.visibleLineVisualElement.destroy(),this.occludedLineVisualElement.destroy(),this.undefinedLineVisualElement.destroy(),this.targetVisualElement.destroy()}}]),e}(),ze=n(33837),Fe=n(66730),xe=n(56529),Ne=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._lineOfSightVisualElements=new Array,r._computationHandles=new k.Z,r._updatingHandles=new L.t,r}return(0,r.Z)(n,[{key:"initialize",value:function(){this.addHandles(this._connectComputations()),this._createObserverVisualization()}},{key:"destroy",value:function(){this._updatingHandles=(0,d.SC)(this._updatingHandles),this._computationHandles=(0,d.SC)(this._computationHandles),this._observerVisualElement=(0,d.SC)(this._observerVisualElement)}},{key:"visible",get:function(){return this.analysisViewData.visible}},{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"interactiveAndEditable",get:function(){return this.analysisViewData.interactive&&this.analysisViewData.editable}},{key:"test",get:function(){var e=this;return{disablePartialOcclusion:function(){var t,n=(0,m.Z)(e._lineOfSightVisualElements);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.visibleLineVisualElement.renderOccluded=xe.yD.Occlude,i.occludedLineVisualElement.renderOccluded=xe.yD.Occlude,i.undefinedLineVisualElement.renderOccluded=xe.yD.Occlude}}catch(r){n.e(r)}finally{n.f()}},visualizations:this._lineOfSightVisualElements}}},{key:"_configuration",get:function(){return this.analysisViewData.configuration}},{key:"_createLineOfSightVisualization",value:function(){var e=this._configuration,t=this.view,n={view:t,attached:!0,width:e.outerWidth,innerWidth:e.innerWidth},i=g.Z.toUnitRGBA(e.visibleOuterColor),r=g.Z.toUnitRGBA(e.visibleInnerColor),o=g.Z.toUnitRGBA(e.occludedOuterColor),a=g.Z.toUnitRGBA(e.occludedInnerColor),s=g.Z.toUnitRGBA(e.undefinedOuterColor),l=g.Z.toUnitRGBA(e.undefinedInnerColor),u=new ze.r((0,ve.Z)((0,ve.Z)({},n),{},{color:i,innerColor:r})),c=new ze.r((0,ve.Z)((0,ve.Z)({},n),{},{color:o,innerColor:a})),d=new ze.r((0,ve.Z)((0,ve.Z)({},n),{},{color:s,innerColor:l})),v=new Fe.L((0,ve.Z)((0,ve.Z)({view:t,attached:!0},Ge),{},{size:8})),p=new We(u,c,d,v);return this._lineOfSightVisualElements.push(p),p}},{key:"_destroyLineOfSightVisualization",value:function(e){e.destroy(),this._lineOfSightVisualElements.splice(this._lineOfSightVisualElements.indexOf(e),1)}},{key:"_updateLineOfSightVisualization",value:function(e,t,n){var i=this._configuration,r=e.computationResult,o=e.inputPoints,a=r.start,s=r.end,l=r.intersection,u=r.isValid,c=r.isTargetVisible,v=o.observer,p=Je;p[12]=v[0],p[13]=v[1],p[14]=v[2];var h=(0,P.b)(Be,a,v),y=(0,P.b)(Ue,s,v),_=(0,P.b)(qe,l,v),b=t.visibleLineVisualElement,C=t.occludedLineVisualElement,m=t.undefinedLineVisualElement,w=t.targetVisualElement,Z=(0,d.Wi)(this.analysisViewData.elevationAlignedObserver)||(0,d.Wi)(e.elevationAlignedTargetLocation),k=this.visible&&!Z;b.visible=k,C.visible=k,m.visible=k,w.visible=k,w.attached=!n.interactiveAndEditable,k&&(b.geometry=null,C.geometry=null,m.geometry=null,w.geometry=e.elevationAlignedTargetLocation,u?c?(b.geometry=[[(0,f.d)(h),(0,f.d)(y)]],b.transform=p,b.color=g.Z.toUnitRGBA(i.visibleOuterColor),w.color=g.Z.toUnitRGBA(i.visibleInnerColor)):(b.geometry=[[(0,f.d)(h),(0,f.d)(_)]],b.transform=p,b.color=g.Z.toUnitRGBA(i.occludedOuterColor),C.geometry=[[(0,f.d)(_),(0,f.d)(y)]],C.transform=p,w.color=g.Z.toUnitRGBA(i.occludedInnerColor)):(m.geometry=[[(0,f.d)(h),(0,f.d)(y)]],m.transform=p,w.color=g.Z.toUnitRGBA(i.undefinedInnerColor)))}},{key:"_getLineOfSightVisualizationDependencies",value:function(e){var t=e.computationResult,n=this._configuration;return{computationResult:t,occludedOuterColor:n.occludedOuterColor,visibleOuterColor:n.visibleOuterColor,visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}}},{key:"_connectComputation",value:function(e){var t=this,n=this._computationHandles;if(!n.has(e)){var i=this._createLineOfSightVisualization();n.add([this._updatingHandles.add((function(){return t._getLineOfSightVisualizationDependencies(e)}),(function(n){return t._updateLineOfSightVisualization(e,i,n)}),{initial:!0,equals:function(){return!1}}),(0,O.kB)((function(){return t._destroyLineOfSightVisualization(i)}))],e)}}},{key:"_disconnectComputation",value:function(e){this._computationHandles.remove(e)}},{key:"_connectComputations",value:function(){var e=this;return this._updatingHandles.addOnCollectionChange((function(){return e.analysisViewData.computations}),(function(t){return e._onComputationsCollectionChange(t)}),{initial:!0,final:!0})}},{key:"_onComputationsCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,m.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(u){r.e(u)}finally{r.f()}var a,s=(0,m.Z)(n);try{for(s.s();!(a=s.n()).done;){var l=a.value;this._connectComputation(l)}}catch(u){s.e(u)}finally{s.f()}}},{key:"_createObserverVisualization",value:function(){var e=this,t=g.Z.toUnitRGBA(this._configuration.visibleInnerColor),n=new Fe.L((0,ve.Z)({view:this.view,attached:!1,color:t},Ge));this._observerVisualElement=n,this.addHandles(this._updatingHandles.add((function(){return{observer:e.analysisViewData.elevationAlignedObserver,interactiveAndEditable:e.interactiveAndEditable,visible:e.visible}}),(function(t){var i=t.observer,r=t.interactiveAndEditable,o=t.visible;(0,d.Wi)(i)||r||!o?n.attached=!1:(n.geometry=i,e._observerVisualElement.attached=!0)}),S.nn))}}]),n}(l.Z);(0,s._)([(0,v.Cb)({constructOnly:!0})],Ne.prototype,"analysis",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],Ne.prototype,"analysisViewData",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],Ne.prototype,"view",void 0),(0,s._)([(0,v.Cb)({readOnly:!0})],Ne.prototype,"visible",null),(0,s._)([(0,v.Cb)()],Ne.prototype,"updating",null),(0,s._)([(0,v.Cb)()],Ne.prototype,"interactiveAndEditable",null),(0,s._)([(0,v.Cb)()],Ne.prototype,"test",null),(0,s._)([(0,v.Cb)()],Ne.prototype,"_configuration",null),Ne=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],Ne);var Ge={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},Be=(0,f.c)(),Ue=(0,f.c)(),qe=(0,f.c)(),Je=(0,De.c)(),Xe=n(70209),Ye=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).type="line-of-sight-view-3d",r.analysis=null,r.tool=null,r.computations=new u.Z,r.elevationAlignedObserver=null,r.configuration=new _,r.observerEngineLocation=(0,f.c)(),r.cursorTarget=null,r.editable=!0,r}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.view,n=this.analysis;this._analysisController=new ae({analysis:n,analysisViewData:this,view:t}),this._analysisVisualization=new Ne({analysis:n,analysisViewData:this,view:t}),this.addHandles([this._analysisController.on("result-changed",(function(t){t.target!==e.cursorTarget&&e.emit("result-changed",t)})),(0,Xe.Lp)(this,Me)])}},{key:"destroy",value:function(){(0,Xe.Yq)(this),this._analysisController=(0,d.SC)(this._analysisController),this._analysisVisualization=(0,d.SC)(this._analysisVisualization)}},{key:"results",get:function(){return this.computations.map((function(e){return e.result}))}},{key:"priority",get:function(){return this._analysisController.priority},set:function(e){this._analysisController.priority=e}},{key:"updating",get:function(){return(0,d.pC)(this._analysisController)&&this._analysisController.updating||(0,d.pC)(this._analysisVisualization)&&this._analysisVisualization.updating}},{key:"getResultForTarget",value:function(e){var t=this.computations.find((function(t){return t.target===e}));return(0,d.yw)(t,(function(e){return e.result}))}},{key:"testInfo",get:function(){return{visualization:this._analysisVisualization,controller:this._analysisController}}}]),n}((0,y.p)(c.Z.EventedMixin(l.Z)));(0,s._)([(0,v.Cb)({readOnly:!0})],Ye.prototype,"type",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0,nonNullable:!0})],Ye.prototype,"analysis",void 0),(0,s._)([(0,v.Cb)()],Ye.prototype,"tool",void 0),(0,s._)([(0,v.Cb)({readOnly:!0})],Ye.prototype,"results",null),(0,s._)([(0,v.Cb)()],Ye.prototype,"priority",null),(0,s._)([(0,v.Cb)()],Ye.prototype,"computations",void 0),(0,s._)([(0,v.Cb)()],Ye.prototype,"elevationAlignedObserver",void 0),(0,s._)([(0,v.Cb)()],Ye.prototype,"configuration",void 0),(0,s._)([(0,v.Cb)()],Ye.prototype,"observerEngineLocation",void 0),(0,s._)([(0,v.Cb)()],Ye.prototype,"cursorTarget",void 0),(0,s._)([(0,v.Cb)()],Ye.prototype,"updating",null),(0,s._)([(0,v.Cb)()],Ye.prototype,"editable",void 0),(0,s._)([(0,v.Cb)()],Ye.prototype,"_analysisController",void 0),(0,s._)([(0,v.Cb)()],Ye.prototype,"_analysisVisualization",void 0);var Qe=Ye=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSightAnalysisView3D")],Ye)},81655:function(e,t,n){n.d(t,{c:function(){return o},t:function(){return a}});var i=n(92026),r=n(74509);function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,r.RL)(e);return"on-the-ground"!==t.mode&&!((0,i.Wi)(e.geometry)||!e.geometry.hasZ)}function a(e,t){var n=null,r=e.events.on("grab-changed",(function(r){(0,i.pC)(n)&&(n.remove(),n=null),"start"===r.action?(n=e.disableDisplay(),t&&t(r)):t&&t(r)}));return{remove:function(){(0,i.pC)(n)&&n.remove(),r.remove()}}}},70209:function(e,t,n){n.d(t,{Er:function(){return u},Lp:function(){return c},Yq:function(){return d}});var i=n(74165),r=n(15861),o=n(14921),a=n(92026),s=n(66978),l=n(94172);function u(e,t){e.interactive=!0;var n=e.tool,u=e.view;u.activeTool=n;var c=(0,s.fu)(t,(function(){u.activeTool===n&&(u.activeTool=null)}));return(0,o.vr)(function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.N1)((function(){return(0,a.Wi)(n)||!n.active}),t);case 2:c=(0,a.hw)(c);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t)}function c(e,t){return(0,l.YP)((function(){return e.interactive}),(function(){return function(e,t){e.interactive?function(e,t){d(e);var n=e.view,i=e.analysis,r=new t({view:n,analysis:i,analysisViewData:e});e.tool=r,n.tools.add(r)}(e,t):d(e)}(e,t)}),l.tX)}function d(e){var t=e.view,n=e.tool;(0,a.Wi)(n)||(t.tools.remove(n),e.tool=null)}},86509:function(e,t,n){n.d(t,{f:function(){return d}});var i=n(15671),r=n(43144),o=n(60136),a=n(92572),s=n(27366),l=n(94172),u=n(49861),c=(n(25243),n(63780),n(69912)),d=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,e)}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles((0,l.YP)((function(){return e.analysisViewData.visible}),(function(t){return e.visible=t}),l.tX))}},{key:"deactivate",value:function(){this.onDeactivate(),this.created||this.analysis.clear()}},{key:"resetCreated",value:function(){this._set("created",!1)}}]),n}(n(29919).m);(0,s._)([(0,u.Cb)({constructOnly:!0})],d.prototype,"analysis",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"analysisViewData",void 0),d=(0,s._)([(0,c.j)("esri.views.interactive.AnalysisToolBase")],d)}}]);
//# sourceMappingURL=40957.f2baf7cb.chunk.js.map