"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[44288],{44288:function(e,t,r){r.d(t,{e:function(){return _},f:function(){return N},l:function(){return K},p:function(){return v},s:function(){return y},u:function(){return A}});var i=r(93433),n=r(74165),a=r(15861),s=r(76880),o=r(48103),u=r(12969),c=r(13115),p=r(63326),d=r(20823),l=r(25212),m=r(60415),f=r(8402),h=r(29690);function y(e){return(e=e.toLowerCase()).includes("//")&&(e=e.split("//")[1]),e}function b(e){return"".concat(e||"https://hub.arcgis.com","/api/v3/domains")}function g(e){var t={},r=(0,c.g)(e,"authentication.token");return r&&(t.Authorization=r),t}function v(e){var t=e.split(" AS "),r=t[0],i=t[1]||r.split(".").reverse()[0];return{enrichment:r.split(".")[0],path:r,prop:i}}function w(e){return k.apply(this,arguments)}function k(){return(k=(0,a.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.status>=200&&t.status<300)){e.next=4;break}return e.abrupt("return",t.json());case 4:return e.abrupt("return",t.json().then((function(e){if(e.error)throw new Error("".concat(e.error.title," :: ").concat(e.error.detail," :: ").concat(t.status));throw new Error("Got ".concat(t.status," ").concat(t.statusText))})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t){if(t.isPortal)throw new Error("addDomain is not available in ArcGIS Enterprise. Instead, edit the hubdomain typekeyword on the item");var r=g(t);r["Content-Type"]="application/json";var i="".concat(b(t.hubApiUrl)),n=e.siteTitle;return"number"===typeof n&&(e.siteTitle=n.toString()),fetch(i,{method:"POST",headers:r,mode:"cors",body:JSON.stringify(e)}).then(w)}function K(e,t){if(t.isPortal)return function(e,t){var r=e;e.indexOf("#/")>-1&&(r=e.split("#/")[1]);var i="hubsubdomain|".concat(r),n=Object.assign({q:"typekeywords: ".concat(i)},t);return(0,l.s)(n).then((function(e){return e.results.filter((function(e){return(0,s.i)(e.typeKeywords,i)}))[0]})).then((function(e){if(!e)throw new Error("site not found");return{hostname:e.url,siteId:e.id}}))}(e,t);var r="".concat(b(t.hubApiUrl),"/").concat(e),i=g(t);return fetch(r,{method:"GET",headers:i,mode:"cors"}).then(w)}function I(e,t){if(t.isPortal)throw new Error("removeDomain is not available in ArcGIS Enterprise. Instead, edit the hubdomain typekeyword on the item");var r=g(t);r["Content-Type"]="application/json";var i="".concat(b(t.hubApiUrl),"/").concat(e);return fetch(i,{method:"DELETE",headers:r,mode:"cors"}).then(w)}function S(e,t){return j.apply(this,arguments)}function j(){return(j=(0,a.Z)((0,n.Z)().mark((function e(t,r){var i,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.isPortal){e.next=2;break}throw new Error("removeDomainByHostname is not available in ArcGIS Enterprise. Instead, edit the hubdomain typekeyword on the item");case 2:return e.prev=2,e.next=5,K(t,r);case 5:if(i=e.sent,!(a=(0,c.g)(i,"id"))){e.next=10;break}return e.next=10,I(a,r);case 10:e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(2),new Error("Error removing domain entry for ".concat(t,": ").concat(e.t0));case 15:case"end":return e.stop()}}),e,null,[[2,12]])})))).apply(this,arguments)}function x(e){if((0,c.g)(e,"item.properties.schemaVersion")>=1.5)return e;var t=(0,u.c)(e),r=t.data.values.dcatConfig;return t.data.feeds={},r&&(t.data.feeds.dcatUS11=function(e){var t=JSON.stringify(e);return Object.keys(T).forEach((function(e){var r=T[e];t=t.split(e).join(r)})),JSON.parse(t)}(r)),t.item.properties.schemaVersion=1.5,t}var T={"{{default.name}}":"{{name}}","{{default.description}}":"{{description}}","{{item.tags}}":"{{tags}}","{{item.created:toISO}}":"{{created:toISO}}","{{item.modified:toISO}}":"{{modified:toISO}}","{{default.source.source}}":"{{source}}","{{item.owner}}":"{{owner}}","{{org.portalProperties.links.contactUs.url}}":"{{orgContactEmail}}","{{org.name}}":"{{orgName}}","{{item.categories}}":"{{categories}}","{{item.licenseInfo}}":"{{licenseInfo}}","{{item.modified}}":"{{modified}}","{{enrichments.categories}}":"{{categories}}","{{default.id}}":"{{id}}","{{item.licenseInfo || No License}}":"{{licenseInfo || No License}}","{{org.portalProperties.links.contactUs.url || mailto:data@tempe.gov}}":"{{orgContactEmail || mailto:data@tempe.gov}}","{{default.description || No Description}}":"{{description || No Description}}","{{item.id}}":"{{id}}"};function D(e){return 1.5===(0,c.g)(e,"item.properties.schemaVersion")?e:e=x(e=function(e){if((0,c.g)(e,"item.properties.schemaVersion")>=1.4)return e;var t=(0,u.c)(e),r=(0,c.g)(t,"data.values.gacode");return t.data.values.telemetry={consentNotice:{isTheme:!0,consentText:"",policyURL:""},customAnalytics:{ga:{customerTracker:{enabled:Boolean(r),id:r}}}},function(e,t){if("object"===typeof e&&null!==e&&"string"===typeof t){for(var r=t.split("."),i=0;i<r.length-1;i++){if(!e.hasOwnProperty(r[i]))return;e=e[r[i]]}delete e[r[r.length-1]]}}(t,"data.values.gacode"),(0,d.s)("item.properties.schemaVersion",1.4,t),t}(e=function(e){if((0,c.g)(e,"item.properties.schemaVersion")>=1.3)return e;var t=(0,u.c)(e),r=(0,c.g)(t,"data.catalog.groups")||[];return t.data.catalog.groups=r.filter(p.i),t.item.properties.schemaVersion=1.3,t}(e=function(e){if((0,c.g)(e,"item.properties.schemaVersion")>=1.2)return e;var t=(0,u.c)(e),r=(0,c.g)(t,"data.catalog")||{};return(0,c.g)(t,"data.values.groups")&&(r.groups=(0,u.c)(t.data.values.groups),delete t.data.values.groups),t.data.catalog=r,t.item.properties.schemaVersion=1.2,t}(e=function(e){if((0,c.g)(e,"item.properties.schemaVersion")>=1.1)return e;var t=(0,u.c)(e);return["subdomain","defaultHostname","internalUrl","customHostname","externalUrl"].forEach((function(e){t.data.values[e]&&"string"===typeof t.data.values[e]&&(t.data.values[e]=t.data.values[e].toLowerCase())})),t.item.properties.schemaVersion=1.1,t}(e=function(e){if((0,c.g)(e,"item.properties.schemaVersion")>=1)return e;var t=(0,u.c)(e);if(["groupId","title"].forEach((function(e){delete t.data.values[e]})),t.item.properties||(t.item.properties={}),t.item.properties.schemaVersion=1,t.data.values.groups&&Array.isArray(t.data.values.groups)){var r=t.data.values.groups.map((function(e){return"object"===typeof e?e.id:e})).filter((function(e){return!!e}));t.data.values.groups=r}return t}(e))))))}function Z(e,t){return(0,o.c)(e,t).then(D)}function O(e,t){var r;if((0,p.i)(e))r=Z(e,t);else{var i=e;r=K(i=(i=y(i)).split("/")[0],t).then((function(e){return Z(e.siteId,t)}))}return r}function V(e,t,r){return U.apply(this,arguments)}function U(){return(U=(0,a.Z)((0,n.Z)().mark((function e(t,r,i){var a,s,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={clientKey:t.data.values.clientId,orgId:i.portalSelf.id,orgTitle:i.portalSelf.name,orgKey:i.portalSelf.urlKey,siteId:t.item.id,siteTitle:t.item.title,sslOnly:!0},s={remove:[],add:[]},["customHostname","defaultHostname"].forEach((function(e){var i=(0,c.g)(r,"data.values.".concat(e)),n=(0,c.g)(t,"data.values.".concat(e));n!==i&&(s.remove.push(i),s.add.push(n))})),o=[],s.add.map((function(e){var t=Object.assign({hostname:e},a);o.push(E(t,i))})),s.remove.map((function(e){o.push(S(e,i))})),e.abrupt("return",Promise.all(o));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(){var e=(0,o.g)();e.push({objectKey:"catalog",modelKey:"data.catalog"}),e.push({objectKey:"feeds",modelKey:"data.feeds"}),e.push({objectKey:"permissions",modelKey:"data.permissions"}),e.push({objectKey:"capabilities",modelKey:"data.capabilities"});return["pages","theme","subdomain","defaultHostname","customHostname","clientId","defaultExtent","map","telemetry","headerSass","headContent","layout"].forEach((function(t){e.push({objectKey:t,modelKey:"data.values.".concat(t)})})),e.push({objectKey:"slug",modelKey:"item.properties.slug"}),e.push({objectKey:"classicCapabilities",modelKey:"data.values.capabilities"}),e.push({objectKey:"capabilities",modelKey:"data.settings.capabilities"}),e.push({objectKey:"orgUrlKey",modelKey:"item.properties.orgUrlKey"}),e.push({objectKey:"name",modelKey:"item.title"}),e}var H={item:{title:"No Title Provided",description:"No Description Provided",snippet:"",tags:[],typeKeywords:["Hub Site","hubSite","DELETEMESITE"],properties:{slug:"",orgUrlKey:"",defaultHostname:"",customHostname:"",clientId:"",subdomain:"",schemaVersion:1.5},url:""},data:{catalog:{groups:[]},feeds:{},values:{title:"",defaultHostname:"",customHostname:"",subdomain:"",faviconUrl:"",uiVersion:"2.4",clientId:"",map:{basemaps:{}},defaultExtent:{},pages:[],theme:{},layout:{sections:[],header:{component:{name:"site-header",settings:{fullWidth:!1,iframeHeight:"150px",iframeUrl:"",links:[],logoUrl:"",title:"default site",markdown:"",headerType:"default",schemaVersion:3,showLogo:!0,showTitle:!0,logo:{display:{},state:"valid"},shortTitle:"",menuLinks:[],socialLinks:{facebook:{},twitter:{},instagram:{},youtube:{}}}},showEditor:!1},footer:{component:{name:"site-footer",settings:{footerType:"none",markdown:"",schemaVersion:2.1}},showEditor:!1}},contentViews:{sidePanelOpen:{app:!0,map:!0,dataset:!0,document:!0,feedback:!0}}}}};function A(e,t){return C.apply(this,arguments)}function C(){return(C=(0,a.Z)((0,n.Z)().mark((function e(t,r){var i,a,s,c,p,d;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new o.P(P()),a=i.objectToModel(t,(0,u.c)(H)),e.next=4,(0,o.c)(t.id,r);case 4:return s=e.sent,e.next=7,V(a,s,r);case 7:return a.item.properties.slug!==s.item.properties.slug&&(a.item.typeKeywords=(0,o.s)(a.item.typeKeywords,a.item.properties.slug)),c=i.objectToModel(t,s),e.next=11,(0,o.d)(c,r);case 11:return p=e.sent,d=i.modelToObject(p,t),e.abrupt("return",d);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t){return L.apply(this,arguments)}function L(){return(L=(0,a.Z)((0,n.Z)().mark((function e(t,r){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t,r);case 2:return i=e.sent,e.abrupt("return",G(i,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e,t){var r=function(e){var t=(0,u.c)(e);return t.data.permissions=t.data.permissions||[],[{prop:"item.properties.contentGroupId",type:"group",permissions:["hub:project:create"]},{prop:"item.owner",type:"user",permissions:["hub:site:delete"]}].forEach((function(e){var r=(0,c.g)(t,e.prop);r&&e.permissions.forEach((function(i){t.data.permissions.find((function(e){return e.permission===i&&e.collaborationId===r}))||t.data.permissions.push({permission:i,collaborationType:e.type,collaborationId:r})}))})),t}(e);return function(e,t,r){var i,n;return r.authentication&&(n=r.authentication.token),t.thumbnailUrl=(0,h.a)(e.item,r,n),t.createdDate=new Date(e.item.created),t.createdDateSource="item.created",t.updatedDate=new Date(e.item.modified),t.updatedDateSource="item.modified",t.capabilities=(0,o.p)((null===(i=e.data.settings)||void 0===i?void 0:i.capabilities)||{},f.c),t}(e,new o.P(P()).modelToObject(r,{}),t)}function _(e,t,r){return J.apply(this,arguments)}function J(){return(J=(0,a.Z)((0,n.Z)().mark((function e(t,r,a){var o,p,d,l;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o={access:t.access,id:t.id,type:t.type,name:t.title,owner:t.owner,typeKeywords:t.typeKeywords,tags:t.tags,categories:t.categories,summary:t.snippet||t.description,createdDate:new Date(t.created),createdDateSource:"item.created",updatedDate:new Date(t.modified),updatedDateSource:"item.modified",family:(0,s.g)(t.type),links:{self:"not-implemented",siteRelative:"not-implemented",thumbnail:"not-implemented"}},r=[].concat([],(0,i.Z)(r)).filter(u.u),p=r.map(v),d=(0,f.m)("enrichment",p).filter(u.u),l={},!d.length){e.next=10;break}return e.next=9,(0,m.f)(t,d,a);case 9:l=e.sent;case 10:return p.forEach((function(e){o[e.prop]=(0,c.g)(l,e.path)})),o.links.thumbnail=(0,h.a)(t,a),o.links.self=t.url,o.links.siteRelative=(0,s.m)(o.type,o.id,t.typeKeywords),e.abrupt("return",o);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},8402:function(e,t,r){function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.map((function(t){return t[e]}))}r.d(t,{S:function(){return o},a:function(){return s},b:function(){return a},c:function(){return n},m:function(){return i}});var n={overview:!0,details:!0,settings:!0},a=[{entity:"site",capability:"overview",permissions:["hub:site:view"]},{entity:"site",capability:"details",permissions:["hub:site:edit"]},{entity:"site",capability:"settings",permissions:["hub:site:edit"]}],s=["hub:site:create","hub:site:delete","hub:site:edit","hub:site:view"],o=[{permission:"hub:site:create",subsystems:["sites"],authenticated:!0,privileges:["portal:user:createItem"],licenses:["hub-basic","hub-premium","enterprise-sites"]},{permission:"hub:site:view",subsystems:["sites"],authenticated:!1,licenses:["hub-basic","hub-premium","enterprise-sites"]},{permission:"hub:site:delete",subsystems:["sites"],authenticated:!0,licenses:["hub-basic","hub-premium","enterprise-sites"],entityOwner:!0},{permission:"hub:site:edit",entityEdit:!0,subsystems:["sites"],authenticated:!0,licenses:["hub-basic","hub-premium","enterprise-sites"]}]}}]);
//# sourceMappingURL=44288.6dd3b491.chunk.js.map