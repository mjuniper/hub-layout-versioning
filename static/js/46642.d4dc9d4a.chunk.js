"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[46642,22564,33751],{22564:function(e,t,r){r.d(t,{Hy:function(){return b},OF:function(){return _},TD:function(){return g},Tu:function(){return C},VO:function(){return Z},aV:function(){return p},kq:function(){return x},rH:function(){return a}});var i,n,a,s=r(97326),o=r(43144),u=r(15671),l=r(60136),h=r(92572),d=r(28664),c=r(4942);!function(e){e.AsyncNotEnabled="AsyncNotEnabled",e.ModulesNotSupported="ModulesNotSupported",e.CircularModules="CircularModules",e.NeverReach="NeverReach",e.UnsupportedHashType="UnsupportedHashType",e.InvalidParameter="InvalidParameter",e.UnexpectedToken="UnexpectedToken",e.Unrecognised="Unrecognised",e.UnrecognisedType="UnrecognisedType",e.MaximumCallDepth="MaximumCallDepth",e.BooleanConditionRequired="BooleanConditionRequired",e.TypeNotAllowedInFeature="TypeNotAllowedInFeature",e.KeyMustBeString="KeyMustBeString",e.WrongNumberOfParameters="WrongNumberOfParameters",e.CallNonFunction="CallNonFunction",e.NoFunctionInTemplateLiteral="NoFunctionInTemplateLiteral",e.NoFunctionInDictionary="NoFunctionInDictionary",e.NoFunctionInArray="NoFunctionInArray",e.AssignModuleFunction="AssignModuleFunction",e.LogicExpressionOrAnd="LogicExpressionOrAnd",e.LogicalExpressionOnlyBoolean="LogicalExpressionOnlyBoolean",e.FuncionNotFound="FunctionNotFound",e.InvalidMemberAccessKey="InvalidMemberAccessKey",e.UnsupportedUnaryOperator="UnsupportUnaryOperator",e.InvalidIdentifier="InvalidIdentifier",e.MemberOfNull="MemberOfNull",e.UnsupportedOperator="UnsupportedOperator",e.Cancelled="Cancelled",e.ModuleAccessorMustBeString="ModuleAccessorMustBeString",e.ModuleExportNotFound="ModuleExportNotFound",e.Immutable="Immutable",e.OutOfBounds="OutOfBounds",e.IllegalResult="IllegalResult",e.FieldNotFound="FieldNotFound",e.PortalRequired="PortalRequired",e.LogicError="LogicError",e.ArrayAccessorMustBeNumber="ArrayAccessMustBeNumber",e.KeyAccessorMustBeString="KeyAccessorMustBeString",e.WrongSpatialReference="WrongSpatialReference"}(a||(a={}));var f=(i={},(0,c.Z)(i,a.TypeNotAllowedInFeature,"Feature attributes only support dates, numbers, strings, guids."),(0,c.Z)(i,a.LogicError,"Logic error - {reason}"),(0,c.Z)(i,a.NeverReach,"Encountered unreachable logic"),(0,c.Z)(i,a.AsyncNotEnabled,"Async Arcade must be enabled for this script"),(0,c.Z)(i,a.ModuleAccessorMustBeString,"Module accessor must be a string"),(0,c.Z)(i,a.ModuleExportNotFound,"Module has no export with provided identifier"),(0,c.Z)(i,a.ModulesNotSupported,"Current profile does not support modules"),(0,c.Z)(i,a.ArrayAccessorMustBeNumber,"Array accessor must be a number"),(0,c.Z)(i,a.FuncionNotFound,"Function not found"),(0,c.Z)(i,a.FieldNotFound,"Key not found - {key}"),(0,c.Z)(i,a.CircularModules,"Circular module dependencies are not allowed"),(0,c.Z)(i,a.Cancelled,"Execution cancelled"),(0,c.Z)(i,a.UnsupportedHashType,"Type not supported in hash function"),(0,c.Z)(i,a.IllegalResult,"Value is not a supported return type"),(0,c.Z)(i,a.PortalRequired,"Portal is required"),(0,c.Z)(i,a.InvalidParameter,"Invalid parameter"),(0,c.Z)(i,a.WrongNumberOfParameters,"Call with wrong number of parameters"),(0,c.Z)(i,a.Unrecognised,"Unrecognised code structure"),(0,c.Z)(i,a.UnrecognisedType,"Unrecognised type"),(0,c.Z)(i,a.WrongSpatialReference,"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference"),(0,c.Z)(i,a.BooleanConditionRequired,"Conditions must use booleans"),(0,c.Z)(i,a.NoFunctionInDictionary,"Dictionaries cannot contain functions."),(0,c.Z)(i,a.NoFunctionInArray,"Arrays cannot contain functions."),(0,c.Z)(i,a.NoFunctionInTemplateLiteral,"Template Literals do not expect functions by value."),(0,c.Z)(i,a.KeyAccessorMustBeString,"Accessor must be a string"),(0,c.Z)(i,a.KeyMustBeString,"Object keys must be a string"),(0,c.Z)(i,a.Immutable,"Object is immutable"),(0,c.Z)(i,a.InvalidParameter,"Invalid parameter"),(0,c.Z)(i,a.UnexpectedToken,"Unexpected token"),(0,c.Z)(i,a.MemberOfNull,"Cannot access property of null object"),(0,c.Z)(i,a.MaximumCallDepth,"Exceeded maximum function depth"),(0,c.Z)(i,a.OutOfBounds,"Out of bounds"),(0,c.Z)(i,a.InvalidIdentifier,"Identifier not recognised"),(0,c.Z)(i,a.FuncionNotFound,"Function not found"),(0,c.Z)(i,a.CallNonFunction,"Expression is not a function"),(0,c.Z)(i,a.InvalidMemberAccessKey,"Cannot access value using a key of this type"),(0,c.Z)(i,a.AssignModuleFunction,"Cannot assign function to module variable"),(0,c.Z)(i,a.UnsupportedUnaryOperator,"Unsupported unary operator"),(0,c.Z)(i,a.UnsupportedOperator,"Unsupported operator"),(0,c.Z)(i,a.LogicalExpressionOnlyBoolean,"Logical expressions must be boolean"),(0,c.Z)(i,a.LogicExpressionOrAnd,"Logical expression can only be combined with || or &&"),i),v=function(e){(0,l.Z)(r,e);var t=(0,h.Z)(r);function r(){(0,u.Z)(this,r);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t.call.apply(t,[this].concat(i))}return(0,o.Z)(r)}((0,d.Z)(Error)),y=function(e){(0,l.Z)(r,e);var t=(0,h.Z)(r);function r(e,i){var n;return(0,u.Z)(this,r),(n=t.call(this,m(i)+e.message,{cause:e})).loc=null,Error.captureStackTrace&&Error.captureStackTrace((0,s.Z)(n),r),i&&i.loc&&(n.loc=i.loc),n}return(0,o.Z)(r)}(v),p=function(e){(0,l.Z)(r,e);var t=(0,h.Z)(r);function r(e,i,n,a){var o;return(0,u.Z)(this,r),(o=t.call(this,"Execution error - "+m(n)+b(f[i],a))).loc=null,o.declaredRootClass="esri.arcade.arcadeexecutionerror",Error.captureStackTrace&&Error.captureStackTrace((0,s.Z)(o),r),n&&n.loc&&(o.loc=n.loc),o}return(0,o.Z)(r)}((0,d.Z)(Error));function m(e){var t,r;return e&&e.loc?"Line : ".concat(null===(t=e.loc.start)||void 0===t?void 0:t.line,", ").concat(null===(r=e.loc.start)||void 0===r?void 0:r.column,": "):""}var g,_=function(e){(0,l.Z)(r,e);var t=(0,h.Z)(r);function r(e,i,n,a){var o;return(0,u.Z)(this,r),(o=t.call(this,"Compilation error - "+m(n)+b(f[i],a))).loc=null,o.declaredRootClass="esri.arcade.arcadecompilationerror",Error.captureStackTrace&&Error.captureStackTrace((0,s.Z)(o),r),n&&n.loc&&(o.loc=n.loc),o}return(0,o.Z)(r)}((0,d.Z)(Error)),x=function(e){(0,l.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,u.Z)(this,r),(e=t.call(this,"Uncompilable code structures")).declaredRootClass="esri.arcade.arcadeuncompilableerror",Error.captureStackTrace&&Error.captureStackTrace((0,s.Z)(e),r),e}return(0,o.Z)(r)}((0,d.Z)(Error));function b(e,t){try{if(!t)return e;for(var r in t){var i=t[r];i||(i=""),e=e.replace("{"+r+"}",t[r])}}catch(v){}return e}function Z(e,t,r){return"esri.arcade.arcadeexecutionerror"===r.declaredRootClass||"esri.arcade.arcadecompilationerror"===r.declaredRootClass?null===r.loc&&t&&t.loc?new y(r,{cause:r}):r:("esri.arcade.featureset.support.featureseterror"===r.declaredRootClass||"esri.arcade.featureset.support.sqlerror"===r.declaredRootClass||r.declaredRootClass,t&&t.loc?new y(r,{cause:r}):r)}!function(e){e.UnrecognisedUri="UnrecognisedUri",e.UnsupportedUriProtocol="UnsupportedUriProtocol"}(g||(g={}));var k=(n={},(0,c.Z)(n,g.UnrecognisedUri,"Unrecognised uri - {uri}"),(0,c.Z)(n,g.UnsupportedUriProtocol,"Unrecognised uri protocol"),n),C=function(e){(0,l.Z)(r,e);var t=(0,h.Z)(r);function r(e,i){var n;return(0,u.Z)(this,r),(n=t.call(this,b(k[e],i))).declaredRootClass="esri.arcade.arcademoduleerror",Error.captureStackTrace&&Error.captureStackTrace((0,s.Z)(n),r),n}return(0,o.Z)(r)}((0,d.Z)(Error))},8229:function(e,t,r){function i(){return new Float32Array(3)}function n(e){var t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(e,t,r){var i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function s(e,t){return new Float32Array(e,t,3)}function o(){return i()}function u(){return a(1,1,1)}function l(){return a(1,0,0)}function h(){return a(0,1,0)}function d(){return a(0,0,1)}r.d(t,{a:function(){return s},b:function(){return n},c:function(){return i},f:function(){return a},z:function(){return o}});var c=o(),f=u(),v=l(),y=h(),p=d();Object.freeze(Object.defineProperty({__proto__:null,ONES:f,UNIT_X:v,UNIT_Y:y,UNIT_Z:p,ZEROS:c,clone:n,create:i,createView:s,fromValues:a,ones:u,unitX:l,unitY:h,unitZ:d,zeros:o},Symbol.toStringTag,{value:"Module"}))},40237:function(e,t,r){r.d(t,{N:function(){return a}});var i=r(43144),n=r(15671),a={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,r){var i=new s(e.getPointX(t),e.getPointY(t),r),n=e.hasZ(t),a=e.hasM(t);return n&&(i.z=e.getPointZ(t)),a&&(i.m=e.getPointM(t)),i},exportPolygon:function(e,t,r){return new o(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new u(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new l(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){var i=e.hasZ(t),n=e.hasM(t),a=new h(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(i){var s=e.getZExtent(t);a.zmin=s.vmin,a.zmax=s.vmax}if(n){var o=e.getMExtent(t);a.mmin=o.vmin,a.mmax=o.vmax}return a}};var s=(0,i.Z)((function e(t,r,i){(0,n.Z)(this,e),this.x=t,this.y=r,this.spatialReference=i,this.z=void 0,this.m=void 0}));var o=(0,i.Z)((function e(t,r,i,a){(0,n.Z)(this,e),this.rings=t,this.spatialReference=r,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),a&&(this.hasM=a)}));var u=(0,i.Z)((function e(t,r,i,a){(0,n.Z)(this,e),this.paths=t,this.spatialReference=r,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),a&&(this.hasM=a)}));var l=(0,i.Z)((function e(t,r,i,a){(0,n.Z)(this,e),this.points=t,this.spatialReference=r,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),a&&(this.hasM=a)}));var h=(0,i.Z)((function e(t,r,i,a,s){(0,n.Z)(this,e),this.xmin=t,this.ymin=r,this.xmax=i,this.ymax=a,this.spatialReference=s,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}))},47991:function(e,t,r){r.d(t,{SR:function(){return y},Ui:function(){return v}});var i=r(43144),n=r(15671),a=r(37762),s=r(29439),o=r(92026),u=r(65156),l=r(376),h=r(69662),d=r(77981),c=r(76335),f=r(92975);function v(e){return p(e,!0)}function y(e){return p(e,!1)}function p(e,t){if((0,o.Wi)(e))return null;var r=e.spatialReference,i=(0,f.C5)(r),n="toJSON"in e?e.toJSON():e;if(!i)return n;var a=(0,f.sS)(r)?102100:4326,s=c.UZ[a].maxX,u=c.UZ[a].minX;if((0,d.wp)(n))return g(n,s,u);if((0,d.aW)(n))return n.points=n.points.map((function(e){return g(e,s,u)})),n;if((0,d.YX)(n))return m(n,i);if((0,d.oU)(n)||(0,d.l9)(n)){var h=(0,l.$P)(C,n),v={xmin:h[0],ymin:h[1],xmax:h[2],ymax:h[3]},y=(0,c.XZ)(v.xmin,u)*(2*s),p=0===y?n:(0,c.Sy)(n,y);return v.xmin+=y,v.xmax+=y,v.xmax>s?Z(p,s,t):v.xmin<u?Z(p,u,t):p}return n}function m(e,t){if(!t)return e;var r=function(e,t){var r=[],i=e.ymin,n=e.ymax,a=e.xmin,o=e.xmax,u=e.xmax-e.xmin,l=(0,s.Z)(t.valid,2),h=l[0],d=l[1],c=_(e.xmin,t),f=c.x,v=c.frameId,y=_(e.xmax,t),p=y.x,m=y.frameId,g=f===p&&u>0;if(u>2*d){var b={xmin:a<o?f:p,ymin:i,xmax:d,ymax:n},Z={xmin:h,ymin:i,xmax:a<o?p:f,ymax:n},C={xmin:0,ymin:i,xmax:d,ymax:n},T={xmin:h,ymin:i,xmax:0,ymax:n},I=[],w=[];x(b,C)&&I.push(v),x(b,T)&&w.push(v),x(Z,C)&&I.push(m),x(Z,T)&&w.push(m);for(var F=v+1;F<m;F++)I.push(F),w.push(F);r.push(new k(b,[v]),new k(Z,[m]),new k(C,I),new k(T,w))}else f>p||g?r.push(new k({xmin:f,ymin:i,xmax:d,ymax:n},[v]),new k({xmin:h,ymin:i,xmax:p,ymax:n},[m])):r.push(new k({xmin:f,ymin:i,xmax:p,ymax:n},[v]));return r}(e,t).map((function(e){return e.extent}));return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map((function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}))}}function g(e,t,r){if(Array.isArray(e)){var i=e[0];if(i>t){var n=(0,c.XZ)(i,t);e[0]=i+n*(-2*t)}else if(i<r){var a=(0,c.XZ)(i,r);e[0]=i+a*(-2*r)}}else{var s=e.x;if(s>t){var o=(0,c.XZ)(s,t);e.x+=o*(-2*t)}else if(s<r){var u=(0,c.XZ)(s,r);e.x+=u*(-2*r)}}return e}function _(e,t){var r,i=(0,s.Z)(t.valid,2),n=i[0],a=i[1],o=2*a,u=0;return e>a?(e-=(r=Math.ceil(Math.abs(e-a)/o))*o,u=r):e<n&&(e+=(r=Math.ceil(Math.abs(e-n)/o))*o,u=-r),{x:e,frameId:u}}function x(e,t){var r=t.xmin,i=t.ymin,n=t.xmax,a=t.ymax;return b(e,r,i)&&b(e,r,a)&&b(e,n,a)&&b(e,n,i)}function b(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}function Z(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(0,d.l9)(e);if(i&&(0,h.Zy)(e),r)return(new T).cut(e,t);for(var n=i?e.rings:e.paths,s=i?4:2,o=n.length,u=-2*t,l=0;l<o;l++){var c=n[l];if(c&&c.length>=s){var f,v=[],y=(0,a.Z)(c);try{for(y.s();!(f=y.n()).done;){var p=f.value;v.push([p[0]+u,p[1]])}}catch(m){y.e(m)}finally{y.f()}n.push(v)}}return i?e.rings=n:e.paths=n,e}var k=(0,i.Z)((function e(t,r){(0,n.Z)(this,e),this.extent=t,this.frameIds=r})),C=(0,u.Ue)(),T=function(){function e(){(0,n.Z)(this,e),this._linesIn=[],this._linesOut=[]}return(0,i.Z)(e,[{key:"cut",value:function(e,t){var r;if(this._xCut=t,e.rings)this._closed=!0,r=e.rings,this._minPts=4;else{if(!e.paths)return null;this._closed=!1,r=e.paths,this._minPts=2}var i,n=(0,a.Z)(r);try{for(n.s();!(i=n.n()).done;){var s=i.value;if(s&&!(s.length<this._minPts)){var o,u=!0,l=(0,a.Z)(s);try{for(l.s();!(o=l.n()).done;){var h=o.value;u?(this.moveTo(h),u=!1):this.lineTo(h)}}catch(x){l.e(x)}finally{l.f()}this._closed&&this.close()}}}catch(x){n.e(x)}finally{n.f()}this._pushLineIn(),this._pushLineOut(),r=[];var d,c=(0,a.Z)(this._linesIn);try{for(c.s();!(d=c.n()).done;){var f=d.value;f&&f.length>=this._minPts&&r.push(f)}}catch(x){c.e(x)}finally{c.f()}var v,y=-2*this._xCut,p=(0,a.Z)(this._linesOut);try{for(p.s();!(v=p.n()).done;){var m=v.value;if(m&&m.length>=this._minPts){var g,_=(0,a.Z)(m);try{for(_.s();!(g=_.n()).done;){g.value[0]+=y}}catch(x){_.e(x)}finally{_.f()}r.push(m)}}}catch(x){p.e(x)}finally{p.f()}return this._closed?e.rings=r:e.paths=r,e}},{key:"moveTo",value:function(e){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(e[0]),this._moveTo(e[0],e[1],this._prevSide),this._prevPt=e,this._firstPt=e}},{key:"lineTo",value:function(e){var t=this._side(e[0]);if(t*this._prevSide==-1){var r=this._intersect(this._prevPt,e);this._lineTo(this._xCut,r,0),this._prevSide=0,this._lineTo(e[0],e[1],t)}else this._lineTo(e[0],e[1],t);this._prevSide=t,this._prevPt=e}},{key:"close",value:function(){var e=this._firstPt,t=this._prevPt;e[0]===t[0]&&e[1]===t[1]||this.lineTo(e),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}},{key:"_moveTo",value:function(e,t,r){this._closed?(this._lineIn.push([r<=0?e:this._xCut,t]),this._lineOut.push([r>=0?e:this._xCut,t])):(r<=0&&this._lineIn.push([e,t]),r>=0&&this._lineOut.push([e,t]))}},{key:"_lineTo",value:function(e,t,r){this._closed?(this._addPolyVertex(this._lineIn,r<=0?e:this._xCut,t),this._addPolyVertex(this._lineOut,r>=0?e:this._xCut,t)):r<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([e,t])):r>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([e,t])):this._prevSide<0?(this._lineIn.push([e,t]),this._lineOut.push([e,t])):this._prevSide>0&&(this._lineOut.push([e,t]),this._lineIn.push([e,t]))}},{key:"_addPolyVertex",value:function(e,t,r){var i=e.length;i>1&&e[i-1][0]===t&&e[i-2][0]===t?e[i-1][1]=r:e.push([t,r])}},{key:"_checkClosingPt",value:function(e){var t=e.length;t>3&&e[0][0]===this._xCut&&e[t-2][0]===this._xCut&&e[1][0]===this._xCut&&(e[0][1]=e[t-2][1],e.pop())}},{key:"_side",value:function(e){return e<this._xCut?-1:e>this._xCut?1:0}},{key:"_intersect",value:function(e,t){var r=(this._xCut-e[0])/(t[0]-e[0]);return e[1]+r*(t[1]-e[1])}},{key:"_pushLineIn",value:function(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}},{key:"_pushLineOut",value:function(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}]),e}()},85403:function(e,t,r){r.d(t,{Y:function(){return s}});var i=r(37762),n=r(92026);function a(e,t){return e?t?4:3:t?3:2}function s(e,t,r,s,l){if((0,n.Wi)(t)||!t.lengths.length)return null;var h="upperLeft"===(null===l||void 0===l?void 0:l.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);var d,c=e.coords,f=[],v=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],y=t.lengths,p=t.coords,m=a(r,s),g=0,_=(0,i.Z)(y);try{for(_.s();!(d=_.n()).done;){var x=d.value,b=o(v,p,g,x,r,s,h);b&&f.push(b),g+=x*m}}catch(C){_.e(C)}finally{_.f()}if(f.sort((function(e,t){var i=h*e[2]-h*t[2];return 0===i&&r&&(i=e[4]-t[4]),i})),f.length){var Z=6*f[0][2];c[0]=f[0][0]/Z,c[1]=f[0][1]/Z,r&&(Z=6*f[0][4],c[2]=0!==Z?f[0][3]/Z:0),(c[0]<v[0]||c[0]>v[1]||c[1]<v[2]||c[1]>v[3]||r&&(c[2]<v[4]||c[2]>v[5]))&&(c.length=0)}if(!c.length){var k=t.lengths[0]?u(p,0,y[0],r,s):null;if(!k)return null;c[0]=k[0],c[1]=k[1],r&&k.length>2&&(c[2]=k[2])}return e}function o(e,t,r,i,n,s){for(var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,u=a(n,s),l=r,h=r+u,d=0,c=0,f=0,v=0,y=0,p=0,m=i-1;p<m;p++,l+=u,h+=u){var g=t[l],_=t[l+1],x=t[l+2],b=t[h],Z=t[h+1],k=t[h+2],C=g*Z-b*_;v+=C,d+=(g+b)*C,c+=(_+Z)*C,n&&(f+=(x+k)*(C=g*k-b*x),y+=C),g<e[0]&&(e[0]=g),g>e[1]&&(e[1]=g),_<e[2]&&(e[2]=_),_>e[3]&&(e[3]=_),n&&(x<e[4]&&(e[4]=x),x>e[5]&&(e[5]=x))}if(v*o>0&&(v*=-1),y*o>0&&(y*=-1),!v)return null;var T=[d,c,.5*v];return n&&(T[3]=f,T[4]=.5*y),T}function u(e,t,r,i,n){for(var s=a(i,n),o=t,u=t+s,f=0,v=0,y=0,p=0,m=0,g=r-1;m<g;m++,o+=s,u+=s){var _=e[o],x=e[o+1],b=e[o+2],Z=e[u],k=e[u+1],C=e[u+2],T=i?h(_,x,b,Z,k,C):l(_,x,Z,k);if(T)if(f+=T,i){var I=c(_,x,b,Z,k,C);v+=T*I[0],y+=T*I[1],p+=T*I[2]}else{var w=d(_,x,Z,k);v+=T*w[0],y+=T*w[1]}}return f>0?i?[v/f,y/f,p/f]:[v/f,y/f]:r>0?i?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function l(e,t,r,i){var n=r-e,a=i-t;return Math.sqrt(n*n+a*a)}function h(e,t,r,i,n,a){var s=i-e,o=n-t,u=a-r;return Math.sqrt(s*s+o*o+u*u)}function d(e,t,r,i){return[e+.5*(r-e),t+.5*(i-t)]}function c(e,t,r,i,n,a){return[e+.5*(i-e),t+.5*(n-t),r+.5*(a-r)]}},19995:function(e,t,r){r.d(t,{_W:function(){return g},iV:function(){return Z},oj:function(){return T}});var i=r(74165),n=r(15671),a=r(43144),s=r(15861),o=r(37762),u=r(29439),l=r(92026),h=r(79803),d=r(40237),c=r(92975),f=r(81753),v=[0,0];function y(e,t){if(!t)return null;if("x"in t){var r,i,n={x:0,y:0};return r=e(t.x,t.y,v),i=(0,u.Z)(r,2),n.x=i[0],n.y=i[1],null!=t.z&&(n.z=t.z),null!=t.m&&(n.m=t.m),n}if("xmin"in t){var a,s,o,l,h={xmin:0,ymin:0,xmax:0,ymax:0};return a=e(t.xmin,t.ymin,v),s=(0,u.Z)(a,2),h.xmin=s[0],h.ymin=s[1],o=e(t.xmax,t.ymax,v),l=(0,u.Z)(o,2),h.xmax=l[0],h.ymax=l[1],t.hasZ&&(h.zmin=t.zmin,h.zmax=t.zmax,h.hasZ=!0),t.hasM&&(h.mmin=t.mmin,h.mmax=t.mmax,h.hasM=!0),h}return"rings"in t?{rings:p(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:p(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:m(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function p(e,t){var r,i=[],n=(0,o.Z)(e);try{for(n.s();!(r=n.n()).done;){var a=r.value;i.push(m(a,t))}}catch(s){n.e(s)}finally{n.f()}return i}function m(e,t){var r,i=[],n=(0,o.Z)(e);try{for(n.s();!(r=n.n()).done;){var a=r.value,s=t(a[0],a[1],[0,0]);i.push(s),a.length>2&&s.push(a[2]),a.length>3&&s.push(a[3])}}catch(u){n.e(u)}finally{n.f()}return i}function g(e,t){return _.apply(this,arguments)}function _(){return(_=(0,s.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&r){e.next=2;break}return e.abrupt("return");case 2:return n=Array.isArray(t)?t.map((function(e){return(0,l.pC)(e.geometry)?e.geometry.spatialReference:null})).filter(l.pC):[t],e.next=5,(0,h.iQ)(n.map((function(e){return{source:e,dest:r}})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=y.bind(null,f.hG),b=y.bind(null,f.R6);function Z(e,t,r,i){if(!e)return e;if(r||(r=t,t=e.spatialReference),!(0,c.JY)(t)||!(0,c.JY)(r)||(0,c.fS)(t,r))return e;if((0,f.Q8)(t,r)){var n=(0,c.sS)(r)?x(e):b(e);return n.spatialReference=r,n}return(0,h.oj)(d.N,[e],t,r,null,i)[0]}var k=function(){function e(){(0,n.Z)(this,e),this._jobs=[],this._timer=null,this._process=this._process.bind(this)}return(0,a.Z)(e,[{key:"push",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,r,n){var a,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.length&&r&&n&&!(0,c.fS)(r,n)){e.next=2;break}return e.abrupt("return",t);case 2:return a={geometries:t,inSpatialReference:r,outSpatialReference:n,resolve:null},e.abrupt("return",(this._jobs.push(a),new Promise((function(e){a.resolve=e,null===s._timer&&(s._timer=setTimeout(s._process,10))}))));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_process",value:function(){this._timer=null;var e=this._jobs.shift();if(e){var t=e.geometries,r=e.inSpatialReference,i=e.outSpatialReference,n=e.resolve;(0,f.Q8)(r,i)?(0,c.sS)(i)?n(t.map(x)):n(t.map(b)):n((0,h.oj)(d.N,t,r,i,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}}]),e}(),C=new k;function T(e,t,r){return C.push(e,t,r)}},77318:function(e,t,r){r.d(t,{Z:function(){return it}});var i=r(29439),n=r(74165),a=r(15861),s=r(93433),o=r(37762),u=r(15671),l=r(43144),h=r(97326),d=r(60136),c=r(92572),f=r(27366),v=r(85015),y=r(75746),p=r(41691),m=r(93169),g=r(92026),_=r(66978),x=r(94172),b=r(49861),Z=(r(25243),r(63780),r(69912)),k=r(78952),C=r(65156),T=r(69662),I=r(77981),w=r(47991),F=r(92975),D=r(19995),M=r(78915),B=r(61574),S=r(94109),R=r(80613),L=r(11752),A=r(61120),O=-1,U=function(){function e(){(0,u.Z)(this,e),this._dirties=[{vertexFrom:O,vertexCount:O,indexFrom:O,indexCount:O,allDirty:!1},{vertexFrom:O,vertexCount:O,indexFrom:O,indexCount:O,allDirty:!1},{vertexFrom:O,vertexCount:O,indexFrom:O,indexCount:O,allDirty:!1},{vertexFrom:O,vertexCount:O,indexFrom:O,indexCount:O,allDirty:!1},{vertexFrom:O,vertexCount:O,indexFrom:O,indexCount:O,allDirty:!1}]}return(0,l.Z)(e,[{key:"hasDirty",value:function(){return this._dirties.some((function(e){return e.indexCount!==O||e.allDirty}))}},{key:"markAllClean",value:function(){var e,t=(0,o.Z)(this._dirties);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.indexFrom=O,r.indexCount=O,r.vertexFrom=O,r.vertexCount=O,r.allDirty=!1}}catch(i){t.e(i)}finally{t.f()}}},{key:"markAllDirty",value:function(){var e,t=(0,o.Z)(this._dirties);try{for(t.s();!(e=t.n()).done;){e.value.allDirty=!0}}catch(r){t.e(r)}finally{t.f()}}},{key:"forEach",value:function(e){for(var t=0;t<this._dirties.length;++t){var r=this._dirties[t],i=r.indexCount,n=r.indexFrom,a=r.vertexCount,s=r.vertexFrom,o=r.allDirty,u={},l=void 0,h=!1;(o||s!==O&&a>0)&&(u.geometry={count:a,from:s,allDirty:o},h=!0),(o||n!==O&&i>0)&&(l={count:i,from:n,allDirty:o},h=!0),h&&e({indices:l,vertices:u},t)}}},{key:"markDirtyIndices",value:function(e,t,r){var i=this._dirties[e],n=t,a=r;if(!i.allDirty)if(i.indexCount!==O){var s=Math.min(i.indexFrom,n),o=Math.max(i.indexFrom+i.indexCount,n+a)-s;i.indexFrom=s,i.indexCount=o}else i.indexFrom=n,i.indexCount=a}},{key:"markDirtyVertices",value:function(e,t,r,i){var n=this._dirties[e],a=r,s=i;if(!n.allDirty)if(n.vertexCount!==O){var o=Math.min(n.vertexFrom,a),u=Math.max(n.vertexFrom+n.vertexCount,a+s)-o;n.vertexFrom=o,n.vertexCount=u}else n.vertexFrom=a,n.vertexCount=s}}]),e}(),P=function(){function e(t){(0,u.Z)(this,e),this._largestRange=null,this._parent=t,this._updateLargestRange()}return(0,l.Z)(e,[{key:"largestRange",get:function(){return this._largestRange}},{key:"rangeCreated",value:function(e){(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}},{key:"rangeResized",value:function(e,t){e===this._largestRange?e.count<t&&this._updateLargestRange():(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}},{key:"findBestRange",value:function(e){for(var t=this._parent._freeHead,r=null;null!==t;)t.count>=e&&(!r||t.count-e<r.count-e)&&(r=t),t=t.next;return r}},{key:"findAdjacentRanges",value:function(e,t){for(var r=!0,i=!1,n=null,a=this._parent._freeHead;r&&!i;){var s=null!==n?n.from+n.count:0,o=null!==a?a.from:this._parent._size;e>=s&&e+t<=o?(r=!1,i=!0):null!==a?(n=a,a=a.next):r=!1}return[n,a]}},{key:"_updateLargestRange",value:function(){for(var e=null,t=this._parent._freeHead;null!==t;)(!e||t.count>e.count)&&(e=t),t=t.next;this._largestRange=e}}]),e}(),z=function(){function e(t,r){(0,u.Z)(this,e),this._allocated=0,this._size=t,this._freeHead=t>0?{from:0,count:t,prev:null,next:null}:null,this._bookKeeper=r||new P(this),this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}return(0,l.Z)(e,[{key:"allocate",value:function(t){var r=this._bookKeeper.findBestRange(t);if(null==r)return-1;var i=r.from,n=r.count;if(r.from+=t,r.count-=t,this._bookKeeper.rangeResized(r,i,n),this._allocated+=t,0===r.count){var a=null!==r.prev?this._freeHead:r.next;e._removeRange(r),this._freeHead=a}return i}},{key:"free",value:function(t,r){var n=this._bookKeeper.findAdjacentRanges(t,r),a=(0,i.Z)(n,2),s=a[0],o=a[1],u={from:t,count:r,prev:null!==s&&void 0!==s?s:null,next:null!==o&&void 0!==o?o:null};if(null!=s&&(s.next=u),null!=o&&(o.prev=u),this._bookKeeper.rangeCreated(u),this._allocated-=r,null!=o&&u.from+u.count===o.from){var l=u.from,h=u.count;e._fuse(u,o),e._removeRange(o),this._bookKeeper.rangeResized(u,l,h),this._bookKeeper.rangeResized(o,void 0,0)}if(null!=s&&s.from+s.count===u.from){var d=s.from,c=s.count;e._fuse(s,u),e._removeRange(u),this._bookKeeper.rangeResized(s,d,c),this._bookKeeper.rangeResized(u,void 0,0)}this._freeHead=null!==u.prev?this._freeHead:u}},{key:"fragmentation",get:function(){var e=this._size-this._allocated;return 0===e?0:1-this._bookKeeper.largestRange.count/e}}],[{key:"_removeRange",value:function(e){null!==e.prev?null!==e.next?(e.prev.next=e.next,e.next.prev=e.prev):e.prev.next=null:null!==e.next&&(e.next.prev=null)}},{key:"_fuse",value:function(e,t){e.count+=t.count,e.next=t.next,t.from+=t.count,t.count=0,null!==t.next&&(t.next.prev=e)}}]),e}(),N=r(84319),G=["FILL","LINE","MARKER","TEXT","LABEL"];var E=function(){function e(t,r,i,n){for(var a in(0,u.Z)(this,e),this._strides=t,this._displayList=r,this._freeListsAndStorage={},this._dirtyMap=null,this._dirtyMap=i,t)for(var s in this._freeListsAndStorage[a]={vtxFreeList:n?new z(n):null,idxFreeList:n?new z(n):null,vertexBuffers:{},indexBuffer:n?new Uint32Array(n):null},t[a])this._freeListsAndStorage[a].vertexBuffers[s]={data:n?(0,N.C$)(n,t[a][s]):null,stride:t[a][s]}}return(0,l.Z)(e,[{key:"delete",value:function(e){var t=G[e.geometryType];this._freeVertices(t,e.vertexFrom,e.vertexCount),this._freeIndices(t,e.indexFrom,e.indexCount),this._displayList.removeFromList(e),e.vertexFrom=void 0,e.indexFrom=void 0}},{key:"setMeshData",value:function(e,t,r,i,n){var a,s,o=G[e.geometryType];e.meshData=null,void 0===e.vertexFrom?(s=t.vertexCount,a=this._allocateVertices(o,s)):t.vertexCount>e.vertexCount?(this._freeVertices(o,e.vertexFrom,e.vertexCount),s=t.vertexCount,a=this._allocateVertices(o,s)):t.vertexCount===e.vertexCount?(a=e.vertexFrom,s=e.vertexCount):(this._freeVertices(o,e.vertexFrom+t.vertexCount,e.vertexCount-t.vertexCount),a=e.vertexFrom,s=t.vertexCount);var u,l,h,d=!0;if(void 0===e.indexFrom?(u=n,h=t.indexCount,l=this._allocateIndices(o,h)):t.indexCount>e.indexCount?(u=this._displayList.removeFromList(e),this._freeIndices(o,e.indexFrom,e.indexCount),h=t.indexCount,l=this._allocateIndices(o,h)):t.indexCount===e.indexCount?(d=!1,l=e.indexFrom,h=e.indexCount):(u=this._displayList.removeFromList(e),this._freeIndices(o,e.indexFrom+t.indexCount,e.indexCount-t.indexCount),l=e.indexFrom,h=t.indexCount),-1!==a&&-1!==l){var c=this._storageFor(o);if((0,N.wO)(a,l,c.vertexBuffers,c.indexBuffer,t,r,i),e.vertexFrom=a,e.indexFrom=l,e.vertexCount=t.vertexCount,e.indexCount=t.indexCount,this._dirtyMap)for(var f in this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount),r)this._dirtyMap.markDirtyVertices(e.geometryType,f,e.vertexFrom,e.vertexCount);return d&&this._displayList.addToList(e,u),!0}return-1!==a&&this._freeVertices(o,a,s),-1!==l&&this._freeIndices(o,l,h),e.setMeshDataFromBuffers(t,r,i),e.vertexFrom=void 0,e.vertexCount=0,e.indexFrom=void 0,e.indexCount=0,!1}},{key:"tryAddMeshData",value:function(e,t){var r=t.vertexBuffer,i=t.indexBuffer,n=G[e.geometryType],a=this._allocateVertices(n,e.vertexCount);if(-1===a)return this._freeVertices(n,a,e.vertexCount),!1;var s=this._allocateIndices(n,e.indexCount);if(-1===s)return this._freeVertices(n,a,e.vertexCount),this._freeIndices(n,s,e.indexCount),!1;var o=this._storageFor(n);if((0,N.wO)(a,s,o.vertexBuffers,o.indexBuffer,e,r,i),e.vertexFrom=a,e.indexFrom=s,this._dirtyMap)for(var u in this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount),r)this._dirtyMap.markDirtyVertices(e.geometryType,u,a,e.vertexCount);return this._displayList.addToList(e),!0}},{key:"_allocateVertices",value:function(e,t){var r,i,n=this._storageFor(e),a=null===(r=n.vtxFreeList)||void 0===r?void 0:r.allocate(t);if(null==a||-1===a)return-1;var s=null===(i=n.vtxFreeList)||void 0===i?void 0:i.fragmentation;return null==s||s>.5?-1:a}},{key:"_freeVertices",value:function(e,t,r){var i;null===(i=this._storageFor(e).vtxFreeList)||void 0===i||i.free(t,r)}},{key:"_freeIndices",value:function(e,t,r){var i;null===(i=this._storageFor(e).idxFreeList)||void 0===i||i.free(t,r)}},{key:"_allocateIndices",value:function(e,t){var r,i,n=this._storageFor(e),a=null===(r=n.idxFreeList)||void 0===r?void 0:r.allocate(t);if(null==a||-1===a)return-1;var s=null===(i=n.idxFreeList)||void 0===i?void 0:i.fragmentation;return null==s||s>.5?-1:a}},{key:"_storageFor",value:function(e){return this._freeListsAndStorage[e]}},{key:"_stridesFor",value:function(e,t){return this._strides[e][t]}}],[{key:"fromTileData",value:function(t,r){var i,n,a,s=function(e){for(var t=e.getStrides(),r={},i=0;i<t.length;i++)r[G[i]]=t[i];return r}(t),u=[0,0,0,0,0],l=[0,0,0,0,0],h=(0,o.Z)(t.tileDisplayData.displayObjects);try{for(h.s();!(a=h.n()).done;){var d,c=a.value,f=(0,o.Z)(c.displayRecords);try{for(f.s();!(d=f.n()).done;){var v=d.value;u[v.geometryType]=Math.max(u[v.geometryType],v.vertexFrom+v.vertexCount),l[v.geometryType]=Math.max(l[v.geometryType],v.indexFrom+v.indexCount)}}catch(D){f.e(D)}finally{f.f()}}}catch(D){h.e(D)}finally{h.f()}for(var y=new e(s,t.tileDisplayData.displayList,r,void 0),p=null!==(i=null===(n=t.tileBufferData)||void 0===n?void 0:n.geometries)&&void 0!==i?i:[],m=0;m<p.length;++m){var g=u[m],_=l[m],x=p[m],b=G[m],Z=y._storageFor(b),k=p[m].indexBuffer;Z.indexBuffer=k,Z.idxFreeList=new z(k.length),Z.idxFreeList.allocate(_);var C=0;for(var T in x.vertexBuffer){var I=p[m].vertexBuffer[T];Z.vertexBuffers[T].data=I.data,Z.vertexBuffers[T].stride=I.stride;var w=(0,N.Y8)(I.stride),F=I.data.length*w/I.stride;C||(C=F)}Z.vtxFreeList=new z(C),Z.vtxFreeList.allocate(g)}return y}}]),e}(),V=r(44070),j=r(8548),K=r(45412),q=function(){function e(t){(0,u.Z)(this,e),this.geometryMap=(0,N.Mk)((function(){return{indexBuffer:V.f.createIndex(t,j.l1.STATIC_DRAW),vao:null}}),(function(e,r){return{vertexBuffer:V.f.createVertex(t,N.mR[r])}}))}return(0,l.Z)(e,[{key:"dispose",value:function(){for(var e=0;e<5;e++){var t=this.geometryMap[e];if(t)for(var r in t.data.vao&&t.data.vao.dispose(!1),t.data.indexBuffer&&t.data.indexBuffer.dispose(),t.buffers)t.buffers[r]&&t.buffers[r].data.vertexBuffer.dispose()}}},{key:"get",value:function(e){var t=this.geometryMap[e];return{getVAO:function(e,r,i){if(!t.data.vao){var n={};for(var a in t.buffers)n[a]=t.buffers[a].data.vertexBuffer;t.data.vao=new K.U(e,i,r,n,t.data.indexBuffer)}return t.data.vao}}}},{key:"has",value:function(e){return null!=this.geometryMap[e]}},{key:"upload",value:function(e,t){var r=this;t.forEach((function(t,i){r._upload(t,i,e)}))}},{key:"_upload",value:function(e,t,r){if(e.indices&&(e.indices.allDirty?this._uploadIndices(r,t):null!=e.indices.from&&null!=e.indices.count&&this._uploadIndices(r,t,e.indices.from,e.indices.count)),e.vertices){var i=e.vertices;for(var n in i){var a=i[n];a.allDirty?this._uploadVertices(r,t,n):null!=a.from&&null!=a.count&&this._uploadVertices(r,t,n,a.from,a.count)}}}},{key:"_uploadVertices",value:function(e,t,r,i,n){var a=this.geometryMap[t];if(a){var s=e.geometries[t].vertexBuffer[r];if(s){var o=s.data,u=s.stride;if(a.buffers[r]&&o.length>0){var l=u/o.BYTES_PER_ELEMENT;null!=i&&null!=n?a.buffers[r].data.vertexBuffer.setSubData(o,i*l,i*l,(i+n)*l):a.buffers[r].data.vertexBuffer.setData(o)}}}}},{key:"_uploadIndices",value:function(e,t,r,i){var n=this.geometryMap[t];if(n){var a=e.geometries[t].indexBuffer;n.data.indexBuffer&&a.length>0&&(null!=r&&null!=i?n.data.indexBuffer.setSubData(a,r,r,r+i):n.data.indexBuffer.setData(a))}}}]),e}(),Y=function(e){(0,d.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,u.Z)(this,r),(e=t.apply(this,arguments))._data=null,e._displayList=null,e._lastCommitTime=0,e._hasData=!1,e._invalidated=!1,e._wglBuffers=null,e._dirtyMap=new U,e}return(0,l.Z)(r,[{key:"destroy",value:function(){(0,L.Z)((0,A.Z)(r.prototype),"destroy",this).call(this),this.clear()}},{key:"hasData",get:function(){return!!this._hasData}},{key:"displayObjects",get:function(){var e;return null!==(e=this._displayObjects)&&void 0!==e?e:[]}},{key:"getGeometry",value:function(e){return this._wglBuffers&&this._wglBuffers.has(e)?this._wglBuffers.get(e):null}},{key:"getDisplayList",value:function(){return this._displayList}},{key:"patch",value:function(e){var t,r;if(!0===e.clear)return this.clear(),void(this._hasData=!1);var i=e.addOrUpdate,n=e.remove;!this._data&&i&&null!==(t=i.tileDisplayData)&&void 0!==t&&t.displayObjects.length?(i.tileDisplayData.computeDisplayList(),this._dirtyMap=new U,this._dispRecStore=E.fromTileData(i,this._dirtyMap),this._data=i,this._dirtyMap.markAllDirty(),this._hasData=!0,e.end&&this.ready()):this._data&&(i&&null!==(r=i.tileDisplayData)&&void 0!==r&&r.displayObjects.length||n.length)?this._doPatchData(e):e.end&&this.ready(),e.end&&!this._data&&this.clear(),this.requestRender(),this.emit("change")}},{key:"commit",value:function(e){e.time&&e.time===this._lastCommitTime||(this._lastCommitTime=e.time,this.visible&&this._data&&(this._wglBuffers||(this._wglBuffers=new q(e.context)),(this._dirtyMap.hasDirty()||this._invalidated)&&(this._invalidated=!1,this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap),this._displayList=this._data.tileDisplayData.displayList.clone(),this._displayObjects=this._data.tileDisplayData.displayObjects.slice(),this._dirtyMap.markAllClean())))}},{key:"clear",value:function(){this._data=null,this._displayList=null,this._dispRecStore=null,this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)}},{key:"_doPatchData",value:function(e){this._invalidated=!0,this._patchData(e)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=E.fromTileData(this._data,this._dirtyMap)),this.requestRender()}},{key:"_patchData",value:function(e){var t,r,i,n=!0,a=e.addOrUpdate&&e.addOrUpdate.tileDisplayData&&e.addOrUpdate.tileDisplayData.displayObjects||[],s=(e.remove||[]).slice(),u=(0,o.Z)(a);try{for(u.s();!(r=u.n()).done;){var l=r.value;null!=l.insertAfter&&s.push(l.id)}}catch(Y){u.e(Y)}finally{u.f()}s.length>0&&(i=new Set(s));var h,d=this._data.tileDisplayData,c=(0,o.Z)(s);try{for(c.s();!(h=c.n()).done;){var f=h.value,v=d.displayObjectRegistry.get(f);if(v){d.displayList.removeFromList(v.displayRecords);var y,p=(0,o.Z)(v.displayRecords);try{for(p.s();!(y=p.n()).done;){var m=y.value;this._dispRecStore.delete(m)}}catch(Y){p.e(Y)}finally{p.f()}d.displayObjectRegistry.delete(f)}}}catch(Y){c.e(Y)}finally{c.f()}(null===(t=i)||void 0===t?void 0:t.size)&&(d.displayObjects=d.displayObjects.filter((function(e){return!i.has(e.id)})));var g,_=(0,o.Z)(a);try{for(_.s();!(g=_.n()).done;){var x=g.value,b=void 0,Z=d.displayObjectRegistry.get(x.id);if(Z){var k=Z.displayRecords;Z.set(x),Z.displayRecords=k;for(var C=Z.displayRecords.length,T=0;T<C;++T){var I=Z.displayRecords[T],w=x.displayRecords[T];(T>=x.displayRecords.length||I.geometryType!==w.geometryType||I.symbolLevel!==w.symbolLevel||I.zOrder!==w.zOrder||I.materialKey!==w.materialKey)&&(this._dispRecStore.delete(Z.displayRecords[T]),T<x.displayRecords.length&&(Z.displayRecords[T]=void 0))}Z.displayRecords.length=x.displayRecords.length}else{var F=void 0;(Z=x.copy()).displayRecords=[],d.displayObjectRegistry.set(x.id,Z);var D=d.displayObjects;if(null!=Z.insertAfter)if(b={},Z.insertAfter>=0){var M=d.displayObjectRegistry.get(Z.insertAfter);M?(F=D.indexOf(M)+1)<D.length?D.splice(F,0,Z):(D.push(Z),F=D.length):(D.push(Z),F=D.length)}else D.unshift(Z),F=0;else D.push(Z),F=D.length;if(b)for(var B=x.displayRecords.length>0?1:0,S=0,R=F-1;R>=0&&S<B;--R)for(var L=D[R].displayRecords.length-1;L>=0&&S<B;--L){var A=D[R].displayRecords[L],O=d.displayList.getDPInfoType();b[O]||(b[O]=A,++S)}}for(var U=x.displayRecords.length,P=0;P<U;++P){var z=x.displayRecords[P],N=Z.displayRecords[P];N?(N.meshData=z.meshData,N.materialKey=z.materialKey):((N=z.copy()).vertexFrom=void 0,N.indexFrom=void 0,Z.displayRecords[P]=N);var G=z.geometryType,E=d.displayList.getDPInfoType(),V=e.addOrUpdate.tileBufferData.geometries[G],j=V.vertexBuffer,K=V.indexBuffer,q=void 0;b&&(q=b[E]?d.displayList.splitAfter(b[E]):-1),n=this._dispRecStore.setMeshData(N,z,j,K,q)&&n,b&&null!=N.indexFrom&&null!=N.indexFrom&&(b[E]=N)}}}catch(Y){_.e(Y)}finally{_.f()}return n}}]),r}(r(98774).o),H=function(){function e(){(0,u.Z)(this,e),this._byGeometryType=null}return(0,l.Z)(e,[{key:"satisfied",get:function(){return!this._byGeometryType}},{key:"reset",value:function(){this._byGeometryType=null}},{key:"verticesFor",value:function(e){return this._byGeometryType?this._byGeometryType[e].vertices:0}},{key:"indicesFor",value:function(e){return this._byGeometryType?this._byGeometryType[e].indices:0}},{key:"needMore",value:function(e,t,r){if(t||r){this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]);var i=this._byGeometryType[e];i.vertices+=t,i.indices+=r}}}]),e}(),W=function(){function e(){(0,u.Z)(this,e),this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}return(0,l.Z)(e,[{key:"clone",value:function(){for(var t=new e,r=0;r<this.geometries.length;r++){var i=this.geometries[r],n=t.geometries[r];for(var a in n.indexBuffer=i.indexBuffer.slice(),n.vertexBuffer={},i.vertexBuffer){var s=i.vertexBuffer[a],o=s.data,u=s.stride;n.vertexBuffer[a]={data:o.slice(),stride:u}}}return t}},{key:"serialize",value:function(){for(var e={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]},t=0;t<5;++t)for(var r in this.geometries[t].vertexBuffer)e.geometries[t].vertexBuffer[r]={data:this.geometries[t].vertexBuffer[r].data.buffer,stride:this.geometries[t].vertexBuffer[r].stride};return e}},{key:"getBuffers",value:function(){for(var e=[],t=0;t<5;++t)for(var r in e.push(this.geometries[t].indexBuffer.buffer),this.geometries[t].vertexBuffer)e.push(this.geometries[t].vertexBuffer[r].data.buffer);return e}}],[{key:"deserialize",value:function(t){for(var r=new e,i=0;i<5;++i)for(var n in r.geometries[i].indexBuffer=new Uint32Array(t.geometries[i].indexBuffer),r.geometries[i].vertexBuffer={},t.geometries[i].vertexBuffer)r.geometries[i].vertexBuffer[n]={data:(0,N.e2)(t.geometries[i].vertexBuffer[n].data,t.geometries[i].vertexBuffer[n].stride),stride:t.geometries[i].vertexBuffer[n].stride};return r}}]),e}(),X=r(54815);function J(e,t,r){for(var i=arguments.length,n=new Array(i>3?i-3:0),a=3;a<i;a++)n[a-3]=arguments[a];t<e.length?e.splice.apply(e,[t,r].concat(n)):e.push.apply(e,n)}var Q=function(){function e(){(0,u.Z)(this,e),this.symbolLevels=[]}return(0,l.Z)(e,[{key:"replay",value:function(e,t,r){var i,n=(0,o.Z)(this.symbolLevels);try{for(n.s();!(i=n.n()).done;){var a,s=i.value,u=(0,o.Z)(s.zLevels);try{for(u.s();!(a=u.n()).done;){var l=a.value.geometryDPInfo.unified;if(l){var h,d=(0,o.Z)(l);try{for(d.s();!(h=d.n()).done;){var c=h.value,f=c.geometryType,v=c.materialKey,y=c.indexFrom,p=c.indexCount,m=X.m2.load(v).symbologyType,g=e.painter.getBrush(f,m),_={geometryType:f,materialKey:v,indexFrom:y,indexCount:p,target:t.getGeometry(f)};g.prepareState(e),g.drawGeometry(e,t,_,r)}}catch(x){d.e(x)}finally{d.f()}}}}catch(x){u.e(x)}finally{u.f()}}}catch(x){n.e(x)}finally{n.f()}}},{key:"empty",get:function(){return!this.symbolLevels||0===this.symbolLevels.length}},{key:"clear",value:function(){this.symbolLevels.length=0}},{key:"addToList",value:function(e,t){if(Array.isArray(e)){var r,i=(0,o.Z)(e);try{for(i.s();!(r=i.n()).done;){var n=r.value;this._addToList(n,t)}}catch(a){i.e(a)}finally{i.f()}}else this._addToList(e,t)}},{key:"removeFromList",value:function(e){Array.isArray(e)||(e=[e]);var t,r=null,i=(0,o.Z)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;r=this._removeFromList(n)}}catch(a){i.e(a)}finally{i.f()}return r}},{key:"clone",value:function(){var t,r=new e,i=(0,o.Z)(this.symbolLevels);try{for(i.s();!(t=i.n()).done;){var n=t.value;r.symbolLevels.push(n.clone())}}catch(a){i.e(a)}finally{i.f()}return r}},{key:"splitAfter",value:function(e){for(var t=this._getDisplayList(e.symbolLevel,e.zOrder),r=t.length,i=e.indexFrom+e.indexCount,n=0;n<r;++n){var a=t[n];if(a.geometryType===e.geometryType&&i>a.indexFrom&&i<=a.indexFrom+a.indexCount){if(i<a.indexFrom+a.indexCount){var s=new $;s.geometryType=a.geometryType,s.materialKey=a.materialKey,s.indexFrom=i,s.indexCount=a.indexFrom+a.indexCount-i,t.splice(n+1,0,s),a.indexCount=i-a.indexFrom}return n}}}},{key:"_addToList",value:function(e,t){var r=e.symbolLevel,i=e.zOrder,n=this._getDisplayList(r,i),a=null!=t?t:n.length-1,s=a>=0&&a<n.length?n[a]:null;if(null!==s&&s.materialKey===e.materialKey&&s.indexFrom+s.indexCount===e.indexFrom&&s.geometryType===e.geometryType)s.indexCount+=e.indexCount;else{var o=new $;o.indexFrom=e.indexFrom,o.indexCount=e.indexCount,o.materialKey=e.materialKey,o.geometryType=e.geometryType,J(n,a+1,0,o)}}},{key:"_removeFromList",value:function(e){for(var t,r=e.symbolLevel,i=e.zOrder,n=this._getDisplayList(r,i),a=n.length,s=0;s<a;++s){var o=n[s];if(e.indexFrom+e.indexCount>o.indexFrom&&e.indexFrom<o.indexFrom+o.indexCount&&o.geometryType===e.geometryType){t=s;break}}if(void 0!==t){var u=n[t];if(e.indexFrom===u.indexFrom)return u.indexCount-=e.indexCount,u.indexFrom+=e.indexCount,0===u.indexCount&&J(n,t,1),t-1;if(e.indexFrom+e.indexCount===u.indexFrom+u.indexCount)return u.indexCount-=e.indexCount,0===u.indexCount?(J(n,t,1),t-1):t;var l=u.indexFrom,h=e.indexFrom-u.indexFrom,d=e.indexCount,c=u.indexFrom+u.indexCount-(e.indexFrom+e.indexCount);u.indexCount=h;var f=new $;return f.geometryType=u.geometryType,f.materialKey=u.materialKey,f.indexFrom=l+h+d,f.indexCount=c,J(n,t+1,0,f),t}return null}},{key:"_getDisplayList",value:function(e,t){for(var r,i,n=this.symbolLevels.length,a=0;a<n;a++)if(this.symbolLevels[a].symbolLevel===e){r=this.symbolLevels[a];break}r||((r=new re).symbolLevel=e,this.symbolLevels.push(r));for(var s=r.zLevels.length,o=0;o<s;o++)if(r.zLevels[o].zLevel===t){i=r.zLevels[o];break}return i||((i=new te).geometryDPInfo=new ee,i.zLevel=t,r.zLevels.push(i)),i.geometryDPInfo.unified||(i.geometryDPInfo.unified=[]),i.geometryDPInfo.unified}},{key:"getDPInfoType",value:function(){return"unified"}}]),e}(),$=function(){function e(){(0,u.Z)(this,e),this.materialKey=null,this.indexFrom=0,this.indexCount=0}return(0,l.Z)(e,[{key:"clone",value:function(){var t=new e;return t.geometryType=this.geometryType,t.materialKey=this.materialKey,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t}}]),e}(),ee=function(){function e(){(0,u.Z)(this,e),this.fill=null,this.line=null,this.marker=null,this.text=null,this.label=null,this.unified=null}return(0,l.Z)(e,[{key:"clone",value:function(){var t=new e;return t.fill=this.fill&&this.fill.map((function(e){return e.clone()})),t.line=this.line&&this.line.map((function(e){return e.clone()})),t.marker=this.marker&&this.marker.map((function(e){return e.clone()})),t.text=this.text&&this.text.map((function(e){return e.clone()})),t.label=this.label&&this.label.map((function(e){return e.clone()})),t.unified=this.unified&&this.unified.map((function(e){return e.clone()})),t}}]),e}(),te=function(){function e(){(0,u.Z)(this,e),this.geometryDPInfo=new ee}return(0,l.Z)(e,[{key:"clone",value:function(){var t=new e;return t.zLevel=this.zLevel,t.geometryDPInfo=this.geometryDPInfo.clone(),t}}]),e}(),re=function(){function e(){(0,u.Z)(this,e),this.zLevels=[]}return(0,l.Z)(e,[{key:"clone",value:function(){var t=new e;t.symbolLevel=this.symbolLevel;var r,i=(0,o.Z)(this.zLevels);try{for(i.s();!(r=i.n()).done;){var n=r.value;t.zLevels.push(n.clone())}}catch(a){i.e(a)}finally{i.f()}return t}}]),e}(),ie=function(){function e(){(0,u.Z)(this,e),this.vertexData=new Map,this.vertexCount=0,this.indexData=[]}return(0,l.Z)(e,[{key:"clear",value:function(){this.vertexData.clear(),this.vertexCount=0,this.indexData=[]}},{key:"update",value:function(e,t,r){for(var i in e)this.vertexData.set(i,e[i]);for(var n in this.vertexData)null===e[n]&&this.vertexData.delete(n);this.vertexCount=t,this.indexData=r}}]),e}(),ne=function(){function e(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;(0,u.Z)(this,e),this.id=t,this.geometryType=r,this.materialKey=i,this.minZoom=n,this.maxZoom=a,this.meshData=null,this.symbolLevel=0,this.zOrder=0,this.vertexFrom=0,this.vertexCount=0,this.indexFrom=0,this.indexCount=0,this._sortKey=null}return(0,l.Z)(e,[{key:"sortKey",get:function(){return null==this._sortKey&&this._computeSortKey(),this._sortKey}},{key:"clone",value:function(){return this.copy()}},{key:"copy",value:function(){var t=new e(this.id,this.geometryType,this.materialKey);return t.vertexFrom=this.vertexFrom,t.vertexCount=this.vertexCount,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t.zOrder=this.zOrder,t.symbolLevel=this.symbolLevel,t.meshData=this.meshData,t.minZoom=this.minZoom,t.maxZoom=this.maxZoom,t}},{key:"setMeshDataFromBuffers",value:function(e,t,r){var i=new ie;for(var n in t){var a=t[n].stride,s=t[n].data;if(s){for(var o=[],u=(0,N.Y8)(a),l=0;l<a*e.vertexCount/u;++l)o[l]=s[l+a*e.vertexFrom/u];i.vertexData.set(n,o)}}i.indexData.length=0;for(var h=0;h<e.indexCount;++h)i.indexData[h]=r[h+e.indexFrom]-e.vertexFrom;i.vertexCount=e.vertexCount,this.meshData=i}},{key:"readMeshDataFromBuffers",value:function(e,t){for(var r in this.meshData?this.meshData.clear():this.meshData=new ie,e){for(var i=e[r].stride,n=e[r].data,a=[],s=(0,N.Y8)(i),o=0;o<i*this.vertexCount/s;++o)a[o]=n[o+i*this.vertexFrom/s];this.meshData.vertexData.set(r,a)}this.meshData.indexData.length=0;for(var u=0;u<this.indexCount;++u)this.meshData.indexData[u]=t[u+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount}},{key:"writeMeshDataToBuffers",value:function(e,t,r,i){if(this.meshData){for(var n in t)for(var a=t[n].stride,s=this.meshData.vertexData.get(n),o=t[n].data,u=(0,N.Y8)(a),l=0;l<a*this.meshData.vertexCount/u;++l)o[l+a*e/u]=s[l];for(var h=0;h<this.meshData.indexData.length;++h)i[h+r]=this.meshData.indexData[h]+e;this.vertexFrom=e,this.vertexCount=this.meshData.vertexCount,this.indexFrom=r,this.indexCount=this.meshData.indexData.length}}},{key:"_computeSortKey",value:function(){this._sortKey=(31&this.symbolLevel)<<12|(127&this.zOrder)<<4|7&this.geometryType}},{key:"serialize",value:function(e){return e.push(this.geometryType),e.push(this.materialKey),e.push(this.vertexFrom),e.push(this.vertexCount),e.push(this.indexFrom),e.push(this.indexCount),e.push(this.minZoom),e.push(this.maxZoom),e}}],[{key:"writeAllMeshDataToBuffers",value:function(e,t,r){var i,n=0,a=0,s=(0,o.Z)(e);try{for(s.s();!(i=s.n()).done;){var u=i.value;u.writeMeshDataToBuffers(n,t,a,r),n+=u.vertexCount,a+=u.indexCount}}catch(l){s.e(l)}finally{s.f()}}},{key:"deserialize",value:function(t,r){var i=t.readInt32(),n=t.readInt32(),a=new e(r.id,i,n);return a.vertexFrom=t.readInt32(),a.vertexCount=t.readInt32(),a.indexFrom=t.readInt32(),a.indexCount=t.readInt32(),a.minZoom=t.readInt32(),a.maxZoom=t.readInt32(),a}}]),e}();function ae(e,t){if(null!==t){e.push(t.length);var r,i=(0,o.Z)(t);try{for(i.s();!(r=i.n()).done;){r.value.serialize(e)}}catch(n){i.e(n)}finally{i.f()}return e}e.push(0)}var se=function(){function e(t){(0,u.Z)(this,e),this.insertAfter=null,this.id=t,this.displayRecords=[]}return(0,l.Z)(e,[{key:"copy",value:function(){var t=new e(this.id);return t.set(this),t}},{key:"clone",value:function(){var t=new e(this.id);return t.displayRecords=this.displayRecords.map((function(e){return e.clone()})),t.insertAfter=this.insertAfter,t}},{key:"set",value:function(e){this.id=e.id,this.displayRecords=e.displayRecords,this.insertAfter=e.insertAfter}},{key:"serialize",value:function(e){return e.push(this.id),ae(e,this.displayRecords),e}}],[{key:"deserialize",value:function(t){var r,i=t.readInt32(),n=new e(i),a={id:i};return n.displayRecords=null!==(r=function(e,t,r){for(var i=e.readInt32(),n=new Array(i),a=0;a<n.length;a++)n[a]=t.deserialize(e,r);return n}(t,ne,a))&&void 0!==r?r:[],n}}]),e}(),oe=function(){function e(){(0,u.Z)(this,e),this.displayObjects=[],this._displayList=null}return(0,l.Z)(e,[{key:"displayObjectRegistry",get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;var e,t=(0,o.Z)(this.displayObjects);try{for(t.s();!(e=t.n()).done;){var r=e.value;this._displayObjectRegistry.set(r.id,r)}}catch(i){t.e(i)}finally{t.f()}}return this._displayObjectRegistry}},{key:"displayList",get:function(){return this._displayList}},{key:"computeDisplayList",value:function(){this._displayList=new Q;var e,t=(0,o.Z)(this.displayObjects);try{for(t.s();!(e=t.n()).done;){var r,i=e.value,n=(0,o.Z)(i.displayRecords);try{for(n.s();!(r=n.n()).done;){var a=r.value;this._displayList.addToList(a)}}catch(s){n.e(s)}finally{n.f()}}}catch(s){t.e(s)}finally{t.f()}}},{key:"clone",value:function(){var t=new e;return this.displayObjects&&(t.displayObjects=this.displayObjects.map((function(e){return e.clone()}))),t}},{key:"serialize",value:function(e){return ae(e,this.displayObjects),e}},{key:"_deserializeObjects",value:function(e){for(var t=e.readInt32(),r=new Array(t),i=new Map,n=0;n<r.length;++n){var a=se.deserialize(e);r[n]=a,i.set(a.id,a)}this.displayObjects=r,this._displayList=null,this._displayObjectRegistry=i}}],[{key:"deserialize",value:function(t){var r=new e;return r._deserializeObjects(t),r}}]),e}(),ue=r(50477),le=function(){function e(t,r){(0,u.Z)(this,e),this.data=t,this.stride=r}return(0,l.Z)(e,null,[{key:"decode",value:function(t){return new e((0,N.e2)(t.data,t.stride),t.stride)}},{key:"fromVertexVector",value:function(t){return new e((0,N.e2)(t.data.buffer(),t.stride),t.stride)}}]),e}(),he=function(){function e(t,r,i){(0,u.Z)(this,e),this.geometryType=t,this.indexBuffer=new Uint32Array(r),this.namedBuffers=i}return(0,l.Z)(e,null,[{key:"decode",value:function(t){var r=t.geometryType,i=t.indexBuffer,n={};for(var a in t.namedBuffers)n[a]=le.decode(t.namedBuffers[a]);return new e(r,i,n)}},{key:"fromVertexData",value:function(t,r){var i=t.indices,n=(0,N.e2)(t.vertices,t.stride),a=t.stride;return new e(r,i,{geometry:new le(n,a)})}},{key:"fromVertexVectors",value:function(t){var r=t.geometryType,i=t.indexVector.buffer(),n={};for(var a in t.namedVectors)n[a]=le.fromVertexVector(t.namedVectors[a]);return new e(r,i,n)}}]),e}(),de=r(27446),ce=function(){function e(t,r){(0,u.Z)(this,e),this.data=t,this.stride=r}return(0,l.Z)(e,[{key:"vertexCount",get:function(){var e=this.stride/4,t=this.data.length/e;return t!==(0|t)&&console.debug("Corrupted stride"),t}},{key:"transfer",value:function(e,t){var r=this.data.buffer();e.vertexCount=this.vertexCount,e.data=r,e.stride=this.stride,t.push(r)}}]),e}(),fe=function(){function e(t,r,i){(0,u.Z)(this,e),this.geometryType=t,this.indexVector=new de.Z(Uint32Array,6*r),this.namedVectors={};var n=(0,N.$_)(t,i);for(var a in n){var s=n[a],o=void 0;switch(s%4){case 0:case 2:o=new de.Z(Uint32Array,s*r);break;case 1:case 3:o=new de.Z(Uint8Array,s*r)}this.namedVectors[a]=new ce(o,s)}}return(0,l.Z)(e,[{key:"get",value:function(e){return this.namedVectors[e].data}},{key:"getVector",value:function(e){return this.namedVectors[e]}},{key:"transfer",value:function(e,t){var r=this.indexVector.buffer(),i={};for(var n in t.push(r),this.namedVectors){var a=this.namedVectors[n];i[n]={},a.transfer(i[n],t)}e.geometryType=this.geometryType,e.indexBuffer=r,e.namedBuffers=i,this.destroy()}},{key:"intoBuffers",value:function(){var e=he.fromVertexVectors(this);return this.destroy(),e}},{key:"destroy",value:function(){this.indexVector=null,this.namedVectors=null}}]),e}(),ve=new H,ye=new H;function pe(e,t){var r={};for(var i in e){var n={data:(0,N.C$)(t,e[i]),stride:e[i]};r[i]=n}return r}var me=function(){function e(){(0,u.Z)(this,e),this.tileDisplayData=null,this.tileBufferData=null}return(0,l.Z)(e,[{key:"reshuffle",value:function(){var t;if(ve.reset(),this.tileDisplayData){var r,i=function(e){var t,r=[[],[],[],[],[]],i=e,n=(0,o.Z)(i);try{for(n.s();!(t=n.n()).done;){var a,s=t.value,u=(0,o.Z)(s.displayRecords);try{for(u.s();!(a=u.n()).done;){var l=a.value;r[l.geometryType].push(l)}}catch(h){u.e(h)}finally{u.f()}}}catch(h){n.e(h)}finally{n.f()}return r}(this.tileDisplayData.displayObjects),n=(0,o.Z)(i);try{for(n.s();!(r=n.n()).done;){var a,s=r.value,u=(0,o.Z)(s);try{for(u.s();!(a=u.n()).done;){var l=a.value;l&&ve.needMore(l.geometryType,l.meshData?l.meshData.vertexCount:l.vertexCount,l.meshData?l.meshData.indexData.length:l.indexCount)}}catch(E){u.e(E)}finally{u.f()}}}catch(E){n.e(E)}finally{n.f()}for(var h=i.length,d=new W,c=0;c<h;++c){var f;d.geometries[c].indexBuffer=new Uint32Array(Math.round(1.5*ve.indicesFor(c)));var v=[],y=null===(f=this.tileBufferData)||void 0===f?void 0:f.geometries[c].vertexBuffer;if(y){for(var p in y)v.push(y[p].stride);var m=e._computeVertexAlignment(v),g=Math.round(1.5*ve.verticesFor(c)),_=e._align(g,m);for(var x in y){var b=y[x].stride;d.geometries[c].vertexBuffer[x]={stride:b,data:(0,N.C$)(_,b)}}}}ye.reset(),null===(t=this.tileDisplayData.displayList)||void 0===t||t.clear();for(var Z=0;Z<h;++Z){var k,C=i[Z],T=(0,o.Z)(C);try{for(T.s();!(k=T.n()).done;){var I=k.value;if(I.meshData)I.writeMeshDataToBuffers(ye.verticesFor(Z),d.geometries[Z].vertexBuffer,ye.indicesFor(Z),d.geometries[Z].indexBuffer),I.meshData=null;else{var w,F=null===(w=this.tileBufferData)||void 0===w?void 0:w.geometries[Z];if(F){var D=F.vertexBuffer,M=F.indexBuffer,B=d.geometries[Z].vertexBuffer,S=d.geometries[Z].indexBuffer,R=ye.verticesFor(Z),L=ye.indicesFor(Z);(0,N.wO)(R,L,B,S,I,D,M),I.vertexFrom=R,I.indexFrom=L}}ye.needMore(Z,I.vertexCount,I.indexCount)}}catch(E){T.e(E)}finally{T.f()}}var A=this.tileDisplayData,O=A.displayList,U=A.displayObjects;if(O){var P,z=(0,o.Z)(U);try{for(z.s();!(P=z.n()).done;){var G=P.value;O.addToList(G.displayRecords)}}catch(E){z.e(E)}finally{z.f()}}this.tileBufferData=d}}},{key:"getStrides",value:function(){var e,t=[],r=null===(e=this.tileBufferData)||void 0===e?void 0:e.geometries;if(!r)return t;for(var i=0;i<r.length;++i){var n=r[i];for(var a in t[i]={},n.vertexBuffer)t[i][a]=n.vertexBuffer[a].stride}return t}},{key:"clone",value:function(){var t,r,i,n,a=new e;return a.tileBufferData=null!==(t=null===(r=this.tileBufferData)||void 0===r?void 0:r.clone())&&void 0!==t?t:null,a.tileDisplayData=null!==(i=null===(n=this.tileDisplayData)||void 0===n?void 0:n.clone())&&void 0!==i?i:null,a}},{key:"_guessSize",value:function(){for(var e,t,r=null!==(e=null===(t=this.tileDisplayData)||void 0===t?void 0:t.displayObjects)&&void 0!==e?e:[],i=Math.min(r.length,4),n=0,a=0;a<i;a++)n=Math.max(n,r[a].displayRecords.length);return 2*(12*r.length+r.length*n*40)}},{key:"serialize",value:function(){var e=this.tileBufferData.serialize(),t=this.tileBufferData.getBuffers(),r=this.tileDisplayData.serialize(new de.Z(Int32Array,this._guessSize())).buffer();return t.push(r),{result:{displayData:r,bufferData:e},transferList:t}}}],[{key:"fromVertexData",value:function(t,r){var i,n={},a=new Map,s=(0,o.Z)(r);try{for(s.s();!(i=s.n()).done;){var u=i.value;a.set(u.id,u)}}catch(l){s.e(l)}finally{s.f()}return(0,N.Z_)((function(e){var r=t.data[e];if((0,g.pC)(r)){for(var i=ue.$.from(r.records).getCursor();i.next();){var s=i.id,o=i.materialKey,u=i.indexFrom,l=i.indexCount,h=i.vertexFrom,d=i.vertexCount,c=a.get(s),f=new ne(s,e,o);f.indexFrom=u,f.indexCount=l,f.vertexFrom=h,f.vertexCount=d,c.displayRecords.push(f)}n[e]=he.fromVertexData(r,e)}else n[e]=new fe(e,0,R.mD.DEFAULT).intoBuffers()})),e.fromMeshData({displayObjects:r,vertexBuffersMap:n})}},{key:"fromMeshData",value:function(t){var r=new e,i=new oe,n=new W;for(var a in i.displayObjects=t.displayObjects,t.vertexBuffersMap){var s=t.vertexBuffersMap[a];n.geometries[a].indexBuffer=s.indexBuffer,n.geometries[a].vertexBuffer=s.namedBuffers}return r.tileDisplayData=i,r.tileBufferData=n,r}},{key:"bind",value:function(t,r){var i=new e;return i.tileDisplayData=t,i.tileBufferData=r,i}},{key:"create",value:function(t,r){var i=new e;i.tileDisplayData=new oe,i.tileDisplayData.displayObjects=t;var n,a=[0,0,0,0,0],s=[0,0,0,0,0],u=[[],[],[],[],[]],l=(0,o.Z)(t);try{for(l.s();!(n=l.n()).done;){var h,d=n.value,c=(0,o.Z)(d.displayRecords);try{for(c.s();!(h=c.n()).done;){var f=h.value;u[f.geometryType].push(f),a[f.geometryType]+=f.meshData.vertexCount,s[f.geometryType]+=f.meshData.indexData.length}}catch(_){c.e(_)}finally{c.f()}}}catch(_){l.e(_)}finally{l.f()}for(var v=new W,y=function(e){return[e.fill||{},e.line||{},e.icon||{},e.text||{},e.label||{}]}(r),p=0;p<5;p++){var m=new Uint32Array(s[p]),g=pe(y[p],a[p]);ne.writeAllMeshDataToBuffers(u[p],g,m),v.geometries[p]={indexBuffer:m,vertexBuffer:g}}return i.tileBufferData=v,i}},{key:"_align",value:function(e,t){var r=e%t;return 0===r?e:e+(t-r)}},{key:"_computeVertexAlignment",value:function(e){var t,r=!1,i=!1,n=(0,o.Z)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;a%4==2?r=!0:a%4!=0&&(i=!0)}}catch(s){n.e(s)}finally{n.f()}return i?4:r?2:1}}]),e}(),ge=r(72774),_e=r(74017),xe=r(61909),be=r(69813),Ze=r(69534),ke=r(45367),Ce=r(56078),Te=r(83406),Ie=r(92010),we=function(e){(0,d.Z)(r,e);var t=(0,c.Z)(r);function r(e,i,n){var a;return(0,u.Z)(this,r),(a=t.call(this,e,i,null))._transform=n,a}return(0,l.Z)(r,[{key:"geometryType",get:function(){var e=this._current;return e?e.geometryType:null}},{key:"insertAfter",get:function(){return this._current.insertAfter}},{key:"readGraphic",value:function(){return this._current}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var e=new r(this.instance,this._features,this._transform);return this.copyInto(e),e}}],[{key:"from",value:function(e,t,i){var n,a=Ie.s.createInstance(),s=[],u=e.filter((function(e){return!!e.geometry})),l=(0,o.Z)(u);try{for(l.s();!(n=l.n()).done;){var h=n.value,d=(0,I.Ji)(h.geometry);(0,Te.E7)(s,[h],d,!1,!1,t)}}catch(c){l.e(c)}finally{l.f()}return new r(a,s,i)}}]),r}(r(28941).i),Fe=r(1413),De=r(17842),Me=r(31581),Be=r(376),Se=r(91340),Re=r(66726),Le=r(4954),Ae=r(58971),Oe=r(80457),Ue=new Oe.Z,Pe=new Oe.Z,ze="esriGeometryPolyline";function Ne(e){e.coords.length=0,e.lengths.length=0}var Ge=function(){function e(){(0,u.Z)(this,e),this.bounds=(0,C.Ue)(),this.graphic=null}return(0,l.Z)(e,[{key:"acquire",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;e&&this.set(e,t,r,i,n)}},{key:"release",value:function(){this.graphic=null,this.symbolResource=null,this.geometry=null}},{key:"symbol",get:function(){return this.symbolResource.symbol}},{key:"set",value:function(e,t,r,i,n){this.graphic=e,this.geometry=r,this.symbolResource=t,this.bounds=i,n&&(this.size=n)}},{key:"getGeometryQuantized",value:function(e,t,r,n){var a=this.geometry,o=(0,I.Ji)(a);if((0,g.Wi)(o))return null;switch(o){case"esriGeometryPolygon":var u,l=a.rings;if(!l||0===l.length)return null;if(!(u=1===l.length&&2===l[0].length?(0,Ae.ym)(e,{paths:[[l[0][0],l[0][1]]]}):(0,Ae.ym)(e,this.geometry))){var h={x:l[0][0][0],y:l[0][0][1]};if(u=(0,Ae.ym)(e,h)){var d=u;return{rings:[[[d.x-1,d.y],[1,-1],[1,1],[-1,1],[-1,-1]]]}}}return u;case"esriGeometryPolyline":var c,f,v,y,p=a;Ne(Ue),Ne(Pe);var m=null!==(c=p.hasZ)&&void 0!==c&&c,_=null!==(f=p.hasM)&&void 0!==f&&f;return(0,Te.u0)(Ue,p),(0,Te.zj)(Pe,Ue,m,_,ze,e.scale[0]),(0,Te.Nh)(Ue,Pe,m,_,ze,e),(0,Te.J6)(Ue,null!==(v=p.hasZ)&&void 0!==v&&v,null!==(y=p.hasM)&&void 0!==y&&y);case"esriGeometryMultipoint":var x=a,b=.5*n*Math.max(Math.abs(this.size[0])+this.size[2]-this.size[0],Math.abs(this.size[1])+this.size[3]-this.size[1]),Z=(0,F.C5)(r),k=x.points;if(Z){var T=(0,i.Z)(Z.valid,2),w=T[0],D=T[1],M=D-w;k=k.filter((function(e){if(e[0]+b>D||e[0]-b<w){var r=(0,s.Z)(e);return e[0]+b>D?r[0]-=M:r[0]+=M,(0,C.Zm)(t,e,b)||(0,C.Zm)(t,r,b)}return(0,C.Zm)(t,e,b)}))}return 0===k.length?{points:k}:(0,Ae.ym)(e,{points:k})}return(0,Ae.ym)(e,this.geometry)}}],[{key:"acquire",value:function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;return 0===e._pool.length?t=new e:(t=e._pool.pop(),this._set.delete(t)),t.acquire(r,i,n,a,s),t}},{key:"release",value:function(e){e&&!this._set.has(e)&&(e.release(),this._pool.push(e),this._set.add(e))}},{key:"getCentroidQuantized",value:function(e,t){if((0,I.oU)(e.geometry)){var r=e.symbol;if((0,g.Wi)(r))return null;if((null===r||void 0===r?void 0:r.layers.length)>0&&r.layers.some((function(e){return"text"===e.type||"marker"===e.type}))){var i=(0,Le.tO)(e.geometry);return null!==i?(0,Ae.RF)(t,{},{x:i[0],y:i[1]},!1,!1):null}}return null}}]),e}();Ge._pool=[],Ge._set=new Set;var Ee=r(95857),Ve={minX:0,minY:0,maxX:0,maxY:0},je=(0,C.Ue)(),Ke=1e-5;function qe(e,t,r,i,n){return Ve.minX=t,Ve.minY=r,Ve.maxX=i,Ve.maxY=n,e.search(Ve)}function Ye(e){return{minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}}var He=function(){function e(t,r,i,n,a,s,o){(0,u.Z)(this,e),this._graphics=n,this._onAdd=a,this._onRemove=s,this._hashToCIM=o,this._index=(0,Me.r)(9,Ye),this._itemByGraphic=new Map,this._inflatedSizeHelper=new M.bP,this._tileInfoView=t,this._uidFieldName=i;var l=t.getClosestInfoForScale(r);l&&(this._resolution=this._tileInfoView.getTileResolution(l.level))}return(0,l.Z)(e,[{key:"setResourceManager",value:function(e){this._cimResourceManager=e,this._hittestDrawHelper=new Re.Tu(e)}},{key:"hitTest",value:function(e,t,r,i,n){e=(0,Se.or)(e,this._tileInfoView.spatialReference);var a=.5*i*window.devicePixelRatio*r;je[0]=e-a,je[1]=t-a,je[2]=e+a,je[3]=t+a;var s=.5*i*(r+Ee.y1),u=qe(this._index,e-s,t-s,e+s,t+s);if(!u||0===u.length)return[];var l,h=[],d=(0,C.Ue)(),c=(0,C.Ue)(),f=(0,o.Z)(u);try{for(f.s();!(l=f.n()).done;){var v,y=l.value,p=y.geometry,m=y.symbolResource;this._getSymbolBounds(d,m,p,c,n),c[3]=c[2]=c[1]=c[0]=0,(0,C.kK)(d,je)&&(null===(v=y.graphic)||void 0===v?void 0:v.visible)&&h.push(y)}}catch(D){f.e(D)}finally{f.f()}if(0===h.length)return[];for(var g=this._hittestDrawHelper,_=[],x=0,b=h;x<b.length;x++){var Z=b[x],k=Z.geometry,T=Z.symbolResource,I=T.hash,w=T.textInfo,F=this._hashToCIM.get(I);F&&g.hitTest(je,F.symbol,k,w,n,i)&&_.push(Z)}return _.sort(We),_.map((function(e){return e.graphic}))}},{key:"getGraphicsData",value:function(e,t,r){var i=this._searchForItems(t);if(0===i.length||0===r.length)return[];i.sort((function(e,t){return e.zorder-t.zorder})),i[0].insertAfter=-1;for(var n=1;n<i.length;n++)i[n].insertAfter=i[n-1].graphic.uid;i.sort((function(e,t){return e.graphic.uid-t.graphic.uid})),r.sort((function(e,t){return e.uid-t.uid}));var a,s,u=0,l=0,h=t.resolution,d=[],c={originPosition:"upperLeft",scale:[h,h],translate:[t.bounds[0],t.bounds[3]]},f=(0,o.Z)(r);try{for(f.s();!(s=f.n()).done;){var v,y=s.value;for(l=-2;u<i.length;)if(a=i[u],u++,y.uid===a.graphic.uid){l=a.insertAfter;break}if(null!==(v=a)&&void 0!==v&&v.geometry&&-2!==l){var p=a.getGeometryQuantized(c,t.bounds,this._tileInfoView.spatialReference,h),m=(0,Fe.Z)({},a.graphic.attributes);m[this._uidFieldName]=y.uid,null==a.groupId&&(a.groupId=e.createTemplateGroup(a.symbol,null)),d.push({centroid:Ge.getCentroidQuantized(a,c),geometry:p,attributes:m,symbol:a.symbol,groupId:a.groupId,insertAfter:l,zorder:a.zorder})}}}catch(g){f.e(g)}finally{f.f()}return d.sort((function(e,t){return e.zorder-t.zorder})),d}},{key:"queryTileData",value:function(e,t){if(0===this._graphics.length)return[];var r=t.bounds,i=t.resolution,n=this._searchForItems(t),a=[];return 0===n.length||this._createTileGraphics(a,e,n,{originPosition:"upperLeft",scale:[i,i],translate:[r[0],r[3]]},t),a}},{key:"has",value:function(e){return this._itemByGraphic.has(e)}},{key:"getBounds",value:function(e){var t=this._itemByGraphic.get(e);return t?t.bounds:null}},{key:"getAllBounds",value:function(){return Array.from(this._itemByGraphic.values()).filter((function(e){return e.graphic.visible})).map((function(e){return e.bounds}))}},{key:"addOrModify",value:function(e,t,r){if(e&&!(0,g.Wi)(t)){this.has(e)&&this.remove(e),this._onAdd(e);var i=[0,0,0,0],n=this._getSymbolBounds(null,t,r,i,0),a=Ge.acquire(e,t,r,(0,g.pC)(n)?n:null,i);return this._itemByGraphic.set(e,a),r&&this._index.insert(a),a.bounds}}},{key:"remove",value:function(e){if(this._itemByGraphic.has(e)){this._onRemove(e);var t=this._itemByGraphic.get(e);null!==t&&void 0!==t&&t.bounds&&this._index.remove(t),this._itemByGraphic.delete(e)}}},{key:"updateZ",value:function(){for(var e,t,r=this._graphics.items,i=0;i<r.length;i++)t=r[i],(e=this._itemByGraphic.get(t))&&(e.zorder=i)}},{key:"update",value:function(e,t,r){var i=this._itemByGraphic.get(e);i.groupId=null;var n=(0,C.d9)(i.bounds);this._index.remove(i);var a=this._getSymbolBounds(i.bounds,t,r,i.size,0);return(0,g.pC)(a)&&i.set(e,t,r,a,i.size),r&&this._index.insert(i),{oldBounds:n,newBounds:i.bounds}}},{key:"updateLevel",value:function(e){if(this._resolution!==e){this._resolution=e,this._index.clear();var t,r=this._itemByGraphic,n=[],a=(0,o.Z)(r);try{for(a.s();!(t=a.n()).done;){var s=(0,i.Z)(t.value,2),u=(s[0],s[1]),l=this._getSymbolBounds(u.bounds,u.symbolResource,u.geometry,u.size,0);u.geometry&&(0,g.pC)(l)&&(u.bounds=l,n.push(u))}}catch(h){a.e(h)}finally{a.f()}this._index.load(n)}}},{key:"clear",value:function(){this._itemByGraphic.clear(),this._index.clear()}},{key:"_createTileGraphics",value:function(e,t,r,i,n){var a,s,o,u,l=this._uidFieldName,h=this._tileInfoView.spatialReference,d=n.bounds,c=n.resolution;r.sort((function(e,t){return e.zorder-t.zorder}));for(var f=0;f<r.length;f++){a=(o=r[f]).graphic,s=o.getGeometryQuantized(i,d,h,c),u=0===f?-1:r[f-1].graphic.uid;var v=(0,Fe.Z)({},o.graphic.attributes);v[l]=a.uid,null==o.groupId&&(o.groupId=t.createTemplateGroup(o.symbol,null)),e.push({centroid:Ge.getCentroidQuantized(o,i),geometry:s,attributes:v,symbol:o.symbol,groupId:o.groupId,insertAfter:u,zorder:o.zorder})}}},{key:"_searchForItems",value:function(e){var t=this._tileInfoView.spatialReference,r=e.bounds,n=(0,F.C5)(t);if(n&&t.isWrappable){var a=(0,i.Z)(n.valid,2),o=a[0],u=a[1],l=Math.abs(r[2]-u)<Ke,h=Math.abs(r[0]-o)<Ke;if((!l||!h)&&(l||h)){var d,c=e.resolution;d=(0,C.Ue)(l?[o,r[1],o+c*Ee.y1,r[3]]:[u-c*Ee.y1,r[1],u,r[3]]);var f=qe(this._index,r[0],r[1],r[2],r[3]),v=qe(this._index,d[0],d[1],d[2],d[3]);return(0,s.Z)(new Set([].concat((0,s.Z)(f),(0,s.Z)(v))))}}return qe(this._index,r[0],r[1],r[2],r[3])}},{key:"_getSymbolBounds",value:function(e,t,r,i,n){if(!t||!t.symbol||!r)return null;if(e||(e=(0,C.Ue)()),(0,Be.$P)(e,r),!i||0===i[0]&&0===i[1]&&0===i[2]&&0===i[3]){var a=t.hash,s=t.textInfo,o=this._hashToCIM.get(a);if(!o)return null;i||(i=[0,0,0,0]);var u=this._inflatedSizeHelper.getSymbolInflateSize(i,o.symbol,this._cimResourceManager,n,s);i[0]=(0,De.F2)(u[0]),i[1]=(0,De.F2)(u[1]),i[2]=(0,De.F2)(u[2]),i[3]=(0,De.F2)(u[3])}var l=this._resolution,h=M.bP.safeSize(i);return e[0]-=h*l,e[1]-=h*l,e[2]+=h*l,e[3]+=h*l,e}}]),e}(),We=function(e,t){var r=(0,Ee.eT)(e.graphic),i=(0,Ee.eT)(t.graphic);return r===i?t.zorder-e.zorder:r-i},Xe=r(98125),Je=r(35818),Qe=r(90316),$e=r(85164),et=(0,m.Z)("esri-2d-graphic-debug");function tt(e,t,r){var i=r.get(e);return i||(i={tile:t,addedOrModified:[],removed:[]},r.set(e,i)),i}var rt=function(e){(0,d.Z)(r,e);var t=(0,c.Z)(r);function r(e){var i;return(0,u.Z)(this,r),(i=t.call(this,e))._storage=new Ce.O,i._displayIds=new Map,i._controller=new AbortController,i._tiles=new Map,i._graphicStoreUpdate=!1,i._graphicsSet=new Set,i._matcher=Promise.resolve(null),i._tileUpdateSet=new Set,i._tilesToUpdate=new Map,i._graphicIdToAbortController=new Map,i._attached=!1,i._updatingGraphicsTimer=null,i._hashToExpandedSymbol=new Map,i._hashToExpandedSymbolPromise=new Map,i._hashToCIMSymbolPromise=new Map,i._hashToCIM=new Map,i._processing=!1,i._needsProcessing=!1,i._pendingUpdate={added:new Set,updated:new Set,removed:new Set},i.lastUpdateId=-1,i.updateRequested=!1,i.defaultPointSymbolEnabled=!0,i.graphicUpdateHandler=i.graphicUpdateHandler.bind((0,h.Z)(i)),i}return(0,l.Z)(r,[{key:"destroy",value:function(){this._updatingGraphicsTimer&&(clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=null,this.notifyChange("updating")),this._controller.abort(),this.container.destroy(),this._set("graphics",null),this._graphicStore.clear(),this._attributeStore=null,this._hashToExpandedSymbol.clear(),this.view=null,this.renderer=null,this._hashToCIM.clear(),this._hashToCIMSymbolPromise.clear(),this._hashToExpandedSymbolPromise.clear()}},{key:"_createMatcher",value:function(e,t,r){if(e){var i=(0,Ze.q5)(e),n=(0,Ze.MD)({indexCount:0,fields:{}},"feature",e,i);this._matcher=(0,be.fL)(n,t,null,r)}}},{key:"_createDisplayId",value:function(e){var t=this._displayIds.get(e);return t||(t=this._storage.createDisplayId(),this._displayIds.set(e,t)),t}},{key:"initialize",value:function(){var e=this;this._attributeStore=new ke.Z({type:"local",initialize:function(t){return Promise.resolve(e.container.attributeView.initialize(t))},update:function(t){return e.container.attributeView.requestUpdate(t)},render:function(){return e.container.requestRender()}},(0,Qe.hc)("2d"),(function(){return e.notifyChange("updating")})),this.container.hasHighlight=function(){return e._attributeStore.hasHighlight};var t=new xe.Wr(this.container.getMaterialItems.bind(this.container),this.view.featuresTilingScheme.tileInfo);this._graphicStore=new He(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,(function(t){e._createDisplayId(t.uid),e._setFilterState(t.uid,t.visible)}),(function(t){var r=e._displayIds.get(t.uid);e._displayIds.delete(t.uid),e._storage.releaseDisplayId(r)}),this._hashToCIM),this._meshFactory=new _e.j(null,this.uid,t),this._templateStore=t,this.handles.add([(0,x.YP)((function(){return e.renderer}),(function(r){e._createMatcher(r,t,e.container.stage.resourceManager);var i,n=(0,o.Z)(e.graphics);try{for(n.s();!(i=n.n()).done;){var a=i.value;e._pendingUpdate.updated.add(a)}}catch(s){n.e(s)}finally{n.f()}e.requestUpdate()})),this.view.graphicsTileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",(function(){et&&e.container.enableRenderingBounds((function(){return e._graphicStore.getAllBounds()})),e.graphics.items.length>0&&e._graphicsChangeHandler({target:e.graphics,added:e.graphics.items,removed:[],moved:[]}),e.handles.add(e.graphics.on("change",(function(t){return e._graphicsChangeHandler(t)})),"graphics");var r=e.container.stage.resourceManager;e._createMatcher(e.renderer,t,r),e._graphicStore.setResourceManager(r),e._attached=!0,e.notifyChange("updating")}))]);var r=this.view.graphicsTileStore.tiles;this._onTileUpdate({added:r,removed:[]})}},{key:"updating",get:function(){return!this._attached||null!==this._updatingGraphicsTimer||this._tileUpdateSet.size>0||this._tilesToUpdate.size>0||this._attributeStore.isUpdating()}},{key:"hitTest",value:function(e){if(!this.view||!this.view.position)return[];var t=this.view.state,r=t.resolution,i=t.rotation;return this._graphicStore.hitTest(e.x,e.y,2,r,i)}},{key:"update",value:function(e){(0,_.k_)(this._controller.signal);var t=e.state.resolution;if(this._graphicStore.updateLevel(t),this._graphicStoreUpdate=!0,this.updateRequested=!1,this._pendingUpdate.updated.size>0){if(!this._processing)return void this._updateGraphics();this._needsProcessing=!0}}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback())}},{key:"processUpdate",value:function(e){this.updateRequested&&(this.updateRequested=!1,this.update(e))}},{key:"graphicUpdateHandler",value:function(e){var t=e.graphic;switch(e.property){case"attributes":case"geometry":case"symbol":this._pendingUpdate.updated.add(t),this.requestUpdate();break;case"visible":this._setFilterState(t.uid,t.visible),this._attributeStore.sendUpdates()}}},{key:"setHighlight",value:function(e){var t=this,r=e.map((function(e){return t._displayIds.get(e)})).filter(g.pC);this._attributeStore.setHighlight(e,r)}},{key:"_getIntersectingTiles",value:function(e){var t=this._graphicStore.getBounds(e);if(!t||0===(0,C.bf)(t)||0===(0,C.Cb)(t))return[];var r=(0,Ee.Zu)(t,this.view.spatialReference);return(0,g.pC)(r)?(0,s.Z)(new Set([].concat((0,s.Z)(this.view.graphicsTileStore.boundsIntersections(r[0])),(0,s.Z)(this.view.graphicsTileStore.boundsIntersections(r[1]))))):this.view.graphicsTileStore.boundsIntersections(t)}},{key:"_updateTile",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,i,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_.k_)(this._controller.signal),r=t.tile,i=this._getGraphicsData(this._templateStore,r,t.addedOrModified),e.next=5,this._processGraphics(r,i);case 5:return a=e.sent,e.abrupt("return",((0,_.k_)(this._controller.signal),this._patchTile(r.key,{type:"update",addOrUpdate:a,remove:t.removed,end:!0,clear:!1,sort:!1}),a));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_patchTile",value:function(e,t){var r=this._tiles.get(e);r&&(this.container.onTileData(r,t),this.container.requestRender())}},{key:"_graphicsChangeHandler",value:function(e){var t,r=this._pendingUpdate,i=(0,o.Z)(e.added);try{for(i.s();!(t=i.n()).done;){var n=t.value;r.added.add(n)}}catch(c){i.e(c)}finally{i.f()}var a,s=(0,o.Z)(e.moved);try{for(s.s();!(a=s.n()).done;){var u=a.value;r.updated.add(u)}}catch(c){s.e(c)}finally{s.f()}var l,h=(0,o.Z)(e.removed);try{for(h.s();!(l=h.n()).done;){var d=l.value;this._pendingUpdate.added.has(d)?r.added.delete(d):r.removed.add(d)}}catch(c){h.e(c)}finally{h.f()}this._processing?this._needsProcessing=!0:this._updateGraphics()}},{key:"_getGraphicsToUpdate",value:function(){var e={added:[],removed:[],updated:[]};if(!this.graphics)return e;var t,r=this._pendingUpdate,i=(0,o.Z)(this.graphics.items);try{for(i.s();!(t=i.n()).done;){var n=t.value;r.added.has(n)?e.added.push(n):r.updated.has(n)&&e.updated.push(n)}}catch(l){i.e(l)}finally{i.f()}var a,s=(0,o.Z)(r.removed);try{for(s.s();!(a=s.n()).done;){var u=a.value;this._graphicStore.has(u)&&e.removed.push(u)}}catch(l){s.e(l)}finally{s.f()}return r.added.clear(),r.removed.clear(),r.updated.clear(),e}},{key:"_updateGraphics",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t,r,a,s,u,l,h,d,c,f,v,y,p,m,g,x,b,Z,k,C,T,I,w,F,D,M,B,S,R,L,A,O,U,P,z,N,G,E,V,j,K;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this._processing=!0,t=this._getGraphicsToUpdate(),r=t.added,a=t.removed,s=t.updated,u=this._tilesToUpdate,e.prev=2,this._graphicStoreUpdate||(l=this.view.state,h=l.resolution,this._graphicStore.updateLevel(h)),d=[],c=new Array(r.length+a.length),f=0;f<s.length;f++){v=s[f],y=this._getIntersectingTiles(v),p=(0,o.Z)(y);try{for(p.s();!(m=p.n()).done;)g=m.value,tt(g.id,g,u).removed.push(this._displayIds.get(v.uid))}catch(n){p.e(n)}finally{p.f()}d.push(this._updateGraphic(v,null)),c[f]=v}for(x=s.length,b=0;b<r.length;b++)Z=r[b],c[x+b]=Z,this._graphicsSet.add(Z),d.push(this._addGraphic(Z));k=(0,o.Z)(a);try{for(k.s();!(C=k.n()).done;){T=C.value,this._abortProcessingGraphic(T.uid),I=this._getIntersectingTiles(T),w=(0,o.Z)(I);try{for(w.s();!(F=w.n()).done;)D=F.value,tt(D.id,D,u).removed.push(this._displayIds.get(T.uid))}catch(n){w.e(n)}finally{w.f()}this._graphicsSet.delete(T),this._graphicStore.remove(T)}}catch(n){k.e(n)}finally{k.f()}return this._flipUpdatingGraphics(),e.next=13,Promise.all(d);case 13:for(B=0;B<c.length;B++){M=c[B],S=this._getIntersectingTiles(M),R=(0,o.Z)(S);try{for(R.s();!(L=R.n()).done;)A=L.value,tt(A.id,A,u).addedOrModified.push(M)}catch(n){R.e(n)}finally{R.f()}}this._graphicStore.updateZ(),O=[],U=(0,o.Z)(u);try{for(U.s();!(P=U.n()).done;)z=(0,i.Z)(P.value,2),z[0],N=z[1],O.push(this._updateTile(N))}catch(n){U.e(n)}finally{U.f()}return e.next=20,Promise.all(O);case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(2),(0,_.D_)(e.t0);case 25:G=(0,o.Z)(a),e.prev=26,G.s();case 28:if((E=G.n()).done){e.next=42;break}return V=E.value,e.prev=30,e.next=33,this._getSymbolForGraphic(V,null);case 33:(j=e.sent)&&(K=j.hash(),this._hashToExpandedSymbol.delete(K)),e.next=40;break;case 37:e.prev=37,e.t1=e.catch(30),(0,_.D_)(e.t1);case 40:e.next=28;break;case 42:e.next=47;break;case 44:e.prev=44,e.t2=e.catch(26),G.e(e.t2);case 47:return e.prev=47,G.f(),e.finish(47);case 50:u.clear(),this.notifyChange("updating"),this._processing=!1,this._needsProcessing&&(this._needsProcessing=!1,this._updateGraphics());case 51:case"end":return e.stop()}}),e,this,[[2,22],[26,44,47,50],[30,37]])})));return function(){return e.apply(this,arguments)}}()},{key:"_getArcadeInfo",value:function(e){var t=(e.attributes?Object.keys(e.attributes):[]).map((function(t){return{name:t,alias:t,type:"string"==typeof e.attributes[t]?"esriFieldTypeString":"esriFieldTypeDouble"}}));return(0,g.Wi)(e.geometry)?null:{geometryType:(0,I.Ji)(e.geometry),spatialReference:k.Z.fromJSON(e.geometry.spatialReference),fields:t}}},{key:"_getSymbolForGraphic",value:function(e,t){return(0,_.k_)(this._controller.signal),(0,g.pC)(e.symbol)?Promise.resolve(e.symbol):(0,g.pC)(this.renderer)?this.renderer.getSymbolAsync(e,{scale:this.view.scale,signal:(0,g.pC)(t)?t.signal:null}):Promise.resolve(this._getNullSymbol(e))}},{key:"_getCIMSymbol",value:function(e,t,r){var i=this,n=this._hashToCIM.get(t);if(n)return Promise.resolve(n);var a=(0,M.rW)(e);if((0,g.pC)(a)){if("CIMSymbolReference"===a.type)return n=a,this._hashToCIM.set(t,n),Promise.resolve(n);var s=this._hashToCIMSymbolPromise.get(t);return s||(s=a.fetchCIMSymbol(r).then((function(e){return i._hashToCIM.set(t,e.data),i._hashToCIMSymbolPromise.delete(t),e})).catch((function(e){return i._hashToCIMSymbolPromise.delete(t),(0,_.r9)(e),null})),this._hashToCIMSymbolPromise.set(t,s),s)}return Promise.resolve(null)}},{key:"_expandCIMSymbol",value:function(e,t,r,i){var n=this,a=this._hashToExpandedSymbol.get(r);if(a)return Promise.resolve(a);var s=this._hashToExpandedSymbolPromise.get(r);if(s)return s;var o=this.container.stage,u=this._getArcadeInfo(t),l=(0,Ze.q5)(null),h=(0,$e.createSymbolSchema)(e,l);return s=(0,Xe.B)(h,u,o.resourceManager,i),this._hashToExpandedSymbolPromise.set(r,s),s.then((function(e){return n._hashToExpandedSymbol.set(r,e),n._hashToExpandedSymbolPromise.delete(r),e})),s}},{key:"_getSymbolResources",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r){var a=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,_.k_)(this._controller.signal),e.abrupt("return",this.container.stage?this._getSymbolForGraphic(t,r).then((function(e){if(!e)return null;var n=e.hash();return a._getCIMSymbol(e,n,r).then((function(e){return(0,g.Wi)(e)?null:a._expandCIMSymbol(e,t,n,r).then((function(e){var t=e.layers.filter((function(e){return"text"===e.type&&"string"==typeof e.text}));if(t&&t.length>0){for(var r=new Array(t.length),s=0;s<t.length;s++){var o=t[s],u=[],l=(0,y.E)(o.text),h=(0,i.Z)(l,1)[0];o.text=h;for(var d=0;d<h.length;d++)u.push(h.charCodeAt(d));r[s]={symbol:o,id:s,glyphIds:u}}var c=new Map;return a.container.getMaterialItems(r).then((function(r){(0,g.O3)(r);for(var i=0;i<t.length;i++){var a=t[i];c.set(a.cim,{text:a.text,mosaicItem:r[i].mosaicItem})}return{symbol:e,textInfo:c,hash:n}}))}return{symbol:e,hash:n}}))}))})).catch((function(e){return(0,_.r9)(e),null})):null);case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_projectAndNormalizeGeometry",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r){var i,a,s,o,u,l;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_.k_)(this._controller.signal),!(0,g.Wi)(t.geometry)&&"mesh"!==t.geometry.type){e.next=2;break}return e.abrupt("return",null);case 2:if(i=t.geometry,!(0,I.oU)(i)){e.next=8;break}a=i.rings,i.rings=a,e.next=18;break;case 8:if(!(0,I.l9)(i)){e.next=13;break}s=i.paths,i.paths=s,e.next=18;break;case 13:if(!(0,I.YX)(i)){e.next=18;break}return e.next=16,this._getSymbolForGraphic(t,r);case 16:o=e.sent,(0,_.k_)(this._controller.signal),i=o&&((0,Ee.yA)(o.type)||(0,Ee.ab)(o.type))?i.center:(0,Ee.XA)(i);case 18:return e.next=20,(0,D._W)(i.spatialReference,this.view.spatialReference);case 20:return u=(0,w.SR)(i),l=(0,D.iV)(u,i.spatialReference,this.view.spatialReference),e.abrupt("return",(l&&(0,T.pW)(l),l));case 22:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_onTileUpdate",value:function(e){var t=(0,F.C5)(this.view.spatialReference);if(e.added&&e.added.length>0){var r,i=(0,o.Z)(e.added);try{for(i.s();!(r=i.n()).done;){var n=r.value;this._addNewTile(n,t)}}catch(l){i.e(l)}finally{i.f()}}if(e.removed&&e.removed.length>0){var a,s=(0,o.Z)(e.removed);try{for(s.s();!(a=s.n()).done;){var u=a.value;this._removeTile(u.key)}}catch(l){s.e(l)}finally{s.f()}}}},{key:"_addGraphic",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._abortProcessingGraphic(t.uid),(0,_.k_)(this._controller.signal),r=new AbortController,this._graphicIdToAbortController.set(t.uid,r),i={signal:r.signal},e.prev=4,e.next=7,this._addOrUpdateGraphic(t,i);case 7:(0,_.k_)(this._controller.signal),this._graphicIdToAbortController.delete(t.uid),e.next=15;break;case 11:if(e.prev=11,e.t0=e.catch(4),this._graphicIdToAbortController.delete(t.uid),(0,_.D_)(e.t0)){e.next=15;break}throw e.t0;case 15:case"end":return e.stop()}}),e,this,[[4,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateGraphic",value:function(e,t){var r=this;(0,_.k_)(this._controller.signal);var n=this._projectAndNormalizeGeometry(e,t),a=this._getSymbolResources(e,t);return Promise.all([n,a]).then((function(t){var n=(0,i.Z)(t,2),a=n[0],s=n[1];(0,_.k_)(r._controller.signal),r._graphicStore.addOrModify(e,s,a)}))}},{key:"_addOrUpdateGraphic",value:function(e,t){var r=this;(0,_.k_)(this._controller.signal);var n=this._projectAndNormalizeGeometry(e,t),a=this._getSymbolResources(e,t);return Promise.all([n,a]).then((function(t){var n=(0,i.Z)(t,2),a=n[0],s=n[1];(0,_.k_)(r._controller.signal),r._graphicsSet.has(e)&&r._graphicStore.addOrModify(e,s,a)}))}},{key:"_addTile",value:function(e){var t=this.view.featuresTilingScheme.getTileBounds((0,C.Ue)(),e),r=this.view.featuresTilingScheme.getTileResolution(e.level),i=new Y(e,r,t[0],t[3]);return this._tiles.set(e,i),this.container.addChild(i),i}},{key:"_addNewTile",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r){var i,a,s,u,l,h,d,c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this._addTile(t.key),0!==(a=this._graphicStore.queryTileData(this._templateStore,t)).length){e.next=3;break}return e.abrupt("return");case 3:if(r){s=Math.round((r.valid[1]-r.valid[0])/t.resolution),u=(0,o.Z)(a);try{for(u.s();!(l=u.n()).done;)(h=l.value).geometry&&((0,I.wp)(h.geometry)||(0,I.aW)(h.geometry))&&this._wrapPoints(h,s)}catch(n){u.e(n)}finally{u.f()}}return d=t.key,this._tileUpdateSet.add(t.key),this.notifyChange("updating"),e.prev=6,e.t0=!1,e.next=10,this._processGraphics(t,a);case 10:e.t1=e.sent,e.t2=[],e.t3=!0,e.t4=!1,c={type:"update",clear:e.t0,addOrUpdate:e.t1,remove:e.t2,end:e.t3,sort:e.t4},i.patch(c),this._tileUpdateSet.delete(d),this.notifyChange("updating"),e.next=22;break;case 18:if(e.prev=18,e.t5=e.catch(6),this._tileUpdateSet.delete(d),this.notifyChange("updating"),(0,_.D_)(e.t5)){e.next=22;break}throw e.t5;case 22:case"end":return e.stop()}}),e,this,[[6,18]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_removeTile",value:function(e){if(this._tiles.has(e)){var t=this._tiles.get(e);this.container.removeChild(t),t.destroy(),this._tiles.delete(e)}}},{key:"_setFilterState",value:function(e,t){var r=this._displayIds.get(e),i=this._attributeStore.getHighlightFlag(e);this._attributeStore.setData(r,0,0,i|(t?S.Zd:0))}},{key:"_getGraphicsData",value:function(e,t,r){var i=this.view,n=(0,F.C5)(i.spatialReference),a=this._graphicStore.getGraphicsData(e,t,r);if(n){var s,u=Math.round((n.valid[1]-n.valid[0])/t.resolution),l=(0,o.Z)(a);try{for(l.s();!(s=l.n()).done;){var h=s.value;h.geometry&&((0,I.wp)(h.geometry)||(0,I.aW)(h.geometry))&&this._wrapPoints(h,u)}}catch(d){l.e(d)}finally{l.f()}}return a}},{key:"_wrapPoints",value:function(e,t){var r=e.geometry;(0,I.aW)(r)?this._wrapMultipoint(r,t):this._wrapPoint(e,t)}},{key:"_wrapMultipoint",value:function(e,t){var r,n=e.points,a=[],s=0,u=0,l=(0,o.Z)(n);try{for(l.s();!(r=l.n()).done;){var h=(0,i.Z)(r.value,2),d=h[0],c=h[1];if(a.push([d+s,c]),s=0,t===Ee.I_){var f=5*Ee.y1;d+u<f?(a.push([t,0]),s=-t):d+u>Ee.I_-f&&(a.push([-t,0]),s=t)}else d+u<-Ee.y1?(a.push([t,0]),s=-t):d+u>Ee.I_+Ee.y1&&(a.push([-t,0]),s=t);u+=d}}catch(v){l.e(v)}finally{l.f()}e.points=a}},{key:"_wrapPoint",value:function(e,t){var r=e.geometry;if(t===Ee.I_){var i=5*Ee.y1;r.x<i?e.geometry={points:[[r.x,r.y],[t,0]]}:r.x>Ee.I_-i&&(e.geometry={points:[[r.x,r.y],[-t,0]]})}else r.x<-Ee.y1?e.geometry={points:[[r.x,r.y],[t,0]]}:r.x>Ee.I_+Ee.y1&&(e.geometry={points:[[r.x,r.y],[-t,0]]})}},{key:"_processGraphics",value:function(e,t,r){var i=this;if(!t||!t.length||!this._meshFactory)return Promise.resolve(null);var n=we.from(t,this.uid,e.transform),a=this._meshFactory;return this._matcher.then((function(t){return a.analyzeGraphics(n,i.container.stage.resourceManager,t,null,null,r).then((function(){return i._attributeStore.sendUpdates(),i._processAnalyzedGraphics(e,n)}))}))}},{key:"_processAnalyzedGraphics",value:function(e,t){for(var r=this._meshFactory,i=t.getSize(),n=t.getCursor(),a={features:i,records:i,metrics:0},s=new ge._(e.key.id,a,R.mD.DEFAULT,!1,!1),o=[];n.next();){var u=n.readGraphic();u.insertAfter=-1===u.insertAfter?-1:this._displayIds.get(u.insertAfter),u.displayId=this._displayIds.get(u.attributes[this.uid]);var l=new se(u.displayId);l.insertAfter=u.insertAfter,o.push(l),r.writeGraphic(s,n,e.level,this.container.stage.resourceManager)}var h=e.tileInfoView.tileInfo.isWrappable,d=s.serialize(h);if(1!==d.length)return new me;var c=d[0].message;return me.fromVertexData(c,o)}},{key:"_abortProcessingGraphic",value:function(e){var t;null===(t=this._graphicIdToAbortController.get(e))||void 0===t||t.abort()}},{key:"_getNullSymbol",value:function(e){var t=e.geometry;return(0,I.l9)(t)?B.mW:(0,I.oU)(t)||(0,I.YX)(t)?B.kD:this.defaultPointSymbolEnabled?B.G:null}},{key:"_flipUpdatingGraphics",value:function(){var e=this;this._updatingGraphicsTimer&&clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=setTimeout((function(){e._updatingGraphicsTimer=null,e.notifyChange("updating")}),160),this.notifyChange("updating")}}]),r}((0,Je.I)((0,p.p)(v.Z)));(0,f._)([(0,b.Cb)({constructOnly:!0})],rt.prototype,"requestUpdateCallback",void 0),(0,f._)([(0,b.Cb)()],rt.prototype,"container",void 0),(0,f._)([(0,b.Cb)({constructOnly:!0})],rt.prototype,"graphics",void 0),(0,f._)([(0,b.Cb)()],rt.prototype,"updating",null),(0,f._)([(0,b.Cb)()],rt.prototype,"view",void 0),(0,f._)([(0,b.Cb)()],rt.prototype,"updateRequested",void 0),(0,f._)([(0,b.Cb)()],rt.prototype,"defaultPointSymbolEnabled",void 0);var it=rt=(0,f._)([(0,Z.j)("esri.views.2d.layers.support.GraphicsView2D")],rt)},35818:function(e,t,r){r.d(t,{I:function(){return d}});var i=r(43144),n=r(15671),a=r(60136),s=r(92572),o=r(27366),u=r(79056),l=r(49861),h=(r(25243),r(63780),r(69912)),d=function(e){var t=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).graphics=null,e.renderer=null,e}return(0,i.Z)(r)}((0,u.IG)(e));return(0,o._)([(0,l.Cb)()],t.prototype,"graphics",void 0),(0,o._)([(0,l.Cb)()],t.prototype,"renderer",void 0),(0,o._)([(0,l.Cb)()],t.prototype,"updating",void 0),(0,o._)([(0,l.Cb)()],t.prototype,"view",void 0),t=(0,o._)([(0,h.j)("esri.views.layers.GraphicsView")],t)}}}]);
//# sourceMappingURL=46642.d4dc9d4a.chunk.js.map