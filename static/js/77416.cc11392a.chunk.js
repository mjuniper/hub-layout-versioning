"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[77416],{40316:function(e,t,i){i.d(t,{E9:function(){return h},I6:function(){return u},Vl:function(){return s},bN:function(){return o}});var s,n,r=i(15671),a=i(43144);!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(s||(s={}));var h=function(){function e(t,i){(0,r.Z)(this,e),this.x=t,this.y=i}return(0,a.Z)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"equals",value:function(e,t){return e===this.x&&t===this.y}},{key:"isEqual",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"setCoords",value:function(e,t){this.x=e,this.y=t}},{key:"normalize",value:function(){var e=this.x,t=this.y,i=Math.sqrt(e*e+t*t);this.x/=i,this.y/=i}},{key:"rightPerpendicular",value:function(){var e=this.x;this.x=this.y,this.y=-e}},{key:"move",value:function(e,t){this.x+=e,this.y+=t}},{key:"assign",value:function(e){this.x=e.x,this.y=e.y}},{key:"assignAdd",value:function(e,t){this.x=e.x+t.x,this.y=e.y+t.y}},{key:"assignSub",value:function(e,t){this.x=e.x-t.x,this.y=e.y-t.y}},{key:"rotate",value:function(e,t){var i=this.x,s=this.y;this.x=i*e-s*t,this.y=i*t+s*e}},{key:"scale",value:function(e){this.x*=e,this.y*=e}},{key:"length",value:function(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}}],[{key:"distance",value:function(e,t){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}},{key:"add",value:function(t,i){return new e(t.x+i.x,t.y+i.y)}},{key:"sub",value:function(t,i){return new e(t.x-i.x,t.y-i.y)}}]),e}(),l=(0,a.Z)((function e(t,i,s){(0,r.Z)(this,e),this.ratio=t,this.x=i,this.y=s})),o=function(){function e(t,i,s){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;(0,r.Z)(this,e),this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=n,this._pixelMargin=a,this._tileSize=512*n,this._dz=t,this._yPos=i,this._xPos=s}return(0,a.Z)(e,[{key:"setPixelMargin",value:function(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}},{key:"setExtent",value:function(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);var t=this._pixelRatio*this._pixelMargin;t/=this._finalRatio;var i=e>>this._dz;t>i&&(t=i),this._margin=t,this._xmin=i*this._xPos-t,this._ymin=i*this._yPos-t,this._xmax=this._xmin+i+2*t,this._ymax=this._ymin+i+2*t}},{key:"reset",value:function(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}},{key:"moveTo",value:function(e,t){this._pushLine(),this._prevIsIn=this._isIn(e,t),this._moveTo(e,t,this._prevIsIn),this._prevPt=new h(e,t),this._firstPt=new h(e,t),this._dist=0}},{key:"lineTo",value:function(e,t){var i,s,n,r,a,o,u,c,y=this._isIn(e,t),_=new h(e,t),f=h.distance(this._prevPt,_);if(y)this._prevIsIn?this._lineTo(e,t,!0):(i=this._prevPt,s=_,n=this._intersect(s,i),this._start=this._dist+f*(1-this._r),this._lineTo(n.x,n.y,!0),this._lineTo(s.x,s.y,!0));else if(this._prevIsIn)s=this._prevPt,i=_,n=this._intersect(s,i),this._lineTo(n.x,n.y,!0),this._lineTo(i.x,i.y,!1);else{var v=this._prevPt,d=_;if(v.x<=this._xmin&&d.x<=this._xmin||v.x>=this._xmax&&d.x>=this._xmax||v.y<=this._ymin&&d.y<=this._ymin||v.y>=this._ymax&&d.y>=this._ymax)this._lineTo(d.x,d.y,!1);else{var g=[];if((v.x<this._xmin&&d.x>this._xmin||v.x>this._xmin&&d.x<this._xmin)&&(r=(this._xmin-v.x)/(d.x-v.x),(c=v.y+r*(d.y-v.y))<=this._ymin?o=!1:c>=this._ymax?o=!0:g.push(new l(r,this._xmin,c))),(v.x<this._xmax&&d.x>this._xmax||v.x>this._xmax&&d.x<this._xmax)&&(r=(this._xmax-v.x)/(d.x-v.x),(c=v.y+r*(d.y-v.y))<=this._ymin?o=!1:c>=this._ymax?o=!0:g.push(new l(r,this._xmax,c))),(v.y<this._ymin&&d.y>this._ymin||v.y>this._ymin&&d.y<this._ymin)&&(r=(this._ymin-v.y)/(d.y-v.y),(u=v.x+r*(d.x-v.x))<=this._xmin?a=!1:u>=this._xmax?a=!0:g.push(new l(r,u,this._ymin))),(v.y<this._ymax&&d.y>this._ymax||v.y>this._ymax&&d.y<this._ymax)&&(r=(this._ymax-v.y)/(d.y-v.y),(u=v.x+r*(d.x-v.x))<=this._xmin?a=!1:u>=this._xmax?a=!0:g.push(new l(r,u,this._ymax))),0===g.length)a?o?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):o?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(g.length>1&&g[0].ratio>g[1].ratio)this._start=this._dist+f*g[1].ratio,this._lineTo(g[1].x,g[1].y,!0),this._lineTo(g[0].x,g[0].y,!0);else{this._start=this._dist+f*g[0].ratio;for(var p=0;p<g.length;p++)this._lineTo(g[p].x,g[p].y,!0)}this._lineTo(d.x,d.y,!1)}}this._dist+=f,this._prevIsIn=y,this._prevPt=_}},{key:"close",value:function(){if(this._line.length>2){var e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);for(var i=this._line,s=i.length;s>=4&&(i[0].x===i[1].x&&i[0].x===i[s-2].x||i[0].y===i[1].y&&i[0].y===i[s-2].y);)i.pop(),i[0].x=i[s-2].x,i[0].y=i[s-2].y,--s}}},{key:"result",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._pushLine(),0===this._lines.length?null:(this._type===s.Polygon&&e&&c.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}},{key:"resultWithStarts",value:function(){if(this._type!==s.LineString)throw new Error("Only valid for lines");this._pushLine();var e=this._lines,t=e.length;if(0===t)return null;for(var i=[],n=0;n<t;n++)i.push({line:e[n],start:this._starts[n]||0});return i}},{key:"_isIn",value:function(e,t){return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}},{key:"_intersect",value:function(e,t){var i,s,n;if(t.x>=this._xmin&&t.x<=this._xmax)n=((s=t.y<=this._ymin?this._ymin:this._ymax)-e.y)/(t.y-e.y),i=e.x+n*(t.x-e.x);else if(t.y>=this._ymin&&t.y<=this._ymax)n=((i=t.x<=this._xmin?this._xmin:this._xmax)-e.x)/(t.x-e.x),s=e.y+n*(t.y-e.y);else{s=t.y<=this._ymin?this._ymin:this._ymax;var r=((i=t.x<=this._xmin?this._xmin:this._xmax)-e.x)/(t.x-e.x),a=(s-e.y)/(t.y-e.y);r<a?(n=r,s=e.y+r*(t.y-e.y)):(n=a,i=e.x+a*(t.x-e.x))}return this._r=n,new h(i,s)}},{key:"_pushLine",value:function(){this._line&&(this._type===s.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===s.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===s.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}},{key:"_moveTo",value:function(e,t,i){this._type!==s.Polygon?i&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new h(e,t))):(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new h(e,t)),this._isH=!1,this._isV=!1)}},{key:"_lineTo",value:function(e,t,i){var n,r;if(this._type!==s.Polygon)if(i){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(n=this._line[this._line.length-1]).equals(e,t))return;this._line.push(new h(e,t))}else this._line&&this._line.length>0&&this._pushLine();else if(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){var a=(n=this._line[this._line.length-1]).x===e,l=n.y===t;if(a&&l)return;this._isH&&a||this._isV&&l?(n.x=e,n.y=t,(r=this._line[this._line.length-2]).x===e&&r.y===t?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(r=this._line[this._line.length-2],this._isH=r.x===e,this._isV=r.y===t)):(this._isH=r.x===e,this._isV=r.y===t)):(this._line.push(new h(e,t)),this._isH=a,this._isV=l)}else this._line.push(new h(e,t))}}]),e}(),u=function(){function e(){(0,r.Z)(this,e)}return(0,a.Z)(e,[{key:"setExtent",value:function(e){this._ratio=4096===e?1:4096/e}},{key:"validateTessellation",get:function(){return this._ratio<1}},{key:"reset",value:function(e){this._lines=[],this._line=null}},{key:"moveTo",value:function(e,t){this._line&&this._lines.push(this._line),this._line=[];var i=this._ratio;this._line.push(new h(e*i,t*i))}},{key:"lineTo",value:function(e,t){var i=this._ratio;this._line.push(new h(e*i,t*i))}},{key:"close",value:function(){var e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}},{key:"result",value:function(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}]),e}();!function(e){e[e.sideLeft=0]="sideLeft",e[e.sideRight=1]="sideRight",e[e.sideTop=2]="sideTop",e[e.sideBottom=3]="sideBottom"}(n||(n={}));var c=function(){function e(){(0,r.Z)(this,e)}return(0,a.Z)(e,null,[{key:"simplify",value:function(t,i,s){if(s){for(var r=-i,a=t+i,h=-i,l=t+i,o=[],u=[],c=s.length,y=0;y<c;++y){var _=s[y];if(_&&!(_.length<2))for(var f=void 0,v=_[0],d=_.length,g=1;g<d;++g)f=_[g],v.x===f.x&&(v.x<=r&&(v.y>f.y?(o.push(y),o.push(g),o.push(n.sideLeft),o.push(-1)):(u.push(y),u.push(g),u.push(n.sideLeft),u.push(-1))),v.x>=a&&(v.y<f.y?(o.push(y),o.push(g),o.push(n.sideRight),o.push(-1)):(u.push(y),u.push(g),u.push(n.sideRight),u.push(-1)))),v.y===f.y&&(v.y<=h&&(v.x<f.x?(o.push(y),o.push(g),o.push(n.sideTop),o.push(-1)):(u.push(y),u.push(g),u.push(n.sideTop),u.push(-1))),v.y>=l&&(v.x>f.x?(o.push(y),o.push(g),o.push(n.sideBottom),o.push(-1)):(u.push(y),u.push(g),u.push(n.sideBottom),u.push(-1)))),v=f}if(0!==o.length&&0!==u.length){e.fillParent(s,u,o),e.fillParent(s,o,u);var p=[];e.calcDeltas(p,u,o),e.calcDeltas(p,o,u),e.addDeltas(p,s)}}}},{key:"fillParent",value:function(e,t,i){for(var s=i.length,r=t.length,a=0;a<r;a+=4){for(var h=t[a],l=t[a+1],o=t[a+2],u=e[h][l-1],c=e[h][l],_=8092,f=-1,v=0;v<s;v+=4)if(i[v+2]===o){var d=i[v],g=i[v+1],p=e[d][g-1],m=e[d][g];switch(o){case n.sideLeft:case n.sideRight:if(y(u.y,p.y,m.y)&&y(c.y,p.y,m.y)){var x=Math.abs(m.y-p.y);x<_&&(_=x,f=v)}break;case n.sideTop:case n.sideBottom:if(y(u.x,p.x,m.x)&&y(c.x,p.x,m.x)){var w=Math.abs(m.x-p.x);w<_&&(_=w,f=v)}}}t[a+3]=f}}},{key:"calcDeltas",value:function(t,i,s){for(var n=i.length,r=0;r<n;r+=4){var a=e.calcDelta(r,i,s,[]);t.push(i[r]),t.push(i[r+1]),t.push(i[r+2]),t.push(a)}}},{key:"calcDelta",value:function(t,i,s,n){var r=i[t+3];if(-1===r)return 0;var a=n.length;return a>1&&n[a-2]===r?0:(n.push(r),e.calcDelta(r,s,i,n)+1)}},{key:"addDeltas",value:function(e,t){for(var i=e.length,s=0,r=0;r<i;r+=4){var a=e[r+3];a>s&&(s=a)}for(var h=0;h<i;h+=4){var l=t[e[h]],o=e[h+1],u=s-e[h+3];switch(e[h+2]){case n.sideLeft:l[o-1].x-=u,l[o].x-=u,1===o&&(l[l.length-1].x-=u),o===l.length-1&&(l[0].x-=u);break;case n.sideRight:l[o-1].x+=u,l[o].x+=u,1===o&&(l[l.length-1].x+=u),o===l.length-1&&(l[0].x+=u);break;case n.sideTop:l[o-1].y-=u,l[o].y-=u,1===o&&(l[l.length-1].y-=u),o===l.length-1&&(l[0].y-=u);break;case n.sideBottom:l[o-1].y+=u,l[o].y+=u,1===o&&(l[l.length-1].y+=u),o===l.length-1&&(l[0].y+=u)}}}}]),e}(),y=function(e,t,i){return e>=t&&e<=i||e>=i&&e<=t}},26554:function(e,t,i){i.d(t,{Y:function(){return h},m:function(){return l}});var s=i(37762),n=i(93433),r=i(46228),a=i(16889);function h(e,t,i){var s=(0,a.fp)(Math.ceil(i)),n=function(e){return"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e}(t)?8*s:16*s,r=2*s;e.width=n,e.height=n;var h=e.getContext("2d");h.strokeStyle="#FFFFFF",h.lineWidth=s,h.beginPath(),"vertical"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSVertical"!==t||(h.moveTo(n/2,-r),h.lineTo(n/2,n+r)),"horizontal"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSHorizontal"!==t||(h.moveTo(-r,n/2),h.lineTo(n+r,n/2)),"forward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSDiagonalCross"!==t&&"esriSFSForwardDiagonal"!==t||(h.moveTo(-r,-r),h.lineTo(n+r,n+r),h.moveTo(n-r,-r),h.lineTo(n+r,r),h.moveTo(-r,n-r),h.lineTo(r,n+r)),"backward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSBackwardDiagonal"!==t&&"esriSFSDiagonalCross"!==t||(h.moveTo(n+r,-r),h.lineTo(-r,n+r),h.moveTo(r,-r),h.lineTo(-r,r),h.moveTo(n+r,n-r),h.lineTo(n-r,n+r)),h.stroke();for(var l,o=h.getImageData(0,0,e.width,e.height),u=new Uint8Array(o.data),c=0;c<u.length;c+=4)l=u[c+3]/255,u[c]=u[c]*l,u[c+1]=u[c+1]*l,u[c+2]=u[c+2]*l;return[u,e.width,e.height]}function l(e,t){var i="Butt"===t,a="Square"===t,h=!i&&!a;e.length%2==1&&(e=[].concat((0,n.Z)(e),(0,n.Z)(e)));var l,o=15.5,u=0,c=(0,s.Z)(e);try{for(c.s();!(l=c.n()).done;){u+=l.value}}catch(M){c.e(M)}finally{c.f()}var y,_=Math.round(u*o),f=new Float32Array(31*_),v=7.75,d=0,g=0,p=.5,m=!0,x=(0,s.Z)(e);try{for(x.s();!(y=x.n()).done;){var w=y.value;for(d=g,g+=w*o;p<=g;){for(var b=.5;b<31;){var k=(b-.5)*_+p-.5,S=h?(b-o)*(b-o):Math.abs(b-o);f[k]=m?i?Math.max(Math.max(d+v-p,S),Math.max(p-g+v,S)):S:h?Math.min((p-d)*(p-d)+S,(p-g)*(p-g)+S):a?Math.min(Math.max(p-d,S),Math.max(g-p,S)):Math.min(Math.max(p-d+v,S),Math.max(g+v-p,S)),b++}p++}m=!m}}catch(M){x.e(M)}finally{x.f()}for(var Z=f.length,P=new Uint8Array(4*Z),T=0;T<Z;++T){var I=(h?Math.sqrt(f[T]):f[T])/o;(0,r.I)(I,P,4*T)}return[P,_,31]}},99201:function(e,t,i){i.d(t,{B1:function(){return s},DQ:function(){return o},DT:function(){return h},JJ:function(){return n},Or:function(){return u},_U:function(){return r},k3:function(){return c},sX:function(){return y}});var s=Number.POSITIVE_INFINITY,n=Math.PI,r=2*n,a=128/n,h=n/180,l=1/Math.LN2;function o(e,t){return(e%=t)>=0?e:e+t}function u(e){return o(e*a,256)}function c(e){return Math.log(e)*l}function y(e,t,i){return e*(1-i)+t*i}},98067:function(e,t,i){i.d(t,{m:function(){return T}});var s=i(74165),n=i(1413),r=i(15861),a=i(15671),h=i(43144),l=i(66978),o=i(35995),u=i(31009),c=i(37762),y=i(12233),_=function(){function e(t,i){(0,a.Z)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new y.Z(0,0,t,i))}return(0,h.Z)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new y.Z;for(var i=null,s=-1,n=0;n<this._free.length;++n){var r=this._free[n];e<=r.width&&t<=r.height&&(null===i||r.y<=i.y&&r.x<=i.x)&&(i=r,s=n)}return null===i?new y.Z:(this._free.splice(s,1),i.width<i.height?(i.width>e&&this._free.push(new y.Z(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new y.Z(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new y.Z(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new y.Z(i.x,i.y+t,e,i.height-t))),new y.Z(i.x,i.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}(),f=i(8548),v=i(371),d=function(){function e(t,i,s){(0,a.Z)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=i,this._glyphSource=s,this._binPack=new _(t-4,i-4),this._glyphData.push(new Uint8Array(t*i)),this._dirties.push(!0),this._textures.push(void 0)}return(0,h.Z)(e,[{key:"getGlyphItems",value:function(e,t){var i,s=this,n=[],r=this._glyphSource,a=new Set,h=(0,c.Z)(t);try{for(h.s();!(i=h.n()).done;){var l=i.value,o=Math.floor(.00390625*l);a.add(o)}}catch(f){h.e(f)}finally{h.f()}var u=[];return a.forEach((function(t){if(t<=256){var i=e+t;if(s._rangePromises.has(i))u.push(s._rangePromises.get(i));else{var n=r.getRange(e,t).then((function(){s._rangePromises.delete(i)}),(function(){s._rangePromises.delete(i)}));s._rangePromises.set(i,n),u.push(n)}}})),Promise.all(u).then((function(){var i=s._glyphIndex[e];i||(i={},s._glyphIndex[e]=i);var a,h=(0,c.Z)(t);try{for(h.s();!(a=h.n()).done;){var l=a.value,o=i[l];if(o)n[l]={sdf:!0,rect:o.rect,metrics:o.metrics,page:o.page,code:l};else{var u=r.getGlyph(e,l);if(u&&u.metrics){var v=u.metrics,d=void 0;if(0===v.width)d=new y.Z(0,0,0,0);else{var g=v.width+6,p=v.height+6,m=g%4?4-g%4:4,x=p%4?4-p%4:4;1===m&&(m=5),1===x&&(x=5),(d=s._binPack.allocate(g+m,p+x)).isEmpty&&(s._dirties[s._currentPage]||(s._glyphData[s._currentPage]=null),s._currentPage=s._glyphData.length,s._glyphData.push(new Uint8Array(s.width*s.height)),s._dirties.push(!0),s._textures.push(void 0),s._binPack=new _(s.width-4,s.height-4),d=s._binPack.allocate(g+m,p+x));var w=s._glyphData[s._currentPage],b=u.bitmap,k=void 0,S=void 0;if(b)for(var Z=0;Z<p;Z++){k=g*Z,S=s.width*(d.y+Z+1)+d.x;for(var P=0;P<g;P++)w[S+P+1]=b[k+P]}}i[l]={rect:d,metrics:v,tileIDs:null,page:s._currentPage},n[l]={sdf:!0,rect:d,metrics:v,page:s._currentPage,code:l},s._dirties[s._currentPage]=!0}}}}catch(f){h.e(f)}finally{h.f()}return n}))}},{key:"removeGlyphs",value:function(e){for(var t in this._glyphIndex){var i=this._glyphIndex[t];if(i){var s=void 0;for(var n in i)if((s=i[n]).tileIDs.delete(e),0===s.tileIDs.size){for(var r=this._glyphData[s.page],a=s.rect,h=void 0,l=void 0,o=0;o<a.height;o++)for(h=this.width*(a.y+o)+a.x,l=0;l<a.width;l++)r[h+l]=0;delete i[n],this._dirties[s.page]=!0}}}}},{key:"bind",value:function(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[i]||(this._textures[i]=new v.x(e,{pixelFormat:f.VI.ALPHA,dataType:f.Br.UNSIGNED_BYTE,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var n=this._textures[i];n.setSamplingMode(t),this._dirties[i]&&n.setData(this._glyphData[i]),e.bindTexture(n,s),this._dirties[i]=!1}},{key:"dispose",value:function(){this._binPack=null;var e,t=(0,c.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(s){t.e(s)}finally{t.f()}this._textures.length=0}}]),e}(),g=i(76200),p=i(78084),m=function(){function e(t){if((0,a.Z)(this,e),this._metrics=[],this._bitmaps=[],t)for(;t.next();)if(1===t.tag()){for(var i=t.getMessage();i.next();)if(3===i.tag()){for(var s=i.getMessage(),n=void 0,r=void 0,h=void 0,l=void 0,o=void 0,u=void 0,c=void 0;s.next();)switch(s.tag()){case 1:n=s.getUInt32();break;case 2:r=s.getBytes();break;case 3:h=s.getUInt32();break;case 4:l=s.getUInt32();break;case 5:o=s.getSInt32();break;case 6:u=s.getSInt32();break;case 7:c=s.getUInt32();break;default:s.skip()}s.release(),n&&(this._metrics[n]={width:h,height:l,left:o,top:u,advance:c},this._bitmaps[n]=r)}else i.skip();i.release()}else t.skip()}return(0,h.Z)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),x=function(){function e(){(0,a.Z)(this,e),this._ranges=[]}return(0,h.Z)(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),w=function(){function e(t){(0,a.Z)(this,e),this._glyphInfo={},this._baseURL=t}return(0,h.Z)(e,[{key:"getRange",value:function(e,t){var i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();var s=256*t,n=s+255;if(this._baseURL){var r=this._baseURL.replace("{fontstack}",e).replace("{range}",s+"-"+n);return(0,g.default)(r,{responseType:"array-buffer"}).then((function(e){i.addRange(t,new m(new p.Z(new Uint8Array(e.data),new DataView(e.data))))})).catch((function(){i.addRange(t,new m)}))}return i.addRange(t,new m),Promise.resolve()}},{key:"getGlyph",value:function(e,t){var i=this._getFontStack(e);if(i){var s=Math.floor(t/256);if(!(s>256)){var n=i.getRange(s);return n?{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}:void 0}}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new x),t}}]),e}(),b=i(29439),k=i(26554),S="dasharray-",Z=function(){function e(t,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,a.Z)(this,e),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(t<=0||i<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=i,s>0&&(this._maxItemSize=s),this._binPack=new _(t-4,i-4)}return(0,h.Z)(e,[{key:"dispose",value:function(){this._binPack=null,this._mosaicRects={};var e,t=(0,c.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(s){t.e(s)}finally{t.f()}this._textures.length=0}},{key:"getWidth",value:function(e){return e>=this._size.length?-1:this._size[e][0]}},{key:"getHeight",value:function(e){return e>=this._size.length?-1:this._size[e][1]}},{key:"getPageSize",value:function(e){return e>=this._size.length?null:this._size[e]}},{key:"setSpriteSource",value:function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new _(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),s=new Uint32Array(t*i);this._mosaicsData[0]=s,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}},{key:"getSpriteItem",value:function(e){var t,i,s,n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this._mosaicRects[e];if(a)return a;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith(S)?(t=this._rasterizeDash(e),s=(i=(0,b.Z)(t,2))[0],n=i[1],r=!0):s=this._sprites.getSpriteInfo(e),!s||!s.width||!s.height||s.width<0||s.height<0)return null;var h=s.width,l=s.height,o=this._allocateImage(h,l),u=(0,b.Z)(o,3),c=u[0],y=u[1],_=u[2];return c.width<=0?null:(this._copy(c,s,y,_,r,n),a={rect:c,width:h,height:l,sdf:s.sdf,simplePattern:!1,pixelRatio:s.pixelRatio,page:y},this._mosaicRects[e]=a,a)}},{key:"getSpriteItems",value:function(e){var t,i={},s=(0,c.Z)(e);try{for(s.s();!(t=s.n()).done;){var n=t.value;i[n.name]=this.getSpriteItem(n.name,n.repeat)}}catch(r){s.e(r)}finally{s.f()}return i}},{key:"getMosaicItemPosition",value:function(e,t){var i=this.getSpriteItem(e,t),s=i&&i.rect;if(!s)return null;s.width=i.width,s.height=i.height;var n=i.width,r=i.height;return{tl:[s.x+2,s.y+2],br:[s.x+2+n,s.y+2+r],page:i.page}}},{key:"bind",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!(i>=this._size.length||i>=this._mosaicsData.length)){this._textures[i]||(this._textures[i]=new v.x(e,{pixelFormat:f.VI.RGBA,dataType:f.Br.UNSIGNED_BYTE,wrapMode:f.e8.CLAMP_TO_EDGE,width:this._size[i][0],height:this._size[i][1]},new Uint8Array(this._mosaicsData[i].buffer)));var n=this._textures[i];n.setSamplingMode(t),this._dirties[i]&&n.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(n,s),this._dirties[i]=!1}}},{key:"_copy",value:function(t,i,s,n,r,a){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(s>=this._mosaicsData.length)){var h=new Uint32Array(a?a.buffer:this._sprites.image.buffer),l=this._mosaicsData[s];l&&h||console.error("Source or target images are uninitialized!");var o=a?i.width:this._sprites.width;e._copyBits(h,o,i.x,i.y,l,n[0],t.x+2,t.y+2,i.width,i.height,r),this._dirties[s]=!0}}},{key:"_allocateImage",value:function(e,t){e+=2,t+=2;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var s=new y.Z(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[s,this._mosaicsData.length-1,[e,t]]}var n=e%4?4-e%4:4,r=t%4?4-t%4:4;1===n&&(n=5),1===r&&(r=5);var a=this._binPack.allocate(e+n,t+r);return a.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new _(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[a,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"_rasterizeDash",value:function(e){var t=e.match(/\[(.*?)\]/);if(!t)return null;var i=t[1].split(",").map(Number),s=e.slice(e.lastIndexOf("-")+1),n=(0,k.m)(i,s),r=(0,b.Z)(n,3),a=r[0];return[{x:0,y:0,width:r[1],height:r[2],sdf:!0,pixelRatio:1},new Uint8Array(a.buffer)]}}],[{key:"_copyBits",value:function(e,t,i,s,n,r,a,h,l,o,u){var c=s*t+i,y=h*r+a;if(u){y-=r;for(var _=-1;_<=o;c=((++_+o)%o+s)*t+i,y+=r)for(var f=-1;f<=l;f++)n[y+f]=e[c+(f+l)%l]}else for(var v=0;v<o;v++){for(var d=0;d<l;d++)n[y+d]=e[c+d];c+=t,y+=r}}}]),e}(),P=i(73828),T=function(){function e(t,i,s){(0,a.Z)(this,e),this._layer=t,this._styleRepository=i,this.devicePixelRatio=s,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null}return(0,h.Z)(e,[{key:"destroy",value:function(){var e;null!==(e=this._connection)&&void 0!==e&&e.close(),this._connection=null,this._styleRepository=null,this._layer=null,this._spriteMosaic=null,this._glyphMosaic=null}},{key:"spriteMosaic",get:function(){var e=this;return this._spriteSourcePromise.then((function(){return e._spriteMosaic}))}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}},{key:"start",value:function(){var e=(0,r.Z)((0,s.Z)().mark((function e(t){var i,r,a=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,t),this._spriteSourcePromise.then((function(e){a._spriteMosaic=new Z(1024,1024,250),a._spriteMosaic.setSpriteSource(e)})),i=this._layer.currentStyleInfo.glyphsUrl,r=new w(i?(0,o.fl)(i,(0,n.Z)((0,n.Z)({},this._layer.customParameters),{},{token:this._layer.apiKey})):null),this._glyphMosaic=new d(1024,1024,r),this._broadcastPromise=(0,u.bA)("WorkerTileHandler",{client:this,schedule:t.schedule,signal:t.signal}).then((function(e){if(a._connection=e,a._layer&&!a._connection.closed){var i=e.broadcast("setStyle",a._layer.currentStyleInfo.style,t);Promise.all(i).catch((function(e){return(0,l.H9)(e)}))}}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateStyle",value:function(){var e=(0,r.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",t)),e.abrupt("return",this._broadcastPromise);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setSpriteSource",value:function(e){var t=new Z(1024,1024,250);return t.setSpriteSource(e),this._spriteMosaic=t,this._spriteSourcePromise=Promise.resolve(e),t}},{key:"setStyle",value:function(){var e=(0,r.Z)((0,s.Z)().mark((function e(t,i){var r,a=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._styleRepository=t,this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,null),this._spriteSourcePromise.then((function(e){a._spriteMosaic=new Z(1024,1024,250),a._spriteMosaic.setSpriteSource(e)})),r=new w(this._layer.currentStyleInfo.glyphsUrl?(0,o.fl)(this._layer.currentStyleInfo.glyphsUrl,(0,n.Z)((0,n.Z)({},this._layer.customParameters),{},{token:this._layer.apiKey})):null),e.abrupt("return",(this._glyphMosaic=new d(1024,1024,r),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",i)),this._broadcastPromise));case 7:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"fetchTileData",value:function(e,t){var i=this;return this._getRefKeys(e,t).then((function(e){var s=i._layer.sourceNameToSource,n=[];for(var r in s)n.push(r);return i._getSourcesData(n,e,t)}))}},{key:"parseTileData",value:function(e,t){var i=this,s=e&&e.data;if(!s)return Promise.resolve(null);var r=s.sourceName2DataAndRefKey,a=s.transferList;return 0===Object.keys(r).length?Promise.resolve(null):this._broadcastPromise.then((function(){return i._connection.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:r,styleLayerUIDs:e.styleLayerUIDs},(0,n.Z)((0,n.Z)({},t),{},{transferList:a}))}))}},{key:"getSprites",value:function(){var e=(0,r.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._spriteSourcePromise;case 2:return e.abrupt("return",this._spriteMosaic.getSpriteItems(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGlyphs",value:function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}},{key:"_getTilePayload",value:function(){var e=(0,r.Z)((0,s.Z)().mark((function e(t,i,n){var r,a,h,o,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=P.Z.pool.acquire(t.id),a=this._layer.sourceNameToSource[i],h=r.level,o=r.row,u=r.col,P.Z.pool.release(r),e.prev=2,e.next=5,a.requestTile(h,o,u,n);case 5:return e.t0=e.sent,e.t1=i,e.abrupt("return",{protobuff:e.t0,sourceName:e.t1});case 10:if(e.prev=10,e.t2=e.catch(2),!(0,l.D_)(e.t2)){e.next=14;break}throw e.t2;case 14:return e.abrupt("return",{protobuff:null,sourceName:i});case 15:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t,i,s){return e.apply(this,arguments)}}()},{key:"_getRefKeys",value:function(e,t){var i=this._layer.sourceNameToSource,s=new Array;for(var n in i){var r=i[n].getRefKey(e,t);s.push(r)}return(0,l.as)(s)}},{key:"_getSourcesData",value:function(e,t,i){for(var s=[],n=0;n<t.length;n++)if(null==t[n].value||null==e[n])s.push(null);else{var r=this._getTilePayload(t[n].value,e[n],i);s.push(r)}return(0,l.as)(s).then((function(e){for(var i={},s=[],n=0;n<e.length;n++){var r=e[n].value;if(r&&r.protobuff&&r.protobuff.byteLength>0){var a=t[n].value.id;i[r.sourceName]={refKey:a,protobuff:r.protobuff},s.push(r.protobuff)}}return{sourceName2DataAndRefKey:i,transferList:s}}))}}]),e}()},12463:function(e,t,i){i.d(t,{g:function(){return u}});var s=i(29439),n=i(37762),r=i(15671),a=i(43144),h=i(92026),l=i(46618);function o(e,t){if(e.priority-t.priority)return e.priority-t.priority;var i=e.tile.key,s=t.tile.key;return i.world-s.world?i.world-s.world:i.level-s.level?i.level-s.level:i.row-s.row?i.row-s.row:i.col-s.col?i.col-s.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}var u=function(){function e(t,i,s,n,a,h){(0,r.Z)(this,e),this._visibleTiles=t,this._symbolRepository=i,this._createCollisionJob=s,this._assignTileSymbolsOpacity=n,this._symbolLayerSorter=a,this._isLayerVisible=h,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}return(0,a.Z)(e,[{key:"running",get:function(){return this._running}},{key:"setScreenSize",value:function(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}},{key:"restart",value:function(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}},{key:"continue",value:function(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){var t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){var i=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-i))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){var s=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-s))))return!1}return this._running=!1,!0}},{key:"_createSelectionJob",value:function(){for(var e=this._symbolRepository.uniqueSymbols,t=0;t<e.length;t++)for(var i=e[t],s=0;s<i.uniqueSymbols.length;s++){var r,a=i.uniqueSymbols[s],h=(0,n.Z)(a.tileSymbols);try{for(h.s();!(r=h.n()).done;){r.value.selectedForRendering=!1}}catch(f){h.e(f)}finally{h.f()}}var l=[],u=0,c=0,y=this._isLayerVisible;var _=this._symbolLayerSorter;return{work:function(t){for(var i,s=performance.now();c<e.length;c++,u=0){var r=e[c],a=r.styleLayerUID;if(y(a)){l[c]=l[c]||{styleLayerUID:a,symbols:[]};for(var h=l[c];u<r.uniqueSymbols.length;u++){if(i=r.uniqueSymbols[u],u%100==99&&performance.now()-s>t)return!1;var _,v=null,d=!1,g=!1,p=(0,n.Z)(i.tileSymbols);try{for(p.s();!(_=p.n()).done;){var m=_.value;if(!g||!d){var x=m.tile;(!v||x.isCoverage||x.neededForCoverage&&!d)&&(v=m,(x.neededForCoverage||x.isCoverage)&&(g=!0),x.isCoverage&&(d=!0))}}}catch(f){p.e(f)}finally{p.f()}if(v.selectedForRendering=!0,g){h.symbols.push(v),i.show=!0;var w,b=(0,n.Z)(i.parts);try{for(b.s();!(w=b.n()).done;){w.value.show=!0}}catch(f){b.e(f)}finally{b.f()}}else i.show=!1}}else l[c]||(l[c]={styleLayerUID:a,symbols:[]})}var k,S=(0,n.Z)(l);try{for(S.s();!(k=S.n()).done;){k.value.symbols.sort(o)}}catch(f){S.e(f)}finally{S.f()}return!0},get sortedSymbols(){return l.sort(_)}}}},{key:"_createOpacityJob",value:function(){var e=this._assignTileSymbolsOpacity,t=this._visibleTiles,i=0;function r(t,i){var a,h=t.symbols,l=(0,n.Z)(h);try{for(l.s();!(a=l.n()).done;){var o=(0,s.Z)(a.value,2);o[0];c(o[1],i)}}catch(_){l.e(_)}finally{l.f()}e(t,i);var u,y=(0,n.Z)(t.childrenTiles);try{for(y.s();!(u=y.n()).done;){r(u.value,i)}}catch(_){y.e(_)}finally{y.f()}}return{work:function(e){for(var s=performance.now();i<t.length;i++){if(performance.now()-s>e)return!1;var n=t[i];(0,h.pC)(n.parentTile)||r(n,performance.now())}return!0}}}}]),e}();function c(e,t){var i,s=(0,n.Z)(e);try{for(s.s();!(i=s.n()).done;){var r,a=i.value.unique,h=(0,n.Z)(a.parts);try{for(h.s();!(r=h.n()).done;){var o=r.value,u=o.targetOpacity>.5?1:-1;o.startOpacity+=u*((t-o.startTime)/l.nN),o.startOpacity=Math.min(Math.max(o.startOpacity,0),1),o.startTime=t,o.targetOpacity=a.show&&o.show?1:0}}catch(c){h.e(c)}finally{h.f()}}}catch(c){s.e(c)}finally{s.f()}}},36210:function(e,t,i){i.d(t,{L:function(){return o}});var s=i(29439),n=i(37762),r=i(15671),a=i(43144),h=i(92026),l=i(50127),o=function(){function e(t,i,s){(0,r.Z)(this,e),this.tileCoordRange=t,this._visibleTiles=i,this._createUnique=s,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}return(0,a.Z)(e,[{key:"uniqueSymbols",get:function(){return(0,h.Wi)(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}},{key:"add",value:function(e,t){this._uniqueSymbolLayerArray=null;var i=this._tiles.get(e.id);i||(i={symbols:new Map},this._tiles.set(e.id,i));var r=new Map;if(t){var a,h=(0,n.Z)(t);try{for(h.s();!(a=h.n()).done;){var o=a.value;i.symbols.has(o)&&(r.set(o,i.symbols.get(o)),i.symbols.delete(o))}}catch(T){h.e(T)}finally{h.f()}}else{var u,c=(0,n.Z)(e.layerData);try{for(c.s();!(u=c.n()).done;){var y=(0,s.Z)(u.value,2),_=y[0];y[1];i.symbols.has(_)&&(r.set(_,i.symbols.get(_)),i.symbols.delete(_))}}catch(T){c.e(T)}finally{c.f()}}this._removeSymbols(r);var f,v=e.symbols,d=new Map,g=(0,n.Z)(v);try{for(g.s();!(f=g.n()).done;){var p=(0,s.Z)(f.value,2),m=p[0],x=p[1],w=x.length;if(w>=32){var b=this.tileCoordRange;do{b/=2,w/=4}while(w>8&&b>64);var k=new l.HX(this.tileCoordRange,this.tileCoordRange,b);d.set(m,{flat:x,index:k}),i.symbols.set(m,{flat:x,index:k});var S,Z=(0,n.Z)(x);try{for(Z.s();!(S=Z.n()).done;){var P=S.value;k.getCell(P.xTile,P.yTile).push(P)}}catch(T){Z.e(T)}finally{Z.f()}}else d.set(m,{flat:x}),i.symbols.set(m,{flat:x})}}catch(T){g.e(T)}finally{g.f()}this._addSymbols(e.key,v)}},{key:"deleteStyleLayers",value:function(e){this._uniqueSymbolLayerArray=null;var t,i=(0,n.Z)(this._tiles);try{for(i.s();!(t=i.n()).done;){var r,a=(0,s.Z)(t.value,2),h=a[0],l=a[1],o=new Map,u=(0,n.Z)(e);try{for(u.s();!(r=u.n()).done;){var c=r.value;l.symbols.has(c)&&(o.set(c,l.symbols.get(c)),l.symbols.delete(c))}}catch(y){u.e(y)}finally{u.f()}this._removeSymbols(o),0===l.symbols.size&&this._tiles.delete(h)}}catch(y){i.e(y)}finally{i.f()}}},{key:"removeTile",value:function(e){this._uniqueSymbolLayerArray=null;var t=this._tiles.get(e.id);if(t){var i,r=new Map,a=(0,n.Z)(e.symbols);try{for(a.s();!(i=a.n()).done;){var h=(0,s.Z)(i.value,2),l=h[0];h[1];t.symbols.has(l)&&(r.set(l,t.symbols.get(l)),t.symbols.delete(l))}}catch(o){a.e(o)}finally{a.f()}this._removeSymbols(r),0===t.symbols.size&&this._tiles.delete(e.id)}}},{key:"_removeSymbols",value:function(e){var t,i=(0,n.Z)(e);try{for(i.s();!(t=i.n()).done;){var r,a=(0,s.Z)(t.value,2),h=a[0],l=a[1].flat,o=(0,n.Z)(l);try{for(o.s();!(r=o.n()).done;){for(var u=r.value,c=u.unique,y=c.tileSymbols,_=y.length-1,f=0;f<_;f++)if(y[f]===u){y[f]=y[_];break}if(y.length=_,0===_){var v=this._uniqueSymbolsReferences.get(h);v.delete(c),0===v.size&&this._uniqueSymbolsReferences.delete(h)}u.unique=null}}catch(d){o.e(d)}finally{o.f()}}}catch(d){i.e(d)}finally{i.f()}}},{key:"_addSymbols",value:function(e,t){if(0!==t.size){var i,r=this._visibleTiles,a=(0,n.Z)(r);try{for(a.s();!(i=a.n()).done;){var l=i.value;l.parentTile||l.key.world!==e.world||l.key.level===e.level&&!l.key.equals(e)||this._matchSymbols(l,e,t)}}catch(m){a.e(m)}finally{a.f()}var o,u=(0,n.Z)(t);try{for(u.s();!(o=u.n()).done;){var c,y=(0,s.Z)(o.value,2),_=y[0],f=y[1],v=(0,n.Z)(f);try{for(v.s();!(c=v.n()).done;){var d=c.value;if((0,h.Wi)(d.unique)){var g=this._createUnique();d.unique=g,g.tileSymbols.push(d);var p=this._uniqueSymbolsReferences.get(_);p||(p=new Set,this._uniqueSymbolsReferences.set(_,p)),p.add(g)}}}catch(m){v.e(m)}finally{v.f()}}}catch(m){u.e(m)}finally{u.f()}}}},{key:"_matchSymbols",value:function(e,t,i){if(e.key.level>t.level){var r=e.key.level-t.level;if(e.key.row>>r!==t.row||e.key.col>>r!==t.col)return}if(t.level>e.key.level){var a=t.level-e.key.level;if(t.row>>a!==e.key.row||t.col>>a!==e.key.col)return}if(t.equals(e.key)){var o,u=(0,n.Z)(e.childrenTiles);try{for(u.s();!(o=u.n()).done;){var c=o.value;this._matchSymbols(c,t,i)}}catch(B){u.e(B)}finally{u.f()}}else{var y,_=new Map,f=(0,n.Z)(i);try{for(f.s();!(y=f.n()).done;){var v,d=(0,s.Z)(y.value,2),g=d[0],p=d[1],m=[],x=(0,n.Z)(p);try{for(x.s();!(v=x.n()).done;){var w=v.value,b=(0,l.co)(this.tileCoordRange,w.xTile,t.level,t.col,e.key.level,e.key.col),k=(0,l.co)(this.tileCoordRange,w.yTile,t.level,t.row,e.key.level,e.key.row);b>=0&&b<this.tileCoordRange&&k>=0&&k<this.tileCoordRange&&m.push({symbol:w,xTransformed:b,yTransformed:k})}}catch(B){x.e(B)}finally{x.f()}var S=[],Z=e.key.level<t.level?1:1<<e.key.level-t.level,P=this._tiles.get(e.id).symbols.get(g);if(P){var T,I=P.flat,M=(0,n.Z)(m);try{for(M.s();!(T=M.n()).done;){var R,D=T.value,L=!1,C=D.xTransformed,A=D.yTransformed;R=(0,h.pC)(P.index)?P.index.getCell(C,A):I;var z,q=D.symbol,U=q.hash,F=(0,n.Z)(R);try{for(F.s();!(z=F.n()).done;){var J=z.value;if(U===J.hash&&Math.abs(C-J.xTile)<=Z&&Math.abs(A-J.yTile)<=Z){var V=J.unique;q.unique=V,V.tileSymbols.push(q),L=!0;break}}}catch(B){F.e(B)}finally{F.f()}L||S.push(q)}}catch(B){M.e(B)}finally{M.f()}}S.length>0&&_.set(g,S)}}catch(B){f.e(B)}finally{f.f()}var H,O=(0,n.Z)(e.childrenTiles);try{for(O.s();!(H=O.n()).done;){var N=H.value;this._matchSymbols(N,t,_)}}catch(B){O.e(B)}finally{O.f()}}}},{key:"_createUniqueSymbolLayerArray",value:function(){var e,t,i=this._uniqueSymbolsReferences,r=new Array(i.size),a=0,h=(0,n.Z)(i);try{for(h.s();!(t=h.n()).done;){var l=(0,s.Z)(t.value,2),o=l[0],u=l[1],c=new Array(u.size);e=0;var y,_=(0,n.Z)(u);try{for(_.s();!(y=_.n()).done;){var f=y.value;c[e++]=f}}catch(v){_.e(v)}finally{_.f()}r[a]={styleLayerUID:o,uniqueSymbols:c},a++}}catch(v){h.e(v)}finally{h.f()}return r}}]),e}()},42121:function(e,t,i){i.d(t,{f:function(){return y}});var s=i(15671),n=i(43144),r=i(29439),a=i(37762),h=i(23588),l=i(46618),o=i(50127),u=i(21391);function c(e,t,i,s,n,h){var l,o=s.iconRotationAlignment,c=s.textRotationAlignment,y=s.iconTranslate,_=s.iconTranslateAnchor,f=s.textTranslate,v=s.textTranslateAnchor,d=0,g=(0,a.Z)(e.colliders);try{for(g.s();!(l=g.n()).done;){var p=l.value,m=0===p.partIndex?y:f,x=(0,r.Z)(m,2),w=x[0],b=x[1],k=0===p.partIndex?_:v,S=p.minLod<=h&&h<=p.maxLod;d+=S?0:1,p.enabled=S,p.xScreen=p.xTile*n[0]+p.yTile*n[3]+n[6],p.yScreen=p.xTile*n[1]+p.yTile*n[4]+n[7],k===u.fD.MAP?(p.xScreen+=i*w-t*b,p.yScreen+=t*w+i*b):(p.xScreen+=w,p.yScreen+=b),u.aF.VIEWPORT===(0===p.partIndex?o:c)?(p.dxScreen=p.dxPixels,p.dyScreen=p.dyPixels):(p.dxScreen=i*(p.dxPixels+p.width/2)-t*(p.dyPixels+p.height/2)-p.width/2,p.dyScreen=t*(p.dxPixels+p.width/2)+i*(p.dyPixels+p.height/2)-p.height/2)}}catch(Z){g.e(Z)}finally{g.f()}e.colliders.length>0&&d===e.colliders.length&&(e.unique.show=!1)}var y=function(){function e(t,i,n,r,u,c){(0,s.Z)(this,e),this._symbols=t,this._styleRepository=r,this._zoom=u,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new o.HX(i,n,l.PF),this._si=Math.sin(Math.PI*c/180),this._co=Math.cos(Math.PI*c/180);var y,_=(0,a.Z)(t);try{for(_.s();!(y=_.n()).done;){var f,v=y.value,d=(0,a.Z)(v.symbols);try{for(d.s();!(f=d.n()).done;){var g=f.value;this._allNeededMatrices.has(g.tile)||this._allNeededMatrices.set(g.tile,(0,h.a)(g.tile.transforms.tileUnitsToPixels))}}catch(p){d.e(p)}finally{d.f()}}}catch(p){_.e(p)}finally{_.f()}}return(0,n.Z)(e,[{key:"work",value:function(e){var t=this._gridIndex;function i(e){for(var i=e.xScreen+e.dxScreen,s=e.yScreen+e.dyScreen,n=i+e.width,h=s+e.height,l=t.getCellSpan(i,s,n,h),o=(0,r.Z)(l,4),u=o[0],c=o[1],y=o[2],_=o[3],f=c;f<=_;f++)for(var v=u;v<=y;v++){var d,g=t.cells[f][v],p=(0,a.Z)(g);try{for(p.s();!(d=p.n()).done;){var m=d.value,x=m.xScreen+m.dxScreen,w=m.yScreen+m.dyScreen,b=x+m.width,k=w+m.height;if(!(n<x||i>b||h<w||s>k))return!0}}catch(S){p.e(S)}finally{p.f()}}return!1}for(var s=performance.now();this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0)for(var n=this._symbols[this._currentLayerCursor],h=this._getProperties(n.styleLayerUID);this._currentSymbolCursor<n.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-s>e)return!1;var l=n.symbols[this._currentSymbolCursor];if(l.unique.show){c(l,this._si,this._co,h,this._allNeededMatrices.get(l.tile),this._zoom);var o=l.unique;if(o.show){var u,y=h.iconAllowOverlap,_=h.iconIgnorePlacement,f=h.textAllowOverlap,v=h.textIgnorePlacement,d=(0,a.Z)(l.colliders);try{for(d.s();!(u=d.n()).done;){var g=u.value;if(g.enabled){var p=o.parts[g.partIndex];p.show&&!(g.partIndex?f:y)&&i(g)&&(g.hard?o.show=!1:p.show=!1)}}}catch(A){d.e(A)}finally{d.f()}if(o.show){var m,x=(0,a.Z)(l.colliders);try{for(x.s();!(m=x.n()).done;){var w=m.value;if(w.enabled&&(!(w.partIndex?v:_)&&o.parts[w.partIndex].show))for(var b=w.xScreen+w.dxScreen,k=w.yScreen+w.dyScreen,S=b+w.width,Z=k+w.height,P=this._gridIndex.getCellSpan(b,k,S,Z),T=(0,r.Z)(P,4),I=T[0],M=T[1],R=T[2],D=T[3],L=M;L<=D;L++)for(var C=I;C<=R;C++)this._gridIndex.cells[L][C].push(w)}}catch(A){x.e(A)}finally{x.f()}}}}}return!0}},{key:"_getProperties",value:function(e){var t=this._styleProps.get(e);if(t)return t;var i=this._zoom,s=this._styleRepository.getStyleLayerByUID(e),n=s.getLayoutValue("symbol-placement",i)!==u.R.POINT,r=s.getLayoutValue("icon-rotation-alignment",i);r===u.aF.AUTO&&(r=n?u.aF.MAP:u.aF.VIEWPORT);var a=s.getLayoutValue("text-rotation-alignment",i);a===u.aF.AUTO&&(a=n?u.aF.MAP:u.aF.VIEWPORT);var h=s.getPaintValue("icon-translate",i),l=s.getPaintValue("icon-translate-anchor",i),o=s.getPaintValue("text-translate",i),c=s.getPaintValue("text-translate-anchor",i),y={iconAllowOverlap:s.getLayoutValue("icon-allow-overlap",i),iconIgnorePlacement:s.getLayoutValue("icon-ignore-placement",i),textAllowOverlap:s.getLayoutValue("text-allow-overlap",i),textIgnorePlacement:s.getLayoutValue("text-ignore-placement",i),iconRotationAlignment:r,textRotationAlignment:a,iconTranslateAnchor:l,iconTranslate:h,textTranslateAnchor:c,textTranslate:o};return this._styleProps.set(e,y),y}}]),e}()},12233:function(e,t,i){i.d(t,{Z:function(){return r}});var s=i(15671),n=i(43144),r=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0,s.Z)(this,e),this.x=t,this.y=i,this.width=n,this.height=r}return(0,n.Z)(e,[{key:"isEmpty",get:function(){return this.width<=0||this.height<=0}},{key:"union",value:function(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}]),e}()},75572:function(e,t,i){i.d(t,{Z:function(){return y}});var s=i(15671),n=i(43144),r=i(11752),a=i(61120),h=i(60136),l=i(92572),o=i(22824),u=i(37995),c=i(73828),y=function(e){(0,h.Z)(i,e);var t=(0,l.Z)(i);function i(){var e;return(0,s.Z)(this,i),(e=t.apply(this,arguments))._fullCacheLodInfos=null,e._levelByScale={},e}return(0,n.Z)(i,[{key:"getTileParentId",value:function(e){var t=c.Z.pool.acquire(e),i=0===t.level?null:c.Z.getId(t.level-1,t.row>>1,t.col>>1,t.world);return c.Z.pool.release(t),i}},{key:"getTileCoverage",value:function(e,t,s){var n=(0,r.Z)((0,a.Z)(i.prototype),"getTileCoverage",this).call(this,e,t,s);if(!n)return n;var h=1<<n.lodInfo.level;return n.spans=n.spans.filter((function(e){return e.row>=0&&e.row<h})),n}},{key:"scaleToLevel",value:function(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];var t,i,s=this._fullCacheLodInfos;if(e>s[0].scale)return s[0].level;for(var n=0;n<s.length-1;n++)if(e>(i=s[n+1]).scale)return(t=s[n]).level+(t.scale-e)/(t.scale-i.scale);return s[s.length-1].level}},{key:"_initializeFullCacheLODs",value:function(e){var t;if(0===e[0].level)t=e.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}));else{var i=this.tileInfo.size[0],s=this.tileInfo.spatialReference;t=o.Z.create({size:i,spatialReference:s}).lods.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}))}for(var n=0;n<t.length;n++)this._levelByScale[t[n].scale]=t[n].level;this._fullCacheLodInfos=t}}]),i}(u.Z)}}]);
//# sourceMappingURL=77416.cc11392a.chunk.js.map