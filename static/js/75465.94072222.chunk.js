"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[75465],{75465:function(e,t,r){r.r(t),r.d(t,{DictionaryLoader:function(){return x}});var n=r(93433),i=r(1413),a=r(29439),s=r(74165),o=r(37762),u=r(15861),l=r(15671),c=r(43144),f=r(51995),h=r(76200),p=r(10064),y=r(32718),m=r(16054),b=r(92026),d=r(66978),v=r(643),g=r(819),k=r(75021),_="esri.renderers.support.DictionaryLoader",Z={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}},x=function(){function e(t,r,n){(0,l.Z)(this,e),this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new m.Z(100),this._dictionaryPromise=null,this.url=t,this.config=r,this.fieldMap=n}return(0,c.Z)(e,[{key:"getSymbolFields",value:function(){return this._symbolFields}},{key:"getSymbolAsync",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,a,u,l,c,h,p,y,m,g,k,_,Z,x,C,w,S,M,P,L,R,I,N,T,q,F,j=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r)),e.prev=1,e.next=4,this._dictionaryPromise;case 4:i=e.sent,e.next=11;break;case 7:if(e.prev=7,e.t0=e.catch(1),!(0,d.D_)(e.t0)){e.next=11;break}return e.abrupt("return",(this._dictionaryPromise=null,null));case 11:if(a={},this.fieldMap){u=(0,o.Z)(this._symbolFields);try{for(u.s();!(l=u.n()).done;)c=l.value,(h=this.fieldMap[c])&&null!=t.attributes[h]?(p=""+t.attributes[h],a[c]=p):a[c]=""}catch(s){u.e(s)}finally{u.f()}}if((y=null===(n=i)||void 0===n?void 0:n(a,r))&&"string"==typeof y){e.next=16;break}return e.abrupt("return",null);case 16:if(m=(0,v.hP)(y).toString(),!(g=this._symbolCache.get(m))){e.next=19;break}return e.abrupt("return",(g.catch((function(){j._symbolCache.pop(m)})),g));case 19:k=y.split(";"),_=[],Z=[],x=(0,o.Z)(k),e.prev=21,x.s();case 23:if((C=x.n()).done){e.next=55;break}if(!(w=C.value)){e.next=53;break}if(!w.includes("po:")){e.next=31;break}3===(S=w.substr(3).split("|")).length&&(M=S[0],P=S[1],L=S[2],"DashTemplate"===P?L=L.split(" ").map((function(e){return Number(e)})):"Color"===P?(R=new f.Z(L).toRgba(),L=[R[0],R[1],R[2],255*R[3]]):L=Number(L),Z.push({primitiveName:M,propertyName:P,value:L})),e.next=53;break;case 31:if(!w.includes("|")){e.next=52;break}I=(0,o.Z)(w.split("|")),e.prev=33,I.s();case 35:if((N=I.n()).done){e.next=42;break}if(T=N.value,!this._itemNames.has(T)){e.next=40;break}return _.push(T),e.abrupt("break",42);case 40:e.next=35;break;case 42:e.next=47;break;case 44:e.prev=44,e.t1=e.catch(33),I.e(e.t1);case 47:return e.prev=47,I.f(),e.finish(47);case 50:e.next=53;break;case 52:this._itemNames.has(w)&&_.push(w);case 53:e.next=23;break;case 55:e.next=60;break;case 57:e.prev=57,e.t2=e.catch(21),x.e(e.t2);case 60:return e.prev=60,x.f(),e.finish(60);case 63:return q=!(0,b.pC)(t.geometry)||!t.geometry.hasZ&&"point"===t.geometry.type,F=this._cimPartsToCIMSymbol(_,Z,q,r),e.abrupt("return",(this._symbolCache.put(m,F,1),F));case 65:case"end":return e.stop()}}),e,this,[[1,7],[21,57,60,63],[33,44,47,50]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"fetchResources",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,u,l,c,f,m,d,v,k,Z,x,C,w,S,M,P,L=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._dictionaryPromise){e.next=2;break}return e.abrupt("return",this._dictionaryPromise);case 2:if(this.url){e.next=4;break}return e.abrupt("return",void y.Z.getLogger(_).error("no valid URL!"));case 4:return r=(0,h.default)(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:(0,b.pC)(t)?t.signal:null}),e.next=7,Promise.all([r,(0,g.LC)()]);case 7:if(n=e.sent,u=(0,a.Z)(n,1),l=u[0].data){e.next=12;break}throw this._dictionaryPromise=null,new p.Z("esri.renderers.DictionaryRenderer","Bad dictionary data!");case 12:if(c=l.expression,f=l.authoringInfo,this._refSymbolUrlTemplate=this.url+"/"+l.cimRefTemplateUrl,this._itemNames=new Set(l.itemsNames),this._symbolFields=f.symbol,m={},this.config)for(v in d=this.config)m[v]=d[v];if(f.configuration){k=(0,o.Z)(f.configuration);try{for(k.s();!(Z=k.n()).done;)x=Z.value,m.hasOwnProperty(x.name)||(m[x.name]=x.value)}catch(s){k.e(s)}finally{k.f()}}if(C=[],(0,b.pC)(t)&&t.fields&&this.fieldMap){w=(0,o.Z)(this._symbolFields);try{for(M=function(){var e=S.value,r=L.fieldMap[e],n=t.fields.filter((function(e){return e.name===r}));n.length>0&&C.push((0,i.Z)((0,i.Z)({},n[0]),{},{name:e}))},w.s();!(S=w.n()).done;)M()}catch(s){w.e(s)}finally{w.f()}}return P=(0,g.pp)(c,(0,b.pC)(t)?t.spatialReference:null,C,m).then((function(e){var t={scale:0};return function(r,n){var i;if((0,b.Wi)(e))return null;var a=e.repurposeFeature({geometry:null,attributes:r});return t.scale=(0,b.pC)(n)&&null!==(i=n.scale)&&void 0!==i?i:void 0,e.evaluate({$feature:a,$view:t})}})).catch((function(e){return y.Z.getLogger(_).error("Creating dictinoary expression failed:",e),null})),e.abrupt("return",(this._dictionaryPromise=P,P));case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_cimPartsToCIMSymbol",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n,i){var a,u,l,c,f,h;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=new Array(t.length),u=0;u<t.length;u++)a[u]=this._getSymbolPart(t[u],i);return e.next=4,Promise.all(a);case 4:if(l=e.sent,c=this.fieldMap){f=(0,o.Z)(l);try{for(f.s();!(h=f.n()).done;)C(h.value,c)}catch(s){f.e(s)}finally{f.f()}}return e.abrupt("return",new k.Z({data:this._combineSymbolParts(l,r,n)}));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_getSymbolPart",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._ongoingRequests.has(t)){e.next=2;break}return e.abrupt("return",this._ongoingRequests.get(t).then((function(e){return e.data})));case 2:return n=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),a=(0,h.default)(n,(0,i.Z)({responseType:"json",query:{f:"json"}},r)),this._ongoingRequests.set(t,a),e.prev=4,e.next=7,a;case 7:return e.abrupt("return",e.sent.data);case 10:throw e.prev=10,e.t0=e.catch(4),this._ongoingRequests.delete(t),e.t0;case 13:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_combineSymbolParts",value:function(e,t,r){if(!e||0===e.length)return null;var a=(0,i.Z)({},e[0]);if(e.length>1){a.symbolLayers=[];var s,u=(0,o.Z)(e);try{for(u.s();!(s=u.n()).done;){var l,c=s.value;(l=a.symbolLayers).unshift.apply(l,(0,n.Z)(c.symbolLayers))}}catch(f){u.e(f)}finally{u.f()}}return r&&(a.callout=Z),{type:"CIMSymbolReference",symbol:a,primitiveOverrides:t}}}]),e}();function C(e,t){if(e){var r=e.symbolLayers;if(r)for(var n=r.length;n--;){var i=r[n];i&&!1!==i.enable&&"CIMVectorMarker"===i.type&&w(i,t)}}}function w(e,t){var r=e.markerGraphics;if(r){var n,i=(0,o.Z)(r);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a){var s=a.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":C(s,t);break;case"CIMTextSymbol":s.fieldMap=t}}}}catch(u){i.e(u)}finally{i.f()}}}}}]);
//# sourceMappingURL=75465.94072222.chunk.js.map