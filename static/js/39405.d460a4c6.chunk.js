"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[39405],{39405:function(e,t,r){r.r(t),r.d(t,{arcgis_download_features_button:function(){return h}});var n=r(74165),i=r(15861),a=r(15671),u=r(43144),o=r(72585),s=r(77144),c=r(32836),l=r(85621),f=r(4066),h=(r(77843),r(10625),function(){function e(t){(0,a.Z)(this,e),(0,o.r)(this,t),this.hubTelemetry=(0,o.c)(this,"hubTelemetry",7),this.arcgisDownloadSuccess=(0,o.c)(this,"arcgisDownloadSuccess",7),this.arcgisDownloadError=(0,o.c)(this,"arcgisDownloadError",7),this.appearance="solid",this.width="auto",this.loading=!1,this.hasError=!1,(0,c.b)(this,"onHandleClick")}return(0,u.Z)(e,[{key:"serviceUrl",get:function(){var e;return(0,s.i)(this.server)?e=this.server:this.server?e=this.server.url:this.item&&(e=(0,f.p)(this.item.url)),e}},{key:"onHandleClick",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(){var t,r,i,a,u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.hasError=!1,this.loading=!0,t=this.serviceUrl,r=this.fileFormat,i=(new Date).valueOf(),e.prev=4,a=this.getCreateReplicaOptions(),e.next=8,(0,s.g)(t,this.authentication,a);case 8:u=e.sent,this.hubTelemetry.emit(Object.assign(Object.assign({},l.d.dictionary.category.interaction.action.download),{label:(0,s.f)(r),details:t,response:l.d.constants.response.SUCCESS,duration:(new Date).valueOf()-i})),this.arcgisDownloadSuccess.emit({serviceUrl:t,fileFormat:r,downloadUrl:u}),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(4),this.hasError=!0,this.hubTelemetry.emit(Object.assign(Object.assign({},l.d.dictionary.category.interaction.action.download),{label:(0,s.f)(r),details:t,response:l.d.constants.response.FAILURE,duration:(new Date).valueOf()-i})),this.arcgisDownloadError.emit({serviceUrl:t,fileFormat:r,error:e.t0});case 18:this.loading=!1;case 19:case"end":return e.stop()}}),e,this,[[4,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"getCreateReplicaOptions",value:function(){var e,t;(0,s.i)(this.layers)?(e=this.layers,t=this.layers.split(",").reduce((function(e,t){return e[+t]={queryOption:"all"},e}),{})):(0,s.b)(this.layers)?(e=this.layers.join(","),t=this.layers.reduce((function(e,t){return e[t]={queryOption:"all"},e}),{})):(0,s.c)(this.layers)&&(e=this.layers.map((function(e){return e.id})).join(","),t=this.layers.reduce((function(e,t){var r=t.id,n=t.where;return e[r]={queryOption:"all"},n&&(e[r]={where:n,queryOption:"useFilter"}),e}),{}));var r=new s.C;return e&&(r=r.layers(e)),t&&(r=r.layerQueries(t)),this.fileFormat&&(r=r.dataFormat(this.fileFormat)),this.filterGeometry&&(r=r.geometry(this.filterGeometry)),r.build()}},{key:"render",value:function(){var e,t;return this.hasError&&(e="red",t="exclamationMarkTriangle"),(0,o.h)(o.H,{"data-element":"download-features-button"},(0,o.h)("calcite-button",{color:e,"icon-start":t,loading:this.loading,onClick:this.onHandleClick,width:this.width},(0,o.h)("slot",null)))}}]),e}());h.style=":host{display:block}"},30678:function(e,t,r){function n(e){return"string"!==typeof e||"/"===(e=e.trim())[e.length-1]&&(e=e.slice(0,-1)),e}r.d(t,{c:function(){return n}})},77144:function(e,t,r){r.d(t,{C:function(){return c},a:function(){return k},b:function(){return b},c:function(){return w},f:function(){return O},g:function(){return l},i:function(){return m}});var n=r(74165),i=r(15861),a=r(15671),u=r(43144),o=r(77843),s=r(25434),c=function(){function e(){(0,a.Z)(this,e),this._createReplicaOptions={layers:"0",layerQueries:{0:{queryOption:"all"}},returnAttachments:!0,returnAttachmentsDataByUrl:!0,async:!0,syncModel:"none",targetType:"client",syncDirection:"bidirectional",attachmentsSyncDirection:"bidirectional"}}return(0,u.Z)(e,[{key:"layers",value:function(e){return this._createReplicaOptions.layers=e,this}},{key:"dataFormat",value:function(e){return this._createReplicaOptions.dataFormat=e,this}},{key:"geometry",value:function(e){return this._createReplicaOptions.geometry=e,this._createReplicaOptions.geometryType={point:"esriGeometryPoint",multipoint:"esriGeometryMultipoint",polyline:"esriGeometryPolyline",polygon:"esriGeometryPolygon",extent:"esriGeometryEnvelope"}[e.type],this._createReplicaOptions.inSR=e.spatialReference,this}},{key:"layerQueries",value:function(e){return this._createReplicaOptions.layerQueries=e,this}},{key:"build",value:function(){return(0,s.c)(this._createReplicaOptions)}}]),e}();function l(e,t,r){return f.apply(this,arguments)}function f(){return f=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var a,u,o,s,c,l,f,p=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=p.length>3&&void 0!==p[3]?p[3]:5e3,e.next=3,h(t,r,i);case 3:return u=e.sent,e.next=6,y(u,r,a);case 6:if(o=e.sent,s=o.resultUrl,c=o.authRequired,l=s,!c){e.next=15;break}return e.next=13,r.getToken(s);case 13:f=e.sent,l="".concat(s,"?token=").concat(f);case 15:return e.abrupt("return",l);case 16:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function h(e,t,r){return p.apply(this,arguments)}function p(){return(p=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var a,u,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={httpMethod:"POST",params:i,authentication:r},e.next=3,(0,o.r)("".concat(t,"/createReplica"),a);case 3:return u=e.sent,s=u.statusUrl,e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t,r){return d.apply(this,arguments)}function d(){return(d=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var a,u,o,s,c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(t,{authentication:r});case 2:if(a=e.sent,u=a.response,o=u.status,s=u.resultUrl,c=a.authRequired,"Completed"!==o){e.next=11;break}return e.abrupt("return",{resultUrl:s,authRequired:c});case 11:return e.next=13,new Promise((function(e){return setTimeout(e,i)}));case 13:return e.abrupt("return",y(t,r,i));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t){return g.apply(this,arguments)}function g(){return(g=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.r)(t,Object.assign(Object.assign({},r),{rawResponse:!0,httpMethod:"GET"}));case 2:return i=e.sent,a=new URL("",i.url),e.next=6,i.json();case 6:return u=e.sent,e.abrupt("return",{response:u,authRequired:a.searchParams.has("token")});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=function(e){return"string"===typeof e||e instanceof String},b=function(e){return Array.isArray(e)&&e.every((function(e){return!isNaN(e)}))},w=function(e){return Array.isArray(e)&&e.every((function(e){return!isNaN(e.id)}))},k=function(e){return"ArcGISRequestError"===e.name&&429===e.code},O=function(e){return{csv:"CSV",shapefile:"Shapefile",sqlite:"SQLite Geodatabase",geoPackage:"GeoPackage",filegdb:"File Geodatabase",featureCollection:"Feature Collection",geojson:"GeoJSON",excel:"Excel",json:"JSON"}[e]}},62254:function(e,t,r){function n(e,t){return t.split(".").reduce((function(e,t){return e?e[t]:void 0}),e)}r.d(t,{g:function(){return n}})},4066:function(e,t,r){r.d(t,{p:function(){return a}});var n=r(30678),i=new RegExp(/.+(?:map|feature|image)server/i);function a(e){var t=e.match(i);return t?t[0]:function(e){var t=e.split("?")[0];return(0,n.c)(t)}(e)}},25434:function(e,t,r){r.d(t,{a:function(){return o},b:function(){return l},c:function(){return i},d:function(){return c},e:function(){return p},f:function(){return y},g:function(){return a},i:function(){return h},m:function(){return s},u:function(){return f},w:function(){return u}});var n=r(62254);function i(e){var t={};if(Array.isArray(e))t=e.map(i);else if("object"===typeof e){for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];null!=n&&"object"===typeof n?n instanceof Date?t[r]=new Date(n.getTime()):"undefined"!==typeof Blob&&n instanceof Blob?t[r]=new Blob([n],{type:n.type}):t[r]=i(n):t[r]=n}}else t=e;return t}function a(e,t,r){return e?e.reduce((function(e,i){return(0,n.g)(i,t)===r&&(e=i),e}),null):null}function u(e,t){return e.filter((function(e){return e!==t}))}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"i";return"".concat(e).concat(Math.random().toString(36).substr(2,8))}function s(e,t,r){return null!==t&&void 0!==t&&((r=i(r))[e]=t),r}function c(e,t){return null!==e&&void 0!==e&&(t=i(t)).push(e),t}function l(e){return(e=(e=e.toLowerCase()).replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi," ")).replace(/(\-|\_|\.|\s)+(.)?/g,(function(e,t,r){return r?r.toUpperCase():""})).replace(/(^|\/)([A-Z])/g,(function(e,t,r){return e.toLowerCase()}))}function f(e,t,r){return r.indexOf(e)===t}var h=function(e){return null==e},p=function(e){var t=Array.from(e);return t[0]=t[0].toUpperCase(),t.join("")};function y(e){return e.reduce((function(e,t){return e.concat(t)}),[])}}}]);
//# sourceMappingURL=39405.d460a4c6.chunk.js.map