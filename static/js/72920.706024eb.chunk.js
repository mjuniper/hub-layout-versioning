"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[72920],{21774:function(e,t,n){n.r(t),n.d(t,{arcgis_hub_map_widget_legend:function(){return In}});var r=n(29439),i=n(74165),a=n(15861),l=n(15671),s=n(43144),o=n(5692),u=n(54825),c=n(13129),d=n(4541),f=n(8537),h=n(1413),y=n(60136),p=n(92572),v=n(27366),m=n(100),g=n(92026),b=n(94172),_=n(49861),w=n(89125),L=(n(63780),n(69912)),k=n(37056),x=(n(59166),n(85015)),C=n(80987),S=(n(25243),n(37762)),I=n(93433),Z=n(51995),E=n(19545),R=n(76200),V=n(51508),F=n(43404),z=n(32718),T=n(66978),A=n(17842),D=n(35995),P=n(25265),O=n(41978),M=n(60676),N=n(44041),B=n(80031),W=n(92089),H=n(9014),U=n(61029),Y=n(12726),j=n(49729),q=n(37817),J=n(69157),G=n(86828),Q=n(74579),$=n(245);function X(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;var n=e.visualVariables.find((function(e){return"size"===e.type})),r=function(e,t){var n=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return null!==t&&void 0!==t&&t.levels?t.levels[n]:null}(t,n);return r?new $.Z({field:n.field,minSize:r[2].size,minDataValue:r[2].value,maxSize:r[3].size,maxDataValue:r[3].value}):null}var K=n(226),ee=n(40778),te=n(44085),ne=n(4075),re=n(75434),ie=n(37680),ae=n(37384),le=n(16072),se=n(16851),oe=[255,255,255],ue=[200,200,200],ce=[128,128,128];function de(e,t){var n=e.length-1;return e.map((function(e,r){return(0,re.MN)(e,r,n,t)}))}function fe(e,t,n,r,i,a,l){return he.apply(this,arguments)}function he(){return he=(0,a.Z)((0,i.Z)().mark((function e(t,n,r,l,s,o,u){var c,d,f,h,y,p,v,m,g,b,_,w,L,k,x,C,S,I,Z,E;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=n.legendOptions,h=f&&f.customValues,e.t0=u,e.t0){e.next=7;break}return e.next=6,ve(t,r);case 6:e.t0=e.sent;case 7:if(y=e.t0,p=!!y,v=!!h,m=null!=n.minSize&&null!=n.maxSize,g=n.stops&&n.stops.length>1,b=!!n.target,p&&(v||m||g&&!b)){e.next=15;break}return e.abrupt("return");case 15:if(_=(0,Q.YW)(y),w=null,L=null,k=null,!_||g){e.next=21;break}e.t1=(0,ne.NM)([n.minDataValue,n.maxDataValue]),e.next=27;break;case 21:if(e.t2=h,e.t2){e.next=26;break}return e.next=25,we(n,y,l,s);case 25:e.t2=e.sent;case 26:e.t1=e.t2;case 27:if(L=e.t1,x=null===t||void 0===t?void 0:t.authoringInfo,C="univariate-color-size"===(null===x||void 0===x?void 0:x.type),S=C&&"above-and-below"===(null===x||void 0===x?void 0:x.univariateTheme),!L&&g&&(L=n.stops.map((function(e){return e.value})),w=n.stops.some((function(e){return!!e.label})),"flow"===t.type&&(L=(0,ne.NM)(L)),w&&(k=n.stops.map((function(e){return e.label})))),_&&(null===(c=L)||void 0===c?void 0:c.length)>2&&!S&&(L=[L[0],L[L.length-1]]),L){e.next=31;break}return e.abrupt("return",null);case 31:return C&&5!==(null===(d=L)||void 0===d?void 0:d.length)&&(L=ke({minSize:L[0],maxSize:L[L.length-1]})),I=_?ye(t,L):null,Z=(0,Q.Y6)(y),E=w?null:de(L,o),e.next=35,Promise.all(L.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(r,a){var o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_){e.next=4;break}e.t0=I[a],e.next=7;break;case 4:return e.next=6,Ie(n,y,r,l,s);case 6:e.t0=e.sent;case 7:return o=e.t0,e.abrupt("return",{value:r,symbol:Ee(S&&"class-breaks"===t.type?pe(t,a):y,o),label:w?k[a]:E[a],size:o,outlineSize:Z});case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 35:return e.abrupt("return",e.sent.reverse());case 36:case"end":return e.stop()}}),e)}))),he.apply(this,arguments)}function ye(e,t){var n=null===e||void 0===e?void 0:e.authoringInfo,r="univariate-color-size"===(null===n||void 0===n?void 0:n.type),i=[12,30];if(r){var a=t[0],l=t[t.length-1];i=t.map((function(e){return 12+(e-a)/(l-a)*18}))}return r&&"below"===(null===n||void 0===n?void 0:n.univariateTheme)&&i.reverse(),i}function pe(e,t){var n=e.classBreakInfos,r=n.length,i=r<2||!(t>=2)?n[0].symbol.clone():n[r-1].symbol.clone();return e.visualVariables.some((function(e){return"color"===e.type}))&&(i.type.includes("3d")?be(i):_e(i)),i}function ve(e,t){return me.apply(this,arguments)}function me(){return me=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r,a,l,s,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("flow"!==t.type){e.next=2;break}return e.abrupt("return",(0,re.y$)(t,n));case 2:if("pie-chart"!==t.type){e.next=4;break}return e.abrupt("return",new le.Z({color:null,outline:null!==(r=t.outline)&&void 0!==r&&r.width?t.outline:new se.Z}));case 4:return a=null,l=null,"simple"===t.type?a=t.symbol:"class-breaks"===t.type?(s=t.classBreakInfos,a=s&&s[0]&&s[0].symbol,l=s.length>1):"unique-value"===t.type&&(o=t.uniqueValueInfos,a=o&&o[0]&&o[0].symbol,l=o.length>1),e.abrupt("return",!a||ge(a)?null:(a=a.clone(),(n||l)&&(a.type.includes("3d")?be(a):_e(a)),a));case 7:case"end":return e.stop()}}),e)}))),me.apply(this,arguments)}function ge(e){return!!e&&((0,V.dU)(e)?!!e.symbolLayers&&e.symbolLayers.some((function(e){return e&&"fill"===e.type})):e.type.includes("fill"))}function be(e){"line-3d"===e.type?e.symbolLayers.forEach((function(e){e.material={color:ce}})):e.symbolLayers.forEach((function(e){"icon"!==e.type||e.resource&&e.resource.href?e.material={color:ue}:(e.material={color:oe},e.outline={color:ce,size:1.5})}))}function _e(e){var t=(0,ae.$o)();if("cim"===e.type)(0,j.ZB)(e,new Z.Z(ue));else if(e.type.includes("line"))e.color=ce;else if(e.color=t?ce:oe,"simple-marker"===e.type)if(e.outline){var n,r;"#ffffff"===(null===(n=e.outline)||void 0===n||null===(r=n.color)||void 0===r?void 0:r.toHex())&&(e.outline.color=ce)}else e.outline={color:ce,width:1.5}}function we(e,t,n,r){return Le.apply(this,arguments)}function Le(){return Le=(0,a.Z)((0,i.Z)().mark((function e(t,r,a,l){var s,o,u,c,d;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(n.bind(n,56011));case 2:if(s=e.sent.getSizeRangeAtScale(t,a,l),o=s&&ke(s),s||o){e.next=6;break}return e.abrupt("return");case 6:u=o.map((function(e){return xe(e,t,s)})),u=(0,ne.NM)(u),c=1;case 9:if(!(c<u.length-1)){e.next=17;break}return e.next=12,Ce(t,r,u[c],u[c-1],a,l);case 12:(d=e.sent)&&(u[c]=d[0],o[c]=d[1]);case 14:c++,e.next=9;break;case 17:return e.abrupt("return",u);case 18:case"end":return e.stop()}}),e)}))),Le.apply(this,arguments)}function ke(e){for(var t=e.minSize,n=(e.maxSize-t)/4,r=[],i=0;i<5;i++)r.push(t+n*i);return r}function xe(e,t,n){var r=n.minSize,i=n.maxSize,a=t.minDataValue,l=t.maxDataValue;return e<=r?a:e>=i?l:(e-r)/(i-r)*(l-a)+a}function Ce(e,t,n,r,i,a){return Se.apply(this,arguments)}function Se(){return Se=(0,a.Z)((0,i.Z)().mark((function e(t,n,a,l,s,o){var u,c,d,f,h,y,p,v,m,g,b,_,w,L,k,x,C,S,I,Z,E,R,V;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ie(t,n,a,s,o);case 2:return u=e.sent,e.next=5,Ie(t,n,l,s,o);case 5:c=e.sent,d=(0,ne.D2)(a),f=d.fractional,h=20,y=d.integer,p=null,v=null,a>0&&a<1&&(p=Math.pow(10,f),y=(0,ne.D2)(a*=p).integer),m=y-1;case 12:if(!(m>=0)){e.next=38;break}return g=Math.pow(10,m),b=Math.floor(a/g)*g,_=Math.ceil(a/g)*g,null!=p&&(b/=p,_/=p),w=(b+_)/2,L=(0,ne.NM)([b,w,_],{indexes:[1]}),k=(0,r.Z)(L,2),w=k[1],e.next=22,Ie(t,n,b,s,o);case 22:return x=e.sent,e.next=25,Ie(t,n,_,s,o);case 25:return C=e.sent,e.next=28,Ie(t,n,w,s,o);case 28:if(S=e.sent,I=(0,ne.f1)(u,x,c,null),Z=(0,ne.f1)(u,C,c,null),E=(0,ne.f1)(u,S,c,null),R=I.previous<=h,V=Z.previous<=h,R&&V&&(I.previous<=Z.previous?(R=!0,V=!1):(V=!0,R=!1)),R?v=[b,x]:V?v=[_,C]:E.previous<=h&&(v=[w,S]),!v){e.next=35;break}return e.abrupt("break",38);case 35:m--,e.next=12;break;case 38:return e.abrupt("return",v);case 39:case"end":return e.stop()}}),e)}))),Se.apply(this,arguments)}function Ie(e,t,n,r,i){return Ze.apply(this,arguments)}function Ze(){return Ze=(0,a.Z)((0,i.Z)().mark((function e(t,r,a,l,s){var o,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(n.bind(n,56011));case 2:return o=e.sent,u=o.getSize,e.abrupt("return",u(t,a,{scale:l,view:s,shape:"simple-marker"===r.type?r.style:null}));case 5:case"end":return e.stop()}}),e)}))),Ze.apply(this,arguments)}function Ee(e,t){var n=e.clone();if((0,V.dU)(n))(0,Q.YW)(n)||n.symbolLayers.forEach((function(e){"fill"!==e.type&&(e.size=t)}));else if(function(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}(n))n.size=t;else if(function(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(n)){var r=n.width,i=n.height;n.height=t,n.width=t*(r/i)}else!function(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(n)?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(n)&&n.font&&(n.font.size=t):n.width=t;return n}n(76969);var Re=n(6291);n(99388);function Ve(e){var t=Math.floor(Math.log10(Math.abs(e)))+1,n=t<4||t>6?4:t,r=Math.abs(e)>=1e6?"compact":"standard";return(0,Re.uf)(e,{notation:r,minimumSignificantDigits:2,maximumSignificantDigits:n})}var Fe=n(61459),ze=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Te=new F.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Ae=new le.Z({size:6,outline:{color:[128,128,128,.5],width:.5}}),De=new Fe.Z({style:"solid"});function Pe(e){return"flow"===e.type}function Oe(e){return"vector-field"===e.type}function Me(e){return"raster-colormap"===e.type}function Ne(e){return"raster-stretch"===e.type}function Be(e){return"raster-shaded-relief"===e.type}function We(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function He(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function Ue(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function Ye(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function je(e){return qe(e)||Je(e)||Ge(e)||function(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}function qe(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function Je(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function Ge(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function Qe(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function $e(e){return"esri.renderers.PieChartRenderer"===e.declaredClass}function Xe(e,t){return We(e)||He(e)||Ue(e)||Ye(e)||Qe(e)||$e(e)?"2d"===t.type||(0,U.e)(e):Ne(e)||Me(e)||Be(e)||qe(e)||Je(e)||Ge(e)||Oe(e)||Pe(e)}function Ke(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}function et(e){return"esri.layers.SubtypeGroupLayer"===e.declaredClass}function tt(e){return"esri.layers.VoxelLayer"===e.declaredClass}function nt(e){return"esri.layers.WMSLayer"===e.declaredClass}function rt(e){return"esri.layers.WMTSLayer"===e.declaredClass}function it(e){return"esri.layers.MapImageLayer"===e.declaredClass}function at(e){return"esri.layers.TileLayer"===e.declaredClass}function lt(e){return"esri.layers.FeatureLayer"===e.declaredClass}function st(e){return"esri.layers.ImageryLayer"===e.declaredClass}function ot(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}function ut(e){return"esri.layers.WCSLayer"===e.declaredClass}function ct(e){return"stretch-ramp"===e.type}function dt(e){var t;return"univariate-color-size"===(null===(t="authoringInfo"in e&&(null===e||void 0===e?void 0:e.authoringInfo))||void 0===t?void 0:t.type)}function ft(e){var t="authoringInfo"in e&&(null===e||void 0===e?void 0:e.authoringInfo);return"univariate-color-size"===(null===t||void 0===t?void 0:t.type)&&"above-and-below"===(null===t||void 0===t?void 0:t.univariateTheme)}var ht=new le.Z({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}}),yt={},pt=function(e){(0,y.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,l.Z)(this,r),(n=t.call(this,e))._handles=new m.Z,n._hasColorRamp=!1,n._hasOpacityRamp=!1,n._hasSizeRamp=!1,n._webStyleSymbolCache=new Map,n._dotDensityUrlCache=new Map,n._scaleDrivenSizeVariable=null,n._hasClusterSizeVariable=!1,n.children=new C.Z,n.layerView=null,n.layer=null,n.legendElements=[],n.parent=null,n.hideLayersNotInCurrentView=!1,n.keepCacheOnDestroy=!1,n.respectLayerVisibility=!0,n.sublayerIds=[],n.title=null,n.view=null,n}return(0,s.Z)(r,[{key:"initialize",value:function(){var e=this,t=function(){return e.notifyChange("ready")};this._handles.add([(0,b.on)((function(){return e.children}),"change",(function(n){var r=n.added,i=n.removed,a=e._handles;r.forEach((function(e){var n="activeLayerInfo-ready-watcher-".concat(e.layer.uid);a.add((0,b.YP)((function(){return e.ready}),t,b.nn),n)})),i.forEach((function(e){return a.remove(e.layer.uid)})),t()}))]),this.keepCacheOnDestroy||(yt={})}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(yt=null)}},{key:"effectList",get:function(){var e=this.layer,t=null;return"effect"in e&&e.effect&&((t=new O.AM).effect=e.effect,t.endTransitions(),t.scale=this.scale),t}},{key:"opacity",get:function(){var e,t=this.layer.opacity,n=null===(e=this.parent)||void 0===e?void 0:e.opacity,r=this.layer.parent,i=r&&"uid"in r?this._getParentLayerOpacity(r):null;return null!=n?n*t:null!=i?i*t:t}},{key:"ready",get:function(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}},{key:"scale",get:function(){return this.view&&this.view.scale}},{key:"isScaleDriven",get:function(){var e=this.layer;if(null===e)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if("cluster"===e.featureReduction.type)return!0;if("binning"===e.featureReduction.type&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}},{key:"version",get:function(){return this._get("version")+1}},{key:"buildLegendElementsForFeatureCollections",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,a=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=5;break}return e.next=4,this._isLayerInCurrentView();case 4:e.t0=e.sent;case 5:if(e.t0){e.next=7;break}return e.abrupt("return",(this.legendElements=[],void this.notifyChange("ready")));case 7:return n=Array.from(t,(function(e){if(lt(e))return a._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){var t=e.layerDefinition,n=t&&t.drawingInfo,r=n&&(0,H.i)(n.renderer),i=Te.read(t.geometryType);return r?a._getRendererLegendElements(r,{title:e.name,geometryType:i}):(z.Z.getLogger(a.declaredClass).warn("drawingInfo not available!"),null)}return null})),e.prev=8,r=[],e.next=12,(0,T.as)(n).then((function(e){e.forEach((function(e){var t=e.value;return t&&r.push.apply(r,(0,I.Z)(t))}))}));case 12:this.legendElements=r,this.notifyChange("ready"),e.next=19;break;case 16:e.prev=16,e.t1=e.catch(8),z.Z.getLogger(this.declaredClass).warn("error while building legend for layer!",e.t1);case 19:case"end":return e.stop()}}),e,this,[[8,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForRenderer",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=6;break}return e.next=5,this._isLayerInCurrentView();case 5:e.t0=e.sent;case 6:if(!e.t0){e.next=13;break}return e.next=10,this._getRendererLegendElements(t);case 10:e.t1=e.sent,e.next=14;break;case 13:e.t1=[];case 14:this.legendElements=e.t1,this.notifyChange("ready"),e.next=21;break;case 18:e.prev=18,e.t2=e.catch(0),z.Z.getLogger(this.declaredClass).warn("error while building legend for layer!",e.t2);case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForFeatureReduction",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=6;break}return e.next=5,this._isLayerInCurrentView();case 5:e.t0=e.sent;case 6:if(!e.t0){e.next=13;break}return e.next=10,this._getLegendElementsForFeatureReduction(t);case 10:e.t1=e.sent,e.next=14;break;case 13:e.t1=[];case 14:this.legendElements=e.t1,this.notifyChange("ready"),e.next=21;break;case 18:e.prev=18,e.t2=e.catch(0),z.Z.getLogger(this.declaredClass).warn("error while building legend for layer!",e.t2);case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForTools",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,n,r,l,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!tt(t=this.layer)){e.next=5;break}this._constructLegendElementsForVoxellayer(),e.next=29;break;case 5:if(!rt(t)){e.next=9;break}this._constructLegendElementsForWMTSlayer(),e.next=29;break;case 9:if(!nt(t)){e.next=14;break}return e.next=12,this._constructLegendElementsForWMSSublayers();case 12:case 17:case 22:e.next=29;break;case 14:if(!Ke(t)){e.next=19;break}return e.next=17,this._constructLegendElementsForBuildingSceneLayer();case 19:if(!(it(t)||at(t)||et(t))){e.next=24;break}return e.next=22,this._constructLegendElementsForSublayers();case 24:return this._handles.remove("imageryLayers-watcher"),n="default",st(t)&&(n=((null===t||void 0===t||null===(r=t.renderingRule)||void 0===r?void 0:r.functionName)||"default")+"_"+(null!==(l=t.bandIds)&&void 0!==l&&l.length?t.bandIds.join(""):"###")),e.next=29,this._getLegendLayers("".concat(t.uid,"-").concat(n)).then(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(n){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.legendElements=[],s.notifyChange("ready"),r=n.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(n){var r,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(st(t)||ot(t))&&(r=(0,b.YP)((function(){return["renderingRule"in t&&t.renderingRule,t.bandIds]}),(function(){return(0,T.Ds)((0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(yt.default=null,!t.renderer){e.next=6;break}return e.next=4,s.buildLegendElementsForRenderer(t.renderer);case 4:e.next=8;break;case 6:return e.next=8,s.buildLegendElementsForTools();case 8:case"end":return e.stop()}}),e)}))))()})),s._handles.add(r,"imageryLayers-watcher")),(l=s._generateSymbolTableElementForLegendLayer(n))&&l.infos.length&&(st(t)&&(l.title=t.title),s.legendElements.push(l)),s.notifyChange("ready");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,(0,T.as)(r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){z.Z.getLogger(s.declaredClass).warn("Request to server for legend has failed!",e)}));case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_isLayerInCurrentView",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,n,r,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer,n=this.layerView,(r=n&&"createQuery"in n&&"queryFeatureCount"in n)||n&&"createQuery"in t&&"queryFeatureCount"in t){e.next=3;break}return e.abrupt("return",!0);case 3:return e.next=5,(0,b.N1)((function(){return!n.updating}));case 5:if((a=r?"createQuery"in n&&n.createQuery():"createQuery"in t&&t.createQuery()).geometry=this.view.extent,!r){e.next=16;break}if(e.t1="queryFeatureCount"in n,!e.t1){e.next=13;break}return e.next=12,n.queryFeatureCount(a);case 12:e.t1=e.sent;case 13:e.t0=e.t1,e.next=22;break;case 16:if(e.t2="queryFeatureCount"in t,!e.t2){e.next=21;break}return e.next=20,t.queryFeatureCount(a);case 20:e.t2=e.sent;case 21:e.t0=e.t2;case 22:return e.t3=e.t0,e.abrupt("return",0!==e.t3);case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getParentLayerOpacity",value:function(e){var t=1,n=e.parent;return n&&"uid"in n&&(t=this._getParentLayerOpacity(n)),e.opacity*t}},{key:"_isGroupActive",value:function(){var e=this.children;return!!e.length&&e.some((function(e){return e.ready}))}},{key:"_isRendererScaleDriven",value:function(e){var t=this;if("dot-density"===e.type)return!0;var n="valueExpression"in e&&e.valueExpression;if(ze.test(n))return!0;var r="visualVariables"in e&&e.visualVariables;return!!r&&r.some((function(e){return t._isScaleDrivenSizeVariable(e)}))}},{key:"_isScaleDrivenSizeVariable",value:function(e){if(e&&"size"!==e.type)return!1;var t=e,n=t.minSize,r=t.maxSize;return"object"==typeof n&&n?this._isScaleDrivenSizeVariable(n):"object"==typeof r&&r?this._isScaleDrivenSizeVariable(r):!!t.expression||ze.test(t.valueExpression)}},{key:"_isLayerScaleDriven",value:function(e){var t=this;if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((function(e){return t._isLayerScaleDriven(e)}));var n=e.parent;if(!1===e.loaded&&n&&it(n)&&"source"in e&&e.source&&"map-layer"===e.source.type){var r,i=(0,S.Z)(n.sourceJSON.layers);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.id===e.source.mapLayerId&&(a.minScale>0||a.maxScale>0))return!0}}catch(l){i.e(l)}finally{i.f()}}return!1}},{key:"_constructLegendElementsForVoxellayer",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,n,r,a,l,s,o,u,c,d,f,h,y,p=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("voxel-style-watcher"),this._handles.remove("voxel-current-variable"),n=this.layer,this._handles.add((0,b.YP)((function(){return n.currentVariableId}),(function(){return p._constructLegendElementsForVoxellayer()})),"voxel-current-variable"),this._handles.add((0,b.YP)((function(){return n.getVariableStyles()}),(function(){return p._constructLegendElementsForVoxellayer()})),"voxel-style-watcher"),r=(0,g.Wg)(n.getVariableStyle(null)),a=[],r&&(null!==(t=r.uniqueValues)&&void 0!==t&&t.length?(l=[],r.uniqueValues.forEach((function(e){e.enabled&&l.push({label:e.label||"".concat(e.value),value:e.value,symbol:new Fe.Z({color:e.color,outline:null})})})),l.length&&a.push({type:"symbol-table",title:r.label,infos:l})):r.transferFunction&&(s=r.transferFunction,o=s.colorStops,u=s.stretchRange,c=o.toArray().reverse(),d=u.map((function(e,t){return"".concat(0===t?re.zZ:re.Eh," ").concat(Ve(e))})).reverse(),f=c.map((function(e){return{color:e.color,value:null,label:null}})),f[0].label=d[0],f[f.length-1].label=d[1],a.push({type:"color-ramp",title:r.label,infos:f,preview:(0,G.jT)(c.map((function(e){return e.color})))}))),h=n.opacity,y=a.reduce((function(e,t){return e.concat(p._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)})).map((function(e){return p._getSymbolPreview(e,h)})),e.next=8,(0,T.as)(y);case 8:this.legendElements=a,this.notifyChange("ready");case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_constructLegendElementsForWMTSlayer",value:function(){var e=this;this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");var t=this.layer.activeLayer;if(this._handles.add((0,b.YP)((function(){var t=e.layer;return t&&"activeLayer"in t&&t.activeLayer}),(function(){return e._constructLegendElementsForWMTSlayer()})),"wmts-activeLayer-watcher"),t.styleId&&t.styles){var n=null;t.styles.some((function(e){return t.styleId===e.id&&(n=e.legendUrl,!0)})),n&&(this.legendElements=[{type:"symbol-table",title:t.title,infos:[{src:n,opacity:this.opacity}]}])}this.notifyChange("ready")}},{key:"_constructLegendElementsForWMSSublayers",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,n,r=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("wms-sublayers-watcher"),t=this.layer,n=null,(t.customParameters||t.customLayerParameters)&&(n=(0,h.Z)((0,h.Z)({},t.customParameters),t.customLayerParameters)),this._handles.add((0,b.YP)((function(){var e=r.layer;return e&&"sublayers"in e&&e.sublayers}),(function(){return r._constructLegendElementsForWMSSublayers()})),"wms-sublayers-watcher"),e.next=7,this._generateLegendElementsForWMSSublayers(t.sublayers,n);case 7:this.legendElements=e.sent,this.notifyChange("ready");case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForWMSSublayers",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r,a,l,s,o,u=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],this._handles.add(t.on("change",(function(){return u._constructLegendElementsForWMSSublayers()})),"wms-sublayers-watcher"),a=t.toArray(),l=(0,S.Z)(a),e.prev=4,o=(0,i.Z)().mark((function e(){var t,a,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.value,a=(0,b.YP)((function(){return[t.title,t.visible,t.legendEnabled]}),(function(){return u._constructLegendElementsForWMSSublayers()})),u._handles.add(a,"wms-sublayers-watcher"),!(!u.respectLayerVisibility||t.visible&&t.legendEnabled)){e.next=7;break}return e.next=5,u._generateSymbolTableElementForWMSSublayer(t,n);case 5:(l=e.sent)&&l.infos.length&&r.unshift(l);case 7:case"end":return e.stop()}}),e)})),l.s();case 7:if((s=l.n()).done){e.next=11;break}return e.delegateYield(o(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),l.e(e.t1);case 16:return e.prev=16,l.f(),e.finish(16);case 19:return e.abrupt("return",r);case 20:case"end":return e.stop()}}),e,this,[[4,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForWMSSublayer",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.legendUrl||!t.sublayers){e.next=5;break}return e.next=3,this._generateLegendElementsForWMSSublayers(t.sublayers,n);case 3:return r=e.sent.filter((function(e){return e})),e.abrupt("return",{type:"symbol-table",title:t.title,infos:r});case 5:return e.abrupt("return",this._generateSymbolTableElementForLegendUrl(t,n));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForLegendUrl",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r,a,l,s,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.legendUrl){e.next=3;break}return e.abrupt("return");case 3:return l={type:"symbol-table",title:t.title||t.name||t.id&&t.id+"",infos:[]},n&&(a=(0,D.fl)(a,n)),s=null,o=null===(r=t.layer)||void 0===r?void 0:r.opacity,e.prev=7,e.next=10,(0,R.default)(a,{responseType:"image"});case 10:(s=e.sent.data)&&(s.style.opacity=o),e.next=16;break;case 14:e.prev=14,e.t0=e.catch(7);case 16:return e.abrupt("return",(l.infos.push({src:a,preview:s,opacity:o}),l));case 17:case"end":return e.stop()}}),e,null,[[7,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getLegendLayers",value:function(e,t){var n=yt&&yt[e];return n?Promise.resolve(n):this._legendRequest(t).then((function(t){var n=t.layers;return yt[e]=n,n}))}},{key:"_legendRequest",value:function(e){var t=this.layer,n={f:"json",dynamicLayers:e};if(st(t)){var r=t.exportImageServiceParameters.renderingRule;if(r&&(n.renderingRule=JSON.stringify(r.rasterFunctionDefinition||r.toJSON())),t.bandIds&&(n.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){var i=t.raster,a=t.viewId,l=t.customParameters;n=(0,h.Z)((0,h.Z)({raster:i,viewId:a},n),l)}}var s=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){var o=s.indexOf("?");o>-1?s=s.substring(0,o)+"/legend"+s.substring(o):s+="/legend"}else{var u=s.toLowerCase().indexOf("/rest/"),c=s.substring(0,u)+s.substring(u+5,s.length);s="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(c)+"&returnbytes=true"}return(0,R.default)(s,{query:n}).then((function(e){return e.data}))}},{key:"_constructLegendElementsForBuildingSceneLayer",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,n=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("sublayers-watcher"),t=this.layer,this._handles.add((0,b.YP)((function(){return t.sublayers}),(function(){return n._constructLegendElementsForBuildingSceneLayer()})),"sublayers-watcher"),e.prev=3,e.next=6,this._generateLegendElementsForBuildingSublayers(t.sublayers,this.opacity);case 6:this.legendElements=e.sent,this.notifyChange("ready"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),z.Z.getLogger(this.declaredClass).warn("Request to server for legend has failed!",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForBuildingSublayers",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r,a,l,s,o,u=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],this._handles.add(t.on("change",(function(){return u._constructLegendElementsForBuildingSceneLayer()})),"sublayers-watcher"),a=t.toArray(),l=(0,S.Z)(a),e.prev=4,o=(0,i.Z)().mark((function e(){var t,a,l,o,c,d,f;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.value,a=(0,b.YP)((function(){return["renderer"in t&&t.renderer,t.opacity,t.title,t.visible]}),(function(){return u._constructLegendElementsForBuildingSceneLayer()})),u._handles.add(a,"sublayers-watcher"),u.respectLayerVisibility&&!t.visible){e.next=21;break}if(l=t&&null!=t.opacity?t.opacity:null,o=null!=l?l*n:n,"building-group"!==t.type){e.next=12;break}return d={type:"symbol-table",title:t.title,infos:[]},e.next=8,u._generateLegendElementsForBuildingSublayers(t.sublayers,o);case 8:f=e.sent,(c=d.infos).push.apply(c,(0,I.Z)(f)),r=[d].concat((0,I.Z)(r)),e.next=21;break;case 12:if(!t.renderer){e.next=21;break}return e.t0=[],e.t1=I.Z,e.next=17,u._getRendererLegendElements(t.renderer,{title:t.title,opacity:o,sublayer:t});case 17:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=(0,I.Z)(r),r=e.t0.concat.call(e.t0,e.t3,e.t4);case 21:case"end":return e.stop()}}),e)})),l.s();case 7:if((s=l.n()).done){e.next=11;break}return e.delegateYield(o(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),l.e(e.t1);case 16:return e.prev=16,l.f(),e.finish(16);case 19:return e.abrupt("return",r.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)})));case 20:case"end":return e.stop()}}),e,this,[[4,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_constructLegendElementsForSublayers",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,n=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("sublayers-watcher"),t=this.layer,this._handles.add((0,b.YP)((function(){return t.sublayers}),(function(){return n._constructLegendElementsForSublayers})),"sublayers-watcher"),e.prev=3,e.next=6,this._generateLegendElementsForSublayers(t.sublayers,this.opacity);case 6:this.legendElements=e.sent,this.notifyChange("ready"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),z.Z.getLogger(this.declaredClass).warn("Request to server for legend has failed!",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForSublayers",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n,r){var a,l,s,o,u,c,d=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.layer,l=[],this._handles.add(t.on("change",(function(){return d._constructLegendElementsForSublayers()})),"sublayers-watcher"),s=t.toArray(),!r&&this.sublayerIds&&this.sublayerIds.length&&(s=this.sublayerIds.map((function(e){return a.findSublayerById(e)})).filter(Boolean)),o=(0,S.Z)(s),e.prev=6,c=(0,i.Z)().mark((function e(){var t,s,o,c,f,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.value,s=(0,b.YP)((function(){return[t.renderer,t.opacity,t.title,t.visible,t.legendEnabled]}),(function(){return d._constructLegendElementsForSublayers()})),d._handles.add(s,"sublayers-watcher"),d.respectLayerVisibility&&!(t.visible&&t.legendEnabled&&d._isSublayerInScale(t))){e.next=21;break}if(o=t&&null!=t.opacity?t.opacity:null,c=null!=o?o*n:n,f=!!et(a)||t.originIdOf("renderer")>P.s3.SERVICE,!t.renderer||t.sublayers||!f){e.next=17;break}return e.next=7,t.load();case 7:return e.t0=[],e.t1=I.Z,e.next=11,d._getRendererLegendElements(t.renderer,{title:t.title,opacity:c,sublayer:t});case 11:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=(0,I.Z)(l),l=e.t0.concat.call(e.t0,e.t3,e.t4),e.next=21;break;case 17:return e.next=19,d._generateSymbolTableElementForSublayer(t,c,r);case 19:(h=e.sent)&&l.unshift(h);case 21:case"end":return e.stop()}}),e)})),o.s();case 9:if((u=o.n()).done){e.next=13;break}return e.delegateYield(c(),"t0",11);case 11:e.next=9;break;case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(6),o.e(e.t1);case 18:return e.prev=18,o.f(),e.finish(18);case 21:return e.abrupt("return",l.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)})));case 22:case"end":return e.stop()}}),e,this,[[6,15,18,21]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForSublayer",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n,r){var a,l,s,o,u,c,d;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=9;break}return r=new Map,a=this.layer,l=t.source,s=null,(l&&("map-layer"!==l.type||l.mapLayerId!==t.id||l.gdbVersion&&l.gdbVersion!==("gdbVersion"in a&&a.gdbVersion))||t.originIdOf("renderer")>P.s3.SERVICE||t.originIdOf("labelingInfo")>P.s3.SERVICE||t.originIdOf("labelsVisible")>P.s3.SERVICE)&&(o=new N.R({layer:this.layer}),s=o.hasDynamicLayers?o.dynamicLayers:null,o.destroy()),u=s||"".concat(a.uid,"-default"),e.next=8,this._getLegendLayers(u,s);case 8:e.sent.forEach((function(e){return r.set(e.layerId,e)}));case 9:if(!(!(c=r.get(t.id))||null!==c&&void 0!==c&&c.subLayerIds&&c.defaultVisibility)||!t.sublayers){e.next=15;break}return e.next=13,this._generateLegendElementsForSublayers(t.sublayers,n,r);case 13:return d=e.sent,e.abrupt("return",{type:"symbol-table",title:t.title,infos:d});case 15:return e.abrupt("return",this._generateSymbolTableElementForLegendLayer(c,t,n));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForLegendLayer",value:function(e,t,n){var r,i=this;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;var a=null===t||void 0===t?void 0:t.renderer,l=(null===t||void 0===t?void 0:t.title)||e.layerName;if(a&&(!t||(null===t||void 0===t?void 0:t.originIdOf("renderer"))>P.s3.SERVICE)){var s=(null===t||void 0===t?void 0:t.title)||this._getRendererTitle(a,t);s&&(l&&"string"!=typeof s&&"title"in s&&(s.title=l),l=s)}var o={type:"symbol-table",title:l,legendType:e.legendType?e.legendType:null,infos:[]},u=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return(null===(r=e.legendGroups)||void 0===r?void 0:r.length)>0?e.legendGroups.forEach((function(t){var r,a={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:i._generateSymbolTableElementInfosForLegendLayer(u.filter((function(e){return e.groupId===t.id})),e.layerId,n)};(null===(r=a.infos)||void 0===r?void 0:r.length)>0&&o.infos.push(a)})):o.infos=this._generateSymbolTableElementInfosForLegendLayer(u,e.layerId,n),o.infos.length>0?o:null}},{key:"_generateSymbolTableElementInfosForLegendLayer",value:function(e,t,n){var r=this;return e.map((function(e){var i=e.url;if(e.imageData&&e.imageData.length>0)i="data:image/png;base64,".concat(e.imageData);else{if(0===i.indexOf("http"))return null;i=(0,E.Dp)("".concat(r.layer.url,"/").concat(t,"/images/").concat(i))}return{label:e.label,src:i,opacity:null!==n&&void 0!==n?n:r.opacity,width:e.width,height:e.height}})).filter((function(e){return!!e}))}},{key:"_isSublayerInScale",value:function(e){var t=e.minScale||0,n=e.maxScale||0;return!(t>0&&t<this.scale||n>this.scale)}},{key:"_isLegendLayerInScale",value:function(e,t){var n=t||this.layer,r=null,i=null,a=!0;return!n.minScale&&0!==n.minScale||!n.maxScale&&0!==n.maxScale?(0===e.minScale&&n.tileInfo&&(r=n.tileInfo.lods[0].scale),0===e.maxScale&&n.tileInfo&&(i=n.tileInfo.lods[n.tileInfo.lods.length-1].scale)):(r=Math.min(n.minScale,e.minScale)||n.minScale||e.minScale,i=Math.max(n.maxScale,e.maxScale)),(r>0&&r<this.scale||i>this.scale)&&(a=!1),a}},{key:"_sanitizeLegendForSublayer",value:function(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;var n=t.renderer,r=e.some((function(e){return e.values})),i=null,a=null;return r&&e.some((function(e,t){return e.values||(i=t,(a=e).label||(a.label="others")),null!=a})),n?"unique-value"===n.type?a&&(e.splice(i,1),e.push(a)):"class-breaks"===n.type&&(a&&e.splice(i,1),e.reverse(),a&&e.push(a)):a&&(e.splice(i,1),e.push(a)),e}},{key:"_getRendererLegendElements",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,a=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:{},Xe(t,this.view)){e.next=3;break}return e.abrupt("return",(z.Z.getLogger(this.declaredClass).warn("Renderer of type '".concat(t.type,"' not supported!")),[]));case 3:if(!je(t)){e.next=5;break}return e.abrupt("return",this._constructPointCloudRendererLegendElements(t,n));case 5:if(!Qe(t)){e.next=7;break}return e.abrupt("return",this._constructDotDensityRendererLegendElements(t));case 7:return e.next=9,this._loadRenderer(t);case 9:return r=e.sent,e.abrupt("return",$e(r)?this._constructPieChartRendererLegendElements(r):this._constructRendererLegendElements(r,n));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getLegendElementsForFeatureReduction",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.abrupt("return",("binning"===t.type?n=t.renderer:"cluster"===t.type&&(n=this._getClusterRenderer(t)),n?this._getRendererLegendElements(n):[]));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getPointCloudRendererTitle",value:function(e){return e.legendOptions&&e.legendOptions.title||e.field}},{key:"_constructPointCloudRendererLegendElements",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.title,i=[],a=null,l=null;if(qe(e))a={type:"symbol-table",title:r||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((function(e){a.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:t._getAppliedCloneSymbol(Ae,e.color)})}));else if(Je(e)){var s=e.stops,o=null;if(s.length&&(1===s.length&&(o=s[0].color),!o)){var u=s[0].value,c=s[s.length-1].value;null!=u&&null!=c&&(o=(0,K.QQ)(u+(c-u)/2,s))}a={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(Ae,o||Ae.color)}]};var d=(0,K.NA)(e.stops);l={type:"color-ramp",title:r||this._getPointCloudRendererTitle(e),infos:d,preview:(0,G.jT)(d.map((function(e){return e.color})))}}else Ge(e)&&(a={type:"symbol-table",title:r||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((function(e){a.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:t._getAppliedCloneSymbol(Ae,e.color)})})));a&&a.infos.length&&i.push(a),l&&l.infos.length&&i.push(l);var f=i.reduce((function(e,t){return e.concat(t.infos)}),[]).filter((function(e){return!!e.symbol})).map((function(n){return t._getSymbolPreview(n,t.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})}));return(0,T.as)(f).then((function(){return i}))}},{key:"_getElementInfoForDotDensity",value:function(e,t){var n,r=e.backgroundColor,i=e.outline,a=e.dotSize,l=null===(n=this.effectList)||void 0===n?void 0:n.effects.map((function(e){return e.toJSON()})),s=(0,M.rM)(l),o=a+"-"+t+"-"+r+"-"+(i&&JSON.stringify(i.toJSON()))+"-"+s,u=this._dotDensityUrlCache,c=u.has(o)?u.get(o):(0,G.k)(e,t);u.set(o,c);var d={shape:{type:"image",x:0,y:0,width:c.width,height:c.height,src:c.src},fill:null,stroke:null,offset:[0,0]},f=(0,J.wh)([[d]],[c.width,c.height],{effectView:this.effectList});return{opacity:1,src:c.src,preview:f,width:c.width,height:c.height}}},{key:"_constructDotDensityRendererLegendElements",value:function(e){var t=this,n=e.calculateDotValue(this.view.scale),r=e.legendOptions&&e.legendOptions.unit,i={type:"symbol-table",title:{value:n&&Math.round(n),unit:r||""},infos:[]};return e.attributes.forEach((function(n){var r=t._getElementInfoForDotDensity(e,n.color);r.label=n.label||n.valueExpressionTitle||n.field,i.infos.push(r)})),Promise.resolve([i])}},{key:"_constructPieChartRendererLegendElements",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,a,l,s,o,u,c,d,f,h,y,p,v,m,g=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=this.layer.opacity,s=[],o=null,u=t.outline,t.attributes.forEach((function(e){var t=new le.Z({color:e.color,outline:u}),n=e.label||e.valueExpressionTitle||e.field;s.push({label:n,symbol:t})})),c=s.length?[].concat(s):[],null!==(n=t.othersCategory)&&void 0!==n&&n.color&&0!==(null===(r=t.othersCategory)||void 0===r?void 0:r.threshold)&&(d=new le.Z({color:t.othersCategory.color,outline:u}),o=t.othersCategory.label||"Other",s.push({label:o,symbol:d})),null!==(a=t.defaultColor)&&void 0!==a&&a.a&&(f=new le.Z({color:t.defaultColor,outline:u}),s.push({label:t.defaultLabel,symbol:f})),e.next=9,this._getVisualVariableLegendElements(t,this.layer);case 9:if(e.t0=e.sent,e.t0){e.next=12;break}e.t0=[];case 12:return h=e.t0,s.length&&(h.unshift({type:"symbol-table",title:null,infos:s}),p=c.filter((function(e){return e.label!==o})).map((function(e){return e.symbol.color})).filter(Boolean),v=(0,G.LC)(p,{holePercentage:t.holePercentage,backgroundColor:null===(y=t.backgroundFillSymbol)||void 0===y?void 0:y.color,effectList:this.effectList,outline:u}),h.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(t,this.layer),infos:s,preview:v})),m=h.reduce((function(e,t){return e.concat(g._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)&&!(null!==e&&void 0!==e&&e.preview)})).map((function(e){return g._getSymbolPreview(e,l,{effectList:g.effectList})})),e.next=17,(0,T.as)(m);case 17:return e.abrupt("return",h);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_constructRendererLegendElements",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,a,l,s,o,u,c,d,f,h,y,p,v,m,b,_,w,L,k,x,C,Z,E,R,V,F,z,A,D,P,O,M,N,B,H,U,Y,j,q,J,Q,$,X,K,ne,ie,ae,le,se,oe,ue,ce,de,fe,he,ye,pe,ve,me,ge,be,_e,we,Le=this,ke=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ke.length>1&&void 0!==ke[1]?ke[1]:{},r=n.title,a=n.sublayer,l=a||this.layer,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null,e.next=5,this._getVisualVariableLegendElements(t,l);case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0=[];case 8:if(s=e.t0,o={type:"symbol-table",title:r||this._getRendererTitle(t,l),infos:[]},u=null,c=!1,d=new Set,!Pe(t)||this._hasSizeRamp){e.next=19;break}return e.next=15,(0,re.y$)(t);case 15:f=e.sent,o.infos.push({label:null,symbol:f}),e.next=84;break;case 19:if(!dt(t)){e.next=25;break}h=r,y=ft(t)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",p=s.findIndex((function(e){return"color-ramp"===e.type})),v=-1!==p?s.splice(p,1)[0]:null,m=s.findIndex((function(e){return"size-ramp"===e.type})),b=-1!==m?s.splice(m,1)[0]:null,_=[],v&&(h=v.title,_.push(v)),b&&(h=b.title,_.push(b)),_.length>0&&s.push({type:y,title:h,infos:_}),e.next=84;break;case 25:if(!Ye(t)){e.next=30;break}w=(0,ee.h)(t),s.push({type:"heatmap-ramp",title:r||this._getRendererTitle(t,l),infos:w,preview:(0,G.jT)(w.map((function(e){return e.color})),{effectList:this.effectList})}),e.next=84;break;case 30:if(!Ue(t)){e.next=36;break}if((L=t&&t.authoringInfo)&&"relationship"===L.type){if(k=L.focus,x=L.numClasses,C=L.field1,Z=L.field2,x&&C&&Z){for(E=[C,Z],R=(0,te.N_)(k)||0,V=0,F=E;V<F.length;V++)z=F[V],A=z.field,D=z.normalizationField,P=z.label,O=P||{field:this._getFieldAlias(A,l),normField:D&&this._getFieldAlias(D,l)},(M=ht.clone()).angle=R,o.infos.push({label:O,symbol:M}),d.add(M),R+=90;N=(0,te.mg)({focus:k,numClasses:x,infos:t.uniqueValueInfos}),s.unshift(N)}}else st(this.layer)||ot(this.layer)?t.uniqueValueInfos.forEach((function(e){e.symbol&&o.infos.push({label:e.label||e.value,value:e.value,symbol:e.symbol})})):(H=(B=t).field,U=B.field2,Y=B.field3,j=B.fieldDelimiter,q=B.valueExpression,J=B.defaultSymbol,Q=!(!H&&!q||!U&&!Y),$=[],t.uniqueValueGroups.forEach((function(e){var t={type:"symbol-table",title:e.heading,infos:[]};e.classes.forEach((function(e){var n=e.symbol,r=e.values;if(n){var i,a=[],s=[],o=(0,S.Z)(r);try{for(o.s();!(i=o.n()).done;){var u=i.value,c=u.value,d=u.value2,f=u.value3,h=[],y=[];(H||q)&&(h.push(c),y.push(Le._getDomainName(H,c,l))),U&&(h.push(d),y.push(Le._getDomainName(U,d,l))),Y&&(h.push(f),y.push(Le._getDomainName(Y,f,l))),a.push(Q?h.join(j||""):h[0]),s.push(y.join(" - "))}}catch(g){o.e(g)}finally{o.f()}var p=a.join(", "),v=e.label;if(!v){var m=s.filter(Boolean);v=m.length?m.join(", "):p}t.infos.push({label:v,value:p,symbol:n})}})),t.infos.length&&$.push(t)})),$.length&&(ne=$[0],1===$.length&&"title"in ne&&!ne.title?(X=o.infos).push.apply(X,(0,I.Z)(ne.infos)):(J&&($.push({type:"symbol-table",infos:[{label:t.defaultLabel||"others",symbol:J}]}),c=!0),(K=o.infos).push.apply(K,$)),r||t.legendOptions&&t.legendOptions.title||t.valueExpressionTitle||(o.title=null)));t.defaultSymbol&&!c&&(o.infos.push({label:t.defaultLabel||"others",symbol:t.defaultSymbol}),c=!0),e.next=84;break;case 36:if(!He(t)){e.next=41;break}(!(u=this._isUnclassedRenderer(t))||!this._hasSizeRamp)&&(t.classBreakInfos.forEach((function(e){e.symbol&&o.infos.unshift({label:e.label||(u?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})})),u&&(o.title=null),this._updateInfosforClassedSizeRenderer(t,o.infos)),t.defaultSymbol&&!u&&(o.infos.push({label:t.defaultLabel||"others",symbol:t.defaultSymbol}),c=!0),e.next=84;break;case 41:if(!Ne(t)){e.next=65;break}if(!ot(this.layer)&&!ut(this.layer)){e.next=47;break}ct(ie=this._constructTileImageryStretchRendererElements(t))?s.push(ie):o.infos=ie,e.next=63;break;case 47:if(ae=this.layer,t.statistics&&t.statistics.length&&(le=null!=t.statistics[0].min?t.statistics[0].min:t.statistics[0][0],se=null!=t.statistics[0].max?t.statistics[0].max:t.statistics[0][1]),oe=[],e.t1=g.Wg,!ae.renderingRule){e.next=57;break}return e.next=54,ae.generateRasterInfo(ae.renderingRule);case 54:e.t2=e.sent,e.next=58;break;case 57:e.t2=ae.serviceRasterInfo;case 58:e.t3=e.t2,ue=(0,e.t1)(e.t3),ce=ue.keyProperties.BandProperties,de=(0,W.r)(ue.pixelType),1===ue.bandCount?(he=(null===(fe=ae.bandIds)||void 0===fe?void 0:fe[0])||0,le=null!=le?le:ue.statistics?ue.statistics[he].min:de[0],se=null!=se?se:ue.statistics?ue.statistics[he].max:de[1],le||se?s.push(this._getStretchLegendElements(t,{min:le,max:se})):this._getServerSideLegend()):ae.bandIds&&1===ae.bandIds.length?(le=null!=le?le:ue.statistics?ue.statistics[ae.bandIds[0]].min:de[0],se=null!=se?se:ue.statistics?ue.statistics[ae.bandIds[0]].max:de[1],le||se?s.push(this._getStretchLegendElements(t,{min:le,max:se})):this._getServerSideLegend()):ue.bandCount>=3?ce&&ce.length>=ue.bandCount?ae.bandIds&&3===ae.bandIds.length?(oe=ae.bandIds.map((function(e){return ce[e].BandName})),o.infos=this._createSymbolTableElementMultiBand(oe)):"lerc"===ae.format?(oe=[0,1,2].map((function(e){return ce[e].BandName})),o.infos=this._createSymbolTableElementMultiBand(oe)):this._getServerSideLegend():"lerc"===ae.format?(oe=["band1","band2","band3"],o.infos=this._createSymbolTableElementMultiBand(oe)):this._getServerSideLegend():this._getServerSideLegend();case 63:e.next=84;break;case 65:if(!Me(t)){e.next=69;break}t.colormapInfos.forEach((function(e){o.infos.push({label:e.label,value:e.value,symbol:Le._getAppliedCloneSymbol(De,e.color)})})),e.next=84;break;case 69:if(!We(t)){e.next=83;break}ye=t.symbol,e.t4=n.geometryType,e.next="point"===e.t4?74:"polyline"===e.t4?76:"polygon"===e.t4?78:79;break;case 74:return ye="pointSymbol"in l&&l.pointSymbol,e.abrupt("break",79);case 76:return ye="lineSymbol"in l&&l.lineSymbol,e.abrupt("break",79);case 78:ye="polygonSymbol"in l&&l.polygonSymbol;case 79:pe=this._hasClusterSizeVariable&&this._getClusterSymbol()||!this._hasSizeRamp,t.symbol&&pe&&o.infos.push({label:t.label,symbol:ye}),e.next=84;break;case 83:Oe(t)?(t.outputUnit&&(this.title="("+t.toJSON().outputUnit+")"),o.title=t.attributeField,null!==(ve=t.getClassBreakInfos())&&void 0!==ve&&ve.length?ve.forEach((function(e){o.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):o.infos.push({label:t.attributeField,symbol:t.getDefaultSymbol()})):Be(t)&&s.push(this._getStretchLegendElements(t,{min:0,max:255}));case 84:return!(me=t.defaultSymbol)||c||We(t)||u&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||s.push({type:"symbol-table",infos:[{label:t.defaultLabel||"others",symbol:me}]}),o.infos.length&&s.unshift(o),ge=null==n.opacity?this.opacity:n.opacity,be=this._isTallSymbol("visualVariables"in t&&t.visualVariables),_e=st(this.layer)||ot(this.layer),we=s.reduce((function(e,t){return e.concat(Le._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)})).map((function(e){return Le._getSymbolPreview(e,ge,{isDefault:e.symbol===me,applyScaleDrivenSize:!d.has(e.symbol),symbolConfig:{isTall:be,isSquareFill:_e},effectList:d.has(e.symbol)?null:Le.effectList})})),t=null,e.next=90,(0,T.as)(we);case 90:return e.abrupt("return",s);case 91:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getServerSideLegend",value:function(){var e=this;setTimeout((function(){return e.buildLegendElementsForTools()}),0)}},{key:"_getAllInfos",value:function(e){var t=this,n=null===e||void 0===e?void 0:e.infos;return n?n.reduce((function(e,n){return e.concat(t._getAllInfos(n))}),[]):[e]}},{key:"_constructTileImageryStretchRendererElements",value:function(e){var t,n,r,i,a,l=this.layer,s=l.raster.rasterInfo,o=s.bandCount||e.statistics.length,u=s.keyProperties&&s.keyProperties.BandProperties,c=null!==e&&void 0!==e&&null!==(t=e.statistics)&&void 0!==t&&t.length?e.statistics:null===s||void 0===s?void 0:s.statistics;if(c)r=void 0!==c[0].min?c[0].min:c[0][0],i=c[0].max||c[0][1];else{var d=(0,W.r)(s.pixelType);r=d[0],i=d[1]}if(l.hasStandardTime()&&(r=l.getStandardTimeValue(r),i=l.getStandardTimeValue(i)),1===s.bandCount||1===(null===(n=l.bandIds)||void 0===n?void 0:n.length))return this._getStretchLegendElements(e,{min:r,max:i});function f(e){var t,n=(null!==l&&void 0!==l&&null!==(t=l.bandIds)&&void 0!==t&&t.length?l.bandIds:Array.from(Array(Math.min(s.bandCount,3)).keys())).map((function(t){return e&&e[t]&&e[t].BandName||"band"+(t+1)}));return n.length<3?n.push(n[1]):n.length>3&&n.splice(3),n}return a=u&&u.length>=o?f(u):f(),this._createSymbolTableElementMultiBand(a)}},{key:"_getStretchLegendElements",value:function(e,t){var n=e.colorRamp,r=(0,K.fD)(n,t);return{type:"stretch-ramp",title:"",infos:r,preview:(0,G.jT)(r.map((function(e){return e.color})))}}},{key:"_getClusterSymbol",value:function(){var e,t=this.layer,n="featureReduction"in t&&t.featureReduction,r=n&&"symbol"in n&&n.renderer;return r&&!0!==(null===r||void 0===r||null===(e=r.authoringInfo)||void 0===e?void 0:e.isAutoGenerated)?null:n&&"symbol"in n&&n.symbol}},{key:"_getSizeLegendElement",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n,r,a){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this._hasClusterSizeVariable?this._getClusterTitle(n):t,e.t1=fe,e.t2=r,e.t3=n,e.next=6,(0,re.jb)(r);case 6:return e.t4=e.sent,e.t5=this.scale,e.t6=this.view.type,e.t7=a,e.t8=this._hasClusterSizeVariable?this._getClusterSymbol():null,e.next=13,(0,e.t1)(e.t2,e.t3,e.t4,e.t5,e.t6,e.t7,e.t8);case 13:return e.t9=e.sent,e.abrupt("return",{type:"size-ramp",title:e.t0,infos:e.t9});case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_createSymbolTableElementMultiBand",value:function(e){var t=this,n=[],r=["red","green","blue"];return e.forEach((function(e,i){var a;n.push({label:{colorName:r[i],bandName:e},src:re.uY[i],opacity:null!==(a=t.opacity)&&void 0!==a?a:1})})),n}},{key:"_updateInfosforClassedSizeRenderer",value:function(e,t){var n=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,r=e.classBreakInfos.some((function(e){return(0,Q.YW)(e.symbol)}));if(n&&r){var i=e.classBreakInfos.length,a=18/(i>1?i-1:i);t.forEach((function(e,t){e.size=30-a*t}))}}},{key:"_isTallSymbol",value:function(e){var t=!1,n=!1;if(e)for(var r=0;r<e.length&&(!t||!n);r++){var i=e[r];"size"===i.type&&("height"===i.axis&&(t=!0),"width-and-depth"===i.axis&&(n=!0))}return t&&n}},{key:"_getSymbolPreview",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var l,s,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=null!==a&&void 0!==a&&a.isDefault||null!=t.size||!this._hasSizeRamp?t.size:(0,A.Wz)(q.b_.size),!this._scaleDrivenSizeVariable||null===a||void 0===a||!a.applyScaleDrivenSize){e.next=7;break}return e.next=4,Promise.resolve().then(n.bind(n,56011));case 4:s=e.sent,o=s.getSize,l=o(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===t.symbol.type?t.symbol.style:null});case 7:return e.abrupt("return",(0,G.l3)(t.symbol,{size:l,opacity:r,scale:!1,symbolConfig:null===a||void 0===a?void 0:a.symbolConfig,effectView:null===a||void 0===a?void 0:a.effectList}).then((function(e){return t.preview=e,t})).catch((function(){return t.preview=null,t})));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_getClusterRenderer",value:function(e){var t;this._hasClusterSizeVariable=!1;var n="renderer"in this.layer&&this.layer.renderer,r=(null===(t=e.renderer)||void 0===t?void 0:t.clone())||(null===n||void 0===n?void 0:n.clone()),i=(0,g.Wg)(X(this.layerView._effectiveRenderer,this.view));if(i&&"visualVariables"in r){var a,l=null===(a=r.visualVariables)||void 0===a?void 0:a.some((function(e){return"size"===e.type&&"outline"!==e.target&&!ze.test(e.valueExpression)}));if(!l){if("clusterMinSize"in e&&"clusterMaxSize"in e){var s=e.clusterMinSize,o=e.clusterMaxSize;i.legendOptions=new Y.Z({showLegend:s!==o})}var u=r.visualVariables||[];r.visualVariables=u.concat([i]),this._hasClusterSizeVariable=!0}}return r}},{key:"_loadRenderer",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,a,l,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],r=t.clone(),e.next=4,(0,re.jb)(r);case 4:return a=e.sent,(He(r)||Ue(r))&&(l=(r.classBreakInfos||r.uniqueValueInfos).map((function(e){return s._fetchSymbol(e.symbol,a).then((function(t){e.symbol=t})).catch((function(){e.symbol=null}))})),Array.prototype.push.apply(n,l)),e.abrupt("return",(n.push(this._fetchSymbol(r.symbol||r.defaultSymbol,r.defaultSymbol?null:a).then((function(e){s._applySymbolToRenderer(r,e,We(r))})).catch((function(){s._applySymbolToRenderer(r,null,We(r))}))),(0,T.as)(n).then((function(){return r}))));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_applySymbolToRenderer",value:function(e,t,n){n?e.symbol=t:e.defaultSymbol=t}},{key:"_fetchSymbol",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error;case 2:if("web-style"!==t.type){e.next=14;break}return r=this._webStyleSymbolCache,e.prev=4,e.next=7,"2d"===this.view.type?t.fetchCIMSymbol({cache:r}):t.fetchSymbol({cache:r});case 7:return a=e.sent,e.abrupt("return",this._getAppliedCloneSymbol(a,n));case 11:throw e.prev=11,e.t0=e.catch(4),z.Z.getLogger(this.declaredClass).warn("Fetching web-style failed!"),new Error;case 14:return e.abrupt("return",this._getAppliedCloneSymbol(t,n));case 15:case"end":return e.stop()}}),e,this,[[4,11]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getAppliedCloneSymbol",value:function(e,t){if(!e||!t)return e;var n=e.clone(),r=t&&t.toRgba();return n.type.includes("3d")?this._applyColorTo3dSymbol(n,r):"cim"===n.type?(0,j.ZB)(n,t):n.color&&(n.color=new Z.Z(r||n.color)),n}},{key:"_applyColorTo3dSymbol",value:function(e,t){t&&e.symbolLayers.forEach((function(e){e&&(e.material||(e.material={}),e.material.color=new Z.Z(t))}))}},{key:"_getVisualVariableLegendElements",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r,l,s,o,u,c,d,f,h,y,p,v,m,b=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("visualVariables"in t&&t.visualVariables&&"vector-field"!==t.type){e.next=2;break}return e.abrupt("return",null);case 2:r=t.visualVariables,l=[],s=[],o=[],u=(0,S.Z)(r);try{for(u.s();!(c=u.n()).done;)"color"===(d=c.value).type?l.push(d):"size"===d.type?s.push(d):"opacity"===d.type&&o.push(d)}catch(_){u.e(_)}finally{u.f()}return f=[].concat(l,s,o),0===l.length&&He(t)&&t.classBreakInfos&&1===t.classBreakInfos.length&&(p=t.classBreakInfos[0],h=p&&p.symbol),0===l.length&&We(t)&&(h=t.symbol),h&&(h.type.includes("3d")?"water"===(v=h.symbolLayers.getItemAt(0)).type?(0,g.pC)(v.color)&&(y=v.color):(0,g.pC)(v.material)&&(0,g.pC)(v.material.color)&&(y=v.material.color):h.url||(y=h.color)),m=this.effectList,e.next=11,Promise.all(f.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(r){var a,l,s,o,u,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.legendOptions&&!1===r.legendOptions.showLegend){e.next=28;break}if(a=Pe(t)?r.field:b._getRampTitle(r,n),l=null,s="getField"in n&&n.getField&&n.getField(r.field),o=s&&(0,B.y2)(s),"color"!==r.type){e.next=11;break}return e.next=7,(0,K.pO)(r,null,o);case 7:u=e.sent,l={type:"color-ramp",title:a,infos:u,preview:(0,G.jT)(u.map((function(e){return e.color})),{effectList:m})},b._hasColorRamp||(b._hasColorRamp=!(null==l.infos||!l.infos.length)),e.next=27;break;case 11:if("size"!==r.type||"outline"===r.target){e.next=22;break}if(!ze.test(r.valueExpression)){e.next=16;break}b._hasClusterSizeVariable||(b._scaleDrivenSizeVariable=r),e.next=20;break;case 16:return e.next=18,b._getSizeLegendElement(a,r,t,o);case 18:l=e.sent,b._hasSizeRamp||(b._hasSizeRamp=!(null==l.infos||!l.infos.length));case 20:e.next=27;break;case 22:if("opacity"!==r.type){e.next=27;break}return e.next=25,(0,K.pO)(r,y,o);case 25:c=e.sent,l={type:"opacity-ramp",title:a,infos:c,preview:(0,G.jT)(c.map((function(e){return e.color})),{effectList:m})},b._hasOpacityRamp||(b._hasOpacityRamp=!(null==l.infos||!l.infos.length));case 27:return e.abrupt("return",l&&l.infos?l:null);case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return e.abrupt("return",e.sent.filter((function(e){return!!e})));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getDomainName",value:function(e,t,n){if(e&&"function"!=typeof e){var r="getField"in n&&n.getField&&n.getField(e),i=r&&"getFieldDomain"in n&&n.getFieldDomain?n.getFieldDomain(r.name):null;return i&&"coded-value"===i.type?i.getName(t):null}return null}},{key:"_getClusterTitle",value:function(e){var t=this.layer,n=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){var r=t.featureReduction,i="popupTemplate"in r&&r.popupTemplate,a=i&&i.fieldInfos;if(a){var l,s=(0,S.Z)(a);try{for(s.s();!(l=s.n()).done;){var o=l.value;if(o.fieldName===n)return"cluster_count"===n?o.label||{showCount:!0}:o.label}}catch(u){s.e(u)}finally{s.f()}}}return{showCount:!0}}},{key:"_getRampTitle",value:function(e,t){var n=e.field,r=e.normalizationField,i=!1,a=!1,l=!1,s=null;n="function"==typeof n?null:n,r="function"==typeof r?null:r;var o=e.legendOptions&&e.legendOptions.title;if(null!=o)s=o;else if(e.valueExpressionTitle)s=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables)for(var u=t.renderer.authoringInfo.visualVariables,c=0;c<u.length;c++){var d=u[c];if("color"===d.type){if("ratio"===d.style){i=!0;break}if("percent"===d.style){a=!0;break}if("percent-of-total"===d.style){l=!0;break}}}s={field:n&&this._getFieldAlias(n,t),normField:r&&this._getFieldAlias(r,t),ratio:i,ratioPercent:a,ratioPercentTotal:l}}return s}},{key:"_getRendererTitle",value:function(e,t){var n=e;if(n.legendOptions&&n.legendOptions.title)return n.legendOptions.title;if(n.valueExpressionTitle)return n.valueExpressionTitle;var r=n.field,i=null,a=null;if(He(n)&&(i=n.normalizationField,a="percent-of-total"===n.normalizationType),r="function"==typeof r?null:r,i="function"==typeof i?null:i,Ue(n)){var l=n.field2,s=n.field3,o=n.fieldDelimiter,u=r&&this._getFieldAlias(r,t);return l&&(u="<".concat(u,">").concat(o,"<").concat(this._getFieldAlias(l,t),">"),s&&(u="".concat(u).concat(o,"<").concat(this._getFieldAlias(s,t),">"))),u}var c=null;return(r||i)&&(c={field:r&&this._getFieldAlias(r,t),normField:i&&this._getFieldAlias(i,t),normByPct:a}),c}},{key:"_getFieldAlias",value:function(e,t){var n,r,i,a="popupTemplate"in t&&t.popupTemplate,l=a&&a.fieldInfos,s=null;l&&l.some((function(t){return e===t.fieldName&&(s=t,!0)}));var o=null;"getField"in t&&t.getField?o=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(o=t.fieldsIndex.get(e));var u=null,c="featureReduction"in t&&t.featureReduction;c&&(!s&&"popupTemplate"in c&&c.popupTemplate&&c.popupTemplate.fieldInfos&&c.popupTemplate.fieldInfos.some((function(t){var n;return(null===e||void 0===e?void 0:e.toLowerCase())===(null===(n=t.fieldName)||void 0===n?void 0:n.toLowerCase())&&(s=t,!0)})),"fields"in c&&c.fields&&(u=c.fields.find((function(t){var n;return(null===(n=t.name)||void 0===n?void 0:n.toLowerCase())===(null===e||void 0===e?void 0:e.toLowerCase())}))));var d=s||o||u,f=null;return d&&(f=(null===(n=s)||void 0===n?void 0:n.label)||(null===(r=o)||void 0===r?void 0:r.alias)||(null===(i=u)||void 0===i?void 0:i.alias)||"name"in d&&d.name||"fieldName"in d&&d.fieldName),f}},{key:"_isUnclassedRenderer",value:function(e){var t=e.visualVariables,n=!1;return He(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(n=e.field?t.some((function(t){return!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField)})):!!t.length),n}}]),r}(x.Z);(0,v._)([(0,_.Cb)()],pt.prototype,"children",void 0),(0,v._)([(0,_.Cb)({readOnly:!0})],pt.prototype,"effectList",null),(0,v._)([(0,_.Cb)()],pt.prototype,"layerView",void 0),(0,v._)([(0,_.Cb)()],pt.prototype,"layer",void 0),(0,v._)([(0,_.Cb)()],pt.prototype,"legendElements",void 0),(0,v._)([(0,_.Cb)({readOnly:!0})],pt.prototype,"opacity",null),(0,v._)([(0,_.Cb)()],pt.prototype,"parent",void 0),(0,v._)([(0,_.Cb)({readOnly:!0,dependsOn:[]})],pt.prototype,"ready",null),(0,v._)([(0,_.Cb)()],pt.prototype,"hideLayersNotInCurrentView",void 0),(0,v._)([(0,_.Cb)()],pt.prototype,"keepCacheOnDestroy",void 0),(0,v._)([(0,_.Cb)()],pt.prototype,"respectLayerVisibility",void 0),(0,v._)([(0,_.Cb)({readOnly:!0})],pt.prototype,"scale",null),(0,v._)([(0,_.Cb)()],pt.prototype,"sublayerIds",void 0),(0,v._)([(0,_.Cb)({readOnly:!0})],pt.prototype,"isScaleDriven",null),(0,v._)([(0,_.Cb)()],pt.prototype,"title",void 0),(0,v._)([(0,_.Cb)({readOnly:!0,dependsOn:["ready"],value:0})],pt.prototype,"version",null),(0,v._)([(0,_.Cb)()],pt.prototype,"view",void 0);var vt=pt=(0,v._)([(0,L.j)("esri.widgets.Legend.support.ActiveLayerInfo")],pt),mt=n(36257),gt="state",bt="view",_t="all-layer-views",wt="legend-properties",Lt=C.Z.ofType(vt),kt=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.SubtypeGroupLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer","esri.layers.LinkChartLayer","esri.layers.knowledgeGraph.KnowledgeGraphSubLayer"],xt="view.basemapView.baseLayerViews",Ct="view.groundView.layerViews",St="view.basemapView.referenceLayerViews",It=[xt,Ct,"view.layerViews",St],Zt=function(e){(0,y.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,l.Z)(this,n),(r=t.call(this,e))._handles=new m.Z,r._layerViewByLayerId={},r._layerInfosByLayerViewId={},r._activeLayerInfosByLayerViewId={},r._activeLayerInfosWithNoParent=new C.Z,r.activeLayerInfos=new Lt,r.basemapLegendVisible=!1,r.groundLegendVisible=!1,r.hideLayersNotInCurrentView=!1,r.keepCacheOnDestroy=!1,r.respectLayerVisibility=!0,r.layerInfos=[],r.view=null,r}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this;this._handles.add((0,b.YP)((function(){return e.view}),(function(){return e._viewHandles()}),b.nn),bt),this._handles.add((0,mt.qe)((function(){return e._refresh()})))}},{key:"destroy",value:function(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"_viewHandles",value:function(){var e=this;this._handles.remove(gt),this.view&&this._handles.add((0,b.YP)((function(){return e.state}),(function(){return e._stateHandles()}),b.nn),gt)}},{key:"_stateHandles",value:function(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}},{key:"_resetAll",value:function(){this._handles.remove([_t,wt]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}},{key:"_destroyViewActiveLayerInfos",value:function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}},{key:"_destroyViewActiveLayerInfo",value:function(e){this._handles.remove(e);var t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}},{key:"_watchPropertiesAndAllLayerViews",value:function(){var e=this,t=this.view.allLayerViews;t.length&&this._refresh(),this._handles.add(t.on("change",(function(t){return e._allLayerViewsChangeHandle(t)})),_t),this._handles.add((0,b.YP)((function(){return[e.layerInfos,e.basemapLegendVisible,e.groundLegendVisible]}),(function(){return e._propertiesChangeHandle()})),wt)}},{key:"_allLayerViewsChangeHandle",value:function(e){var t=this;e.removed.forEach((function(e){return t._destroyViewActiveLayerInfo(e.uid)})),this._refresh()}},{key:"_propertiesChangeHandle",value:function(){this._destroyViewActiveLayerInfos(),this._refresh()}},{key:"_refresh",value:function(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}},{key:"_sortActiveLayerInfos",value:function(e){var t=this;if(!(e.length<2)){var n=[];e.forEach((function(r){if(!r.parent){var i=r.layer.parent,a=i&&"uid"in i&&t._layerViewByLayerId[i.uid],l=a&&t._activeLayerInfosByLayerViewId[a.uid];l&&e.includes(l)&&(n.push(r),r.parent=l,l.children.add(r),t._sortActiveLayerInfos(l.children))}})),e.removeMany(n);var r={};this.view.allLayerViews.forEach((function(e,t){return r[e.layer.uid]=t})),e.sort((function(e,t){var n=r[e.layer.uid]||0;return(r[t.layer.uid]||0)-n}))}}},{key:"_generateLayerViews",value:function(){var e=[];return It.filter(this._filterLayerViews,this).map(this.get,this).filter((function(e){return null!=e})).forEach(this._collectLayerViews("layerViews",e)),e}},{key:"_filterLayerViews",value:function(e){var t=!this.basemapLegendVisible&&(e===xt||e===St),n=!this.groundLegendVisible&&e===Ct;return!t&&!n}},{key:"_collectLayerViews",value:function(e,t){return function n(r){return r&&r.forEach((function(r){t.push(r),n(r[e])})),t}}},{key:"_filterLayerViewsByLayerInfos",value:function(e){var t=this,n=this.layerInfos;return!n||!n.length||n.some((function(n){return t._hasLayerInfo(n,e)}))}},{key:"_hasLayerInfo",value:function(e,t){var n=this._isLayerUIDMatching(e.layer,t.layer.uid);return n&&(this._layerInfosByLayerViewId[t.uid]=e),n}},{key:"_isLayerUIDMatching",value:function(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}},{key:"_hasLayerUID",value:function(e,t){var n=this;return e&&e.some((function(e){return n._isLayerUIDMatching(e,t)}))}},{key:"_isLayerViewSupported",value:function(e){return!!kt.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}},{key:"_generateActiveLayerInfo",value:function(e){var t=this;this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add((0,b.YP)((function(){var t;return[e.legendEnabled,null===(t=e.layer)||void 0===t?void 0:t.legendEnabled]}),(function(){return t._layerActiveHandle(e)})),e.uid))}},{key:"_layerActiveHandle",value:function(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}},{key:"_isLayerActive",value:function(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}},{key:"_buildActiveLayerInfo",value:function(e){var t,n=this,r=e.layer,i=e.uid,a=this._layerInfosByLayerViewId[i],l=this._activeLayerInfosByLayerViewId[i];if(!l){var s=a&&void 0!==a.title&&a.layer.uid===r.uid;l=new vt({layer:r,layerView:e,title:s?a.title:r.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:a&&a.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=l}var o=r.parent&&"uid"in r.parent&&this._layerViewByLayerId[null===(t=r.parent)||void 0===t?void 0:t.uid];if(l.parent=this._activeLayerInfosByLayerViewId[null===o||void 0===o?void 0:o.uid],!this._handles.has(i)){var u=[(0,b.YP)((function(){return r.title}),(function(e){return n._titleHandle(e,l)})),(0,b.YP)((function(){return[r.opacity,"renderer"in r&&r.renderer,"pointSymbol"in r&&r.pointSymbol,"lineSymbol"in r&&r.lineSymbol,"polygonSymbol"in r&&r.polygonSymbol]}),(function(){return n._constructLegendElements(l)})),(0,b.gx)((function(){var e;return!0===(null===(e=n.view)||void 0===e?void 0:e.stationary)}),(function(){return n._scaleHandle(l)}),b.nn),(0,b.YP)((function(){return e._effectiveRenderer}),(function(){return n._constructLegendElements(l)})),(0,b.YP)((function(){return"effect"in r&&r.effect}),(function(){return n._constructLegendElements(l)}))];if(this.respectLayerVisibility){var c=(0,b.YP)((function(){return e.legendEnabled}),(function(e){return n._legendEnabledHandle(e,l)})),d=(0,b.YP)((function(){return r.legendEnabled}),(function(e){return n._legendEnabledHandle(e,l)}));u.push(c,d)}this._handles.add(u,i)}l.isScaleDriven||this._constructLegendElements(l),this._addActiveLayerInfo(l)}},{key:"_titleHandle",value:function(e,t){t.title=e,this._constructLegendElements(t)}},{key:"_legendEnabledHandle",value:function(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}},{key:"_scaleHandle",value:function(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}},{key:"_addActiveLayerInfo",value:function(e){var t=this,n=e.layerView,r=e.layer;if(this._isLayerActive(n)&&!this.activeLayerInfos.includes(e)){var i=e.parent;if(i)i.children.includes(e)||i.children.push(e),this._sortActiveLayerInfos(i.children);else{var a,l=null===(a=this.layerInfos)||void 0===a?void 0:a.some((function(e){return e.layer.uid===r.uid}));r.parent&&"uid"in r.parent&&!l?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){var s=[];this._activeLayerInfosWithNoParent.forEach((function(e){var n=e.layer.parent,r=n&&"uid"in n&&t._layerViewByLayerId[null===n||void 0===n?void 0:n.uid],i=t._activeLayerInfosByLayerViewId[null===r||void 0===r?void 0:r.uid];i&&(s.push(e),e.parent=i)})),s.length&&(this._activeLayerInfosWithNoParent.removeMany(s),s.forEach((function(e){return t._addActiveLayerInfo(e)})))}}}},{key:"_removeActiveLayerInfo",value:function(e){var t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}},{key:"_constructLegendElements",value:function(e){var t=this,n=e.layer;"featureCollections"in n&&n.featureCollections?e.buildLegendElementsForFeatureCollections(n.featureCollections):"featureReduction"in n&&n.featureReduction&&"renderer"in n.featureReduction&&("binning"===n.featureReduction.type||"cluster"===n.featureReduction.type)?e.buildLegendElementsForFeatureReduction(n.featureReduction):"renderer"in n&&n.renderer&&!("sublayers"in n)?e.buildLegendElementsForRenderer(n.renderer):"url"in n&&n.url?e.buildLegendElementsForTools():e.children.forEach((function(e){return t._constructLegendElements(e)}))}}]),n}(x.Z);(0,v._)([(0,_.Cb)({type:Lt})],Zt.prototype,"activeLayerInfos",void 0),(0,v._)([(0,_.Cb)()],Zt.prototype,"basemapLegendVisible",void 0),(0,v._)([(0,_.Cb)()],Zt.prototype,"groundLegendVisible",void 0),(0,v._)([(0,_.Cb)()],Zt.prototype,"hideLayersNotInCurrentView",void 0),(0,v._)([(0,_.Cb)()],Zt.prototype,"keepCacheOnDestroy",void 0),(0,v._)([(0,_.Cb)()],Zt.prototype,"respectLayerVisibility",void 0),(0,v._)([(0,_.Cb)()],Zt.prototype,"layerInfos",void 0),(0,v._)([(0,_.Cb)({readOnly:!0})],Zt.prototype,"state",null),(0,v._)([(0,_.Cb)()],Zt.prototype,"view",void 0);var Et=Zt=(0,v._)([(0,L.j)("esri.widgets.Legend.LegendViewModel")],Zt),Rt=n(4942),Vt=n(99653),Ft="esri-legend--card",zt="esri-legend",Tt={activated:"".concat(Ft,"__carousel-indicator--activated"),base:Ft,stacked:"".concat(zt,"--stacked"),carouselTitle:"".concat(Ft,"__carousel-title"),indicator:"".concat(Ft,"__carousel-indicator"),intervalSeparator:"".concat(Ft,"__interval-separator"),imageryLayerStretchedImage:"".concat(Ft,"__imagery-layer-image--stretched"),imageLabel:"".concat(Ft,"__image-label"),layerCaption:"".concat(Ft,"__layer-caption"),labelElement:"".concat(Ft,"__label-element"),layerRow:"".concat(Ft,"__layer-row"),labelCell:"".concat(Ft,"__label-cell"),message:"".concat(Ft,"__message"),rampLabel:"".concat(Ft,"__ramp-label"),section:"".concat(Ft,"__section"),relationshipSection:"".concat(Ft,"__relationship-section"),serviceCaptionText:"".concat(Ft,"__service-caption-text"),serviceContent:"".concat(Ft,"__service-content"),service:"".concat(Ft,"__service"),groupLayer:"".concat(Ft,"__group-layer"),groupLayerChild:"".concat(Ft,"__group-layer-child"),symbol:"".concat(Ft,"__symbol"),sizeRampRow:"".concat(Ft,"__size-ramp-row"),symbolRow:"".concat(Ft,"__symbol-row"),symbolCell:"".concat(Ft,"__symbol-cell"),indicatorContainer:"".concat(Ft,"__carousel-indicator-container"),intervalSeparatorsContainer:"".concat(Ft,"__interval-separators-container"),relationshipLabelContainer:"".concat(Ft,"__relationship-label-container"),labelContainer:"".concat(Ft,"__label-container"),serviceCaptionContainer:"".concat(Ft,"__service-caption-container"),symbolContainer:"".concat(Ft,"__symbol-container"),sizeRampContainer:"".concat(Ft,"__size-ramp-container"),sizeRampPreview:"".concat(Ft,"__size-ramp-preview"),pieChartRampPreview:"".concat(Ft,"__pie-chart-ramp-preview"),rampContainer:"".concat(zt,"__ramps"),sizeRampHorizontal:"".concat(zt,"__size-ramp--horizontal"),rampLabelsContainer:"".concat(zt,"__ramp-labels"),layerInfo:"".concat(zt,"__layer-cell ").concat(zt,"__layer-cell--info"),univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card",hidden:"esri-hidden"},At=n(63528),Dt=(n(42877),n(88367)),Pt=n(67005),Ot=(0,Dt.E)(),Mt=20,Nt=10,Bt=20,Wt="esri-univariate-above-and-below-ramp__symbol",Ht="esri-legend__color-ramp";function Ut(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertical",t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?(0,Pt.u)("svg",{height:"4",width:"10"},(0,Pt.u)("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):(0,Pt.u)("svg",{height:"10",width:"10"},(0,Pt.u)("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function Yt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",n=document.createElement("div");return n.style.height="".concat(Mt,"px"),n.className=Wt,null!=e&&(n.style.opacity=e.toString()),Ot.append(n,Ut.bind(null,t)),n}function jt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",r=arguments.length>3?arguments[3]:void 0;e.infos.forEach((function(e,i){if(r&&2===i)e.preview=Yt(t,n);else{var a=(0,A.F2)(e.size)+("horizontal"===n?Bt:Nt),l="div"===e.preview.tagName.toLowerCase(),s=l?e.preview:document.createElement("div");s.className=Wt,"horizontal"===n?s.style.width="".concat(a,"px"):s.style.height="".concat(a,"px"),l||s.appendChild(e.preview),e.preview=s}}))}function qt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"classic",n=e.infos;return"classic"===t?((0,A.F2)(n[0].size)+Nt)/2:((0,A.F2)(n[0].size)-(0,A.F2)(n[n.length-1].size))/2}function Jt(e,t){if(!e)return null;var n=e.infos.map((function(e){return e.color})),r=(0,G.jT)("full"===t.type?n:"above"===t.type?n.slice(0,3):n.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList});return r.className=Ht,null!=t.opacity&&(r.style.opacity=t.opacity.toString()),r}function Gt(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",i=0,a=e.infos,l=Math.floor(a.length/2),s="full"===t||"above"===t?0:l,o="full"===t||"below"===t?a.length-1:l,u=s;u<=o;u++)i+=n&&u===l?"horizontal"===r?10:Mt:(0,A.F2)(a[u].size)+("horizontal"===r?Bt:Nt);return Math.round(i)}function Qt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",i=Gt(e,t,n,r),a=e.infos,l=Math.floor(a.length/2),s="full"===t||"above"===t?0:l,o="full"===t||"below"===t?a.length-1:l,u="full"===t?a[s].size+a[o].size:"above"===t?a[s].size:a[o].size,c=n?"vertical"===r?Mt:10:0,d="vertical"===r?Nt*("full"===t?2:1):Bt*("full"===t?2:1);return Math.round(i-((0,A.F2)(u)/2+c/2+d/2))}function $t(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",a=e.infos,l=a.find((function(e){return"size-ramp"===e.type})),s=a.find((function(e){return"color-ramp"===e.type}));return l&&((l=(0,h.Z)({},l)).infos=(0,I.Z)(l.infos),jt(l,t,i,!0)),s&&((s=(0,h.Z)({},s)).infos=(0,I.Z)(s.infos)),"horizontal"===i&&(null!==(n=l)&&void 0!==n&&n.infos.reverse(),null!==(r=s)&&void 0!==r&&r.infos.reverse()),{sizeRampElement:l,colorRampElement:s}}function Xt(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",i=e.infos,a=i.find((function(e){return"size-ramp"===e.type})),l=i.find((function(e){return"color-ramp"===e.type}));return a&&((a=(0,h.Z)({},a)).infos=(0,I.Z)(a.infos),jt(a,null,r,!1)),l&&((l=(0,h.Z)({},l)).infos=(0,I.Z)(l.infos)),"horizontal"===r&&(null!==(t=a)&&void 0!==t&&t.infos.reverse(),null!==(n=l)&&void 0!==n&&n.infos.reverse()),{sizeRampElement:a,colorRampElement:l}}var Kt=n(8704);function en(e){e.appendChild(this)}function tn(e,t,n){if(t){if("string"==typeof t||"number"==typeof t)return t;if("value"in t||"unit"in t)return(0,Kt.n)(e.dotValue,t);if("colorName"in t&&"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;var r=null;return function(e,t){return t}(0,n)?r=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:nn(t,n)&&(r=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),r?(0,Kt.n)("showField"===r?"{field}":e[r],{field:t.field,normField:t.normField}):null}}function nn(e,t){return!t}function rn(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}var an,ln=n(96919),sn=n(78088),on=n(80532);!function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side"}(an||(an={}));var un=window.devicePixelRatio;var cn=function(e){(0,y.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var i;return(0,l.Z)(this,n),(i=t.call(this,e,r))._handles=new m.Z,i._hasIndicators=!1,i._selectedSectionName=null,i._sectionNames=[],i._sectionMap=new Map,i.activeLayerInfos=null,i.headingLevel=3,i.layout=an.Stack,i.messages=null,i.messagesCommon=null,i.type="card",i.view=null,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles((0,b.YP)((function(){return e.activeLayerInfos}),(function(t){e._handles.removeAll(),e._watchForSectionChanges(t)})))}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null}},{key:"render",value:function(){var e=this;this._hasIndicators=this.layout===an.Auto&&this.view.container.clientWidth<=768||this.layout===an.Stack;var t=this.activeLayerInfos,n=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;var r=this._sectionNames.length,i=this._sectionNames.map((function(t,n){var i=(0,Kt.n)(e.messagesCommon.pagination.pageText,{index:n+1,total:r});return(0,Pt.u)("div",{key:t,role:"tab",id:t,"aria-label":i,"aria-controls":"".concat(t,"-panel"),"aria-selected":(e._selectedSectionName===t).toString(),tabIndex:e._selectedSectionName===t?0:-1,title:i,onclick:e._selectSection,onkeydown:e._focusSection,bind:e,class:e.classes(Tt.indicator,(0,Rt.Z)({},Tt.activated,e._selectedSectionName===t)),"data-section-name":t})})),a=this._hasIndicators&&r>1?(0,Pt.u)("div",{class:Tt.indicatorContainer,key:"carousel-navigation",role:"tablist"},i):null,l=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):n&&n.length?n:null,s=(0,Rt.Z)({},Tt.stacked,this._hasIndicators);return(0,Pt.u)("div",{class:this.classes(Tt.base,s)},l||(0,Pt.u)("div",{class:Tt.message},this.messages.noLegend),a)}},{key:"_selectSection",value:function(e){var t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}},{key:"_focusSection",value:function(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}},{key:"_switchSectionOnArrowPress",value:function(e){var t=e.key,n="ArrowLeft"===t?-1:1,r=e.target.getAttribute("data-section-name"),i=this._sectionNames.indexOf(r),a=this._sectionNames,l=null;-1!==i&&(a[i+n]?l=document.getElementById(a[i+n]):"ArrowLeft"===t?l=document.getElementById(a[a.length-1]):"ArrowRight"===t&&(l=document.getElementById(a[0])),l&&l.focus())}},{key:"_watchForSectionChanges",value:function(e){var t=this;if(this._generateSectionNames(),e){e.forEach((function(e){var n="activeLayerInfo-".concat(e.layer.uid,"-version-change");t._handles.remove(n),t._watchForSectionChanges(e.children),t._handles.add((0,b.YP)((function(){return e.version}),(function(){return t._generateSectionNames()})),n)}));var n="activeLayerInfos-collection-change";this._handles.remove(n),this._handles.add(e.on("change",(function(){return t._watchForSectionChanges(e)})),n)}}},{key:"_generateSectionNames",value:function(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}},{key:"_getSectionName",value:function(e,t,n){return"".concat(this.id).concat(e.uid,"-type-").concat(t.type,"-").concat(n)}},{key:"_generateSectionNamesForActiveLayerInfo",value:function(e){var t=this;e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((function(n,r){t._sectionNames.push(t._getSectionName(e.layer,n,r))}))}},{key:"_renderLegendForLayer",value:function(e){var t=this;if(!e.ready)return null;if(e.children.length){var n=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return(0,Pt.u)("div",{key:e.layer.uid,class:this.classes(Tt.service,Tt.groupLayer)},(0,Pt.u)("div",{class:Tt.serviceCaptionContainer},e.title),n)}var r=e.legendElements;if(r&&!r.length)return null;var i=r.some((function(e){return"relationship-ramp"===e.type})),a=r.map((function(n,r){return t._renderLegendForElement(n,e,r,i)})).filter((function(e){return!!e}));if(!a.length)return null;var l=(0,Rt.Z)({},Tt.groupLayerChild,!!e.parent);return(0,Pt.u)("div",{key:e.layer.uid,class:this.classes(Tt.service,l)},(0,Pt.u)("div",{class:Tt.serviceCaptionContainer},(0,Pt.u)("div",{class:Tt.serviceCaptionText},e.title)),(0,Pt.u)("div",{class:Tt.serviceContent},a))}},{key:"_renderLegendForElement",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l="color-ramp"===e.type,s="opacity-ramp"===e.type,o="size-ramp"===e.type,u=t.layer,c=null;if("string"==typeof e.title)c=e.title;else if(e.title){var d=e.title,f=tn(this.messages,d,l||s);c=d.title?"".concat(d.title," (").concat(f,")"):f}var h=this._getSectionName(u,e,n),y=this._hasIndicators&&!a?(0,Pt.u)("div",null,(0,Pt.u)(ln.X6,{level:this.headingLevel,class:Tt.carouselTitle},t.title),(0,Pt.u)(ln.X6,{level:(0,ln.MJ)(this.headingLevel),class:Tt.layerCaption},c)):c?(0,Pt.u)(ln.X6,{level:this.headingLevel,class:Tt.layerCaption},c):null,p=t.effectList,v=null;if("symbol-table"===e.type){var m=e.infos.map((function(n,i){return r._renderLegendForElementInfo(n,t,e.legendType,i)})).filter((function(e){return!!e}));if(m.length){var g,b=m[0].properties.classes&&m[0].properties.classes[Tt.symbolRow],_=(g={},(0,Rt.Z)(g,Tt.labelContainer,!b&&!i),(0,Rt.Z)(g,Tt.relationshipLabelContainer,i),g);v=(0,Pt.u)("div",{class:this.classes(_)},m)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?v=this._renderLegendForRamp(e,u.opacity,p):o?v=this._renderSizeRamp(e,u.opacity):"pie-chart-ramp"===e.type?v=this._renderPieChartRamp(e):"relationship-ramp"===e.type?v=(0,At.g)(e,this.id,u.opacity,p):"univariate-above-and-below-ramp"===e.type?v=this._renderUnivariateAboveAndBelowRamp(e,u.opacity,p):"univariate-color-size-ramp"===e.type&&(v=this._renderUnivariateColorSizeRamp(e,u.opacity,p));if(!v)return null;var w=(0,Pt.u)("div",{key:h,class:Tt.section,id:"".concat(h,"-panel"),role:"tabpanel","aria-labelledby":h,tabIndex:0},[y,v]);return a||this._sectionMap.set(h,w),w}},{key:"_renderPieChartRamp",value:function(e){return(0,Pt.u)("div",{class:Tt.pieChartRampPreview,bind:e.preview,afterCreate:en})}},{key:"_renderUnivariateAboveAndBelowRamp",value:function(e,t,n){var r=$t(e,t,"horizontal"),i=r.sizeRampElement,a=r.colorRampElement;if(!i)return null;var l=Gt(i,"full",!0,"horizontal"),s=Qt(i,"above",!0,"horizontal"),o=Qt(i,"below",!0,"horizontal"),u=Jt(a,{width:s,height:12,rampAlignment:"horizontal",opacity:t,type:"above",effectList:n}),c=Jt(a,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"below",effectList:n}),d=qt(i,"card"),f=i.infos.map((function(e){return e.label})),h=f.length-1,y=f.map((function(e,t){return 0===t||t===h?(0,Pt.u)("div",{key:t},e):null})),p={marginTop:"3px",display:"flex"};(0,ie.dZ)(this.container)?p.marginRight="".concat(d,"px"):p.marginLeft="".concat(d,"px");var v={width:"".concat(l,"px"),display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,Pt.u)("div",{class:Tt.layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,Pt.u)("div",{class:this.classes(Tt.symbolContainer,Tt.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},i.infos.map((function(e,t){return(0,Pt.u)("div",{key:t,class:Tt.symbol,bind:e.preview,afterCreate:en})}))),u?(0,Pt.u)("div",{class:Tt.univariateAboveAndBelowColorRamp,styles:p,key:"color-ramp-preview"},(0,Pt.u)("div",{bind:u,afterCreate:en}),(0,Pt.u)("div",{bind:c,afterCreate:en})):null,(0,Pt.u)("div",{class:Tt.layerInfo},(0,Pt.u)("div",{class:Tt.rampLabelsContainer,styles:v},y)))}},{key:"_renderUnivariateColorSizeRamp",value:function(e,t,n){var r=Xt(e,"horizontal"),i=r.sizeRampElement,a=r.colorRampElement;if(!i)return null;var l=Gt(i,"full",!1,"horizontal"),s=Jt(a,{width:Qt(i,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:n}),o=qt(i,"card"),u=i.infos.length-1,c=i.infos.map((function(e,t){return 0===t||t===u?(0,Pt.u)("div",{key:t},e.label):null})),d={marginTop:"3px",display:"flex"};(0,ie.dZ)(this.container)?d.marginRight="".concat(o,"px"):d.marginLeft="".concat(o,"px");var f={width:"".concat(l,"px"),display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,Pt.u)("div",{class:Tt.layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,Pt.u)("div",{class:this.classes(Tt.symbolContainer,Tt.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},i.infos.map((function(e,t){return(0,Pt.u)("div",{key:t,class:Tt.symbol,bind:e.preview,afterCreate:en})}))),(0,Pt.u)("div",{class:Tt.univariateAboveAndBelowColorRamp,styles:d,key:"color-ramp-preview"},(0,Pt.u)("div",{bind:s,afterCreate:en})),(0,Pt.u)("div",{class:Tt.layerInfo},(0,Pt.u)("div",{class:Tt.rampLabelsContainer,styles:f},c)))}},{key:"_renderLegendForElementInfo",value:function(e,t,n,r){var i=t.layer;if(e.type)return this._renderLegendForElement(e,t,r,!1,!0);var a=rn(i,n);if(e.preview){var l,s;if(!e.symbol||!e.symbol.type.includes("simple-fill")){if(!e.label)return(0,Pt.u)("div",{key:r,bind:e.preview,afterCreate:en});var o=(0,Rt.Z)({},Tt.symbolCell,this._hasIndicators);return(0,Pt.u)("div",{key:r,class:this.classes(Tt.layerRow,(0,Rt.Z)({},Tt.symbolRow,this._hasIndicators))},(0,Pt.u)("div",{class:this.classes(o),bind:e.preview,afterCreate:en}),(0,Pt.u)("div",{class:this.classes(Tt.imageLabel,(0,Rt.Z)({},Tt.labelCell,this._hasIndicators))},tn(this.messages,e.label,!1)||""))}var u=255,c=255,d=255,f=0,h=255,y=255,p=255,v=0,m=e.symbol.color&&e.symbol.color.a,g=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;m&&(u=e.symbol.color.r,c=e.symbol.color.g,d=e.symbol.color.b,f=e.symbol.color.a*i.opacity),g&&(h=e.symbol.outline.color.r,y=e.symbol.outline.color.g,p=e.symbol.outline.color.b,v=e.symbol.outline.color.a*i.opacity);var b=null===(l=null===(s=e.symbol.color)||void 0===s?void 0:s.isBright)||void 0===l||l,_=b?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",w={background:m?"rgba(".concat(u,", ").concat(c,", ").concat(d,", ").concat(f,")"):"none",color:b?"black":"white",textShadow:"-1px -1px 0 ".concat(_,",\n                                              1px -1px 0 ").concat(_,",\n                                              -1px 1px 0 ").concat(_,",\n                                              1px 1px 0 ").concat(_),border:g?"1px solid rgba(".concat(h,", ").concat(y,", ").concat(p,", ").concat(v,")"):"none",filter:(0,Q.wJ)(t.effectList)};return(0,Pt.u)("div",{key:r,class:Tt.layerRow},(0,Pt.u)("div",{class:Tt.labelElement,styles:w}," ",e.label," "))}if(e.src){var L=this._renderImage(e,i,a);return(0,Pt.u)("div",{key:r,class:Tt.layerRow},L,(0,Pt.u)("div",{class:Tt.imageLabel},e.label||""))}}},{key:"_renderImage",value:function(e,t,n){var r,i=e.label,a=e.src,l=e.opacity,s=(r={},(0,Rt.Z)(r,Tt.imageryLayerStretchedImage,n),(0,Rt.Z)(r,Tt.symbol,!n),r),o={opacity:"".concat(null!=l?l:t.opacity)};return(0,Pt.u)("img",{alt:tn(this.messages,i,!1),src:a,border:0,width:e.width,height:e.height,class:this.classes(s),styles:o})}},{key:"_renderSizeRampLines",value:function(e){var t=e.infos,n=t[0],r=t[t.length-1],i=n.symbol,a=this._hasIndicators,l=(0,A.F2)(n.size+n.outlineSize)*un,s=(0,A.F2)(r.size+r.outlineSize)*un,o=a?l:l+50*un,u=a?l/2+50*un:l,c=function(e){if(e){if(e.type.includes("3d")){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var n=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return"triangle"===n||"cone"===n||"tetrahedron"===n}return"triangle"===e.style}}(i),d=function(e){if(e){if(e.type.includes("3d")){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var n=e.symbolLayers.getItemAt(t-1),r=n.resource&&n.resource.primitive;return"circle"===r||"cross"===r||"kite"===r||"sphere"===r||"cube"===r||"diamond"===r}var i=e.style;return"circle"===i||"diamond"===i||"cross"===i}}(i),f=document.createElement("canvas");f.width=o,f.height=u,f.style.width=f.width/un+"px",f.style.height=f.height/un+"px";var h=f.getContext("2d");if(a){h.beginPath();var y=o/2-s/2,p=u;h.moveTo(0,0),h.lineTo(y,p);var v=o,m=o/2+s/2,g=u;h.moveTo(v,0),h.lineTo(m,g)}else{h.beginPath();var b=u/2-s/2,_=o;h.moveTo(0,b),h.lineTo(_,0);var w=u/2+s/2,L=o,k=u;h.moveTo(0,w),h.lineTo(L,k)}return h.strokeStyle="#ddd",h.stroke(),(0,Pt.u)("div",{bind:f,afterCreate:en,styles:a?{display:"flex",marginTop:"-".concat(c?0:d?l/2:0,"px"),marginBottom:"-".concat(c?s:d?s/2:0,"px")}:{display:"flex",marginRight:"-".concat(c?0:d?l/2:0,"px"),marginLeft:"-".concat(c?0:d?s/2:0,"px")}})}},{key:"_renderSizeRamp",value:function(e,t){var n=e.infos,r=n[0].label,i=n[n.length-1].label,a=n[0].preview,l=n[n.length-1].preview,s=this._hasIndicators,o={"flex-direction":s?"column":"row-reverse"};a&&((a=a.cloneNode(!0)).style.display="flex"),l&&((l=l.cloneNode(!0)).style.display="flex");var u={opacity:null!=t?"".concat(t):""};return(0,Pt.u)("div",{class:this.classes(Tt.layerRow,(0,Rt.Z)({},Tt.sizeRampRow,s))},(0,Pt.u)("div",{class:Tt.rampLabel},s?r:i),(0,Pt.u)("div",{class:Tt.sizeRampContainer,styles:o},(0,Pt.u)("div",{bind:a,afterCreate:en,class:Tt.sizeRampPreview,styles:u}),this._renderSizeRampLines(e),(0,Pt.u)("div",{bind:l,afterCreate:en,class:Tt.sizeRampContainer,styles:u})),(0,Pt.u)("div",{class:Tt.rampLabel},s?i:r))}},{key:"_renderLegendForRamp",value:function(e,t,n){var r=e.infos,i="heatmap-ramp"===e.type,a=r.length-1,l=25,s=a>2&&!i?25*a:100,o=s+20,u=10,c=r.slice(0).reverse();c.forEach((function(e,t){e.offset=i?e.ratio:t/a}));var d=c.length-1,f=c.length%2!=0&&c[c.length/2|0],h=f&&(0,Pt.u)("div",{class:Tt.intervalSeparatorsContainer},(0,Pt.u)("div",{class:Tt.intervalSeparator},"|"),(0,Pt.u)("div",{class:Tt.rampLabel},f.label)),y=r[r.length-1].label,p=r[0].label,v=[[{shape:{type:"path",path:"M0 ".concat(l/2," L").concat(u," 0 L").concat(u," ").concat(l," Z")},fill:c[0].color,stroke:{width:0}},{shape:{type:"rect",x:u,y:0,width:s,height:l},fill:{type:"linear",x1:u,y1:0,x2:s+u,y2:0,colors:c},stroke:{width:0}},{shape:{type:"path",path:"M".concat(s+u," 0 L").concat(o," ").concat(l/2," L").concat(s+u," ").concat(l," Z")},fill:c[d].color,stroke:{width:0}}]],m=(0,Vt.KB)(v,o,l),g=this.messages,b={filter:(0,Q.wJ)(n),opacity:null==t?null:"".concat(t)};return(0,Pt.u)("div",{class:Tt.layerRow,styles:{justifyContent:"center"}},(0,Pt.u)("div",{class:Tt.rampLabel},i?g[y]:y),(0,Pt.u)("div",{class:Tt.symbolContainer},(0,Pt.u)("div",{styles:b},m),h),(0,Pt.u)("div",{class:Tt.rampLabel},i?g[p]:p))}}]),n}(k.Z);(0,v._)([(0,_.Cb)()],cn.prototype,"activeLayerInfos",void 0),(0,v._)([(0,_.Cb)()],cn.prototype,"headingLevel",void 0),(0,v._)([(0,_.Cb)()],cn.prototype,"layout",void 0),(0,v._)([(0,_.Cb)(),(0,on.H)("esri/widgets/Legend/t9n/Legend")],cn.prototype,"messages",void 0),(0,v._)([(0,_.Cb)(),(0,on.H)("esri/t9n/common")],cn.prototype,"messagesCommon",void 0),(0,v._)([(0,_.Cb)({readOnly:!0})],cn.prototype,"type",void 0),(0,v._)([(0,_.Cb)()],cn.prototype,"view",void 0),(0,v._)([(0,sn.h)()],cn.prototype,"_selectSection",null);var dn=cn=(0,v._)([(0,L.j)("esri.widgets.Legend.styles.Card")],cn),fn="esri-legend",hn={service:"".concat(fn,"__service"),label:"".concat(fn,"__service-label"),layer:"".concat(fn,"__layer"),groupLayer:"".concat(fn,"__group-layer"),groupLayerChild:"".concat(fn,"__group-layer-child"),layerTable:"".concat(fn,"__layer-table"),layerTableSizeRamp:"".concat(fn,"__layer-table--size-ramp"),layerChildTable:"".concat(fn,"__layer-child-table"),layerCaption:"".concat(fn,"__layer-caption"),layerBody:"".concat(fn,"__layer-body"),layerRow:"".concat(fn,"__layer-row"),layerCell:"".concat(fn,"__layer-cell"),layerInfo:"".concat(fn,"__layer-cell ").concat(fn,"__layer-cell--info"),imageryLayerStretchedImage:"".concat(fn,"__imagery-layer-image--stretched"),imageryLayerCellStretched:"".concat(fn,"__imagery-layer-cell--stretched"),imageryLayerInfoStretched:"".concat(fn,"__imagery-layer-info--stretched"),symbolContainer:"".concat(fn,"__layer-cell esri-legend__layer-cell--symbols"),symbol:"".concat(fn,"__symbol"),rampContainer:"".concat(fn,"__ramps"),sizeRamp:"".concat(fn,"__size-ramp"),colorRamp:"".concat(fn,"__color-ramp"),opacityRamp:"".concat(fn,"__opacity-ramp"),borderlessRamp:"".concat(fn,"__borderless-ramp"),rampTick:"".concat(fn,"__ramp-tick"),rampFirstTick:"".concat(fn,"__ramp-tick-first"),rampLastTick:"".concat(fn,"__ramp-tick-last"),rampLabelsContainer:"".concat(fn,"__ramp-labels"),rampLabel:"".concat(fn,"__ramp-label"),univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"".concat(fn,"__message"),header:"esri-widget__heading",hidden:"esri-hidden"},yn="".concat(fn,"__"),pn={display:"flex",alignItems:"flex-start"},vn={marginLeft:"3px"},mn={display:"table-cell",verticalAlign:"middle"},gn=function(e){(0,y.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var i;return(0,l.Z)(this,n),(i=t.call(this,e,r)).activeLayerInfos=null,i.headingLevel=3,i.messages=null,i.type="classic",i}return(0,s.Z)(n,[{key:"render",value:function(){var e=this,t=this.activeLayerInfos,n=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));return(0,Pt.u)("div",null,n&&n.length?n:(0,Pt.u)("div",{class:hn.message},this.messages.noLegend))}},{key:"_renderLegendForLayer",value:function(e){var t=this;if(!e.ready)return null;var n=!!e.children.length,r="".concat(yn).concat(e.layer.uid,"-version-").concat(e.version),i=e.title?(0,ln.X6)({level:this.headingLevel,class:this.classes(hn.header,hn.label)},e.title):null;if(n){var a=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return(0,Pt.u)("div",{key:r,class:this.classes(hn.service,hn.groupLayer)},i,a)}var l=e.legendElements;if(l&&!l.length)return null;var s=l.map((function(n){return t._renderLegendForElement(n,e.layer,e.effectList)})).filter((function(e){return!!e}));if(!s.length)return null;var o=(0,Rt.Z)({},hn.groupLayerChild,!!e.parent);return(0,Pt.u)("div",{key:r,class:this.classes(hn.service,o),tabIndex:0},i,(0,Pt.u)("div",{class:hn.layer},s))}},{key:"_renderLegendForElement",value:function(e,t,n,r){var i=this,a="color-ramp"===e.type,l="opacity-ramp"===e.type,s="size-ramp"===e.type,o=null;if("symbol-table"===e.type||s){var u=e.infos.map((function(r){return i._renderLegendForElementInfo(r,t,n,s,e.legendType)})).filter((function(e){return!!e}));u.length&&(o=(0,Pt.u)("div",{class:hn.layerBody},u))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?o=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?o=(0,At.g)(e,this.id,t.opacity,n):"pie-chart-ramp"===e.type?o=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?o=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,n):"univariate-color-size-ramp"===e.type&&(o=this._renderUnivariateColorSizeRamp(e,t.opacity,n));if(!o)return null;var c=e.title,d=null;if("string"==typeof c)d=c;else if(c){var f=tn(this.messages,c,a||l);d=nn(0,a||l)&&c.title?"".concat(c.title," (").concat(f,")"):f}var h=r?hn.layerChildTable:hn.layerTable,y=d?(0,Pt.u)("div",{class:hn.layerCaption},d):null,p=(0,Rt.Z)({},hn.layerTableSizeRamp,s||!r);return(0,Pt.u)("div",{class:this.classes(h,p)},y,o)}},{key:"_renderPieChartRamp",value:function(e){return(0,Pt.u)("div",{bind:e.preview,afterCreate:en})}},{key:"_renderUnivariateAboveAndBelowRamp",value:function(e,t,n){var r=this,i=$t(e,t),a=i.sizeRampElement,l=i.colorRampElement;if(!a)return null;var s=Qt(a,"above",!0),o=Qt(a,"below",!0),u=Jt(l,{width:12,height:s,rampAlignment:"vertical",opacity:t,type:"above",effectList:n}),c=Jt(l,{width:12,height:o,rampAlignment:"vertical",opacity:t,type:"below",effectList:n}),d=qt(a),f=a.infos.map((function(e){return e.label})),h=f.map((function(e,t){var n=2===t;return 0===t?(0,Pt.u)("div",{key:t,class:e?u?hn.univariateAboveAndBelowLabel:hn.rampLabel:null},e):n?(0,Pt.u)("div",null):null})),y=f.length-1,p=Math.floor(f.length/2),v=f.map((function(e,t){return t===p||t===y?(0,Pt.u)("div",{key:t,class:e?u?hn.univariateAboveAndBelowLabel:hn.rampLabel:null},e):null})),m={display:"table-cell",verticalAlign:"middle"},g={marginTop:"".concat(d,"px")},b={height:"".concat(s,"px")},_={height:"".concat(o,"px")};return(0,Pt.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:pn},(0,Pt.u)("div",{class:hn.layerBody},a.infos.map((function(e,t){return(0,Pt.u)("div",{class:r.classes(hn.layerRow,hn.sizeRamp)},(0,Pt.u)("div",{class:hn.symbol,styles:m,bind:e.preview,afterCreate:en}),u||t%2!=0?null:(0,Pt.u)("div",{class:hn.layerInfo},f[t]))}))),u?(0,Pt.u)("div",{styles:g,key:"color-ramp-preview"},(0,Pt.u)("div",{styles:vn},(0,Pt.u)("div",{styles:mn},(0,Pt.u)("div",{class:hn.rampContainer,bind:u,afterCreate:en})),(0,Pt.u)("div",{styles:mn},(0,Pt.u)("div",{class:hn.rampLabelsContainer,styles:b},h))),(0,Pt.u)("div",{styles:vn},(0,Pt.u)("div",{styles:mn},(0,Pt.u)("div",{class:hn.rampContainer,bind:c,afterCreate:en})),(0,Pt.u)("div",{styles:mn},(0,Pt.u)("div",{class:hn.rampLabelsContainer,styles:_},v)))):null)}},{key:"_renderUnivariateColorSizeRamp",value:function(e,t,n){var r=this,i=Xt(e),a=i.sizeRampElement,l=i.colorRampElement;if(!a)return null;var s=qt(a),o=Qt(a,"full",!1),u=Jt(l,{width:12,height:o,rampAlignment:"vertical",opacity:t,type:"full",effectList:n}),c=a.infos.length-1,d=a.infos.map((function(e,t){return 0===t||t===c?(0,Pt.u)("div",{key:t,class:e.label?l?hn.univariateAboveAndBelowLabel:hn.rampLabel:null},e.label):null})),f={display:"table-cell",verticalAlign:"middle"},h={marginTop:"".concat(s,"px")},y={height:"".concat(o,"px")};return(0,Pt.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:pn},(0,Pt.u)("div",{class:hn.layerBody},a.infos.map((function(e){return(0,Pt.u)("div",{class:r.classes(hn.layerRow,hn.sizeRamp)},(0,Pt.u)("div",{class:hn.symbol,styles:f,bind:e.preview,afterCreate:en}))}))),(0,Pt.u)("div",{styles:h,key:"color-ramp-preview"},(0,Pt.u)("div",{styles:vn},(0,Pt.u)("div",{styles:mn},(0,Pt.u)("div",{class:hn.rampContainer,bind:u,afterCreate:en})),(0,Pt.u)("div",{styles:mn},(0,Pt.u)("div",{class:hn.rampLabelsContainer,styles:y},d)))))}},{key:"_renderLegendForRamp",value:function(e,t){var n=this,r=e.infos,i="opacity-ramp"===e.type,a="heatmap-ramp"===e.type,l="stretch-ramp"===e.type,s=e.preview,o=i?hn.opacityRamp:"";s.className="".concat(hn.colorRamp," ").concat(o),null!=t&&(s.style.opacity=t.toString());var u=r.map((function(e){return(0,Pt.u)("div",{class:e.label?hn.rampLabel:null},a?n.messages[e.label]||e.label:l?n._getStretchStopLabel(e):e.label)})),c={width:"".concat(24,"px")},d={height:s.style.height};return(0,Pt.u)("div",{class:hn.layerRow},(0,Pt.u)("div",{class:hn.symbolContainer,styles:c},(0,Pt.u)("div",{class:hn.rampContainer,bind:s,afterCreate:en})),(0,Pt.u)("div",{class:hn.layerInfo},(0,Pt.u)("div",{class:hn.rampLabelsContainer,styles:d},u)))}},{key:"_getStretchStopLabel",value:function(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:(0,Re.uf)(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}},{key:"_renderLegendForElementInfo",value:function(e,t,n,r,i){var a;if(e.type)return this._renderLegendForElement(e,t,n,!0);var l=null,s=rn(t,i);if(e.preview?l=(0,Pt.u)("div",{class:hn.symbol,bind:e.preview,afterCreate:en}):e.src&&(l=this._renderImage(e,t,s)),!l)return null;var o=(0,Rt.Z)({},hn.imageryLayerInfoStretched,s),u=(a={},(0,Rt.Z)(a,hn.imageryLayerInfoStretched,s),(0,Rt.Z)(a,hn.sizeRamp,!s&&r),a);return(0,Pt.u)("div",{class:hn.layerRow},(0,Pt.u)("div",{class:this.classes(hn.symbolContainer,u)},l),(0,Pt.u)("div",{class:this.classes(hn.layerInfo,o)},tn(this.messages,e.label,!1)||""))}},{key:"_renderImage",value:function(e,t,n){var r,i=e.label,a=e.src,l=e.opacity,s=(r={},(0,Rt.Z)(r,hn.imageryLayerStretchedImage,n),(0,Rt.Z)(r,hn.symbol,!n),r),o={opacity:"".concat(null!=l?l:t.opacity)};return(0,Pt.u)("img",{alt:tn(this.messages,i,!1),src:a,border:0,width:e.width,height:e.height,class:this.classes(s),styles:o})}}]),n}(k.Z);(0,v._)([(0,_.Cb)()],gn.prototype,"activeLayerInfos",void 0),(0,v._)([(0,_.Cb)()],gn.prototype,"headingLevel",void 0),(0,v._)([(0,_.Cb)(),(0,on.H)("esri/widgets/Legend/t9n/Legend")],gn.prototype,"messages",void 0),(0,v._)([(0,_.Cb)({readOnly:!0})],gn.prototype,"type",void 0);var bn=gn=(0,v._)([(0,L.j)("esri.widgets.Legend.styles.Classic")],gn),_n="esri-legend",wn="esri-widget",Ln="esri-widget--panel",kn="esri-icon-layer-list",xn=function(e){(0,y.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var i;return(0,l.Z)(this,n),(i=t.call(this,e,r))._handles=new m.Z,i.headingLevel=3,i.iconClass=kn,i.messages=null,i.style=new bn,i.viewModel=new Et,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles([(0,b.on)((function(){return e.view}),"resize",(function(){return e.scheduleRender()})),(0,b.on)((function(){return e.activeLayerInfos}),"change",(function(){return e._refreshActiveLayerInfos(e.activeLayerInfos)})),(0,b.YP)((function(){return e.headingLevel}),(function(t){var n=e.style;n&&(n.headingLevel=t)})),(0,b.YP)((function(){return e.style}),(function(t,n){n&&t!==n&&n.destroy(),t&&(t.activeLayerInfos=e.activeLayerInfos,"card"===t.type&&(t.view=e.view),t.headingLevel=e.headingLevel)}),b.nn)])}},{key:"destroy",value:function(){this._handles=(0,g.SC)(this._handles)}},{key:"activeLayerInfos",get:function(){return this.viewModel.activeLayerInfos},set:function(e){this.viewModel.activeLayerInfos=e}},{key:"basemapLegendVisible",get:function(){return this.viewModel.basemapLegendVisible},set:function(e){this.viewModel.basemapLegendVisible=e}},{key:"groundLegendVisible",get:function(){return this.viewModel.groundLegendVisible},set:function(e){this.viewModel.groundLegendVisible=e}},{key:"hideLayersNotInCurrentView",get:function(){return this.viewModel.hideLayersNotInCurrentView},set:function(e){this.viewModel.hideLayersNotInCurrentView=e}},{key:"keepCacheOnDestroy",get:function(){return this.viewModel.keepCacheOnDestroy},set:function(e){this.viewModel.keepCacheOnDestroy=e}},{key:"respectLayerVisibility",get:function(){return this.viewModel.respectLayerVisibility},set:function(e){this.viewModel.respectLayerVisibility=e}},{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"layerInfos",get:function(){return this.viewModel.layerInfos},set:function(e){this.viewModel.layerInfos=e}},{key:"castStyle",value:function(e){if(e instanceof dn||e instanceof bn)return e;if("string"==typeof e)return"card"===e?new dn:new bn;if(e&&"string"==typeof e.type){var t=(0,h.Z)({},e);return delete t.type,new("card"===e.type?dn:bn)(t)}return new bn}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"render",value:function(){return(0,Pt.u)("div",{class:this.classes(_n,wn,this.style instanceof bn?Ln:null)},this.style.render())}},{key:"_refreshActiveLayerInfos",value:function(e){var t=this;this._handles.removeAll(),e.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)})),this.scheduleRender()}},{key:"_renderOnActiveLayerInfoChange",value:function(e){var t=this,n=(0,b.YP)((function(){return e.version}),(function(){return t.scheduleRender()}));this._handles.add(n,"version_".concat(e.layer.uid));var r=(0,b.on)((function(){return e.children}),"change",(function(){return e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))}),b.nn);this._handles.add(r,"children_".concat(e.layer.uid)),e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))}}]),n}(k.Z);(0,v._)([(0,_.Cb)()],xn.prototype,"activeLayerInfos",null),(0,v._)([(0,_.Cb)()],xn.prototype,"basemapLegendVisible",null),(0,v._)([(0,_.Cb)()],xn.prototype,"groundLegendVisible",null),(0,v._)([(0,_.Cb)()],xn.prototype,"headingLevel",void 0),(0,v._)([(0,_.Cb)()],xn.prototype,"hideLayersNotInCurrentView",null),(0,v._)([(0,_.Cb)()],xn.prototype,"keepCacheOnDestroy",null),(0,v._)([(0,_.Cb)()],xn.prototype,"respectLayerVisibility",null),(0,v._)([(0,_.Cb)()],xn.prototype,"iconClass",void 0),(0,v._)([(0,_.Cb)()],xn.prototype,"label",null),(0,v._)([(0,_.Cb)()],xn.prototype,"layerInfos",null),(0,v._)([(0,_.Cb)(),(0,on.H)("esri/widgets/Legend/t9n/Legend")],xn.prototype,"messages",void 0),(0,v._)([(0,_.Cb)()],xn.prototype,"style",void 0),(0,v._)([(0,w.p)("style")],xn.prototype,"castStyle",null),(0,v._)([(0,_.Cb)()],xn.prototype,"view",null),(0,v._)([(0,_.Cb)()],xn.prototype,"viewModel",void 0);var Cn=xn=(0,v._)([(0,L.j)("esri.widgets.Legend")],xn),Sn=n(87718),In=(n(7597),n(95101),function(){function e(t){(0,l.Z)(this,e),(0,o.r)(this,t),this.arcgisHubWidgetPanelToggled=(0,o.c)(this,"arcgisHubWidgetPanelToggled",7),this.hubTelemetry=(0,o.c)(this,"hubTelemetry",7),this.scale="m",this.bottomOffset=0,this.topOffset=0,this.closed=!0,(0,u.b)(this,"toggleClosed","setPanelHeight","handleSetPanelRef","handleSetWidgetRef")}return(0,s.Z)(e,[{key:"componentWillLoad",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.el,n=t&&t.closest("arcgis-hub-map-widget-container"),this.viewPosition=null===n||void 0===n?void 0:n.viewPosition,e.next=5,c.i.loadIntlForComponent(t);case 5:this.intl=e.sent;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidLoad",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.view&&this.addWidget(),(0,Sn.l)();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addWidgetToView",value:function(e,t){e&&e!==t&&this.addWidget()}},{key:"updateViewHeightWhenOpen",value:function(){var e=this.closed;this.active=!e,this.active&&this.setPanelHeight()}},{key:"emitEventOnActiveChange",value:function(e){var t=e?d.d.dictionary.category.interaction.action.open.label.panel.details.legend:d.d.dictionary.category.interaction.action.close.label.panel.details.legend;this.hubTelemetry.emit(t)}},{key:"handleCalcitePanelDismissedChange",value:function(e){e.stopPropagation();var t=e.target.closed;this.arcgisHubWidgetPanelToggled.emit(t)}},{key:"handlePanelToggled",value:function(e){var t=e.target,n=e.detail;t===this.el?this.closed=n:n||(this.closed=!0)}},{key:"handleSetPanelRef",value:function(e){e&&(this.panelEl=e)}},{key:"handleSetWidgetRef",value:function(e){e&&(this.legendEl=e)}},{key:"toggleClosed",value:function(){this.closed=!this.closed}},{key:"setPanelHeight",value:function(){var e=this.legendEl,t=this.view,n=t.size,i=t.container,a=(0,r.Z)(n,2),l=a[0],s=a[1];this.viewHeight=s,this.viewWidth=l;var o=i.getBoundingClientRect(),u=o.top,c=o.bottom,d=e.getBoundingClientRect(),f=d.top,h=d.bottom;this.topOffset=f-u,this.viewPosition.includes("top")?this.viewHeightWithOffset=s-this.topOffset:(this.bottomOffset=c-h,this.viewHeightWithOffset=s-this.bottomOffset)}},{key:"addWidget",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.legend,n=this.view,r=this.panelEl,!n||!r||t){e.next=6;break}return e.next=4,n.when();case 4:this.legend=new Cn({view:n,container:r}),(0,f.YP)(n,"size",this.setPanelHeight);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"positionClass",get:function(){var e=this.viewPosition;if(e)return"hub-widget-legend ".concat(e.split("-").join(" "))}},{key:"styles",get:function(){var e=this.viewHeight,t=this.viewWidth,n=this.viewHeightWithOffset,r=this.bottomOffset,i=this.topOffset,a=this.active,l=640;return l>e&&(l=e),{"--panel-height":"".concat(n,"px"),"--panel-height-mobile":"".concat(l,"px"),"--view-width":"".concat(t,"px"),"--bottom-offset":"".concat(r,"px"),"--top-offset":"".concat(i,"px"),"--mobile-display":a?"flex":"none"}}},{key:"render",value:function(){var e=this.styles,t=this.positionClass,n=this.closed,r=this.active,i=this.scale,a=this.intl.t("heading"),l=this.intl.t("textOpen"),s=this.intl.t("textClose");return(0,o.h)(o.H,{"data-element":"map-widget-legend",style:e},(0,o.h)("calcite-panel",{class:t,closable:!0,closed:n,dismissed:n,heading:a,intlClose:s,ref:this.handleSetPanelRef}),(0,o.h)("arcgis-hub-map-widget-generic",{active:r,icon:"legend",onClick:this.toggleClosed,ref:this.handleSetWidgetRef,scale:i,text:r?s:l}))}},{key:"el",get:function(){return(0,o.g)(this)}}],[{key:"assetsDirs",get:function(){return["locales"]}},{key:"watchers",get:function(){return{view:["addWidgetToView"],closed:["updateViewHeightWhenOpen"],active:["emitEventOnActiveChange"]}}}]),e}());In.style=":host{display:block}calcite-panel div{background-color:var(--calcite-ui-foreground-1)}.esri-legend__service,.esri-legend__service>.esri-widget__heading{color:var(--calcite-ui-text-1)}.hub-widget-legend{min-width:none !important;max-width:none !important;padding:0px}@media only screen and (min-width: 640px){.hub-widget-legend.top{position:absolute}.hub-widget-legend.top{width:25rem}.hub-widget-legend.top{padding:0px}.hub-widget-legend.top{max-height:calc(var(--panel-height) - 2rem)}.hub-widget-legend.bottom{position:absolute}.hub-widget-legend.bottom{width:25rem}.hub-widget-legend.bottom{padding:0px}.hub-widget-legend.bottom{bottom:calc(var(--bottom-offset) - 2rem);max-height:calc(var(--panel-height) - 1rem)}.hub-widget-legend.right{right:100%}.hub-widget-legend.right{margin-right:1rem}.hub-widget-legend.left{left:100%}.hub-widget-legend.left{margin-left:1rem}.hub-widget-legend.bottom.left{margin-left:0.5rem}.hub-widget-legend.bottom.right{margin-right:0.5rem}}@media only screen and (max-width: 640px){.hub-widget-legend.top{position:absolute}.hub-widget-legend.top{z-index:50}.hub-widget-legend.top{padding:0px}.hub-widget-legend.top{top:calc(var(--panel-height) - var(--panel-height-mobile) + var(--top-offset) - 1rem);width:calc(var(--view-width) + 1px);display:var(--mobile-display);height:var(--panel-height-mobile)}.hub-widget-legend.bottom{position:absolute}.hub-widget-legend.bottom{z-index:50}.hub-widget-legend.bottom{padding:0px}.hub-widget-legend.bottom{bottom:calc(var(--panel-height-mobile) - var(--panel-height) - var(--bottom-offset) - 1rem);width:calc(var(--view-width) + 1px);display:var(--mobile-display);height:var(--panel-height-mobile)}.hub-widget-legend.right{right:-1rem}.hub-widget-legend.left{left:-1rem}}"},62044:function(e,t,n){n.d(t,{Z:function(){return b}});var r,i=n(15671),a=n(43144),l=n(60136),s=n(92572),o=n(27366),u=n(46784),c=n(92026),d=n(86710),f=n(49861),h=(n(25243),n(63780),n(38511)),y=n(69912),p=n(31201),v=r=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).end=null,r.start=null,r}return(0,a.Z)(n,[{key:"readEnd",value:function(e,t){return null!=t.end?new Date(t.end):null}},{key:"writeEnd",value:function(e,t){t.end=e?e.getTime():null}},{key:"isAllTime",get:function(){return this.equals(r.allTime)}},{key:"isEmpty",get:function(){return this.equals(r.empty)}},{key:"readStart",value:function(e,t){return null!=t.start?new Date(t.start):null}},{key:"writeStart",value:function(e,t){t.start=e?e.getTime():null}},{key:"clone",value:function(){return new r({end:this.end,start:this.start})}},{key:"equals",value:function(e){if(!e)return!1;var t=(0,c.pC)(this.start)?this.start.getTime():this.start,n=(0,c.pC)(this.end)?this.end.getTime():this.end,r=(0,c.pC)(e.start)?e.start.getTime():e.start,i=(0,c.pC)(e.end)?e.end.getTime():e.end;return t===r&&n===i}},{key:"expandTo",value:function(e){if(this.isEmpty||this.isAllTime)return this.clone();var t=(0,c.yw)(this.start,(function(t){return(0,d.JE)(t,e)})),n=(0,c.yw)(this.end,(function(t){var n=(0,d.JE)(t,e);return t.getTime()===n.getTime()?n:(0,d.Nm)(n,1,e)}));return new r({start:t,end:n})}},{key:"intersection",value:function(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return r.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();var t,n,i=(0,c.R2)(this.start,-1/0,(function(e){return e.getTime()})),a=(0,c.R2)(this.end,1/0,(function(e){return e.getTime()})),l=(0,c.R2)(e.start,-1/0,(function(e){return e.getTime()})),s=(0,c.R2)(e.end,1/0,(function(e){return e.getTime()}));if(l>=i&&l<=a?t=l:i>=l&&i<=s&&(t=i),a>=l&&a<=s?n=a:s>=i&&s<=a&&(n=s),null!=t&&null!=n&&!isNaN(t)&&!isNaN(n)){var o=new r;return o.start=t===-1/0?null:new Date(t),o.end=n===1/0?null:new Date(n),o}return r.empty}},{key:"offset",value:function(e,t){if(this.isEmpty||this.isAllTime)return this.clone();var n=new r,i=this.start,a=this.end;return(0,c.pC)(i)&&(n.start=(0,d.Nm)(i,e,t)),(0,c.pC)(a)&&(n.end=(0,d.Nm)(a,e,t)),n}},{key:"union",value:function(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return m.clone();var t=(0,c.pC)(this.start)&&(0,c.pC)(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,n=(0,c.pC)(this.end)&&(0,c.pC)(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new r({start:t,end:n})}}],[{key:"allTime",get:function(){return m}},{key:"empty",get:function(){return g}}]),n}(u.wq);(0,o._)([(0,f.Cb)({type:Date,json:{write:{allowNull:!0}}})],v.prototype,"end",void 0),(0,o._)([(0,h.r)("end")],v.prototype,"readEnd",null),(0,o._)([(0,p.c)("end")],v.prototype,"writeEnd",null),(0,o._)([(0,f.Cb)({readOnly:!0,json:{read:!1}})],v.prototype,"isAllTime",null),(0,o._)([(0,f.Cb)({readOnly:!0,json:{read:!1}})],v.prototype,"isEmpty",null),(0,o._)([(0,f.Cb)({type:Date,json:{write:{allowNull:!0}}})],v.prototype,"start",void 0),(0,o._)([(0,h.r)("start")],v.prototype,"readStart",null),(0,o._)([(0,p.c)("start")],v.prototype,"writeStart",null);var m=new(v=r=(0,o._)([(0,y.j)("esri.TimeExtent")],v)),g=new v({start:void 0,end:void 0}),b=v},41691:function(e,t,n){n.d(t,{p:function(){return h},r:function(){return y}});var r=n(15671),i=n(43144),a=n(60136),l=n(92572),s=n(27366),o=n(85015),u=n(100),c=n(49861),d=n(69912),f=n(61826),h=function(e){var t=function(e){(0,a.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"destroy",value:function(){var e,t;this.destroyed||(null!==(e=this._get("handles"))&&void 0!==e&&e.destroy(),null===(t=this._get("updatingHandles"))||void 0===t||t.destroy())}},{key:"handles",get:function(){return this._get("handles")||new u.Z}},{key:"updatingHandles",get:function(){return this._get("updatingHandles")||new f.t}}]),n}(e);return(0,s._)([(0,c.Cb)({readOnly:!0})],t.prototype,"handles",null),(0,s._)([(0,c.Cb)({readOnly:!0})],t.prototype,"updatingHandles",null),t=(0,s._)([(0,d.j)("esri.core.HandleOwner")],t),t},y=function(e){(0,a.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n)}(h(o.Z));y=(0,s._)([(0,d.j)("esri.core.HandleOwner")],y)},14921:function(e,t,n){n.d(t,{Ed:function(){return p},UI:function(){return v},mt:function(){return L},q6:function(){return _},vr:function(){return C},w6:function(){return x}});var r=n(74165),i=n(15671),a=n(43144),l=n(60136),s=n(92572),o=n(15861),u=n(27366),c=n(85015),d=n(92026),f=n(66978),h=n(49861),y=(n(25243),n(63780),n(69912));function p(e,t,n){return(0,f.as)(e.map((function(e,r){return t.apply(n,[e,r])})))}function v(e,t,n){return m.apply(this,arguments)}function m(){return(m=(0,o.Z)((0,r.Z)().mark((function e(t,n,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.as)(t.map((function(e,t){return n.apply(i,[e,t])})));case 2:return e.abrupt("return",e.sent.map((function(e){return e.value})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return{ok:!0,value:e}}function b(e){return{ok:!1,error:e}}function _(e){return w.apply(this,arguments)}function w(){return(w=(0,o.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,d.Wi)(t)){e.next=2;break}return e.abrupt("return",{ok:!1,error:new Error("no promise provided")});case 2:return e.prev=2,e.t0=g,e.next=6,t;case 6:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 10:return e.prev=10,e.t2=e.catch(2),e.abrupt("return",b(e.t2));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function L(e){return k.apply(this,arguments)}function k(){return(k=(0,o.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=g,e.next=4,t;case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 8:return e.prev=8,e.t2=e.catch(0),e.abrupt("return",((0,f.r9)(e.t2),b(e.t2)));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function x(e){if(!0===e.ok)return e.value;throw e.error}function C(e,t){return new S(e,t)}var S=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){var a;(0,i.Z)(this,n),(a=t.call(this,{}))._result=null,a._abortHandle=null,a.abort=function(){a._abortController=(0,d.IM)(a._abortController)},a.remove=a.abort,a._abortController=new AbortController;var l=a._abortController.signal;return a.promise=e(l),a.promise.then((function(e){a._result=g(e),a._cleanup()}),(function(e){a._result=b(e),a._cleanup()})),a._abortHandle=(0,f.fu)(r,a.abort),a}return(0,a.Z)(n,[{key:"value",get:function(){return function(e){return(0,d.pC)(e)&&!0===e.ok?e.value:null}(this._result)}},{key:"error",get:function(){return function(e){return(0,d.pC)(e)&&!1===e.ok?e.error:null}(this._result)}},{key:"finished",get:function(){return(0,d.pC)(this._result)}},{key:"normalizeCtorArgs",value:function(){return{}}},{key:"destroy",value:function(){this.abort()}},{key:"_cleanup",value:function(){this._abortHandle=(0,d.hw)(this._abortHandle),this._abortController=null}}]),n}(c.Z);(0,u._)([(0,h.Cb)()],S.prototype,"value",null),(0,u._)([(0,h.Cb)()],S.prototype,"error",null),(0,u._)([(0,h.Cb)()],S.prototype,"finished",null),(0,u._)([(0,h.Cb)()],S.prototype,"promise",void 0),(0,u._)([(0,h.Cb)()],S.prototype,"_result",void 0),S=(0,u._)([(0,y.j)("esri.core.asyncUtils.ReactiveTask")],S)},41644:function(e,t,n){n.d(t,{Bg:function(){return r},sM:function(){return i}});n(93169);function r(e){}function i(e){return function(){return e}}},76672:function(e,t,n){n.d(t,{E:function(){return l},_:function(){return o}});var r=n(74165),i=n(15861),a=n(92026);function l(e,t){return s.apply(this,arguments)}function s(){return s=(0,i.Z)((0,r.Z)().mark((function e(t,i){var a,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(99779),n.e(48562),n.e(22564)]).then(n.bind(n,48562));case 2:return a=e.sent,l=a.WhereClause,e.abrupt("return",l.create(t,i));case 5:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}function o(e,t){return(0,a.pC)(e)?(0,a.pC)(t)?"(".concat(e,") AND (").concat(t,")"):e:t}},61826:function(e,t,n){n.d(t,{t:function(){return p}});var r=n(15671),i=n(43144),a=n(60136),l=n(92572),s=n(27366),o=n(85015),u=n(100),c=n(92026),d=n(94172),f=n(99346),h=n(49861),y=n(69912),p=function(e){(0,a.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).updating=!1,e._handleId=0,e._handles=new u.Z,e._scheduleHandleId=0,e._pendingPromises=new Set,e}return(0,i.Z)(n,[{key:"destroy",value:function(){this.removeAll(),this._handles.destroy()}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,n,d.YP)}},{key:"addWhen",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,n,d.gx)}},{key:"addOnCollectionChange",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.initial,a=void 0!==i&&i,l=r.final,s=void 0!==l&&l,o=++this._handleId;return this._handles.add([(0,d.on)(e,"after-changes",this._createSyncUpdatingCallback(),d.Z_),(0,d.on)(e,"change",t,{onListenerAdd:a?function(e){return t({added:e.toArray(),removed:[]})}:void 0,onListenerRemove:s?function(e){return t({added:[],removed:e.toArray()})}:void 0})],o),{remove:function(){return n._handles.remove(o)}}}},{key:"addPromise",value:function(e){var t=this;if((0,c.Wi)(e))return e;var n=++this._handleId;this._handles.add({remove:function(){t._pendingPromises.delete(e)&&(0!==t._pendingPromises.size||t._handles.has(v)||t._set("updating",!1))}},n),this._pendingPromises.add(e),this._set("updating",!0);var r=function(){return t._handles.remove(n)};return e.then(r,r),e}},{key:"removeAll",value:function(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}},{key:"_installWatch",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,a=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,a);var l=i(e,t,r);return this._handles.add(l,a),{remove:function(){return n._handles.remove(a)}}}},{key:"_installSyncUpdatingWatch",value:function(e,t){var n=this._createSyncUpdatingCallback(),r=(0,d.YP)(e,n,{sync:!0,equals:function(){return!1}});return this._handles.add(r,t),r}},{key:"_createSyncUpdatingCallback",value:function(){var e=this;return function(){e._handles.remove(v),++e._scheduleHandleId;var t=e._scheduleHandleId;e._get("updating")||e._set("updating",!0),e._handles.add((0,f.Os)((function(){t===e._scheduleHandleId&&(e._set("updating",e._pendingPromises.size>0),e._handles.remove(v))})),v)}}}]),n}(o.Z);(0,s._)([(0,h.Cb)({readOnly:!0})],p.prototype,"updating",void 0),p=(0,s._)([(0,y.j)("esri.core.support.WatchUpdatingTracking")],p);var v=-42},86710:function(e,t,n){n.d(t,{JE:function(){return l},Nm:function(){return a},rJ:function(){return s}});n(93169);var r={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},i={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function a(e,t,n){var r=new Date(e.getTime());if(t&&n){var a=i[n],l=a.getter,s=a.setter,o=a.multiplier;if("months"===n){var u=function(e,t){var n=new Date(e,t+1,1);return n.setDate(0),n.getDate()}(r.getFullYear(),r.getMonth()+t);r.getDate()>u&&r.setDate(u)}r[s](r[l]()+t*o)}return r}function l(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function s(e,t,n){return 0===e?0:e*r[t]/r[n]}},8537:function(e,t,n){n.d(t,{YP:function(){return a}});var r=n(44927),i=(n(98928),n(84652),n(32718));n(66978);(0,r.K)(i.Z.getLogger("esri.core.watchUtils"),"esri/core/watchUtils",{see:"https://arcg.is/1LTnuf",replacement:"esri/core/reactiveUtils",warnOnce:!0,version:"4.24"});function a(e,t,n,r){return e.watch(t,n,r)}},59166:function(e,t,n){n(76969),n(6291),n(8704),n(36257);var r=n(41201),i=n(74165),a=n(15671),l=n(43144),s=n(15861),o=n(76200),u=n(10064),c=n(92026);function d(){return d=(0,s.Z)((0,i.Z)().mark((function e(t,n,a,l){var s,o,c,d,h,y,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.exec(a)){e.next=3;break}throw new u.Z("esri-intl:invalid-bundle",'Bundle id "'.concat(a,'" is not compatible with the pattern "').concat(n,'"'));case 3:return o=s[1]?"".concat(s[1],"/"):"",c=s[2],d=(0,r.Su)(l),h="".concat(o).concat(c,".json"),y=d?"".concat(o).concat(c,"_").concat(d,".json"):h,e.prev=4,e.next=7,f(t(y));case 7:case 17:p=e.sent,e.next=23;break;case 10:if(e.prev=10,e.t0=e.catch(4),y!==h){e.next=14;break}throw new u.Z("intl:unknown-bundle",'Bundle "'.concat(a,'" cannot be loaded'),{error:e.t0});case 14:return e.prev=14,e.next=17,f(t(h));case 20:throw e.prev=20,e.t1=e.catch(14),new u.Z("intl:unknown-bundle",'Bundle "'.concat(a,'" cannot be loaded'),{error:e.t1});case 23:return e.abrupt("return",p);case 24:case"end":return e.stop()}}),e,null,[[4,10],[14,20]])}))),d.apply(this,arguments)}function f(e){return h.apply(this,arguments)}function h(){return(h=(0,s.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,c.pC)(p.fetchBundleAsset)){e.next=2;break}return e.abrupt("return",p.fetchBundleAsset(t));case 2:return e.next=4,(0,o.default)(t,{responseType:"text"});case 4:return n=e.sent,e.abrupt("return",JSON.parse(n.data));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=function(){function e(t){var n,r=t.base,i=void 0===r?"":r,l=t.pattern,s=t.location,o=void 0===s?new URL(window.location.href):s;(0,a.Z)(this,e),n="string"==typeof o?function(e){return new URL(e,new URL(o,window.location.href)).href}:o instanceof URL?function(e){return new URL(e,o).href}:o,this.pattern="string"==typeof l?new RegExp("^".concat(l)):l,this.getAssetUrl=n,i=i?i.endsWith("/")?i:i+"/":"",this.matcher=new RegExp("^".concat(i,"(?:(.*)/)?(.*)$"))}return(0,l.Z)(e,[{key:"fetchMessageBundle",value:function(e,t){return function(e,t,n,r){return d.apply(this,arguments)}(this.getAssetUrl,this.matcher,e,t)}}]),e}();var p={},v=n(65905);(0,r.tz)(function(e){return new y(e)}({pattern:"esri/",location:v.V}))},41201:function(e,t,n){n.d(t,{ME:function(){return b},Su:function(){return w},tz:function(){return g}});var r=n(74165),i=n(15671),a=n(43144),l=n(29439),s=n(15861),o=n(37762),u=n(10064),c=n(66978),d=n(36257),f=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,h={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function y(e){var t;return null!==(t=h[e])&&void 0!==t&&t}var p=[],v=new Map;function m(e){var t,n=(0,o.Z)(v.keys());try{for(n.s();!(t=n.n()).done;){var r=t.value;x(e.pattern,r)&&v.delete(r)}}catch(i){n.e(i)}finally{n.f()}}function g(e){return p.includes(e)||(m(e),p.unshift(e)),{remove:function(){var t=p.indexOf(e);t>-1&&(p.splice(t,1),m(e))}}}function b(e){return _.apply(this,arguments)}function _(){return(_=(0,s.Z)((0,r.Z)().mark((function e(t){var n,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(0,d.Kd)(),v.has(t)||v.set(t,L(t,n)),i=v.get(t),e.t0=i,!e.t0){e.next=7;break}return e.next=7,C.add(i);case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){if(!f.test(e))return null;var t=f.exec(e);if(null===t)return null;var n=(0,l.Z)(t,3),r=n[1],i=n[2],a=r+(i?"-"+i.toUpperCase():"");return y(a)?a:y(r)?r:null}function L(e,t){return k.apply(this,arguments)}function k(){return(k=(0,s.Z)((0,r.Z)().mark((function e(t,n){var i,a,l,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],a=(0,o.Z)(p),e.prev=2,a.s();case 4:if((l=a.n()).done){e.next=18;break}if(!x((s=l.value).pattern,t)){e.next=16;break}return e.prev=7,e.next=10,s.fetchMessageBundle(t,n);case 10:return e.abrupt("return",e.sent);case 13:e.prev=13,e.t0=e.catch(7),i.push(e.t0);case 16:e.next=4;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(2),a.e(e.t1);case 23:return e.prev=23,a.f(),e.finish(23);case 26:if(!i.length){e.next=28;break}throw new u.Z("intl:message-bundle-error",'Errors occurred while loading "'.concat(t,'"'),{errors:i});case 28:throw new u.Z("intl:no-message-bundle-loader",'No loader found for message bundle "'.concat(t,'"'));case 29:case"end":return e.stop()}}),e,null,[[2,20,23,26],[7,13]])})))).apply(this,arguments)}function x(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}(0,d.Ze)((function(){v.clear()}));var C=new(function(){function e(){(0,i.Z)(this,e),this._numLoading=0,this._dfd=null}return(0,a.Z)(e,[{key:"waitForAll",value:function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this._dfd,!e.t0){e.next=4;break}return e.next=4,this._dfd.promise;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"add",value:function(e){var t=this;return this._increase(),e.then((function(){return t._decrease()}),(function(){return t._decrease()})),this.waitForAll()}},{key:"_increase",value:function(){this._numLoading++,this._dfd||(this._dfd=(0,c.dD)())}},{key:"_decrease",value:function(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}}]),e}())},8704:function(e,t,n){n.d(t,{n:function(){return u}});var r=n(32718),i=n(18202),a=n(643),l=n(76969),s=n(6291),o=r.Z.getLogger("esri.intl.substitute");function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.format,i=void 0===r?{}:r;return(0,a.gx)(e,(function(e){return c(e,t,i)}))}function c(e,t,n){var r,a,l,s=e.indexOf(":");if(-1===s?a=e.trim():(a=e.slice(0,s).trim(),l=e.slice(s+1).trim()),!a)return"";var o=(0,i.hS)(a,t);if(null==o)return"";var u=null!==(r=l?null===n||void 0===n?void 0:n[l]:null)&&void 0!==r?r:null===n||void 0===n?void 0:n[a];return u?d(o,u):l?f(o,l):h(o)}function d(e,t){switch(t.type){case"date":return(0,l.p6)(e,t.intlOptions);case"number":return(0,s.uf)(e,t.intlOptions);default:return o.warn("missing format descriptor for key {key}"),h(e)}}function f(e,t){switch(t.toLowerCase()){case"dateformat":return(0,l.p6)(e);case"numberformat":return(0,s.uf)(e);default:return o.warn("inline format is unsupported since 4.12: ".concat(t)),/^(dateformat|datestring)/i.test(t)?(0,l.p6)(e):/^numberformat/i.test(t)?(0,s.uf)(e):h(e)}}function h(e){switch(typeof e){case"string":return e;case"number":return(0,s.uf)(e);case"boolean":return""+e;default:return e instanceof Date?(0,l.p6)(e):""}}},41978:function(e,t,n){n.d(t,{AM:function(){return g}});var r=n(93433),i=n(15671),a=n(43144),l=n(60136),s=n(92572),o=n(27366),u=n(85015),c=n(93169),d=n(84652),f=n(32718),h=n(49861),y=(n(25243),n(69912)),p=n(85411),v=n(32551),m=-1,g=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._from=null,r._to=null,r._final=null,r._current=[],r._time=0,r.duration=(0,c.Z)("mapview-transitions-duration"),r.effects=[],r}return(0,a.Z)(n,[{key:"effect",set:function(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(b(e))}catch(t){this._transitionTo([]),f.Z.getLogger(this.declaredClass).warn("Invalid Effect",{effect:e,error:t})}}}},{key:"hasEffects",get:function(){return this.transitioning||!!this.effects.length}},{key:"scale",set:function(e){this._updateForScale(e)}},{key:"transitioning",get:function(){return null!==this._to}},{key:"canTransitionTo",value:function(e){try{return this.scale>0&&_(this._current,b(e),this.scale)}catch(t){return!1}}},{key:"transitionStep",value:function(e,t){this._applyTimeTransition(e),this._updateForScale(t)}},{key:"endTransitions",value:function(){this._applyTimeTransition(this.duration)}},{key:"_transitionTo",value:function(e){this.scale>0&&_(this._current,e,this.scale)?(this._final=e,this._to=(0,d.d9)(e),function(e,t,n){for(var i,a,l=e.length>t.length?e:t,s=e.length>t.length?t:e,o=s[s.length-1],u=null!==(i=null===o||void 0===o?void 0:o.scale)&&void 0!==i?i:n,c=null!==(a=null===o||void 0===o?void 0:o.effects)&&void 0!==a?a:[],d=s.length;d<l.length;d++)s.push({scale:u,effects:(0,r.Z)(c)});for(var f=0;f<l.length;f++)s[f].scale=s[f].scale===m?n:s[f].scale,l[f].scale=l[f].scale===m?n:l[f].scale,(0,v.uF)(s[f].effects,l[f].effects)}(this._current,this._to,this.scale),this._from=(0,d.d9)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?(0,d.d9)(this._current[0].effects):[])}},{key:"_applyTimeTransition",value:function(e){if(this._to&&this._from&&this._current&&this._final){this._time+=e;for(var t=Math.min(1,this._time/this.duration),n=0;n<this._current.length;n++){var r=this._current[n],i=this._from[n],a=this._to[n];r.scale=w(i.scale,a.scale,t);for(var l=0;l<r.effects.length;l++){var s=r.effects[l],o=i.effects[l],u=a.effects[l];s.interpolate(o,u,t)}}1===t&&(this._current=this._final,this._set("effects",this._current[0]?(0,d.d9)(this._current[0].effects):[]),this._from=this._to=this._final=null)}}},{key:"_updateForScale",value:function(e){if(this._set("scale",e),0!==this._current.length){var t,n,r=this._current,i=this._current.length-1,a=1;if(1===r.length||e>=r[0].scale)n=t=r[0].effects;else if(e<=r[i].scale)n=t=r[i].effects;else for(var l=0;l<i;l++){var s=r[l],o=r[l+1];if(s.scale>=e&&o.scale<=e){a=(e-s.scale)/(o.scale-s.scale),t=s.effects,n=o.effects;break}}for(var u=0;u<this.effects.length;u++)this.effects[u].interpolate(t[u],n[u],a)}}}]),n}(u.Z);function b(e){var t=(0,p.Q)(e)||[];return function(e){var t=e[0];return!!t&&"type"in t}(t)?[{scale:m,effects:t}]:t}function _(e,t,n){var r,i,a,l;return null===(r=e[0])||void 0===r||!r.effects||null===(i=t[0])||void 0===i||!i.effects||!(((null===(a=e[0])||void 0===a?void 0:a.scale)===m||(null===(l=t[0])||void 0===l?void 0:l.scale)===m)&&(e.length>1||t.length>1)&&n<=0)&&(0,v.AS)(e[0].effects,t[0].effects)}function w(e,t,n){return e+(t-e)*n}(0,o._)([(0,h.Cb)()],g.prototype,"_to",void 0),(0,o._)([(0,h.Cb)()],g.prototype,"duration",void 0),(0,o._)([(0,h.Cb)({value:""})],g.prototype,"effect",null),(0,o._)([(0,h.Cb)({readOnly:!0})],g.prototype,"effects",void 0),(0,o._)([(0,h.Cb)({readOnly:!0})],g.prototype,"hasEffects",null),(0,o._)([(0,h.Cb)({value:0})],g.prototype,"scale",null),(0,o._)([(0,h.Cb)({readOnly:!0})],g.prototype,"transitioning",null),g=(0,o._)([(0,y.j)("esri.layers.effects.EffectView")],g)},44041:function(e,t,n){n.d(t,{R:function(){return b}});var r=n(1413),i=n(15671),a=n(43144),l=n(60136),s=n(92572),o=n(27366),u=n(85015),c=n(41691),d=n(92026),f=n(76672),h=n(49861),y=(n(25243),n(63780),n(69912)),p=n(70361),v=n(87072),m=n(58132),g={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"},b=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).floors=null,r.scale=0,r}return(0,a.Z)(n,[{key:"destroy",value:function(){this.layer=null}},{key:"dynamicLayers",get:function(){var e=this;if(!this.hasDynamicLayers)return null;var t=this.visibleSublayers.map((function(t){var n=(0,v.f)(e.floors,t);return t.toExportImageJSON(n)}));return t.length?JSON.stringify(t):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&(0,m.FN)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}},{key:"layer",set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("sublayer-update",(function(e){return t.notifyChange(g[e.propertyName])}))],"layer"))}},{key:"layers",get:function(){var e=this.visibleSublayers;return e?e.length?"show:"+e.map((function(e){return e.id})).join(","):"show:-1":null}},{key:"layerDefs",get:function(){var e,t=this,n=!(null===(e=this.floors)||void 0===e||!e.length),r=this.visibleSublayers.filter((function(e){return null!=e.definitionExpression||n&&null!=e.floorInfo}));return r.length?JSON.stringify(r.reduce((function(e,n){var r=(0,v.f)(t.floors,n),i=(0,f._)(r,n.definitionExpression);return(0,d.pC)(i)&&(e[n.id]=i),e}),{})):null}},{key:"version",get:function(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");var e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){var e=this,t=[];if(!this.layer)return t;var n=this.layer.sublayers;n&&n.forEach((function n(r){var i=e.scale,a=0===i,l=0===r.minScale||i<=r.minScale,s=0===r.maxScale||i>=r.maxScale;r.visible&&(a||l&&s)&&(r.sublayers?r.sublayers.forEach(n):t.unshift(r))}));var r=this._get("visibleSublayers");return!r||r.length!==t.length||r.some((function(e,n){return t[n]!==e}))?t:r}},{key:"toJSON",value:function(){var e=this.layer,t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=(0,r.Z)((0,r.Z)({},t),{},{layers:this.layers,layerDefs:this.layerDefs}),t}}]),n}((0,c.p)(u.Z));(0,o._)([(0,h.Cb)({readOnly:!0})],b.prototype,"dynamicLayers",null),(0,o._)([(0,h.Cb)()],b.prototype,"floors",void 0),(0,o._)([(0,h.Cb)({readOnly:!0})],b.prototype,"hasDynamicLayers",null),(0,o._)([(0,h.Cb)()],b.prototype,"layer",null),(0,o._)([(0,h.Cb)({readOnly:!0})],b.prototype,"layers",null),(0,o._)([(0,h.Cb)({readOnly:!0})],b.prototype,"layerDefs",null),(0,o._)([(0,h.Cb)({type:Number})],b.prototype,"scale",void 0),(0,o._)([(0,h.Cb)(p.qG)],b.prototype,"timeExtent",void 0),(0,o._)([(0,h.Cb)({readOnly:!0})],b.prototype,"version",null),(0,o._)([(0,h.Cb)({readOnly:!0})],b.prototype,"visibleSublayers",null),b=(0,o._)([(0,y.j)("esri.layers.mixins.ExportImageParameters")],b)},87072:function(e,t,n){function r(e){var t,n=e.layer;return"floorInfo"in n&&null!==(t=n.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?a(e.view.floors,n.floorInfo.floorField):null}function i(e,t){var n;return"floorInfo"in t&&null!==(n=t.floorInfo)&&void 0!==n&&n.floorField?a(e,t.floorInfo.floorField):null}function a(e,t){if(null===e||void 0===e||!e.length)return null;var n=e.filter((function(e){return""!==e})).map((function(e){return"'".concat(e,"'")}));return n.push("''"),"".concat(t," IN (").concat(n.join(","),") OR ").concat(t," IS NULL")}n.d(t,{c:function(){return r},f:function(){return i}})},92089:function(e,t,n){n.d(t,{A:function(){return a},r:function(){return i}});var r={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function i(e){var t;return null!==(t=r[e])&&void 0!==t?t:[-34028234663852886e22,34028234663852886e22]}function a(e,t,n){var r,a;if(!(e.depthCount&&e.depthCount>1)){for(var l=e.pixels,s=e.statistics,o=e.pixelType,u=l[0].length,c=null!==(r=e.bandMasks)&&void 0!==r?r:[],d=null!==(a=e.mask)&&void 0!==a?a:new Uint8Array(u).fill(255),f="f32"===o||"f64"===o,h=i(o),y=!1,p=0;p<l.length;p++){var v,m,g="number"==typeof t?t:t[p];if(null!=g){var b=null!==(v=null===s||void 0===s?void 0:s[p].minValue)&&void 0!==v?v:h[0],_=null!==(m=null===s||void 0===s?void 0:s[p].maxValue)&&void 0!==m?m:h[1];if(!(b>g+Number.EPSILON||_<g-Number.EPSILON)){var w=c[p]||new Uint8Array(u).fill(255),L=l[p],k=null===n||void 0===n?void 0:n.customFloatTolerance;if(f&&0!==k){var x=k;x||(x=Math.abs(g)>=9999999e31?2e-7*Math.abs(g):"f32"===o?Math.pow(2,-23):Number.EPSILON);for(var C=0;C<L.length;C++)w[C]&&Math.abs(L[C]-g)<x&&(L[C]=0,w[C]=0,d[C]=0,y=!0)}else for(var S=0;S<L.length;S++)w[S]&&L[S]===g&&(L[S]=0,w[S]=0,d[S]=0,y=!0);c[p]=w}}}y&&(e.bandMasks=c,e.mask=d),y&&"updateStatistics"in e&&e.updateStatistics()}}},58132:function(e,t,n){n.d(t,{FN:function(){return s},QV:function(){return l},ac:function(){return u}});var r=n(37762),i=n(92026),a=n(25265);function l(e,t,n){return t.flatten((function(e){return e.sublayers})).length!==e.length||(!!e.some((function(e){return e.originIdOf("minScale")>n||e.originIdOf("maxScale")>n||e.originIdOf("renderer")>n||e.originIdOf("labelingInfo")>n||e.originIdOf("opacity")>n||e.originIdOf("labelsVisible")>n||e.originIdOf("source")>n}))||!o(e,t))}function s(e,t,n){return!!e.some((function(e){var t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&((0,i.Wi)(t.gdbVersion)||t.gdbVersion===n))||e.originIdOf("renderer")>a.s3.SERVICE||e.originIdOf("labelingInfo")>a.s3.SERVICE||e.originIdOf("opacity")>a.s3.SERVICE||e.originIdOf("labelsVisible")>a.s3.SERVICE}))||!o(e,t)}function o(e,t){if(!e||!e.length||(0,i.Wi)(t))return!0;var n=t.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).map((function(e){return e.id})).toArray();if(e.length>n.length)return!1;var a,l=0,s=n.length,o=(0,r.Z)(e);try{for(o.s();!(a=o.n()).done;){for(var u=a.value.id;l<s&&n[l]!==u;)l++;if(l>=s)return!1}}catch(c){o.e(c)}finally{o.f()}return!0}function u(e){return!!e&&e.some((function(e){return null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale}))}},61029:function(e,t,n){n.d(t,{e:function(){return s},s:function(){return o}});var r=n(1413),i=(n(93169),n(10064)),a=n(92026),l=n(23707);function s(e){return(0,a.Wi)(e)||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function o(e,t){if((0,a.Wi)(e))return null;if(!s(e))return new i.Z("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '".concat(e.type||e.declaredClass,"'"),{renderer:e});switch(e.type){case"simple":return function(e){return u(e,(0,l.q)(e.symbol).error)}(e);case"unique-value":return function(e,t){var n,i=(0,r.Z)((0,r.Z)({},l.K),t),s=null===(n=e.uniqueValueInfos)||void 0===n?void 0:n.map((function(e){return(0,l.q)(e.symbol,i).error})).filter(a.pC),o=(0,l.q)(e.defaultSymbol,i);return o.error&&null!==s&&void 0!==s&&s.unshift(o.error),u(e,s)}(e,t);case"class-breaks":return function(e){var t=e.classBreakInfos.map((function(e){return(0,l.q)(e.symbol).error})).filter(a.pC),n=(0,l.q)(e.defaultSymbol);return n.error&&t.unshift(n.error),u(e,t)}(e);case"dictionary":case"heatmap":return null}return null}function u(e,t){if(!t)return null;var n;if((n=Array.isArray(t)?t:[t]).length>0){var r=n.map((function(e){return e.details.symbol.type||e.details.symbol.declaredClass})).filter((function(e){return!!e}));r.sort();var a=[];return r.forEach((function(e,t){0!==t&&e===r[t-1]||a.push(e)})),new i.Z("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols (".concat(a.join(", "),") which are not supported in 3D"),{renderer:e,symbolErrors:n})}return null}},79563:function(e,t,n){n.d(t,{Ne:function(){return m},Od:function(){return y},Sp:function(){return v},_M:function(){return h},mx:function(){return p}});var r=n(65905),i=n(51995),a=n(76200),l=n(59026),s=n(17842),o=n(49729),u="picture-fill",c="simple-fill",d="simple-marker",f=new l.Z(1e3);function h(e){var t=e.style,n=null;if(e)switch(e.type){case d:"cross"!==t&&"x"!==t&&(n=e.color);break;case c:"solid"===t?n=e.color:"none"!==t&&(n={type:"pattern",x:0,y:0,src:(0,r.V)("esri/symbols/patterns/".concat(t,".png")),width:5,height:5});break;case u:n={type:"pattern",src:e.url,width:(0,s.F2)(e.width)*e.xscale,height:(0,s.F2)(e.height)*e.yscale,x:(0,s.F2)(e.xoffset),y:(0,s.F2)(e.yoffset)};break;case"text":n=e.color;break;case"cim":n=(0,o.iW)(e)}return n}function y(e,t){var n=e+"-"+t;return void 0!==f.get(n)?Promise.resolve(f.get(n)):(0,a.default)(e,{responseType:"image"}).then((function(e){var r=e.data,i=r.naturalWidth,a=r.naturalHeight,l=document.createElement("canvas");l.width=i,l.height=a;var s=l.getContext("2d");s.fillStyle=t,s.fillRect(0,0,i,a),s.globalCompositeOperation="destination-in",s.drawImage(r,0,0);var o=l.toDataURL();return f.put(n,o),o}))}function p(e){if(!e)return null;var t=null;switch(e.type){case c:case u:case d:t=p(e.outline);break;case"simple-line":var n=(0,s.F2)(e.width);null!=e.style&&"none"!==e.style&&0!==n&&(t={color:e.color,style:v(e.style),width:n,cap:e.cap,join:"miter"===e.join?(0,s.F2)(e.miterLimit):e.join});break;default:t=null}return t}var v=function(){var e={};return function(t){if(e[t])return e[t];var n=t.replace(/-/g,"");return e[t]=n,n}}(),m=new i.Z([128,128,128])},74579:function(e,t,n){n.d(t,{BR:function(){return M},Q8:function(){return W},QL:function(){return B},Y6:function(){return v},YW:function(){return m},_h:function(){return b},e3:function(){return P},nf:function(){return g},tb:function(){return w},wJ:function(){return N}});var r=n(74165),i=n(37762),a=n(15861),l=n(51995),s=n(51508),o=n(14921),u=(n(93169),n(92026)),c=n(17842),d=n(71353),f=n(60676),h=n(79563),y=n(32537),p=new l.Z("white");function v(e){var t;if(!e)return 0;if((0,s.dU)(e)){var n=function(e){var t=e.symbolLayers&&e.symbolLayers.length;if(t){var n=e.symbolLayers.getItemAt(t-1);return"outline"in n?(0,u.U2)(n,"outline","size"):void 0}}(e);return(0,u.pC)(n)?n:0}return(0,c.Wz)(null===(t=(0,h.mx)(e))||void 0===t?void 0:t.width)}function m(e){if((0,u.Wi)(e)||!("symbolLayers"in e)||(0,u.Wi)(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((function(e){return"object"===e.type}));case"line-3d":return e.symbolLayers.some((function(e){return"path"===e.type}));case"polygon-3d":return e.symbolLayers.some((function(e){return"object"===e.type||"extrude"===e.type}));default:return!1}}function g(e){return(0,u.s3)(e.resource).href}function b(e,t){if(!e)return null;var n=null;return(0,s.dU)(e)?n=function(e){var t=e.symbolLayers;if(!t)return null;var n=null;return t.forEach((function(e){var t;"object"===e.type&&null!=(null===(t=e.resource)||void 0===t?void 0:t.href)||(n="water"===e.type?(0,u.Wg)(e.color):(0,u.pC)(e.material)?(0,u.Wg)(e.material.color):null)})),n?new l.Z(n):null}(e):(0,s.cT)(e)&&(n=e.color?new l.Z(e.color):null),n?_(n,t):null}function _(e,t){if(null==t||null==e)return e;var n=e.toRgba();return n[3]=n[3]*t,new l.Z(n)}function w(e,t,n){e&&(t||null!=n)&&(t&&(t=new l.Z(t)),(0,s.dU)(e)?function(e,t,n){var r=e.symbolLayers;if(r){var i=function(e){var r,i,a=(0,u.pC)(e)?e:null;return _(t=null!==(r=null!==(i=t)&&void 0!==i?i:a)&&void 0!==r?r:null!=n?p:null,n)};r.forEach((function(e){var r;if("object"!==e.type||null==(null===(r=e.resource)||void 0===r?void 0:r.href)||t)if("water"===e.type)e.color=i(e.color);else{var a=(0,u.pC)(e.material)?e.material.color:null,l=i(a);(0,u.Wi)(e.material)?e.material=new y.b({color:l}):e.material.color=l,null!=n&&"outline"in e&&(0,u.pC)(e.outline)&&(0,u.pC)(e.outline.color)&&(e.outline.color=_(e.outline.color,n))}}))}}(e,t,n):(0,s.cT)(e)&&function(e,t,n){var r;(t=null!==(r=t)&&void 0!==r?r:e.color)&&(e.color=_(t,n)),null!=n&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=_(e.outline.color,n))}(e,t,n))}function L(e,t){return k.apply(this,arguments)}function k(){return k=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.symbolLayers,e.t0=i,!e.t0){e.next=5;break}return e.next=5,(0,o.Ed)(i,function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",x(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function x(e,t){return C.apply(this,arguments)}function C(){return(C=(0,a.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="extrude"===e.t0?3:"icon"===e.t0||"line"===e.t0||"text"===e.t0?5:"path"===e.t0?7:"object"===e.t0?9:11;break;case 3:return Z(t,n),e.abrupt("break",11);case 5:return S(t,n),e.abrupt("break",11);case 7:return V(t,n),e.abrupt("break",11);case 9:return e.next=11,E(t,n);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){var n=I(t);(0,u.pC)(n)&&(e.size=n)}function I(e){var t,n=(0,i.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("number"==typeof r)return r}}catch(a){n.e(a)}finally{n.f()}return null}function Z(e,t){e.size="number"==typeof t[2]?t[2]:0}function E(e,t){return R.apply(this,arguments)}function R(){return(R=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i,a,l,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(t);case 2:i=e.sent,a=i.resourceSize,l=i.symbolSize,s=F(n,a,l),t.width=A(n[0],l[0],a[0],s),t.depth=A(n[1],l[1],a[1],s),t.height=A(n[2],l[2],a[2],s);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t){var n=F(t,d.O,[e.width,void 0,e.height]);e.width=A(t[0],e.width,1,n),e.height=A(t[2],e.height,1,n)}function F(e,t,n){for(var r=0;r<3;r++){var i=e[r];switch(i){case"symbol-value":var a=n[r];return null!=a?a/t[r]:1;case"proportional":break;default:if(i&&t[r])return i/t[r]}}return 1}function z(e){return T.apply(this,arguments)}function T(){return(T=(0,a.Z)((0,r.Z)().mark((function e(t){var i,a,l,s,o,u,c,d,f,h;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(23657).then(n.bind(n,23657));case 2:return i=e.sent,e.next=5,i.computeObjectLayerResourceSize(t,10);case 5:a=e.sent,l=t.width,s=t.height,o=t.depth,u=[l,o,s],c=1,d=0;case 12:if(!(d<3)){e.next=20;break}if(null==(f=u[d])){e.next=17;break}return c=f/a[d],e.abrupt("break",20);case 17:d++,e.next=12;break;case 20:for(h=0;h<3;h++)null==u[h]&&(u[h]=a[h]*c);return e.abrupt("return",{resourceSize:a,symbolSize:u});case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t,n,r){switch(e){case"proportional":return n*r;case"symbol-value":return null!=t?t:n;default:return e}}function D(e,t){var n=I(t);if(!(0,u.Wi)(n))switch(e.type){case"simple-marker":e.size=n;break;case"picture-marker":var r=e.width/e.height;r>1?(e.width=n,e.height=n*r):(e.width=n*r,e.height=n);break;case"simple-line":e.width=n;break;case"text":e.font.size=n}}function P(e,t){return O.apply(this,arguments)}function O(){return(O=(0,a.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!n){e.next=2;break}return e.abrupt("return",(0,s.dU)(t)?L(t,n):void((0,s.cT)(t)&&D(t,n)));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e,t,n){if(e&&null!=t)if((0,s.dU)(e)){var r=e.symbolLayers;r&&r.forEach((function(e){if(e&&"object"===e.type)switch(n){case"tilt":e.tilt=t;break;case"roll":e.roll=t;break;default:e.heading=t}}))}else(0,s.cT)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle=t))}function N(e){if(!e)return null;var t=e.effects.filter((function(e){return"bloom"!==e.type})).map((function(e){return e.toJSON()}));return(0,f.rM)(t)}function B(e){return(0,u.pC)(e)&&"polygon-3d"===e.type&&e.symbolLayers.some((function(e){return"extrude"===e.type}))}function W(e,t){return H.apply(this,arguments)}function H(){return(H=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fetchSymbol(n);case 2:return i=e.sent,e.abrupt("return",i||t.fetchCIMSymbol(n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}]);
//# sourceMappingURL=72920.706024eb.chunk.js.map