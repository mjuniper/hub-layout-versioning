"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[79503],{25666:function(e,t,r){r.d(t,{cn:function(){return n},j:function(){return a},lK:function(){return i}});var n="updating";function i(e){return"updating"===e?null:e}function a(e){return"updating"===e}},46169:function(e,t,r){r.d(t,{Z6:function(){return p},ZS:function(){return f},sw:function(){return d}});var n,i,a=r(93433),o=r(37762),u=r(84652),s=r(92026),l=r(99879),c={setAttribute:function(){},rollback:function(){},commit:function(){}};function d(e,t){var r=t.attributes[e.objectIdField],i=e.sessions.get(r);if(i)return i;var a=(0,u.d9)(t.attributes),l=new Set;if(null==r)return c;var d=e.i3sOverrides.createInteractiveEditSession(r),f=new Map,p=function(e,t){var n=f.get(e);if(null==n){var i=t.indexOf(r);return f.set(e,i),i}return n},y=n.EDITING,h={setAttribute:function(r,i){if(y===n.EDITING){var a=e.fieldsIndex.get(r);if(!(0,s.Wi)(a)){var o=e.attributeStorageInfo.findIndex((function(e){return e.name===a.name}));if(!(o<0)){d.set(o,i);var u=e.attributeStorageInfo[o],c=!1;l.add(r),e.forEachNode((function(r,n){var a=p(r,n);if(-1!==a){var o=e.getAttributeData(r.index);if(o){var s=o[u.name];s&&(s[a]=i,e.setAttributeData(r.index,o,t),c=!0)}}})),c&&e.clearMemCache()}}}},rollback:function(){if(y===n.EDITING){var t,i=(0,o.Z)(l);try{for(i.s();!(t=i.n()).done;){var u=t.value;this.setAttribute(u,a[u])}}catch(s){i.e(s)}finally{i.f()}d.rollback(),y=n.ROLLED_BACK,e.sessions.delete(r)}},commit:function(){y===n.EDITING&&(d.commit(),y=n.COMMITTED,e.sessions.delete(r))}};return e.sessions.set(r,h),h}function f(e,t){var r,n=[].concat((0,a.Z)(t.addedFeatures),(0,a.Z)(t.updatedFeatures),(0,a.Z)(t.deletedFeatures)),i=(0,o.Z)(n);try{for(i.s();!(r=i.n()).done;){var u=r.value;u.objectId&&e.i3sOverrides.updateGeometry(u.objectId)}}catch(s){i.e(s)}finally{i.f()}}function p(e,t){var r=function(e,t){var r=t.edits.updateFeatures;if(!r||0===r.length)return new v;for(var n=function(e){var t=new Set;if(!e.updatedFeatures)return t;var r,n=(0,o.Z)(e.updatedFeatures);try{for(n.s();!(r=n.n()).done;){var i=r.value;null!=i.objectId&&null==i.error&&t.add(i.objectId)}}catch(a){n.e(a)}finally{n.f()}return t}(t),i=new v,a=new Map,u=0;u<e.attributeStorageInfo.length;u++)a.set(e.attributeStorageInfo[u].name,u);var s=e.fieldsIndex,c=e.objectIdField,d=r.filter((function(e){var t=(0,l.g)(s,e.attributes,c);return n.has(t)}));return e.forEachNode((function(t,r){var n,a=new Set(r),u=(0,o.Z)(d);try{for(u.s();!(n=u.n()).done;){var f=n.value,p=(0,l.g)(s,f.attributes,c);if(a.has(p)){var h=r.indexOf(p);for(var v in f.attributes){var g=e.fieldsIndex.normalizeFieldName(v),m=y(i,t.index,g),b=f.attributes[v];m.push({featureIndex:h,featureId:p,value:b})}}}}catch(w){u.e(w)}finally{u.f()}})),i}(e,t);if(0!==r.size){for(var n=new Map,i=0;i<e.attributeStorageInfo.length;i++)n.set(e.attributeStorageInfo[i].name,i);var a=!1;r.forEach((function(t,r){var i=e.getAttributeData(r),u=!1;t.forEach((function(t,r){var l,c=(0,s.pC)(i)?i[r]:null,d=n.get(r),f=(0,o.Z)(t);try{for(f.s();!(l=f.n()).done;){var p=l.value,y=p.featureIndex,h=p.value,v=p.featureId;c&&(c[y]=h,u=!0,a=!0),e.i3sOverrides.updateAttributeValue(v,d,h)}}catch(g){f.e(g)}finally{f.f()}})),u&&e.setAttributeData(r,i,null)})),a&&e.clearMemCache()}}function y(e,t,r){var n=function(e,t){var r=e.get(t);if(r)return r;var n=new h;return e.set(t,n),n}(e,t),i=null!=r&&n.get(r);if(i)return i;var a=new Array;return n.set(r,a),a}(i=n||(n={}))[i.EDITING=0]="EDITING",i[i.ROLLED_BACK=1]="ROLLED_BACK",i[i.COMMITTED=2]="COMMITTED";var h=Map,v=Map},1247:function(e,t,r){r.d(t,{l:function(){return p}});var n=r(15671),i=r(43144),a=r(60136),o=r(92572),u=r(27366),s=r(32718),l=r(49861),c=(r(25243),r(63780),r(69912)),d=r(48562),f=r(44011),p=function(e){var t=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments))._definitionExpressionErrors=0,e._maxDefinitionExpressionErrors=20,e.logError=function(t){e._definitionExpressionErrors<e._maxDefinitionExpressionErrors&&s.Z.getLogger(e.declaredClass).error("Error while evaluating definitionExpression: "+t),e._definitionExpressionErrors++,e._definitionExpressionErrors===e._maxDefinitionExpressionErrors&&s.Z.getLogger(e.declaredClass).error("Further errors are ignored")},e}return(0,i.Z)(r,[{key:"parsedDefinitionExpression",get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{var e=d.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!e.isStandardized)return s.Z.getLogger(this.declaredClass).error("definitionExpression is using non standard function"),null;var t=[],r=e.fieldNames;return(0,f.e8)(r,this.i3slayer.fields,{missingFields:t}),t.length>0?(s.Z.getLogger(this.declaredClass).error("definitionExpression references unknown fields: ".concat(t.join(", "))),null):(this._definitionExpressionErrors=0,e)}catch(n){return s.Z.getLogger(this.declaredClass).error("Failed to parse definitionExpression: "+n),null}}},{key:"definitionExpressionFields",get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}},{key:"_evaluateClause",value:function(e,t){try{return e.testFeature(t)}catch(r){return this.logError(r),!1}}},{key:"_addDefinitionExpressionToQuery",value:function(e){if(!this.parsedDefinitionExpression)return e;var t=this.i3slayer.definitionExpression,r=e.clone();return r.where?r.where="(".concat(t,") AND (").concat(r.where,")"):r.where=t,r}}]),r}(e);return(0,u._)([(0,l.Cb)()],t.prototype,"i3slayer",void 0),(0,u._)([(0,l.Cb)({readOnly:!0})],t.prototype,"parsedDefinitionExpression",null),(0,u._)([(0,l.Cb)({readOnly:!0})],t.prototype,"definitionExpressionFields",null),t=(0,u._)([(0,c.j)("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t)}},23224:function(e,t,r){r.d(t,{i:function(){return g}});var n=r(93433),i=r(37762),a=r(74165),o=r(15861),u=r(15671),s=r(43144),l=r(60136),c=r(92572),d=r(27366),f=r(10064),p=r(92026),y=(r(32718),r(25243),r(63780),r(93169),r(69912)),h=r(80031),v=r(24405),g=function(e){var t=function(e){(0,l.Z)(r,e);var t=(0,c.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"_validateFetchPopupFeatures",value:function(e){var t=this.layer;if(!t.popupEnabled)throw new f.Z("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t});if(!(0,v.V)(t,e))throw new f.Z("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t})}},{key:"prepareFetchPopupFeatures",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchPopupFeatures",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var o,u,s,l,c,d,f,y,g;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._validateFetchPopupFeatures(r),(o=(0,p.pC)(r)?r.clientGraphics:null)&&0!==o.length){e.next=4;break}return e.abrupt("return",[]);case 4:if(u="scene"===this.layer.type&&(0,p.pC)(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,s=[],e.t0="fieldsIndex"in this.layer,!e.t0){e.next=14;break}return e.t1=h.Lk,e.t2=this.layer.fieldsIndex,e.next=12,(0,v.e)(u,(0,v.V)(this.layer,r));case 12:e.t3=e.sent,s=(0,e.t1)(e.t2,e.t3);case 14:return e.next=16,this.prepareFetchPopupFeatures(s);case 16:l=new Set,c=[],d=[],f=(0,i.Z)(o);try{for(f.s();!(y=f.n()).done;)g=y.value,(0,h.Gm)(s,g,l)?d.push(g):c.push(g)}catch(t){f.e(t)}finally{f.f()}return e.abrupt("return",0===d.length?c:this.whenGraphicAttributes(d,(0,n.Z)(l)).catch((function(){return d})).then((function(e){return c.concat(e)})));case 20:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(e);return t=(0,d._)([(0,y.j)("esri.views.3d.layers.support.PopupSceneLayerView")],t)}},6777:function(e,t,r){r.d(t,{K:function(){return F}});var n,i,a=r(74165),o=r(15861),u=r(93433),s=r(15671),l=r(43144),c=r(60136),d=r(92572),f=r(27366),p=r(31319),y=r(32718),h=r(39052),v=r(49861),g=r(69912),m=r(50898),b=function(e){var t=function(e){(0,c.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments))._numUpdating=0,e._asyncUpdateState=new Map,e}return(0,l.Z)(r,[{key:"updating",get:function(){return this._numUpdating>0}},{key:"autoUpdateAsync",value:function(e,t){var r=this;return function(e,t){var r=function(){a&&!o&&e(n)},n=function(){if(!a||o)return t();a.clear(),o=!0;var e=(0,h.LJ)(a,t);return o=!1,e},i=function(){a&&(a.destroy(),a=null)},a=new m.M(r),o=!1;return e(n),{remove:i}}((function(t){return r._updateAsync(e,t)}),t)}},{key:"_updateAsync",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._startAsyncUpdate(t)){e.next=12;break}return e.prev=1,e.next=4,r();case 4:n=e.sent,this._set(t,n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),y.Z.getLogger(this.declaredClass).warn('Async update of "'.concat(String(t),'" failed. Async update functions should not throw exceptions.'));case 11:this._endAsyncUpdate(t)&&this._updateAsync(t,r);case 12:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_startAsyncUpdate",value:function(e){var t,r=null!==(t=this._asyncUpdateState.get(e))&&void 0!==t?t:n.None;return r&n.Updating?(this._asyncUpdateState.set(e,r|n.Invalidated),!0):(++this._numUpdating,this._asyncUpdateState.set(e,r|n.Updating),!1)}},{key:"_endAsyncUpdate",value:function(e){var t;--this._numUpdating;var r=(null!==(t=this._asyncUpdateState.get(e))&&void 0!==t?t:n.None)&~n.Updating;return r&n.Invalidated?(this._asyncUpdateState.set(e,r&~n.Invalidated),!0):(this._asyncUpdateState.set(e,r),!1)}}]),r}(e);return(0,f._)([(0,v.Cb)({readOnly:!0})],t.prototype,"updating",null),(0,f._)([(0,v.Cb)()],t.prototype,"_numUpdating",void 0),t=(0,f._)([(0,g.j)("esri.core.AsyncUpdate")],t)};(i=n||(n={}))[i.None=0]="None",i[i.Updating=1]="Updating",i[i.Invalidated=2]="Invalidated";var w=function(e){(0,c.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r)}(b(p.Z));w=(0,f._)([(0,g.j)("esri.core.AsyncUpdate")],w);var x=r(41691),_=r(92026),E=(r(25243),r(63780),r(80031)),Z="esri.views.3d.layers.support.SceneLayerViewRequiredFields",F=function(e){(0,c.Z)(r,e);var t=(0,d.Z)(r);function r(e){return(0,s.Z)(this,r),t.call(this,e)}return(0,l.Z)(r,[{key:"layer",get:function(){return this.layerView.layer}},{key:"requiredFields",get:function(){var e=this.layerView,t=e.layer.fieldsIndex,r=e.definitionExpressionFields,n=this.rendererFields,i=this.labelingFields,a=this.viewFilterFields;return(0,E.Q0)(t,[].concat((0,u.Z)((0,_.Pt)(r,[])),(0,u.Z)((0,_.Pt)(n,[])),(0,u.Z)((0,_.Pt)(i,[])),(0,u.Z)((0,_.Pt)(a,[]))))}},{key:"initialize",value:function(){var e=this;this.handles.add([this.autoUpdateAsync("rendererFields",(0,o.Z)((0,a.Z)().mark((function t(){var r,n,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.layer,n=r.fieldsIndex,i=r.renderer,t.abrupt("return",i?k((function(e){return i.collectRequiredFields(e,n)})):null);case 2:case"end":return t.stop()}}),t)})))),this.autoUpdateAsync("labelingFields",(0,o.Z)((0,a.Z)().mark((function t(){var r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.layer,t.abrupt("return",r.labelsVisible?k((function(e){return(0,E.Mu)(e,r)})):null);case 2:case"end":return t.stop()}}),t)})))),this.autoUpdateAsync("viewFilterFields",(function(){var t=e.layerView,r=t.layer,n=t.filter;return k((function(e){return(0,E.Ll)(e,r,n)}))}))])}}]),r}(b(x.r));function k(e){return I.apply(this,arguments)}function I(){return(I=(0,o.Z)((0,a.Z)().mark((function e(t){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Set,e.prev=1,e.next=4,t(r);case 4:return e.abrupt("return",Array.from(r).sort());case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",(y.Z.getLogger(Z).error(e.t0),null));case 10:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}(0,f._)([(0,v.Cb)()],F.prototype,"layerView",void 0),(0,f._)([(0,v.Cb)()],F.prototype,"layer",null),(0,f._)([(0,v.Cb)()],F.prototype,"requiredFields",null),(0,f._)([(0,v.Cb)()],F.prototype,"rendererFields",void 0),(0,f._)([(0,v.Cb)()],F.prototype,"labelingFields",void 0),(0,f._)([(0,v.Cb)()],F.prototype,"viewFilterFields",void 0),F=(0,f._)([(0,g.j)(Z)],F)},48252:function(e,t,r){r.d(t,{v:function(){return a}});var n=r(93433),i=r(80031);function a(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){var e=this.layer,t=this.layer.fieldsIndex,r=this.requiredFields;return e.outFields?(0,i.Q0)(t,[].concat((0,n.Z)((0,i.Lk)(t,e.outFields)),(0,n.Z)(r))):(0,i.Q0)(t,r)}}}}},17006:function(e,t,r){r.d(t,{Z:function(){return _}});var n=r(74165),i=r(15861),a=r(37762),o=r(15671),u=r(43144),s=r(60136),l=r(92572),c=r(27366),d=r(32718),f=r(92026),p=r(25666),y=r(94172),h=r(49861),v=(r(25243),r(63780),r(69912)),g=r(79803),m=r(67581),b="esri.views.layers.SceneLayerView",w=d.Z.getLogger(b),x=function(e){(0,s.Z)(c,e);var t=(0,l.Z)(c);function c(){var e;return(0,o.Z)(this,c),(e=t.apply(this,arguments)).layer=null,e.filter=null,e._geometryEngine=null,e._projectionEngineLoaded=!1,e}return(0,u.Z)(c,[{key:"availableFields",get:function(){return[]}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(e){throw new Error("Not implemented")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"layerFilter",get:function(){return(0,p.lK)(this._layerFilter)}},{key:"_layerFilter",get:function(){var e=this.layer.filter;if((0,f.Wi)(e)||e.geometries.length<1)return null;var t=this._geometryEngine;if((0,f.Wi)(t)||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return p.cn;var r,n=e.geometries.getItemAt(0).spatialReference,i=e.geometries.toArray().map((function(e){try{e=t.simplify(e)}catch(r){return w.warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==e)return null;if(e.spatialReference.equals(n))return e;try{return(0,g.iV)(e,n)}catch(r){return w.warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),null}})).filter(f.pC).sort((function(e,t){return e.extent.xmin-t.extent.xmin})),o=new Set,u=new Array,s=new Array,l=(0,a.Z)(i);try{var c=function(){var e=r.value,n=e.extent.xmin;if(u.length=0,o.forEach((function(r){if(n>=r.extent.xmax)return s.push(r),void o.delete(r);e.extent.ymin<=r.extent.ymax&&e.extent.ymax>=r.extent.ymin&&t.intersects(e,r)&&u.push(r)})),u.length>0){u.push(e);try{e=t.union(u)}catch(i){return w.warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored."),"continue"}u.pop(),u.forEach((function(e){return o.delete(e)}))}o.add(e)};for(l.s();!(r=l.n()).done;)c()}catch(d){l.e(d)}finally{l.f()}return o.forEach((function(e){return s.push(e)})),s.length>0?{spatialRelationship:e.spatialRelationship,geometries:s}:null}},{key:"_filterNeedsProjectionEngine",get:function(){var e=this.layer.filter;if((0,f.Wi)(e)||e.geometries.length<=1)return!1;var t=e.geometries.getItemAt(0).spatialReference;return e.geometries.some((function(e){var r=e.spatialReference;return!r.equals(t)&&!(0,g.Up)(r,t)}))}},{key:"layerFilterUpdating",get:function(){return(0,p.j)(this._layerFilter)}},{key:"initialize",value:function(){var e=this;(0,y.N1)((function(){return!e._geometryEngine&&(0,f.pC)(e.layer.filter)&&e.layer.filter.geometries.length})).then((0,i.Z)((0,n.Z)().mark((function t(){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([r.e(99058),r.e(2170)]).then(r.bind(r,2170));case 2:return t.abrupt("return",e._geometryEngine=t.sent);case 3:case"end":return t.stop()}}),t)})))),this._projectionEngineLoaded=(0,g.kR)(),(0,y.N1)((function(){return!e._projectionEngineLoaded&&e._filterNeedsProjectionEngine})).then((0,i.Z)((0,n.Z)().mark((function t(){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,g.zD)();case 2:e._projectionEngineLoaded=!0;case 3:case"end":return t.stop()}}),t)}))))}},{key:"highlight",value:function(e){throw new Error("Not implemented")}},{key:"queryFeatures",value:function(e,t){throw new Error("Not implemented")}},{key:"queryObjectIds",value:function(e,t){throw new Error("Not implemented")}},{key:"queryFeatureCount",value:function(e,t){throw new Error("Not implemented")}},{key:"createQuery",value:function(){throw new Error("Not implemented")}},{key:"queryExtent",value:function(e,t){throw new Error("Not implemented")}}]),c}(m.Z);(0,c._)([(0,h.Cb)()],x.prototype,"layer",void 0),(0,c._)([(0,h.Cb)()],x.prototype,"availableFields",null),(0,c._)([(0,h.Cb)()],x.prototype,"maximumNumberOfFeatures",null),(0,c._)([(0,h.Cb)({readOnly:!0})],x.prototype,"maximumNumberOfFeaturesExceeded",null),(0,c._)([(0,h.Cb)()],x.prototype,"filter",void 0),(0,c._)([(0,h.Cb)({readOnly:!0})],x.prototype,"layerFilter",null),(0,c._)([(0,h.Cb)({readOnly:!0})],x.prototype,"_layerFilter",null),(0,c._)([(0,h.Cb)()],x.prototype,"_geometryEngine",void 0),(0,c._)([(0,h.Cb)()],x.prototype,"_projectionEngineLoaded",void 0),(0,c._)([(0,h.Cb)()],x.prototype,"_filterNeedsProjectionEngine",null),(0,c._)([(0,h.Cb)()],x.prototype,"layerFilterUpdating",null);var _=x=(0,c._)([(0,v.j)(b)],x)}}]);
//# sourceMappingURL=79503.38b917bf.chunk.js.map