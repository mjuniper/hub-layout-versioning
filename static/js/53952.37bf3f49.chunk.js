"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[53952],{53952:function(e,r,t){t.d(r,{Z:function(){return z}});var n=t(1413),i=t(37762),u=t(74165),o=t(15861),a=t(15671),s=t(43144),l=t(11752),c=t(61120),y=t(60136),h=t(92572),d=t(27366),p=t(10064),f=t(92026),v=t(94172),m=t(49861),g=(t(25243),t(63780),t(69912)),_=t(37818),b=t(5845),Z=t(43682),C=t(42069),k=t(32080),F=t(85015),w=t(66978),x=t(65618),M=t(5192),q=t(52639),O=t(18722),R=t(46798),S=t(78952),D=t(83040),P=function(){function e(r){(0,a.Z)(this,e),this._controller=r,this._handle=new V((function(e){return r.schedule(e)}))}return(0,s.Z)(e,[{key:"destroy",value:function(){this._handle.destroy()}},{key:"invoke",value:function(e,r){var t=this;return e.buffer&&0!==e.buffer.byteLength?(e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof S.Z&&(e.options=(0,n.Z)((0,n.Z)({},e.options),{},{sourceSpatialReference:e.options.sourceSpatialReference.toJSON()})),this._handle.invoke(e,r).then((function(e){var r=0,n=0,i=function(){var a=(0,o.Z)((0,u.Z)().mark((function o(a){var s,l;return(0,u.Z)().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:if(e.spatialReference=S.Z.fromJSON(e.spatialReference),!e.fields){u.next=6;break}case 1:if(!(r<e.fields.length)){u.next=6;break}if(e.fields[r]=D.Z.fromJSON(e.fields[r]),r++,!a.madeProgress()){u.next=4;break}return u.abrupt("return",t._controller.reschedule((function(e){return i(e)})));case 4:u.next=1;break;case 6:s=e.spatialReference;case 7:if(!(n<e.features.length)){u.next=13;break}if(l=e.features[n],++n,l.uid=q.Z.generateUID(),!(0,f.pC)(l.geometry)||(l.geometry.spatialReference=s,T(l.geometry),!a.madeProgress())){u.next=11;break}return u.abrupt("return",t._controller.reschedule((function(e){return i(e)})));case 11:u.next=7;break;case 13:return u.abrupt("return",e);case 14:case"end":return u.stop()}}),o)})));return function(e){return a.apply(this,arguments)}}();return t._controller.schedule((function(e){return i(e)}))}))):Promise.resolve(null)}}]),e}();function T(e){switch(e.type){case"polyline":e.paths.reduce((function(e,r){return e+r.length}),0)<O.DB&&(e.paths=e.hasZ||e.hasM?e.paths.map((function(e){return e.map((function(e){return[e[0],e[1],e[2]]}))})):e.paths.map((function(e){return e.map((function(e){return[e[0],e[1]]}))})));break;case"polygon":e.rings.reduce((function(e,r){return e+r.length}),0)<O.DB&&(e.rings=e.hasZ||e.hasM?e.rings.map((function(e){return e.map((function(e){return[e[0],e[1],e[2]]}))})):e.rings.map((function(e){return e.map((function(e){return[e[0],e[1]]}))})))}}var V=function(e){(0,y.Z)(t,e);var r=(0,h.Z)(t);function t(e){return(0,a.Z)(this,t),r.call(this,"PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:function(e){return[e.buffer]}},e)}return(0,s.Z)(t)}(R.q),N=function(e){(0,y.Z)(t,e);var r=(0,h.Z)(t);function t(e){return(0,a.Z)(this,t),r.call(this,e)}return(0,s.Z)(t,[{key:"queryFeaturesDehydrated",get:function(){var e=this,r=this.layer.capabilities,t=r&&r.query,n=t&&t.supportsFormatPBF,i=this.layer.parsedUrl;if(n){var u,o;(0,f.Wi)(this._decoder)&&(this._decoder=new P(this.controller));var a={sourceSpatialReference:null!==(u=null===(o=this.layer.spatialReference)||void 0===o?void 0:o.toJSON())&&void 0!==u?u:null,applyTransform:!0,maxStringAttributeLength:1024};return function(r,t){return(0,M.Vn)(i,r,"pbf",e._createRequestOptions(t)).then((function(r){return(0,w.k_)(t),(0,f.pC)(e._decoder)?e._decoder.invoke({buffer:r.data,options:a},t.signal):Promise.reject((0,w.zE)())}))}}return function(r,t){return(0,M.JT)(i,r,e.layer.spatialReference,e._createRequestOptions(t)).then((function(e){return(0,x.PA)(e.data)}))}}},{key:"queryFeatureCount",value:function(e,r){return this.layer.queryFeatureCount(e,r)}},{key:"destroy",value:function(){this._decoder=(0,f.SC)(this._decoder)}},{key:"_createRequestOptions",value:function(e){return(0,n.Z)((0,n.Z)({},e),{},{query:(0,n.Z)((0,n.Z)({},this.layer.customParameters),{},{token:this.layer.apiKey},null===e||void 0===e?void 0:e.query)})}}]),t}(F.Z);(0,d._)([(0,m.Cb)({constructOnly:!0})],N.prototype,"layer",void 0),(0,d._)([(0,m.Cb)({constructOnly:!0})],N.prototype,"controller",void 0),(0,d._)([(0,m.Cb)({readOnly:!0})],N.prototype,"queryFeaturesDehydrated",null),N=(0,d._)([(0,g.j)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],N);var j=function(e){(0,y.Z)(t,e);var r=(0,h.Z)(t);function t(e){return(0,a.Z)(this,t),r.call(this,e)}return(0,s.Z)(t,[{key:"queryFeaturesDehydrated",value:function(e,r){return this.layer.queryFeatures(e,r)}},{key:"queryFeatureCount",value:function(e,r){return this.layer.queryFeatureCount(e,r)}}]),t}(F.Z);(0,d._)([(0,m.Cb)({constructOnly:!0})],j.prototype,"layer",void 0),(0,d._)([(0,m.Cb)({readOnly:!0})],j.prototype,"queryFeaturesDehydrated",null),j=(0,d._)([(0,g.j)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],j);var Q=function(e){(0,y.Z)(t,e);var r=(0,h.Z)(t);function t(e){return(0,a.Z)(this,t),r.call(this,e)}return(0,s.Z)(t,[{key:"queryFeaturesDehydrated",value:function(e,r){return this.layer.queryFeatures(e,r)}}]),t}(F.Z);(0,d._)([(0,m.Cb)({constructOnly:!0})],Q.prototype,"layer",void 0),Q=(0,d._)([(0,g.j)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],Q);var E=function(e){(0,y.Z)(t,e);var r=(0,h.Z)(t);function t(e){return(0,a.Z)(this,t),r.call(this,e)}return(0,s.Z)(t,[{key:"queryFeaturesDehydrated",value:function(e,r){var t=this;return this.source.queryFeaturesJSON(e,r).then(x.PA,(function(n){if(n&&"query-features-json:unsupported"===n.name)return t.layer.queryFeatures(e,r);throw n}))}},{key:"queryFeatureCount",value:function(e,r){return this.layer.queryFeatureCount(e,r)}}]),t}(F.Z);(0,d._)([(0,m.Cb)({constructOnly:!0})],E.prototype,"layer",void 0),(0,d._)([(0,m.Cb)({constructOnly:!0})],E.prototype,"source",void 0),E=(0,d._)([(0,g.j)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],E);var A=function(){function e(r){(0,a.Z)(this,e),this._memoryCache=null,this._capabilities=null;var t=r.layerView.layer;this._layerView=r.layerView,this.objectIdField=t.objectIdField,this.globalIdField="globalIdField"in t?t.globalIdField:null,this._returnZ=r.returnZ,this._returnM=r.returnM;var n=this._layerView.view.resourceController;this.query=function(e,r){return"feature"===e.type&&"feature-layer"===e.source.type?(0,f.pC)(e.infoFor3D)?new j({layer:e}):new N({layer:e,controller:r}):"feature"===e.type&&"memory"===e.source.type||"csv"===e.type||"geojson"===e.type||"oriented-imagery"===e.type||"wfs"===e.type?new E({layer:e,source:e.source}):"ogc-feature"===e.type?new Q({layer:e}):null}(t,n.normal),n&&this._memoryCacheEnabled&&(this._memoryCache=n.memoryController.newCache(t.uid))}return(0,s.Z)(e,[{key:"_memoryCacheEnabled",get:function(){switch(this._layerView.layer.source.type){case"feature-layer":case"ogc-feature":case"oriented-imagery":return!0;case"csv":case"geojson":case"memory":case"wfs":return!1}}},{key:"destroy",value:function(){this._memoryCache=(0,f.SC)(this._memoryCache),this.query.destroy()}},{key:"createQuery",value:function(){var e=this._layerView.layer.createQuery();return e.outFields=this._layerView.availableFields,e.returnZ=this._returnZ,e.returnM=this._returnM,e.outSpatialReference=this.tilingScheme.spatialReference,e}},{key:"memoryCache",get:function(){return this._memoryCache}},{key:"viewingMode",get:function(){return this._layerView.view.state.viewingMode}},{key:"tilingScheme",get:function(){return this._layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){var e=this._layerView.view.resourceController;return e?e.scheduler:null}},{key:"geometryType",get:function(){return this._layerView.layer.geometryType}},{key:"fullExtent",get:function(){return this._layerView.layer.fullExtent}},{key:"tileMaxRecordCount",get:function(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this._layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return(0,f.pC)(this._capabilities)||(this._capabilities=(0,k.A)(this._layerView.layer)),this._capabilities}},{key:"logFetchError",value:function(e,r){e.error("#fetchTile()",this._layerView.layer,r&&r.message?r.message:r)}}]),e}(),I=t(5198),B=t(58890),J=t(78485),L=t(74937),Y=t(67581),U=function(e){(0,y.Z)(t,e);var r=(0,h.Z)(t);function t(e){var n;return(0,a.Z)(this,t),(n=r.call(this,e))._controllerTotal=0,n._processorTotal=0,n.suspendResumeExtentMode="data",n}return(0,s.Z)(t,[{key:"initialize",value:function(){var e=this;this.handles.add((0,v.YP)((function(){return e._updatingRequiredFieldsPromise}),(function(r){return e.updatingHandles.addPromise(r)}),v.tX))}},{key:"destroy",value:function(){this.updatingHandles.removeAll(),this.handles.removeAll(),this._fetcherContext=(0,f.SC)(this._fetcherContext)}},{key:"maximumNumberOfFeatures",get:function(){var e,r;return null!==(e=null===(r=this.controller)||void 0===r?void 0:r.maximumNumberOfFeatures)&&void 0!==e?e:this._get("maximumNumberOfFeatures")},set:function(e){this._set("maximumNumberOfFeatures",e),this.controller&&(this.controller.maximumNumberOfFeatures=e)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!!this.controller&&!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded)}},{key:"updatingProgressValue",get:function(){var e,r,t=0;if(null!==(e=this.controller)&&void 0!==e&&e.updating){var n=this.controller.updatingRemaining,i=Math.max(this.controller.updatingTotal,this._controllerTotal);i>0&&(t=(i-n)/i,this._controllerTotal=i)}var u=0;if(null!==(r=this.processor)&&void 0!==r&&r.updating){var o=this.processor.updatingRemaining,a=Math.max(o,this._processorTotal);a>0&&(u=(a-o)/a,this._processorTotal=a)}return.5*(t+u)}},{key:"updatePolicy",get:function(){if(!this.controller)return J.j.ASYNC;switch(this.controller.mode){case"snapshot":var e=H[this.layer.geometryType];return null==e||this.controller.serviceDataCount>e?J.j.ASYNC:J.j.SYNC;case"tiles":return J.j.ASYNC}}},{key:"hasZ",get:function(){var e=this.layer,r=e.capabilities&&e.capabilities.data;return!(!r||!r.supportsZ)&&("returnZ"in e&&null!=e.returnZ?e.returnZ:r.supportsZ)}},{key:"hasM",get:function(){var e=this.layer,r=e.capabilities&&e.capabilities.data;return!(!r||!r.supportsM)&&"returnM"in e&&null!=e.returnM&&e.returnM}},{key:"setVisibility",value:function(e,r){var t;null===(t=this.processor)||void 0===t||t.setObjectIdVisibility(e,r)}},{key:"createQuery",value:function(){return(0,l.Z)((0,c.Z)(t.prototype),"createQuery",this).call(this)}},{key:"queryFeatures",value:function(e,r){var n=this,i=function(){return(0,l.Z)((0,c.Z)(t.prototype),"queryFeatures",n).call(n,e,r)};return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(e),i):i()}},{key:"beforeSetController",value:function(e){e.maximumNumberOfFeatures=this.maximumNumberOfFeatures}},{key:"createController",value:function(){var e=this;this._fetcherContext=new A({layerView:this,returnZ:this.hasZ,returnM:this.hasM});var r=new b.g({layerView:this,context:this._fetcherContext,graphics:new I.g,extent:this.clippingExtent});return this.updatingHandles.add((function(){return r.serviceDataExtent}),(function(r){e.processor&&(e.processor.dataExtent=r)}),v.nn),this.handles.add((0,v.YP)((function(){return e.suspended}),(function(e){e?r.suspend():r.resume()}),v.tX)),this.updatingHandles.add((function(){var r;return null===(r=e.processor)||void 0===r?void 0:r.displayFeatureLimit}),(function(e){return r.displayFeatureLimit=e}),v.nn),this.handles.add((0,v.gx)((function(){return!e.updating}),(function(){e._controllerTotal=0,e._processorTotal=0}))),r}},{key:"doRefresh",value:function(){var e=(0,o.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r&&!this.suspended&&this.controller&&this.controller.refetch(),this.processor.refreshFilter();case 1:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}()},{key:"getUsedMemory",value:function(){var e,r,t,n;return(null!==(e=null===(r=this.processor)||void 0===r?void 0:r.usedMemory)&&void 0!==e?e:0)+(null!==(t=null===(n=this.controller)||void 0===n?void 0:n.memoryForUnusedFeatures)&&void 0!==t?t:0)}},{key:"getUnloadedMemory",value:function(){var e,r,t,n,i,u,o,a,s=null!==(e=null===(r=this.processor)||void 0===r?void 0:r.unprocessedMemoryEstimate)&&void 0!==e?e:0,l=null!==(t=null===(n=this.controller)||void 0===n?void 0:n.expectedFeatureDiff)&&void 0!==t?t:0,c=null!==(i=null===(u=this.processor)||void 0===u?void 0:u.loadedFeatures)&&void 0!==i?i:0,y=c/(c+l);return s+l*(null!==(o=null===(a=this.processor)||void 0===a?void 0:a.usedMemoryPerFeature)&&void 0!==o?o:0)*y}},{key:"ignoresMemoryFactor",value:function(){var e;return null===(e=this.controller)||void 0===e?void 0:e.hasMaximumNumberOfFeaturesOverride}},{key:"_queryFeaturesMesh",value:function(){var e=(0,o.Z)((0,u.Z)().mark((function e(r,t){var n,o,a,s,l,c,y,h;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._validateQueryFeaturesMesh(r);case 2:return e.next=4,t();case 4:if(n=e.sent,!(r&&r.outStatistics||(0,f.Wi)(this.graphics3DProcessor))){e.next=7;break}return e.abrupt("return",n);case 7:o=this.layer.objectIdField,a=this.graphics3DProcessor.graphics3DGraphicsByObjectID,s=[],l=(0,i.Z)(n.features);try{for(l.s();!(c=l.n()).done;)(y=c.value).geometry?(h=a.get(y.attributes[o]))&&(y.geometry=(0,_.kB)(h.graphic.geometry),s.push(y)):s.push(y)}catch(u){l.e(u)}finally{l.f()}return e.abrupt("return",(n.features=s,n));case 11:case"end":return e.stop()}}),e,this)})));return function(r,t){return e.apply(this,arguments)}}()},{key:"_validateQueryFeaturesMesh",value:function(){var e=(0,o.Z)((0,u.Z)().mark((function e(r){var t,n,i,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:for(t=function(e){throw new p.Z("feature-layer-view:unsupported-query","Queries on Mesh feature collection layers do not support '".concat(e,"'"))},n=0,i=["quantizationParameters","geometryPrecision","maxAllowableOffset"];n<i.length;n++)null!=r[o=i[n]]&&t(o);"returnM"in r&&r.returnM&&t("returnM"),"returnCentroid"in r&&r.returnCentroid&&t("returnCentroid"),(0,f.pC)(r.outSpatialReference)&&!r.outSpatialReference.equals(this.view.spatialReference)&&t("outSpatialReference");case 5:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}()},{key:"performanceInfo",get:function(){var e,r,t,i,u,o,a,s=null===(e=this.controller)||void 0===e?void 0:e.displayFeatureLimit,l=(0,f.pC)(s)?s.averageSymbolComplexity:void 0,c=(0,f.pC)(l)?"f:".concat(l.primitivesPerFeature,",v:").concat(l.primitivesPerCoordinate):"n/a";return(0,n.Z)((0,n.Z)({},this._getResourceInfo()),{},{partial:this.maximumNumberOfFeaturesExceeded,mode:null!==(r=null===(t=this.controller)||void 0===t?void 0:t.mode)&&void 0!==r?r:"n/a",symbolComplexity:c,nodes:null!==(i=null===(u=this.controller)||void 0===u?void 0:u.tileDescriptors.length)&&void 0!==i?i:0},null!==(o=null===(a=this.controller)||void 0===a?void 0:a.debug)&&void 0!==o?o:{storedFeatures:0,totalVertices:0})}},{key:"test",get:function(){var e;return{updatePolicy:this.updatePolicy,controller:this.controller,loadedGraphics:null===(e=this.controller)||void 0===e?void 0:e.graphics}}}]),t}((0,t(13107).Z)((0,Z.R)((0,L.Z)((0,C.A)(Y.Z)))));(0,d._)([(0,m.Cb)()],U.prototype,"layer",void 0),(0,d._)([(0,m.Cb)()],U.prototype,"controller",void 0),(0,d._)([(0,m.Cb)()],U.prototype,"_controllerTotal",void 0),(0,d._)([(0,m.Cb)()],U.prototype,"_processorTotal",void 0),(0,d._)([(0,m.Cb)()],U.prototype,"maximumNumberOfFeatures",null),(0,d._)([(0,m.Cb)()],U.prototype,"maximumNumberOfFeaturesExceeded",null),(0,d._)([(0,m.Cb)(B.q)],U.prototype,"updatingProgress",void 0),(0,d._)([(0,m.Cb)({readOnly:!0})],U.prototype,"updatingProgressValue",null),(0,d._)([(0,m.Cb)({readOnly:!0})],U.prototype,"updatePolicy",null),(0,d._)([(0,m.Cb)({readOnly:!0})],U.prototype,"hasZ",null),(0,d._)([(0,m.Cb)({readOnly:!0})],U.prototype,"hasM",null),(0,d._)([(0,m.Cb)()],U.prototype,"suspendResumeExtentMode",void 0),U=(0,d._)([(0,g.j)("esri.views.3d.layers.FeatureLayerViewBase3D")],U);var H={point:5e3,polygon:500,polyline:1e3},z=U}}]);
//# sourceMappingURL=53952.37bf3f49.chunk.js.map