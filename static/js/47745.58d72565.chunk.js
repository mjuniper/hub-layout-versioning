"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[47745],{47745:function(e,t,r){r.r(t),r.d(t,{default:function(){return W}});var i=r(37762),n=r(15671),l=r(43144),u=r(11752),s=r(61120),a=r(60136),o=r(92572),d=r(27366),c=r(52639),h=r(32718),y=r(92026),f=r(94172),v=r(49861),p=(r(25243),r(63780),r(69912)),g=r(48562),_=r(18661),C=r(87072),F=r(21149),b=r(28554),w=r(22075),k=r(42757),E=r(42069),I=r(46169),S=r(31730),x=r(71039),Q=r(95964),m=r(75162),O=r(43812),j=r(51246),Z=r(73552),q=r(44011),R=r(1247),H=r(48252),A=r(23224),D=r(6777),L=r(58890),U=r(17006),N=r(93463),P=(0,H.v)(),G=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).type="scene-layer-3d",e.progressiveLoadFactor=1,e._elevationContext="scene",e._isIntegratedMesh=!1,e._supportsLabeling=!0,e._interactiveEditingSessions=new Map,e._queryEngine=null,e}return(0,l.Z)(r,[{key:"i3slayer",get:function(){return this.layer}},{key:"tryRecycleWith",value:function(e,t){var r=this;return e.url===this.layer.url&&this.i3sOverrides.isEmpty?e.load(t).then((function(){var t;(0,q.tq)(r.layer,e,r.i3sOverrides),r.layer=e,r.i3sOverrides.destroy();var i=null===(t=r.view.resourceController)||void 0===t?void 0:t.memoryController;r.i3sOverrides=new m.v({view:r.view,layer:e,memoryController:i}),r.resetHighlights()})):null}},{key:"layerPopupEnabled",get:function(){return this.layer.popupEnabled}},{key:"filter",get:function(){return this._get("filter")},set:function(e){this._set("filter",x.z.checkSupport(e)?e:null)}},{key:"viewFilter",get:function(){var e=this,t=this.filter,r=this.layerFilter;if((0,y.Wi)(t)&&(0,y.Wi)(r))return null;var i=this._get("viewFilter");return(0,y.Wi)(i)?new x.z({layerFilter:r,viewFilter:t,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:function(t){return e._loadAsyncModule(t)},addSqlFilter:function(t,r){return e.addSqlFilter(t,r,e.logError)}}):(i.viewFilter=t,i.layerFilter=r,i)}},{key:"requiredFields",get:function(){var e,t;return null!==(e=null===(t=this._fieldsHelper)||void 0===t?void 0:t.requiredFields)&&void 0!==e?e:[]}},{key:"_floorFilterClause",get:function(){var e=(0,C.c)(this);return(0,y.pC)(e)?g.WhereClause.create(e,this.layer.fieldsIndex):null}},{key:"_excludeObjectIdsSorted",get:function(){var e=this.layer.excludeObjectIds.toArray();return(0,b.Rx)()&&this.i3sOverrides.is3DOFL&&this.i3sOverrides.geometryChangedObjectIds.length>0&&(e=e.concat(this.i3sOverrides.geometryChangedObjectIds)),e.length?e.sort((function(e,t){return e-t})):null}},{key:"_objectQualitySettings",get:function(){var e,t,r;return null===(e=this.view)||void 0===e||null===(t=e.qualitySettings)||void 0===t||null===(r=t.sceneService)||void 0===r?void 0:r.object}},{key:"lodFactor",get:function(){var e,t;return null!==(e=null===(t=this._objectQualitySettings)||void 0===t?void 0:t.lodFactor)&&void 0!==e?e:1}},{key:"lodCrossfadeinDuration",get:function(){var e;return null!==(e=this._objectQualitySettings.lodCrossfadeinDuration)&&void 0!==e?e:0}},{key:"lodCrossfadeoutDuration",get:function(){var e;return null!==(e=this._objectQualitySettings.lodCrossfadeoutDuration)&&void 0!==e?e:0}},{key:"lodCrossfadeUncoveredDuration",get:function(){var e;return null!==(e=this._objectQualitySettings.lodCrossfadeUncoveredDuration)&&void 0!==e?e:0}},{key:"updatingProgressValue",get:function(){var e,t;return null!==(e=null===(t=this._controller)||void 0===t?void 0:t.updatingProgress)&&void 0!==e?e:0}},{key:"initialize",value:function(){var e=this;this._fieldsHelper=new D.K({layerView:this}),this.updatingHandles.add((function(){return e.layer.rangeInfos}),(function(t){return e._rangeInfosChanged(t)}),f.nn),this.updatingHandles.add((function(){return e.layer.renderer}),(function(t){return e.updatingHandles.addPromise(e._rendererChange(t))}),f.nn);var t=function(){return e._filterChange()};this.updatingHandles.add((function(){return e.parsedDefinitionExpression}),t),this.updatingHandles.add((function(){return e.filter}),t),this.updatingHandles.add((function(){return e._floorFilterClause}),t),this.updatingHandles.add((function(){return e._excludeObjectIdsSorted}),t),this.updatingHandles.add((function(){return(0,y.pC)(e.viewFilter)?e.viewFilter.sortedObjectIds:null}),t),this.updatingHandles.add((function(){return(0,y.pC)(e.viewFilter)?e.viewFilter.parsedWhereClause:null}),t),this.updatingHandles.add((function(){return[(0,y.pC)(e.viewFilter)?e.viewFilter.parsedGeometry:null,(0,y.pC)(e.filter)?e.filter.spatialRelationship:null,(0,y.pC)(e.layer.filter)?e.layer.filter.spatialRelationship:null]}),(function(){return e._geometryFilterChange()})),this.handles.add(this.layer.on("apply-edits",(function(t){return e.updatingHandles.addPromise(t.result)}))),this.handles.add(this.layer.on("edits",(function(t){return e._handleEdits(t)})))}},{key:"destroy",value:function(){this._fieldsHelper=(0,y.SC)(this._fieldsHelper)}},{key:"_rangeInfosChanged",value:function(e){null!=e&&e.length>0&&h.Z.getLogger(this.declaredClass).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return(0,y.pC)(this.filter)?this.filter.createQuery(e):new F.Z(e)}},{key:"queryExtent",value:function(e,t){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryFeatureCount",value:function(e,t){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryFeatures",value:function(e,t){var r=this;return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal).then((function(e){if(null===e||void 0===e||!e.features)return e;var t,n=r.layer,l=(0,i.Z)(e.features);try{for(l.s();!(t=l.n()).done;){var u=t.value;u.layer=n,u.sourceLayer=n}}catch(s){l.e(s)}finally{l.f()}return e}))}},{key:"queryObjectIds",value:function(e,t){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"_ensureQueryEngine",value:function(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine}},{key:"_createQueryEngine",value:function(){var e,t=this,r=(0,S.gz)(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new O.u({layerView:this,priority:N.T8.FEATURE_QUERY_ENGINE,spatialIndex:new Z.I({featureAdapter:new j.u({objectIdField:this.layer.objectIdField,attributeStorageInfo:null!==(e=this.layer.attributeStorageInfo)&&void 0!==e?e:[],getFeatureExtent:r}),forAllFeatures:function(e,r){return t._forAllFeatures((function(t,r,i){return e({id:t,index:r,meta:i})}),r,k.u.ALL_IN_CLIPPING_AREA)},getFeatureExtent:r,sourceSpatialReference:(0,q.tp)(this.layer),viewSpatialReference:this.view.spatialReference})})}},{key:"highlight",value:function(e){var t=this._highlights;if(e instanceof F.Z){var i=t.acquireSet(),n=i.set,l=i.handle;return this.queryObjectIds(e).then((function(e){return t.setFeatureIds(n,e)})),l}return(0,u.Z)((0,s.Z)(r.prototype),"highlight",this).call(this,e)}},{key:"createInteractiveEditSession",value:function(e){return(0,I.sw)(this._attributeEditingContext,e)}},{key:"_createLayerGraphic",value:function(e){var t=new c.Z(null,null,e);return t.layer=this.layer,t.sourceLayer=this.layer,t}},{key:"canResume",value:function(){return(0,u.Z)((0,s.Z)(r.prototype),"canResume",this).call(this)&&(!this._controller||this._controller.rootNodeVisible)}},{key:"getFilters",value:function(){var e=(0,u.Z)((0,s.Z)(r.prototype),"getFilters",this).call(this),t=this._excludeObjectIdsSorted;return(0,y.pC)(t)&&e.push((function(e){return(0,q.Yb)(t,!1,e)})),this._floorFilterClause&&this.addSqlFilter(e,this._floorFilterClause,this.logError),this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),(0,y.pC)(this.viewFilter)&&this.viewFilter.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}},{key:"isUpdating",value:function(){return(0,u.Z)((0,s.Z)(r.prototype),"isUpdating",this).call(this)||this.layerFilterUpdating||(0,y.pC)(this.viewFilter)&&this.viewFilter.updating||(0,y.pC)(this.i3sOverrides)&&this.i3sOverrides.updating}},{key:"_ensureQuery",value:function(e){return this._addDefinitionExpressionToQuery((0,y.Wi)(e)?this.createQuery():F.Z.from(e))}},{key:"_attributeEditingContext",get:function(){var e,t=this;return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:function(e){return t._forAllNodes((function(t){return(0,y.pC)(t)?e(t.node,t.featureIds):null}))},attributeStorageInfo:null!==(e=this.i3slayer.attributeStorageInfo)&&void 0!==e?e:[],i3sOverrides:this.i3sOverrides,getAttributeData:function(e){return t.getAttributeData(e)},setAttributeData:function(e,r){return t.setAttributeData(e,r)},clearMemCache:function(){return t.clearMemCache()}}}},{key:"_handleEdits",value:function(e){(0,b.Rx)()&&(0,I.ZS)(this._attributeEditingContext,e),(0,I.Z6)(this._attributeEditingContext,e)}},{key:"hasGeometryFilter",get:function(){var e=this.viewFilter;return(0,y.pC)(e)&&(0,y.pC)(e.parsedGeometry)}},{key:"computeNodeFiltering",value:function(e){var t=this.viewFilter;return(0,y.Wi)(t)||!this.view.spatialReference||t.isMBSGeometryVisible(e,this.view.spatialReference,this._controller.crsIndex)?Q.U_.Unmodified:Q.U_.Culled}}]),r}((0,w.N)((0,R.l)((0,A.i)((0,E.A)(U.Z)))));(0,d._)([(0,v.Cb)()],G.prototype,"i3slayer",null),(0,d._)([(0,v.Cb)(L.q)],G.prototype,"updatingProgress",void 0),(0,d._)([(0,v.Cb)({type:_.Z})],G.prototype,"filter",null),(0,d._)([(0,v.Cb)({readOnly:!0})],G.prototype,"viewFilter",null),(0,d._)([(0,v.Cb)(P.requiredFields)],G.prototype,"requiredFields",null),(0,d._)([(0,v.Cb)(P.availableFields)],G.prototype,"availableFields",void 0),(0,d._)([(0,v.Cb)()],G.prototype,"_fieldsHelper",void 0),(0,d._)([(0,v.Cb)()],G.prototype,"_floorFilterClause",null),(0,d._)([(0,v.Cb)()],G.prototype,"_excludeObjectIdsSorted",null),(0,d._)([(0,v.Cb)()],G.prototype,"_objectQualitySettings",null),(0,d._)([(0,v.Cb)()],G.prototype,"lodFactor",null),(0,d._)([(0,v.Cb)()],G.prototype,"updatingProgressValue",null);var W=G=(0,d._)([(0,p.j)("esri.views.3d.layers.SceneLayerView3D")],G)}}]);
//# sourceMappingURL=47745.58d72565.chunk.js.map