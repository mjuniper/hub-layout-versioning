/*! For license information please see 36106.d9ad5f2a.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkhub_layout_versioning=self.webpackChunkhub_layout_versioning||[]).push([[36106],{36106:function(e,r,t){t.d(r,{U:function(){return d}});var n=t(77843),s=t(30678);function o(e){return e.replace(/^#/,"").split("&").reduce((function(e,r){var t=function(e){var r=e.split("="),t=r[0],n=r[1];return{key:decodeURIComponent(t),value:decodeURIComponent(n)}}(r),n=t.key,s=t.value;return e[n]=s,e}),{})}var i=function(){return i=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var s in r=arguments[t])Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s]);return e},i.apply(this,arguments)};function a(e,r){var t=r;return t.rawResponse=!1,(0,n.r)(e,t).then((function(e){var r={token:e.access_token,username:e.username,expires:new Date(Date.now()+(1e3*e.expires_in-1e3)),ssl:!0===e.ssl};return e.refresh_token&&(r.refreshToken=e.refresh_token),r}))}function u(e,r){var t=r;return"undefined"!==typeof window&&window.location&&window.location.host?t.params.referer=window.location.host:t.params.referer=n.N,(0,n.r)(e,t)}var p=/^https?:\/\/(\S+)\.arcgis\.com.+/;function h(e){return p.test(e)}function c(e){if(!p.test(e))return null;var r=e.match(p)[1].split(".").pop();return r.includes("dev")?"dev":r.includes("qa")?"qa":"production"}function l(e,r){var t=(0,s.c)(function(e){if(!p.test(e))return e;switch(c(e)){case"dev":return"https://devext.arcgis.com/sharing/rest";case"qa":return"https://qaext.arcgis.com/sharing/rest";default:return"https://www.arcgis.com/sharing/rest"}}(r)).replace(/https?:\/\//,""),n=(0,s.c)(e).replace(/https?:\/\//,"");return new RegExp(n,"i").test(t)}var d=function(){function e(e){if(this.clientId=e.clientId,this._refreshToken=e.refreshToken,this._refreshTokenExpires=e.refreshTokenExpires,this.username=e.username,this.password=e.password,this._token=e.token,this._tokenExpires=e.tokenExpires,this.portal=e.portal?(0,s.c)(e.portal):"https://www.arcgis.com/sharing/rest",this.ssl=e.ssl,this.provider=e.provider||"arcgis",this.tokenDuration=e.tokenDuration||20160,this.redirectUri=e.redirectUri,this.refreshTokenTTL=e.refreshTokenTTL||20160,this.server=e.server,this.federatedServers={},this.trustedDomains=[],e.server){var r=this.getServerRootUrl(e.server);this.federatedServers[r]={token:e.token,expires:e.tokenExpires}}this._pendingTokenRequests={}}return Object.defineProperty(e.prototype,"token",{get:function(){return this._token},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tokenExpires",{get:function(){return this._tokenExpires},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"refreshToken",{get:function(){return this._refreshToken},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"refreshTokenExpires",{get:function(){return this._refreshTokenExpires},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trustedServers",{get:function(){return console.log("DEPRECATED: use federatedServers instead"),this.federatedServers},enumerable:!1,configurable:!0}),e.beginOAuth2=function(r,t){void 0===t&&(t=window),r.duration&&console.log("DEPRECATED: 'duration' is deprecated - use 'expiration' instead");var s,o=i({portal:"https://www.arcgis.com/sharing/rest",provider:"arcgis",expiration:20160,popup:!0,popupWindowFeatures:"height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes",state:r.clientId,locale:""},r),a=o.portal,u=o.provider,p=o.clientId,h=o.expiration,c=o.redirectUri,l=o.popup,d=o.popupWindowFeatures,f=o.state,k=o.locale,g=o.params;if(s="arcgis"===u?a+"/oauth2/authorize?client_id="+p+"&response_type=token&expiration="+(r.duration||h)+"&redirect_uri="+encodeURIComponent(c)+"&state="+f+"&locale="+k:a+"/oauth2/social/authorize?client_id="+p+"&socialLoginProviderName="+u+"&autoAccountCreateForSocial=true&response_type=token&expiration="+(r.duration||h)+"&redirect_uri="+encodeURIComponent(c)+"&state="+f+"&locale="+k,g&&(s=s+"&"+(0,n.e)(g)),l){var m=function(){var e={promise:null,resolve:null,reject:null};return e.promise=new Promise((function(r,t){e.resolve=r,e.reject=t})),e}();return t["__ESRI_REST_AUTH_HANDLER_"+p]=function(r,t){if(r){var s=JSON.parse(r);m.reject(new n.A(s.errorMessage,s.error))}else if(t){var o=JSON.parse(t);m.resolve(new e({clientId:p,portal:a,ssl:o.ssl,token:o.token,tokenExpires:new Date(o.expires),username:o.username}))}},t.open(s,"oauth-window",d),m.promise}t.location.href=s},e.completeOAuth2=function(r,t){void 0===t&&(t=window);var s=i({portal:"https://www.arcgis.com/sharing/rest",popup:!0},r),a=s.portal,u=s.clientId,p=s.popup;function h(r,s){try{var o=void 0,i="__ESRI_REST_AUTH_HANDLER_"+u;if(p&&(t.opener?t.opener.parent&&t.opener.parent[i]?o=t.opener.parent[i]:t.opener&&t.opener[i]&&(o=t.opener[i]):t!==t.parent&&t.parent&&t.parent[i]&&(o=t.parent[i]),o))return o(r?JSON.stringify(r):void 0,JSON.stringify(s)),void t.close()}catch(h){throw new n.A('Unable to complete authentication. It\'s possible you specified popup based oAuth2 but no handler from "beginOAuth2()" present. This generally happens because the "popup" option differs between "beginOAuth2()" and "completeOAuth2()".')}if(r)throw new n.A(r.errorMessage,r.error);return new e({clientId:u,portal:a,ssl:s.ssl,token:s.token,tokenExpires:s.expires,username:s.username})}var c=o(t.location.hash);if(!c.access_token){var l=void 0,d="Unknown error";return c.error&&(l=c.error,d=c.error_description),h({error:l,errorMessage:d})}var f=c.access_token,k=new Date(Date.now()+1e3*parseInt(c.expires_in,10)-6e4),g=c.username;return h(void 0,{token:f,expires:k,ssl:"true"===c.ssl,username:g})},e.fromParent=function(r,t){var n;return!t&&window&&(t=window),new Promise((function(s,o){n=function(r){if(r.source===t.parent&&r.data)try{return s(e.parentMessageHandler(r))}catch(n){return o(n)}},t.addEventListener("message",n,!1),t.parent.postMessage({type:"arcgis:auth:requestCredential"},r)})).then((function(e){return t.removeEventListener("message",n,!1),e}))},e.authorize=function(e,r){e.duration&&console.log("DEPRECATED: 'duration' is deprecated - use 'expiration' instead");var t=i({portal:"https://arcgis.com/sharing/rest",expiration:20160},e),n=t.portal,s=t.clientId,o=t.expiration,a=t.redirectUri;r.writeHead(301,{Location:n+"/oauth2/authorize?client_id="+s+"&expiration="+(e.duration||o)+"&response_type=code&redirect_uri="+encodeURIComponent(a)}),r.end()},e.exchangeAuthorizationCode=function(r,t){var n=i({portal:"https://www.arcgis.com/sharing/rest",refreshTokenTTL:20160},r),s=n.portal,o=n.clientId,u=n.redirectUri,p=n.refreshTokenTTL;return a(s+"/oauth2/token",{params:{grant_type:"authorization_code",client_id:o,redirect_uri:u,code:t}}).then((function(r){return new e({clientId:o,portal:s,ssl:r.ssl,redirectUri:u,refreshToken:r.refreshToken,refreshTokenTTL:p,refreshTokenExpires:new Date(Date.now()+60*(p-1)*1e3),token:r.token,tokenExpires:r.expires,username:r.username})}))},e.deserialize=function(r){var t=JSON.parse(r);return new e({clientId:t.clientId,refreshToken:t.refreshToken,refreshTokenExpires:new Date(t.refreshTokenExpires),username:t.username,password:t.password,token:t.token,tokenExpires:new Date(t.tokenExpires),portal:t.portal,ssl:t.ssl,tokenDuration:t.tokenDuration,redirectUri:t.redirectUri,refreshTokenTTL:t.refreshTokenTTL})},e.fromCredential=function(r){var t="undefined"===typeof r.ssl||r.ssl,n=r.expires||Date.now()+72e5;return new e({portal:r.server.includes("sharing/rest")?r.server:r.server+"/sharing/rest",ssl:t,token:r.token,username:r.userId,tokenExpires:new Date(n)})},e.parentMessageHandler=function(r){if("arcgis:auth:credential"===r.data.type)return e.fromCredential(r.data.credential);if("arcgis:auth:error"===r.data.type){var t=new Error(r.data.error.message);throw t.name=r.data.error.name,t}throw new Error("Unknown message type.")},e.prototype.toCredential=function(){return{expires:this.tokenExpires.getTime(),server:this.portal,ssl:this.ssl,token:this.token,userId:this.username}},e.prototype.getUser=function(e){var r=this;if(this._pendingUserRequest)return this._pendingUserRequest;if(this._user)return Promise.resolve(this._user);var t=this.portal+"/community/self",s=i(i({httpMethod:"GET",authentication:this},e),{rawResponse:!1});return this._pendingUserRequest=(0,n.r)(t,s).then((function(e){return r._user=e,r._pendingUserRequest=null,e})),this._pendingUserRequest},e.prototype.getPortal=function(e){var r=this;if(this._pendingPortalRequest)return this._pendingPortalRequest;if(this._portalInfo)return Promise.resolve(this._portalInfo);var t=this.portal+"/portals/self",s=i(i({httpMethod:"GET",authentication:this},e),{rawResponse:!1});return this._pendingPortalRequest=(0,n.r)(t,s).then((function(e){return r._portalInfo=e,r._pendingPortalRequest=null,e})),this._pendingPortalRequest},e.prototype.getUsername=function(){return this.username?Promise.resolve(this.username):this._user?Promise.resolve(this._user.username):this.getUser().then((function(e){return e.username}))},e.prototype.getToken=function(e,r){return function(e,r){var t=h(e),n=h(r),s=c(e),o=c(r);return!(!t||!n||s!==o)}(this.portal,e)||new RegExp(this.portal,"i").test(e)?this.getFreshToken(r):this.getTokenForServer(e,r)},e.prototype.validateAppAccess=function(e){return this.getToken(this.portal).then((function(r){return function(e,r,t){void 0===t&&(t="https://www.arcgis.com/sharing/rest");var s=t+"/oauth2/validateAppAccess",o={method:"POST",params:{f:"json",client_id:r,token:e}};return(0,n.r)(s,o)}(r,e)}))},e.prototype.toJSON=function(){return{clientId:this.clientId,refreshToken:this.refreshToken,refreshTokenExpires:this.refreshTokenExpires,username:this.username,password:this.password,token:this.token,tokenExpires:this.tokenExpires,portal:this.portal,ssl:this.ssl,tokenDuration:this.tokenDuration,redirectUri:this.redirectUri,refreshTokenTTL:this.refreshTokenTTL}},e.prototype.serialize=function(){return JSON.stringify(this)},e.prototype.enablePostMessageAuth=function(e,r){!r&&window&&(r=window),this._hostHandler=this.createPostMessageHandler(e),r.addEventListener("message",this._hostHandler,!1)},e.prototype.disablePostMessageAuth=function(e){!e&&window&&(e=window),e.removeEventListener("message",this._hostHandler,!1)},e.prototype.refreshSession=function(e){return this._user=null,this.username&&this.password?this.refreshWithUsernameAndPassword(e):this.clientId&&this.refreshToken?this.refreshWithRefreshToken():Promise.reject(new n.A("Unable to refresh token."))},e.prototype.getServerRootUrl=function(e){var r=(0,s.c)(e).split(/\/rest(\/admin)?\/services(?:\/|#|\?|$)/)[0].match(/(https?:\/\/)(.+)/),t=r[1],n=r[2].split("/"),o=n[0],i=n.slice(1);return""+t+o.toLowerCase()+"/"+i.join("/")},e.prototype.getDomainCredentials=function(e){return this.trustedDomains&&this.trustedDomains.length&&this.trustedDomains.some((function(r){return e.startsWith(r)}))?"include":"same-origin"},e.prototype.createPostMessageHandler=function(e){var r=this;return function(t){var n=e.indexOf(t.origin)>-1,s="arcgis:auth:requestCredential"===t.data.type,o=r.tokenExpires.getTime()>Date.now();if(n&&s){var i={};if(o){var a=r.toCredential();a.server=a.server.replace("/sharing/rest",""),i={type:"arcgis:auth:credential",credential:a}}else i={type:"arcgis:auth:error",error:{name:"tokenExpiredError",message:"Session token was expired, and not returned to the child application"}};t.source.postMessage(i,t.origin)}}},e.prototype.getTokenForServer=function(e,r){var t=this,s=this.getServerRootUrl(e),o=this.federatedServers[s];return o&&o.expires&&o.expires.getTime()>Date.now()?Promise.resolve(o.token):(this._pendingTokenRequests[s]||(this._pendingTokenRequests[s]=this.fetchAuthorizedDomains().then((function(){return(0,n.r)(s+"/rest/info",{credentials:t.getDomainCredentials(e)}).then((function(o){if(o.owningSystemUrl){if(l(o.owningSystemUrl,t.portal))return(0,n.r)(o.owningSystemUrl+"/sharing/rest/info",r);throw new n.A(e+" is not federated with "+t.portal+".","NOT_FEDERATED")}if(o.authInfo&&void 0!==t.federatedServers[s])return Promise.resolve({authInfo:o.authInfo});throw new n.A(e+" is not federated with any portal and is not explicitly trusted.","NOT_FEDERATED")})).then((function(e){return e.authInfo.tokenServicesUrl})).then((function(r){return t.token&&t.tokenExpires.getTime()>Date.now()?u(r,{params:{token:t.token,serverUrl:e,expiration:t.tokenDuration,client:"referer"}}):u(r,{params:{username:t.username,password:t.password,expiration:t.tokenDuration,client:"referer"}}).then((function(e){return t._token=e.token,t._tokenExpires=new Date(e.expires),e}))})).then((function(e){return t.federatedServers[s]={expires:new Date(e.expires),token:e.token},delete t._pendingTokenRequests[s],e.token}))}))),this._pendingTokenRequests[s])},e.prototype.getFreshToken=function(e){var r=this;return this.token&&!this.tokenExpires||this.token&&this.tokenExpires&&this.tokenExpires.getTime()>Date.now()?Promise.resolve(this.token):(this._pendingTokenRequests[this.portal]||(this._pendingTokenRequests[this.portal]=this.refreshSession(e).then((function(e){return r._pendingTokenRequests[r.portal]=null,e.token}))),this._pendingTokenRequests[this.portal])},e.prototype.refreshWithUsernameAndPassword=function(e){var r=this,t=i({params:{username:this.username,password:this.password,expiration:this.tokenDuration}},e);return u(this.portal+"/generateToken",t).then((function(e){return r._token=e.token,r._tokenExpires=new Date(e.expires),r}))},e.prototype.refreshWithRefreshToken=function(e){var r=this;if(this.refreshToken&&this.refreshTokenExpires&&this.refreshTokenExpires.getTime()<Date.now())return this.refreshRefreshToken(e);var t=i({params:{client_id:this.clientId,refresh_token:this.refreshToken,grant_type:"refresh_token"}},e);return a(this.portal+"/oauth2/token",t).then((function(e){return r._token=e.token,r._tokenExpires=e.expires,r}))},e.prototype.refreshRefreshToken=function(e){var r=this,t=i({params:{client_id:this.clientId,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,grant_type:"exchange_refresh_token"}},e);return a(this.portal+"/oauth2/token",t).then((function(e){return r._token=e.token,r._tokenExpires=e.expires,r._refreshToken=e.refreshToken,r._refreshTokenExpires=new Date(Date.now()+60*(r.refreshTokenTTL-1)*1e3),r}))},e.prototype.fetchAuthorizedDomains=function(){var e=this;return this.server||!this.portal?Promise.resolve(this):this.getPortal().then((function(r){return r.authorizedCrossOriginDomains&&r.authorizedCrossOriginDomains.length&&(e.trustedDomains=r.authorizedCrossOriginDomains.filter((function(e){return!e.startsWith("http://")})).map((function(e){return e.startsWith("https://")?e:"https://"+e}))),e}))},e}()}}]);
//# sourceMappingURL=36106.d9ad5f2a.chunk.js.map